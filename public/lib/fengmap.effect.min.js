/**Released Version v3.1.10,BUILD 237,Time 1749031855583. Fengmap Javascript SDK , see: https://www.fengmap.com for details**/
((t,n)=>{"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.fengmap=n():t.fengmap=n()})(this,function(){return e=[function(S,x,t){t.r(x);var o={},r=(t.r(o),t.d(o,"ArcCurve",function(){return Zu}),t.d(o,"CatmullRomCurve3",function(){return cl}),t.d(o,"CubicBezierCurve",function(){return Sl}),t.d(o,"CubicBezierCurve3",function(){return Cl}),t.d(o,"EllipseCurve",function(){return zu}),t.d(o,"LineCurve",function(){return Bl}),t.d(o,"LineCurve3",function(){return ql}),t.d(o,"QuadraticBezierCurve",function(){return rc}),t.d(o,"QuadraticBezierCurve3",function(){return vc}),t.d(o,"SplineCurve",function(){return Sc}),["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]),A=1234567,M=Math.PI/180,P=180/Math.PI;function j(){var t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(r[255&t]+r[t>>8&255]+r[t>>16&255]+r[t>>24&255]+"-"+r[255&n]+r[n>>8&255]+"-"+r[n>>16&15|64]+r[n>>24&255]+"-"+r[63&e|128]+r[e>>8&255]+"-"+r[e>>16&255]+r[e>>24&255]+r[255&i]+r[i>>8&255]+r[i>>16&255]+r[i>>24&255]).toLowerCase()}function y(t,n,e){return Math.max(n,Math.min(e,t))}function V(t,n){return(t%n+n)%n}function z(t,n,e){return(1-e)*t+e*n}function G(t,n){switch(n.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function a(t,n){switch(n.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}var X={DEG2RAD:M,RAD2DEG:P,generateUUID:j,clamp:y,euclideanModulo:V,mapLinear:function(t,n,e,i,r){return i+(t-n)*(r-i)/(e-n)},inverseLerp:function(t,n,e){return t!==n?(e-t)/(n-t):0},lerp:z,damp:function(t,n,e,i){return z(t,n,1-Math.exp(-e*i))},pingpong:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return n-Math.abs(V(t,2*n)-n)},smoothstep:function(t,n,e){return t<=n?0:e<=t?1:(t=(t-n)/(e-n))*t*(3-2*t)},smootherstep:function(t,n,e){return t<=n?0:e<=t?1:(t=(t-n)/(e-n))*t*t*(t*(6*t-15)+10)},randInt:function(t,n){return t+Math.floor(Math.random()*(n-t+1))},randFloat:function(t,n){return t+Math.random()*(n-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(A=t),t=A+=1831565813,t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},degToRad:function(t){return t*M},radToDeg:function(t){return t*P},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,n,e,i,r){var o=Math.cos,a=Math.sin,s=o(e/2),u=a(e/2),l=o((n+i)/2),c=a((n+i)/2),f=o((n-i)/2),h=a((n-i)/2),v=o((i-n)/2),d=a((i-n)/2);switch(r){case"XYX":t.set(s*c,u*f,u*h,s*l);break;case"YZY":t.set(u*h,s*c,u*f,s*l);break;case"ZXZ":t.set(u*f,u*h,s*c,s*l);break;case"XZX":t.set(s*c,u*d,u*v,s*l);break;case"YXY":t.set(u*v,s*c,u*d,s*l);break;case"ZYZ":t.set(u*d,u*v,s*c,s*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:a,denormalize:G},Y=0,W=1,Q=1e3,q=1001,m=1003,O=1006,Z=1016,J=1023,K="srgb-linear",t="display-p3-linear",$="linear",tt=7680;function nt(t){return(nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function et(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=nt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=nt(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==nt(t)?t:t+""))(i.key),i)}}var v=(()=>{function l(t,n,e,i,r,o,a,s,u){if(!(this instanceof l))throw new TypeError("Cannot call a class as a function");l.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,n,e,i,r,o,a,s,u)}return t=l,(n=[{key:"set",value:function(t,n,e,i,r,o,a,s,u){var l=this.elements;return l[0]=t,l[1]=i,l[2]=a,l[3]=n,l[4]=r,l[5]=s,l[6]=e,l[7]=o,l[8]=u,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(t){var n=this.elements,t=t.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],this}},{key:"extractBasis",value:function(t,n,e){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),e.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(t){t=t.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyMatrices",value:function(t,n){var t=t.elements,n=n.elements,e=this.elements,i=t[0],r=t[3],o=t[6],a=t[1],s=t[4],u=t[7],l=t[2],c=t[5],t=t[8],f=n[0],h=n[3],v=n[6],d=n[1],m=n[4],p=n[7],y=n[2],g=n[5],n=n[8];return e[0]=i*f+r*d+o*y,e[3]=i*h+r*m+o*g,e[6]=i*v+r*p+o*n,e[1]=a*f+s*d+u*y,e[4]=a*h+s*m+u*g,e[7]=a*v+s*p+u*n,e[2]=l*f+c*d+t*y,e[5]=l*h+c*m+t*g,e[8]=l*v+c*p+t*n,this}},{key:"multiplyScalar",value:function(t){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}},{key:"determinant",value:function(){var t=this.elements,n=t[0],e=t[1],i=t[2],r=t[3],o=t[4],a=t[5],s=t[6],u=t[7],t=t[8];return n*o*t-n*a*u-e*r*t+e*a*s+i*r*u-i*o*s}},{key:"invert",value:function(){var t=this.elements,n=t[0],e=t[1],i=t[2],r=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=l*o-a*u,f=a*s-l*r,h=u*r-o*s,v=n*c+e*f+i*h;return 0==v?this.set(0,0,0,0,0,0,0,0,0):(t[0]=c*(c=1/v),t[1]=(i*u-l*e)*c,t[2]=(a*e-i*o)*c,t[3]=f*c,t[4]=(l*n-i*s)*c,t[5]=(i*r-a*n)*c,t[6]=h*c,t[7]=(e*s-u*n)*c,t[8]=(o*n-e*r)*c,this)}},{key:"transpose",value:function(){var t=this.elements,n=t[1];return t[1]=t[3],t[3]=n,n=t[2],t[2]=t[6],t[6]=n,n=t[5],t[5]=t[7],t[7]=n,this}},{key:"getNormalMatrix",value:function(t){return this.setFromMatrix4(t).invert().transpose()}},{key:"transposeIntoArray",value:function(t){var n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}},{key:"setUvTransform",value:function(t,n,e,i,r,o,a){var s=Math.cos(r),r=Math.sin(r);return this.set(e*s,e*r,-e*(s*o+r*a)+o+t,-i*r,i*s,-i*(-r*o+s*a)+a+n,0,0,1),this}},{key:"scale",value:function(t,n){return this.premultiply(it.makeScale(t,n)),this}},{key:"rotate",value:function(t){return this.premultiply(it.makeRotation(-t)),this}},{key:"translate",value:function(t,n){return this.premultiply(it.makeTranslation(t,n)),this}},{key:"makeTranslation",value:function(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}},{key:"makeRotation",value:function(t){var n=Math.cos(t),t=Math.sin(t);return this.set(n,-t,0,t,n,0,0,0,1),this}},{key:"makeScale",value:function(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}},{key:"equals",value:function(t){for(var n=this.elements,e=t.elements,i=0;i<9;i++)if(n[i]!==e[i])return!1;return!0}},{key:"fromArray",value:function(t){for(var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,e=0;e<9;e++)this.elements[e]=t[e+n];return this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,e=this.elements;return t[n]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t[n+4]=e[4],t[n+5]=e[5],t[n+6]=e[6],t[n+7]=e[7],t[n+8]=e[8],t}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}}])&&et(t.prototype,n),e&&et(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,e})(),it=new v;function rt(t){return(rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ot(t,n,e){return(n=(t=>(t=((t,n)=>{if("object"!=rt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=rt(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==rt(t)?t:t+""))(n))in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}var at=(new v).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),st=(new v).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),ut=ot(ot(ot(ot({},K,{transfer:$,primaries:"rec709",luminanceCoefficients:[.2126,.7152,.0722],toReference:function(t){return t},fromReference:function(t){return t}}),"srgb",{transfer:"srgb",primaries:"rec709",luminanceCoefficients:[.2126,.7152,.0722],toReference:function(t){return t.convertSRGBToLinear()},fromReference:function(t){return t.convertLinearToSRGB()}}),t,{transfer:$,primaries:"p3",luminanceCoefficients:[.2289,.6917,.0793],toReference:function(t){return t.applyMatrix3(st)},fromReference:function(t){return t.applyMatrix3(at)}}),"display-p3",{transfer:"srgb",primaries:"p3",luminanceCoefficients:[.2289,.6917,.0793],toReference:function(t){return t.convertSRGBToLinear().applyMatrix3(st)},fromReference:function(t){return t.applyMatrix3(at).convertLinearToSRGB()}}),lt=new Set([K,t]),ct={enabled:!0,u:K,get workingColorSpace(){return this.u},set workingColorSpace(t){if(!lt.has(t))throw new Error('Unsupported working color space, "'.concat(t,'".'));this.u=t},convert:function(t,n,e){return!1!==this.enabled&&n!==e&&n&&e?(n=ut[n].toReference,(0,ut[e].fromReference)(n(t))):t},fromWorkingColorSpace:function(t,n){return this.convert(t,this.u,n)},toWorkingColorSpace:function(t,n){return this.convert(t,n,this.u)},getPrimaries:function(t){return ut[t].primaries},getTransfer:function(t){return""===t?$:ut[t].transfer},getLuminanceCoefficients:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.u;return t.fromArray(ut[n].luminanceCoefficients)}};function ft(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function ht(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}var vt=.001,dt=K,mt=K;function pt(t){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yt(){yt=function(){return a};var u,a={},t=Object.prototype,l=t.hasOwnProperty,c=Object.defineProperty||function(t,n,e){t[n]=e.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",e=n.asyncIterator||"@@asyncIterator",r=n.toStringTag||"@@toStringTag";function o(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{o({},"")}catch(u){o=function(t,n,e){return t[n]=e}}function s(t,n,e,i){var r,o,a,s,n=n&&n.prototype instanceof y?n:y,n=Object.create(n.prototype),i=new T(i||[]);return c(n,"_invoke",{value:(r=t,o=e,a=i,s=h,function(t,n){if(s===d)throw Error("Generator is already running");if(s===m){if("throw"===t)throw n;return{value:u,done:!0}}for(a.method=t,a.arg=n;;){var e=a.delegate;if(e){e=function t(n,e){var i=e.method,r=n.iterator[i];if(r===u)return e.delegate=null,"throw"===i&&n.iterator.return&&(e.method="return",e.arg=u,t(n,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),p;i=f(r,n.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,p;r=i.arg;return r?r.done?(e[n.resultName]=r.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=u),e.delegate=null,p):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}(e,a);if(e){if(e===p)continue;return e}}if("next"===a.method)a.sent=a.v=a.arg;else if("throw"===a.method){if(s===h)throw s=m,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s=d;e=f(r,o,a);if("normal"===e.type){if(s=a.done?m:v,e.arg===p)continue;return{value:e.arg,done:a.done}}"throw"===e.type&&(s=m,a.method="throw",a.arg=e.arg)}})}),n}function f(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}a.wrap=s;var h="suspendedStart",v="suspendedYield",d="executing",m="completed",p={};function y(){}function g(){}function b(){}var n={},_=(o(n,i,function(){return this}),Object.getPrototypeOf),_=_&&_(_(M([]))),w=(_&&_!==t&&l.call(_,i)&&(n=_),b.prototype=y.prototype=Object.create(n));function S(t){["next","throw","return"].forEach(function(n){o(t,n,function(t){return this._invoke(n,t)})})}function x(a,s){var n;c(this,"_invoke",{value:function(e,i){function t(){return new s(function(t,n){!function n(t,e,i,r){var o,t=f(a[t],a,e);if("throw"!==t.type)return(e=(o=t.arg).value)&&"object"==pt(e)&&l.call(e,"__await")?s.resolve(e._).then(function(t){n("next",t,i,r)},function(t){n("throw",t,i,r)}):s.resolve(e).then(function(t){o.value=t,i(o)},function(t){return n("throw",t,i,r)});r(t.arg)}(e,i,t,n)})}return n=n?n.then(t,t):t()}})}function A(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function E(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function M(n){if(n||""===n){var e,t=n[i];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return e=-1,(t=function t(){for(;++e<n.length;)if(l.call(n,e))return t.value=n[e],t.done=!1,t;return t.value=u,t.done=!0,t}).next=t}throw new TypeError(pt(n)+" is not iterable")}return c(w,"constructor",{value:g.prototype=b,configurable:!0}),c(b,"constructor",{value:g,configurable:!0}),g.displayName=o(b,r,"GeneratorFunction"),a.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,o(t,r,"GeneratorFunction")),t.prototype=Object.create(w),t},a.awrap=function(t){return{_:t}},S(x.prototype),o(x.prototype,e,function(){return this}),a.AsyncIterator=x,a.async=function(t,n,e,i,r){void 0===r&&(r=Promise);var o=new x(s(t,n,e,i),r);return a.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},S(w),o(w,r,"Generator"),o(w,i,function(){return this}),o(w,"toString",function(){return"[object Generator]"}),a.keys=function(t){var n,e=Object(t),i=[];for(n in e)i.push(n);return i.reverse(),function t(){for(;i.length;){var n=i.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},a.values=M,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this.v=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(E),!t)for(var n in this)"t"===n.charAt(0)&&l.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=u)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function t(t,n){return o.type="throw",o.arg=e,i.next=t,n&&(i.method="next",i.arg=u),!!n}for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var a=l.call(r,"catchLoc"),s=l.call(r,"finallyLoc");if(a&&s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&l.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var o=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=n&&n<=r.finallyLoc?null:r)?r.completion:{};return o.type=t,o.arg=n,r?(this.method="next",this.next=r.finallyLoc,p):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),p},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),E(e),p}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e,i,r=this.tryEntries[n];if(r.tryLoc===t)return"throw"===(e=r.completion).type&&(i=e.arg,E(r)),i}throw Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:M(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=u),p}},a}function gt(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=pt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=pt(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==pt(t)?t:t+""))(i.key),i)}}var bt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_t={h:0,s:0,l:0},wt={h:0,s:0,l:0};function St(t,n,e){return e<0&&(e+=1),1<e&&--e,e<1/6?t+6*(n-t)*e:e<.5?n:e<2/3?t+6*(n-t)*(2/3-e):t}var N=(()=>{function i(t,n,e){if(this instanceof i)return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,n,e);throw new TypeError("Cannot call a class as a function")}return t=i,(n=[{key:"set",value:function(t,n,e){var i;return void 0===n&&void 0===e?(i=t)&&i.isColor?this.copy(i):"number"==typeof i?this.setHex(i):"string"==typeof i&&this.setStyle(i):this.setRGB(t,n,e),this}},{key:"setScalar",value:function(t){return this.r=t,this.g=t,this.b=t,this}},{key:"setHex",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:dt;return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,ct.toWorkingColorSpace(this,n),this}},{key:"setRGB",value:function(t,n,e){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:ct.workingColorSpace;return this.r=t,this.g=n,this.b=e,ct.toWorkingColorSpace(this,i),this}},{key:"setHSL",value:function(t,n,e){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:ct.workingColorSpace;return t=V(t,1),n=y(n,0,1),e=y(e,0,1),0===n?this.r=this.g=this.b=e:(this.r=St(n=2*e-(e=e<=.5?e*(1+n):e+n-e*n),e,t+1/3),this.g=St(n,e,t),this.b=St(n,e,t-1/3)),ct.toWorkingColorSpace(this,i),this}},{key:"setStyle",value:function(n){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:dt;function e(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+n+" will be ignored.")}if(a=/^(\w+)\(([^\)]*)\)/.exec(n)){var i,r=a[1],o=a[2];switch(r){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return e(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,t);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return e(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,t);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return e(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+n)}}else if(a=/^\#([A-Fa-f\d]+)$/.exec(n)){var r=a[1],a=r.length;if(3===a)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(6===a)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+n)}else if(n&&0<n.length)return this.setColorName(n,t);return this}},{key:"setColorName",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:dt,e=bt[t.toLowerCase()];return void 0!==e?this.setHex(e,n):console.warn("THREE.Color: Unknown color "+t),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}},{key:"copySRGBToLinear",value:function(t){return this.r=ft(t.r),this.g=ft(t.g),this.b=ft(t.b),this}},{key:"copyLinearToSRGB",value:function(t){return this.r=ht(t.r),this.g=ht(t.g),this.b=ht(t.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:dt;return ct.fromWorkingColorSpace(c.copy(this),t),65536*Math.round(y(255*c.r,0,255))+256*Math.round(y(255*c.g,0,255))+Math.round(y(255*c.b,0,255))}},{key:"getHexString",value:function(){return("000000"+this.getHex(0<arguments.length&&void 0!==arguments[0]?arguments[0]:dt).toString(16)).slice(-6)}},{key:"getHSL",value:function(t){var n,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:ct.workingColorSpace,i=(ct.fromWorkingColorSpace(c.copy(this),e),c.r),r=c.g,o=c.b,e=Math.max(i,r,o),a=Math.min(i,r,o),s=(a+e)/2;if(a===e)l=n=0;else{var u=e-a,l=s<=.5?u/(e+a):u/(2-e-a);switch(e){case i:n=(r-o)/u+(r<o?6:0);break;case r:n=(o-i)/u+2;break;case o:n=(i-r)/u+4}n/=6}return t.h=n,t.s=l,t.l=s,t}},{key:"getRGB",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:ct.workingColorSpace;return ct.fromWorkingColorSpace(c.copy(this),n),t.r=c.r,t.g=c.g,t.b=c.b,t}},{key:"getStyle",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:dt,n=(ct.fromWorkingColorSpace(c.copy(this),t),c.r),e=c.g,i=c.b;return t!==dt?"color(".concat(t," ").concat(n.toFixed(3)," ").concat(e.toFixed(3)," ").concat(i.toFixed(3),")"):"rgb(".concat(Math.round(255*n),",").concat(Math.round(255*e),",").concat(Math.round(255*i),")")}},{key:"offsetHSL",value:function(t,n,e){return this.getHSL(_t),this.setHSL(_t.h+t,_t.s+n,_t.l+e)}},{key:"add",value:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}},{key:"addColors",value:function(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}},{key:"addScalar",value:function(t){return this.r+=t,this.g+=t,this.b+=t,this}},{key:"sub",value:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}},{key:"multiply",value:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}},{key:"multiplyScalar",value:function(t){return this.r*=t,this.g*=t,this.b*=t,this}},{key:"lerp",value:function(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}},{key:"lerpColors",value:function(t,n,e){return this.r=t.r+(n.r-t.r)*e,this.g=t.g+(n.g-t.g)*e,this.b=t.b+(n.b-t.b)*e,this}},{key:"lerpHSL",value:function(t,n){this.getHSL(_t),t.getHSL(wt);var t=z(_t.h,wt.h,n),e=z(_t.s,wt.s,n),n=z(_t.l,wt.l,n);return this.setHSL(t,e,n),this}},{key:"setFromVector3",value:function(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}},{key:"applyMatrix3",value:function(t){var n=this.r,e=this.g,i=this.b,t=t.elements;return this.r=t[0]*n+t[3]*e+t[6]*i,this.g=t[1]*n+t[4]*e+t[7]*i,this.b=t[2]*n+t[5]*e+t[8]*i,this}},{key:"equals",value:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}},{key:"fromArray",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}},{key:"fromBufferAttribute",value:function(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),this}},{key:"toJSON",value:function(){return this.getHex()}},{key:Symbol.iterator,value:yt().mark(function t(){return yt().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.r;case 2:return t.next=4,this.g;case 4:return t.next=6,this.b;case 6:case"end":return t.stop()}},t,this)})}])&&gt(t.prototype,n),e&&gt(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,e})(),c=new N;function xt(t){return(xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function At(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=xt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=xt(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==xt(t)?t:t+""))(i.key),i)}}N.NAMES=bt;var Et=(()=>{function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")}return n=t,(e=[{key:"addEventListener",value:function(t,n){void 0===this.S&&(this.S={});var e=this.S;void 0===e[t]&&(e[t]=[]),-1===e[t].indexOf(n)&&e[t].push(n)}},{key:"hasEventListener",value:function(t,n){var e;return void 0!==this.S&&void 0!==(e=this.S)[t]&&-1!==e[t].indexOf(n)}},{key:"removeEventListener",value:function(t,n){var e;void 0!==this.S&&void 0!==(t=this.S[t])&&-1!==(e=t.indexOf(n))&&t.splice(e,1)}},{key:"dispatchEvent",value:function(t){if(void 0!==this.S){var n=this.S[t.type];if(void 0!==n){t.target=this;for(var e=n.slice(0),i=0,r=e.length;i<r;i++)e[i].call(this,t);t.target=null}}}}])&&At(n.prototype,e),i&&At(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,e,i})();function Tt(t){return(Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Mt(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Tt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Tt(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Tt(t)?t:t+""))(i.key),i)}}function Pt(t,n,e){n=Nt(n);var i=t,n=Ot()?Reflect.construct(n,e||[],Nt(t).constructor):n.apply(t,e);if(!n||"object"!=Tt(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Ot(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ot=function(){return!!t})()}function Nt(t){return(Nt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ct(t,n){return(Ct=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Lt=0,Rt=(()=>{function n(){var t;if(this instanceof n)return(t=Pt(this,n)).isMaterial=!0,Object.defineProperty(t,"id",{value:Lt++}),t.uuid=j(),t.name="",t.type="Material",t.blending=1,t.side=Y,t.vertexColors=!1,t.opacity=1,t.transparent=!1,t.alphaHash=!1,t.blendSrc=204,t.blendDst=205,t.blendEquation=100,t.blendSrcAlpha=null,t.blendDstAlpha=null,t.blendEquationAlpha=null,t.blendColor=new N(0,0,0),t.blendAlpha=0,t.depthFunc=3,t.depthTest=!0,t.depthWrite=!0,t.stencilWriteMask=255,t.stencilFunc=519,t.stencilRef=0,t.stencilFuncMask=255,t.stencilFail=tt,t.stencilZFail=tt,t.stencilZPass=tt,t.stencilWrite=!1,t.clippingPlanes=null,t.clipIntersection=!1,t.clipShadows=!1,t.shadowSide=null,t.colorWrite=!0,t.precision=null,t.polygonOffset=!1,t.polygonOffsetFactor=0,t.polygonOffsetUnits=0,t.dithering=!1,t.alphaToCoverage=!1,t.premultipliedAlpha=!1,t.forceSinglePass=!1,t.visible=!0,t.toneMapped=!0,t.userData={},t.version=0,t.A=vt,t;throw new TypeError("Cannot call a class as a function")}var t,e=n,i=Et;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Ct(e,i),e=n,(i=[{key:"alphaTest",get:function(){return this.A},set:function(t){0<this.A!=0<t&&this.version++,this.A=t}},{key:"onBeforeRender",value:function(){}},{key:"onBeforeCompile",value:function(){}},{key:"customProgramCacheKey",value:function(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function(t){if(void 0!==t)for(var n in t){var e,i=t[n];void 0===i?console.warn("THREE.Material: parameter '".concat(n,"' has value of undefined.")):void 0===(e=this[n])?console.warn("THREE.Material: '".concat(n,"' is not a property of THREE.").concat(this.type,".")):e&&e.isColor?e.set(i):e&&e.isVector3&&i&&i.isVector3?e.copy(i):this[n]=i}}},{key:"toJSON",value:function(t){var n=void 0===t||"string"==typeof t,e=(n&&(t={textures:{},images:{}}),{metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}});function i(t){var n,e=[];for(n in t){var i=t[n];delete i.metadata,e.push(i)}return e}return e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),this.color&&this.color.isColor&&(e.color=this.color.getHex()),void 0!==this.roughness&&(e.roughness=this.roughness),void 0!==this.metalness&&(e.metalness=this.metalness),void 0!==this.sheen&&(e.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(e.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(e.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(e.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(e.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(e.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(e.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(e.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(e.shininess=this.shininess),void 0!==this.clearcoat&&(e.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(e.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(e.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(e.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(e.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,e.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(e.dispersion=this.dispersion),void 0!==this.iridescence&&(e.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(e.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(e.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(e.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(e.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(e.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(e.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(e.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(e.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(e.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(e.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(e.lightMap=this.lightMap.toJSON(t).uuid,e.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(e.aoMap=this.aoMap.toJSON(t).uuid,e.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(e.bumpMap=this.bumpMap.toJSON(t).uuid,e.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(e.normalMap=this.normalMap.toJSON(t).uuid,e.normalMapType=this.normalMapType,e.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(e.displacementMap=this.displacementMap.toJSON(t).uuid,e.displacementScale=this.displacementScale,e.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(e.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(e.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(e.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(e.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(e.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(e.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(e.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine)&&(e.combine=this.combine),void 0!==this.envMapRotation&&(e.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(e.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(e.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(e.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(e.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(e.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(e.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(e.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(e.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(e.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(e.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(e.size=this.size),null!==this.shadowSide&&(e.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(e.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(e.blending=this.blending),this.side!==Y&&(e.side=this.side),!0===this.vertexColors&&(e.vertexColors=!0),this.opacity<1&&(e.opacity=this.opacity),!0===this.transparent&&(e.transparent=!0),204!==this.blendSrc&&(e.blendSrc=this.blendSrc),205!==this.blendDst&&(e.blendDst=this.blendDst),100!==this.blendEquation&&(e.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(e.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(e.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(e.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(e.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(e.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(e.depthFunc=this.depthFunc),!1===this.depthTest&&(e.depthTest=this.depthTest),!1===this.depthWrite&&(e.depthWrite=this.depthWrite),!1===this.colorWrite&&(e.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(e.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(e.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(e.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(e.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==tt&&(e.stencilFail=this.stencilFail),this.stencilZFail!==tt&&(e.stencilZFail=this.stencilZFail),this.stencilZPass!==tt&&(e.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(e.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(e.rotation=this.rotation),!0===this.polygonOffset&&(e.polygonOffset=!0),0!==this.polygonOffsetFactor&&(e.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(e.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(e.linewidth=this.linewidth),void 0!==this.dashSize&&(e.dashSize=this.dashSize),void 0!==this.gapSize&&(e.gapSize=this.gapSize),void 0!==this.scale&&(e.scale=this.scale),!0===this.dithering&&(e.dithering=!0),0<this.alphaTest&&(e.alphaTest=this.alphaTest),!0===this.alphaHash&&(e.alphaHash=!0),!0===this.alphaToCoverage&&(e.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(e.premultipliedAlpha=!0),!0===this.forceSinglePass&&(e.forceSinglePass=!0),!0===this.wireframe&&(e.wireframe=!0),1<this.wireframeLinewidth&&(e.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(e.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(e.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(e.flatShading=!0),!1===this.visible&&(e.visible=!1),!1===this.toneMapped&&(e.toneMapped=!1),!1===this.fog&&(e.fog=!1),0<Object.keys(this.userData).length&&(e.userData=this.userData),n&&(n=i(t.textures),t=i(t.images),0<n.length&&(e.textures=n),0<t.length)&&(e.images=t),e}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var n=t.clippingPlanes,e=null;if(null!==n)for(var i=n.length,e=new Array(i),r=0;r!==i;++r)e[r]=n[r].clone();return this.clippingPlanes=e,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"needsUpdate",set:function(t){!0===t&&this.version++}},{key:"onBuild",value:function(){console.warn("Material: onBuild() has been removed.")}}])&&Mt(e.prototype,i),t&&Mt(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e})();function Dt(t){return(Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ft(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Dt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Dt(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Dt(t)?t:t+""))(i.key),i)}}function It(t,n,e){n=Ut(n);var i=t,n=kt()?Reflect.construct(n,e||[],Ut(t).constructor):n.apply(t,e);if(!n||"object"!=Dt(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function kt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(kt=function(){return!!t})()}function jt(){return(jt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=Ut(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function Ut(t){return(Ut=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Bt(t,n){return(Bt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Ht=(()=>{function a(t){var n;if(this instanceof a)return(n=It(this,a)).isPointsMaterial=!0,n.type="PointsMaterial",n.color=new N(16777215),n.map=null,n.alphaMap=null,n.size=1,n.sizeAttenuation=!0,n.fog=!0,n.setValues(t),n;throw new TypeError("Cannot call a class as a function")}var t,n=a,e=Rt;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Bt(n,e),n=a,(e=[{key:"copy",value:function(t){var n,e,i,r,o;return n=a,e="copy",i=this,o=jt(Ut(1&(r=3)?n.prototype:n),e,i),(2&r&&"function"==typeof o?function(t){return o.apply(i,t)}:o)([t]),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}])&&Ft(n.prototype,e),t&&Ft(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Vt(t){return(Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zt(){zt=function(){return a};var u,a={},t=Object.prototype,l=t.hasOwnProperty,c=Object.defineProperty||function(t,n,e){t[n]=e.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",e=n.asyncIterator||"@@asyncIterator",r=n.toStringTag||"@@toStringTag";function o(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{o({},"")}catch(u){o=function(t,n,e){return t[n]=e}}function s(t,n,e,i){var r,o,a,s,n=n&&n.prototype instanceof y?n:y,n=Object.create(n.prototype),i=new T(i||[]);return c(n,"_invoke",{value:(r=t,o=e,a=i,s=h,function(t,n){if(s===d)throw Error("Generator is already running");if(s===m){if("throw"===t)throw n;return{value:u,done:!0}}for(a.method=t,a.arg=n;;){var e=a.delegate;if(e){e=function t(n,e){var i=e.method,r=n.iterator[i];if(r===u)return e.delegate=null,"throw"===i&&n.iterator.return&&(e.method="return",e.arg=u,t(n,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),p;i=f(r,n.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,p;r=i.arg;return r?r.done?(e[n.resultName]=r.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=u),e.delegate=null,p):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}(e,a);if(e){if(e===p)continue;return e}}if("next"===a.method)a.sent=a.v=a.arg;else if("throw"===a.method){if(s===h)throw s=m,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s=d;e=f(r,o,a);if("normal"===e.type){if(s=a.done?m:v,e.arg===p)continue;return{value:e.arg,done:a.done}}"throw"===e.type&&(s=m,a.method="throw",a.arg=e.arg)}})}),n}function f(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}a.wrap=s;var h="suspendedStart",v="suspendedYield",d="executing",m="completed",p={};function y(){}function g(){}function b(){}var n={},_=(o(n,i,function(){return this}),Object.getPrototypeOf),_=_&&_(_(M([]))),w=(_&&_!==t&&l.call(_,i)&&(n=_),b.prototype=y.prototype=Object.create(n));function S(t){["next","throw","return"].forEach(function(n){o(t,n,function(t){return this._invoke(n,t)})})}function x(a,s){var n;c(this,"_invoke",{value:function(e,i){function t(){return new s(function(t,n){!function n(t,e,i,r){var o,t=f(a[t],a,e);if("throw"!==t.type)return(e=(o=t.arg).value)&&"object"==Vt(e)&&l.call(e,"__await")?s.resolve(e._).then(function(t){n("next",t,i,r)},function(t){n("throw",t,i,r)}):s.resolve(e).then(function(t){o.value=t,i(o)},function(t){return n("throw",t,i,r)});r(t.arg)}(e,i,t,n)})}return n=n?n.then(t,t):t()}})}function A(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function E(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function M(n){if(n||""===n){var e,t=n[i];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return e=-1,(t=function t(){for(;++e<n.length;)if(l.call(n,e))return t.value=n[e],t.done=!1,t;return t.value=u,t.done=!0,t}).next=t}throw new TypeError(Vt(n)+" is not iterable")}return c(w,"constructor",{value:g.prototype=b,configurable:!0}),c(b,"constructor",{value:g,configurable:!0}),g.displayName=o(b,r,"GeneratorFunction"),a.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,o(t,r,"GeneratorFunction")),t.prototype=Object.create(w),t},a.awrap=function(t){return{_:t}},S(x.prototype),o(x.prototype,e,function(){return this}),a.AsyncIterator=x,a.async=function(t,n,e,i,r){void 0===r&&(r=Promise);var o=new x(s(t,n,e,i),r);return a.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},S(w),o(w,r,"Generator"),o(w,i,function(){return this}),o(w,"toString",function(){return"[object Generator]"}),a.keys=function(t){var n,e=Object(t),i=[];for(n in e)i.push(n);return i.reverse(),function t(){for(;i.length;){var n=i.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},a.values=M,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this.v=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(E),!t)for(var n in this)"t"===n.charAt(0)&&l.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=u)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function t(t,n){return o.type="throw",o.arg=e,i.next=t,n&&(i.method="next",i.arg=u),!!n}for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var a=l.call(r,"catchLoc"),s=l.call(r,"finallyLoc");if(a&&s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&l.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var o=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=n&&n<=r.finallyLoc?null:r)?r.completion:{};return o.type=t,o.arg=n,r?(this.method="next",this.next=r.finallyLoc,p):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),p},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),E(e),p}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e,i,r=this.tryEntries[n];if(r.tryLoc===t)return"throw"===(e=r.completion).type&&(i=e.arg,E(r)),i}throw Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:M(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=u),p}},a}function Gt(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Vt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Vt(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Vt(t)?t:t+""))(i.key),i)}}var Xt=(()=>{return t=function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,o=this,a=t;if(!(o instanceof a))throw new TypeError("Cannot call a class as a function");this.isQuaternion=!0,this.T=n,this.M=e,this.P=i,this.O=r},n=[{key:"x",get:function(){return this.T},set:function(t){this.T=t,this.N()}},{key:"y",get:function(){return this.M},set:function(t){this.M=t,this.N()}},{key:"z",get:function(){return this.P},set:function(t){this.P=t,this.N()}},{key:"w",get:function(){return this.O},set:function(t){this.O=t,this.N()}},{key:"set",value:function(t,n,e,i){return this.T=t,this.M=n,this.P=e,this.O=i,this.N(),this}},{key:"clone",value:function(){return new this.constructor(this.T,this.M,this.P,this.O)}},{key:"copy",value:function(t){return this.T=t.x,this.M=t.y,this.P=t.z,this.O=t.w,this.N(),this}},{key:"setFromEuler",value:function(t){var n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],e=t.T,i=t.M,r=t.P,o=t.C,t=Math.cos,a=Math.sin,s=t(e/2),u=t(i/2),l=t(r/2),c=a(e/2),f=a(i/2),h=a(r/2);switch(o){case"XYZ":this.T=c*u*l+s*f*h,this.M=s*f*l-c*u*h,this.P=s*u*h+c*f*l,this.O=s*u*l-c*f*h;break;case"YXZ":this.T=c*u*l+s*f*h,this.M=s*f*l-c*u*h,this.P=s*u*h-c*f*l,this.O=s*u*l+c*f*h;break;case"ZXY":this.T=c*u*l-s*f*h,this.M=s*f*l+c*u*h,this.P=s*u*h+c*f*l,this.O=s*u*l-c*f*h;break;case"ZYX":this.T=c*u*l-s*f*h,this.M=s*f*l+c*u*h,this.P=s*u*h-c*f*l,this.O=s*u*l+c*f*h;break;case"YZX":this.T=c*u*l+s*f*h,this.M=s*f*l+c*u*h,this.P=s*u*h-c*f*l,this.O=s*u*l-c*f*h;break;case"XZY":this.T=c*u*l-s*f*h,this.M=s*f*l-c*u*h,this.P=s*u*h+c*f*l,this.O=s*u*l+c*f*h;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!0===n&&this.N(),this}},{key:"setFromAxisAngle",value:function(t,n){var n=n/2,e=Math.sin(n);return this.T=t.x*e,this.M=t.y*e,this.P=t.z*e,this.O=Math.cos(n),this.N(),this}},{key:"setFromRotationMatrix",value:function(t){var t=t.elements,n=t[0],e=t[4],i=t[8],r=t[1],o=t[5],a=t[9],s=t[2],u=t[6],t=t[10],l=n+o+t;return 0<l?(l=.5/Math.sqrt(l+1),this.O=.25/l,this.T=(u-a)*l,this.M=(i-s)*l,this.P=(r-e)*l):o<n&&t<n?(l=2*Math.sqrt(1+n-o-t),this.O=(u-a)/l,this.T=.25*l,this.M=(e+r)/l,this.P=(i+s)/l):t<o?(l=2*Math.sqrt(1+o-n-t),this.O=(i-s)/l,this.T=(e+r)/l,this.M=.25*l,this.P=(a+u)/l):(l=2*Math.sqrt(1+t-n-o),this.O=(r-e)/l,this.T=(i+s)/l,this.M=(a+u)/l,this.P=.25*l),this.N(),this}},{key:"setFromUnitVectors",value:function(t,n){var e=t.dot(n)+1;return e<Number.EPSILON?(e=0,Math.abs(t.x)>Math.abs(t.z)?(this.T=-t.y,this.M=t.x,this.P=0):(this.T=0,this.M=-t.z,this.P=t.y)):(this.T=t.y*n.z-t.z*n.y,this.M=t.z*n.x-t.x*n.z,this.P=t.x*n.y-t.y*n.x),this.O=e,this.normalize()}},{key:"angleTo",value:function(t){return 2*Math.acos(Math.abs(y(this.dot(t),-1,1)))}},{key:"rotateTowards",value:function(t,n){var e=this.angleTo(t);return 0!==e&&(n=Math.min(1,n/e),this.slerp(t,n)),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this.T*=-1,this.M*=-1,this.P*=-1,this.N(),this}},{key:"dot",value:function(t){return this.T*t.T+this.M*t.M+this.P*t.P+this.O*t.O}},{key:"lengthSq",value:function(){return this.T*this.T+this.M*this.M+this.P*this.P+this.O*this.O}},{key:"length",value:function(){return Math.sqrt(this.T*this.T+this.M*this.M+this.P*this.P+this.O*this.O)}},{key:"normalize",value:function(){var t=this.length();return 0===t?(this.T=0,this.M=0,this.P=0,this.O=1):(this.T=this.T*(t=1/t),this.M=this.M*t,this.P=this.P*t,this.O=this.O*t),this.N(),this}},{key:"multiply",value:function(t){return this.multiplyQuaternions(this,t)}},{key:"premultiply",value:function(t){return this.multiplyQuaternions(t,this)}},{key:"multiplyQuaternions",value:function(t,n){var e=t.T,i=t.M,r=t.P,t=t.O,o=n.T,a=n.M,s=n.P,n=n.O;return this.T=e*n+t*o+i*s-r*a,this.M=i*n+t*a+r*o-e*s,this.P=r*n+t*s+e*a-i*o,this.O=t*n-e*o-i*a-r*s,this.N(),this}},{key:"slerp",value:function(t,n){if(0!==n){if(1===n)return this.copy(t);var e,i=this.T,r=this.M,o=this.P,a=this.O,s=a*t.O+i*t.T+r*t.M+o*t.P;s<0?(this.O=-t.O,this.T=-t.T,this.M=-t.M,this.P=-t.P,s=-s):this.copy(t),1<=s?(this.O=a,this.T=i,this.M=r,this.P=o):(t=1-s*s)<=Number.EPSILON?(this.O=(e=1-n)*a+n*this.O,this.T=e*i+n*this.T,this.M=e*r+n*this.M,this.P=e*o+n*this.P,this.normalize()):(e=Math.sqrt(t),t=Math.atan2(e,s),s=Math.sin((1-n)*t)/e,n=Math.sin(n*t)/e,this.O=a*s+this.O*n,this.T=i*s+this.T*n,this.M=r*s+this.M*n,this.P=o*s+this.P*n,this.N())}return this}},{key:"slerpQuaternions",value:function(t,n,e){return this.copy(t).slerp(n,e)}},{key:"random",value:function(){var t=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),e=Math.random(),i=Math.sqrt(1-e),e=Math.sqrt(e);return this.set(i*Math.sin(t),i*Math.cos(t),e*Math.sin(n),e*Math.cos(n))}},{key:"equals",value:function(t){return t.T===this.T&&t.M===this.M&&t.P===this.P&&t.O===this.O}},{key:"fromArray",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.T=t[n],this.M=t[n+1],this.P=t[n+2],this.O=t[n+3],this.N(),this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return t[n]=this.T,t[n+1]=this.M,t[n+2]=this.P,t[n+3]=this.O,t}},{key:"fromBufferAttribute",value:function(t,n){return this.T=t.getX(n),this.M=t.getY(n),this.P=t.getZ(n),this.O=t.getW(n),this.N(),this}},{key:"toJSON",value:function(){return this.toArray()}},{key:"_onChange",value:function(t){return this.N=t,this}},{key:"_onChangeCallback",value:function(){}},{key:Symbol.iterator,value:zt().mark(function t(){return zt().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.T;case 2:return t.next=4,this.M;case 4:return t.next=6,this.P;case 6:return t.next=8,this.O;case 8:case"end":return t.stop()}},t,this)})}],e=[{key:"slerpFlat",value:function(t,n,e,i,r,o,a){var s,u,l,c=e[i+0],f=e[i+1],h=e[i+2],e=e[i+3],i=r[o+0],v=r[o+1],d=r[o+2],r=r[o+3];0===a?(t[n+0]=c,t[n+1]=f,t[n+2]=h,t[n+3]=e):1===a?(t[n+0]=i,t[n+1]=v,t[n+2]=d,t[n+3]=r):(e===r&&c===i&&f===v&&h===d||(o=1-a,s=0<=(u=c*i+f*v+h*d+e*r)?1:-1,(l=1-u*u)>Number.EPSILON&&(l=Math.sqrt(l),u=Math.atan2(l,u*s),o=Math.sin(o*u)/l,a=Math.sin(a*u)/l),c=c*o+i*(u=a*s),f=f*o+v*u,h=h*o+d*u,e=e*o+r*u,o===1-a&&(c*=l=1/Math.sqrt(c*c+f*f+h*h+e*e),f*=l,h*=l,e*=l)),t[n]=c,t[n+1]=f,t[n+2]=h,t[n+3]=e)}},{key:"multiplyQuaternionsFlat",value:function(t,n,e,i,r,o){var a=e[i],s=e[i+1],u=e[i+2],e=e[i+3],i=r[o],l=r[o+1],c=r[o+2],r=r[o+3];return t[n]=a*r+e*i+s*c-u*l,t[n+1]=s*r+e*l+u*i-a*c,t[n+2]=u*r+e*c+a*l-s*i,t[n+3]=e*r-a*i-s*l-u*c,t}}],n&&Gt(t.prototype,n),e&&Gt(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,e})();function Yt(t){return(Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wt(){Wt=function(){return a};var u,a={},t=Object.prototype,l=t.hasOwnProperty,c=Object.defineProperty||function(t,n,e){t[n]=e.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",e=n.asyncIterator||"@@asyncIterator",r=n.toStringTag||"@@toStringTag";function o(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{o({},"")}catch(u){o=function(t,n,e){return t[n]=e}}function s(t,n,e,i){var r,o,a,s,n=n&&n.prototype instanceof y?n:y,n=Object.create(n.prototype),i=new T(i||[]);return c(n,"_invoke",{value:(r=t,o=e,a=i,s=h,function(t,n){if(s===d)throw Error("Generator is already running");if(s===m){if("throw"===t)throw n;return{value:u,done:!0}}for(a.method=t,a.arg=n;;){var e=a.delegate;if(e){e=function t(n,e){var i=e.method,r=n.iterator[i];if(r===u)return e.delegate=null,"throw"===i&&n.iterator.return&&(e.method="return",e.arg=u,t(n,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),p;i=f(r,n.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,p;r=i.arg;return r?r.done?(e[n.resultName]=r.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=u),e.delegate=null,p):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}(e,a);if(e){if(e===p)continue;return e}}if("next"===a.method)a.sent=a.v=a.arg;else if("throw"===a.method){if(s===h)throw s=m,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s=d;e=f(r,o,a);if("normal"===e.type){if(s=a.done?m:v,e.arg===p)continue;return{value:e.arg,done:a.done}}"throw"===e.type&&(s=m,a.method="throw",a.arg=e.arg)}})}),n}function f(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}a.wrap=s;var h="suspendedStart",v="suspendedYield",d="executing",m="completed",p={};function y(){}function g(){}function b(){}var n={},_=(o(n,i,function(){return this}),Object.getPrototypeOf),_=_&&_(_(M([]))),w=(_&&_!==t&&l.call(_,i)&&(n=_),b.prototype=y.prototype=Object.create(n));function S(t){["next","throw","return"].forEach(function(n){o(t,n,function(t){return this._invoke(n,t)})})}function x(a,s){var n;c(this,"_invoke",{value:function(e,i){function t(){return new s(function(t,n){!function n(t,e,i,r){var o,t=f(a[t],a,e);if("throw"!==t.type)return(e=(o=t.arg).value)&&"object"==Yt(e)&&l.call(e,"__await")?s.resolve(e._).then(function(t){n("next",t,i,r)},function(t){n("throw",t,i,r)}):s.resolve(e).then(function(t){o.value=t,i(o)},function(t){return n("throw",t,i,r)});r(t.arg)}(e,i,t,n)})}return n=n?n.then(t,t):t()}})}function A(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function E(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function M(n){if(n||""===n){var e,t=n[i];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return e=-1,(t=function t(){for(;++e<n.length;)if(l.call(n,e))return t.value=n[e],t.done=!1,t;return t.value=u,t.done=!0,t}).next=t}throw new TypeError(Yt(n)+" is not iterable")}return c(w,"constructor",{value:g.prototype=b,configurable:!0}),c(b,"constructor",{value:g,configurable:!0}),g.displayName=o(b,r,"GeneratorFunction"),a.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,o(t,r,"GeneratorFunction")),t.prototype=Object.create(w),t},a.awrap=function(t){return{_:t}},S(x.prototype),o(x.prototype,e,function(){return this}),a.AsyncIterator=x,a.async=function(t,n,e,i,r){void 0===r&&(r=Promise);var o=new x(s(t,n,e,i),r);return a.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},S(w),o(w,r,"Generator"),o(w,i,function(){return this}),o(w,"toString",function(){return"[object Generator]"}),a.keys=function(t){var n,e=Object(t),i=[];for(n in e)i.push(n);return i.reverse(),function t(){for(;i.length;){var n=i.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},a.values=M,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this.v=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(E),!t)for(var n in this)"t"===n.charAt(0)&&l.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=u)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function t(t,n){return o.type="throw",o.arg=e,i.next=t,n&&(i.method="next",i.arg=u),!!n}for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var a=l.call(r,"catchLoc"),s=l.call(r,"finallyLoc");if(a&&s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&l.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var o=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=n&&n<=r.finallyLoc?null:r)?r.completion:{};return o.type=t,o.arg=n,r?(this.method="next",this.next=r.finallyLoc,p):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),p},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),E(e),p}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e,i,r=this.tryEntries[n];if(r.tryLoc===t)return"throw"===(e=r.completion).type&&(i=e.arg,E(r)),i}throw Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:M(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=u),p}},a}function Qt(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Yt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Yt(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Yt(t)?t:t+""))(i.key),i)}}var U=(()=>{function o(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=this,r=o;if(!(i instanceof r))throw new TypeError("Cannot call a class as a function");o.prototype.isVector3=!0,this.x=t,this.y=n,this.z=e}return t=o,(n=[{key:"set",value:function(t,n,e){return void 0===e&&(e=this.z),this.x=t,this.y=n,this.z=e,this}},{key:"setScalar",value:function(t){return this.x=t,this.y=t,this.z=t,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setZ",value:function(t){return this.z=t,this}},{key:"setComponent",value:function(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+t)}return this}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this.z=t.z+n.z,this}},{key:"addScaledVector",value:function(t,n){return this.x+=t.x*n,this.y+=t.y*n,this.z+=t.z*n,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this.z=t.z-n.z,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"multiplyVectors",value:function(t,n){return this.x=t.x*n.x,this.y=t.y*n.y,this.z=t.z*n.z,this}},{key:"applyEuler",value:function(t){return this.applyQuaternion(Zt.setFromEuler(t))}},{key:"applyAxisAngle",value:function(t,n){return this.applyQuaternion(Zt.setFromAxisAngle(t,n))}},{key:"applyMatrix3",value:function(t){var n=this.x,e=this.y,i=this.z,t=t.elements;return this.x=t[0]*n+t[3]*e+t[6]*i,this.y=t[1]*n+t[4]*e+t[7]*i,this.z=t[2]*n+t[5]*e+t[8]*i,this}},{key:"applyNormalMatrix",value:function(t){return this.applyMatrix3(t).normalize()}},{key:"applyMatrix4",value:function(t){var n=this.x,e=this.y,i=this.z,t=t.elements,r=1/(t[3]*n+t[7]*e+t[11]*i+t[15]);return this.x=(t[0]*n+t[4]*e+t[8]*i+t[12])*r,this.y=(t[1]*n+t[5]*e+t[9]*i+t[13])*r,this.z=(t[2]*n+t[6]*e+t[10]*i+t[14])*r,this}},{key:"applyQuaternion",value:function(t){var n=this.x,e=this.y,i=this.z,r=t.x,o=t.y,a=t.z,t=t.w,s=2*(o*i-a*e),u=2*(a*n-r*i),l=2*(r*e-o*n);return this.x=n+t*s+o*l-a*u,this.y=e+t*u+a*s-r*l,this.z=i+t*l+r*u-o*s,this}},{key:"project",value:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}},{key:"unproject",value:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}},{key:"transformDirection",value:function(t){var n=this.x,e=this.y,i=this.z,t=t.elements;return this.x=t[0]*n+t[4]*e+t[8]*i,this.y=t[1]*n+t[5]*e+t[9]*i,this.z=t[2]*n+t[6]*e+t[10]*i,this.normalize()}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clamp",value:function(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this.z=Math.max(t.z,Math.min(n.z,this.z)),this}},{key:"clampScalar",value:function(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this.z=Math.max(t,Math.min(n,this.z)),this}},{key:"clampLength",value:function(t,n){var e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(n,e)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"lerp",value:function(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this.z+=(t.z-this.z)*n,this}},{key:"lerpVectors",value:function(t,n,e){return this.x=t.x+(n.x-t.x)*e,this.y=t.y+(n.y-t.y)*e,this.z=t.z+(n.z-t.z)*e,this}},{key:"cross",value:function(t){return this.crossVectors(this,t)}},{key:"crossVectors",value:function(t,n){var e=t.x,i=t.y,t=t.z,r=n.x,o=n.y,n=n.z;return this.x=i*n-t*o,this.y=t*r-e*n,this.z=e*o-i*r,this}},{key:"projectOnVector",value:function(t){var n=t.lengthSq();return 0===n?this.set(0,0,0):(n=t.dot(this)/n,this.copy(t).multiplyScalar(n))}},{key:"projectOnPlane",value:function(t){return qt.copy(this).projectOnVector(t),this.sub(qt)}},{key:"reflect",value:function(t){return this.sub(qt.copy(t).multiplyScalar(2*this.dot(t)))}},{key:"angleTo",value:function(t){var n=Math.sqrt(this.lengthSq()*t.lengthSq());return 0===n?Math.PI/2:(t=this.dot(t)/n,Math.acos(y(t,-1,1)))}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){var n=this.x-t.x,e=this.y-t.y,t=this.z-t.z;return n*n+e*e+t*t}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}},{key:"setFromSpherical",value:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}},{key:"setFromSphericalCoords",value:function(t,n,e){var i=Math.sin(n)*t;return this.x=i*Math.sin(e),this.y=Math.cos(n)*t,this.z=i*Math.cos(e),this}},{key:"setFromCylindrical",value:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}},{key:"setFromCylindricalCoords",value:function(t,n,e){return this.x=t*Math.sin(n),this.y=e,this.z=t*Math.cos(n),this}},{key:"setFromMatrixPosition",value:function(t){t=t.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(t){var n=this.setFromMatrixColumn(t,0).length(),e=this.setFromMatrixColumn(t,1).length(),t=this.setFromMatrixColumn(t,2).length();return this.x=n,this.y=e,this.z=t,this}},{key:"setFromMatrixColumn",value:function(t,n){return this.fromArray(t.elements,4*n)}},{key:"setFromMatrix3Column",value:function(t,n){return this.fromArray(t.elements,3*n)}},{key:"setFromEuler",value:function(t){return this.x=t.T,this.y=t.M,this.z=t.P,this}},{key:"setFromColor",value:function(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}},{key:"fromArray",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[n],this.y=t[n+1],this.z=t[n+2],this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return t[n]=this.x,t[n+1]=this.y,t[n+2]=this.z,t}},{key:"fromBufferAttribute",value:function(t,n){return this.x=t.getX(n),this.y=t.getY(n),this.z=t.getZ(n),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}},{key:"randomDirection",value:function(){var t=Math.random()*Math.PI*2,n=2*Math.random()-1,e=Math.sqrt(1-n*n);return this.x=e*Math.cos(t),this.y=n,this.z=e*Math.sin(t),this}},{key:Symbol.iterator,value:Wt().mark(function t(){return Wt().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.x;case 2:return t.next=4,this.y;case 4:return t.next=6,this.z;case 6:case"end":return t.stop()}},t,this)})}])&&Qt(t.prototype,n),e&&Qt(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,e})(),qt=new U,Zt=new Xt;function Jt(t){return(Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Kt(){Kt=function(){return a};var u,a={},t=Object.prototype,l=t.hasOwnProperty,c=Object.defineProperty||function(t,n,e){t[n]=e.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",e=n.asyncIterator||"@@asyncIterator",r=n.toStringTag||"@@toStringTag";function o(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{o({},"")}catch(u){o=function(t,n,e){return t[n]=e}}function s(t,n,e,i){var r,o,a,s,n=n&&n.prototype instanceof y?n:y,n=Object.create(n.prototype),i=new T(i||[]);return c(n,"_invoke",{value:(r=t,o=e,a=i,s=h,function(t,n){if(s===d)throw Error("Generator is already running");if(s===m){if("throw"===t)throw n;return{value:u,done:!0}}for(a.method=t,a.arg=n;;){var e=a.delegate;if(e){e=function t(n,e){var i=e.method,r=n.iterator[i];if(r===u)return e.delegate=null,"throw"===i&&n.iterator.return&&(e.method="return",e.arg=u,t(n,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),p;i=f(r,n.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,p;r=i.arg;return r?r.done?(e[n.resultName]=r.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=u),e.delegate=null,p):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}(e,a);if(e){if(e===p)continue;return e}}if("next"===a.method)a.sent=a.v=a.arg;else if("throw"===a.method){if(s===h)throw s=m,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s=d;e=f(r,o,a);if("normal"===e.type){if(s=a.done?m:v,e.arg===p)continue;return{value:e.arg,done:a.done}}"throw"===e.type&&(s=m,a.method="throw",a.arg=e.arg)}})}),n}function f(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}a.wrap=s;var h="suspendedStart",v="suspendedYield",d="executing",m="completed",p={};function y(){}function g(){}function b(){}var n={},_=(o(n,i,function(){return this}),Object.getPrototypeOf),_=_&&_(_(M([]))),w=(_&&_!==t&&l.call(_,i)&&(n=_),b.prototype=y.prototype=Object.create(n));function S(t){["next","throw","return"].forEach(function(n){o(t,n,function(t){return this._invoke(n,t)})})}function x(a,s){var n;c(this,"_invoke",{value:function(e,i){function t(){return new s(function(t,n){!function n(t,e,i,r){var o,t=f(a[t],a,e);if("throw"!==t.type)return(e=(o=t.arg).value)&&"object"==Jt(e)&&l.call(e,"__await")?s.resolve(e._).then(function(t){n("next",t,i,r)},function(t){n("throw",t,i,r)}):s.resolve(e).then(function(t){o.value=t,i(o)},function(t){return n("throw",t,i,r)});r(t.arg)}(e,i,t,n)})}return n=n?n.then(t,t):t()}})}function A(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function E(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function M(n){if(n||""===n){var e,t=n[i];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return e=-1,(t=function t(){for(;++e<n.length;)if(l.call(n,e))return t.value=n[e],t.done=!1,t;return t.value=u,t.done=!0,t}).next=t}throw new TypeError(Jt(n)+" is not iterable")}return c(w,"constructor",{value:g.prototype=b,configurable:!0}),c(b,"constructor",{value:g,configurable:!0}),g.displayName=o(b,r,"GeneratorFunction"),a.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,o(t,r,"GeneratorFunction")),t.prototype=Object.create(w),t},a.awrap=function(t){return{_:t}},S(x.prototype),o(x.prototype,e,function(){return this}),a.AsyncIterator=x,a.async=function(t,n,e,i,r){void 0===r&&(r=Promise);var o=new x(s(t,n,e,i),r);return a.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},S(w),o(w,r,"Generator"),o(w,i,function(){return this}),o(w,"toString",function(){return"[object Generator]"}),a.keys=function(t){var n,e=Object(t),i=[];for(n in e)i.push(n);return i.reverse(),function t(){for(;i.length;){var n=i.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},a.values=M,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this.v=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(E),!t)for(var n in this)"t"===n.charAt(0)&&l.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=u)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function t(t,n){return o.type="throw",o.arg=e,i.next=t,n&&(i.method="next",i.arg=u),!!n}for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var a=l.call(r,"catchLoc"),s=l.call(r,"finallyLoc");if(a&&s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&l.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var o=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=n&&n<=r.finallyLoc?null:r)?r.completion:{};return o.type=t,o.arg=n,r?(this.method="next",this.next=r.finallyLoc,p):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),p},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),E(e),p}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e,i,r=this.tryEntries[n];if(r.tryLoc===t)return"throw"===(e=r.completion).type&&(i=e.arg,E(r)),i}throw Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:M(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=u),p}},a}function $t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Jt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Jt(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Jt(t)?t:t+""))(i.key),i)}}var B=(()=>{function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,e=this,i=r;if(!(e instanceof i))throw new TypeError("Cannot call a class as a function");r.prototype.isVector2=!0,this.x=t,this.y=n}return t=r,(n=[{key:"width",get:function(){return this.x},set:function(t){this.x=t}},{key:"height",get:function(){return this.y},set:function(t){this.y=t}},{key:"set",value:function(t,n){return this.x=t,this.y=n,this}},{key:"setScalar",value:function(t){return this.x=t,this.y=t,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setComponent",value:function(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this}},{key:"addVectors",value:function(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}},{key:"addScaledVector",value:function(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this}},{key:"subVectors",value:function(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"applyMatrix3",value:function(t){var n=this.x,e=this.y,t=t.elements;return this.x=t[0]*n+t[3]*e+t[6],this.y=t[1]*n+t[4]*e+t[7],this}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}},{key:"clamp",value:function(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this}},{key:"clampScalar",value:function(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this}},{key:"clampLength",value:function(t,n){var e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(n,e)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){return Math.atan2(-this.y,-this.x)+Math.PI}},{key:"angleTo",value:function(t){var n=Math.sqrt(this.lengthSq()*t.lengthSq());return 0===n?Math.PI/2:(t=this.dot(t)/n,Math.acos(y(t,-1,1)))}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){var n=this.x-t.x,t=this.y-t.y;return n*n+t*t}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"lerp",value:function(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}},{key:"lerpVectors",value:function(t,n,e){return this.x=t.x+(n.x-t.x)*e,this.y=t.y+(n.y-t.y)*e,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y}},{key:"fromArray",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[n],this.y=t[n+1],this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return t[n]=this.x,t[n+1]=this.y,t}},{key:"fromBufferAttribute",value:function(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}},{key:"rotateAround",value:function(t,n){var e=Math.cos(n),n=Math.sin(n),i=this.x-t.x,r=this.y-t.y;return this.x=i*e-r*n+t.x,this.y=i*n+r*e+t.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:Symbol.iterator,value:Kt().mark(function t(){return Kt().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.x;case 2:return t.next=4,this.y;case 4:case"end":return t.stop()}},t,this)})}])&&$t(t.prototype,n),e&&$t(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,e})();function tn(t){return(tn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nn(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=tn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=tn(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==tn(t)?t:t+""))(i.key),i)}}var en=(()=>{return t=function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new U(1/0,1/0,1/0),e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new U(-1/0,-1/0,-1/0),i=this,r=t;if(!(i instanceof r))throw new TypeError("Cannot call a class as a function");this.isBox3=!0,this.min=n,this.max=e},(n=[{key:"set",value:function(t,n){return this.min.copy(t),this.max.copy(n),this}},{key:"setFromArray",value:function(t){this.makeEmpty();for(var n=0,e=t.length;n<e;n+=3)this.expandByPoint(on.fromArray(t,n));return this}},{key:"setFromBufferAttribute",value:function(t){this.makeEmpty();for(var n=0,e=t.count;n<e;n++)this.expandByPoint(on.fromBufferAttribute(t,n));return this}},{key:"setFromPoints",value:function(t){this.makeEmpty();for(var n=0,e=t.length;n<e;n++)this.expandByPoint(t[n]);return this}},{key:"setFromCenterAndSize",value:function(t,n){n=on.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}},{key:"setFromObject",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(t,n)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"expandByObject",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],e=(t.updateWorldMatrix(!1,!1),t.geometry);if(void 0!==e){var i=e.getAttribute("position");if(!0===n&&void 0!==i&&!0!==t.isInstancedMesh)for(var r=0,o=i.count;r<o;r++)!0===t.isMesh?t.getVertexPosition(r,on):on.fromBufferAttribute(i,r),on.applyMatrix4(t.matrixWorld),this.expandByPoint(on);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),an.copy(t.boundingBox)):(null===e.boundingBox&&e.computeBoundingBox(),an.copy(e.boundingBox)),an.applyMatrix4(t.matrixWorld),this.union(an)}for(var a=t.children,s=0,u=a.length;s<u;s++)this.expandByObject(a[s],n);return this}},{key:"containsPoint",value:function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}},{key:"containsBox",value:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}},{key:"getParameter",value:function(t,n){return n.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}},{key:"intersectsSphere",value:function(t){return this.clampPoint(t.center,on),on.distanceToSquared(t.center)<=t.radius*t.radius}},{key:"intersectsPlane",value:function(t){var n,e=0<t.normal.x?(n=t.normal.x*this.min.x,t.normal.x*this.max.x):(n=t.normal.x*this.max.x,t.normal.x*this.min.x);return 0<t.normal.y?(n+=t.normal.y*this.min.y,e+=t.normal.y*this.max.y):(n+=t.normal.y*this.max.y,e+=t.normal.y*this.min.y),0<t.normal.z?(n+=t.normal.z*this.min.z,e+=t.normal.z*this.max.z):(n+=t.normal.z*this.max.z,e+=t.normal.z*this.min.z),n<=-t.constant&&e>=-t.constant}},{key:"intersectsTriangle",value:function(t){return!this.isEmpty()&&(this.getCenter(vn),dn.subVectors(this.max,vn),sn.subVectors(t.a,vn),un.subVectors(t.b,vn),ln.subVectors(t.c,vn),cn.subVectors(un,sn),fn.subVectors(ln,un),hn.subVectors(sn,ln),!!yn([0,-cn.z,cn.y,0,-fn.z,fn.y,0,-hn.z,hn.y,cn.z,0,-cn.x,fn.z,0,-fn.x,hn.z,0,-hn.x,-cn.y,cn.x,0,-fn.y,fn.x,0,-hn.y,hn.x,0],sn,un,ln,dn))&&!!yn([1,0,0,0,1,0,0,0,1],sn,un,ln,dn)&&(mn.crossVectors(cn,fn),yn([mn.x,mn.y,mn.z],sn,un,ln,dn))}},{key:"clampPoint",value:function(t,n){return n.copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return this.clampPoint(t,on).distanceTo(t)}},{key:"getBoundingSphere",value:function(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(on).length()),t}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"applyMatrix4",value:function(t){return this.isEmpty()||(rn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),rn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),rn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),rn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),rn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),rn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),rn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),rn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(rn)),this}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}])&&nn(t.prototype,n),e&&nn(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,e})(),rn=[new U,new U,new U,new U,new U,new U,new U,new U],on=new U,an=new en,sn=new U,un=new U,ln=new U,cn=new U,fn=new U,hn=new U,vn=new U,dn=new U,mn=new U,pn=new U;function yn(t,n,e,i,r){for(var o=0,a=t.length-3;o<=a;o+=3){pn.fromArray(t,o);var s=r.x*Math.abs(pn.x)+r.y*Math.abs(pn.y)+r.z*Math.abs(pn.z),u=n.dot(pn),l=e.dot(pn),c=i.dot(pn);if(Math.max(-Math.max(u,l,c),Math.min(u,l,c))>s)return!1}return!0}var gn=bn();function bn(){for(var t=new ArrayBuffer(4),n=new Float32Array(t),t=new Uint32Array(t),e=new Uint32Array(512),i=new Uint32Array(512),r=0;r<256;++r){var o=r-127;o<-27?(e[r]=0,e[256|r]=32768,i[r]=24,i[256|r]=24):o<-14?(e[r]=1024>>-o-14,e[256|r]=1024>>-o-14|32768,i[r]=-o-1,i[256|r]=-o-1):o<=15?(e[r]=15+o<<10,e[256|r]=15+o<<10|32768,i[r]=13,i[256|r]=13):o<128?(e[r]=31744,e[256|r]=64512,i[r]=24,i[256|r]=24):(e[r]=31744,e[256|r]=64512,i[r]=13,i[256|r]=13)}for(var a=new Uint32Array(2048),s=new Uint32Array(64),u=new Uint32Array(64),l=1;l<1024;++l){for(var c=l<<13,f=0;0==(8388608&c);)c<<=1,f-=8388608;c&=-8388609,f+=947912704,a[l]=c|f}for(var h=1024;h<2048;++h)a[h]=939524096+(h-1024<<13);for(var v=1;v<31;++v)s[v]=v<<23;s[31]=1199570944,s[32]=2147483648;for(var d=33;d<63;++d)s[d]=2147483648+(d-32<<23);s[63]=3347054592;for(var m=1;m<64;++m)32!==m&&(u[m]=1024);return{floatView:n,uint32View:t,baseTable:e,shiftTable:i,mantissaTable:a,exponentTable:s,offsetTable:u}}function _n(t){65504<Math.abs(t)&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=y(t,-65504,65504),gn.floatView[0]=t;var t=gn.uint32View[0],n=t>>23&511;return gn.baseTable[n]+((8388607&t)>>gn.shiftTable[n])}function wn(t){var n=t>>10;return gn.uint32View[0]=gn.mantissaTable[gn.offsetTable[n]+(1023&t)]+gn.exponentTable[n],gn.floatView[0]}var Sn={toHalfFloat:_n,fromHalfFloat:wn};function xn(t,n,e){n=En(n);var i=t,n=An()?Reflect.construct(n,e||[],En(t).constructor):n.apply(t,e);if(!n||"object"!=Pn(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function An(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(An=function(){return!!t})()}function En(t){return(En=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Tn(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),n&&Mn(t,n)}function Mn(t,n){return(Mn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}function Pn(t){return(Pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function On(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function Nn(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Pn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Pn(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Pn(t)?t:t+""))(i.key),i)}}function Cn(t,n,e){return n&&Nn(t.prototype,n),e&&Nn(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var s=new U,Ln=new B,H=(()=>Cn(function t(n,e){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(On(this,t),Array.isArray(n))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=n,this.itemSize=e,this.count=void 0!==n?n.length/e:0,this.normalized=i,this.usage=35044,this.updateRanges=[],this.gpuType=1015,this.version=0},[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(t){!0===t&&this.version++}},{key:"setUsage",value:function(t){return this.usage=t,this}},{key:"addUpdateRange",value:function(t,n){this.updateRanges.push({start:t,count:n})}},{key:"clearUpdateRanges",value:function(){this.updateRanges.length=0}},{key:"copy",value:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}},{key:"copyAt",value:function(t,n,e){t*=this.itemSize,e*=n.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[t+i]=n.array[e+i];return this}},{key:"copyArray",value:function(t){return this.array.set(t),this}},{key:"applyMatrix3",value:function(t){if(2===this.itemSize)for(var n=0,e=this.count;n<e;n++)Ln.fromBufferAttribute(this,n),Ln.applyMatrix3(t),this.setXY(n,Ln.x,Ln.y);else if(3===this.itemSize)for(var i=0,r=this.count;i<r;i++)s.fromBufferAttribute(this,i),s.applyMatrix3(t),this.setXYZ(i,s.x,s.y,s.z);return this}},{key:"applyMatrix4",value:function(t){for(var n=0,e=this.count;n<e;n++)s.fromBufferAttribute(this,n),s.applyMatrix4(t),this.setXYZ(n,s.x,s.y,s.z);return this}},{key:"applyNormalMatrix",value:function(t){for(var n=0,e=this.count;n<e;n++)s.fromBufferAttribute(this,n),s.applyNormalMatrix(t),this.setXYZ(n,s.x,s.y,s.z);return this}},{key:"transformDirection",value:function(t){for(var n=0,e=this.count;n<e;n++)s.fromBufferAttribute(this,n),s.transformDirection(t),this.setXYZ(n,s.x,s.y,s.z);return this}},{key:"set",value:function(t){return this.array.set(t,1<arguments.length&&void 0!==arguments[1]?arguments[1]:0),this}},{key:"getComponent",value:function(t,n){t=this.array[t*this.itemSize+n];return t=this.normalized?G(t,this.array):t}},{key:"setComponent",value:function(t,n,e){return this.normalized&&(e=a(e,this.array)),this.array[t*this.itemSize+n]=e,this}},{key:"getX",value:function(t){t=this.array[t*this.itemSize];return t=this.normalized?G(t,this.array):t}},{key:"setX",value:function(t,n){return this.normalized&&(n=a(n,this.array)),this.array[t*this.itemSize]=n,this}},{key:"getY",value:function(t){t=this.array[t*this.itemSize+1];return t=this.normalized?G(t,this.array):t}},{key:"setY",value:function(t,n){return this.normalized&&(n=a(n,this.array)),this.array[t*this.itemSize+1]=n,this}},{key:"getZ",value:function(t){t=this.array[t*this.itemSize+2];return t=this.normalized?G(t,this.array):t}},{key:"setZ",value:function(t,n){return this.normalized&&(n=a(n,this.array)),this.array[t*this.itemSize+2]=n,this}},{key:"getW",value:function(t){t=this.array[t*this.itemSize+3];return t=this.normalized?G(t,this.array):t}},{key:"setW",value:function(t,n){return this.normalized&&(n=a(n,this.array)),this.array[t*this.itemSize+3]=n,this}},{key:"setXY",value:function(t,n,e){return t*=this.itemSize,this.normalized&&(n=a(n,this.array),e=a(e,this.array)),this.array[t+0]=n,this.array[t+1]=e,this}},{key:"setXYZ",value:function(t,n,e,i){return t*=this.itemSize,this.normalized&&(n=a(n,this.array),e=a(e,this.array),i=a(i,this.array)),this.array[t+0]=n,this.array[t+1]=e,this.array[t+2]=i,this}},{key:"setXYZW",value:function(t,n,e,i,r){return t*=this.itemSize,this.normalized&&(n=a(n,this.array),e=a(e,this.array),i=a(i,this.array),r=a(r,this.array)),this.array[t+0]=n,this.array[t+1]=e,this.array[t+2]=i,this.array[t+3]=r,this}},{key:"onUpload",value:function(t){return this.onUploadCallback=t,this}},{key:"clone",value:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function(){var t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),35044!==this.usage&&(t.usage=this.usage),t}}]))(),Rn=(()=>{function i(t,n,e){return On(this,i),xn(this,i,[new Uint16Array(t),n,e])}return Tn(i,H),Cn(i)})(),Dn=(()=>{function i(t,n,e){return On(this,i),xn(this,i,[new Uint32Array(t),n,e])}return Tn(i,H),Cn(i)})(),k=(()=>{function i(t,n,e){return On(this,i),xn(this,i,[new Float32Array(t),n,e])}return Tn(i,H),Cn(i)})();function Fn(t){return(Fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function In(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Fn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Fn(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Fn(t)?t:t+""))(i.key),i)}}var kn=new en,jn=new U,Un=new U,Bn=(()=>{return t=function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new U,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1,i=this,r=t;if(!(i instanceof r))throw new TypeError("Cannot call a class as a function");this.isSphere=!0,this.center=n,this.radius=e},(n=[{key:"set",value:function(t,n){return this.center.copy(t),this.radius=n,this}},{key:"setFromPoints",value:function(t,n){for(var e=this.center,i=(void 0!==n?e.copy(n):kn.setFromPoints(t).getCenter(e),0),r=0,o=t.length;r<o;r++)i=Math.max(i,e.distanceToSquared(t[r]));return this.radius=Math.sqrt(i),this}},{key:"copy",value:function(t){return this.center.copy(t.center),this.radius=t.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(t){return t.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(t){var n=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=n*n}},{key:"intersectsBox",value:function(t){return t.intersectsSphere(this)}},{key:"intersectsPlane",value:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(t,n){var e=this.center.distanceToSquared(t);return n.copy(t),e>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}},{key:"getBoundingBox",value:function(t){return this.isEmpty()?t.makeEmpty():(t.set(this.center,this.center),t.expandByScalar(this.radius)),t}},{key:"applyMatrix4",value:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}},{key:"translate",value:function(t){return this.center.add(t),this}},{key:"expandByPoint",value:function(t){var n;return this.isEmpty()?(this.center.copy(t),this.radius=0):(jn.subVectors(t,this.center),(t=jn.lengthSq())>this.radius*this.radius&&(n=.5*((t=Math.sqrt(t))-this.radius),this.center.addScaledVector(jn,n/t),this.radius+=n)),this}},{key:"union",value:function(t){return t.isEmpty()||(this.isEmpty()?this.copy(t):!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(Un.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(jn.copy(t.center).add(Un)),this.expandByPoint(jn.copy(t.center).sub(Un)))),this}},{key:"equals",value:function(t){return t.center.equals(this.center)&&t.radius===this.radius}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}])&&In(t.prototype,n),e&&In(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,e})();function Hn(t){return(Hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Vn(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Hn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Hn(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Hn(t)?t:t+""))(i.key),i)}}var C=(()=>{function p(t,n,e,i,r,o,a,s,u,l,c,f,h,v,d,m){if(!(this instanceof p))throw new TypeError("Cannot call a class as a function");p.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,n,e,i,r,o,a,s,u,l,c,f,h,v,d,m)}return t=p,(n=[{key:"set",value:function(t,n,e,i,r,o,a,s,u,l,c,f,h,v,d,m){var p=this.elements;return p[0]=t,p[4]=n,p[8]=e,p[12]=i,p[1]=r,p[5]=o,p[9]=a,p[13]=s,p[2]=u,p[6]=l,p[10]=c,p[14]=f,p[3]=h,p[7]=v,p[11]=d,p[15]=m,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new p).fromArray(this.elements)}},{key:"copy",value:function(t){var n=this.elements,t=t.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],this}},{key:"copyPosition",value:function(t){var n=this.elements,t=t.elements;return n[12]=t[12],n[13]=t[13],n[14]=t[14],this}},{key:"setFromMatrix3",value:function(t){t=t.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(t,n,e){return t.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),e.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(t,n,e){return this.set(t.x,n.x,e.x,0,t.y,n.y,e.y,0,t.z,n.z,e.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(t){var n=this.elements,e=t.elements,i=1/zn.setFromMatrixColumn(t,0).length(),r=1/zn.setFromMatrixColumn(t,1).length(),t=1/zn.setFromMatrixColumn(t,2).length();return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=0,n[4]=e[4]*r,n[5]=e[5]*r,n[6]=e[6]*r,n[7]=0,n[8]=e[8]*t,n[9]=e[9]*t,n[10]=e[10]*t,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}},{key:"makeRotationFromEuler",value:function(t){var n,e,i,r,o=this.elements,a=t.x,s=t.y,u=t.z,l=Math.cos(a),a=Math.sin(a),c=Math.cos(s),s=Math.sin(s),f=Math.cos(u),u=Math.sin(u);return"XYZ"===t.order?(e=l*f,i=l*u,r=a*f,n=a*u,o[0]=c*f,o[4]=-c*u,o[8]=s,o[1]=i+r*s,o[5]=e-n*s,o[9]=-a*c,o[2]=n-e*s,o[6]=r+i*s,o[10]=l*c):"YXZ"===t.order?(n=c*u,e=s*f,o[0]=(r=c*f)+(i=s*u)*a,o[4]=e*a-n,o[8]=l*s,o[1]=l*u,o[5]=l*f,o[9]=-a,o[2]=n*a-e,o[6]=i+r*a,o[10]=l*c):"ZXY"===t.order?(n=c*u,e=s*f,o[0]=(i=c*f)-(r=s*u)*a,o[4]=-l*u,o[8]=e+n*a,o[1]=n+e*a,o[5]=l*f,o[9]=r-i*a,o[2]=-l*s,o[6]=a,o[10]=l*c):"ZYX"===t.order?(n=l*f,e=l*u,r=a*f,i=a*u,o[0]=c*f,o[4]=r*s-e,o[8]=n*s+i,o[1]=c*u,o[5]=i*s+n,o[9]=e*s-r,o[2]=-s,o[6]=a*c,o[10]=l*c):"YZX"===t.order?(i=l*c,n=l*s,e=a*c,r=a*s,o[0]=c*f,o[4]=r-i*u,o[8]=e*u+n,o[1]=u,o[5]=l*f,o[9]=-a*f,o[2]=-s*f,o[6]=n*u+e,o[10]=i-r*u):"XZY"===t.order&&(n=l*c,e=l*s,i=a*c,r=a*s,o[0]=c*f,o[4]=-u,o[8]=s*f,o[1]=n*u+r,o[5]=l*f,o[9]=e*u-i,o[2]=i*u-e,o[6]=a*f,o[10]=r*u+n),o[3]=0,o[7]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(t){return this.compose(Xn,t,Yn)}},{key:"lookAt",value:function(t,n,e){var i=this.elements;return u.subVectors(t,n),0===u.lengthSq()&&(u.z=1),u.normalize(),Wn.crossVectors(e,u),0===Wn.lengthSq()&&(1===Math.abs(e.z)?u.x+=1e-4:u.z+=1e-4,u.normalize(),Wn.crossVectors(e,u)),Wn.normalize(),Qn.crossVectors(u,Wn),i[0]=Wn.x,i[4]=Qn.x,i[8]=u.x,i[1]=Wn.y,i[5]=Qn.y,i[9]=u.y,i[2]=Wn.z,i[6]=Qn.z,i[10]=u.z,this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyMatrices",value:function(t,n){var t=t.elements,n=n.elements,e=this.elements,i=t[0],r=t[4],o=t[8],a=t[12],s=t[1],u=t[5],l=t[9],c=t[13],f=t[2],h=t[6],v=t[10],d=t[14],m=t[3],p=t[7],y=t[11],t=t[15],g=n[0],b=n[4],_=n[8],w=n[12],S=n[1],x=n[5],A=n[9],E=n[13],T=n[2],M=n[6],P=n[10],O=n[14],N=n[3],C=n[7],L=n[11],n=n[15];return e[0]=i*g+r*S+o*T+a*N,e[4]=i*b+r*x+o*M+a*C,e[8]=i*_+r*A+o*P+a*L,e[12]=i*w+r*E+o*O+a*n,e[1]=s*g+u*S+l*T+c*N,e[5]=s*b+u*x+l*M+c*C,e[9]=s*_+u*A+l*P+c*L,e[13]=s*w+u*E+l*O+c*n,e[2]=f*g+h*S+v*T+d*N,e[6]=f*b+h*x+v*M+d*C,e[10]=f*_+h*A+v*P+d*L,e[14]=f*w+h*E+v*O+d*n,e[3]=m*g+p*S+y*T+t*N,e[7]=m*b+p*x+y*M+t*C,e[11]=m*_+p*A+y*P+t*L,e[15]=m*w+p*E+y*O+t*n,this}},{key:"multiplyScalar",value:function(t){var n=this.elements;return n[0]*=t,n[4]*=t,n[8]*=t,n[12]*=t,n[1]*=t,n[5]*=t,n[9]*=t,n[13]*=t,n[2]*=t,n[6]*=t,n[10]*=t,n[14]*=t,n[3]*=t,n[7]*=t,n[11]*=t,n[15]*=t,this}},{key:"determinant",value:function(){var t=this.elements,n=t[0],e=t[4],i=t[8],r=t[12],o=t[1],a=t[5],s=t[9],u=t[13],l=t[2],c=t[6],f=t[10],h=t[14];return t[3]*(+r*s*c-i*u*c-r*a*f+e*u*f+i*a*h-e*s*h)+t[7]*(+n*s*h-n*u*f+r*o*f-i*o*h+i*u*l-r*s*l)+t[11]*(+n*u*c-n*a*h-r*o*c+e*o*h+r*a*l-e*u*l)+t[15]*(-i*a*l-n*s*c+n*a*f+i*o*c-e*o*f+e*s*l)}},{key:"transpose",value:function(){var t=this.elements,n=t[1];return t[1]=t[4],t[4]=n,n=t[2],t[2]=t[8],t[8]=n,n=t[6],t[6]=t[9],t[9]=n,n=t[3],t[3]=t[12],t[12]=n,n=t[7],t[7]=t[13],t[13]=n,n=t[11],t[11]=t[14],t[14]=n,this}},{key:"setPosition",value:function(t,n,e){var i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=n,i[14]=e),this}},{key:"invert",value:function(){var t=this.elements,n=t[0],e=t[1],i=t[2],r=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],f=t[10],h=t[11],v=t[12],d=t[13],m=t[14],p=t[15],y=c*m*u-d*f*u+d*s*h-a*m*h-c*s*p+a*f*p,g=v*f*u-l*m*u-v*s*h+o*m*h+l*s*p-o*f*p,b=l*d*u-v*c*u+v*a*h-o*d*h-l*a*p+o*c*p,_=v*c*s-l*d*s-v*a*f+o*d*f+l*a*m-o*c*m,w=n*y+e*g+i*b+r*_;return 0==w?this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0):(t[0]=y*(y=1/w),t[1]=(d*f*r-c*m*r-d*i*h+e*m*h+c*i*p-e*f*p)*y,t[2]=(a*m*r-d*s*r+d*i*u-e*m*u-a*i*p+e*s*p)*y,t[3]=(c*s*r-a*f*r-c*i*u+e*f*u+a*i*h-e*s*h)*y,t[4]=g*y,t[5]=(l*m*r-v*f*r+v*i*h-n*m*h-l*i*p+n*f*p)*y,t[6]=(v*s*r-o*m*r-v*i*u+n*m*u+o*i*p-n*s*p)*y,t[7]=(o*f*r-l*s*r+l*i*u-n*f*u-o*i*h+n*s*h)*y,t[8]=b*y,t[9]=(v*c*r-l*d*r-v*e*h+n*d*h+l*e*p-n*c*p)*y,t[10]=(o*d*r-v*a*r+v*e*u-n*d*u-o*e*p+n*a*p)*y,t[11]=(l*a*r-o*c*r-l*e*u+n*c*u+o*e*h-n*a*h)*y,t[12]=_*y,t[13]=(l*d*i-v*c*i+v*e*f-n*d*f-l*e*m+n*c*m)*y,t[14]=(v*a*i-o*d*i-v*e*s+n*d*s+o*e*m-n*a*m)*y,t[15]=(o*c*i-l*a*i+l*e*s-n*c*s-o*e*f+n*a*f)*y,this)}},{key:"scale",value:function(t){var n=this.elements,e=t.x,i=t.y,t=t.z;return n[0]*=e,n[4]*=i,n[8]*=t,n[1]*=e,n[5]*=i,n[9]*=t,n[2]*=e,n[6]*=i,n[10]*=t,n[3]*=e,n[7]*=i,n[11]*=t,this}},{key:"getMaxScaleOnAxis",value:function(){var t=this.elements,n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];return Math.sqrt(Math.max(n,t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))}},{key:"makeTranslation",value:function(t,n,e){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,n,0,0,1,e,0,0,0,1),this}},{key:"makeRotationX",value:function(t){var n=Math.cos(t),t=Math.sin(t);return this.set(1,0,0,0,0,n,-t,0,0,t,n,0,0,0,0,1),this}},{key:"makeRotationY",value:function(t){var n=Math.cos(t),t=Math.sin(t);return this.set(n,0,t,0,0,1,0,0,-t,0,n,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(t){var n=Math.cos(t),t=Math.sin(t);return this.set(n,-t,0,0,t,n,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(t,n){var e=Math.cos(n),n=Math.sin(n),i=1-e,r=t.x,o=t.y,t=t.z,a=i*r,s=i*o;return this.set(a*r+e,a*o-n*t,a*t+n*o,0,a*o+n*t,s*o+e,s*t-n*r,0,a*t-n*o,s*t+n*r,i*t*t+e,0,0,0,0,1),this}},{key:"makeScale",value:function(t,n,e){return this.set(t,0,0,0,0,n,0,0,0,0,e,0,0,0,0,1),this}},{key:"makeShear",value:function(t,n,e,i,r,o){return this.set(1,e,r,0,t,1,o,0,n,i,1,0,0,0,0,1),this}},{key:"compose",value:function(t,n,e){var i=this.elements,r=n.T,o=n.M,a=n.P,n=n.O,s=r+r,u=o+o,l=a+a,c=r*s,f=r*u,r=r*l,h=o*u,o=o*l,a=a*l,s=n*s,u=n*u,n=n*l,l=e.x,v=e.y,e=e.z;return i[0]=(1-(h+a))*l,i[1]=(f+n)*l,i[2]=(r-u)*l,i[3]=0,i[4]=(f-n)*v,i[5]=(1-(c+a))*v,i[6]=(o+s)*v,i[7]=0,i[8]=(r+u)*e,i[9]=(o-s)*e,i[10]=(1-(c+h))*e,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}},{key:"decompose",value:function(t,n,e){var i=this.elements,r=zn.set(i[0],i[1],i[2]).length(),o=zn.set(i[4],i[5],i[6]).length(),a=zn.set(i[8],i[9],i[10]).length(),t=(this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],Gn.copy(this),1/r),i=1/o,s=1/a;return Gn.elements[0]*=t,Gn.elements[1]*=t,Gn.elements[2]*=t,Gn.elements[4]*=i,Gn.elements[5]*=i,Gn.elements[6]*=i,Gn.elements[8]*=s,Gn.elements[9]*=s,Gn.elements[10]*=s,n.setFromRotationMatrix(Gn),e.x=r,e.y=o,e.z=a,this}},{key:"makePerspective",value:function(t,n,e,i,r,o){var a,s,u=6<arguments.length&&void 0!==arguments[6]?arguments[6]:2e3,l=this.elements,c=2*r/(n-t),f=2*r/(e-i),n=(n+t)/(n-t),t=(e+i)/(e-i);if(2e3===u)a=-(o+r)/(o-r),s=-2*o*r/(o-r);else{if(2001!==u)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);a=-o/(o-r),s=-o*r/(o-r)}return l[0]=c,l[4]=0,l[8]=n,l[12]=0,l[1]=0,l[5]=f,l[9]=t,l[13]=0,l[2]=0,l[6]=0,l[10]=a,l[14]=s,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}},{key:"makeOrthographic",value:function(t,n,e,i,r,o){var a,s,u=6<arguments.length&&void 0!==arguments[6]?arguments[6]:2e3,l=this.elements,c=1/(n-t),f=1/(e-i),h=1/(o-r),n=(n+t)*c,t=(e+i)*f;if(2e3===u)a=(o+r)*h,s=-2*h;else{if(2001!==u)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);a=r*h,s=-1*h}return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-n,l[1]=0,l[5]=2*f,l[9]=0,l[13]=-t,l[2]=0,l[6]=0,l[10]=s,l[14]=-a,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}},{key:"equals",value:function(t){for(var n=this.elements,e=t.elements,i=0;i<16;i++)if(n[i]!==e[i])return!1;return!0}},{key:"fromArray",value:function(t){for(var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,e=0;e<16;e++)this.elements[e]=t[e+n];return this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,e=this.elements;return t[n]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t[n+4]=e[4],t[n+5]=e[5],t[n+6]=e[6],t[n+7]=e[7],t[n+8]=e[8],t[n+9]=e[9],t[n+10]=e[10],t[n+11]=e[11],t[n+12]=e[12],t[n+13]=e[13],t[n+14]=e[14],t[n+15]=e[15],t}}])&&Vn(t.prototype,n),e&&Vn(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,e})(),zn=new U,Gn=new C,Xn=new U(0,0,0),Yn=new U(1,1,1),Wn=new U,Qn=new U,u=new U;function qn(t){return(qn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Zn(){Zn=function(){return a};var u,a={},t=Object.prototype,l=t.hasOwnProperty,c=Object.defineProperty||function(t,n,e){t[n]=e.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",e=n.asyncIterator||"@@asyncIterator",r=n.toStringTag||"@@toStringTag";function o(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{o({},"")}catch(u){o=function(t,n,e){return t[n]=e}}function s(t,n,e,i){var r,o,a,s,n=n&&n.prototype instanceof y?n:y,n=Object.create(n.prototype),i=new T(i||[]);return c(n,"_invoke",{value:(r=t,o=e,a=i,s=h,function(t,n){if(s===d)throw Error("Generator is already running");if(s===m){if("throw"===t)throw n;return{value:u,done:!0}}for(a.method=t,a.arg=n;;){var e=a.delegate;if(e){e=function t(n,e){var i=e.method,r=n.iterator[i];if(r===u)return e.delegate=null,"throw"===i&&n.iterator.return&&(e.method="return",e.arg=u,t(n,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),p;i=f(r,n.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,p;r=i.arg;return r?r.done?(e[n.resultName]=r.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=u),e.delegate=null,p):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}(e,a);if(e){if(e===p)continue;return e}}if("next"===a.method)a.sent=a.v=a.arg;else if("throw"===a.method){if(s===h)throw s=m,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s=d;e=f(r,o,a);if("normal"===e.type){if(s=a.done?m:v,e.arg===p)continue;return{value:e.arg,done:a.done}}"throw"===e.type&&(s=m,a.method="throw",a.arg=e.arg)}})}),n}function f(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}a.wrap=s;var h="suspendedStart",v="suspendedYield",d="executing",m="completed",p={};function y(){}function g(){}function b(){}var n={},_=(o(n,i,function(){return this}),Object.getPrototypeOf),_=_&&_(_(M([]))),w=(_&&_!==t&&l.call(_,i)&&(n=_),b.prototype=y.prototype=Object.create(n));function S(t){["next","throw","return"].forEach(function(n){o(t,n,function(t){return this._invoke(n,t)})})}function x(a,s){var n;c(this,"_invoke",{value:function(e,i){function t(){return new s(function(t,n){!function n(t,e,i,r){var o,t=f(a[t],a,e);if("throw"!==t.type)return(e=(o=t.arg).value)&&"object"==qn(e)&&l.call(e,"__await")?s.resolve(e._).then(function(t){n("next",t,i,r)},function(t){n("throw",t,i,r)}):s.resolve(e).then(function(t){o.value=t,i(o)},function(t){return n("throw",t,i,r)});r(t.arg)}(e,i,t,n)})}return n=n?n.then(t,t):t()}})}function A(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function E(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function M(n){if(n||""===n){var e,t=n[i];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return e=-1,(t=function t(){for(;++e<n.length;)if(l.call(n,e))return t.value=n[e],t.done=!1,t;return t.value=u,t.done=!0,t}).next=t}throw new TypeError(qn(n)+" is not iterable")}return c(w,"constructor",{value:g.prototype=b,configurable:!0}),c(b,"constructor",{value:g,configurable:!0}),g.displayName=o(b,r,"GeneratorFunction"),a.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,o(t,r,"GeneratorFunction")),t.prototype=Object.create(w),t},a.awrap=function(t){return{_:t}},S(x.prototype),o(x.prototype,e,function(){return this}),a.AsyncIterator=x,a.async=function(t,n,e,i,r){void 0===r&&(r=Promise);var o=new x(s(t,n,e,i),r);return a.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},S(w),o(w,r,"Generator"),o(w,i,function(){return this}),o(w,"toString",function(){return"[object Generator]"}),a.keys=function(t){var n,e=Object(t),i=[];for(n in e)i.push(n);return i.reverse(),function t(){for(;i.length;){var n=i.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},a.values=M,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this.v=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(E),!t)for(var n in this)"t"===n.charAt(0)&&l.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=u)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function t(t,n){return o.type="throw",o.arg=e,i.next=t,n&&(i.method="next",i.arg=u),!!n}for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var a=l.call(r,"catchLoc"),s=l.call(r,"finallyLoc");if(a&&s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&l.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var o=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=n&&n<=r.finallyLoc?null:r)?r.completion:{};return o.type=t,o.arg=n,r?(this.method="next",this.next=r.finallyLoc,p):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),p},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),E(e),p}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e,i,r=this.tryEntries[n];if(r.tryLoc===t)return"throw"===(e=r.completion).type&&(i=e.arg,E(r)),i}throw Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:M(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=u),p}},a}function Jn(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=qn(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=qn(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==qn(t)?t:t+""))(i.key),i)}}var Kn=new C,$n=new Xt,te=(()=>{return t=function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:t.DEFAULT_ORDER,o=this,a=t;if(!(o instanceof a))throw new TypeError("Cannot call a class as a function");this.isEuler=!0,this.T=n,this.M=e,this.P=i,this.C=r},(n=[{key:"x",get:function(){return this.T},set:function(t){this.T=t,this.N()}},{key:"y",get:function(){return this.M},set:function(t){this.M=t,this.N()}},{key:"z",get:function(){return this.P},set:function(t){this.P=t,this.N()}},{key:"order",get:function(){return this.C},set:function(t){this.C=t,this.N()}},{key:"set",value:function(t,n,e){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:this.C;return this.T=t,this.M=n,this.P=e,this.C=i,this.N(),this}},{key:"clone",value:function(){return new this.constructor(this.T,this.M,this.P,this.C)}},{key:"copy",value:function(t){return this.T=t.T,this.M=t.M,this.P=t.P,this.C=t.C,this.N(),this}},{key:"setFromRotationMatrix",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.C,e=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],t=t.elements,i=t[0],r=t[4],o=t[8],a=t[1],s=t[5],u=t[9],l=t[2],c=t[6],f=t[10];switch(n){case"XYZ":this.M=Math.asin(y(o,-1,1)),Math.abs(o)<.9999999?(this.T=Math.atan2(-u,f),this.P=Math.atan2(-r,i)):(this.T=Math.atan2(c,s),this.P=0);break;case"YXZ":this.T=Math.asin(-y(u,-1,1)),Math.abs(u)<.9999999?(this.M=Math.atan2(o,f),this.P=Math.atan2(a,s)):(this.M=Math.atan2(-l,i),this.P=0);break;case"ZXY":this.T=Math.asin(y(c,-1,1)),Math.abs(c)<.9999999?(this.M=Math.atan2(-l,f),this.P=Math.atan2(-r,s)):(this.M=0,this.P=Math.atan2(a,i));break;case"ZYX":this.M=Math.asin(-y(l,-1,1)),Math.abs(l)<.9999999?(this.T=Math.atan2(c,f),this.P=Math.atan2(a,i)):(this.T=0,this.P=Math.atan2(-r,s));break;case"YZX":this.P=Math.asin(y(a,-1,1)),Math.abs(a)<.9999999?(this.T=Math.atan2(-u,s),this.M=Math.atan2(-l,i)):(this.T=0,this.M=Math.atan2(o,f));break;case"XZY":this.P=Math.asin(-y(r,-1,1)),Math.abs(r)<.9999999?(this.T=Math.atan2(c,s),this.M=Math.atan2(o,i)):(this.T=Math.atan2(-u,f),this.M=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this.C=n,!0===e&&this.N(),this}},{key:"setFromQuaternion",value:function(t,n,e){return Kn.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Kn,n,e)}},{key:"setFromVector3",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.C;return this.set(t.x,t.y,t.z,n)}},{key:"reorder",value:function(t){return $n.setFromEuler(this),this.setFromQuaternion($n,t)}},{key:"equals",value:function(t){return t.T===this.T&&t.M===this.M&&t.P===this.P&&t.C===this.C}},{key:"fromArray",value:function(t){return this.T=t[0],this.M=t[1],this.P=t[2],void 0!==t[3]&&(this.C=t[3]),this.N(),this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return t[n]=this.T,t[n+1]=this.M,t[n+2]=this.P,t[n+3]=this.C,t}},{key:"_onChange",value:function(t){return this.N=t,this}},{key:"_onChangeCallback",value:function(){}},{key:Symbol.iterator,value:Zn().mark(function t(){return Zn().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.T;case 2:return t.next=4,this.M;case 4:return t.next=6,this.P;case 6:return t.next=8,this.C;case 8:case"end":return t.stop()}},t,this)})}])&&Jn(t.prototype,n),e&&Jn(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,e})();function ne(t){return(ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ee(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=ne(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=ne(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==ne(t)?t:t+""))(i.key),i)}}te.DEFAULT_ORDER="XYZ";var ie=(()=>{function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.mask=1}return n=t,(e=[{key:"set",value:function(t){this.mask=(1<<t|0)>>>0}},{key:"enable",value:function(t){this.mask|=1<<t|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(t){this.mask^=1<<t|0}},{key:"disable",value:function(t){this.mask&=~(1<<t|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(t){return 0!=(this.mask&t.mask)}},{key:"isEnabled",value:function(t){return 0!=(this.mask&(1<<t|0))}}])&&ee(n.prototype,e),i&&ee(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,e,i})();function re(t){return(re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function oe(t){return(t=>{if(Array.isArray(t))return ae(t)})(t)||(t=>{if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)})(t)||((t,n)=>{var e;if(t)return"string"==typeof t?ae(t,n):"Map"===(e="Object"===(e={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?ae(t,n):void 0})(t)||(()=>{throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function ae(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=Array(n);e<n;e++)i[e]=t[e];return i}function se(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=re(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=re(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==re(t)?t:t+""))(i.key),i)}}function ue(t,n,e){n=ce(n);var i=t,n=le()?Reflect.construct(n,e||[],ce(t).constructor):n.apply(t,e);if(!n||"object"!=re(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function le(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(le=function(){return!!t})()}function ce(t){return(ce=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function fe(t,n){return(fe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var he=0,ve=new U,de=new Xt,me=new C,pe=new U,ye=new U,ge=new U,be=new Xt,_e=new U(1,0,0),we=new U(0,1,0),Se=new U(0,0,1),xe={type:"added"},Ae={type:"removed"},Ee={type:"childadded",child:null},Te={type:"childremoved",child:null},Me=(()=>{function o(){var t;if(!(this instanceof o))throw new TypeError("Cannot call a class as a function");(t=ue(this,o)).isObject3D=!0,Object.defineProperty(t,"id",{value:he++}),t.uuid=j(),t.name="",t.type="Object3D",t.parent=null,t.children=[],t.up=o.DEFAULT_UP.clone();var n=new U,e=new te,i=new Xt,r=new U(1,1,1);return e._onChange(function(){i.setFromEuler(e,!1)}),i._onChange(function(){e.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(t,{position:{configurable:!0,enumerable:!0,value:n},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new C},normalMatrix:{value:new v}}),t.matrix=new C,t.matrixWorld=new C,t.matrixAutoUpdate=o.DEFAULT_MATRIX_AUTO_UPDATE,t.matrixWorldAutoUpdate=o.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,t.matrixWorldNeedsUpdate=!1,t.layers=new ie,t.visible=!0,t.castShadow=!1,t.receiveShadow=!1,t.frustumCulled=!0,t.renderOrder=0,t.animations=[],t.userData={},t}var t,n=o,e=Et;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&fe(n,e),n=o,(e=[{key:"onBeforeShadow",value:function(){}},{key:"onAfterShadow",value:function(){}},{key:"onBeforeRender",value:function(){}},{key:"onAfterRender",value:function(){}},{key:"applyMatrix4",value:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function(t){return this.quaternion.premultiply(t),this}},{key:"setRotationFromAxisAngle",value:function(t,n){this.quaternion.setFromAxisAngle(t,n)}},{key:"setRotationFromEuler",value:function(t){this.quaternion.setFromEuler(t,!0)}},{key:"setRotationFromMatrix",value:function(t){this.quaternion.setFromRotationMatrix(t)}},{key:"setRotationFromQuaternion",value:function(t){this.quaternion.copy(t)}},{key:"rotateOnAxis",value:function(t,n){return de.setFromAxisAngle(t,n),this.quaternion.multiply(de),this}},{key:"rotateOnWorldAxis",value:function(t,n){return de.setFromAxisAngle(t,n),this.quaternion.premultiply(de),this}},{key:"rotateX",value:function(t){return this.rotateOnAxis(_e,t)}},{key:"rotateY",value:function(t){return this.rotateOnAxis(we,t)}},{key:"rotateZ",value:function(t){return this.rotateOnAxis(Se,t)}},{key:"translateOnAxis",value:function(t,n){return ve.copy(t).applyQuaternion(this.quaternion),this.position.add(ve.multiplyScalar(n)),this}},{key:"translateX",value:function(t){return this.translateOnAxis(_e,t)}},{key:"translateY",value:function(t){return this.translateOnAxis(we,t)}},{key:"translateZ",value:function(t){return this.translateOnAxis(Se,t)}},{key:"localToWorld",value:function(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(me.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function(t,n,e){t.isVector3?pe.copy(t):pe.set(t,n,e);t=this.parent;this.updateWorldMatrix(!0,!1),ye.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?me.lookAt(ye,pe,this.up):me.lookAt(pe,ye,this.up),this.quaternion.setFromRotationMatrix(me),t&&(me.extractRotation(t.matrixWorld),de.setFromRotationMatrix(me),this.quaternion.premultiply(de.invert()))}},{key:"add",value:function(t){if(1<arguments.length)for(var n=0;n<arguments.length;n++)this.add(arguments[n]);else t===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",t):t&&t.isObject3D?(t.removeFromParent(),(t.parent=this).children.push(t),t.dispatchEvent(xe),Ee.child=t,this.dispatchEvent(Ee),Ee.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t);return this}},{key:"remove",value:function(t){if(1<arguments.length)for(var n=0;n<arguments.length;n++)this.remove(arguments[n]);else{var e=this.children.indexOf(t);-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Ae),Te.child=t,this.dispatchEvent(Te),Te.child=null)}return this}},{key:"removeFromParent",value:function(){var t=this.parent;return null!==t&&t.remove(this),this}},{key:"clear",value:function(){return this.remove.apply(this,oe(this.children))}},{key:"attach",value:function(t){return this.updateWorldMatrix(!0,!1),me.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),me.multiply(t.parent.matrixWorld)),t.applyMatrix4(me),t.removeFromParent(),(t.parent=this).children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(xe),Ee.child=t,this.dispatchEvent(Ee),Ee.child=null,this}},{key:"getObjectById",value:function(t){return this.getObjectByProperty("id",t)}},{key:"getObjectByName",value:function(t){return this.getObjectByProperty("name",t)}},{key:"getObjectByProperty",value:function(t,n){if(this[t]===n)return this;for(var e=0,i=this.children.length;e<i;e++){var r=this.children[e].getObjectByProperty(t,n);if(void 0!==r)return r}}},{key:"getObjectsByProperty",value:function(t,n){for(var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],i=(this[t]===n&&e.push(this),this.children),r=0,o=i.length;r<o;r++)i[r].getObjectsByProperty(t,n,e);return e}},{key:"getWorldPosition",value:function(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ye,t,ge),t}},{key:"getWorldScale",value:function(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ye,be,t),t}},{key:"getWorldDirection",value:function(t){this.updateWorldMatrix(!0,!1);var n=this.matrixWorld.elements;return t.set(n[8],n[9],n[10]).normalize()}},{key:"raycast",value:function(){}},{key:"traverse",value:function(t){t(this);for(var n=this.children,e=0,i=n.length;e<i;e++)n[e].traverse(t)}},{key:"traverseVisible",value:function(t){if(!1!==this.visible){t(this);for(var n=this.children,e=0,i=n.length;e<i;e++)n[e].traverseVisible(t)}}},{key:"traverseAncestors",value:function(t){var n=this.parent;null!==n&&(t(n),n.traverseAncestors(t))}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t=!(this.matrixWorldNeedsUpdate=!1));for(var n=this.children,e=0,i=n.length;e<i;e++)n[e].updateMatrixWorld(t)}},{key:"updateWorldMatrix",value:function(t,n){var e=this.parent;if(!0===t&&null!==e&&e.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===n)for(var i=this.children,r=0,o=i.length;r<o;r++)i[r].updateWorldMatrix(!1,!0)}},{key:"toJSON",value:function(e){var t,n,i,r,o,a,s=void 0===e||"string"==typeof e,u={},l=(s&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},u.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"}),{});function c(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(l.uuid=this.uuid,l.type=this.type,""!==this.name&&(l.name=this.name),!0===this.castShadow&&(l.castShadow=!0),!0===this.receiveShadow&&(l.receiveShadow=!0),!1===this.visible&&(l.visible=!1),!1===this.frustumCulled&&(l.frustumCulled=!1),0!==this.renderOrder&&(l.renderOrder=this.renderOrder),0<Object.keys(this.userData).length&&(l.userData=this.userData),l.layers=this.layers.mask,l.matrix=this.matrix.toArray(),l.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(l.matrixAutoUpdate=!1),this.isInstancedMesh&&(l.type="InstancedMesh",l.count=this.count,l.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor)&&(l.instanceColor=this.instanceColor.toJSON()),this.isBatchedMesh&&(l.type="BatchedMesh",l.perObjectFrustumCulled=this.perObjectFrustumCulled,l.sortObjects=this.sortObjects,l.drawRanges=this._drawRanges,l.reservedRanges=this._reservedRanges,l.visibility=this._visibility,l.active=this._active,l.bounds=this._bounds.map(function(t){return{boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()}}),l.maxInstanceCount=this._maxInstanceCount,l.maxVertexCount=this._maxVertexCount,l.maxIndexCount=this._maxIndexCount,l.geometryInitialized=this._geometryInitialized,l.geometryCount=this._geometryCount,l.matricesTexture=this._matricesTexture.toJSON(e),null!==this._colorsTexture&&(l.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(l.boundingSphere={center:l.boundingSphere.center.toArray(),radius:l.boundingSphere.radius}),null!==this.boundingBox)&&(l.boundingBox={min:l.boundingBox.min.toArray(),max:l.boundingBox.max.toArray()}),this.isScene)this.background&&(this.background.isColor?l.background=this.background.toJSON():this.background.isTexture&&(l.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(l.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){l.geometry=c(e.geometries,this.geometry);var f=this.geometry.parameters;if(void 0!==f&&void 0!==f.shapes){var h=f.shapes;if(Array.isArray(h))for(var v=0,d=h.length;v<d;v++){var m=h[v];c(e.shapes,m)}else c(e.shapes,h)}}if(this.isSkinnedMesh&&(l.bindMode=this.bindMode,l.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton)&&(c(e.skeletons,this.skeleton),l.skeleton=this.skeleton.uuid),void 0!==this.material)if(Array.isArray(this.material)){for(var p=[],y=0,g=this.material.length;y<g;y++)p.push(c(e.materials,this.material[y]));l.material=p}else l.material=c(e.materials,this.material);if(0<this.children.length){l.children=[];for(var b=0;b<this.children.length;b++)l.children.push(this.children[b].toJSON(e).object)}if(0<this.animations.length){l.animations=[];for(var _=0;_<this.animations.length;_++){var w=this.animations[_];l.animations.push(c(e.animations,w))}}return s&&(f=S(e.geometries),s=S(e.materials),t=S(e.textures),n=S(e.images),i=S(e.shapes),r=S(e.skeletons),o=S(e.animations),a=S(e.nodes),0<f.length&&(u.geometries=f),0<s.length&&(u.materials=s),0<t.length&&(u.textures=t),0<n.length&&(u.images=n),0<i.length&&(u.shapes=i),0<r.length&&(u.skeletons=r),0<o.length&&(u.animations=o),0<a.length)&&(u.nodes=a),u.object=l,u;function S(t){var n,e=[];for(n in t){var i=t[n];delete i.metadata,e.push(i)}return e}}},{key:"clone",value:function(t){return(new this.constructor).copy(this,t)}},{key:"copy",value:function(t){var n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===n)for(var e=0;e<t.children.length;e++){var i=t.children[e];this.add(i.clone())}return this}}])&&se(n.prototype,e),t&&se(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})(),t=(Me.DEFAULT_UP=new U(0,1,0),Me.DEFAULT_MATRIX_AUTO_UPDATE=!0,Me.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0,{BROWSER:0,WX:1}),Pe=(Object.freeze(t),t),Oe={document:"undefined"!=typeof document?document:{},window:"undefined"!=typeof window?window:{},environment:Pe.BROWSER,XMLHttpRequest:"undefined"!=typeof XMLHttpRequest?XMLHttpRequest:{}},Ne=Oe;Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function Ce(t){return Ne.document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Le(t){return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Re(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Le(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Le(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Le(t)?t:t+""))(i.key),i)}}function De(t,n,e){n=Ie(n);var i=t,n=Fe()?Reflect.construct(n,e||[],Ie(t).constructor):n.apply(t,e);if(!n||"object"!=Le(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Fe(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Fe=function(){return!!t})()}function Ie(t){return(Ie=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ke(t,n){return(ke=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var je=0,i=new C,Ue=new Me,Be=new U,p=new en,He=new en,g=new U,Ve=(()=>{function y(){var t;if(this instanceof y)return(t=De(this,y)).isBufferGeometry=!0,Object.defineProperty(t,"id",{value:je++}),t.uuid=j(),t.name="",t.type="BufferGeometry",t.index=null,t.attributes={},t.morphAttributes={},t.morphTargetsRelative=!1,t.groups=[],t.boundingBox=null,t.boundingSphere=null,t.drawRange={start:0,count:1/0},t.userData={},t;throw new TypeError("Cannot call a class as a function")}var t,n=y,e=Et;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&ke(n,e),n=y,(e=[{key:"getIndex",value:function(){return this.index}},{key:"setIndex",value:function(t){return Array.isArray(t)?this.index=new((t=>{for(var n=t.length-1;0<=n;--n)if(65535<=t[n])return 1})(t)?Dn:Rn)(t,1):this.index=t,this}},{key:"getAttribute",value:function(t){return this.attributes[t]}},{key:"setAttribute",value:function(t,n){return this.attributes[t]=n,this}},{key:"deleteAttribute",value:function(t){return delete this.attributes[t],this}},{key:"hasAttribute",value:function(t){return void 0!==this.attributes[t]}},{key:"addGroup",value:function(t,n){this.groups.push({start:t,count:n,materialIndex:2<arguments.length&&void 0!==arguments[2]?arguments[2]:0})}},{key:"clearGroups",value:function(){this.groups=[]}},{key:"setDrawRange",value:function(t,n){this.drawRange.start=t,this.drawRange.count=n}},{key:"applyMatrix4",value:function(t){var n=this.attributes.position,n=(void 0!==n&&(n.applyMatrix4(t),n.needsUpdate=!0),this.attributes.normal),e=(void 0!==n&&(e=(new v).getNormalMatrix(t),n.applyNormalMatrix(e),n.needsUpdate=!0),this.attributes.tangent);return void 0!==e&&(e.transformDirection(t),e.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"applyQuaternion",value:function(t){return i.makeRotationFromQuaternion(t),this.applyMatrix4(i),this}},{key:"rotateX",value:function(t){return i.makeRotationX(t),this.applyMatrix4(i),this}},{key:"rotateY",value:function(t){return i.makeRotationY(t),this.applyMatrix4(i),this}},{key:"rotateZ",value:function(t){return i.makeRotationZ(t),this.applyMatrix4(i),this}},{key:"translate",value:function(t,n,e){return i.makeTranslation(t,n,e),this.applyMatrix4(i),this}},{key:"scale",value:function(t,n,e){return i.makeScale(t,n,e),this.applyMatrix4(i),this}},{key:"lookAt",value:function(t){return Ue.lookAt(t),Ue.updateMatrix(),this.applyMatrix4(Ue.matrix),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Be).negate(),this.translate(Be.x,Be.y,Be.z),this}},{key:"setFromPoints",value:function(t){for(var n=[],e=0,i=t.length;e<i;e++){var r=t[e];n.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new k(n,3)),this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new en);var t=this.attributes.position,n=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new U(-1/0,-1/0,-1/0),new U(1/0,1/0,1/0));else{if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),n)for(var e=0,i=n.length;e<i;e++){var r=n[e];p.setFromBufferAttribute(r),this.morphTargetsRelative?(g.addVectors(this.boundingBox.min,p.min),this.boundingBox.expandByPoint(g),g.addVectors(this.boundingBox.max,p.max),this.boundingBox.expandByPoint(g)):(this.boundingBox.expandByPoint(p.min),this.boundingBox.expandByPoint(p.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new Bn);var t=this.attributes.position,n=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new U,1/0);else if(t){var e=this.boundingSphere.center;if(p.setFromBufferAttribute(t),n)for(var i=0,r=n.length;i<r;i++){var o=n[i];He.setFromBufferAttribute(o),this.morphTargetsRelative?(g.addVectors(p.min,He.min),p.expandByPoint(g),g.addVectors(p.max,He.max),p.expandByPoint(g)):(p.expandByPoint(He.min),p.expandByPoint(He.max))}p.getCenter(e);for(var a=0,s=0,u=t.count;s<u;s++)g.fromBufferAttribute(t,s),a=Math.max(a,e.distanceToSquared(g));if(n)for(var l=0,c=n.length;l<c;l++)for(var f=n[l],h=this.morphTargetsRelative,v=0,d=f.count;v<d;v++)g.fromBufferAttribute(f,v),h&&(Be.fromBufferAttribute(t,v),g.add(Be)),a=Math.max(a,e.distanceToSquared(g));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}},{key:"computeTangents",value:function(){var t=this.index,n=this.attributes;if(null===t||void 0===n.position||void 0===n.normal||void 0===n.uv)console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");else{for(var e=n.position,i=n.normal,r=n.uv,o=(!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new H(new Float32Array(4*e.count),4)),this.getAttribute("tangent")),a=[],s=[],u=0;u<e.count;u++)a[u]=new U,s[u]=new U;for(var l,c,f,h,v=new U,d=new U,m=new U,p=new B,y=new B,g=new B,b=new U,_=new U,w=this.groups,S=0,x=(w=0===w.length?[{start:0,count:t.count}]:w).length;S<x;++S)for(var A=w[S],E=A.start,T=E,I=E+A.count;T<I;T+=3)l=t.getX(T+0),c=t.getX(T+1),f=t.getX(T+2),h=void 0,v.fromBufferAttribute(e,l),d.fromBufferAttribute(e,c),m.fromBufferAttribute(e,f),p.fromBufferAttribute(r,l),y.fromBufferAttribute(r,c),g.fromBufferAttribute(r,f),d.sub(v),m.sub(v),y.sub(p),g.sub(p),h=1/(y.x*g.y-g.x*y.y),isFinite(h)&&(b.copy(d).multiplyScalar(g.y).addScaledVector(m,-y.y).multiplyScalar(h),_.copy(m).multiplyScalar(y.x).addScaledVector(d,-g.x).multiplyScalar(h),a[l].add(b),a[c].add(b),a[f].add(b),s[l].add(_),s[c].add(_),s[f].add(_));for(var M=new U,P=new U,O=new U,N=new U,C=0,k=w.length;C<k;++C)for(var L=w[C],R=L.start,D=R,j=R+L.count;D<j;D+=3)F(t.getX(D+0)),F(t.getX(D+1)),F(t.getX(D+2))}function F(t){O.fromBufferAttribute(i,t),N.copy(O);var n=a[t],n=(M.copy(n),M.sub(O.multiplyScalar(O.dot(n))).normalize(),P.crossVectors(N,n),P.dot(s[t]));o.setXYZW(t,M.x,M.y,M.z,n<0?-1:1)}}},{key:"computeVertexNormals",value:function(){var t=this.index,n=this.getAttribute("position");if(void 0!==n){var e=this.getAttribute("normal");if(void 0===e)e=new H(new Float32Array(3*n.count),3),this.setAttribute("normal",e);else for(var i=0,r=e.count;i<r;i++)e.setXYZ(i,0,0,0);var o=new U,a=new U,s=new U,u=new U,l=new U,c=new U,f=new U,h=new U;if(t)for(var v=0,d=t.count;v<d;v+=3){var m=t.getX(v+0),p=t.getX(v+1),y=t.getX(v+2);o.fromBufferAttribute(n,m),a.fromBufferAttribute(n,p),s.fromBufferAttribute(n,y),f.subVectors(s,a),h.subVectors(o,a),f.cross(h),u.fromBufferAttribute(e,m),l.fromBufferAttribute(e,p),c.fromBufferAttribute(e,y),u.add(f),l.add(f),c.add(f),e.setXYZ(m,u.x,u.y,u.z),e.setXYZ(p,l.x,l.y,l.z),e.setXYZ(y,c.x,c.y,c.z)}else for(var g=0,b=n.count;g<b;g+=3)o.fromBufferAttribute(n,g+0),a.fromBufferAttribute(n,g+1),s.fromBufferAttribute(n,g+2),f.subVectors(s,a),h.subVectors(o,a),f.cross(h),e.setXYZ(g+0,f.x,f.y,f.z),e.setXYZ(g+1,f.x,f.y,f.z),e.setXYZ(g+2,f.x,f.y,f.z);this.normalizeNormals(),e.needsUpdate=!0}}},{key:"normalizeNormals",value:function(){for(var t=this.attributes.normal,n=0,e=t.count;n<e;n++)g.fromBufferAttribute(t,n),g.normalize(),t.setXYZ(n,g.x,g.y,g.z)}},{key:"toNonIndexed",value:function(){function t(t,n){for(var e=t.array,i=t.itemSize,r=t.normalized,o=new e.constructor(n.length*i),a=0,s=0,u=0,l=n.length;u<l;u++)for(var a=t.isInterleavedBufferAttribute?n[u]*t.data.stride+t.offset:n[u]*i,c=0;c<i;c++)o[s++]=e[a++];return new H(o,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var n,e=new y,i=this.index.array,r=this.attributes;for(n in r){var o=t(r[n],i);e.setAttribute(n,o)}var a,s=this.morphAttributes;for(a in s){for(var u=[],l=s[a],c=0,f=l.length;c<f;c++){var h=t(l[c],i);u.push(h)}e.morphAttributes[a]=u}e.morphTargetsRelative=this.morphTargetsRelative;for(var v=this.groups,d=0,m=v.length;d<m;d++){var p=v[d];e.addGroup(p.start,p.count,p.materialIndex)}return e}},{key:"toJSON",value:function(){var t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),0<Object.keys(this.userData).length&&(t.userData=this.userData),void 0!==this.parameters){var n,e=this.parameters;for(n in e)void 0!==e[n]&&(t[n]=e[n])}else{t.data={attributes:{}};var i,r=this.index,o=(null!==r&&(t.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)}),this.attributes);for(i in o){var a=o[i];t.data.attributes[i]=a.toJSON(t.data)}var s,u={},l=!1;for(s in this.morphAttributes){for(var c=this.morphAttributes[s],f=[],h=0,v=c.length;h<v;h++){var d=c[h];f.push(d.toJSON(t.data))}0<f.length&&(u[s]=f,l=!0)}l&&(t.data.morphAttributes=u,t.data.morphTargetsRelative=this.morphTargetsRelative);r=this.groups,r=(0<r.length&&(t.data.groups=JSON.parse(JSON.stringify(r))),this.boundingSphere);null!==r&&(t.data.boundingSphere={center:r.center.toArray(),radius:r.radius})}return t}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var n,e={},i=(this.name=t.name,t.index),r=(null!==i&&this.setIndex(i.clone(e)),t.attributes);for(n in r){var o=r[n];this.setAttribute(n,o.clone(e))}var a,s=t.morphAttributes;for(a in s){for(var u=[],l=s[a],c=0,f=l.length;c<f;c++)u.push(l[c].clone(e));this.morphAttributes[a]=u}this.morphTargetsRelative=t.morphTargetsRelative;for(var h=t.groups,v=0,d=h.length;v<d;v++){var m=h[v];this.addGroup(m.start,m.count,m.materialIndex)}i=t.boundingBox,null!==i&&(this.boundingBox=i.clone()),i=t.boundingSphere;return null!==i&&(this.boundingSphere=i.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}])&&Re(n.prototype,e),t&&Re(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})(),ze={enabled:!1,files:{},add:function(t,n){!1!==this.enabled&&(this.files[t]=n)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function Ge(t){return(Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xe(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Ge(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Ge(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Ge(t)?t:t+""))(i.key),i)}}function Ye(t,n,e){return n&&Xe(t.prototype,n),e&&Xe(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var We=new(Ye(function t(n,e,i){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");var r=this,o=!1,a=0,s=0,u=void 0,l=[];this.onStart=void 0,this.onLoad=n,this.onProgress=e,this.onError=i,this.record=new Map,this.itemStart=function(t){this.record.has(t)||this.record.set(t,{}),s++,!1===o&&void 0!==r.onStart&&r.onStart(t,a,s),o=!0},this.itemEnd=function(t){this.record.delete(t),a++,void 0!==r.onProgress&&r.onProgress(t,a,s),a===s&&(o=!1,void 0!==r.onLoad)&&r.onLoad()},this.itemError=function(t){this.record.delete(t),void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return u?u(t):t},this.setURLModifier=function(t){return u=t,this},this.addHandler=function(t,n){return l.push(t,n),this},this.removeHandler=function(t){t=l.indexOf(t);return-1!==t&&l.splice(t,2),this},this.getHandler=function(t){for(var n=0,e=l.length;n<e;n+=2){var i=l[n],r=l[n+1];if(i.global&&(i.lastIndex=0),i.test(t))return r}return null},this.isLoaded=function(){return 0===this.record.size}}));function Qe(t){return(Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function qe(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Qe(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Qe(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Qe(t)?t:t+""))(i.key),i)}}var Ze=(()=>{function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.manager=void 0!==t?t:We,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}return t=n,(e=[{key:"load",value:function(){}},{key:"loadAsync",value:function(e,i){var r=this;return new Promise(function(t,n){r.load(e,t,i,n)})}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(t){return this.crossOrigin=t,this}},{key:"setWithCredentials",value:function(t){return this.withCredentials=t,this}},{key:"setPath",value:function(t){return this.path=t,this}},{key:"setResourcePath",value:function(t){return this.resourcePath=t,this}},{key:"setRequestHeader",value:function(t){return this.requestHeader=t,this}}])&&qe(t.prototype,e),i&&qe(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i})();function Je(t){return(Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ke(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Je(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Je(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Je(t)?t:t+""))(i.key),i)}}function $e(t,n,e){n=ni(n);var i=t,n=ti()?Reflect.construct(n,e||[],ni(t).constructor):n.apply(t,e);if(!n||"object"!=Je(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function ti(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ti=function(){return!!t})()}function ni(t){return(ni=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ei(t,n){return(ei=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}Ze.DEFAULT_MATERIAL_NAME="__DEFAULT";var ii,ri=(()=>{function n(t){if(this instanceof n)return $e(this,n,[t]);throw new TypeError("Cannot call a class as a function")}var t,e=n,i=Ze;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&ei(e,i),e=n,(i=[{key:"load",value:function(n,t,e,i){void 0!==this.path&&(n=this.path+n),n=this.manager.resolveURL(n);var r,o,a,s,u,l,c,f,h=this,v=ze.get(n);return void 0!==v?(h.manager.itemStart(n),setTimeout(function(){t&&t(v),h.manager.itemEnd(n)},0),v):Ne.environment===Pe.WX?(o=t,a=i,s=ze,u=h,(r=n).includes(wx.env.USER_DATA_PATH)?(c=wx.getFileSystemManager()).readFile({filePath:r,encoding:"base64",success:function(t){var t="data:image/png;base64,".concat(t.data),n=Ne.textureHelper.createImage({url:t,onload:function(){s.add(r,n),o&&o(n),u.manager.itemEnd(r),c.unlink({filePath:r,fail:function(t){},success:function(){}})}})},fail:function(t){console.error(t),a&&a(t),u.manager.itemError(r),u.manager.itemEnd(r)}}):l=Ne.textureHelper.createImage({url:r,onload:function(){s.add(r,l),o&&o(l),u.manager.itemEnd(r)},onerror:function(t){console.error(t),a&&a(t),u.manager.itemError(r),u.manager.itemEnd(r)}}),l):((f=Ce("img")).addEventListener("load",d,!1),f.addEventListener("error",m,!1),"data:"!==n.slice(0,5)&&void 0!==this.crossOrigin&&(f.crossOrigin=this.crossOrigin),h.manager.itemStart(n),f.src=n,f);function d(){p(),ze.add(n,this),t&&t(this),h.manager.itemEnd(n)}function m(t){p(),i&&i(t),h.manager.itemError(n),h.manager.itemEnd(n)}function p(){f.removeEventListener("load",d,!1),f.removeEventListener("error",m,!1)}}}])&&Ke(e.prototype,i),t&&Ke(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e})();function oi(t){return(oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ai(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=oi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=oi(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==oi(t)?t:t+""))(i.key),i)}}var si=(()=>{function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")}return n=t,i=[{key:"getDataURL",value:function(t){var n;return/^data:/i.test(t.src)||"undefined"==typeof HTMLCanvasElement?t.src:2048<(n=t instanceof HTMLCanvasElement?t:((ii=void 0===ii?Ce("canvas"):ii).width=t.width,ii.height=t.height,n=ii.getContext("2d"),t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),ii)).width||2048<n.height?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}},{key:"sRGBToLinear",value:function(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){for(var n=Ce("canvas"),e=(n.width=t.width,n.height=t.height,n.getContext("2d")),i=(e.drawImage(t,0,0,t.width,t.height),e.getImageData(0,0,t.width,t.height)),r=i.data,o=0;o<r.length;o++)r[o]=255*ft(r[o]/255);return e.putImageData(i,0,0),n}if(t.data){for(var a=t.data.slice(0),s=0;s<a.length;s++)a instanceof Uint8Array||a instanceof Uint8ClampedArray?a[s]=Math.floor(255*ft(a[s]/255)):a[s]=ft(a[s]);return{data:a,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}],(e=null)&&ai(n.prototype,e),i&&ai(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,e,i})();function ui(t){return(ui="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function li(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=ui(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=ui(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==ui(t)?t:t+""))(i.key),i)}}var ci=0,fi=(()=>{return t=function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=this,i=t;if(!(e instanceof i))throw new TypeError("Cannot call a class as a function");this.isSource=!0,Object.defineProperty(this,"id",{value:ci++}),this.uuid=j(),this.data=n,this.dataReady=!0,this.version=0},(n=[{key:"needsUpdate",set:function(t){!0===t&&this.version++}},{key:"toJSON",value:function(t){var n=void 0===t||"string"==typeof t;if(!n&&void 0!==t.images[this.uuid])return t.images[this.uuid];var e={uuid:this.uuid,url:""},i=this.data;if(null!==i){if(Array.isArray(i))for(var r=[],o=0,a=i.length;o<a;o++)i[o].isDataTexture?r.push(hi(i[o].image)):r.push(hi(i[o]));else r=hi(i);e.url=r}return n||(t.images[this.uuid]=e),e}}])&&li(t.prototype,n),e&&li(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,e})();function hi(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?si.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}function vi(t){return(vi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function di(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=vi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=vi(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==vi(t)?t:t+""))(i.key),i)}}function mi(t,n,e){n=yi(n);var i=t,n=pi()?Reflect.construct(n,e||[],yi(t).constructor):n.apply(t,e);if(!n||"object"!=vi(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function pi(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(pi=function(){return!!t})()}function yi(t){return(yi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function gi(t,n){return(gi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var bi=0,_i=(()=>{function h(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:h.DEFAULT_IMAGE,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:h.DEFAULT_MAPPING,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:q,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:q,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:O,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:1008,a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:J,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:1009,u=8<arguments.length&&void 0!==arguments[8]?arguments[8]:h.DEFAULT_ANISOTROPY,l=9<arguments.length&&void 0!==arguments[9]?arguments[9]:"",c=this,f=h;if(c instanceof f)return(c=mi(this,h)).isTexture=!0,Object.defineProperty(c,"id",{value:bi++}),c.uuid=j(),c.name="",c.source=new fi(t),c.mipmaps=[],c.mapping=n,c.channel=0,c.wrapS=e,c.wrapT=i,c.magFilter=r,c.minFilter=o,c.anisotropy=u,c.format=a,c.internalFormat=null,c.type=s,c.offset=new B(0,0),c.repeat=new B(1,1),c.center=new B(0,0),c.rotation=0,c.matrixAutoUpdate=!0,c.matrix=new v,c.generateMipmaps=!0,c.premultiplyAlpha=!1,c.flipY=!0,c.unpackAlignment=4,c.colorSpace=l,c.userData={},c.version=0,c.onUpdate=null,c.isRenderTargetTexture=!1,c.pmremVersion=0,c;throw new TypeError("Cannot call a class as a function")}var t,n=h,e=Et;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&gi(n,e),n=h,(e=[{key:"image",get:function(){return this.source.data},set:function(){this.source.data=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null}},{key:"updateMatrix",value:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}},{key:"toJSON",value:function(t){var n,e=void 0===t||"string"==typeof t;return e||void 0===t.textures[this.uuid]?(n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment},0<Object.keys(this.userData).length&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n):t.textures[this.uuid]}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function(t){if(300===this.mapping){if(t.applyMatrix3(this.matrix),t.x<0||1<t.x)switch(this.wrapS){case Q:t.x=t.x-Math.floor(t.x);break;case q:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||1<t.y)switch(this.wrapT){case Q:t.y=t.y-Math.floor(t.y);break;case q:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}return t}},{key:"needsUpdate",set:function(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}},{key:"needsPMREMUpdate",set:function(t){!0===t&&this.pmremVersion++}}])&&di(n.prototype,e),t&&di(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function wi(t){return(wi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Si(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=wi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=wi(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==wi(t)?t:t+""))(i.key),i)}}function xi(t,n,e){n=Ei(n);var i=t,n=Ai()?Reflect.construct(n,e||[],Ei(t).constructor):n.apply(t,e);if(!n||"object"!=wi(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Ai(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ai=function(){return!!t})()}function Ei(t){return(Ei=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ti(t,n){return(Ti=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}_i.DEFAULT_IMAGE=null,_i.DEFAULT_MAPPING=300,_i.DEFAULT_ANISOTROPY=1;var Mi=(()=>{function n(t){if(this instanceof n)return xi(this,n,[t]);throw new TypeError("Cannot call a class as a function")}var t,e=n,i=Ze;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Ti(e,i),e=n,(i=[{key:"load",value:function(t,n,e,i){var r=new _i,o=new ri(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(t){r.image=t,r.needsUpdate=!0,void 0!==n&&n(r)},e,i),r}}])&&Si(e.prototype,i),t&&Si(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e})();function Pi(t){return(Pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Oi(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Pi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Pi(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Pi(t)?t:t+""))(i.key),i)}}var Ni=new U,Ci=new U,Li=new U,Ri=new U,Di=new U,Fi=new U,Ii=new U,t=(()=>{return t=function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new U,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new U(0,0,-1),i=this,r=t;if(!(i instanceof r))throw new TypeError("Cannot call a class as a function");this.origin=n,this.direction=e},(n=[{key:"set",value:function(t,n){return this.origin.copy(t),this.direction.copy(n),this}},{key:"copy",value:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}},{key:"at",value:function(t,n){return n.copy(this.origin).addScaledVector(this.direction,t)}},{key:"lookAt",value:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this}},{key:"recast",value:function(t){return this.origin.copy(this.at(t,Ni)),this}},{key:"closestPointToPoint",value:function(t,n){n.subVectors(t,this.origin);t=n.dot(this.direction);return t<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,t)}},{key:"distanceToPoint",value:function(t){return Math.sqrt(this.distanceSqToPoint(t))}},{key:"distanceSqToPoint",value:function(t){var n=Ni.subVectors(t,this.origin).dot(this.direction);return(n<0?this.origin:(Ni.copy(this.origin).addScaledVector(this.direction,n),Ni)).distanceToSquared(t)}},{key:"distanceSqToSegment",value:function(t,n,e,i){Ci.copy(t).add(n).multiplyScalar(.5),Li.copy(n).sub(t).normalize(),Ri.copy(this.origin).sub(Ci);var r,o,a,t=.5*t.distanceTo(n),n=-this.direction.dot(Li),s=Ri.dot(this.direction),u=-Ri.dot(Li),l=Ri.lengthSq(),c=Math.abs(1-n*n);return c=0<c?(o=n*s-u,a=t*c,0<=(r=n*u-s)?-a<=o?o<=a?(r*=c=1/c)*(r+n*(o*=c)+2*s)+o*(n*r+o+2*u)+l:(o=t,-(r=Math.max(0,-(n*o+s)))*r+o*(o+2*u)+l):(o=-t,-(r=Math.max(0,-(n*o+s)))*r+o*(o+2*u)+l):o<=-a?-(r=Math.max(0,-(-n*t+s)))*r+(o=0<r?-t:Math.min(Math.max(-t,-u),t))*(o+2*u)+l:o<=a?(r=0,(o=Math.min(Math.max(-t,-u),t))*(o+2*u)+l):-(r=Math.max(0,-(n*t+s)))*r+(o=0<r?t:Math.min(Math.max(-t,-u),t))*(o+2*u)+l):(o=0<n?-t:t,-(r=Math.max(0,-(n*o+s)))*r+o*(o+2*u)+l),e&&e.copy(this.origin).addScaledVector(this.direction,r),i&&i.copy(Ci).addScaledVector(Li,o),c}},{key:"intersectSphere",value:function(t,n){Ni.subVectors(t.center,this.origin);var e=Ni.dot(this.direction),i=Ni.dot(Ni)-e*e,t=t.radius*t.radius;return t<i||(i=e-(t=Math.sqrt(t-i)),(e=e+t)<0)?null:i<0?this.at(e,n):this.at(i,n)}},{key:"intersectsSphere",value:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}},{key:"distanceToPlane",value:function(t){var n=t.normal.dot(this.direction);return 0===n?0===t.distanceToPoint(this.origin)?0:null:0<=(t=-(this.origin.dot(t.normal)+t.constant)/n)?t:null}},{key:"intersectPlane",value:function(t,n){t=this.distanceToPlane(t);return null===t?null:this.at(t,n)}},{key:"intersectsPlane",value:function(t){var n=t.distanceToPoint(this.origin);return 0===n||t.normal.dot(this.direction)*n<0}},{key:"intersectBox",value:function(t,n){var e,i,r,o=1/this.direction.x,a=1/this.direction.y,s=1/this.direction.z,u=this.origin,o=0<=o?(e=(t.min.x-u.x)*o,(t.max.x-u.x)*o):(e=(t.max.x-u.x)*o,(t.min.x-u.x)*o),a=0<=a?(r=(t.min.y-u.y)*a,(t.max.y-u.y)*a):(r=(t.max.y-u.y)*a,(t.min.y-u.y)*a);return a<e||o<r||((e<r||isNaN(e))&&(e=r),(a<o||isNaN(o))&&(o=a),(r=0<=s?(i=(t.min.z-u.z)*s,(t.max.z-u.z)*s):(i=(t.max.z-u.z)*s,(t.min.z-u.z)*s))<e)||o<i||((e<i||e!=e)&&(e=i),(o=r<o||o!=o?r:o)<0)?null:this.at(0<=e?e:o,n)}},{key:"intersectsBox",value:function(t){return null!==this.intersectBox(t,Ni)}},{key:"intersectTriangle",value:function(t,n,e,i,r){Di.subVectors(n,t),Fi.subVectors(e,t),Ii.crossVectors(Di,Fi);var o,n=this.direction.dot(Ii);if(0<n){if(i)return null;o=1}else{if(!(n<0))return null;o=-1,n=-n}Ri.subVectors(this.origin,t);e=o*this.direction.dot(Fi.crossVectors(Ri,Fi));return e<0||(i=o*this.direction.dot(Di.cross(Ri)))<0||n<e+i||(t=-o*Ri.dot(Ii))<0?null:this.at(t/n,r)}},{key:"applyMatrix4",value:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}},{key:"equals",value:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}])&&Oi(t.prototype,n),e&&Oi(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,e})();function ki(t){return(ki="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ji(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=ki(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=ki(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==ki(t)?t:t+""))(i.key),i)}}function Ui(t,n,e){n=Vi(n);var i=t,n=Bi()?Reflect.construct(n,e||[],Vi(t).constructor):n.apply(t,e);if(!n||"object"!=ki(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Bi(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Bi=function(){return!!t})()}function Hi(){return(Hi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=Vi(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function Vi(t){return(Vi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function zi(t,n){return(zi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Gi=new C,Xi=new t,Yi=new Bn,Wi=new U,Qi=(()=>{function s(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Ve,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Ht,e=this,i=s;if(e instanceof i)return(e=Ui(this,s)).isPoints=!0,e.type="Points",e.geometry=t,e.material=n,e.updateMorphTargets(),e;throw new TypeError("Cannot call a class as a function")}var t,n=s,e=Me;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&zi(n,e),n=s,(e=[{key:"copy",value:function(t,n){var e,i,r,o,a;return e=s,i="copy",r=this,a=Hi(Vi(1&(o=3)?e.prototype:e),i,r),(2&o&&"function"==typeof a?function(t){return a.apply(r,t)}:a)([t,n]),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}},{key:"raycast",value:function(t,n){var e=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold,o=e.drawRange;if(null===e.boundingSphere&&e.computeBoundingSphere(),Yi.copy(e.boundingSphere),Yi.applyMatrix4(i),Yi.radius+=r,!1!==t.ray.intersectsSphere(Yi)){Gi.copy(i).invert(),Xi.copy(t.ray).applyMatrix4(Gi);var r=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=r*r,s=e.index,u=e.attributes.position;if(null!==s)for(var l=Math.max(0,o.start),c=Math.min(s.count,o.start+o.count);l<c;l++){var f=s.getX(l);Wi.fromBufferAttribute(u,f),qi(Wi,f,a,i,t,n,this)}else for(var h=Math.max(0,o.start),v=Math.min(u.count,o.start+o.count);h<v;h++)Wi.fromBufferAttribute(u,h),qi(Wi,h,a,i,t,n,this)}}},{key:"updateMorphTargets",value:function(){var t=this.geometry.morphAttributes,n=Object.keys(t);if(0<n.length){var e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,r=e.length;i<r;i++){var o=e[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=i}}}}}])&&ji(n.prototype,e),t&&ji(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function qi(t,n,e,i,r,o,a){var s=Xi.distanceSqToPoint(t);s<e&&(e=new U,Xi.closestPointToPoint(t,e),e.applyMatrix4(i),(t=r.ray.origin.distanceTo(e))<r.near||t>r.far||o.push({distance:t,distanceToRay:Math.sqrt(s),point:e,index:n,face:null,faceIndex:null,barycoord:null,object:a}))}function Zi(t){return(Zi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ji(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Zi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Zi(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Zi(t)?t:t+""))(i.key),i)}}var Ki=(()=>{function i(t,n){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");var e=new Ht({opacity:1,transparent:!0,depthTest:!1,size:5}),n=(this.material=e,this.geo=new Ve,(new Mi).load(n));e.map=n,e.needsUpdate=!0,this.pointsArrayLength=t.length,this.pointsArray=t,this.geo.setFromPoints(t),this.plength=t.length,this.points=new Qi(this.geo,e)}return t=i,(n=[{key:"updatePoints",value:function(t){this.geo.setFromPoints(t)}},{key:"changePositions",value:function(t,n,e,i,r){for(var o=this.geo.attributes.position,a=0;a<this.plength;a++){var s=o.getX(a)+t*this.runstatus[a].x.sign*this.runstatus[a].x.weight,u=o.getY(a)+n*this.runstatus[a].y.sign*this.runstatus[a].y.weight,l=o.getZ(a)+e*this.runstatus[a].z.sign*this.runstatus[a].z.weight;i(s,u,l)?o.setXYZ(a,s,u,l):(s=r(),o.setXYZ(a,s.x,s.y,s.z))}o.needsUpdate=!0}},{key:"setRunStatus",value:function(t){this.runstatus=t}},{key:"setParticleCount",value:function(t){this.pointsArray.length=this.pointsArrayLength*t,this.geo.setFromPoints(this.pointsArray),this.points=new Qi(this.geo,this.material)}}])&&Ji(t.prototype,n),e&&Ji(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,e})(),n={NONE:0,EXTRUDE_MARKER:2,FM3DTILE_LAYER:4,IMAGE_MARKER:8,LOCATION_MARKER:16,POLYGON_MARKER:32,TEXT_MARKER:64,LINE_MARKER:128,LINE3D_MARKER:256,HEAT_MAP_MARKER:512,EXTENT:1024,EXTERNAL_MODEL:2048,MODEL:4096,FACILITY:8192,LABEL:16384,DYNAMIC_MODEL_MARKER:32768,DOM_MARKER:65536,SPHERE_MARKER:1<<17,CAD_LAYER:1<<18,EXTENT_LAYER:1<<20,EXTERNAL_MODEL_LAYER:1<<21,MODEL_LAYER:1<<22,FACILITY_LAYER:1<<23,LABEL_LAYER:1<<24,MARKER_GROUP:1<<25,FLOW_LINE_LAYER:1<<27,FLOW_LINE_MARKER:1<<27,FIRE_MARKER:1<<28,WALL_MARKER:1<<29,TUBE_MARKER:1<<30},T=(n.LAYER_NODE_TYPE=new Map,n.LAYER_NODE_TYPE.set(n.EXTENT_LAYER,n.EXTENT),n.LAYER_NODE_TYPE.set(n.EXTERNAL_MODEL_LAYER,n.EXTERNAL_MODEL),n.LAYER_NODE_TYPE.set(n.MODEL_LAYER,n.MODEL),n.LAYER_NODE_TYPE.set(n.FACILITY_LAYER,n.FACILITY),n.LAYER_NODE_TYPE.set(n.LABEL_LAYER,n.LABEL),n.LAYER_NODE_TYPE.set(n.DOM_MARKER,n.DOM_MARKER),n.LAYER_NODE_TYPE.set(n.DYNAMIC_MODEL_MARKER,n.DYNAMIC_MODEL_MARKER),n.LAYER_NODE_TYPE.set(n.EXTRUDE_MARKER,n.EXTRUDE_MARKER),n.LAYER_NODE_TYPE.set(n.HEAT_MAP_MARKER,n.HEAT_MAP_MARKER),n.LAYER_NODE_TYPE.set(n.LINE_MARKER,n.LINE_MARKER),n.LAYER_NODE_TYPE.set(n.LOCATION_MARKER,n.LOCATION_MARKER),n.LAYER_NODE_TYPE.set(n.POLYGON_MARKER,n.POLYGON_MARKER),n.LAYER_NODE_TYPE.set(n.TEXT_MARKER,n.TEXT_MARKER),n.LAYER_NODE_TYPE.set(n.IMAGE_MARKER,n.IMAGE_MARKER),n.LAYER_NODE_TYPE.set(n.FLOW_LINE_LAYER,n.FLOW_LINE_MARKER),n.LAYER_NODE_TYPE.set(n.FIRE_MARKER,n.FIRE_MARKER),n.LAYER_NODE_TYPE.set(n.WALL_MARKER,n.WALL_MARKER),n.LAYER_NODE_TYPE.set(n.TUBE_MARKER,n.TUBE_MARKER),n.LAYER_NODE_TYPE.set(n.LINE3D_MARKER,n.LINE3D_MARKER),n.LAYER_NODE_TYPE.set(n.SPHERE_MARKER,n.SPHERE_MARKER),n.LAYER_NODE_TYPE.set(n.CAD_LAYER,n.CAD_LAYER),n);function $i(t){return($i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tr(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=$i(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=$i(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==$i(t)?t:t+""))(i.key),i)}}function nr(t,n,e){n=or(n);var i=t,n=er()?Reflect.construct(n,e||[],or(t).constructor):n.apply(t,e);if(!n||"object"!=$i(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function er(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(er=function(){return!!t})()}function ir(t,n,e,i){var r=rr(or(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function rr(){return(rr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=or(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function or(t){return(or=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ar(t,n){return(ar=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var l=(()=>{function e(){var t;if(this instanceof e)return(t=nr(this,e)).isScene=!0,t.type="Scene",t.background=null,t.environment=null,t.fog=null,t.backgroundBlurriness=0,t.backgroundIntensity=1,t.backgroundRotation=new te,t.environmentIntensity=1,t.environmentRotation=new te,t.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:t})),t;throw new TypeError("Cannot call a class as a function")}var t,n=e,i=Me;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),i&&ar(n,i),n=e,(i=[{key:"copy",value:function(t,n){return ir(e,"copy",this,3)([t,n]),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}},{key:"toJSON",value:function(t){t=ir(e,"toJSON",this,3)([t]);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),0<this.backgroundBlurriness&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}])&&tr(n.prototype,i),t&&tr(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function sr(t){return(sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ur(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=sr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=sr(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==sr(t)?t:t+""))(i.key),i)}}function lr(t,n,e){n=vr(n);var i=t,n=cr()?Reflect.construct(n,e||[],vr(t).constructor):n.apply(t,e);if(!n||"object"!=sr(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function cr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(cr=function(){return!!t})()}function fr(t,n,e,i){var r=hr(vr(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function hr(){return(hr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=vr(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function vr(t){return(vr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function dr(t,n){return(dr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var mr=(()=>{function e(){var t;if(this instanceof e)return(t=lr(this,e)).isCamera=!0,t.type="Camera",t.matrixWorldInverse=new C,t.projectionMatrix=new C,t.projectionMatrixInverse=new C,t.coordinateSystem=2e3,t;throw new TypeError("Cannot call a class as a function")}var t,n=e,i=Me;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),i&&dr(n,i),n=e,(i=[{key:"copy",value:function(t,n){return fr(e,"copy",this,3)([t,n]),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}},{key:"getWorldDirection",value:function(t){return fr(e,"getWorldDirection",this,3)([t]).negate()}},{key:"updateMatrixWorld",value:function(t){fr(e,"updateMatrixWorld",this,3)([t]),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function(t,n){fr(e,"updateWorldMatrix",this,3)([t,n]),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}])&&ur(n.prototype,i),t&&ur(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function pr(t){return(pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yr(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=pr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=pr(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==pr(t)?t:t+""))(i.key),i)}}function gr(t,n,e){n=Sr(n);var i=t,n=br()?Reflect.construct(n,e||[],Sr(t).constructor):n.apply(t,e);if(!n||"object"!=pr(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function br(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(br=function(){return!!t})()}function _r(t,n,e,i){var r=wr(Sr(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function wr(){return(wr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=Sr(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function Sr(t){return(Sr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function xr(t,n){return(xr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}n=(()=>{function u(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:-1,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.1,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:2e3,a=this,s=u;if(a instanceof s)return(a=gr(this,u)).isOrthographicCamera=!0,a.type="OrthographicCamera",a.zoom=1,a.view=null,a.left=t,a.right=n,a.top=e,a.bottom=i,a.near=r,a.far=o,a.updateProjectionMatrix(),a;throw new TypeError("Cannot call a class as a function")}var t,n=u,e=mr;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&xr(n,e),n=u,(e=[{key:"copy",value:function(t,n){return _r(u,"copy",this,3)([t,n]),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}},{key:"setViewOffset",value:function(t,n,e,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=n,this.view.offsetX=e,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var t,n=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,o=i-n,i=i+n,n=r+e,r=r-e;null!==this.view&&this.view.enabled&&(e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom,i=(o+=e*this.view.offsetX)+e*this.view.width,r=(n-=t*this.view.offsetY)-t*this.view.height),this.projectionMatrix.makeOrthographic(o,i,n,r,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(t){t=_r(u,"toJSON",this,3)([t]);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}])&&yr(n.prototype,e),t&&yr(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Ar(t){return(Ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Er(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Ar(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Ar(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Ar(t)?t:t+""))(i.key),i)}}function Tr(t,n,e){n=Or(n);var i=t,n=Mr()?Reflect.construct(n,e||[],Or(t).constructor):n.apply(t,e);if(!n||"object"!=Ar(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Mr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Mr=function(){return!!t})()}function Pr(){return(Pr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=Or(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function Or(t){return(Or=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Nr(t,n){return(Nr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var e=(()=>{function T(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,r=this,o=T;if(!(r instanceof o))throw new TypeError("Cannot call a class as a function");(r=Tr(this,T)).type="PlaneGeometry",r.parameters={width:t,height:n,widthSegments:e,heightSegments:i};for(var a=t/2,s=n/2,u=Math.floor(e),l=Math.floor(i),c=u+1,f=l+1,h=t/u,v=n/l,d=[],m=[],p=[],y=[],g=0;g<f;g++)for(var b=g*v-s,_=0;_<c;_++)m.push(_*h-a,-b,0),p.push(0,0,1),y.push(_/u),y.push(1-g/l);for(var w=0;w<l;w++)for(var S=0;S<u;S++){var x=S+c*(w+1),A=S+1+c*(w+1),E=S+1+c*w;d.push(S+c*w,x,E),d.push(x,A,E)}return r.setIndex(d),r.setAttribute("position",new k(m,3)),r.setAttribute("normal",new k(p,3)),r.setAttribute("uv",new k(y,2)),r}var t,n=T,e=Ve;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Nr(n,e),n=T,e=[{key:"fromJSON",value:function(t){return new T(t.width,t.height,t.widthSegments,t.heightSegments)}}],(t=[{key:"copy",value:function(t){var n,e,i,r,o;return n=T,e="copy",i=this,o=Pr(Or(1&(r=3)?n.prototype:n),e,i),(2&r&&"function"==typeof o?function(t){return o.apply(i,t)}:o)([t]),this.parameters=Object.assign({},t.parameters),this}}])&&Er(n.prototype,t),e&&Er(n,e),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Cr(t){return(Cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Lr(){Lr=function(){return a};var u,a={},t=Object.prototype,l=t.hasOwnProperty,c=Object.defineProperty||function(t,n,e){t[n]=e.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",e=n.asyncIterator||"@@asyncIterator",r=n.toStringTag||"@@toStringTag";function o(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{o({},"")}catch(u){o=function(t,n,e){return t[n]=e}}function s(t,n,e,i){var r,o,a,s,n=n&&n.prototype instanceof y?n:y,n=Object.create(n.prototype),i=new T(i||[]);return c(n,"_invoke",{value:(r=t,o=e,a=i,s=h,function(t,n){if(s===d)throw Error("Generator is already running");if(s===m){if("throw"===t)throw n;return{value:u,done:!0}}for(a.method=t,a.arg=n;;){var e=a.delegate;if(e){e=function t(n,e){var i=e.method,r=n.iterator[i];if(r===u)return e.delegate=null,"throw"===i&&n.iterator.return&&(e.method="return",e.arg=u,t(n,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),p;i=f(r,n.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,p;r=i.arg;return r?r.done?(e[n.resultName]=r.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=u),e.delegate=null,p):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}(e,a);if(e){if(e===p)continue;return e}}if("next"===a.method)a.sent=a.v=a.arg;else if("throw"===a.method){if(s===h)throw s=m,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s=d;e=f(r,o,a);if("normal"===e.type){if(s=a.done?m:v,e.arg===p)continue;return{value:e.arg,done:a.done}}"throw"===e.type&&(s=m,a.method="throw",a.arg=e.arg)}})}),n}function f(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}a.wrap=s;var h="suspendedStart",v="suspendedYield",d="executing",m="completed",p={};function y(){}function g(){}function b(){}var n={},_=(o(n,i,function(){return this}),Object.getPrototypeOf),_=_&&_(_(M([]))),w=(_&&_!==t&&l.call(_,i)&&(n=_),b.prototype=y.prototype=Object.create(n));function S(t){["next","throw","return"].forEach(function(n){o(t,n,function(t){return this._invoke(n,t)})})}function x(a,s){var n;c(this,"_invoke",{value:function(e,i){function t(){return new s(function(t,n){!function n(t,e,i,r){var o,t=f(a[t],a,e);if("throw"!==t.type)return(e=(o=t.arg).value)&&"object"==Cr(e)&&l.call(e,"__await")?s.resolve(e._).then(function(t){n("next",t,i,r)},function(t){n("throw",t,i,r)}):s.resolve(e).then(function(t){o.value=t,i(o)},function(t){return n("throw",t,i,r)});r(t.arg)}(e,i,t,n)})}return n=n?n.then(t,t):t()}})}function A(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function E(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function M(n){if(n||""===n){var e,t=n[i];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return e=-1,(t=function t(){for(;++e<n.length;)if(l.call(n,e))return t.value=n[e],t.done=!1,t;return t.value=u,t.done=!0,t}).next=t}throw new TypeError(Cr(n)+" is not iterable")}return c(w,"constructor",{value:g.prototype=b,configurable:!0}),c(b,"constructor",{value:g,configurable:!0}),g.displayName=o(b,r,"GeneratorFunction"),a.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},a.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,o(t,r,"GeneratorFunction")),t.prototype=Object.create(w),t},a.awrap=function(t){return{_:t}},S(x.prototype),o(x.prototype,e,function(){return this}),a.AsyncIterator=x,a.async=function(t,n,e,i,r){void 0===r&&(r=Promise);var o=new x(s(t,n,e,i),r);return a.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},S(w),o(w,r,"Generator"),o(w,i,function(){return this}),o(w,"toString",function(){return"[object Generator]"}),a.keys=function(t){var n,e=Object(t),i=[];for(n in e)i.push(n);return i.reverse(),function t(){for(;i.length;){var n=i.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},a.values=M,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this.v=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(E),!t)for(var n in this)"t"===n.charAt(0)&&l.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=u)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function t(t,n){return o.type="throw",o.arg=e,i.next=t,n&&(i.method="next",i.arg=u),!!n}for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var a=l.call(r,"catchLoc"),s=l.call(r,"finallyLoc");if(a&&s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&l.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var o=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=n&&n<=r.finallyLoc?null:r)?r.completion:{};return o.type=t,o.arg=n,r?(this.method="next",this.next=r.finallyLoc,p):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),p},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),E(e),p}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e,i,r=this.tryEntries[n];if(r.tryLoc===t)return"throw"===(e=r.completion).type&&(i=e.arg,E(r)),i}throw Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:M(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=u),p}},a}function Rr(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Cr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Cr(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Cr(t)?t:t+""))(i.key),i)}}var Dr=(()=>{function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,r=this,o=a;if(!(r instanceof o))throw new TypeError("Cannot call a class as a function");a.prototype.isVector4=!0,this.x=t,this.y=n,this.z=e,this.w=i}return t=a,(n=[{key:"width",get:function(){return this.z},set:function(t){this.z=t}},{key:"height",get:function(){return this.w},set:function(t){this.w=t}},{key:"set",value:function(t,n,e,i){return this.x=t,this.y=n,this.z=e,this.w=i,this}},{key:"setScalar",value:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setZ",value:function(t){return this.z=t,this}},{key:"setW",value:function(t){return this.w=t,this}},{key:"setComponent",value:function(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+t)}return this}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}},{key:"addVectors",value:function(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this.z=t.z+n.z,this.w=t.w+n.w,this}},{key:"addScaledVector",value:function(t,n){return this.x+=t.x*n,this.y+=t.y*n,this.z+=t.z*n,this.w+=t.w*n,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}},{key:"subVectors",value:function(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this.z=t.z-n.z,this.w=t.w-n.w,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}},{key:"applyMatrix4",value:function(t){var n=this.x,e=this.y,i=this.z,r=this.w,t=t.elements;return this.x=t[0]*n+t[4]*e+t[8]*i+t[12]*r,this.y=t[1]*n+t[5]*e+t[9]*i+t[13]*r,this.z=t[2]*n+t[6]*e+t[10]*i+t[14]*r,this.w=t[3]*n+t[7]*e+t[11]*i+t[15]*r,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"setAxisAngleFromQuaternion",value:function(t){this.w=2*Math.acos(t.w);var n=Math.sqrt(1-t.w*t.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/n,this.y=t.y/n,this.z=t.z/n),this}},{key:"setAxisAngleFromRotationMatrix",value:function(t){var n,e,i,r,o,a,s,u,l,c,t=t.elements,f=t[0],h=t[4],v=t[8],d=t[1],m=t[5],p=t[9],y=t[2],g=t[6],t=t[10];return Math.abs(h-d)<.01&&Math.abs(v-y)<.01&&Math.abs(p-g)<.01?Math.abs(h+d)<.1&&Math.abs(v+y)<.1&&Math.abs(p+g)<.1&&Math.abs(f+m+t-3)<.1?this.set(1,0,0,0):(r=Math.PI,a=(t+1)/2,s=(h+d)/4,u=(v+y)/4,l=(p+g)/4,(o=(m+1)/2)<(c=(f+1)/2)&&a<c?i=c<.01?(n=0,e=.707106781):(e=s/(n=Math.sqrt(c)),u/n):a<o?i=o<.01?(e=0,n=.707106781):(n=s/(e=Math.sqrt(o)),l/e):a<.01?(e=n=.707106781,i=0):(n=u/(i=Math.sqrt(a)),e=l/i),this.set(n,e,i,r)):(c=Math.sqrt((g-p)*(g-p)+(v-y)*(v-y)+(d-h)*(d-h)),Math.abs(c)<.001&&(c=1),this.x=(g-p)/c,this.y=(v-y)/c,this.z=(d-h)/c,this.w=Math.acos((f+m+t-1)/2)),this}},{key:"setFromMatrixPosition",value:function(t){t=t.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}},{key:"clamp",value:function(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this.z=Math.max(t.z,Math.min(n.z,this.z)),this.w=Math.max(t.w,Math.min(n.w,this.w)),this}},{key:"clampScalar",value:function(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this.z=Math.max(t,Math.min(n,this.z)),this.w=Math.max(t,Math.min(n,this.w)),this}},{key:"clampLength",value:function(t,n){var e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(n,e)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"lerp",value:function(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this.z+=(t.z-this.z)*n,this.w+=(t.w-this.w)*n,this}},{key:"lerpVectors",value:function(t,n,e){return this.x=t.x+(n.x-t.x)*e,this.y=t.y+(n.y-t.y)*e,this.z=t.z+(n.z-t.z)*e,this.w=t.w+(n.w-t.w)*e,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}},{key:"fromArray",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[n],this.y=t[n+1],this.z=t[n+2],this.w=t[n+3],this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return t[n]=this.x,t[n+1]=this.y,t[n+2]=this.z,t[n+3]=this.w,t}},{key:"fromBufferAttribute",value:function(t,n){return this.x=t.getX(n),this.y=t.getY(n),this.z=t.getZ(n),this.w=t.getW(n),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},{key:Symbol.iterator,value:Lr().mark(function t(){return Lr().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.x;case 2:return t.next=4,this.y;case 4:return t.next=6,this.z;case 6:return t.next=8,this.w;case 8:case"end":return t.stop()}},t,this)})}])&&Rr(t.prototype,n),e&&Rr(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,e})();function Fr(t){return(Fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ir(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Fr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Fr(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Fr(t)?t:t+""))(i.key),i)}}var kr=new U,jr=new U,Ur=new U,Br=new U,Hr=new U,Vr=new U,zr=new U,Gr=new U,Xr=new U,Yr=new U,Wr=new Dr,Qr=new Dr,qr=new Dr,Zr=(()=>{function o(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new U,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new U,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new U,i=this,r=o;if(!(i instanceof r))throw new TypeError("Cannot call a class as a function");this.a=t,this.b=n,this.c=e}return t=o,e=[{key:"getNormal",value:function(t,n,e,i){i.subVectors(e,n),kr.subVectors(t,n),i.cross(kr);e=i.lengthSq();return 0<e?i.multiplyScalar(1/Math.sqrt(e)):i.set(0,0,0)}},{key:"getBarycoord",value:function(t,n,e,i,r){kr.subVectors(i,n),jr.subVectors(e,n),Ur.subVectors(t,n);var i=kr.dot(kr),e=kr.dot(jr),t=kr.dot(Ur),n=jr.dot(jr),o=jr.dot(Ur),a=i*n-e*e;return 0==a?(r.set(0,0,0),null):r.set(1-(n=(n*t-e*o)*(r=1/a))-(a=(i*o-e*t)*r),a,n)}},{key:"containsPoint",value:function(t,n,e,i){return null!==this.getBarycoord(t,n,e,i,Br)&&0<=Br.x&&0<=Br.y&&Br.x+Br.y<=1}},{key:"getInterpolation",value:function(t,n,e,i,r,o,a,s){return null===this.getBarycoord(t,n,e,i,Br)?(s.x=0,s.y=0,"z"in s&&(s.z=0),"w"in s&&(s.w=0),null):(s.setScalar(0),s.addScaledVector(r,Br.x),s.addScaledVector(o,Br.y),s.addScaledVector(a,Br.z),s)}},{key:"getInterpolatedAttribute",value:function(t,n,e,i,r,o){return Wr.setScalar(0),Qr.setScalar(0),qr.setScalar(0),Wr.fromBufferAttribute(t,n),Qr.fromBufferAttribute(t,e),qr.fromBufferAttribute(t,i),o.setScalar(0),o.addScaledVector(Wr,r.x),o.addScaledVector(Qr,r.y),o.addScaledVector(qr,r.z),o}},{key:"isFrontFacing",value:function(t,n,e,i){return kr.subVectors(e,n),jr.subVectors(t,n),kr.cross(jr).dot(i)<0}}],(n=[{key:"set",value:function(t,n,e){return this.a.copy(t),this.b.copy(n),this.c.copy(e),this}},{key:"setFromPointsAndIndices",value:function(t,n,e,i){return this.a.copy(t[n]),this.b.copy(t[e]),this.c.copy(t[i]),this}},{key:"setFromAttributeAndIndices",value:function(t,n,e,i){return this.a.fromBufferAttribute(t,n),this.b.fromBufferAttribute(t,e),this.c.fromBufferAttribute(t,i),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}},{key:"getArea",value:function(){return kr.subVectors(this.c,this.b),jr.subVectors(this.a,this.b),.5*kr.cross(jr).length()}},{key:"getMidpoint",value:function(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(t){return o.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(t,n){return o.getBarycoord(t,this.a,this.b,this.c,n)}},{key:"getInterpolation",value:function(t,n,e,i,r){return o.getInterpolation(t,this.a,this.b,this.c,n,e,i,r)}},{key:"containsPoint",value:function(t){return o.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(t){return o.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function(t){return t.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(t,n){var e=this.a,i=this.b,r=this.c,o=(Hr.subVectors(i,e),Vr.subVectors(r,e),Gr.subVectors(t,e),Hr.dot(Gr)),a=Vr.dot(Gr);if(o<=0&&a<=0)return n.copy(e);Xr.subVectors(t,i);var s=Hr.dot(Xr),u=Vr.dot(Xr);if(0<=s&&u<=s)return n.copy(i);var l=o*u-s*a;if(l<=0&&0<=o&&s<=0)return c=o/(o-s),n.copy(e).addScaledVector(Hr,c);Yr.subVectors(t,r);var c,f,t=Hr.dot(Yr),h=Vr.dot(Yr);return 0<=h&&t<=h?n.copy(r):(o=t*a-o*h)<=0&&0<=a&&h<=0?(f=a/(a-h),n.copy(e).addScaledVector(Vr,f)):(a=s*h-t*u)<=0&&0<=u-s&&0<=t-h?(zr.subVectors(r,i),f=(u-s)/(u-s+(t-h)),n.copy(i).addScaledVector(zr,f)):(c=o*(r=1/(a+o+l)),f=l*r,n.copy(e).addScaledVector(Hr,c).addScaledVector(Vr,f))}},{key:"equals",value:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}])&&Ir(t.prototype,n),e&&Ir(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,e})();function Jr(t){return(Jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Kr(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Jr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Jr(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Jr(t)?t:t+""))(i.key),i)}}function $r(t,n,e){n=eo(n);var i=t,n=to()?Reflect.construct(n,e||[],eo(t).constructor):n.apply(t,e);if(!n||"object"!=Jr(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function to(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(to=function(){return!!t})()}function no(){return(no="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=eo(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function eo(t){return(eo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function io(t,n){return(io=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var b=(()=>{function a(t){var n;if(this instanceof a)return(n=$r(this,a)).isMeshBasicMaterial=!0,n.type="MeshBasicMaterial",n.color=new N(16777215),n.map=null,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=null,n.aoMapIntensity=1,n.specularMap=null,n.alphaMap=null,n.envMap=null,n.envMapRotation=new te,n.combine=0,n.reflectivity=1,n.refractionRatio=.98,n.wireframe=!1,n.wireframeLinewidth=1,n.wireframeLinecap="round",n.wireframeLinejoin="round",n.fog=!0,n.setValues(t),n;throw new TypeError("Cannot call a class as a function")}var t,n=a,e=Rt;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&io(n,e),n=a,(e=[{key:"copy",value:function(t){var n,e,i,r,o;return n=a,e="copy",i=this,o=no(eo(1&(r=3)?n.prototype:n),e,i),(2&r&&"function"==typeof o?function(t){return o.apply(i,t)}:o)([t]),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}])&&Kr(n.prototype,e),t&&Kr(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function ro(t){return(ro="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function oo(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=ro(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=ro(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==ro(t)?t:t+""))(i.key),i)}}function ao(t,n,e){n=lo(n);var i=t,n=so()?Reflect.construct(n,e||[],lo(t).constructor):n.apply(t,e);if(!n||"object"!=ro(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function so(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(so=function(){return!!t})()}function uo(){return(uo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=lo(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function lo(t){return(lo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function co(t,n){return(co=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var fo=new C,ho=new t,vo=new Bn,mo=new U,po=new U,yo=new U,go=new U,bo=new U,_o=new U,wo=new U,So=new U,_=(()=>{function s(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Ve,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new b,e=this,i=s;if(e instanceof i)return(e=ao(this,s)).isMesh=!0,e.type="Mesh",e.geometry=t,e.material=n,e.updateMorphTargets(),e;throw new TypeError("Cannot call a class as a function")}var t,n=s,e=Me;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&co(n,e),n=s,(e=[{key:"copy",value:function(t,n){var e,i,r,o,a;return e=s,i="copy",r=this,a=uo(lo(1&(o=3)?e.prototype:e),i,r),(2&o&&"function"==typeof a?function(t){return a.apply(r,t)}:a)([t,n]),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}},{key:"updateMorphTargets",value:function(){var t=this.geometry.morphAttributes,n=Object.keys(t);if(0<n.length){var e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,r=e.length;i<r;i++){var o=e[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=i}}}}},{key:"getVertexPosition",value:function(t,n){var e=this.geometry,i=e.attributes.position,r=e.morphAttributes.position,o=e.morphTargetsRelative,a=(n.fromBufferAttribute(i,t),this.morphTargetInfluences);if(r&&a){_o.set(0,0,0);for(var s=0,u=r.length;s<u;s++){var l=a[s],c=r[s];0!==l&&(bo.fromBufferAttribute(c,t),o?_o.addScaledVector(bo,l):_o.addScaledVector(bo.sub(n),l))}n.add(_o)}return n}},{key:"raycast",value:function(t,n){var e=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===e.boundingSphere&&e.computeBoundingSphere(),vo.copy(e.boundingSphere),vo.applyMatrix4(r),ho.copy(t.ray).recast(t.near),!1===vo.containsPoint(ho.origin)){if(null===ho.intersectSphere(vo,mo))return;if(ho.origin.distanceToSquared(mo)>Math.pow(t.far-t.near,2))return}fo.copy(r).invert(),ho.copy(t.ray).applyMatrix4(fo),null!==e.boundingBox&&!1===ho.intersectsBox(e.boundingBox)||this._computeIntersections(t,n,ho)}}},{key:"_computeIntersections",value:function(t,n,e){var i=this.geometry,r=this.material,o=i.index,a=i.attributes.position,s=i.attributes.uv,u=i.attributes.uv1,l=i.attributes.normal,c=i.groups,f=i.drawRange;if(null!==o)if(Array.isArray(r))for(var h=0,v=c.length;h<v;h++)for(var d,m=c[h],p=r[m.materialIndex],y=Math.max(m.start,f.start),g=Math.min(o.count,Math.min(m.start+m.count,f.start+f.count));y<g;y+=3)(d=xo(this,p,t,e,s,u,l,o.getX(y),o.getX(y+1),o.getX(y+2)))&&(d.faceIndex=Math.floor(y/3),d.face.materialIndex=m.materialIndex,n.push(d));else for(var b=Math.max(0,f.start),_=Math.min(o.count,f.start+f.count);b<_;b+=3)(d=xo(this,r,t,e,s,u,l,o.getX(b),o.getX(b+1),o.getX(b+2)))&&(d.faceIndex=Math.floor(b/3),n.push(d));else if(void 0!==a)if(Array.isArray(r))for(var w=0,S=c.length;w<S;w++)for(var x=c[w],A=r[x.materialIndex],E=Math.max(x.start,f.start),T=Math.min(a.count,Math.min(x.start+x.count,f.start+f.count));E<T;E+=3)(d=xo(this,A,t,e,s,u,l,E,E+1,E+2))&&(d.faceIndex=Math.floor(E/3),d.face.materialIndex=x.materialIndex,n.push(d));else for(var M=Math.max(0,f.start),P=Math.min(a.count,f.start+f.count);M<P;M+=3)(d=xo(this,r,t,e,s,u,l,M,M+1,M+2))&&(d.faceIndex=Math.floor(M/3),n.push(d))}}])&&oo(n.prototype,e),t&&oo(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function xo(t,n,e,i,r,o,a,s,u,l){t.getVertexPosition(s,po),t.getVertexPosition(u,yo),t.getVertexPosition(l,go);t=t,e=e,c=i,f=po,d=yo,v=go,h=wo;var c,f,h,v,d=null===(c=(n=n).side===W?c.intersectTriangle(v,d,f,!0,h):c.intersectTriangle(f,d,v,n.side===Y,h))||(So.copy(h),So.applyMatrix4(t.matrixWorld),(f=e.ray.origin.distanceTo(So))<e.near)||f>e.far?null:{distance:f,point:So.clone(),object:t};return d&&(v=new U,Zr.getBarycoord(wo,po,yo,go,v),r&&(d.uv=Zr.getInterpolatedAttribute(r,s,u,l,v,new B)),o&&(d.uv1=Zr.getInterpolatedAttribute(o,s,u,l,v,new B)),a&&(d.normal=Zr.getInterpolatedAttribute(a,s,u,l,v,new U),0<d.normal.dot(i.direction))&&d.normal.multiplyScalar(-1),n={a:s,b:u,c:l,normal:new U,materialIndex:0},Zr.getNormal(po,yo,go,n.normal),d.face=n,d.barycoord=v),d}function Ao(t){return(Ao="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Eo(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Ao(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Ao(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Ao(t)?t:t+""))(i.key),i)}}function To(t,n,e){return n&&Eo(t.prototype,n),e&&Eo(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Mo(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var Po,Oo,h=To(function t(){Mo(this,t),this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1});function No(t){return(No="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Co(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=No(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=No(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==No(t)?t:t+""))(i.key),i)}}function Lo(t,n,e){n=Do(n);var i=t,n=Ro()?Reflect.construct(n,e||[],Do(t).constructor):n.apply(t,e);if(!n||"object"!=No(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Ro(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ro=function(){return!!t})()}function Do(t){return(Do=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Fo(t,n){return(Fo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}Object.assign(h.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),h.FullScreenQuad=(Po=new n(-1,1,1,-1,0,1),Oo=new e(2,2),t=To(function t(n){Mo(this,t),this.L=new _(Oo,n)}),Object.defineProperty(t.prototype,"material",{get:function(){return this.L.material},set:function(t){this.L.material=t}}),Object.assign(t.prototype,{render:function(t){t.render(this.L,Po)}}),t);var f=(()=>{function a(t,n,e,i,r){var o;if(this instanceof a)return(o=Lo(this,a)).scene=t,o.camera=n,o.overrideMaterial=e,o.clearColor=i,o.clearAlpha=void 0!==r?r:0,o.clear=!0,o.clearDepth=!1,o.needsSwap=!1,o;throw new TypeError("Cannot call a class as a function")}var t,n,e=a,i=h;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Fo(e,i),e=a,t&&Co(e.prototype,t),n&&Co(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e})();function Io(t){var n,e={};for(n in t)for(var i in e[n]={},t[n]){var r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][i]=null):e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}return e}function d(t){for(var n={},e=0;e<t.length;e++){var i,r=Io(t[e]);for(i in r)n[i]=r[i]}return n}Object.assign(f.prototype,{setPass:function(t,n){this.scene=t,this.camera=n},render:function(t,n,e){var i,r,o=t.autoClear;t.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,void 0!==this.clearColor&&(i=t.getClearColor(new N).getHex(),r=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),void 0!==this.clearColor&&t.setClearColor(i,r),this.scene.overrideMaterial=null,t.autoClear=o}});var L={clone:Io,merge:d};function ko(t){return(ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function jo(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=ko(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=ko(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==ko(t)?t:t+""))(i.key),i)}}function Uo(t,n,e){n=zo(n);var i=t,n=Bo()?Reflect.construct(n,e||[],zo(t).constructor):n.apply(t,e);if(!n||"object"!=ko(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Bo(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Bo=function(){return!!t})()}function Ho(t,n,e,i){var r=Vo(zo(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function Vo(){return(Vo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=zo(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function zo(t){return(zo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Go(t,n){return(Go=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var R=(()=>{function a(t){var n;if(this instanceof a)return(n=Uo(this,a)).isShaderMaterial=!0,n.type="ShaderMaterial",n.defines={},n.uniforms={},n.uniformsGroups=[],n.vertexShader="\nvoid main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",n.fragmentShader="\nvoid main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}\n",n.linewidth=1,n.wireframe=!1,n.wireframeLinewidth=1,n.fog=!1,n.lights=!1,n.clipping=!1,n.forceSinglePass=!0,n.extensions={clipCullDistance:!1,multiDraw:!1},n.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},n.index0AttributeName=void 0,n.uniformsNeedUpdate=!1,n.glslVersion=null,void 0!==t&&n.setValues(t),n;throw new TypeError("Cannot call a class as a function")}var t,n=a,e=Rt;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Go(n,e),n=a,(e=[{key:"copy",value:function(t){return Ho(a,"copy",this,3)([t]),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Io(t.uniforms),this.uniformsGroups=(t=>{for(var n=[],e=0;e<t.length;e++)n.push(t[e].clone());return n})(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}},{key:"toJSON",value:function(t){var n,e=Ho(a,"toJSON",this,3)([t]);for(n in e.glslVersion=this.glslVersion,e.uniforms={},this.uniforms){var i=this.uniforms[n].value;i&&i.isTexture?e.uniforms[n]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[n]={type:"m4",value:i.toArray()}:e.uniforms[n]={value:i}}0<Object.keys(this.defines).length&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;var r,o={};for(r in this.extensions)!0===this.extensions[r]&&(o[r]=!0);return 0<Object.keys(o).length&&(e.extensions=o),e}}])&&jo(n.prototype,e),t&&jo(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Xo(t){return(Xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Yo(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Xo(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Xo(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Xo(t)?t:t+""))(i.key),i)}}function Wo(t,n,e){n=qo(n);var i=t,n=Qo()?Reflect.construct(n,e||[],qo(t).constructor):n.apply(t,e);if(!n||"object"!=Xo(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Qo(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Qo=function(){return!!t})()}function qo(t){return(qo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Zo(t,n){return(Zo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Jo=(()=>{function i(t,n){var e;if(this instanceof i)return(e=Wo(this,i)).textureID=void 0!==n?n:"tDiffuse",t instanceof R?(e.uniforms=t.uniforms,e.material=t):t&&(e.uniforms=L.clone(t.uniforms),e.material=new R({defines:Object.assign({},t.defines),uniforms:e.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),e.fsQuad=new h.FullScreenQuad(e.material),e;throw new TypeError("Cannot call a class as a function")}var t,n,e=i,r=h;if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&Zo(e,r),e=i,t&&Yo(e.prototype,t),n&&Yo(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e})(),Ko=(Object.assign(Jo.prototype,{render:function(t,n,e){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=e.texture),this.fsQuad.material=this.material,this.renderToScreen?t.setRenderTarget(null):(t.setRenderTarget(n),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil)),this.fsQuad.render(t)}}),{uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")});function $o(t){return($o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ta(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=$o(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=$o(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==$o(t)?t:t+""))(i.key),i)}}function na(t,n,e){return n&&ta(t.prototype,n),e&&ta(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function ea(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function ia(t,n,e){n=oa(n);var i=t,n=ra()?Reflect.construct(n,e||[],oa(t).constructor):n.apply(t,e);if(!n||"object"!=$o(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function ra(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ra=function(){return!!t})()}function oa(t){return(oa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function aa(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),n&&sa(t,n)}function sa(t,n){return(sa=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var ua=(()=>{function i(t,n){var e;return ea(this,i),(e=ia(this,i)).scene=t,e.camera=n,e.clear=!0,e.needsSwap=!1,e.inverse=!1,e}return aa(i,h),na(i)})(),la=(Object.assign(ua.prototype,{render:function(t,n,e){var i,r,o=t.getContext(),a=t.state;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0),r=this.inverse?(i=0,1):(i=1,0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),a.buffers.stencil.setFunc(o.ALWAYS,i,4294967295),a.buffers.stencil.setClear(r),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(n),this.clear&&t.clear(),t.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.stencil.setFunc(o.EQUAL,1,4294967295),a.buffers.stencil.setOp(o.KEEP,o.KEEP,o.KEEP)}}),(()=>{function n(){var t;return ea(this,n),(t=ia(this,n)).needsSwap=!1,t}return aa(n,h),na(n)})());function ca(t){return(ca="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fa(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=ca(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=ca(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==ca(t)?t:t+""))(i.key),i)}}function ha(t,n,e){n=da(n);var i=t,n=va()?Reflect.construct(n,e||[],da(t).constructor):n.apply(t,e);if(!n||"object"!=ca(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function va(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(va=function(){return!!t})()}function da(t){return(da=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ma(t,n){return(ma=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}Object.assign(la.prototype,{render:function(t){t.state.buffers.stencil.setTest(!1)}});var pa=(()=>{function l(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=this,o=l;if(!(r instanceof o))throw new TypeError("Cannot call a class as a function");(t=ha(this,l)).isRenderTarget=!0,t.width=n,t.height=e,t.depth=1,t.scissor=new Dr(0,0,n,e),t.scissorTest=!1,t.viewport=new Dr(0,0,n,e);for(var r={width:n,height:e,depth:1},i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:O,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i),a=new _i(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),s=(a.flipY=!1,a.generateMipmaps=i.generateMipmaps,a.internalFormat=i.internalFormat,t.textures=[],i.count),u=0;u<s;u++)t.textures[u]=a.clone(),t.textures[u].isRenderTargetTexture=!0;return t.depthBuffer=i.depthBuffer,t.stencilBuffer=i.stencilBuffer,t.resolveDepthBuffer=i.resolveDepthBuffer,t.resolveStencilBuffer=i.resolveStencilBuffer,t.depthTexture=i.depthTexture,t.samples=i.samples,t}var t,n=l,e=Et;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&ma(n,e),n=l,(e=[{key:"texture",get:function(){return this.textures[0]},set:function(t){this.textures[0]=t}},{key:"setSize",value:function(t,n){var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==t||this.height!==n||this.depth!==e){this.width=t,this.height=n,this.depth=e;for(var i=0,r=this.textures.length;i<r;i++)this.textures[i].image.width=t,this.textures[i].image.height=n,this.textures[i].image.depth=e;this.dispose()}this.viewport.set(0,0,t,n),this.scissor.set(0,0,t,n)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport);for(var n=this.textures.length=0,e=t.textures.length;n<e;n++)this.textures[n]=t.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0;var i=Object.assign({},t.texture.image);return this.texture.source=new fi(i),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}])&&fa(n.prototype,e),t&&fa(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function ya(t){return(ya="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ga(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=ya(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=ya(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==ya(t)?t:t+""))(i.key),i)}}function ba(t,n,e){n=wa(n);var i=t,n=_a()?Reflect.construct(n,e||[],wa(t).constructor):n.apply(t,e);if(!n||"object"!=ya(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function _a(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_a=function(){return!!t})()}function wa(t){return(wa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Sa(t,n){return(Sa=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var D=(()=>{function o(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=this,r=o;if(i instanceof r)return(i=ba(this,o,[t,n,e])).isWebGLRenderTarget=!0,i;throw new TypeError("Cannot call a class as a function")}var t,n,e=o,i=pa;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Sa(e,i),e=o,t&&ga(e.prototype,t),n&&ga(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e})();function xa(t){return(xa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Aa(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=xa(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=xa(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==xa(t)?t:t+""))(i.key),i)}}var Ea=(()=>{return t=function t(){var n=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=this,i=t;if(!(e instanceof i))throw new TypeError("Cannot call a class as a function");this.autoStart=n,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},(n=[{key:"start",value:function(){this.startTime=Ta(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t,n=0;return this.autoStart&&!this.running?(this.start(),0):(this.running&&(n=((t=Ta())-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=n),n)}}])&&Aa(t.prototype,n),e&&Aa(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,e})();function Ta(){return performance.now()}function Ma(t){return(Ma="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pa(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Ma(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Ma(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Ma(t)?t:t+""))(i.key),i)}}function Oa(t,n,e){return n&&Pa(t.prototype,n),e&&Pa(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Na(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var Ca,La,Ra=Oa(function t(n,e){var i,r;Na(this,t),this.renderer=n,void 0===e?(i={minFilter:O,magFilter:O,format:J,stencilBuffer:!1},r=n.getSize(new B),this.R=n.getPixelRatio(),this.D=r.width,this.F=r.height,(e=new D(this.D*this.R,this.F*this.R,i)).texture.name="EffectComposer.rt1"):(this.R=1,this.D=e.width,this.F=e.height),this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===Jo&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new Jo(Ko),this.clock=new Ea}),Da=(Object.assign(Ra.prototype,{swapBuffers:function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t},clearPass:function(){for(var t=0;t<this.passes.length;t++)this.passes[t].scene=null,this.passes[t].camera=null},addPass:function(t){this.passes.push(t),t.setSize(this.D*this.R,this.F*this.R)},insertPass:function(t,n){this.passes.splice(n,0,t)},isLastEnabledPass:function(t){for(var n=t+1;n<this.passes.length;n++)if(this.passes[n].enabled)return!1;return!0},render:function(t){void 0===t&&(t=this.clock.getDelta());for(var n,e,i,r=this.renderer.getRenderTarget(),o=!1,a=this.passes.length,s=0;s<a;s++)!1!==(i=this.passes[s]).enabled&&(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),i.render(this.renderer,this.writeBuffer,this.readBuffer,t,o),i.needsSwap&&(o&&(n=this.renderer.getContext(),(e=this.renderer.state.buffers.stencil).setFunc(n.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),e.setFunc(n.EQUAL,1,4294967295)),this.swapBuffers()),void 0!==ua)&&(i instanceof ua?o=!0:i instanceof la&&(o=!1));this.renderer.setRenderTarget(r)},reset:function(t){var n;void 0===t&&(n=this.renderer.getSize(new B),this.R=this.renderer.getPixelRatio(),this.D=n.width,this.F=n.height,(t=this.renderTarget1.clone()).setSize(this.D*this.R,this.F*this.R)),this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(t,n){this.D=t,this.F=n;var e=this.D*this.R,i=this.F*this.R;this.renderTarget1.setSize(e,i),this.renderTarget2.setSize(e,i);for(var r=0;r<this.passes.length;r++)this.passes[r].setSize(e,i)},setPixelRatio:function(t){this.R=t,this.setSize(this.D,this.F)}}),Oa(function t(){Na(this,t),this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}));function Fa(t){return(Fa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ia(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Fa(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Fa(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Fa(t)?t:t+""))(i.key),i)}}function ka(t,n,e){n=Ua(n);var i=t,n=ja()?Reflect.construct(n,e||[],Ua(t).constructor):n.apply(t,e);if(!n||"object"!=Fa(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function ja(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ja=function(){return!!t})()}function Ua(t){return(Ua=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ba(t,n){return(Ba=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}Object.assign(Da.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),Da.FullScreenQuad=(Ca=new n(-1,1,1,-1,0,1),La=new e(2,2),t=Oa(function t(n){Na(this,t),this.L=new _(La,n)}),Object.defineProperty(t.prototype,"material",{get:function(){return this.L.material},set:function(t){this.L.material=t}}),Object.assign(t.prototype,{dispose:function(){this.L.geometry.dispose()},render:function(t){t.render(this.L,Ca)}}),t);var Ha=(()=>{function o(t,n,e,i){var r;if(!(this instanceof o))throw new TypeError("Cannot call a class as a function");(r=ka(this,o)).scene=t,r.camera=n,r.sampleLevel=4,r.unbiased=!0,r.clearColor=void 0!==e?e:0,r.clearAlpha=void 0!==i?i:0;t=Ko;return r.copyUniforms=L.clone(t.uniforms),r.copyMaterial=new R({uniforms:r.copyUniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:2,depthTest:!1,depthWrite:!1}),r.fsQuad=new Da.FullScreenQuad(r.copyMaterial),r}var t,n,e=o,i=Da;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Ba(e,i),e=o,t&&Ia(e.prototype,t),n&&Ia(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e})();function Va(t){return(Va="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function za(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Va(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Va(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Va(t)?t:t+""))(i.key),i)}}function Ga(t,n,e){n=Ya(n);var i=t,n=Xa()?Reflect.construct(n,e||[],Ya(t).constructor):n.apply(t,e);if(!n||"object"!=Va(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Xa(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Xa=function(){return!!t})()}function Ya(t){return(Ya=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Wa(t,n){return(Wa=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}Object.assign(Ha.prototype,{dispose:function(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null)},setSize:function(t,n){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(t,n)},render:function(t,n,e){this.sampleRenderTarget||(this.sampleRenderTarget=new D(e.width,e.height,{minFilter:O,magFilter:O,format:J}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");for(var i=Ha.JitterVectors[Math.max(0,Math.min(this.sampleLevel,5))],r=t.autoClear,o=(t.autoClear=!1,t.getClearColor(new N).getHex()),a=t.getClearAlpha(),s=1/i.length,u=(this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture,e.width),l=e.height,c=0;c<i.length;c++){var f=i[c],f=(this.camera.setViewOffset&&this.camera.setViewOffset(u,l,.0625*f[0],.0625*f[1],u,l),s);this.unbiased&&(f+=1/32*((c+.5)/i.length-.5)),this.copyUniforms.opacity.value=f,t.setClearColor(this.clearColor,this.clearAlpha),t.setRenderTarget(this.sampleRenderTarget),t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(this.renderToScreen?null:n),0===c&&(t.setClearColor(this.clearColor,0),t.clear()),this.fsQuad.render(t)}this.camera.clearViewOffset&&this.camera.clearViewOffset(),t.autoClear=r,t.setClearColor(o,a)}}),Ha.JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];var Qa=(()=>{function r(t,n,e,i){if(this instanceof r)return void 0===Ha&&console.error("TAARenderPass relies on SSAARenderPass"),(t=Ga(this,r,[t,n,e,i])).sampleLevel=0,t.accumulate=!1,t;throw new TypeError("Cannot call a class as a function")}var t,n,e=r,i=Ha;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Wa(e,i),e=r,t&&za(e.prototype,t),n&&za(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e})();function qa(t){return(qa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Za(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=qa(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=qa(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==qa(t)?t:t+""))(i.key),i)}}function Ja(t,n,e){return n&&Za(t.prototype,n),e&&Za(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}Qa.JitterVectors=Ha.JitterVectors,Object.assign(Qa.prototype,{render:function(t,n,e,i){if(this.accumulate){var r=Qa.JitterVectors[5],o=(this.sampleRenderTarget||(this.sampleRenderTarget=new D(e.width,e.height,this.params),this.sampleRenderTarget.texture.name="TAARenderPass.sample"),this.holdRenderTarget||(this.holdRenderTarget=new D(e.width,e.height,this.params),this.holdRenderTarget.texture.name="TAARenderPass.hold"),this.accumulate&&-1===this.accumulateIndex&&(Ha.prototype.render.call(this,t,this.holdRenderTarget,e,i),this.accumulateIndex=0),t.autoClear),a=(t.autoClear=!1,1/r.length);if(0<=this.accumulateIndex&&this.accumulateIndex<r.length){this.copyUniforms.opacity.value=a,this.copyUniforms.tDiffuse.value=n.texture;for(var s=Math.pow(2,this.sampleLevel),u=0;u<s;u++){var l=r[this.accumulateIndex];if(this.camera.setViewOffset&&this.camera.setViewOffset(e.width,e.height,.0625*l[0],.0625*l[1],e.width,e.height),t.setRenderTarget(n),t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(this.sampleRenderTarget),0===this.accumulateIndex&&t.clear(),this.fsQuad.render(t),this.accumulateIndex++,this.accumulateIndex>=r.length)break}this.camera.clearViewOffset&&this.camera.clearViewOffset()}a=this.accumulateIndex*a;0<a&&(this.copyUniforms.opacity.value=1,this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture,t.setRenderTarget(n),t.clear(),this.fsQuad.render(t)),a<1&&(this.copyUniforms.opacity.value=1-a,this.copyUniforms.tDiffuse.value=this.holdRenderTarget.texture,t.setRenderTarget(n),0==a&&t.clear(),this.fsQuad.render(t)),t.autoClear=o}else Ha.prototype.render.call(this,t,n,e,i),this.accumulateIndex=-1}});var e=Ja(function t(n){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.I=n,this.k=this.I.getRenderManager(),this.j=new l,this.U=null,this.B=null,this.H=null,this.V=this.V.bind(this),this.G()}),Ka=(Object.assign(e.prototype,{G:function(){this.U=new Ra(this.k.getRenderer()),this.B=new f(this.j,this.I.camera,null,0,1),this.U.addPass(this.B);var t=this.k.renderer.getClearColor(new N),n=this.k.renderer.getClearAlpha();this.H=new Qa(this.j,this.I.camera,t,n),this.H.sampleLevel=2,this.H.unbiased=!1,this.U.addPass(this.H),this.U.renderToScreen=!1,this.I.on("resize",this.V)},X:function(t){this.H.scene=t,this.H.camera=this.I.camera;for(var n=0;n<this.U.passes.length;n++)this.U.passes[n].constructor===f&&this.U.passes[n].setPass(t,this.I.camera);this.U.render()},V:function(){var t,n;this.U&&(n=(t=this.I.getContainer()).clientWidth,this.U.setSize(n,t.clientHeight))}}),e);function $a(t){return($a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ts(t,n){return(t=>{if(Array.isArray(t))return t})(t)||((t,n)=>{var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var i,r,o,a,s=[],u=!0,l=!1;try{if(o=(e=e.call(t)).next,0===n){if(Object(e)!==e)return;u=!1}else for(;!(u=(i=o.call(e)).done)&&(s.push(i.value),s.length!==n);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=e.return&&(a=e.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}})(t,n)||ns(t,n)||(()=>{throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function ns(t,n){var e;if(t)return"string"==typeof t?es(t,n):"Map"===(e="Object"===(e={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?es(t,n):void 0}function es(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=Array(n);e<n;e++)i[e]=t[e];return i}function is(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=$a(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=$a(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==$a(t)?t:t+""))(i.key),i)}}function rs(t,n,e){return n&&is(t.prototype,n),e&&is(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var t=rs(function t(n){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.I=n,this.k=this.I.getRenderManager(),this.j=new l,this.U=null,this.Y=null,this.B=null,this.W=new b({color:"black"}),this.q=new Ka(n),this.Z=new D(4096,4096,{minFilter:O,magFilter:O,format:J,stencilBuffer:!1,generateMipmaps:!0}),this.J={},this.K="\n            varying vec2 vUv;\n\n            void main() {\n\n                vUv = uv;\n\n                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n            }\n        ",this.$="\n            uniform sampler2D baseTexture;\n            uniform sampler2D baseMaptexture;\n            uniform sampler2D bloomTexture;\n            uniform sampler2D outlineTexture;\n            uniform sampler2D spriteTexture;\n            uniform sampler2D reflectTexture;\n            uniform sampler2D reflectedTexture;\n\n            varying vec2 vUv;\n\n            vec4 getTexture( sampler2D texelToLinearTexture ) {\n\n                return texture2D( texelToLinearTexture , vUv );\n\n            }\n\n            void main() {\n                vec4 spriteColor = vec4( 1.0 ) * getTexture( spriteTexture );\n                vec4 baseColor = vec4( 1.0 ) * getTexture( baseMaptexture );\n                if(spriteColor.r != 0.0 || spriteColor.g != 0.0 || spriteColor.b != 0.0) {\n                    gl_FragColor = baseColor;\n                } else {\n                    vec4 reflectedColor = getTexture(reflectedTexture);\n                    if(reflectedColor.a==1.0&&reflectedColor.g==1.0&&reflectedColor.b==1.0){\n                        gl_FragColor = baseColor;\n                    } else {\n                        vec4 reflectColor = vec4( 1.0 ) * getTexture(reflectTexture);\n                        if(reflectColor.r!=0.0 || reflectColor.g!=0.0 || reflectColor.b!=0.0){\n                            gl_FragColor = mix(reflectColor,baseColor,reflectedColor.r);\n                            gl_FragColor.a = baseColor.a;\n                        } else {\n                            gl_FragColor = baseColor;\n                        }\n                    }\n\n                    gl_FragColor = gl_FragColor + vec4( 1.0 ) * getTexture( bloomTexture );\n                }\n                gl_FragColor = gl_FragColor + vec4( 1.0 ) * getTexture(outlineTexture);\n            }\n        ",this.G()}),os=(Object.assign(t.prototype,{G:function(){var t=this.I.getRenderManager();this.U=new Ra(t.getRenderer()),this.Y=new Jo(new R({uniforms:{baseTexture:{value:null},baseMaptexture:{value:null},bloomTexture:{value:null},outlineTexture:{value:null},reflectTexture:{value:null},reflectedTexture:{value:null},spriteTexture:{value:null}},vertexShader:this.K,fragmentShader:this.$,defines:{}}),"baseTexture"),this.U.addPass(this.Y),this.V=this.V.bind(this),this.I.on("resize",this.V)},tt:function(t){this.Y.material.uniforms.spriteTexture.value=t,this.Y.material.uniforms.uniformsNeedUpdate=!0},nt:function(t){this.Y.material.uniforms.bloomTexture.value=t,this.Y.material.uniforms.uniformsNeedUpdate=!0},et:function(t){this.Y.material.uniforms.outlineTexture.value=t,this.Y.material.uniforms.uniformsNeedUpdate=!0},it:function(t,n){this.Y.material.uniforms.reflectTexture.value=t,this.Y.material.uniforms.reflectedTexture.value=n,this.Y.material.uniforms.uniformsNeedUpdate=!0},X:function(t){var n,e;this.I.getRenderManager().bloom&&this.I.getRenderManager().bloom.rt&&!this.I.getRenderManager().bloom.ot?(e=(n=this.k.getRenderer()).getRenderTarget(),n.setRenderTarget(this.Z),n.clear(),n.render(t,this.I.camera),this.Y.material.uniforms.baseMaptexture.value=this.Z.texture,this.Y.material.uniforms.uniformsNeedUpdate=!0,n.setRenderTarget(e)):(this.q.X(t),this.Y.material.uniforms.baseMaptexture.value=this.q.U.readBuffer.texture,this.Y.material.uniforms.uniformsNeedUpdate=!0),this.U.render()},st:function(t){for(var n=0;n<this.U.passes.length;n++)this.U.passes[n].constructor===f&&this.U.passes[n].setPass(t,this.I.camera)},ut:function(t,n,e){var i=this,r=this.I.getBuilding(t).getFloor(parseInt(n)).getLayers();e?null!==this.k.fogEffect&&(null!==this.k.fogEffect.lt&&(this.k.renderScene.fog.density=this.k.fogEffect.ct),null!==this.k.fogEffect.ft)&&(this.k.renderScene.background=this.k.fogEffect.ft):(null!==this.k.renderScene.fog&&(this.k.renderScene.fog.density=0),this.k.renderScene.background=null);for(var o=0;o<r.length;o++){var a=r[o];if(a.type===T.MODEL_LAYER||a.type===T.EXTERNAL_MODEL_LAYER||a.type===T.DYNAMIC_MODEL_MARKER||a.type===T.WALL_MARKER||a.type===T.TUBE_MARKER||a.type===T.LINE3D_MARKER)for(var s,u,l=0;l<a.children.length;l++)a.children[l].isbloom||a.children[l].getRenderNode()&&(s=a.children[l].getRenderNode(),i.ht(s,i.J,e)),a.children[l].type===T.MODEL&&(s=a.children[l].getOtherNode(),u=!!e,s.top&&(s.top.visible=u),s.line)&&(s.line.visible=u);else a.scene.visible=!!e}this.vt(e)},vt:function(t){if(0<this.k.waterLayers.size){var n,e=((t,n)=>{var e,i,r,o,a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(a)return r=!(i=!0),{s:function(){a=a.call(t)},n:function(){var t=a.next();return i=t.done,t},e:function(t){r=!0,e=t},f:function(){try{i||null==a.return||a.return()}finally{if(r)throw e}}};if(Array.isArray(t)||(a=ns(t))||n&&t&&"number"==typeof t.length)return a&&(t=a),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})(this.k.waterLayers);try{for(e.s();!(n=e.n()).done;){var i=ts(n.value,2),r=(i[0],i[1]);t?(r.j.visible=!0,r.dt.visible=!0):(r.j.visible=!1,r.dt.visible=!1)}}catch(t){e.e(t)}finally{e.f()}}this.k.sky&&(this.k.sky.j.visible=!!t),this.k.skyNeedTexture&&(this.k.skyNeedTexture.j.visible=!!t);var o=this.k.getGroundLayerScene(),o=(o&&(o.visible=!!t),this.k.getTileLayScene());o&&(o.visible=!!t)},ht:function(t,n,e){"Mesh"===t.type&&(e?(t.material=n[t.uuid],delete n[t.uuid]):(n[t.uuid]=t.material,t.material=this.W));for(var i=t.children,r=0;r<i.length;r++)this.ht(i[r],n,e)},V:function(){var t,n;this.U&&(n=(t=this.I.getContainer()).clientWidth,this.U.setSize(n,t.clientHeight))}}),t);function as(t){return(as="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ss(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=as(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=as(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==as(t)?t:t+""))(i.key),i)}}function us(t,n,e){return n&&ss(t.prototype,n),e&&ss(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var e=us(function t(n,e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.I=n,this.k=this.I.getRenderManager(),this.j=new l,this.U=null,this.B=null,this.J={},this.yt=e,this.V=this.V.bind(this),this.G()}),ls=(Object.assign(e.prototype,{G:function(){this.U=new Ra(this.k.getRenderer()),this.B=new f(this.j,this.I.camera,null,0,1),this.U.addPass(this.B),this.U.renderToScreen=!1,this.I.on("resize",this.V)},gt:function(t,n,e){for(var i=this.I.getBuilding(t).getFloor(parseInt(n)).getLayers(),r=0;r<i.length;r++){var o=i[r];if(o.type===T.MODEL_LAYER||o.type===T.EXTERNAL_MODEL_LAYER||o.type===T.DYNAMIC_MODEL_MARKER||o.type===T.WALL_MARKER||o.type===T.TUBE_MARKER||o.type===T.LINE3D_MARKER)for(var a,s,u=0;u<o.children.length;u++)o.children[u].isbloom&&o.children[u].getRenderNode()&&this.yt.ht(o.children[u].getRenderNode(),this.J,e),o.children[u].type===T.MODEL&&(s=!!e,(a=o.children[u].getOtherNode()).top&&(a.top.visible=s),a.line)&&(a.line.visible=s);e||o.type!==T.LABEL_LAYER&&o.type!==T.FACILITY_LAYER&&o.type!==T.IMAGE_MARKER&&o.type!==T.TEXT_MARKER||(o.scene.visible=!0)}},bt:function(t){for(var n=0;n<this.U.passes.length;n++)this.U.passes[n].constructor===f&&this.U.passes[n].setPass(t,this.I.camera);this.U.render()},V:function(){var t,n;this.U&&(n=(t=this.I.getContainer()).clientWidth,this.U.setSize(n,t.clientHeight))}}),e);function cs(t){return(cs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fs(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=cs(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=cs(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==cs(t)?t:t+""))(i.key),i)}}function hs(t,n,e){return n&&fs(t.prototype,n),e&&fs(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var t=hs(function t(n){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.I=n,this._t=null,this.wt=null,this.St=null,this.xt=null}),vs=(Object.assign(t.prototype,{At:function(t){for(var n,e=this.I.getFloor(this.I.getLevel()),i=e.getLayers(T.MODEL_LAYER)[0].scene,r=[],o=0;o<i.children.length;o++)"DirectionalLight"===i.children[o].type?((n=i.children[o].clone()).visible=!0,n.start_y=n.position.y,n.position.y=n.position.y+e.height,r.push(n)):"AmbientLight"===i.children[o].type?((n=i.children[o].clone()).visible=!0,n.start_y=n.position.y,n.position.y=n.position.y+e.height,this._t=n,t.add(this._t)):"Object3D"===i.children[o].type&&(this.xt=i.children[o].clone(),this.xt.start_y=this.xt.position.y,this.xt.position.y=this.xt.position.y+e.height,t.add(this.xt));for(var a=0;a<r.length;a++)r[a].target=this.xt,t.add(r[a]);this.wt=r[0],this.St=r[1]},Et:function(t){t=t.split("%A%B%C%D")[0],t=this.I.getBuilding(t),t=t.getFloor(t.level);this._t.position.y=this._t.start_y+t.height,this.wt.position.y=this.wt.start_y+t.height,this.St.position.y=this.St.start_y+t.height,this.xt.position.y=this.xt.start_y+t.height}}),t);function ds(t){return(ds="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ms(t){return(t=>{if(Array.isArray(t))return ps(t)})(t)||(t=>{if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)})(t)||((t,n)=>{var e;if(t)return"string"==typeof t?ps(t,n):"Map"===(e="Object"===(e={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?ps(t,n):void 0})(t)||(()=>{throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function ps(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=Array(n);e<n;e++)i[e]=t[e];return i}function ys(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=ds(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=ds(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==ds(t)?t:t+""))(i.key),i)}}var gs=(()=>{function e(t){var n=this;if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.type="effect",this.waterLayers=new Map,this.bloom=null,this.outLine=null,this.reflect=null,this.particle=null,this.sky=null,this.rain=null,this.flowlines=new Map,this.sweep=null,this.sao=null,this.fogEffect=null,this.renderScene=new l,t.getMapOptions().hdr&&t.getMapOptions().hdr.load(t,function(t){n.renderScene.environment=t}),this.mymap=t,this.isHDText=this.mymap.getMapOptions().HDText,this.postprocessing=new os(t),this.effectTool=new vs(t),this.effectTool.At(this.renderScene),this.spriteRender=new ls(t,this.postprocessing)}return t=e,(n=[{key:"render",value:function(){for(var l=this,t=(this.renderer.clear(),this.resize(),this.getTileLayScene()),n=(t&&!t.parent&&this.renderScene.add(t),this.getGroundLayerScene()),e=(n&&!n.parent&&this.renderScene.add(n),this.get3DTilesLayerSceneArr()),i=0;i<e.length;i++)e[i].parent||this.renderScene.add(e[i]);this.mymap.getInteracations().autoCameraNearFar&&(this.mymap.getInteracations().autoCameraNearFar.reset(),this.mymap.getInteracations().autoCameraNearFar.update(this.getRenderList()),this.mymap.getInteracations().autoCameraNearFar.update([t,n].concat(ms(e))));for(var t=Array.from(this.getRenderList()),r=(this.effectTool.Et(t[t.length-1][0]),[]),o=t,a=r,s=(t=>{for(var n=[],e=0;e<t.length;e++){var i=t[e][0].split("%A%B%C%D")[0];n.indexOf(i)<0&&n.push(i)}return n})(o),u=0,c=0;c<s.length;c++)for(var f=s[c],h=((t,n)=>{for(var e=[],i=0;i<n.length;i++){var r=n[i][0].split("%A%B%C%D"),o=r[0];t===o&&(o=r[1],e.indexOf(o)<0)&&e.push(o)}return e})(f,o),v=0;v<h.length;v++){((t,n,e)=>{for(var i=0;i<e.length;i++){var r=e[i][0].split("%A%B%C%D");r[0]===t&&r[1]===n&&((t,n)=>{void 0===n&&(n=!0);for(var e=0;e<t.children.length;e++)"DirectionalLight"!==t.children[e].type&&"AmbientLight"!==t.children[e].type||(t.children[e].visible=n)})(e[i][1],!1)}})(f,h[v],o);var d=l.mymap.getBuilding(f).getFloor(parseInt(h[v])),m=(((t,n)=>{for(var e=t.getLayers(),i=0;i<e.length;i++)for(var r=e[i],o=r.type,a=0;a<r.children.length;a++){var s,u=r.children[a];o===T.EXTENT_LAYER?u.getRenderNode()&&(u.getRenderNode().renderOrder=n+1):o===T.MODEL_LAYER||o===T.EXTERNAL_MODEL_LAYER||o===T.DYNAMIC_MODEL_MARKER||o===T.WALL_MARKER||o===T.TUBE_MARKER||o===T.LINE3D_MARKER?S(u,u.type,n+5):(s=l.mymap.getRenderOrder().indexOf(u.type),S(u,u.type,n+10+s))}})(d,u),l.waterLayers.get(f+"_"+h[v]));m&&(x(m.j,u+4),x(m.dt,u+4)),d.effectScene.buildingInfo=f+"_"+h[v],d.effectScene.buildingID=f,d.effectScene.level=h[v],a.push(d.effectScene),l.renderScene.add(d.effectScene),u+=50}for(var p,y=0;y<r.length;y++)null!==this.sweep&&this.sweep.render(r[y]),r[y].isEffect&&(p=r[y].buildingInfo,0<l.waterLayers.size)&&(p=l.waterLayers.get(p))&&p.traverse(function(t){t.Tt.material.uniforms.time.value+=1/60}),(null!==this.bloom&&this.bloom.rt||null!==this.reflect)&&this.postprocessing.ut(r[y].buildingID,r[y].level,!1);if(null!==this.bloom||null!==this.outLine||null!==this.reflect){if(null!==this.bloom&&this.bloom.rt?(this.bloom.X(this.renderScene,r),this.postprocessing.nt(this.bloom.U.readBuffer.texture)):this.postprocessing.nt(null),null!==this.bloom&&this.bloom.rt||null!==this.reflect){for(var g=0;g<r.length;g++)this.spriteRender.gt(r[g].buildingID,r[g].level,!1);this.spriteRender.bt(this.renderScene);for(var b=0;b<r.length;b++)this.spriteRender.gt(r[b].buildingID,r[b].level,!0);this.postprocessing.tt(this.spriteRender.U.readBuffer.texture);for(var _=0;_<r.length;_++)this.postprocessing.ut(r[_].buildingID,r[_].level,!0)}null!==this.outLine?(n=this.renderer.getClearAlpha(),this.renderer.setClearAlpha(0),this.outLine.Mt(),this.outLine.X(this.renderScene),this.renderer.setClearAlpha(n),this.postprocessing.et(this.outLine.U.renderTarget2.texture)):this.postprocessing.et(null),null!==this.reflect?(this.reflect.X(),this.postprocessing.it(this.reflect.U.readBuffer.texture,this.reflect.Pt.readBuffer.texture)):this.postprocessing.it(null,null),(null!==this.bloom&&this.bloom.rt||null!==this.outLine||null!==this.reflect)&&this.postprocessing.X(this.renderScene),null===this.bloom||this.bloom.rt||(null===this.outLine&&null===this.reflect&&this.renderer.render(this.renderScene,this.parent.camera),this.bloom.X(this.renderScene,r))}else this.renderer.render(this.renderScene,this.parent.camera);for(var w=0;w<r.length;w++)this.renderScene.remove(r[w]);function S(t,n,e){var i;if(n===T.MODEL)t.getRenderNode()&&(t.getRenderNode().renderOrder=e,(i=t.getOtherNode()).top&&(i.top.renderOrder=e+1),i.line)&&x(i.line,e);else if(n===T.LINE_MARKER)for(var r=t.getRenderNode(),o=0;o<r.length;o++)r[o].renderOrder=e;else if(n===T.LABEL){if(t.getRenderNode())if(t.getRenderNode().renderOrder=e,l.isHDText)for(var a=t.getRenderNode().children,s=0;s<a.length;s++)a[s].renderOrder=0===s?e+1:1===s?e+2:e;else x(t.getRenderNode(),e)}else t.getRenderNode()&&x(t.getRenderNode(),e)}function x(t,n){"Mesh"!==t.type&&"Sprite"!==t.type&&"LineSegments"!==t.type||(t.renderOrder=n);for(var e=t.children,i=0;i<e.length;i++)x(e[i],n)}this.parent.getMarkerGroup()&&this.renderer.render(this.parent.getMarkerGroup().scene,this.parent.camera),this.particle&&this.particle.render(),this.rain&&this.rain.render(),this.needLogo&&this.xx45f6&&this.renderer.render(this.xx45f6,this.parent.camera)}},{key:"getLayerType",value:function(t){switch(t){case T.EXTENT:return T.EXTENT_LAYER;case T.EXTERNAL_MODEL:return T.EXTERNAL_MODEL_LAYER;case T.MODEL:return T.MODEL_LAYER;case T.FACILITY:return T.FACILITY_LAYER;case T.LABEL:return T.LABEL_LAYER;default:return t}}}])&&ys(t.prototype,n),i&&ys(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,i})();function bs(t){return(bs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _s(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=bs(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=bs(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==bs(t)?t:t+""))(i.key),i)}}e=(()=>{function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.I=t,this.j=new l,this.Ot=null,this.Nt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TS0UqDnYQ6ZChOlkQK8VRqlgEC6Wt0KqDyaVf0MSQpLg4Cq4FBz8Wqw4uzro6uAqC4AeIk6OToouU+L+k0CLGg+N+vLv3uHsHCK06U82+SUDVLCObSoqF4ooYfEUAEfiRQFxipp7OLeThOb7u4ePrXYxneZ/7cwwqJZMBPpF4lumGRbxOnNi0dM77xGFWlRTic+IJgy5I/Mh12eU3zhWHBZ4ZNvLZOeIwsVjpYbmHWdVQiaeJo4qqUb5QcFnhvMVZrTdY5578haGStpzjOs0IUlhEGhmIkNFADXVYiNGqkWIiS/tJD/+o48+QSyZXDYwc89iACsnxg//B727NcnzKTQolgcCLbX+MAcFdoN207e9j226fAP5n4Err+jdawMwn6c2uFj0ChraBi+uuJu8BlzvAyJMuGZIj+WkK5TLwfkbfVASGb4GBVbe3zj5OH4A8dbV0AxwcAuMVyl7zeHd/b2//nun09wPqUXLXvsrewQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB+QFHAQMLuREfnwAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAA9UlEQVQY002Pu0oDQRRA7517d0ISFwKaIKLgphPSqGltxEYk/2AnBNILdhba2PkBNv6BJn8QxLR2KVwEH6xBEk1G3ezMXBsDOeWpzgGYoxPbZvsxa807BgC4ibNSYhy9TdwGAvjzrglrK5oaUTDCTmx3p06O343rhzl1azK/hwC9coEOCeGMHVN38JlerZb4WxNeLCHZl6HdekjS9mZUvFdifhEJlpMvd6QUsngIKgt0WWR8IgRk1kG9zFJLJv46/phuF7S6G6d+J1rM1f2Pf8ZZZO8182uhOhUR7cGerId53q/ygAEAGlEw+t/siwgdVPPD2eYf14pkaPQAZiEAAAAASUVORK5CYII=",this.points=[],this.pointsStatus=[],this.O=t.getBound().size.x,this.Ct=t.getBound().size.y,this.Lt=1e5,this.Rt=0,this.Dt=this.Dt.bind(this),this.G(this.Lt),this.Ft()}return t=n,(e=[{key:"enable",value:function(){(this.I.getRenderManager().particle=this).I.on("beforeRender",this.Dt)}},{key:"disable",value:function(){this.I.getRenderManager().particle=null,this.I.off("beforeRender",this.Dt),this.Dt()}},{key:"dispose",value:function(){this.disable()}},{key:"setUrl",value:function(t){this.j.children[0].material.map=(new Mi).load(t),this.Nt=t}},{key:"setAmount",value:function(t){this.j.remove(this.Ot.points),this.points=[],this.pointsStatus=[];t=this.Lt*t;this.G(t)}},{key:"render",value:function(){var i=this;null!==this.Ot&&this.Ot.changePositions(.1,-.32,.1,function(t,n){return 0<=n},function(){var t=(Math.random()-.5)*i.O,n=1e3*Math.random(),e=(Math.random()-.5)*i.Ct;return new U(t,n,e)}),this.I.getRenderManager().renderer.render(this.j,this.I.camera)}}])&&_s(t.prototype,e),i&&_s(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i})(),Object.assign(e.prototype,{Dt:function(){this.I.enableUpdateRender()},It:function(t,n,e){for(var i=0;i<t;i++){var r=(Math.random()-.5)*this.O,o=1e3*Math.random(),a=(Math.random()-.5)*this.Ct,s=Math.random()-.5,s=s/Math.abs(s),u=3*Math.random(),l=Math.random()-.5,l=l/Math.abs(l);n.push(new U(r,o,a)),e.push({x:{sign:s,weight:u},y:{sign:1,weight:1},z:{sign:l,weight:3*Math.random()}})}},G:function(t){this.It(t,this.points,this.pointsStatus),this.Ot=new Ki(this.points,this.Nt),this.Ot.setRunStatus(this.pointsStatus),this.j.add(this.Ot.points)},Ft:function(){"basic"===this.I.getRenderManager().type&&this.I.setRenderManager(new gs(this.I))}}),t=e;function ws(t){return(ws="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ss(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=ws(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=ws(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==ws(t)?t:t+""))(i.key),i)}}function xs(t,n,e){n=Es(n);var i=t,n=As()?Reflect.construct(n,e||[],Es(t).constructor):n.apply(t,e);if(!n||"object"!=ws(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function As(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(As=function(){return!!t})()}function Es(t){return(Es=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ts(t,n){return(Ts=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Ms=(()=>{function e(){var t;if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");(t=xs(this,e)).renderTarget=new D(1,1,{minFilter:O,magFilter:O,format:J}),t.compositeMaterial=t.getCompositeMaterial(t.nMips);var n=Ko;return t.copyUniforms=L.clone(n.uniforms),t.copyUniforms.opacity.value=1,t.materialCopy=new R({uniforms:t.copyUniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,blending:2,depthTest:!1,depthWrite:!1,transparent:!0}),t.clearColor=new N(0,0,0),t.oldClearColor=new N,t.oldClearAlpha=1,t.basic=new b,t.basic.transparent=!0,t.fsQuad=new h.FullScreenQuad(null),t}var t,n,i=e,r=h;if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");return i.prototype=Object.create(r&&r.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),r&&Ts(i,r),i=e,t&&Ss(i.prototype,t),n&&Ss(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i})();function Ps(t){return(Ps="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Os(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Ps(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Ps(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Ps(t)?t:t+""))(i.key),i)}}function Ns(t,n,e){return n&&Os(t.prototype,n),e&&Os(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}Object.assign(Ms.prototype,{dispose:function(){this.renderTarget.dispose()},setSize:function(t,n){t=Math.round(t/2),n=Math.round(n/2);this.renderTarget.setSize(t,n)},render:function(t,n,e,i,r){this.oldClearColor.copy(t.getClearColor(new N)),this.oldClearAlpha=t.getClearAlpha();var o=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),r&&t.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=e.texture,t.setRenderTarget(null),this.fsQuad.render(t)),this.fsQuad.material=this.compositeMaterial,t.setRenderTarget(this.renderTarget),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTarget.texture,r&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?t.setRenderTarget(null):t.setRenderTarget(e),this.fsQuad.render(t),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=o},getCompositeMaterial:function(){return new R({uniforms:{iTime:{value:0},rainSize:{value:.1},iResolution:{value:new B(300,200)},iChannel3:{value:null}},vertexShader:"\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"\n                varying vec2 vUv;\n                uniform float iTime;\n                uniform float rainSize;\n                uniform vec2 iResolution;\n                uniform vec2 iMouse;\n                uniform sampler2D iChannel3;\n                uniform sampler2D tDiffuse;\n\n                void main() {\n                  float speed = fract(iTime);\n                  vec3 col = vec3(0.0, 0.0, 0.0);\n                  float aspect = iResolution.x / iResolution.y;\n\n                  // uv 0~1\n                  vec2 q = gl_FragCoord.xy / iResolution.xy;\n                  q.x *= aspect;\n\n                  // , 1: ; -1:\n                  float rainDir = 1.;\n                  // \n                  float tiltIntensity = 0.2;\n                  float offsetX = speed + q.y * rainDir * tiltIntensity;\n\n                  // uv\n                  vec2 p = -1.0 + 2.0 * q;\n                  vec2 st = p * vec2(.5, 0.01) + vec2(offsetX, speed);\n\n                  // \n                  float opacity = .655;\n                  // \n                  float f = texture2D(iChannel3, st).y;\n                  // \n                  f *= texture2D(iChannel3, st * 0.775).y;\n                  f *= opacity;\n\n                  col += f;\n                  col *= min(rainSize, 1.0);\n                  gl_FragColor = vec4(clamp(col, 0.0, 1.0), 1.0);\n                }\n                "})}});var e=Ns(function t(n){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.I=n}),Cs=(Object.assign(e.prototype,{Dt:function(){this.I.enableUpdateRender()},kt:function(){return"basic"===this.I.getRenderManager().type&&this.I.setRenderManager(new gs(this.I)),this.I.getRenderManager()}}),e);function Ls(t){return(Ls="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Rs(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Ls(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Ls(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Ls(t)?t:t+""))(i.key),i)}}e=(()=>{function e(t,n){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.I=t,this.jt=new Cs(t),this.Ut=-1,this.Bt=-1,this.Ht=this.jt.kt(),this.Dt=this.jt.Dt.bind(this),this.G(n)}return t=e,(n=[{key:"getRaindrops",value:function(){return this.Vt}},{key:"setRaindrops",value:function(t){this.Vt=t}},{key:"getUrl",value:function(){return this.Nt}},{key:"setUrl",value:function(t){this.Nt=t,this.zt.compositeMaterial.uniforms.iChannel3.value=(new Mi).load(t,function(t){t.wrapS=Q,t.wrapT=Q,t.anisotropy=16,t.repeat.set(4,4)})}},{key:"enable",value:function(){(this.I.getRenderManager().rain=this).I.on("beforeRender",this.Dt)}},{key:"disable",value:function(){this.I.getRenderManager().rain=null,this.I.off("beforeRender",this.Dt),this.Dt()}},{key:"dispose",value:function(){this.disable(),this.zt.dispose(),this.zt=null,this.j=null,this.Gt=null,this.Xt=null}},{key:"render",value:function(){this.V(),this.Yt+=.05,this.zt.compositeMaterial.uniforms.iTime.value=this.Yt,this.zt.compositeMaterial.uniforms.rainSize.value=this.Vt,this.Gt.render()}}])&&Rs(t.prototype,n),i&&Rs(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,i})(),Object.assign(e.prototype,{G:function(t){this.Nt=t.url,this.zt=new Ms,this.j=new l,this.Xt=new f(this.j,this.I.camera),this.Xt.clear=!1,this.Gt=new Ra(this.Ht.getRenderer()),this.Gt.addPass(this.Xt),this.Gt.addPass(this.zt),this.setUrl(this.Nt),this.zt.compositeMaterial.uniforms.iTime.value=.2,this.zt.compositeMaterial.uniforms.iResolution.value=new B(60,60),this.Yt=.6,this.Vt=t.raindrops},V:function(){var t,n,e;this.Gt&&(t=(n=this.Gt.renderer.domElement).clientWidth,n=n.clientHeight,e=!1,this.Ut!=t&&(e=!0,this.Ut=t),this.Bt!=n&&(e=!0,this.Bt=n),e)&&this.zt&&this.Gt.setSize(this.Ut,this.Bt)}});function Ds(t){return(Ds="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fs(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Ds(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Ds(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Ds(t)?t:t+""))(i.key),i)}}function Is(t,n,e){n=Us(n);var i=t,n=ks()?Reflect.construct(n,e||[],Us(t).constructor):n.apply(t,e);if(!n||"object"!=Ds(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function ks(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ks=function(){return!!t})()}function js(){return(js="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=Us(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function Us(t){return(Us=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Bs(t,n){return(Bs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Hs=(()=>{function l(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:1,a=this,s=l;if(!(a instanceof s))throw new TypeError("Cannot call a class as a function");(a=Is(this,l)).type="BoxGeometry",a.parameters={width:t,height:n,depth:e,widthSegments:i,heightSegments:r,depthSegments:o};var N=a,i=Math.floor(i),r=Math.floor(r),o=Math.floor(o),C=[],L=[],R=[],D=[],F=0,I=0;function u(t,n,e,i,r,o,a,s,u,l,c){for(var f=o/u,h=a/l,v=o/2,d=a/2,m=s/2,p=u+1,y=l+1,g=0,b=0,_=new U,w=0;w<y;w++)for(var S=w*h-d,x=0;x<p;x++)_[t]=(x*f-v)*i,_[n]=S*r,_[e]=m,L.push(_.x,_.y,_.z),_[t]=0,_[n]=0,_[e]=0<s?1:-1,R.push(_.x,_.y,_.z),D.push(x/u),D.push(1-w/l),g+=1;for(var A=0;A<l;A++)for(var E=0;E<u;E++){var T=F+E+p*A,M=F+E+p*(A+1),P=F+(E+1)+p*(A+1),O=F+(E+1)+p*A;C.push(T,M,O),C.push(M,P,O),b+=6}N.addGroup(I,b,c),I+=b,F+=g}return u("z","y","x",-1,-1,e,n,t,o,r,0),u("z","y","x",1,-1,e,n,-t,o,r,1),u("x","z","y",1,1,t,e,n,i,o,2),u("x","z","y",1,-1,t,e,-n,i,o,3),u("x","y","z",1,-1,t,n,e,i,r,4),u("x","y","z",-1,-1,t,n,-e,i,r,5),a.setIndex(C),a.setAttribute("position",new k(L,3)),a.setAttribute("normal",new k(R,3)),a.setAttribute("uv",new k(D,2)),a}var t,n=l,e=Ve;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Bs(n,e),n=l,e=[{key:"fromJSON",value:function(t){return new l(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}],(t=[{key:"copy",value:function(t){var n,e,i,r,o;return n=l,e="copy",i=this,o=js(Us(1&(r=3)?n.prototype:n),e,i),(2&r&&"function"==typeof o?function(t){return o.apply(i,t)}:o)([t]),this.parameters=Object.assign({},t.parameters),this}}])&&Fs(n.prototype,t),e&&Fs(n,e),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Vs(t){return(Vs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zs(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Vs(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Vs(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Vs(t)?t:t+""))(i.key),i)}}function Gs(t,n,e){n=Ys(n);var i=t,n=Xs()?Reflect.construct(n,e||[],Ys(t).constructor):n.apply(t,e);if(!n||"object"!=Vs(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Xs(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Xs=function(){return!!t})()}function Ys(t){return(Ys=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ws(t,n){return(Ws=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Qs={uniforms:{luminanceValue:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new U},up:{value:new U(0,1,0)}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","uniform vec3 up;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunFade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunFade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunFade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunFade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminanceValue;","uniform float mieDirectionalG;","uniform vec3 up;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminanceValue, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunFade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")},qs=(()=>{function n(){var t;if(this instanceof n)return t=new R({fragmentShader:Qs.fragmentShader,vertexShader:Qs.vertexShader,uniforms:L.clone(Qs.uniforms),side:W}),Gs(this,n,[new Hs(1,1,1),t]);throw new TypeError("Cannot call a class as a function")}var t,e,i=n,r=_;if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");return i.prototype=Object.create(r&&r.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),r&&Ws(i,r),i=n,t&&zs(i.prototype,t),e&&zs(i,e),Object.defineProperty(i,"prototype",{writable:!1}),i})();function Zs(t){return(Zs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Js(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Zs(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Zs(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Zs(t)?t:t+""))(i.key),i)}}function Ks(t,n,e){n=nu(n);var i=t,n=$s()?Reflect.construct(n,e||[],nu(t).constructor):n.apply(t,e);if(!n||"object"!=Zs(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function $s(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return($s=function(){return!!t})()}function tu(){return(tu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=nu(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function nu(t){return(nu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function eu(t,n){return(eu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var iu=(()=>{function N(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:32,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:16,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:2*Math.PI,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:Math.PI,s=this,u=N;if(!(s instanceof u))throw new TypeError("Cannot call a class as a function");(s=Ks(this,N)).type="SphereGeometry",s.parameters={radius:t,widthSegments:n,heightSegments:e,phiStart:i,phiLength:r,thetaStart:o,thetaLength:a};for(var n=Math.max(3,Math.floor(n)),e=Math.max(2,Math.floor(e)),l=Math.min(o+a,Math.PI),c=0,f=[],h=new U,v=new U,d=[],m=[],p=[],y=[],g=0;g<=e;g++){var b=[],_=g/e,w=0;0===g&&0===o?w=.5/n:g===e&&l===Math.PI&&(w=-.5/n);for(var S=0;S<=n;S++){var x=S/n;h.x=-t*Math.cos(i+x*r)*Math.sin(o+_*a),h.y=t*Math.cos(o+_*a),h.z=t*Math.sin(i+x*r)*Math.sin(o+_*a),m.push(h.x,h.y,h.z),v.copy(h).normalize(),p.push(v.x,v.y,v.z),y.push(x+w,1-_),b.push(c++)}f.push(b)}for(var A=0;A<e;A++)for(var E=0;E<n;E++){var T=f[A][E+1],M=f[A][E],P=f[A+1][E],O=f[A+1][E+1];(0!==A||0<o)&&d.push(T,M,O),(A!==e-1||l<Math.PI)&&d.push(M,P,O)}return s.setIndex(d),s.setAttribute("position",new k(m,3)),s.setAttribute("normal",new k(p,3)),s.setAttribute("uv",new k(y,2)),s}var t,n=N,e=Ve;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&eu(n,e),n=N,e=[{key:"fromJSON",value:function(t){return new N(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}],(t=[{key:"copy",value:function(t){var n,e,i,r,o;return n=N,e="copy",i=this,o=tu(nu(1&(r=3)?n.prototype:n),e,i),(2&r&&"function"==typeof o?function(t){return o.apply(i,t)}:o)([t]),this.parameters=Object.assign({},t.parameters),this}}])&&Js(n.prototype,t),e&&Js(n,e),Object.defineProperty(n,"prototype",{writable:!1}),n})();function ru(t){return(ru="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ou(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=ru(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=ru(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==ru(t)?t:t+""))(i.key),i)}}var au=(()=>{function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.I=t,this.j=new l,this.Wt=null,this.Qt=null,this.Qt={turbidity:10,rayleigh:3,mieCoefficient:.005,mieDirectionalG:.7,luminance:1,inclination:.49,azimuth:.25,scale:500},this.qt=4e5,this.Zt=0,this.Jt=1,this.G(),this.Ft()}return t=n,(e=[{key:"getState",value:function(){var t=this.sky.material.uniforms;return{turbidity:t.turbidity.value,rayleigh:t.rayleigh.value,luminance:t.luminanceValue.value,scale:this.sky.scale.x}}},{key:"setState",value:function(t){t.scale&&this.sky.scale.setScalar(t.scale);var n=this.sky.material.uniforms;n.turbidity.value=("number"==typeof t.turbidity?t:this.Qt).turbidity,n.rayleigh.value=("number"==typeof t.rayleigh?t:this.Qt).rayleigh,n.luminanceValue.value=("number"==typeof t.luminance?t:this.Qt).luminance,this.Kt(this.Qt.inclination)}},{key:"enable",value:function(){this.I.getRenderManager().renderScene.add(this.j),(this.I.getRenderManager().sky=this).I.enableUpdateNode()}},{key:"disable",value:function(){this.I.getRenderManager().renderScene.remove(this.j),this.I.getRenderManager().sky=null,this.I.enableUpdateNode()}},{key:"setTime",value:function(t){t=(t-6)/12;1<t&&(t-=2),this.Kt(t)}},{key:"autoTime",value:function(){}},{key:"render",value:function(){this.I.getRenderManager().renderer.render(this.j,this.I.camera)}}])&&ou(t.prototype,e),i&&ou(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i})();Object.assign(au.prototype,{G:function(){this.sky=new qs,this.sky.scale.setScalar(this.Qt.scale),this.j.add(this.sky),this.Wt=new _(new iu(2e4,16,8),new b({color:16777215})),this.Wt.position.y=-7e5,this.Wt.visible=!0,this.j.add(this.Wt),this.setState(this.Qt)},Ft:function(){"basic"===this.I.getRenderManager().type&&this.I.setRenderManager(new gs(this.I))},Kt:function(t){var n=this.sky.material.uniforms,t=Math.PI*(t+1),e=2*Math.PI*(this.Qt.azimuth-.5);this.Wt.position.z=this.qt*Math.cos(e),this.Wt.position.y=this.qt*Math.sin(e)*Math.sin(t),this.Wt.position.x=this.qt*Math.sin(e)*Math.cos(t),n.sunPosition.value=this.Wt.position,this.I.enableUpdateRender()}});function su(t){return(su="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function uu(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=su(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=su(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==su(t)?t:t+""))(i.key),i)}}var lu=new U,cu=new U,fu=new v,hu=(()=>{return t=function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new U(1,0,0),e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=this,r=t;if(!(i instanceof r))throw new TypeError("Cannot call a class as a function");this.isPlane=!0,this.normal=n,this.constant=e},(n=[{key:"set",value:function(t,n){return this.normal.copy(t),this.constant=n,this}},{key:"setComponents",value:function(t,n,e,i){return this.normal.set(t,n,e),this.constant=i,this}},{key:"setFromNormalAndCoplanarPoint",value:function(t,n){return this.normal.copy(t),this.constant=-n.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(t,n,e){e=lu.subVectors(e,n).cross(cu.subVectors(t,n)).normalize();return this.setFromNormalAndCoplanarPoint(e,t),this}},{key:"copy",value:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this}},{key:"normalize",value:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(t){return this.normal.dot(t)+this.constant}},{key:"distanceToSphere",value:function(t){return this.distanceToPoint(t.center)-t.radius}},{key:"projectPoint",value:function(t,n){return n.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}},{key:"intersectLine",value:function(t,n){var e=t.delta(lu),i=this.normal.dot(e);return 0===i?0===this.distanceToPoint(t.start)?n.copy(t.start):null:(i=-(t.start.dot(this.normal)+this.constant)/i)<0||1<i?null:n.copy(t.start).addScaledVector(e,i)}},{key:"intersectsLine",value:function(t){var n=this.distanceToPoint(t.start),t=this.distanceToPoint(t.end);return n<0&&0<t||t<0&&0<n}},{key:"intersectsBox",value:function(t){return t.intersectsPlane(this)}},{key:"intersectsSphere",value:function(t){return t.intersectsPlane(this)}},{key:"coplanarPoint",value:function(t){return t.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(t,n){n=n||fu.getNormalMatrix(t),t=this.coplanarPoint(lu).applyMatrix4(t),n=this.normal.applyMatrix3(n).normalize();return this.constant=-t.dot(n),this}},{key:"translate",value:function(t){return this.constant-=t.dot(this.normal),this}},{key:"equals",value:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}])&&uu(t.prototype,n),e&&uu(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,e})(),F={common:{diffuse:{value:new N(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new v},alphaMap:{value:null},alphaMapTransform:{value:new v},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new v}},envmap:{envMap:{value:null},envMapRotation:{value:new v},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new v}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new v}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new v},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new v},normalScale:{value:new B(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new v},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new v}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new v}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new v}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new N(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new N(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new v},alphaTest:{value:0},uvTransform:{value:new v}},sprite:{diffuse:{value:new N(16777215)},opacity:{value:1},center:{value:new B(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new v},alphaMap:{value:null},alphaMapTransform:{value:new v},alphaTest:{value:0}}},I={alphahash_fragment:"\n#ifdef USE_ALPHAHASH\n\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n\n#endif\n",alphahash_pars_fragment:"\n#ifdef USE_ALPHAHASH\n\n\t/**\n\t * See: https://casual-effects.com/research/Wyman2017Hashed/index.html\n\t */\n\n\tconst float ALPHA_HASH_SCALE = 0.05; // Derived from trials only, and may be changed.\n\n\tfloat hash2D( vec2 value ) {\n\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\n\t}\n\n\tfloat hash3D( vec3 value ) {\n\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\n\t}\n\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\n\t\t// Find the discretized derivatives of our coordinates\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\n\t\t// Find two nearest log-discretized noise scales\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\n\t\t// Compute alpha thresholds at our two noise scales\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\n\t\t// Factor to interpolate lerp with\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\n\t\t// Interpolate alpha threshold from noise at two scales\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\n\t\t// Pass into CDF to compute uniformly distrib threshold\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\n\t\t// Find our final, uniformly distributed alpha threshold ()\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\n\t\t// Avoids  == 0. Could also do  =1-\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\n\t}\n\n#endif\n",alphamap_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n\n#endif\n",alphamap_pars_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",alphatest_fragment:"\n#ifdef USE_ALPHATEST\n\n\t#ifdef ALPHA_TO_COVERAGE\n\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\n\t#else\n\n\tif ( diffuseColor.a < alphaTest ) discard;\n\n\t#endif\n\n#endif\n",alphatest_pars_fragment:"\n#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif\n",aomap_fragment:"\n#ifdef USE_AOMAP\n\n\t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\n\t#endif\n\n#endif\n",aomap_pars_fragment:"\n#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif\n",batching_pars_vertex:"\n#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\n\t}\n\n\tfloat getIndirectIndex( const in int i ) {\n\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\n\t}\n\n#endif\n\n#ifdef USE_BATCHING_COLOR\n\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\n\t}\n\n#endif\n",batching_vertex:"\n#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif\n",begin_vertex:"\nvec3 transformed = vec3( position );\n\n#ifdef USE_ALPHAHASH\n\n\tvPosition = vec3( position );\n\n#endif\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n\n#ifdef USE_TANGENT\n\n\tvec3 objectTangent = vec3( tangent.xyz );\n\n#endif\n",bsdfs:"\n\nfloat G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\n\n\t// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n",iridescence_fragment:"\n\n#ifdef USE_IRIDESCENCE\n\n\t// XYZ to linear-sRGB color space\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\n\t// Assume air interface for top\n\t// Note: We don't handle the case fresnel0 == 1\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\n\t}\n\n\t// Conversion FO/IOR\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\n\t}\n\n\t// ior is a value between 1.0 and 3.0. 1.0 is air interface\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\n\t}\n\n\t// Fresnel equations for dielectric/dielectric interfaces.\n\t// Ref: https://belcour.github.io/blog/research/2017/05/01/brdf-thin-film.html\n\t// Evaluation XYZ sensitivity curves in Fourier space\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\n\t}\n\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\n\t\tvec3 I;\n\n\t\t// Force iridescenceIOR -> outsideIOR when thinFilmThickness -> 0.0\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\t// Evaluate the cosTheta on the base layer (Snell law)\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\n\t\t// Handle TIR:\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\n\t\t\treturn vec3( 1.0 );\n\n\t\t}\n\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\n\t\t// First interface\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\n\t\t// Second interface\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) ); // guard against 1.0\n\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\n\t\t// Phase shift\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\n\t\t// Compound terms\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\n\t\t// Reflectance term for m = 0 (DC term amplitude)\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\n\t\t// Reflectance term for m > 0 (pairs of diracs)\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\n\t\t}\n\n\t\t// Since out of gamut colors might be produced, negative color values are clamped to 0.\n\t\treturn max( I, vec3( 0.0 ) );\n\n\t}\n\n#endif\n\n",bumpmap_pars_fragment:"\n#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n\t// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\n\t\t// normalize is done to ensure that the bump map looks the same regardless of the texture's scale\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm; // normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",clipping_planes_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvec4 plane;\n\n\t#ifdef ALPHA_TO_COVERAGE\n\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\n\t\t\tfloat unionClipOpacity = 1.0;\n\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\n\t\t#endif\n\n\t\tdiffuseColor.a *= clipOpacity;\n\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\n\t#else\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\n\t\t\tbool clipped = true;\n\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\n\t\t\tif ( clipped ) discard;\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",clipping_planes_pars_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n\n#endif\n",clipping_planes_pars_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n#endif\n",clipping_planes_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvClipPosition = - mvPosition.xyz;\n\n#endif\n",color_fragment:"\n#if defined( USE_COLOR_ALPHA )\n\n\tdiffuseColor *= vColor;\n\n#elif defined( USE_COLOR )\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif\n",color_pars_fragment:"\n#if defined( USE_COLOR_ALPHA )\n\n\tvarying vec4 vColor;\n\n#elif defined( USE_COLOR )\n\n\tvarying vec3 vColor;\n\n#endif\n",color_pars_vertex:"\n#if defined( USE_COLOR_ALPHA )\n\n\tvarying vec4 vColor;\n\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\n\tvarying vec3 vColor;\n\n#endif\n",color_vertex:"\n#if defined( USE_COLOR_ALPHA )\n\n\tvColor = vec4( 1.0 );\n\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\n\tvColor = vec3( 1.0 );\n\n#endif\n\n#ifdef USE_COLOR\n\n\tvColor *= color;\n\n#endif\n\n#ifdef USE_INSTANCING_COLOR\n\n\tvColor.xyz *= instanceColor.xyz;\n\n#endif\n\n#ifdef USE_BATCHING_COLOR\n\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\n\tvColor.xyz *= batchingColor.xyz;\n\n#endif\n",common:"\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n// <tonemapping_pars_fragment> may have defined saturate() already\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\n\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( const in vec2 uv ) {\n\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\n\treturn fract( sin( sn ) * c );\n\n}\n\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\n#ifdef USE_ALPHAHASH\n\n\tvarying vec3 vPosition;\n\n#endif\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t// dir can be either a direction vector or a normal vector\n\t// upper-left 3x3 of matrix is assumed to be orthogonal\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nmat3 transposeMat3( const in mat3 m ) {\n\n\tmat3 tmp;\n\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\n\treturn tmp;\n\n}\n\nbool isPerspectiveMatrix( mat4 m ) {\n\n\treturn m[ 2 ][ 3 ] == - 1.0;\n\n}\n\nvec2 equirectUv( in vec3 dir ) {\n\n\t// dir is assumed to be unit length\n\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\treturn vec2( u, v );\n\n}\n\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\n\treturn RECIPROCAL_PI * diffuseColor;\n\n} // validated\n\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\n\t// Original approximation by Christophe Schlick '94\n\t// float fresnel = pow( 1.0 - dotVH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH '13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n\n} // validated\n\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\n\t// Original approximation by Christophe Schlick '94\n\t// float fresnel = pow( 1.0 - dotVH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH '13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n\n} // validated\n",cube_uv_reflection_fragment:"\n#ifdef ENVMAP_TYPE_CUBE_UV\n\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\n\t// These shader functions convert between the UV coordinates of a single face of\n\t// a cubemap, the 0-5 integer index of a cube face, and the direction vector for\n\t// sampling a textureCube (not generally normalized ).\n\n\tfloat getFace( vec3 direction ) {\n\n\t\tvec3 absDirection = abs( direction );\n\n\t\tfloat face = - 1.0;\n\n\t\tif ( absDirection.x > absDirection.z ) {\n\n\t\t\tif ( absDirection.x > absDirection.y )\n\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t} else {\n\n\t\t\tif ( absDirection.z > absDirection.y )\n\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t}\n\n\t\treturn face;\n\n\t}\n\n\t// RH coordinate system; PMREM face-indexing convention\n\tvec2 getUV( vec3 direction, float face ) {\n\n\t\tvec2 uv;\n\n\t\tif ( face == 0.0 ) {\n\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x ); // pos x\n\n\t\t} else if ( face == 1.0 ) {\n\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y ); // pos y\n\n\t\t} else if ( face == 2.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z ); // pos z\n\n\t\t} else if ( face == 3.0 ) {\n\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x ); // neg x\n\n\t\t} else if ( face == 4.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y ); // neg y\n\n\t\t} else {\n\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z ); // neg z\n\n\t\t}\n\n\t\treturn 0.5 * ( uv + 1.0 );\n\n\t}\n\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\n\t\tfloat face = getFace( direction );\n\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\n\t\tfloat faceSize = exp2( mipInt );\n\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0; // #25071\n\n\t\tif ( face > 2.0 ) {\n\n\t\t\tuv.y += faceSize;\n\n\t\t\tface -= 3.0;\n\n\t\t}\n\n\t\tuv.x += face * faceSize;\n\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\n\t\t#ifdef texture2DGradEXT\n\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb; // disable anisotropic filtering\n\n\t\t#else\n\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\n\t\t#endif\n\n\t}\n\n\t// These defines must match with PMREMGenerator\n\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\n\tfloat roughnessToMip( float roughness ) {\n\n\t\tfloat mip = 0.0;\n\n\t\tif ( roughness >= cubeUV_r1 ) {\n\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\n\t\t} else {\n\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness ); // 1.16 = 1.79^0.25\n\t\t}\n\n\t\treturn mip;\n\n\t}\n\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\n\t\tfloat mipF = fract( mip );\n\n\t\tfloat mipInt = floor( mip );\n\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\n\t\tif ( mipF == 0.0 ) {\n\n\t\t\treturn vec4( color0, 1.0 );\n\n\t\t} else {\n\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\n\t\t}\n\n\t}\n\n#endif\n",defaultnormal_vertex:"\n\nvec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\n\tvec3 transformedTangent = objectTangent;\n\n#endif\n\n#ifdef USE_BATCHING\n\n\t// this is in lieu of a per-instance normal-matrix\n\t// shear transforms in the instance matrix are not supported\n\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\ttransformedTangent = bm * transformedTangent;\n\n\t#endif\n\n#endif\n\n#ifdef USE_INSTANCING\n\n\t// this is in lieu of a per-instance normal-matrix\n\t// shear transforms in the instance matrix are not supported\n\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\ttransformedTangent = im * transformedTangent;\n\n\t#endif\n\n#endif\n\ntransformedNormal = normalMatrix * transformedNormal;\n\n#ifdef FLIP_SIDED\n\n\ttransformedNormal = - transformedNormal;\n\n#endif\n\n#ifdef USE_TANGENT\n\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\n\t#ifdef FLIP_SIDED\n\n\t\ttransformedTangent = - transformedTangent;\n\n\t#endif\n\n#endif\n",displacementmap_pars_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n\n#endif\n",displacementmap_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n\n#endif\n",emissivemap_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n#endif\n",emissivemap_pars_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n",colorspace_fragment:"\ngl_FragColor = linearToOutputTexel( gl_FragColor );\n",colorspace_pars_fragment:"\n\n// http://www.russellcottrell.com/photo/matrixCalculator.htm\n\n// Linear sRGB => XYZ => Linear Display P3\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\n\n// Linear Display P3 => XYZ => Linear sRGB\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\n\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\n\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\n\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\n\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\n\n",envmap_fragment:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvec3 cameraToFrag;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\n\t\t}\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#else\n\n\t\tvec4 envColor = vec4( 0.0 );\n\n\t#endif\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",envmap_common_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif\n",envmap_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n\n#endif\n",envmap_pars_vertex:"\n#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\n\t#endif\n\n#endif\n",envmap_physical_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\n\t\t#else\n\n\t\t\treturn vec3( 0.0 );\n\n\t\t#endif\n\n\t}\n\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\n\t\t\t// Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\n\t\t#else\n\n\t\t\treturn vec3( 0.0 );\n\n\t\t#endif\n\n\t}\n\n\t#ifdef USE_ANISOTROPY\n\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\n\t\t\t  // https://google.github.io/filament/Filament.md.html#lighting/imagebasedlights/anisotropy\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\n\t\t\t#else\n\n\t\t\t\treturn vec3( 0.0 );\n\n\t\t\t#endif\n\n\t\t}\n\n\t#endif\n\n#endif\n",envmap_vertex:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvWorldPosition = worldPosition.xyz;\n\n\t#else\n\n\t\tvec3 cameraToVertex;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t\t}\n\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\n\n\tvFogDepth = - mvPosition.z;\n\n#endif\n",fog_pars_vertex:"\n#ifdef USE_FOG\n\n\tvarying float vFogDepth;\n\n#endif\n",fog_fragment:"\n#ifdef USE_FOG\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\n\t#endif\n\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif\n",fog_pars_fragment:"\n#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\n\t#endif\n\n#endif\n",gradientmap_pars_fragment:"\n\n#ifdef USE_GRADIENTMAP\n\n\tuniform sampler2D gradientMap;\n\n#endif\n\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\n\t// dotNL will be from -1.0 to 1.0\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\n\t#ifdef USE_GRADIENTMAP\n\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\n\t#else\n\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\n\t#endif\n\n}\n",lightmap_pars_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n\n#endif\n",lights_lambert_fragment:"\nLambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;\n",lights_lambert_pars_fragment:"\nvarying vec3 vViewPosition;\n\nstruct LambertMaterial {\n\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n\n};\n\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = vec3(dotNL) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert\n",lights_pars_begin:"\nuniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n\n#if defined( USE_LIGHT_PROBES )\n\n\tuniform vec3 lightProbe[ 9 ];\n\n#endif\n\n// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\n\t// normal is assumed to have unit length\n\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\n\t// band 0\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\n\t// band 1\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\n\t// band 2\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\n\treturn result;\n\n}\n\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\n\treturn irradiance;\n\n}\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n\tvec3 irradiance = ambientLightColor;\n\n\treturn irradiance;\n\n}\n\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\n\t// page 32, equation 26: E[window1]\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\n\tif ( cutoffDistance > 0.0 ) {\n\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\n\t}\n\n\treturn distanceFalloff;\n\n}\n\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n\n}\n\n#if NUM_DIR_LIGHTS > 0\n\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\n\t}\n\n#endif\n\n\n#if NUM_POINT_LIGHTS > 0\n\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\n\t// light is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\n\t\tlight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\n\t}\n\n#endif\n\n\n#if NUM_SPOT_LIGHTS > 0\n\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\n\t// light is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\n\t\tlight.direction = normalize( lVector );\n\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n\t\tif ( spotAttenuation > 0.0 ) {\n\n\t\t\tfloat lightDistance = length( lVector );\n\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\n\t\t} else {\n\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\n\t\t}\n\n\t}\n\n#endif\n\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\n\t// Pre-computed values of LinearTransformedCosine approximation of BRDF\n\t// BRDF approximation Texture is 64x64\n\tuniform sampler2D ltc_1; // RGBA Float\n\tuniform sampler2D ltc_2; // RGBA Float\n\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n\n#endif\n\n\n#if NUM_HEMI_LIGHTS > 0\n\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n\t\treturn irradiance;\n\n\t}\n\n#endif\n",lights_toon_fragment:"\nToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\n",lights_toon_pars_fragment:"\nvarying vec3 vViewPosition;\n\nstruct ToonMaterial {\n\n\tvec3 diffuseColor;\n\n};\n\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n",lights_phong_fragment:"\nBlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"\nvarying vec3 vViewPosition;\n\nstruct BlinnPhongMaterial {\n\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n\n};\n\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n",lights_physical_fragment:"\nPhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\n\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\n\nmaterial.roughness = max( roughnessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.\nmaterial.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n\n#ifdef IOR\n\n\tmaterial.ior = ior;\n\n\t#ifdef USE_SPECULAR\n\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\n\t\t#endif\n\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\n\t\t#endif\n\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\n\t#else\n\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\n\t#endif\n\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n\n#else\n\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n\n#endif\n\n#ifdef USE_CLEARCOAT\n\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\n\t#ifdef USE_CLEARCOATMAP\n\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\n\t#endif\n\n\tmaterial.clearcoat = saturate( material.clearcoat ); // Burley clearcoat model\n\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n\n#endif\n\n#ifdef USE_DISPERSION\n\n\tmaterial.dispersion = dispersion;\n\n#endif\n\n#ifdef USE_IRIDESCENCE\n\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\n\t#ifdef USE_IRIDESCENCEMAP\n\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\n\t#endif\n\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\n\t#else\n\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\n\t#endif\n\n#endif\n\n#ifdef USE_SHEEN\n\n\tmaterial.sheenColor = sheenColor;\n\n\t#ifdef USE_SHEEN_COLORMAP\n\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\n\t#endif\n\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\n\t#endif\n\n#endif\n\n#ifdef USE_ANISOTROPY\n\n\t#ifdef USE_ANISOTROPYMAP\n\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\n\t#else\n\n\t\tvec2 anisotropyV = anisotropyVector;\n\n\t#endif\n\n\tmaterial.anisotropy = length( anisotropyV );\n\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\n\t// Roughness along the anisotropy bitangent is the material roughness, while the tangent roughness increases with anisotropy.\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n\n#endif\n",lights_physical_pars_fragment:'\n\nstruct PhysicalMaterial {\n\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n\n};\n\n// temporary\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\n\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\n\treturn 0.5 / max( gv + gl, EPSILON );\n\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disneys reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\n\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n\n}\n\n// https://google.github.io/filament/Filament.md.html#materialsystem/anisotropicmodel/anisotropicspecularbrdf\n#ifdef USE_ANISOTROPY\n\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\n\t\treturn saturate(v);\n\n\t}\n\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\n\t}\n\n#endif\n\n#ifdef USE_CLEARCOAT\n\n\t// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\n\t\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\t\tfloat D = D_GGX( alpha, dotNH );\n\n\t\treturn F * ( V * D );\n\n\t}\n\n#endif\n\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\n\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\n\t#ifdef USE_IRIDESCENCE\n\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\n\t#endif\n\n\t#ifdef USE_ANISOTROPY\n\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\n\t#else\n\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\t\tfloat D = D_GGX( alpha, dotNH );\n\n\t#endif\n\n\treturn F * ( V * D );\n\n}\n\n// Rect Area Light\n\n// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines\n// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt\n// code: https://github.com/selfshadow/ltc_code/\n\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\tfloat dotNV = saturate( dot( N, V ) );\n\n\t// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\treturn uv;\n\n}\n\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\n\t// Real-Time Area Lighting: a Journey from Research to Production (p.102)\n\t// An approximation of the form factor of a horizon-clipped rectangle.\n\n\tfloat l = length( f );\n\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n\n}\n\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\n\tfloat x = dot( v1, v2 );\n\n\tfloat y = abs( x );\n\n\t// rational polynomial approximation to theta / sin( theta ) / 2PI\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\n\treturn cross( v1, v2 ) * theta_sintheta;\n\n}\n\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\n\t// bail if point is on back side of plane of light\n\t// assumes ccw winding order of light vertices\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\n\t// construct orthonormal basis around N\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system\n\n\t// compute transform\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\n\t// transform rect\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\n\t// project rect onto sphere\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\n\t// calculate vector form factor\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\n\t// adjust for horizon clipping\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\n/*\n\t// alternate method of adjusting for horizon clipping (see referece)\n\t// refactoring required\n\tfloat len = length( vectorFormFactor );\n\tfloat z = vectorFormFactor.z / len;\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\t// tabulated horizon-clipped sphere, apparently...\n\tvec2 uv = vec2( z * 0.5 + 0.5, len );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\tfloat scale = texture2D( ltc_2, uv ).w;\n\n\tfloat result = len * scale;\n*/\n\n\treturn vec3( result );\n\n}\n\n// End Rect Area Light\n\n#if defined( USE_SHEEN )\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs\nfloat D_Charlie( float roughness, float dotNH ) {\n\n\tfloat alpha = pow2( roughness );\n\n\t// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF"\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 ); // 2^(-14/2), so sin2h^2 > 0 in fp16\n\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n\n}\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\n\t// Neubelt and Pettineo 2013, "Crafting a Next-gen Material Pipeline for The Order: 1886"\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n\n}\n\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\n\treturn sheenColor * ( D * V );\n\n}\n\n#endif\n\n// This is a curve-fit approxmation to the "Charlie sheen" BRDF integrated over the hemisphere from \n// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF". The analysis can be found\n// in the Sheen section of https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tfloat r2 = roughness * roughness;\n\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\n\treturn saturate( DG * RECIPROCAL_PI );\n\n}\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via \'environmentBRDF\' from "Physically Based Shading on Mobile"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n\tvec4 r = roughness * c0 + c1;\n\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\n\treturn fab;\n\n}\n\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\n\treturn specularColor * fab.x + specularF90 * fab.y;\n\n}\n\n// Fdez-Agera\'s "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\n\t#ifdef USE_IRIDESCENCE\n\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\n\t#else\n\n\t\tvec3 Fr = specularColor;\n\n\t#endif\n\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619; // 1/21\n\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n\n}\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction\n\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\n\t\t// LTC Fresnel Approximation by Stephen Hill\n\t\t// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\n\t}\n\n#endif\n\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifdef USE_CLEARCOAT\n\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\n\t#endif\n\n\t#ifdef USE_SHEEN\n\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\n\t#endif\n\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\n\t#ifdef USE_CLEARCOAT\n\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\n\t#endif\n\n\t#ifdef USE_SHEEN\n\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\n\t#endif\n\n\t// Both indirect specular and indirect diffuse light accumulate here\n\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\n\t#ifdef USE_IRIDESCENCE\n\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\n\t#else\n\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\n\t#endif\n\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n}\n',lights_fragment_begin:"\n/**\n * This is a template that can be used to light a material, it uses pluggable\n * RenderEquations (RE)for specific lighting scenarios.\n *\n * Instructions for use:\n * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n *\n * TODO:\n * - Add area light support.\n * - Add sphere light support.\n * - Add diffuse light probe (irradiance cubemap) support.\n */\n\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n\n#ifdef USE_CLEARCOAT\n\n\tgeometryClearcoatNormal = clearcoatNormal;\n\n#endif\n\n#ifdef USE_IRIDESCENCE\n\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\n\tif ( material.iridescenceThickness == 0.0 ) {\n\n\t\tmaterial.iridescence = 0.0;\n\n\t} else {\n\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\n\t}\n\n\tif ( material.iridescence > 0.0 ) {\n\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\n\t\t// Iridescence F0 approximation\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\n\t}\n\n#endif\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\n\t\t// spot lights are ordered [shadows with maps, shadows without maps, maps without shadows, none]\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 iblIrradiance = vec3( 0.0 );\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\t#if defined( USE_LIGHT_PROBES )\n\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\n\t#endif\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n\n#endif\n",lights_fragment_maps:"\n#if defined( RE_IndirectDiffuse )\n\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\n\t\tirradiance += lightMapIrradiance;\n\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\n\t#endif\n\n#endif\n\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\n\t#ifdef USE_ANISOTROPY\n\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\n\t#else\n\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT\n\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\n\t#endif\n\n#endif\n",lights_fragment_end:"\n#if defined( RE_IndirectDiffuse )\n\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\n#endif\n",logdepthbuf_fragment:"\n#if defined( USE_LOGDEPTHBUF )\n\n\t// Doing a strict comparison with == 1.0 can cause noise artifacts\n\t// on some platforms. See issue #17623.\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n\n#endif\n",logdepthbuf_pars_fragment:"\n#if defined( USE_LOGDEPTHBUF )\n\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n\n#endif\n",logdepthbuf_pars_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n\n#endif\n",logdepthbuf_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\n#endif\n",map_fragment:"\n#ifdef USE_MAP\n\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\n\t#ifdef DECODE_VIDEO_TEXTURE\n\n\t\t// use inline sRGB decode until browsers properly support SRGB8_ALPHA8 with video textures (#26516)\n\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\n\t#endif\n\n\tdiffuseColor *= sampledDiffuseColor;\n\n#endif\n",map_pars_fragment:"\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n",map_particle_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\t#if defined( USE_POINTS_UV )\n\n\t\tvec2 uv = vUv;\n\n\t#else\n\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\n\t#endif\n\n#endif\n\n#ifdef USE_MAP\n\n\tdiffuseColor *= texture2D( map, uv );\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n\n#endif\n",map_particle_pars_fragment:"\n#if defined( USE_POINTS_UV )\n\n\tvarying vec2 vUv;\n\n#else\n\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\t\tuniform mat3 uvTransform;\n\n\t#endif\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",metalnessmap_fragment:"\nfloat metalnessFactor = metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n",metalnessmap_pars_fragment:"\n#ifdef USE_METALNESSMAP\n\n\tuniform sampler2D metalnessMap;\n\n#endif\n",morphinstance_vertex:"\n#ifdef USE_INSTANCING_MORPH\n\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\n\t}\n#endif\n",morphcolor_vertex:"\n#if defined( USE_MORPHCOLORS )\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\tvColor *= morphTargetBaseInfluence;\n\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\n\t\t#if defined( USE_COLOR_ALPHA )\n\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\n\t\t#elif defined( USE_COLOR )\n\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\n\t\t#endif\n\n\t}\n\n#endif\n",morphnormal_vertex:"\n#ifdef USE_MORPHNORMALS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\tobjectNormal *= morphTargetBaseInfluence;\n\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\n\t}\n\n#endif\n",morphtarget_pars_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_INSTANCING_MORPH\n\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\n\t#endif\n\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\n\t}\n\n#endif\n",morphtarget_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in position = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\ttransformed *= morphTargetBaseInfluence;\n\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\n\t}\n\n#endif\n",normal_fragment_begin:"\nfloat faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n\n#ifdef FLAT_SHADED\n\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#else\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal *= faceDirection;\n\n\t#endif\n\n#endif\n\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\n\t#ifdef USE_TANGENT\n\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\n\t#else\n\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\n\t#endif\n\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\n\t#endif\n\n#endif\n\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\t#ifdef USE_TANGENT\n\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\n\t#else\n\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\n\t#endif\n\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\n\t#endif\n\n#endif\n\n// non perturbed normal for clearcoat among others\n\nvec3 nonPerturbedNormal = normal;\n\n",normal_fragment_maps:"\n\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n\t#ifdef FLIP_SIDED\n\n\t\tnormal = - normal;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * faceDirection;\n\n\t#endif\n\n\tnormal = normalize( normalMatrix * normal );\n\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\n\tnormal = normalize( tbn * mapN );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n\n#endif\n",normal_pars_fragment:"\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n",normal_pars_vertex:"\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n",normal_vertex:"\n#ifndef FLAT_SHADED // normal is computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n",normalmap_pars_fragment:"\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n#endif\n\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\n\tuniform mat3 normalMatrix;\n\n#endif\n\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\n\t// Normal Mapping Without Precomputed Tangents\n\t// http://www.thetenthplanet.de/archives/1180\n\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\n\t\tvec3 N = surf_norm; // normalized\n\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\n\t\treturn mat3( T * scale, B * scale, N );\n\n\t}\n\n#endif\n",clearcoat_normal_fragment_begin:"\n#ifdef USE_CLEARCOAT\n\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n\n#endif\n",clearcoat_normal_fragment_maps:"\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n\n#endif\n",clearcoat_pars_fragment:"\n\n#ifdef USE_CLEARCOATMAP\n\n\tuniform sampler2D clearcoatMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n\n#endif\n\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tuniform sampler2D clearcoatRoughnessMap;\n\n#endif\n",iridescence_pars_fragment:"\n\n#ifdef USE_IRIDESCENCEMAP\n\n\tuniform sampler2D iridescenceMap;\n\n#endif\n\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\tuniform sampler2D iridescenceThicknessMap;\n\n#endif\n",opaque_fragment:"\n#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\n\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n",packing:"\nvec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\n\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\n\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\nconst float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\n\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\n\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\n\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\n\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\t// the 0.9999 tweak is unimportant, very tiny empirical improvement\n\t// return vec3( vuf * Inv255, gf * PackUpscale, bf * 0.9999 );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\n\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\n\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\n\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\n\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\n\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\n\n// NOTE: viewZ, the z-coordinate in camera space, is negative for points in front of the camera\n\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\t// -near maps to 0; -far maps to 1\n\treturn ( viewZ + near ) / ( near - far );\n}\n\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\t// maps orthographic depth in [ 0, 1 ] to viewZ\n\treturn depth * ( near - far ) - near;\n}\n\n// NOTE: https://twitter.com/gonnavis/status/1377183786949959682\n\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\t// -near maps to 0; -far maps to 1\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\n\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\t// maps perspective depth in [ 0, 1 ] to viewZ\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}\n",premultiplied_alpha_fragment:"\n#ifdef PREMULTIPLIED_ALPHA\n\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\n\tgl_FragColor.rgb *= gl_FragColor.a;\n\n#endif\n",project_vertex:"\nvec4 mvPosition = vec4( transformed, 1.0 );\n\n#ifdef USE_BATCHING\n\n\tmvPosition = batchingMatrix * mvPosition;\n\n#endif\n\n#ifdef USE_INSTANCING\n\n\tmvPosition = instanceMatrix * mvPosition;\n\n#endif\n\nmvPosition = modelViewMatrix * mvPosition;\n\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"\n#ifdef DITHERING\n\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n\n#endif\n",dithering_pars_fragment:"\n#ifdef DITHERING\n\n\t// based on https://www.shadertoy.com/view/MslGR8\n\tvec3 dithering( vec3 color ) {\n\t\t//Calculate grid position\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\n\t\t//Shift the individual colors differently, thus making it even harder to see the dithering pattern\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\n\t\t//modify shift according to grid position.\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\n\t\t//shift the color by dither_shift\n\t\treturn color + dither_shift_RGB;\n\t}\n\n#endif\n",roughnessmap_fragment:"\nfloat roughnessFactor = roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n",roughnessmap_pars_fragment:"\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform sampler2D roughnessMap;\n\n#endif\n",shadowmap_pars_fragment:"\n#if NUM_SPOT_LIGHT_COORDS > 0\n\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n\n#endif\n\n#if NUM_SPOT_LIGHT_MAPS > 0\n\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n\n#endif\n\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): create uniforms for area light shadows\n\n\t#endif\n\t*/\n\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n\t}\n\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n\t}\n\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n\t\tfloat occlusion = 1.0;\n\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\n\t\tfloat hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n\t\tif (hard_shadow != 1.0 ) {\n\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n\t\t}\n\t\treturn occlusion;\n\n\t}\n\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n\t\tfloat shadow = 1.0;\n\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\n\t\tif ( frustumTest ) {\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#else // no percentage-closer filtering:\n\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#endif\n\n\t\t}\n\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\n\t}\n\n\t// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n\t// vector suitable for 2D texture mapping. This code uses the following layout for the\n\t// 2D texture:\n\t//\n\t// xzXZ\n\t//  y Y\n\t//\n\t// Y - Positive y direction\n\t// y - Negative y direction\n\t// X - Positive x direction\n\t// x - Negative x direction\n\t// Z - Positive z direction\n\t// z - Negative z direction\n\t//\n\t// Source and test bed:\n\t// https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\t\t// Number of texels to avoid at the edge of each square\n\n\t\tvec3 absV = abs( v );\n\n\t\t// Intersect unit cube\n\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\n\t\t// Apply scale to avoid seams\n\n\t\t// two texels less per square (one texel will do for NEAREST)\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\t\t// Unwrap\n\n\t\t// space: -1 ... 1 range for each square\n\t\t//\n\t\t// #X##\t\tdim    := ( 4 , 2 )\n\t\t//  # #\t\tcenter := ( 1 , 1 )\n\n\t\tvec2 planar = v.xy;\n\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\n\t\tif ( absV.z >= almostOne ) {\n\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\n\t\t} else if ( absV.x >= almostOne ) {\n\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\n\t\t} else if ( absV.y >= almostOne ) {\n\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\n\t\t}\n\n\t\t// Transform to UV space\n\n\t\t// scale := 0.5 / dim\n\t\t// translate := ( center + 0.5 ) / dim\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n\t}\n\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n\t\tfloat shadow = 1.0;\n\n\t\t// for point lights, the uniform @vShadowCoord is re-purposed to hold\n\t\t// the vector from the light to the world-space position of the fragment.\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\n\t\t\t// dp = normalized distance from light to fragment position\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n\t\t\tdp += shadowBias;\n\n\t\t\t// bd3D = base direction 3D\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t\t#else // no percentage-closer filtering\n\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\n\t\t\t#endif\n\n\t\t}\n\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\n\t}\n\n#endif\n",shadowmap_pars_vertex:"\n\n#if NUM_SPOT_LIGHT_COORDS > 0\n\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n\n#endif\n\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): uniforms for area light shadows\n\n\t#endif\n\t*/\n\n#endif\n",shadowmap_vertex:"\n\n#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\n\t// Offsetting the position used for querying occlusion along the world normal can be used to reduce shadow acne.\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n\n#endif\n\n#if defined( USE_SHADOWMAP )\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update vAreaShadowCoord with area light info\n\n\t#endif\n\t*/\n\n#endif\n\n// spot lights can be evaluated without active shadow mapping (when SpotLight.map is used)\n\n#if NUM_SPOT_LIGHT_COORDS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n\n",shadowmask_pars_fragment:"\nfloat getShadowMask() {\n\n\tfloat shadow = 1.0;\n\n\t#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\tDirectionalLightShadow directionalLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\tSpotLightShadow spotLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\tPointLightShadow pointLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update shadow for Area light\n\n\t#endif\n\t*/\n\n\t#endif\n\n\treturn shadow;\n\n}\n",skinbase_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif\n",skinning_pars_vertex:"\n#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\tuniform highp sampler2D boneTexture;\n\n\tmat4 getBoneMatrix( const in float i ) {\n\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\n\t\treturn mat4( v1, v2, v3, v4 );\n\n\t}\n\n#endif\n",skinning_vertex:"\n#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n\n#endif\n",skinnormal_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n\t#ifdef USE_TANGENT\n\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#endif\n\n#endif\n",specularmap_fragment:"\nfloat specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif\n",specularmap_pars_fragment:"\n#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif\n",tonemapping_fragment:"\n#if defined( TONE_MAPPING )\n\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n#endif\n",tonemapping_pars_fragment:"\n#ifndef saturate\n// <common> may have defined saturate() already\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n\nuniform float toneMappingExposure;\n\n// exposure only\nvec3 LinearToneMapping( vec3 color ) {\n\n\treturn saturate( toneMappingExposure * color );\n\n}\n\n// source: https://www.cs.utah.edu/docs/techreports/2002/pdf/UUCS-02-001.pdf\nvec3 ReinhardToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n\n}\n\n// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/\nvec3 CineonToneMapping( vec3 color ) {\n\n\t// filmic operator by Jim Hejl and Richard Burgess-Dawson\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n\n}\n\n// source: https://github.com/selfshadow/ltc_code/blob/master/webgl/shaders/ltc/ltc_blit.fs\nvec3 RRTAndODTFit( vec3 v ) {\n\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n\n}\n\n// this implementation of ACES is modified to accommodate a brighter viewing environment.\n// the scale factor of 1/0.6 is subjective. see discussion in #19621.\n\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\n\t// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ), // transposed from source\n\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\n\t// ODT_SAT => XYZ => D60_2_D65 => sRGB\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ), // transposed from source\n\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\n\tcolor *= toneMappingExposure / 0.6;\n\n\tcolor = ACESInputMat * color;\n\n\t// Apply RRT and ODT\n\tcolor = RRTAndODTFit( color );\n\n\tcolor = ACESOutputMat * color;\n\n\t// Clamp to [0, 1]\n\treturn saturate( color );\n\n}\n\n// Matrices for rec 2020 <> rec 709 color space conversion\n// matrix provided in row-major order so it has been transposed\n// https://www.itu.int/pub/R-REP-BT.2407-2017\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\n\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\n\n// https://iolite-engine.com/blog_posts/minimal_agx_implementation\n// Mean error^2: 3.6705141e-06\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n\n}\n\n// AgX Tone Mapping implementation based on Filament, which in turn is based\n// on Blender's implementation using rec 2020 primaries\n// https://github.com/google/filament/pull/7236\n// Inputs and outputs are encoded as Linear-sRGB.\n\nvec3 AgXToneMapping( vec3 color ) {\n\n\t// AgX constants\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\n\t// explicit AgXOutsetMatrix generated from Filaments AgXOutsetMatrixInv\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\n\t// LOG2_MIN      = -10.0\n\t// LOG2_MAX      =  +6.5\n\t// MIDDLE_GRAY   =  0.18\n\tconst float AgxMinEv = - 12.47393;  // log2( pow( 2, LOG2_MIN ) * MIDDLE_GRAY )\n\tconst float AgxMaxEv = 4.026069;    // log2( pow( 2, LOG2_MAX ) * MIDDLE_GRAY )\n\n\tcolor *= toneMappingExposure;\n\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\n\tcolor = AgXInsetMatrix * color;\n\n\t// Log2 encoding\n\tcolor = max( color, 1e-10 ); // avoid 0 or negative numbers for log2\n\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\n\tcolor = clamp( color, 0.0, 1.0 );\n\n\t// Apply sigmoid\n\tcolor = agxDefaultContrastApprox( color );\n\n\t// Apply AgX look\n\t// v = agxLook(v, look);\n\n\tcolor = AgXOutsetMatrix * color;\n\n\t// Linearize\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\n\t// Gamut mapping. Simple clamp for now.\n\tcolor = clamp( color, 0.0, 1.0 );\n\n\treturn color;\n\n}\n\n// https://modelviewer.dev/examples/tone-mapping\n\nvec3 NeutralToneMapping( vec3 color ) {\n\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\n\tcolor *= toneMappingExposure;\n\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\n\tcolor -= offset;\n\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\n\tif ( peak < StartCompression ) return color;\n\n\tfloat d = 1. - StartCompression;\n\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\n\tcolor *= newPeak / peak;\n\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\n\treturn mix( color, vec3( newPeak ), g );\n\n}\n\nvec3 CustomToneMapping( vec3 color ) { return color; }\n",transmission_fragment:"\n#ifdef USE_TRANSMISSION\n\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\n\t#ifdef USE_TRANSMISSIONMAP\n\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\n\t#endif\n\n\t#ifdef USE_THICKNESSMAP\n\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\n\t#endif\n\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n\n#endif\n",transmission_pars_fragment:"\n#ifdef USE_TRANSMISSION\n\n\t// Transmission code is based on glTF-Sampler-Viewer\n\t// https://github.com/KhronosGroup/glTF-Sample-Viewer\n\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\n\t#ifdef USE_TRANSMISSIONMAP\n\n\t\tuniform sampler2D transmissionMap;\n\n\t#endif\n\n\t#ifdef USE_THICKNESSMAP\n\n\t\tuniform sampler2D thicknessMap;\n\n\t#endif\n\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\n\tvarying vec3 vWorldPosition;\n\n\t// Mipped Bicubic Texture Filtering by N8\n\t// https://www.shadertoy.com/view/Dl2SDW\n\n\tfloat w0( float a ) {\n\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\n\t}\n\n\tfloat w1( float a ) {\n\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\n\t}\n\n\tfloat w2( float a ){\n\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\n\t}\n\n\tfloat w3( float a ) {\n\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\n\t}\n\n\t// g0 and g1 are the two amplitude functions\n\tfloat g0( float a ) {\n\n\t\treturn w0( a ) + w1( a );\n\n\t}\n\n\tfloat g1( float a ) {\n\n\t\treturn w2( a ) + w3( a );\n\n\t}\n\n\t// h0 and h1 are the two offset functions\n\tfloat h0( float a ) {\n\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\n\t}\n\n\tfloat h1( float a ) {\n\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\n\t}\n\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\n\t\tuv = uv * texelSize.zw + 0.5;\n\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\n\t}\n\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\n\t}\n\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\n\t\t// Direction of refracted light.\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\n\t\t// Compute rotation-independant scaling of the model matrix.\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\n\t\t// The thickness is specified in local space.\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\n\t}\n\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\n\t\t// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n\t\t// an IOR of 1.5 results in the default amount of microfacet refraction.\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\n\t}\n\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\n\t}\n\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\n\t\tif ( isinf( attenuationDistance ) ) {\n\n\t\t\t// Attenuation distance is +, i.e. the transmitted color is not attenuated at all.\n\t\t\treturn vec3( 1.0 );\n\n\t\t} else {\n\n\t\t\t// Compute light attenuation using Beer's law.\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law\n\t\t\treturn transmittance;\n\n\t\t}\n\n\t}\n\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\n\t\t#ifdef USE_DISPERSION\n\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\t// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\t// Sample framebuffer to get pixel the refracted ray hits.\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\n\t\t\t}\n\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\n\t\t\t// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\n\t\t\t// Sample framebuffer to get pixel the refracted ray hits.\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\n\t\t// Get the specular component.\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\n\t\t// As less light is transmitted, the opacity should be increased. This simple approximation does a decent job \n\t\t// of modulating a CSS background, and has no effect when the buffer is opaque, due to a solid object or clear color.\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\n\t}\n#endif\n",uv_pars_fragment:"\n#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\n\tvarying vec2 vUv;\n\n#endif\n#ifdef USE_MAP\n\n\tvarying vec2 vMapUv;\n\n#endif\n#ifdef USE_ALPHAMAP\n\n\tvarying vec2 vAlphaMapUv;\n\n#endif\n#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vLightMapUv;\n\n#endif\n#ifdef USE_AOMAP\n\n\tvarying vec2 vAoMapUv;\n\n#endif\n#ifdef USE_BUMPMAP\n\n\tvarying vec2 vBumpMapUv;\n\n#endif\n#ifdef USE_NORMALMAP\n\n\tvarying vec2 vNormalMapUv;\n\n#endif\n#ifdef USE_EMISSIVEMAP\n\n\tvarying vec2 vEmissiveMapUv;\n\n#endif\n#ifdef USE_METALNESSMAP\n\n\tvarying vec2 vMetalnessMapUv;\n\n#endif\n#ifdef USE_ROUGHNESSMAP\n\n\tvarying vec2 vRoughnessMapUv;\n\n#endif\n#ifdef USE_ANISOTROPYMAP\n\n\tvarying vec2 vAnisotropyMapUv;\n\n#endif\n#ifdef USE_CLEARCOATMAP\n\n\tvarying vec2 vClearcoatMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvarying vec2 vClearcoatNormalMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tvarying vec2 vClearcoatRoughnessMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\n\tvarying vec2 vIridescenceMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\tvarying vec2 vIridescenceThicknessMapUv;\n\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\n\tvarying vec2 vSheenColorMapUv;\n\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\n\tvarying vec2 vSheenRoughnessMapUv;\n\n#endif\n#ifdef USE_SPECULARMAP\n\n\tvarying vec2 vSpecularMapUv;\n\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\n\tvarying vec2 vSpecularColorMapUv;\n\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\n\tvarying vec2 vSpecularIntensityMapUv;\n\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n\n#endif\n#ifdef USE_THICKNESSMAP\n\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n\n#endif\n",uv_pars_vertex:"\n#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\n\tvarying vec2 vUv;\n\n#endif\n#ifdef USE_MAP\n\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n\n#endif\n#ifdef USE_ALPHAMAP\n\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n\n#endif\n#ifdef USE_LIGHTMAP\n\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n\n#endif\n#ifdef USE_AOMAP\n\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n\n#endif\n#ifdef USE_BUMPMAP\n\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n\n#endif\n#ifdef USE_NORMALMAP\n\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n\n#endif\n#ifdef USE_EMISSIVEMAP\n\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n\n#endif\n#ifdef USE_METALNESSMAP\n\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n\n#endif\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n\n#endif\n#ifdef USE_ANISOTROPYMAP\n\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n\n#endif\n#ifdef USE_CLEARCOATMAP\n\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n\n#endif\n#ifdef USE_SPECULARMAP\n\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n\n#endif\n#ifdef USE_THICKNESSMAP\n\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n\n#endif\n",uv_vertex:"\n#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\n\tvUv = vec3( uv, 1 ).xy;\n\n#endif\n#ifdef USE_MAP\n\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_ALPHAMAP\n\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_LIGHTMAP\n\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_AOMAP\n\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_BUMPMAP\n\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_NORMALMAP\n\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_EMISSIVEMAP\n\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_METALNESSMAP\n\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_ROUGHNESSMAP\n\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_ANISOTROPYMAP\n\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_CLEARCOATMAP\n\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_SPECULARMAP\n\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n\n#endif\n#ifdef USE_THICKNESSMAP\n\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n\n#endif\n",worldpos_vertex:"\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\n\t#ifdef USE_BATCHING\n\n\t\tworldPosition = batchingMatrix * worldPosition;\n\n\t#endif\n\n\t#ifdef USE_INSTANCING\n\n\t\tworldPosition = instanceMatrix * worldPosition;\n\n\t#endif\n\n\tworldPosition = modelMatrix * worldPosition;\n\n#endif\n",fengmap_map_fragment:"\n#ifdef USE_MAP\n\nvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n  bool needMultiply = true;\n\tif(!isJsonModel){\n\t\tif (vMapUv.x < 0.0 || vMapUv.x > 1.0 || vMapUv.y < 0.0 || vMapUv.y > 1.0) {\n\t\t\tsampledDiffuseColor = diffuseColor;\n\t\t\tneedMultiply = false;\n\t\t}\n\t}\n\t\n\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\t// use inline sRGB decode until browsers properly support SRGB8_ALPHA8 with video textures (#26516)\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\n\tif(mapMixColor){\n\t\tvec2 uvHeat=vec2((heatPosition.x -  (heatCenter.x - heatSize.x/2.0)) / heatSize.x , (heatPosition.z - (heatCenter.y-heatSize.y/2.0)) / heatSize.y);\n\t\tvec4 heatColor=texture2D( map, uvHeat );\n\t\tdiffuseColor = heatColor*heatColor.a + diffuseColor*(1.0-heatColor.a);\n\t} else if(needMultiply){\n\t\tdiffuseColor *= sampledDiffuseColor;\n\t}\n#endif\n",fengmap_lights_pars_begin:"\nuniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n\n#if defined( USE_LIGHT_PROBES )\n\n\tuniform vec3 lightProbe[ 9 ];\n\n#endif\n\n// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\n\t// normal is assumed to have unit length\n\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\n\t// band 0\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\n\t// band 1\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\n\t// band 2\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\n\treturn result;\n\n}\n\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\n\treturn irradiance;\n\n}\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n\n}\n\n// fengmap r115\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n    #if defined ( PHYSICALLY_CORRECT_LIGHTS )\n        float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n        if( cutoffDistance > 0.0 ) {\n            distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n        }\n        return distanceFalloff;\n    #else\n\n        if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n            return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n        }\n        return 1.0;\n    #endif\n}\n\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\n\t// page 32, equation 26: E[window1]\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\n\tif ( cutoffDistance > 0.0 ) {\n\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\n\t}\n\n\treturn distanceFalloff;\n\n}\n\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n\n}\n\n#if NUM_DIR_LIGHTS > 0\n\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\n\t}\n\n#endif\n\n\n#if NUM_POINT_LIGHTS > 0\n\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\n\t// light is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\n\t\tlight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\n\t}\n\n#endif\n\n\n#if NUM_SPOT_LIGHTS > 0\n\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\n\t// light is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\n\t\tlight.direction = normalize( lVector );\n\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n\t\tif ( spotAttenuation > 0.0 ) {\n\n\t\t\tfloat lightDistance = length( lVector );\n\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\n\t\t} else {\n\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\n\t\t}\n\n\t}\n\n#endif\n\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\n\t// Pre-computed values of LinearTransformedCosine approximation of BRDF\n\t// BRDF approximation Texture is 64x64\n\tuniform sampler2D ltc_1; // RGBA Float\n\tuniform sampler2D ltc_2; // RGBA Float\n\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n\n#endif\n\n\n#if NUM_HEMI_LIGHTS > 0\n\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n\t\treturn irradiance;\n\n\t}\n\n#endif\n",fengmap_lights_lambert_pars_fragment:"\nvarying vec3 vViewPosition;\n\nstruct LambertMaterial {\n\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n\n};\n\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = vec3(dotNL) * directLight.color;\n\tirradiance *= 3.1415926;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert\n",fengmap_lights_physical_pars_fragment:'\n\nstruct PhysicalMaterial {\n\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n\n};\n\n// temporary\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\n\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\n\treturn 0.5 / max( gv + gl, EPSILON );\n\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disneys reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\n\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n\n}\n\n// https://google.github.io/filament/Filament.md.html#materialsystem/anisotropicmodel/anisotropicspecularbrdf\n#ifdef USE_ANISOTROPY\n\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\n\t\treturn saturate(v);\n\n\t}\n\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\n\t}\n\n#endif\n\n#ifdef USE_CLEARCOAT\n\n\t// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\n\t\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\t\tfloat D = D_GGX( alpha, dotNH );\n\n\t\treturn F * ( V * D );\n\n\t}\n\n#endif\n\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\n\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\n\t#ifdef USE_IRIDESCENCE\n\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\n\t#endif\n\n\t#ifdef USE_ANISOTROPY\n\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\n\t#else\n\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\t\tfloat D = D_GGX( alpha, dotNH );\n\n\t#endif\n\n\treturn F * ( V * D );\n\n}\n\n// Rect Area Light\n\n// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines\n// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt\n// code: https://github.com/selfshadow/ltc_code/\n\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\tfloat dotNV = saturate( dot( N, V ) );\n\n\t// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\treturn uv;\n\n}\n\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\n\t// Real-Time Area Lighting: a Journey from Research to Production (p.102)\n\t// An approximation of the form factor of a horizon-clipped rectangle.\n\n\tfloat l = length( f );\n\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n\n}\n\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\n\tfloat x = dot( v1, v2 );\n\n\tfloat y = abs( x );\n\n\t// rational polynomial approximation to theta / sin( theta ) / 2PI\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\n\treturn cross( v1, v2 ) * theta_sintheta;\n\n}\n\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\n\t// bail if point is on back side of plane of light\n\t// assumes ccw winding order of light vertices\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\n\t// construct orthonormal basis around N\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system\n\n\t// compute transform\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\n\t// transform rect\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\n\t// project rect onto sphere\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\n\t// calculate vector form factor\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\n\t// adjust for horizon clipping\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\n/*\n\t// alternate method of adjusting for horizon clipping (see referece)\n\t// refactoring required\n\tfloat len = length( vectorFormFactor );\n\tfloat z = vectorFormFactor.z / len;\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\t// tabulated horizon-clipped sphere, apparently...\n\tvec2 uv = vec2( z * 0.5 + 0.5, len );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\tfloat scale = texture2D( ltc_2, uv ).w;\n\n\tfloat result = len * scale;\n*/\n\n\treturn vec3( result );\n\n}\n\n// End Rect Area Light\n\n#if defined( USE_SHEEN )\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs\nfloat D_Charlie( float roughness, float dotNH ) {\n\n\tfloat alpha = pow2( roughness );\n\n\t// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF"\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 ); // 2^(-14/2), so sin2h^2 > 0 in fp16\n\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n\n}\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\n\t// Neubelt and Pettineo 2013, "Crafting a Next-gen Material Pipeline for The Order: 1886"\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n\n}\n\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\n\treturn sheenColor * ( D * V );\n\n}\n\n#endif\n\n// This is a curve-fit approxmation to the "Charlie sheen" BRDF integrated over the hemisphere from\n// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF". The analysis can be found\n// in the Sheen section of https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tfloat r2 = roughness * roughness;\n\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\n\treturn saturate( DG * RECIPROCAL_PI );\n\n}\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via \'environmentBRDF\' from "Physically Based Shading on Mobile"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n\tvec4 r = roughness * c0 + c1;\n\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\n\treturn fab;\n\n}\n\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\n\treturn specularColor * fab.x + specularF90 * fab.y;\n\n}\n\n// Fdez-Agera\'s "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\n\t#ifdef USE_IRIDESCENCE\n\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\n\t#else\n\n\t\tvec3 Fr = specularColor;\n\n\t#endif\n\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619; // 1/21\n\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n\n}\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction\n\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\n\t\t// LTC Fresnel Approximation by Stephen Hill\n\t\t// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\n\t}\n\n#endif\n\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tirradiance *= PI; // punctual light\n\n\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\n\t#endif\n\n\t#ifdef USE_SHEEN\n\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\n\t#endif\n\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\n\t#ifdef USE_CLEARCOAT\n\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\n\t#endif\n\n\t#ifdef USE_SHEEN\n\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\n\t#endif\n\n\t// Both indirect specular and indirect diffuse light accumulate here\n\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\n\t#ifdef USE_IRIDESCENCE\n\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\n\t#else\n\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\n\t#endif\n\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n}\n',fengmap_sweep_fragment:"\nif(isRect&&isEnable){\n  vec2 v = vec2(v_position.x - moveP.x, v_position.z - moveP.y);\n  if(isInRectW(v,se2N,sweepW) && isInRectH(v,se2RN,sweepH)){\n    gl_FragColor = vec4(mix(gl_FragColor.rgb, sweepStrength*color_a.rgb, 0.5),gl_FragColor.a);\n  }\n}\n\nif(isAnnulus&&isEnable){\n  if(isMaxCircle(v_position.xyz,circleC,maxR) && isMinCircle(v_position.xyz,circleC,minR)){\n    if(isSweepTexture){\n      vec2 uv = vec2((v_position.x-(circleC.x-maxR))/(2.0*maxR),(v_position.z-(circleC.y-maxR))/(2.0*maxR));\n      vec4 tex = texture2D( sweepTexture, uv );\n      tex = mapTexelToLinear( tex );\n      float d2 = pow(v_position.x-circleC.x,2.0) + pow(v_position.z-circleC.y,2.0);\n      float a = smoothstep(0.0, pow(maxR,2.0), d2);\n      a = 1.0 - a;\n      tex.a = a;\n      gl_FragColor = vec4(mix(gl_FragColor.rgb, sweepStrength*tex.rgb, 0.2),gl_FragColor.a);\n    } else {\n      gl_FragColor = vec4(mix(gl_FragColor.rgb, sweepStrength*color_a.rgb, 0.5),gl_FragColor.a);\n    }\n  }\n\n}\n",fengmap_sweep_pars_fragment:"\n\tuniform bool isRect;\n\tuniform bool isAnnulus;\n\n\tuniform float sweepW;\n\tuniform float sweepH;\n\tuniform vec2 se2N;\n\tuniform vec2 se2RN;\n\tuniform vec2 moveP;\n\tuniform vec3 color_r;\n\n\tuniform vec2 circleC;\n\tuniform float maxR;\n\tuniform float minR;\n\tuniform vec3 color_a;\n\n\tuniform bool isSweepTexture;\n\tuniform sampler2D sweepTexture;\n\tuniform float sweepStrength;\n\n  uniform bool isEnable;\n\n\tbool isInRectW(vec2 v, vec2 a, float w){\n\t\tfloat a1 = abs(dot(v,a));\n\t\treturn a1 < w;\n\t}\n\n\tbool isInRectH(vec2 v, vec2 a, float h){\n\t\tfloat a1 = abs(dot(v,a));\n\t\treturn a1 < h;\n\t}\n\n\tbool isMaxCircle(vec3 a, vec2 b, float r){\n\t\tfloat c = pow((a.x-b.x),2.0)+pow((a.z-b.y),2.0);\n\t\treturn c <= pow(r,2.0);\n\t}\n\n\tbool isMinCircle(vec3 a, vec2 b, float r){\n\t\tfloat c = pow((a.x-b.x),2.0)+pow((a.z-b.y),2.0);\n\t\treturn c > pow(r,2.0);\n\t}\n\n\tvec4 mapTexelToLinear( vec4 value ) {\n\t\treturn value;\n\t}\n",fengmap_sweep_pars_common:"\n varying vec3 v_position;\n",fengmap_sweep_vertex:"\n  v_position = vec3(modelMatrix * vec4( position, 1.0 ));\n",fengmap_mask_vertex1:"\n    #if NUM_MASK_POLYGON > 0\n        varying vec3 maskPosition;\n    #endif\n",fengmap_mask_vertex2:"\n    #if NUM_MASK_POLYGON > 0\n        maskPosition = vec3(modelMatrix * vec4( position, 1.0 ));\n    #endif\n",fengmap_mask_fragment1:"\n    #if NUM_MASK_POLYGON > 0\n        varying vec3 maskPosition;\n        varying float v_positionHeight;\n        uniform vec2 maskPolygons[ NUM_MASK_POLYGON ];\n        uniform int maskType;\n        uniform bool isMask;\n        uniform float maskHeight;\n        uniform float maskExtrudeHeight;\n        uniform vec2 boundCenter;\n\t    uniform vec2 boundSize;\n        uniform float maskOpacity;\n        uniform float maskNodeHeight;\n        bool isPointInsidePolygon(vec2 point,vec2 polygon2[NUM_MASK_POLYGON], int count) {\n            if(count==1){\n                return false;\n            }\n            if(count==2){\n                return true;\n            }\n            <#ISPOINTINSIDEPOLYGON#>\n        }\n    #endif\n     #if NUM_MASK_HOLE_POLYGON>0\n        uniform vec2 maskHolePogygons[ NUM_MASK_HOLE_POLYGON ];\n        bool isPointInsideHolePolygon(vec2 point,vec2 polygon2[NUM_MASK_HOLE_POLYGON], int count) {\n            if(count==1){\n                return false;\n            }\n            if(count==2){\n                return true;\n            }\n            <#ISPOINTINSIDEHOLEPOLYGON#>\n        }\n     #endif\n",fengmap_mask_fragment2:"\n    #if NUM_MASK_POLYGON > 0\n    if(isMask){\n            vec2 uvMesk=vec2((maskPosition.x -  (boundCenter.x - boundSize.x/2.0)) / boundSize.x , (maskPosition.z - (boundCenter.y-boundSize.y/2.0)) / boundSize.y);\n            bool isDiscard=false;\n    \n            if(maskType==0){\n                if(!isPointInsidePolygon(uvMesk,maskPolygons,NUM_MASK_POLYGON)){\n                    isDiscard=true;            \n                }\n            } else {\n                if(isPointInsidePolygon(uvMesk,maskPolygons,NUM_MASK_POLYGON)){\n                    isDiscard=true;            \n                }\n            }\n    \n    #if NUM_MASK_HOLE_POLYGON > 0\n        if(maskType==0){\n            if(!isDiscard && isPointInsideHolePolygon(uvMesk,maskHolePogygons,NUM_MASK_HOLE_POLYGON)){\n                isDiscard=true;            \n            }\n        } else {\n            if(isDiscard && isPointInsideHolePolygon(uvMesk,maskHolePogygons,NUM_MASK_HOLE_POLYGON)){\n                isDiscard=false;             \n            }\n        }\n            \n    #endif\n        if(isDiscard){\n            if(maskPosition.y >= maskNodeHeight + maskHeight && maskPosition.y <= maskNodeHeight + maskHeight + maskExtrudeHeight){\n                if(maskOpacity == 0.0){\n                    discard;\n                } else {\n                    diffuseColor.a = maskOpacity;\n                }\n            }\n        }\n    }\n    #endif\n",background_vert:"\nvarying vec2 vUv;\nuniform mat3 uvTransform;\n\nvoid main() {\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n\n}\n",background_frag:"\nuniform sampler2D t2D;\nuniform float backgroundIntensity;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tvec4 texColor = texture2D( t2D, vUv );\n\n\t#ifdef DECODE_VIDEO_TEXTURE\n\n\t\t// use inline sRGB decode until browsers properly support SRGB8_APLHA8 with video textures\n\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\n\t#endif\n\n\ttexColor.rgb *= backgroundIntensity;\n\n\tgl_FragColor = texColor;\n\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\n}\n",backgroundCube_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n}\n",backgroundCube_frag:"\n\n#ifdef ENVMAP_TYPE_CUBE\n\n\tuniform samplerCube envMap;\n\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\tuniform sampler2D envMap;\n\n#endif\n\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\n\nvarying vec3 vWorldDirection;\n\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\n\t#else\n\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t#endif\n\n\ttexColor.rgb *= backgroundIntensity;\n\n\tgl_FragColor = texColor;\n\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\n}\n",cube_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n}\n",cube_frag:"\nuniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\n\nvarying vec3 vWorldDirection;\n\nvoid main() {\n\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\n}\n",depth_vert:"\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n// This is used for computing an equivalent of gl_FragCoord.z that is as high precision as possible.\n// Some platforms compute gl_FragCoord at a lower precision which makes the manually computed value better for\n// depth-based postprocessing effects. Reproduced on iPad with A10 processor / iPadOS 13.3.1.\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\n\t#include <morphinstance_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvHighPrecisionZW = gl_Position.zw;\n\n}\n",depth_frag:"\n#if DEPTH_PACKING == 3200\n\n\tuniform float opacity;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tdiffuseColor.a = opacity;\n\n\t#endif\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\n\t#include <logdepthbuf_fragment>\n\n\t// Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\n\t#elif DEPTH_PACKING == 3201\n\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\n\t#elif DEPTH_PACKING == 3202\n\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\n\t#elif DEPTH_PACKING == 3203\n\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\n\t#endif\n\n}\n",distanceRGBA_vert:"\n#define DISTANCE\n\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\n\t#include <morphinstance_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvWorldPosition = worldPosition.xyz;\n\n}\n",distanceRGBA_frag:"\n#define DISTANCE\n\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main () {\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist ); // clamp to [ 0, 1 ]\n\n\tgl_FragColor = packDepthToRGBA( dist );\n\n}\n",equirect_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n}\n",equirect_frag:"\nuniform sampler2D tEquirect;\n\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvec3 direction = normalize( vWorldDirection );\n\n\tvec2 sampleUV = equirectUv( direction );\n\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\n}\n",linedashed_vert:"\nuniform float scale;\nattribute float lineDistance;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\tvLineDistance = scale * lineDistance;\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",linedashed_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\nuniform float dashSize;\nuniform float totalSize;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\n\t\tdiscard;\n\n\t}\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\n\toutgoingLight = diffuseColor.rgb; // simple shader\n\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",meshbasic_vert:"\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshbasic_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshlambert_vert:"\n#define LAMBERT\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshlambert_frag:"\n#define LAMBERT\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshmatcap_vert:"\n#define MATCAP\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n}\n",meshmatcap_frag:"\n#define MATCAP\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\n\t#ifdef USE_MATCAP\n\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\n\t#else\n\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 ); // default if matcap is missing\n\n\t#endif\n\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshnormal_vert:"\n#define NORMAL\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\n\tvViewPosition = - mvPosition.xyz;\n\n#endif\n\n}\n",meshnormal_frag:"\n#define NORMAL\n\nuniform float opacity;\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\n\t#ifdef OPAQUE\n\n\t\tgl_FragColor.a = 1.0;\n\n\t#endif\n\n}\n",meshphong_vert:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphong_frag:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphysical_vert:"\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifdef USE_TRANSMISSION\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n#ifdef USE_TRANSMISSION\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif\n}\n",meshphysical_frag:"\n#define STANDARD\n\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef IOR\n\tuniform float ior;\n#endif\n\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\n\t#include <transmission_fragment>\n\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\n\t#ifdef USE_SHEEN\n\n\t\t// Sheen energy compensation approximation calculation can be found at the end of\n\t\t// https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT\n\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\n\t#endif\n\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshtoon_vert:"\n#define TOON\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshtoon_frag:"\n#define TOON\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",points_vert:"\nuniform float size;\nuniform float scale;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n#ifdef USE_POINTS_UV\n\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n\n#endif\n\nvoid main() {\n\n\t#ifdef USE_POINTS_UV\n\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\t#endif\n\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\n\tgl_PointSize = size;\n\n\t#ifdef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\n\t#endif\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n\n}\n",points_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",shadow_vert:"\n#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\n\nvoid main() {\n\n\t#include <batching_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",shadow_frag:"\nuniform vec3 color;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n\nvoid main() {\n\n\t#include <logdepthbuf_fragment>\n\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\n}\n",sprite_vert:"\nuniform float rotation;\nuniform vec2 center;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\n\t#ifndef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\n\t#endif\n\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n\tmvPosition.xy += rotatedPosition;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",sprite_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\n}\n",fmMeshlambert_vert:"\n#define LAMBERT\n\nvarying vec3 vViewPosition;\nvarying vec3 heatPosition;\n\n// fengmap\nvarying float vIsPerspectiveCamera;\n\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#include <fengmap_mask_vertex1>\n\nvoid main() {\n\theatPosition = vec3(modelMatrix * vec4( position, 1.0 ));\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fengmap_mask_vertex2>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n\t// fengmap\n\tvIsPerspectiveCamera = isPerspectiveMatrix( projectionMatrix ) ? 1.0 : 0.0;\n}\n",fmMeshlambert_frag:"\n#define LAMBERT\n\n// fengmap\nvarying float vIsPerspectiveCamera;\n\nvarying vec3 heatPosition;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nuniform bool mapMixColor;\nuniform vec2 heatCenter;\nuniform vec2 heatSize;\n\nuniform bool isJsonModel;\n\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <fengmap_lights_pars_begin>\n#include <normal_pars_fragment>\n#include <fengmap_lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#include <fengmap_mask_fragment1>\n\nvec3 rgb2hsb(vec3 c) {\n    float maxVal = max(c.r, max(c.g, c.b));\n    float minVal = min(c.r, min(c.g, c.b));\n    float delta = maxVal - minVal;\n\n    float h = 0.0;\n    if (delta > 0.0) {\n        if (maxVal == c.r) {\n            h = mod((c.g - c.b) / delta, 6.0);\n        } else if (maxVal == c.g) {\n            h = (c.b - c.r) / delta + 2.0;\n        } else {\n            h = (c.r - c.g) / delta + 4.0;\n        }\n        h /= 6.0; // Normalize to range [0,1]\n    }\n\n    float s = (maxVal == 0.0) ? 0.0 : delta / maxVal;\n    float b = maxVal;\n\n    return vec3(h, s, b);\n}\n\nvec3 hsb2rgb(vec3 c) {\n    float h = c.x * 6.0;\n    float s = c.y;\n    float b = c.z;\n\n    float i = floor(h);\n    float f = h - i;\n    float p = b * (1.0 - s);\n    float q = b * (1.0 - f * s);\n    float t = b * (1.0 - (1.0 - f) * s);\n\n    if (i == 0.0) return vec3(b, t, p);\n    if (i == 1.0) return vec3(q, b, p);\n    if (i == 2.0) return vec3(p, b, t);\n    if (i == 3.0) return vec3(p, q, b);\n    if (i == 4.0) return vec3(t, p, b);\n    return vec3(b, p, q);\n}\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <clipping_planes_fragment>\n\t#include <fengmap_mask_fragment2>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <fengmap_map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#ifdef IGNORE_LIGHTING\n\t  if(vIsPerspectiveCamera == 0.0) {\n\t\t\toutgoingLight = diffuseColor.rgb;\n\t\t}\n\t#endif\n\n\t#ifdef USE_MODEL_SIDE_GRADIENT\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\tif (dot(vec3(0.0, 1.0, 0.0), worldNormal) < 0.8) {\n\t\t\tvec3 hsb = rgb2hsb(outgoingLight);\n\t\t\thsb.y = clamp(hsb.y * 1.5, 0.0, 1.0);\n\t\t\thsb.z = clamp(hsb.z * 0.8, 0.0, 1.0);\n\t\t\toutgoingLight = mix(hsb2rgb(hsb), outgoingLight, vUv.y);\n\t\t}\n\t#endif\n\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",fmMeshphysical_vert:"\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifdef USE_TRANSMISSION\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#include <fengmap_sweep_pars_common>\n#include <fengmap_mask_vertex1>\n\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fengmap_mask_vertex2>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n#ifdef USE_TRANSMISSION\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif\n\n\t//fengmap\n\t#include <fengmap_sweep_vertex>\n}\n",fmMeshphysical_frag:"\n#define STANDARD\n\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef IOR\n\tuniform float ior;\n#endif\n\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <fengmap_lights_pars_begin>\n#include <normal_pars_fragment>\n#include <fengmap_lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#include <fengmap_mask_fragment1>\n#include <fengmap_sweep_pars_common>\n#include <fengmap_sweep_pars_fragment>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <fengmap_mask_fragment2>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\n\t#include <transmission_fragment>\n\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\n\t#ifdef USE_SHEEN\n\n\t\t// Sheen energy compensation approximation calculation can be found at the end of\n\t\t// https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT\n\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\n\t#endif\n\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\t#include <fengmap_sweep_fragment>\n}\n",fmMeshBasic_vert:"\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#include <fengmap_mask_vertex1>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fengmap_mask_vertex2>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n\n}\n",fmMeshBasic_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#include <fengmap_mask_fragment1>\n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <fengmap_mask_fragment2>\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n"};function vu(t){return(vu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function du(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=vu(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=vu(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==vu(t)?t:t+""))(i.key),i)}}function mu(t,n,e){n=bu(n);var i=t,n=pu()?Reflect.construct(n,e||[],bu(t).constructor):n.apply(t,e);if(!n||"object"!=vu(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function pu(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(pu=function(){return!!t})()}function yu(t,n,e,i){var r=gu(bu(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function gu(){return(gu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=bu(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function bu(t){return(bu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _u(t,n){return(_u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var wu=new U,Su=new B,xu=new B,Au=(()=>{function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:50,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:2e3,r=this,o=a;if(r instanceof o)return(r=mu(this,a)).isPerspectiveCamera=!0,r.type="PerspectiveCamera",r.fov=t,r.zoom=1,r.near=e,r.far=i,r.focus=10,r.aspect=n,r.view=null,r.filmGauge=35,r.filmOffset=0,r.updateProjectionMatrix(),r;throw new TypeError("Cannot call a class as a function")}var t,n=a,e=mr;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&_u(n,e),n=a,(e=[{key:"copy",value:function(t,n){return yu(a,"copy",this,3)([t,n]),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}},{key:"setFocalLength",value:function(t){t=.5*this.getFilmHeight()/t;this.fov=2*P*Math.atan(t),this.updateProjectionMatrix()}},{key:"getFocalLength",value:function(){var t=Math.tan(.5*M*this.fov);return.5*this.getFilmHeight()/t}},{key:"getEffectiveFOV",value:function(){return 2*P*Math.atan(Math.tan(.5*M*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"getViewBounds",value:function(t,n,e){wu.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(wu.x,wu.y).multiplyScalar(-t/wu.z),wu.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(wu.x,wu.y).multiplyScalar(-t/wu.z)}},{key:"getViewSize",value:function(t,n){return this.getViewBounds(t,Su,xu),n.subVectors(xu,Su)}},{key:"setViewOffset",value:function(t,n,e,i,r,o){this.aspect=t/n,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=n,this.view.offsetX=e,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var t,n=this.near,e=n*Math.tan(.5*M*this.fov)/this.zoom,i=2*e,r=this.aspect*i,o=-.5*r,a=this.view,s=(null!==this.view&&this.view.enabled&&(s=a.fullWidth,t=a.fullHeight,o+=a.offsetX*r/s,e-=a.offsetY*i/t,r*=a.width/s,i*=a.height/t),this.filmOffset);0!==s&&(o+=n*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+r,e,e-i,n,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(t){t=yu(a,"toJSON",this,3)([t]);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}])&&du(n.prototype,e),t&&du(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Eu(t){return(Eu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Tu(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Eu(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Eu(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Eu(t)?t:t+""))(i.key),i)}}function Mu(t,n,e){n=Ou(n);var i=t,n=Pu()?Reflect.construct(n,e||[],Ou(t).constructor):n.apply(t,e);if(!n||"object"!=Eu(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Pu(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Pu=function(){return!!t})()}function Ou(t){return(Ou=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Nu(t,n){return(Nu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Cu=(()=>{function P(t,n){var a,s,e,i,r,o,u,l,c,f,h,v,d,m,p,y,g,b,_,w,S,x,A,E,T,M;if(this instanceof P)return a=t=Mu(this,P,[t]),t.parentNode=n.parentNode,T=void 0!==(n=n||{}).textureWidth?n.textureWidth:512,M=void 0!==n.textureHeight?n.textureHeight:512,s=void 0!==n.clipBias?n.clipBias:0,e=void 0!==n.alpha?n.alpha:1,i=void 0!==n.time?n.time:0,r=void 0!==n.waterNormals?n.waterNormals:null,o=void 0!==n.sunDirection?n.sunDirection:new U(.70707,.70707,0),u=new N(void 0!==n.sunColor?n.sunColor:16777215),l=new N(void 0!==n.waterColor?n.waterColor:8355711),c=void 0!==n.eye?n.eye:new U(0,0,0),f=void 0!==n.distortionScale?n.distortionScale:20,h=void 0!==n.side?n.side:Y,n=void 0!==n.fog&&n.fog,v=new hu,d=new U,m=new U,p=new U,y=new C,g=new U(0,0,-1),b=new Dr,_=new U,w=new U,S=new Dr,x=new C,A=new Au,E=new D(T,M,{minFilter:O,magFilter:O,format:1022,stencilBuffer:!1,depthBuffer:!0}),t.renderTarget=E,X.isPowerOfTwo(T)&&X.isPowerOfTwo(M)||(E.texture.generateMipmaps=!1),T={uniforms:L.merge([F.fog,F.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new C},sunColor:{value:new N(8355711)},sunDirection:{value:new U(.70707,.70707,0)},eye:{value:new U},waterColor:{value:new N(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","#include <logdepthbuf_pars_vertex>","varying vec4 mirrorCoord;","varying vec4 worldPosition;","#include <common>",I.fog_pars_vertex,I.shadowmap_pars_vertex,"void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;","\t#include <logdepthbuf_vertex>",I.fog_vertex,I.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float size;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","#include <logdepthbuf_pars_fragment>","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}",I.common,I.packing,I.bsdfs,I.fog_pars_fragment,I.lights_pars_begin,I.shadowmap_pars_fragment,I.shadowmask_pars_fragment,"void main() {","\t#include <logdepthbuf_fragment>","\tvec4 noise = getNoise( worldPosition.xz * size );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );",I.tonemapping_fragment,I.fog_fragment,"}"].join("\n")},(M=new R({fragmentShader:T.fragmentShader,vertexShader:T.vertexShader,uniforms:L.clone(T.uniforms),lights:!0,side:h,fog:n,transparent:!0,depthTest:!0,depthWrite:!1})).uniforms.mirrorSampler.value=E.texture,M.uniforms.textureMatrix.value=x,M.uniforms.alpha.value=e,M.uniforms.time.value=i,M.uniforms.normalSampler.value=r,M.uniforms.sunColor.value=u,M.uniforms.waterColor.value=l,M.uniforms.sunDirection.value=o,M.uniforms.distortionScale.value=f,M.uniforms.eye.value=c,a.material=M,a.onBeforeRender=function(t,n,e){var i,r,o;m.setFromMatrixPosition(a.matrixWorld),p.setFromMatrixPosition(e.matrixWorld),y.extractRotation(a.matrixWorld),d.set(0,0,1),d.applyMatrix4(y),_.subVectors(m,p),0<_.dot(d)||(_.reflect(d).negate(),_.add(m),y.extractRotation(e.matrixWorld),g.set(0,0,-1),g.applyMatrix4(y),g.add(p),w.subVectors(m,g),w.reflect(d).negate(),w.add(m),A.position.copy(_),A.up.set(0,1,0),A.up.applyMatrix4(y),A.up.reflect(d),A.lookAt(w),A.far=e.far,A.updateMatrixWorld(),A.projectionMatrix.copy(e.projectionMatrix),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(A.projectionMatrix),x.multiply(A.matrixWorldInverse),v.setFromNormalAndCoplanarPoint(d,m),v.applyMatrix4(A.matrixWorldInverse),b.set(v.normal.x,v.normal.y,v.normal.z,v.constant),i=A.projectionMatrix,S.x=(Math.sign(b.x)+i.elements[8])/i.elements[0],S.y=(Math.sign(b.y)+i.elements[9])/i.elements[5],S.z=-1,S.w=(1+i.elements[10])/i.elements[14],b.multiplyScalar(2/b.dot(S)),i.elements[2]=b.x,i.elements[6]=b.y,i.elements[10]=b.z+1-s,i.elements[14]=b.w,c.setFromMatrixPosition(e.matrixWorld),i=t.getRenderTarget(),o=t.xr.enabled,r=t.shadowMap.autoUpdate,a.visible=!1,t.xr.enabled=!1,t.shadowMap.autoUpdate=!1,t.setRenderTarget(E),!1===t.autoClear&&t.clear(),a.parentNode&&(a.parentNode.$t(!0),t.render(a.parentNode.tn,A),a.parentNode.$t(!1)),a.visible=!0,t.xr.enabled=o,t.shadowMap.autoUpdate=r,t.setRenderTarget(i),void 0!==(o=e.viewport)&&t.state.viewport(o))},t;throw new TypeError("Cannot call a class as a function")}var t,n,e=P,i=_;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Nu(e,i),e=P,t&&Tu(e.prototype,t),n&&Tu(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e})();function Lu(t){return(Lu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ru(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Lu(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Lu(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Lu(t)?t:t+""))(i.key),i)}}var Du=(()=>{function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.type="Curve",this.arcLengthDivisions=200}return n=t,(e=[{key:"getPoint",value:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}},{key:"getPointAt",value:function(t,n){t=this.getUtoTmapping(t);return this.getPoint(t,n)}},{key:"getPoints",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:5,n=[],e=0;e<=t;e++)n.push(this.getPoint(e/t));return n}},{key:"getSpacedPoints",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:5,n=[],e=0;e<=t;e++)n.push(this.getPointAt(e/t));return n}},{key:"getLength",value:function(){var t=this.getLengths();return t[t.length-1]}},{key:"getLengths",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var n,e=[],i=this.getPoint(0),r=0;e.push(0);for(var o=1;o<=t;o++)r+=(n=this.getPoint(o/t)).distanceTo(i),e.push(r),i=n;return this.cacheArcLengths=e}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.getLengths()}},{key:"getUtoTmapping",value:function(t,n){for(var e,i=this.getLengths(),r=0,o=i.length,a=n||t*i[o-1],s=0,u=o-1;s<=u;)if((e=i[r=Math.floor(s+(u-s)/2)]-a)<0)s=r+1;else{if(!(0<e)){u=r;break}u=r-1}return i[r=u]===a?r/(o-1):(r+(a-(n=i[r]))/(i[r+1]-n))/(o-1)}},{key:"getTangent",value:function(t,n){var e=t-1e-4,t=t+1e-4,e=(1<t&&(t=1),this.getPoint(e=e<0?0:e)),t=this.getPoint(t),n=n||new(e.isVector2?B:U);return n.copy(t).sub(e).normalize(),n}},{key:"getTangentAt",value:function(t,n){t=this.getUtoTmapping(t);return this.getTangent(t,n)}},{key:"computeFrenetFrames",value:function(t,n){for(var e=new U,i=[],r=[],o=[],a=new U,s=new C,u=0;u<=t;u++)i[u]=this.getTangentAt(u/t,new U);r[0]=new U,o[0]=new U;var l=Number.MAX_VALUE,c=Math.abs(i[0].x),f=Math.abs(i[0].y),h=Math.abs(i[0].z);c<=l&&(l=c,e.set(1,0,0)),f<=l&&(l=f,e.set(0,1,0)),h<=l&&e.set(0,0,1),a.crossVectors(i[0],e).normalize(),r[0].crossVectors(i[0],a),o[0].crossVectors(i[0],r[0]);for(var v,d=1;d<=t;d++)r[d]=r[d-1].clone(),o[d]=o[d-1].clone(),a.crossVectors(i[d-1],i[d]),a.length()>Number.EPSILON&&(a.normalize(),v=Math.acos(y(i[d-1].dot(i[d]),-1,1)),r[d].applyMatrix4(s.makeRotationAxis(a,v))),o[d].crossVectors(i[d],r[d]);if(!0===n){var m=Math.acos(y(r[0].dot(r[t]),-1,1));m/=t,0<i[0].dot(a.crossVectors(r[0],r[t]))&&(m=-m);for(var p=1;p<=t;p++)r[p].applyMatrix4(s.makeRotationAxis(i[p],m*p)),o[p].crossVectors(i[p],r[p])}return{tangents:i,normals:r,binormals:o}}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}},{key:"toJSON",value:function(){var t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}},{key:"fromJSON",value:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}])&&Ru(n.prototype,e),i&&Ru(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,e,i})();function Fu(t){return(Fu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Iu(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Fu(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Fu(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Fu(t)?t:t+""))(i.key),i)}}function ku(t,n,e){n=Hu(n);var i=t,n=ju()?Reflect.construct(n,e||[],Hu(t).constructor):n.apply(t,e);if(!n||"object"!=Fu(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function ju(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ju=function(){return!!t})()}function Uu(t,n,e,i){var r=Bu(Hu(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function Bu(){return(Bu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=Hu(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function Hu(t){return(Hu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Vu(t,n){return(Vu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var zu=(()=>{function c(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:2*Math.PI,a=6<arguments.length&&void 0!==arguments[6]&&arguments[6],s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:0,u=this,l=c;if(u instanceof l)return(u=ku(this,c)).isEllipseCurve=!0,u.type="EllipseCurve",u.aX=t,u.aY=n,u.xRadius=e,u.yRadius=i,u.aStartAngle=r,u.aEndAngle=o,u.aClockwise=a,u.aRotation=s,u;throw new TypeError("Cannot call a class as a function")}var t,n=c,e=Du;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Vu(n,e),n=c,(e=[{key:"getPoint",value:function(t){for(var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new B,e=2*Math.PI,i=this.aEndAngle-this.aStartAngle,r=Math.abs(i)<Number.EPSILON;i<0;)i+=e;for(;e<i;)i-=e;i<Number.EPSILON&&(i=r?0:e),!0!==this.aClockwise||r||(i===e?i=-e:i-=e);var o,a,s,u,r=this.aStartAngle+t*i,t=this.aX+this.xRadius*Math.cos(r),r=this.aY+this.yRadius*Math.sin(r);return 0!==this.aRotation&&(o=Math.cos(this.aRotation),a=Math.sin(this.aRotation),t=(s=t-this.aX)*o-(u=r-this.aY)*a+this.aX,r=s*a+u*o+this.aY),n.set(t,r)}},{key:"copy",value:function(t){return Uu(c,"copy",this,3)([t]),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}},{key:"toJSON",value:function(){var t=Uu(c,"toJSON",this,3)([]);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}},{key:"fromJSON",value:function(t){return Uu(c,"fromJSON",this,3)([t]),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}])&&Iu(n.prototype,e),t&&Iu(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Gu(t){return(Gu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xu(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Gu(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Gu(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Gu(t)?t:t+""))(i.key),i)}}function Yu(t,n,e){n=Qu(n);var i=t,n=Wu()?Reflect.construct(n,e||[],Qu(t).constructor):n.apply(t,e);if(!n||"object"!=Gu(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Wu(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Wu=function(){return!!t})()}function Qu(t){return(Qu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function qu(t,n){return(qu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Zu=(()=>{function a(t,n,e,i,r,o){if(this instanceof a)return(t=Yu(this,a,[t,n,e,e,i,r,o])).isArcCurve=!0,t.type="ArcCurve",t;throw new TypeError("Cannot call a class as a function")}var t,n,e=a,i=zu;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&qu(e,i),e=a,t&&Xu(e.prototype,t),n&&Xu(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e})();function Ju(t){return(Ju="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ku(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Ju(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Ju(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Ju(t)?t:t+""))(i.key),i)}}function $u(t,n,e){n=il(n);var i=t,n=tl()?Reflect.construct(n,e||[],il(t).constructor):n.apply(t,e);if(!n||"object"!=Ju(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function tl(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(tl=function(){return!!t})()}function nl(t,n,e,i){var r=el(il(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function el(){return(el="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=il(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function il(t){return(il=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function rl(t,n){return(rl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}function ol(){var r=0,o=0,a=0,s=0;function u(t,n,e,i){a=-3*(r=t)+3*n-2*(o=e)-i,s=2*t-2*n+e+i}return{initCatmullRom:function(t,n,e,i,r){u(n,e,r*(e-t),r*(i-n))},initNonuniformCatmullRom:function(t,n,e,i,r,o,a){t=(n-t)/r-(e-t)/(r+o)+(e-n)/o,r=(e-n)/o-(i-n)/(o+a)+(i-e)/a;u(n,e,t*=o,r*=o)},calc:function(t){var n=t*t;return r+o*t+a*n+s*(n*t)}}}var al=new U,sl=new ol,ul=new ol,ll=new ol,cl=(()=>{function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"centripetal",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.5,r=this,o=a;if(r instanceof o)return(r=$u(this,a)).isCatmullRomCurve3=!0,r.type="CatmullRomCurve3",r.points=t,r.closed=n,r.curveType=e,r.tension=i,r;throw new TypeError("Cannot call a class as a function")}var t,n=a,e=Du;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&rl(n,e),n=a,(e=[{key:"getPoint",value:function(t){var n,e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new U,r=this.points,o=r.length,t=(o-(this.closed?0:1))*t,a=Math.floor(t),t=t-a,s=(this.closed?a+=0<a?0:(Math.floor(Math.abs(a)/o)+1)*o:0===t&&a===o-1&&(a=o-2,t=1),n=this.closed||0<a?r[(a-1)%o]:(al.subVectors(r[0],r[1]).add(r[0]),al),r[a%o]),u=r[(a+1)%o],a=this.closed||a+2<o?r[(a+2)%o]:(al.subVectors(r[o-1],r[o-2]).add(r[o-1]),al);return"centripetal"===this.curveType||"chordal"===this.curveType?(r="chordal"===this.curveType?.5:.25,o=Math.pow(n.distanceToSquared(s),r),(e=Math.pow(s.distanceToSquared(u),r))<1e-4&&(e=1),o<1e-4&&(o=e),(r=Math.pow(u.distanceToSquared(a),r))<1e-4&&(r=e),sl.initNonuniformCatmullRom(n.x,s.x,u.x,a.x,o,e,r),ul.initNonuniformCatmullRom(n.y,s.y,u.y,a.y,o,e,r),ll.initNonuniformCatmullRom(n.z,s.z,u.z,a.z,o,e,r)):"catmullrom"===this.curveType&&(sl.initCatmullRom(n.x,s.x,u.x,a.x,this.tension),ul.initCatmullRom(n.y,s.y,u.y,a.y,this.tension),ll.initCatmullRom(n.z,s.z,u.z,a.z,this.tension)),i.set(sl.calc(t),ul.calc(t),ll.calc(t)),i}},{key:"copy",value:function(t){nl(a,"copy",this,3)([t]),this.points=[];for(var n=0,e=t.points.length;n<e;n++){var i=t.points[n];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}},{key:"toJSON",value:function(){var t=nl(a,"toJSON",this,3)([]);t.points=[];for(var n=0,e=this.points.length;n<e;n++){var i=this.points[n];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}},{key:"fromJSON",value:function(t){nl(a,"fromJSON",this,3)([t]),this.points=[];for(var n=0,e=t.points.length;n<e;n++){var i=t.points[n];this.points.push((new U).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}])&&Ku(n.prototype,e),t&&Ku(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function fl(t,n,e,i,r){var n=.5*(i-n),r=.5*(r-e),o=t*t;return(2*e-2*i+n+r)*(t*o)+(-3*e+3*i-2*n-r)*o+n*t+e}function hl(t,n,e,i){return(r=1-(r=t))*r*n+2*(1-t)*t*e+t*t*i;var r}function vl(t,n,e,i,r){return(o=1-(o=t))*o*o*n+3*(o=1-t)*o*t*e+3*(1-t)*t*t*i+t*t*t*r;var o}function dl(t){return(dl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ml(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=dl(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=dl(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==dl(t)?t:t+""))(i.key),i)}}function pl(t,n,e){n=_l(n);var i=t,n=yl()?Reflect.construct(n,e||[],_l(t).constructor):n.apply(t,e);if(!n||"object"!=dl(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function yl(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(yl=function(){return!!t})()}function gl(t,n,e,i){var r=bl(_l(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function bl(){return(bl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=_l(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function _l(t){return(_l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function wl(t,n){return(wl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Sl=(()=>{function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new B,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new B,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new B,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new B,r=this,o=a;if(r instanceof o)return(r=pl(this,a)).isCubicBezierCurve=!0,r.type="CubicBezierCurve",r.v0=t,r.v1=n,r.v2=e,r.v3=i,r;throw new TypeError("Cannot call a class as a function")}var t,n=a,e=Du;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&wl(n,e),n=a,(e=[{key:"getPoint",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new B,e=this.v0,i=this.v1,r=this.v2,o=this.v3;return n.set(vl(t,e.x,i.x,r.x,o.x),vl(t,e.y,i.y,r.y,o.y)),n}},{key:"copy",value:function(t){return gl(a,"copy",this,3)([t]),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}},{key:"toJSON",value:function(){var t=gl(a,"toJSON",this,3)([]);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}},{key:"fromJSON",value:function(t){return gl(a,"fromJSON",this,3)([t]),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}])&&ml(n.prototype,e),t&&ml(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function xl(t){return(xl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Al(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=xl(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=xl(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==xl(t)?t:t+""))(i.key),i)}}function El(t,n,e){n=Ol(n);var i=t,n=Tl()?Reflect.construct(n,e||[],Ol(t).constructor):n.apply(t,e);if(!n||"object"!=xl(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Tl(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Tl=function(){return!!t})()}function Ml(t,n,e,i){var r=Pl(Ol(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function Pl(){return(Pl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=Ol(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function Ol(t){return(Ol=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Nl(t,n){return(Nl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Cl=(()=>{function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new U,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new U,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new U,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new U,r=this,o=a;if(r instanceof o)return(r=El(this,a)).isCubicBezierCurve3=!0,r.type="CubicBezierCurve3",r.v0=t,r.v1=n,r.v2=e,r.v3=i,r;throw new TypeError("Cannot call a class as a function")}var t,n=a,e=Du;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Nl(n,e),n=a,(e=[{key:"getPoint",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new U,e=this.v0,i=this.v1,r=this.v2,o=this.v3;return n.set(vl(t,e.x,i.x,r.x,o.x),vl(t,e.y,i.y,r.y,o.y),vl(t,e.z,i.z,r.z,o.z)),n}},{key:"copy",value:function(t){return Ml(a,"copy",this,3)([t]),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}},{key:"toJSON",value:function(){var t=Ml(a,"toJSON",this,3)([]);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}},{key:"fromJSON",value:function(t){return Ml(a,"fromJSON",this,3)([t]),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}])&&Al(n.prototype,e),t&&Al(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Ll(t){return(Ll="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Rl(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Ll(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Ll(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Ll(t)?t:t+""))(i.key),i)}}function Dl(t,n,e){n=jl(n);var i=t,n=Fl()?Reflect.construct(n,e||[],jl(t).constructor):n.apply(t,e);if(!n||"object"!=Ll(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Fl(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Fl=function(){return!!t})()}function Il(t,n,e,i){var r=kl(jl(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function kl(){return(kl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=jl(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function jl(t){return(jl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ul(t,n){return(Ul=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Bl=(()=>{function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new B,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new B,e=this,i=r;if(e instanceof i)return(e=Dl(this,r)).isLineCurve=!0,e.type="LineCurve",e.v1=t,e.v2=n,e;throw new TypeError("Cannot call a class as a function")}var t,n=r,e=Du;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Ul(n,e),n=r,(e=[{key:"getPoint",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new B;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}},{key:"getPointAt",value:function(t,n){return this.getPoint(t,n)}},{key:"getTangent",value:function(t){return(1<arguments.length&&void 0!==arguments[1]?arguments[1]:new B).subVectors(this.v2,this.v1).normalize()}},{key:"getTangentAt",value:function(t,n){return this.getTangent(t,n)}},{key:"copy",value:function(t){return Il(r,"copy",this,3)([t]),this.v1.copy(t.v1),this.v2.copy(t.v2),this}},{key:"toJSON",value:function(){var t=Il(r,"toJSON",this,3)([]);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}},{key:"fromJSON",value:function(t){return Il(r,"fromJSON",this,3)([t]),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}])&&Rl(n.prototype,e),t&&Rl(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Hl(t){return(Hl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Vl(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Hl(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Hl(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Hl(t)?t:t+""))(i.key),i)}}function zl(t,n,e){n=Wl(n);var i=t,n=Gl()?Reflect.construct(n,e||[],Wl(t).constructor):n.apply(t,e);if(!n||"object"!=Hl(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Gl(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Gl=function(){return!!t})()}function Xl(t,n,e,i){var r=Yl(Wl(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function Yl(){return(Yl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=Wl(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function Wl(t){return(Wl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ql(t,n){return(Ql=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var ql=(()=>{function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new U,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new U,e=this,i=r;if(e instanceof i)return(e=zl(this,r)).isLineCurve3=!0,e.type="LineCurve3",e.v1=t,e.v2=n,e;throw new TypeError("Cannot call a class as a function")}var t,n=r,e=Du;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Ql(n,e),n=r,(e=[{key:"getPoint",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new U;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}},{key:"getPointAt",value:function(t,n){return this.getPoint(t,n)}},{key:"getTangent",value:function(t){return(1<arguments.length&&void 0!==arguments[1]?arguments[1]:new U).subVectors(this.v2,this.v1).normalize()}},{key:"getTangentAt",value:function(t,n){return this.getTangent(t,n)}},{key:"copy",value:function(t){return Xl(r,"copy",this,3)([t]),this.v1.copy(t.v1),this.v2.copy(t.v2),this}},{key:"toJSON",value:function(){var t=Xl(r,"toJSON",this,3)([]);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}},{key:"fromJSON",value:function(t){return Xl(r,"fromJSON",this,3)([t]),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}])&&Vl(n.prototype,e),t&&Vl(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Zl(t){return(Zl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Jl(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Zl(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Zl(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Zl(t)?t:t+""))(i.key),i)}}function Kl(t,n,e){n=ec(n);var i=t,n=$l()?Reflect.construct(n,e||[],ec(t).constructor):n.apply(t,e);if(!n||"object"!=Zl(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function $l(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return($l=function(){return!!t})()}function tc(t,n,e,i){var r=nc(ec(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function nc(){return(nc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=ec(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function ec(t){return(ec=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ic(t,n){return(ic=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var rc=(()=>{function o(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new B,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new B,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new B,i=this,r=o;if(i instanceof r)return(i=Kl(this,o)).isQuadraticBezierCurve=!0,i.type="QuadraticBezierCurve",i.v0=t,i.v1=n,i.v2=e,i;throw new TypeError("Cannot call a class as a function")}var t,n=o,e=Du;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&ic(n,e),n=o,(e=[{key:"getPoint",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new B,e=this.v0,i=this.v1,r=this.v2;return n.set(hl(t,e.x,i.x,r.x),hl(t,e.y,i.y,r.y)),n}},{key:"copy",value:function(t){return tc(o,"copy",this,3)([t]),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}},{key:"toJSON",value:function(){var t=tc(o,"toJSON",this,3)([]);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}},{key:"fromJSON",value:function(t){return tc(o,"fromJSON",this,3)([t]),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}])&&Jl(n.prototype,e),t&&Jl(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function oc(t){return(oc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ac(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=oc(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=oc(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==oc(t)?t:t+""))(i.key),i)}}function sc(t,n,e){n=fc(n);var i=t,n=uc()?Reflect.construct(n,e||[],fc(t).constructor):n.apply(t,e);if(!n||"object"!=oc(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function uc(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(uc=function(){return!!t})()}function lc(t,n,e,i){var r=cc(fc(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function cc(){return(cc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=fc(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function fc(t){return(fc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function hc(t,n){return(hc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var vc=(()=>{function o(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new U,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new U,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new U,i=this,r=o;if(i instanceof r)return(i=sc(this,o)).isQuadraticBezierCurve3=!0,i.type="QuadraticBezierCurve3",i.v0=t,i.v1=n,i.v2=e,i;throw new TypeError("Cannot call a class as a function")}var t,n=o,e=Du;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&hc(n,e),n=o,(e=[{key:"getPoint",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new U,e=this.v0,i=this.v1,r=this.v2;return n.set(hl(t,e.x,i.x,r.x),hl(t,e.y,i.y,r.y),hl(t,e.z,i.z,r.z)),n}},{key:"copy",value:function(t){return lc(o,"copy",this,3)([t]),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}},{key:"toJSON",value:function(){var t=lc(o,"toJSON",this,3)([]);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}},{key:"fromJSON",value:function(t){return lc(o,"fromJSON",this,3)([t]),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}])&&ac(n.prototype,e),t&&ac(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function dc(t){return(dc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function mc(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=dc(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=dc(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==dc(t)?t:t+""))(i.key),i)}}function pc(t,n,e){n=_c(n);var i=t,n=yc()?Reflect.construct(n,e||[],_c(t).constructor):n.apply(t,e);if(!n||"object"!=dc(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function yc(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(yc=function(){return!!t})()}function gc(t,n,e,i){var r=bc(_c(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function bc(){return(bc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=_c(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function _c(t){return(_c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function wc(t,n){return(wc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Sc=(()=>{function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=this,e=r;if(n instanceof e)return(n=pc(this,r)).isSplineCurve=!0,n.type="SplineCurve",n.points=t,n;throw new TypeError("Cannot call a class as a function")}var t,n=r,e=Du;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&wc(n,e),n=r,(e=[{key:"getPoint",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new B,e=this.points,t=(e.length-1)*t,i=Math.floor(t),t=t-i,r=e[0===i?i:i-1],o=e[i],a=e[i>e.length-2?e.length-1:i+1],e=e[i>e.length-3?e.length-1:i+2];return n.set(fl(t,r.x,o.x,a.x,e.x),fl(t,r.y,o.y,a.y,e.y)),n}},{key:"copy",value:function(t){gc(r,"copy",this,3)([t]),this.points=[];for(var n=0,e=t.points.length;n<e;n++){var i=t.points[n];this.points.push(i.clone())}return this}},{key:"toJSON",value:function(){var t=gc(r,"toJSON",this,3)([]);t.points=[];for(var n=0,e=this.points.length;n<e;n++){var i=this.points[n];t.points.push(i.toArray())}return t}},{key:"fromJSON",value:function(t){gc(r,"fromJSON",this,3)([t]),this.points=[];for(var n=0,e=t.points.length;n<e;n++){var i=t.points[n];this.points.push((new B).fromArray(i))}return this}}])&&mc(n.prototype,e),t&&mc(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function xc(t){return(xc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ac(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=xc(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=xc(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==xc(t)?t:t+""))(i.key),i)}}function Ec(t,n,e){n=Oc(n);var i=t,n=Tc()?Reflect.construct(n,e||[],Oc(t).constructor):n.apply(t,e);if(!n||"object"!=xc(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Tc(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Tc=function(){return!!t})()}function Mc(t,n,e,i){var r=Pc(Oc(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function Pc(){return(Pc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=Oc(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function Oc(t){return(Oc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Nc(t,n){return(Nc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Cc=(()=>{function r(){var t;if(this instanceof r)return(t=Ec(this,r)).type="CurvePath",t.curves=[],t.autoClose=!1,t;throw new TypeError("Cannot call a class as a function")}var t,n=r,e=Du;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Nc(n,e),n=r,(e=[{key:"add",value:function(t){this.curves.push(t)}},{key:"closePath",value:function(){var t,n=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);return n.equals(e)||(t=!0===n.isVector2?"LineCurve":"LineCurve3",this.curves.push(new o[t](e,n))),this}},{key:"getPoint",value:function(t,n){for(var e,i,r,o=t*this.getLength(),a=this.getCurveLengths(),s=0;s<a.length;){if(a[s]>=o)return e=a[s]-o,r=(i=this.curves[s]).getLength(),i.getPointAt(0===r?0:1-e/r,n);s++}return null}},{key:"getLength",value:function(){var t=this.getCurveLengths();return t[t.length-1]}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}},{key:"getCurveLengths",value:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],n=0,e=0,i=this.curves.length;e<i;e++)n+=this.curves[e].getLength(),t.push(n);return this.cacheLengths=t}},{key:"getSpacedPoints",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:40,n=[],e=0;e<=t;e++)n.push(this.getPoint(e/t));return this.autoClose&&n.push(n[0]),n}},{key:"getPoints",value:function(){for(var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:12,e=[],i=0,r=this.curves;i<r.length;i++)for(var o=r[i],a=o.isEllipseCurve?2*n:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?n*o.points.length:n,s=o.getPoints(a),u=0;u<s.length;u++){var l=s[u];t&&t.equals(l)||(e.push(l),t=l)}return this.autoClose&&1<e.length&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}},{key:"copy",value:function(t){Mc(r,"copy",this,3)([t]),this.curves=[];for(var n=0,e=t.curves.length;n<e;n++){var i=t.curves[n];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}},{key:"toJSON",value:function(){var t=Mc(r,"toJSON",this,3)([]);t.autoClose=this.autoClose,t.curves=[];for(var n=0,e=this.curves.length;n<e;n++){var i=this.curves[n];t.curves.push(i.toJSON())}return t}},{key:"fromJSON",value:function(t){Mc(r,"fromJSON",this,3)([t]),this.autoClose=t.autoClose,this.curves=[];for(var n=0,e=t.curves.length;n<e;n++){var i=t.curves[n];this.curves.push((new o[i.type]).fromJSON(i))}return this}}])&&Ac(n.prototype,e),t&&Ac(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Lc(t){return(Lc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Rc(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Lc(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Lc(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Lc(t)?t:t+""))(i.key),i)}}function Dc(t,n,e){n=jc(n);var i=t,n=Fc()?Reflect.construct(n,e||[],jc(t).constructor):n.apply(t,e);if(!n||"object"!=Lc(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Fc(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Fc=function(){return!!t})()}function Ic(t,n,e,i){var r=kc(jc(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function kc(){return(kc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=jc(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function jc(t){return(jc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Uc(t,n){return(Uc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Bc=(()=>{function e(t){var n;if(this instanceof e)return(n=Dc(this,e)).type="Path",n.currentPoint=new B,t&&n.setFromPoints(t),n;throw new TypeError("Cannot call a class as a function")}var t,n=e,i=Cc;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),i&&Uc(n,i),n=e,(i=[{key:"setFromPoints",value:function(t){this.moveTo(t[0].x,t[0].y);for(var n=1,e=t.length;n<e;n++)this.lineTo(t[n].x,t[n].y);return this}},{key:"moveTo",value:function(t,n){return this.currentPoint.set(t,n),this}},{key:"lineTo",value:function(t,n){var e=new Bl(this.currentPoint.clone(),new B(t,n));return this.curves.push(e),this.currentPoint.set(t,n),this}},{key:"quadraticCurveTo",value:function(t,n,e,i){t=new rc(this.currentPoint.clone(),new B(t,n),new B(e,i));return this.curves.push(t),this.currentPoint.set(e,i),this}},{key:"bezierCurveTo",value:function(t,n,e,i,r,o){t=new Sl(this.currentPoint.clone(),new B(t,n),new B(e,i),new B(r,o));return this.curves.push(t),this.currentPoint.set(r,o),this}},{key:"splineThru",value:function(t){var n=[this.currentPoint.clone()].concat(t),n=new Sc(n);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}},{key:"arc",value:function(t,n,e,i,r,o){var a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(t+a,n+s,e,i,r,o),this}},{key:"absarc",value:function(t,n,e,i,r,o){return this.absellipse(t,n,e,e,i,r,o),this}},{key:"ellipse",value:function(t,n,e,i,r,o,a,s){var u=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+u,n+l,e,i,r,o,a,s),this}},{key:"absellipse",value:function(t,n,e,i,r,o,a,s){t=new zu(t,n,e,i,r,o,a,s),0<this.curves.length&&((n=t.getPoint(0)).equals(this.currentPoint)||this.lineTo(n.x,n.y)),this.curves.push(t),e=t.getPoint(1);return this.currentPoint.copy(e),this}},{key:"copy",value:function(t){return Ic(e,"copy",this,3)([t]),this.currentPoint.copy(t.currentPoint),this}},{key:"toJSON",value:function(){var t=Ic(e,"toJSON",this,3)([]);return t.currentPoint=this.currentPoint.toArray(),t}},{key:"fromJSON",value:function(t){return Ic(e,"fromJSON",this,3)([t]),this.currentPoint.fromArray(t.currentPoint),this}}])&&Rc(n.prototype,i),t&&Rc(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Hc(t){return(Hc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Vc(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Hc(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Hc(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Hc(t)?t:t+""))(i.key),i)}}function zc(t,n,e){n=Wc(n);var i=t,n=Gc()?Reflect.construct(n,e||[],Wc(t).constructor):n.apply(t,e);if(!n||"object"!=Hc(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Gc(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Gc=function(){return!!t})()}function Xc(t,n,e,i){var r=Yc(Wc(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function Yc(){return(Yc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=Wc(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function Wc(t){return(Wc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Qc(t,n){return(Qc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var qc=(()=>{function r(t){if(this instanceof r)return(t=zc(this,r,[t])).uuid=j(),t.type="Shape",t.holes=[],t;throw new TypeError("Cannot call a class as a function")}var t,n=r,e=Bc;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Qc(n,e),n=r,(e=[{key:"getPointsHoles",value:function(t){for(var n=[],e=0,i=this.holes.length;e<i;e++)n[e]=this.holes[e].getPoints(t);return n}},{key:"extractPoints",value:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}},{key:"copy",value:function(t){Xc(r,"copy",this,3)([t]),this.holes=[];for(var n=0,e=t.holes.length;n<e;n++){var i=t.holes[n];this.holes.push(i.clone())}return this}},{key:"toJSON",value:function(){var t=Xc(r,"toJSON",this,3)([]);t.uuid=this.uuid,t.holes=[];for(var n=0,e=this.holes.length;n<e;n++){var i=this.holes[n];t.holes.push(i.toJSON())}return t}},{key:"fromJSON",value:function(t){Xc(r,"fromJSON",this,3)([t]),this.uuid=t.uuid,this.holes=[];for(var n=0,e=t.holes.length;n<e;n++){var i=t.holes[n];this.holes.push((new Bc).fromJSON(i))}return this}}])&&Vc(n.prototype,e),t&&Vc(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})(),Zc=function(t,n){var e,i,r,o,a,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2,u=n&&n.length,l=u?n[0]*s:t.length,c=Jc(t,0,l,s,!0),f=[];if(c&&c.next!==c.prev){if(u&&(c=((t,n,e,i)=>{var r,o,a,s,u=[];for(r=0,o=n.length;r<o;r++)s=n[r]*i,a=r<o-1?n[r+1]*i:t.length,(s=Jc(t,s,a,i,!1))===s.next&&(s.steiner=!0),u.push((t=>{for(var n=t,e=t;(n.x<e.x||n.x===e.x&&n.y<e.y)&&(e=n),(n=n.next)!==t;);return e})(s));for(u.sort(tf),r=0;r<u.length;r++)e=((t,n)=>{var e=((t,n)=>{var e,i=n,r=-1/0,o=t.x,a=t.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=o&&r<s&&(r=s,e=i.x<i.next.x?i:i.next,s===o))return e}}while((i=i.next)!==n);if(!e)return null;var u,l=e,c=e.x,f=e.y,h=1/0;for(i=e;o>=i.x&&i.x>=c&&o!==i.x&&ef(a<f?o:r,a,c,f,a<f?r:o,a,i.x,i.y)&&(u=Math.abs(a-i.y)/(o-i.x),uf(i,t))&&(u<h||u===h&&(i.x>e.x||i.x===e.x&&((t,n)=>E(t.prev,t,n.prev)<0&&E(n.next,t,t.next)<0)(e,i)))&&(e=i,h=u),(i=i.next)!==l;);return e})(t,n);return e?(Kc(t=lf(e,t),t.next),Kc(e,e.next)):n})(u[r],e);return e})(t,n,c,s)),t.length>80*s){for(var h=e=t[0],v=i=t[1],d=s;d<l;d+=s)(r=t[d])<h&&(h=r),(o=t[d+1])<v&&(v=o),e<r&&(e=r),i<o&&(i=o);a=0!==(a=Math.max(e-h,i-v))?32767/a:0}$c(c,f,s,h,v,a,0)}return f};function Jc(t,n,e,i,r){var o,a;if(r===0<((t,n,e,i)=>{for(var r=0,o=n,a=e-i;o<e;o+=i)r+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return r})(t,n,e,i))for(o=n;o<e;o+=i)a=cf(o,t[o],t[o+1],a);else for(o=e-i;n<=o;o-=i)a=cf(o,t[o],t[o+1],a);return a&&rf(a,a.next)&&(ff(a),a=a.next),a}function Kc(t,n){if(!t)return t;n=n||t;var e,i=t;do{if(e=!1,i.steiner||!rf(i,i.next)&&0!==E(i.prev,i,i.next))i=i.next;else{if(ff(i),(i=n=i.prev)===i.next)break;e=!0}}while(e||i!==n);return n}function $c(t,n,e,i,r,o,a){if(t){if(!a&&o){for(var s=t,u=i,l=r,c=o,f=s;0===f.z&&(f.z=nf(f.x,f.y,u,l,c)),f.prevZ=f.prev,f.nextZ=f.next,(f=f.next)!==s;);f.prevZ.nextZ=null,f.prevZ=null;var h,v,d,m,p,y,g,b,_=f,w=1;do{for(v=_,p=_=null,y=0;v;){for(y++,d=v,h=g=0;h<w&&(g++,d=d.nextZ);h++);for(b=w;0<g||0<b&&d;)0!==g&&(0===b||!d||v.z<=d.z)?(v=(m=v).nextZ,g--):(d=(m=d).nextZ,b--),p?p.nextZ=m:_=m,m.prevZ=p,p=m;v=d}}while(p.nextZ=null,w*=2,1<y)}for(var S,x,A=t;t.prev!==t.next;)if(S=t.prev,x=t.next,o?((t,n,e,i)=>{var r=t.prev,o=t,a=t.next;if(!(0<=E(r,o,a))){for(var s=r.x,u=o.x,l=a.x,c=r.y,f=o.y,h=a.y,v=s<u?s<l?s:l:u<l?u:l,d=c<f?c<h?c:h:f<h?f:h,m=u<s?l<s?s:l:l<u?u:l,p=f<c?h<c?c:h:h<f?f:h,y=nf(v,d,n,e,i),g=nf(m,p,n,e,i),b=t.prevZ,_=t.nextZ;b&&b.z>=y&&_&&_.z<=g;){if(b.x>=v&&b.x<=m&&b.y>=d&&b.y<=p&&b!==r&&b!==a&&ef(s,c,u,f,l,h,b.x,b.y)&&0<=E(b.prev,b,b.next))return;if(b=b.prevZ,_.x>=v&&_.x<=m&&_.y>=d&&_.y<=p&&_!==r&&_!==a&&ef(s,c,u,f,l,h,_.x,_.y)&&0<=E(_.prev,_,_.next))return;_=_.nextZ}for(;b&&b.z>=y;){if(b.x>=v&&b.x<=m&&b.y>=d&&b.y<=p&&b!==r&&b!==a&&ef(s,c,u,f,l,h,b.x,b.y)&&0<=E(b.prev,b,b.next))return;b=b.prevZ}for(;_&&_.z<=g;){if(_.x>=v&&_.x<=m&&_.y>=d&&_.y<=p&&_!==r&&_!==a&&ef(s,c,u,f,l,h,_.x,_.y)&&0<=E(_.prev,_,_.next))return;_=_.nextZ}return 1}})(t,i,r,o):(t=>{var n=t.prev,e=t,t=t.next;if(!(0<=E(n,e,t))){for(var i=n.x,r=e.x,o=t.x,a=n.y,s=e.y,u=t.y,l=i<r?i<o?i:o:r<o?r:o,c=a<s?a<u?a:u:s<u?s:u,f=r<i?o<i?i:o:o<r?r:o,h=s<a?u<a?a:u:u<s?s:u,v=t.next;v!==n;){if(v.x>=l&&v.x<=f&&v.y>=c&&v.y<=h&&ef(i,a,r,s,o,u,v.x,v.y)&&0<=E(v.prev,v,v.next))return;v=v.next}return 1}})(t))n.push(S.i/e|0),n.push(t.i/e|0),n.push(x.i/e|0),ff(t),t=x.next,A=x.next;else if((t=x)===A){a?1===a?$c(t=((t,n,e)=>{var i=t;do{var r=i.prev,o=i.next.next}while(!rf(r,o)&&of(r,i,i.next,o)&&uf(r,o)&&uf(o,r)&&(n.push(r.i/e|0),n.push(i.i/e|0),n.push(o.i/e|0),ff(i),ff(i.next),i=t=o),(i=i.next)!==t);return Kc(i)})(Kc(t),n,e),n,e,i,r,o,2):2===a&&((t,n,e,i,r,o)=>{var a=t;do{for(var s,u=a.next.next;u!==a.prev;){if(a.i!==u.i&&((t,n)=>t.next.i!==n.i&&t.prev.i!==n.i&&!((t,n)=>{var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==n.i&&e.next.i!==n.i&&of(e,e.next,t,n))return 1}while((e=e.next)!==t)})(t,n)&&(uf(t,n)&&uf(n,t)&&((t,n)=>{for(var e=t,i=!1,r=(t.x+n.x)/2,o=(t.y+n.y)/2;e.y>o!=e.next.y>o&&e.next.y!==e.y&&r<(e.next.x-e.x)*(o-e.y)/(e.next.y-e.y)+e.x&&(i=!i),(e=e.next)!==t;);return i})(t,n)&&(E(t.prev,t,n.prev)||E(t,n.prev,n))||rf(t,n)&&0<E(t.prev,t,t.next)&&0<E(n.prev,n,n.next)))(a,u))return s=lf(a,u),a=Kc(a,a.next),s=Kc(s,s.next),$c(a,n,e,i,r,o,0),$c(s,n,e,i,r,o,0);u=u.next}}while((a=a.next)!==t)})(t,n,e,i,r,o):$c(Kc(t),n,e,i,r,o,1);break}}}function tf(t,n){return t.x-n.x}function nf(t,n,e,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-e)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*r|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function ef(t,n,e,i,r,o,a,s){return(t-a)*(o-s)<=(r-a)*(n-s)&&(e-a)*(n-s)<=(t-a)*(i-s)&&(r-a)*(i-s)<=(e-a)*(o-s)}function E(t,n,e){return(n.y-t.y)*(e.x-n.x)-(n.x-t.x)*(e.y-n.y)}function rf(t,n){return t.x===n.x&&t.y===n.y}function of(t,n,e,i){var r=sf(E(t,n,e)),o=sf(E(t,n,i)),a=sf(E(e,i,t)),s=sf(E(e,i,n));return r!==o&&a!==s||0===r&&af(t,e,n)||0===o&&af(t,i,n)||0===a&&af(e,t,i)||!(0!==s||!af(e,n,i))}function af(t,n,e){return n.x<=Math.max(t.x,e.x)&&n.x>=Math.min(t.x,e.x)&&n.y<=Math.max(t.y,e.y)&&n.y>=Math.min(t.y,e.y)}function sf(t){return 0<t?1:t<0?-1:0}function uf(t,n){return E(t.prev,t,t.next)<0?0<=E(t,n,t.next)&&0<=E(t,t.prev,n):E(t,n,t.prev)<0||E(t,t.next,n)<0}function lf(t,n){var e=new hf(t.i,t.x,t.y),i=new hf(n.i,n.x,n.y),r=t.next,o=n.prev;return(t.next=n).prev=t,(e.next=r).prev=e,i.next=e,(o.next=e.prev=i).prev=o,i}function cf(t,n,e,i){t=new hf(t,n,e);return i?(t.next=i.next,(t.prev=i).next.prev=t,i.next=t):(t.prev=t).next=t,t}function ff(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function hf(t,n,e){this.i=t,this.x=n,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function vf(t){return(vf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function df(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=vf(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=vf(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==vf(t)?t:t+""))(i.key),i)}}var mf=(()=>{function n(){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function")}return t=n,i=[{key:"area",value:function(t){for(var n=t.length,e=0,i=n-1,r=0;r<n;i=r++)e+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*e}},{key:"isClockWise",value:function(t){return n.area(t)<0}},{key:"triangulateShape",value:function(t,n){var e=[],i=[],r=[],o=(pf(t),yf(e,t),t.length);n.forEach(pf);for(var a=0;a<n.length;a++)i.push(o),o+=n[a].length,yf(e,n[a]);for(var s=Zc(e,i),u=0;u<s.length;u+=3)r.push(s.slice(u,u+3));return r}}],(e=null)&&df(t.prototype,e),i&&df(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i})();function pf(t){var n=t.length;2<n&&t[n-1].equals(t[0])&&t.pop()}function yf(t,n){for(var e=0;e<n.length;e++)t.push(n[e].x),t.push(n[e].y)}function gf(t){return(gf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function bf(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=gf(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=gf(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==gf(t)?t:t+""))(i.key),i)}}function _f(t,n,e){n=Af(n);var i=t,n=wf()?Reflect.construct(n,e||[],Af(t).constructor):n.apply(t,e);if(!n||"object"!=gf(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function wf(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(wf=function(){return!!t})()}function Sf(t,n,e,i){var r=xf(Af(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function xf(){return(xf="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=Af(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function Af(t){return(Af=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ef(t,n){return(Ef=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Tf=(()=>{function s(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new qc([new B(0,.5),new B(-.5,-.5),new B(.5,-.5)]),g=1<arguments.length&&void 0!==arguments[1]?arguments[1]:12,e=this,i=s;if(!(e instanceof i))throw new TypeError("Cannot call a class as a function");(t=_f(this,s)).type="ShapeGeometry";var b=[],_=[],w=[],S=[],r=0,x=0;if(!(t.parameters={shapes:n,curveSegments:g})===Array.isArray(n))a(n);else for(var o=0;o<n.length;o++)a(n[o]),t.addGroup(r,x,o),r+=x,x=0;function a(t){var n=_.length/3,t=t.extractPoints(g),e=t.shape,i=t.holes;!1===mf.isClockWise(e)&&(e=e.reverse());for(var r=0,o=i.length;r<o;r++){var a=i[r];!0===mf.isClockWise(a)&&(i[r]=a.reverse())}for(var s=mf.triangulateShape(e,i),u=0,l=i.length;u<l;u++)var c=i[u],e=e.concat(c);for(var f=0,h=e.length;f<h;f++){var v=e[f];_.push(v.x,v.y,0),w.push(0,0,1),S.push(v.x,v.y)}for(var d=0,m=s.length;d<m;d++){var p=s[d],y=p[0]+n;b.push(y,p[1]+n,p[2]+n),x+=3}}return t.setIndex(b),t.setAttribute("position",new k(_,3)),t.setAttribute("normal",new k(w,3)),t.setAttribute("uv",new k(S,2)),t}var t,n=s,e=Ve;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Ef(n,e),n=s,e=[{key:"fromJSON",value:function(t,n){for(var e=[],i=0,r=t.shapes.length;i<r;i++){var o=n[t.shapes[i]];e.push(o)}return new s(e,t.curveSegments)}}],(t=[{key:"copy",value:function(t){return Sf(s,"copy",this,3)([t]),this.parameters=Object.assign({},t.parameters),this}},{key:"toJSON",value:function(){var t=Sf(s,"toJSON",this,3)([]),n=this.parameters.shapes,e=t;if(e.shapes=[],Array.isArray(n))for(var i=0,r=n.length;i<r;i++){var o=n[i];e.shapes.push(o.uuid)}else e.shapes.push(n.uuid);return e}}])&&bf(n.prototype,t),e&&bf(n,e),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Mf(t){return(Mf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pf(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Mf(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Mf(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Mf(t)?t:t+""))(i.key),i)}}var Of=(()=>{function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.I=t,this.nn=[],this.en=null,this.rn=T.MODEL_LAYER|T.EXTERNAL_MODEL_LAYER,this.on=T.EXTERNAL_MODEL_LAYER,this.j=new l,this.j.name="waterScene",this.dt=new l,this.dt.name="sprayScene",this.an=!1}return t=n,(e=[{key:"traverse",value:function(t){for(var n=0;n<this.nn.length;n++)t(this.nn[n])}},{key:"removeForm",value:function(){for(var t=this.en.getLayers(this.rn),n=0;n<t.length;n++)this.j.remove(t[n].scene)}}])&&Pf(t.prototype,e),i&&Pf(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i})(),Nf=(Object.assign(Of.prototype,{G:function(){this.sn(),this.an=!0},sn:function(t){var n;!t&&this.an||(t=this.en.getLayers(T.EXTERNAL_MODEL_LAYER)[0],n=this.en.getLayers(T.MODEL_LAYER)[0],(this.on===T.EXTERNAL_MODEL_LAYER?(t.scene.add(this.j),t):(n.scene.add(this.j),n)).scene.add(this.dt))},un:function(t){var n=(this.en=t).parent.buildingID;this.I.getRenderManager().waterLayers.set(n+"_"+t.level,this),this.G()},ln:function(){for(var t=this.en.parent.buildingID,n=(this.I.getRenderManager().waterLayers.delete(t+"_"+this.en.level),this.en.getLayers(this.rn)),e=0;e<n.length;e++)this.j.remove(n[e].scene);this.en=null},cn:function(t){t.en=this,(t.fn||t.G())&&this.hn(t),this.j.add(t.Tt)},hn:function(t){this.nn.push(t)},vn:function(t){this.dn(t),t.Tt.parent&&t.Tt.parent.remove(t.Tt),t.mn();t=this.nn.indexOf(t);-1<t&&this.nn.splice(t,1),0===this.nn.length&&this.ln()},dn:function(t){t.en=void 0,this.j.remove(t.Tt)}}),Of);function Cf(t){return(Cf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Lf(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Cf(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Cf(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Cf(t)?t:t+""))(i.key),i)}}function Rf(t,n,e){n=Ff(n);var i=t,n=Df()?Reflect.construct(n,e||[],Ff(t).constructor):n.apply(t,e);if(!n||"object"!=Cf(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Df(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Df=function(){return!!t})()}function Ff(t){return(Ff=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function If(t,n){return(If=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var w=(()=>{function l(t,n,e,i,r,o,a,s,u){if(this instanceof l)return(t=Rf(this,l,[t,n,e,i,r,o,a,s,u])).isCanvasTexture=!0,t.needsUpdate=!0,t;throw new TypeError("Cannot call a class as a function")}var t,n,e=l,i=_i;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&If(e,i),e=l,t&&Lf(e.prototype,t),n&&Lf(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e})();function kf(t){return(kf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function jf(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=kf(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=kf(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==kf(t)?t:t+""))(i.key),i)}}function Uf(t,n,e){return n&&jf(t.prototype,n),e&&jf(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var Of=Uf(function t(n){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.pn=n.pn,this.yn=this.pn.speed,void 0===this.yn&&(this.yn=1),this.en=n,this.Tt=null,this.gn=null,this.bn=null,this._n=0,this.wn=null,this.Sn=null,this.xn=5,this.An=this.An.bind(this),this.En=1,this.Tn=[],this.Mn=document.createElement("canvas"),this.Mn.width=4096,this.Mn.height=4096}),Bf=(Object.assign(Of.prototype,{G:function(n){var e=this,t=this.en.I.getBuilding(this.en.I.getMapOptions().buildingID),i=new qc;i.moveTo(this.en.Pn[0].x-t.x,this.en.Pn[0].y-t.y);for(var r=1;r<this.en.Pn.length;r++)i.lineTo(this.en.Pn[r].x-t.x,this.en.Pn[r].y-t.y);for(var o=this.en.I.getBuilding(this.en.I.getMapOptions().buildingID),a=new Tf(i),s=o.bound.min.x,u=o.bound.min.y,l=o.bound.max.x-s,c=o.bound.max.y-u,f=a.faces,h=f.length,v=0;v<h;v++){var d=a.vertices[f[v].a],m=a.vertices[f[v].b],p=a.vertices[f[v].c];a.faceVertexUvs[0][v][0].x=(d.x+t.x-s)/l,a.faceVertexUvs[0][v][0].y=(d.y+t.y-u)/c,a.faceVertexUvs[0][v][1].x=(m.x+t.x-s)/l,a.faceVertexUvs[0][v][1].y=(m.y+t.y-u)/c,a.faceVertexUvs[0][v][2].x=(p.x+t.x-s)/l,a.faceVertexUvs[0][v][2].y=(p.y+t.y-u)/c}this.On(function(t){t=new b({transparent:!0,map:t});t.map.needsUpdate=!0,t.polygonOffset=!0,t.polygonOffsetFactor=1,t.polygonOffsetUnits=4,e.Tt=new _(a,t),e.Tt.isNoPick=!0,e.Tt.rotation.x=-Math.PI/2,e.Tt.position.y=e.en.F,e.en.I.on("update",e.An),n&&n(e.Tt)})},On:function(n){var e=this,t=this.en.I.getBuilding(this.en.I.getMapOptions().buildingID).bound,i=(this.Sn=t,this.gn=document.createElement("canvas"),this.gn.width=t.size.x*this.xn,this.gn.height=t.size.y*this.xn,new Image);i.crossOrigin="Anonymous",i.onload=function(){e.wn=i,e.bn=document.createElement("canvas"),e.bn.width=i.width,e.bn.height=i.height,e.Nn();var t=new w(e.Mn);n&&n(t)},i.src=this.pn.sprayUrl},An:function(){this._n>.3*this.bn.height?this.En=-1:this._n<0&&(this.En=1),this._n=this._n+this.yn*this.En,this.Nn();var t=new w(this.Mn);this.Tt.material.map.dispose(),this.Tt.material.map=t,this.Tt.material.map.needsUpdate=!0},Nn:function(){for(var t=this.bn.getContext("2d"),n=(t.clearRect(0,0,this.bn.width,this.bn.height),t.drawImage(this.wn,0,this._n,this.wn.width,this.wn.height),this.gn.getContext("2d")),e=(n.clearRect(0,0,this.gn.width,this.gn.height),this.pn.pointsInfo),i=0;i<e.length;i++){var r=this.xn*(e[i].x-this.Sn.min.x),o=this.xn*(this.Sn.max.y-e[i].y),a=2*this.xn*Math.sqrt(e[i].width/2*(e[i].width/2)+e[i].height/2*(e[i].height/2)),s=this.Tn[i],u=(s||((s=document.createElement("canvas")).width=a,s.height=a,this.Tn.push(s)),s.getContext("2d"));u.clearRect(0,0,a,a),u.save(),u.translate(s.width/2,s.height/2),u.rotate(-e[i].angle*Math.PI/180),u.drawImage(this.bn,this.xn*(-e[i].width/2),this.xn*(-e[i].height/2),this.xn*e[i].width,this.xn*e[i].height),u.translate(0,0),u.restore(),n.drawImage(s,r-this.xn*e[i].width/2,o-this.xn*e[i].height/2,a,a)}t=this.Mn.getContext("2d");t.clearRect(0,0,this.Mn.width,this.Mn.height),t.drawImage(this.gn,0,0,this.Mn.width,this.Mn.height)},mn:function(){this.Tt.parent.remove(this.Tt),this.Tt.geometry.dispose(),this.Tt.material.dispose(),this.Tt=void 0,this.en.I.off("update",this.An)}}),Of);function Hf(t){return(Hf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Vf(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Hf(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Hf(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Hf(t)?t:t+""))(i.key),i)}}var Of=(()=>{function e(t,n){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.I=t,this.Cn=n.color,this.Ln=n.alpha,this.F="number"==typeof n.height?n.height:0,this.Pn=n.points,this.Nt=n.url,this.pn=n.sprayInfos,this.on=n.intoLayerType,this.en=null,this.Tt=null,this.Rn=null,this.fn=!1,this.Dt=this.Dt.bind(this),this.Dn=1,this.Fn=[],this.tn=new l,this.In=null,this.kn=new Map}return t=e,(n=[{key:"color",get:function(){return this.Cn},set:function(t){this.Cn=t,this.Tt&&(this.Tt.material.uniforms.waterColor.value=new N(t))}},{key:"alpha",get:function(){return this.Ln},set:function(t){isNaN(""+t)&&(t=1),this.Ln=t,this.Tt&&(this.Tt.material.uniforms.alpha.value=t)}},{key:"height",get:function(){return this.F},set:function(t){this.F=t,this.Tt&&(this.Tt.position.y=t)}},{key:"addTo",value:function(t){var n=this.I.getRenderManager(),e=(n.waterLayers||"basic"===this.I.getRenderManager().type&&this.I.setRenderManager(new gs(this.I)),t.parent.buildingID),n=n.waterLayers.get(e+"_"+t.level);n||(n=new Nf(this.I),void 0!==this.on&&(n.on=this.on),n.un(t)),this.At(t),this.In=t,n.cn(this),this.jn(n.dt),this.tn.position.y=t.height,this.I.on("beforeRender",this.Dt)}},{key:"remove",value:function(){this.Rn&&this.Rn.mn(),this.en.vn(this)}}])&&Vf(t.prototype,n),i&&Vf(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,i})(),zf=(Object.assign(Of.prototype,{G:function(){var t=this.I.getBuilding(this.I.getMapOptions().buildingID),n=new qc;n.moveTo(this.Pn[0].x-t.x,this.Pn[0].y-t.y),this.Fn.push({x:this.Pn[0].x,y:this.Pn[0].y});for(var e=1;e<this.Pn.length;e++)n.lineTo(this.Pn[e].x-t.x,this.Pn[e].y-t.y),this.Fn.push({x:this.Pn[e].x,y:this.Pn[e].y});this.Fn.push({x:this.Pn[0].x,y:this.Pn[0].y});var i=new Tf(n);return this.Tt=new Cu(i,{textureWidth:512,textureHeight:512,waterNormals:(new Mi).load(this.Nt,function(t){t.wrapS=t.wrapT=Q}),alpha:this.Ln,waterColor:this.Cn,distortionScale:5.7,parentNode:this}),this.Tt.isNoPick=!0,this.Tt.rotation.x=-Math.PI/2,this.Tt.position.y=this.F,this.Tt.renderOrder=-1,this.Tt.layers.enable(3),this.Un(),this.fn=!0,this.fn},Un:function(){for(var t=this.In.getLayers(T.MODEL_LAYER|T.EXTERNAL_MODEL_LAYER),n=0;n<t.length;n++)for(var e=t[n].type,i=t[n].children,r=0;r<i.length;r++)i[r].getRenderNode()&&this.Bn(e,i[r])},Bn:function(t,n){var e,i=!1;return t===T.MODEL_LAYER?this.Hn(n.bound,n.height)&&(this.kn.set(""+n.FID,n),i=!0):(e={min:{x:(t=n.getBound()).minX,y:t.minY},max:{x:t.maxX,y:t.maxY}},t=t.maxH-this.In.height,this.Hn(e,t)&&(this.kn.set(""+n.FID,n),i=!0)),i},At:function(t){for(var n,e=t.getLayers(T.MODEL_LAYER)[0].scene,i=[],r=null,o=0;o<e.children.length;o++)"DirectionalLight"===e.children[o].type?((n=e.children[o].clone()).visible=!0,this.tn.add(n),i.push(n)):"AmbientLight"===e.children[o].type?((n=e.children[o].clone()).visible=!0,this.tn.add(n)):"Object3D"===e.children[o].type&&(r=e.children[o].clone(),this.tn.add(r));if(null!==r)for(var a=0;a<i.length;a++)i[a].target=r},Hn:function(t,n){var e={x:(t.min.x+t.max.x)/2,y:(t.min.y+t.max.y)/2};if(this.Vn(e,this.Fn,this.Fn.length-1))return!0;for(var i=n,i=(i*=this.Dn)*i,r=1;r<this.Fn.length;r++){var o=this.Fn[r];if(this.zn(o,e)<i)return!0;var a=this.Fn[r-1];if(1==r&&this.zn(a,e)<i)return!0;if(this.Gn(e,a,o)<i)return!0}return!1},Vn:function(t,n,e){for(var i,r,o=!1,a=0;a<e;a++)i=n[a],r=n[(a+1)%e],(i.y<t.y&&r.y>=t.y||r.y<t.y&&i.y>=t.y)&&(i.x<=t.x||r.x<=t.x)&&i.x+(t.y-i.y)/(r.y-i.y)*(r.x-i.x)<t.x&&(o=!o);return o},Gn:function(t,n,e){var i=n.x,n=n.y,r=e.x,e=e.y,o=t.x,t=t.y,a=r-i,s=e-n,u=a*a+s*s,l=o-i,c=t-n,f=l*l+c*c;return this.Xn(u)?this.Xn(f)?0:f:(u=Math.sqrt(u),c=this.Yn(s=(a=a/u)*l+(l=s/u)*c)?this.Wn(s-u)?(c=o-(i+s*a))*c+(u=t-(n+s*l))*u:(i=o-r)*i+(a=t-e)*a:f,this.Xn(c)?0:c)},Wn:function(t){return t<-1e-5},Xn:function(t){return t<1e-5&&-1e-5<t},Yn:function(t){return 1e-5<t},zn:function(t,n){return(t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y)},$t:function(t){var n=this.In.getLayers(T.MODEL_LAYER|T.EXTERNAL_MODEL_LAYER);if(t)for(var e=0;e<n.length;e++)for(var i,r=n[e].type,o=n[e].children,a=0;a<o.length;a++)o[a].getRenderNode()&&((i=this.kn.get(""+o[a].FID))?this.tn.add(i.getRenderNode()):this.Bn(r,o[a])&&this.tn.add(o[a].getRenderNode()));else{for(var s=[],u=0;u<this.tn.children.length;u++)this.tn.children[u].mapNode&&s.push(this.tn.children[u].mapNode);for(var l=0;l<s.length;l++)s[l].parent.scene.add(s[l].getRenderNode())}},jn:function(n){void 0!==this.pn&&void 0!==this.pn.sprayUrl&&void 0!==this.pn.pointsInfo&&0!==this.pn.pointsInfo.length&&(this.Rn=new Bf(this),this.Rn.G(function(t){t.layers.enable(3),n.add(t)}))},Dt:function(){this.I.enableUpdateRender()},mn:function(){this.Tt.geometry.dispose(),this.Tt.geometry=null,this.Tt.material.dispose(),this.Tt.material=null,this.Tt=null,this.fn=!1}}),{shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new N(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec3 luma = vec3( 0.299, 0.587, 0.114 );","\tfloat v = dot( texel.xyz, luma );","\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","\tgl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")});function Gf(t){return(Gf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xf(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Gf(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Gf(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Gf(t)?t:t+""))(i.key),i)}}function Yf(t,n,e){n=Qf(n);var i=t,n=Wf()?Reflect.construct(n,e||[],Qf(t).constructor):n.apply(t,e);if(!n||"object"!=Gf(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Wf(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Wf=function(){return!!t})()}function Qf(t){return(Qf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function qf(t,n){return(qf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Zf=(()=>{function f(t,n,e,i){var r;if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");(r=Yf(this,f)).strength=void 0!==n?n:1,r.radius=e,r.threshold=i,r.resolution=void 0!==t?new B(t.x,t.y):new B(256,256),r.clearColor=new N(0,0,0);var o={minFilter:O,magFilter:O,format:J},a=(r.renderTargetsHorizontal=[],r.renderTargetsVertical=[],r.nMips=5,Math.round(r.resolution.x/2)),s=Math.round(r.resolution.y/2);r.renderTargetBright=new D(a,s,o),r.renderTargetBright.texture.name="UnrealBloomPass.bright",r.renderTargetBright.texture.generateMipmaps=!1;for(var u=0;u<r.nMips;u++){var l=new D(a,s,o),l=(l.texture.name="UnrealBloomPass.h"+u,l.texture.generateMipmaps=!1,r.renderTargetsHorizontal.push(l),new D(a,s,o));l.texture.name="UnrealBloomPass.v"+u,l.texture.generateMipmaps=!1,r.renderTargetsVertical.push(l),a=Math.round(a/2),s=Math.round(s/2)}for(var e=zf,c=(r.highPassUniforms=L.clone(e.uniforms),r.highPassUniforms.luminosityThreshold.value=i,r.highPassUniforms.smoothWidth.value=.01,r.materialHighPassFilter=new R({uniforms:r.highPassUniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,defines:{}}),r.separableBlurMaterials=[],[3,5,7,9,11]),a=Math.round(r.resolution.x/2),s=Math.round(r.resolution.y/2),u=0;u<r.nMips;u++)r.separableBlurMaterials.push(r.getSeperableBlurMaterial(c[u])),r.separableBlurMaterials[u].uniforms.texSize.value=new B(a,s),a=Math.round(a/2),s=Math.round(s/2);r.compositeMaterial=r.getCompositeMaterial(r.nMips),r.compositeMaterial.uniforms.blurTexture1.value=r.renderTargetsVertical[0].texture,r.compositeMaterial.uniforms.blurTexture2.value=r.renderTargetsVertical[1].texture,r.compositeMaterial.uniforms.blurTexture3.value=r.renderTargetsVertical[2].texture,r.compositeMaterial.uniforms.blurTexture4.value=r.renderTargetsVertical[3].texture,r.compositeMaterial.uniforms.blurTexture5.value=r.renderTargetsVertical[4].texture,r.compositeMaterial.uniforms.bloomStrength.value=n,r.compositeMaterial.uniforms.bloomRadius.value=.1,r.compositeMaterial.needsUpdate=!0;r.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],r.bloomTintColors=[new U(1,1,1),new U(1,1,1),new U(1,1,1),new U(1,1,1),new U(1,1,1)],r.compositeMaterial.uniforms.bloomTintColors.value=r.bloomTintColors;t=Ko;return r.copyUniforms=L.clone(t.uniforms),r.copyUniforms.opacity.value=1,r.materialCopy=new R({uniforms:r.copyUniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,blending:2,depthTest:!1,depthWrite:!1,transparent:!0}),r.enabled=!0,r.needsSwap=!1,r.oldClearColor=new N,r.oldClearAlpha=1,r.basic=new b,r.fsQuad=new h.FullScreenQuad(null),r}var t,n,e=f,i=h;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&qf(e,i),e=f,t&&Xf(e.prototype,t),n&&Xf(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e})();function Jf(t){return(Jf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Kf(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Jf(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Jf(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Jf(t)?t:t+""))(i.key),i)}}Object.assign(Zf.prototype,{dispose:function(){for(var t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose()},setSize:function(t,n){var e=Math.round(t/2),i=Math.round(n/2);this.renderTargetBright.setSize(e,i);for(var r=0;r<this.nMips;r++)this.renderTargetsHorizontal[r].setSize(e,i),this.renderTargetsVertical[r].setSize(e,i),this.separableBlurMaterials[r].uniforms.texSize.value=new B(e,i),e=Math.round(e/2),i=Math.round(i/2)},render:function(t,n,e,i,r){this.oldClearColor.copy(t.getClearColor(new N)),this.oldClearAlpha=t.getClearAlpha();for(var o=t.autoClear,a=(t.autoClear=!1,t.setClearColor(this.clearColor,1),r&&t.state.buffers.stencil.setTest(!1),this.highPassUniforms.tDiffuse.value=e.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this.fsQuad.render(t),this.renderTargetBright),s=0;s<this.nMips;s++)this.fsQuad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.enableAlpha.value=1!==this.oldClearAlpha,this.separableBlurMaterials[s].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[s].uniforms.direction.value=Zf.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[s]),t.clear(),this.fsQuad.render(t),this.separableBlurMaterials[s].uniforms.enableAlpha.value=1!==this.oldClearAlpha,this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=Zf.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[s]),t.clear(),this.fsQuad.render(t),a=this.renderTargetsVertical[s];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,r&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?t.setRenderTarget(null):t.setRenderTarget(e),this.fsQuad.render(t),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=o},getSeperableBlurMaterial:function(t){return new R({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{enableAlpha:{value:!1},colorTexture:{value:null},texSize:{value:new B(.5,.5)},direction:{value:new B(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"\n                varying vec2 vUv;\n                uniform sampler2D colorTexture;\n                uniform vec2 texSize;\n                uniform vec2 direction;\n                uniform bool enableAlpha;\n\n                float gaussianPdf( in float x, in float sigma) {\n                    return 0.39894 * exp(-0.5 * x * x / (sigma * sigma)) / sigma;\n                }\n\n                void main() {\n                    vec2 invSize = 1.0 / texSize;\n                    float fSigma = float(SIGMA);\n                    float weightSum = gaussianPdf(0.0, fSigma);\n                    float alphaSum = 0.0;\n                    vec3 diffuseSum = texture2D(colorTexture, vUv).rgb * weightSum;\n\n                    for (int i = 1; i < KERNEL_RADIUS; i++) {\n\n                        float x = float(i);\n                        float w = gaussianPdf(x, fSigma);\n\n                        vec2 uvOffset = direction * invSize * x;\n                        vec4 sample1 = texture2D(colorTexture, vUv + uvOffset);\n                        vec4 sample2 = texture2D(colorTexture, vUv - uvOffset);\n\n                        diffuseSum += (sample1.rgb + sample2.rgb) * w;\n                        alphaSum += (sample1.a + sample2.a) * w;\n                        weightSum += 2.0 * w;\n                    }\n\n                    if(enableAlpha){\n                        gl_FragColor = vec4(diffuseSum / weightSum, alphaSum / weightSum);\n                    } else{\n                        gl_FragColor = vec4(diffuseSum / weightSum, 1.0);\n                    }\n\n                }"})},getCompositeMaterial:function(t){return new R({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;            uniform sampler2D blurTexture1;            uniform sampler2D blurTexture2;            uniform sampler2D blurTexture3;            uniform sampler2D blurTexture4;            uniform sampler2D blurTexture5;            uniform sampler2D dirtTexture;            uniform float bloomStrength;            uniform float bloomRadius;            uniform float bloomFactors[NUM_MIPS];            uniform vec3 bloomTintColors[NUM_MIPS];                        float lerpBloomFactor(const in float factor) {                float mirrorFactor = 1.2 - factor;                return mix(factor, mirrorFactor, bloomRadius);            }                        void main() {                gl_FragColor = bloomStrength * (                    lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +                    lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +                    lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +                    lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +                    lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );            }"})}}),Zf.BlurDirectionX=new B(1,0),Zf.BlurDirectionY=new B(0,1);var $f=(()=>{function e(t,n){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.I=t,this.Qn="number"==typeof(n=n||{}).strength?n.strength:.62,this.qn="number"==typeof n.radius?n.radius:.6,this.Zn="number"==typeof n.threshold?n.threshold:.4,this.rt=n.depthTest,this.ot=n.isAntiAliasing,void 0===this.ot&&(this.ot=!1),void 0===this.rt&&(this.rt=!1),this.rt||(this.ot=!1),this.Ht=null,this.Jn=new l,this.Kn=new Map,this.$n=null,this.En=1,this.te=!1,this.ne=1,this.ee=1,this.ie=1,this.re=1,this.H=null,this.G()}return t=e,(n=[{key:"isAntiAliasing",get:function(){return this.ot},set:function(t){this.ot=t,this.I.enableUpdateRender()}},{key:"getThreshold",value:function(){return this.$n.threshold}},{key:"setThreshold",value:function(t){this.$n.threshold=t,this.Zn=t,this.I.enableUpdateRender()}},{key:"getStrength",value:function(){return this.$n.strength}},{key:"setStrength",value:function(t){this.$n.strength=t,this.Qn=t,this.I.enableUpdateRender()}},{key:"getRadius",value:function(){return this.$n.radius}},{key:"setRadius",value:function(t){this.$n.radius=t,this.qn=t,this.I.enableUpdateRender()}},{key:"enable",value:function(){(this.Ht.bloom=this).I.enableUpdateRender()}},{key:"disable",value:function(){this.Ht.bloom=null,this.I.enableUpdateRender()}},{key:"add",value:function(t){if(Array.isArray(t))for(var n=0;n<t.length;n++)this.oe(t[n],!0);else this.oe(t,!0);this.I.enableUpdateRender()}},{key:"remove",value:function(t){if(Array.isArray(t))for(var n=0;n<t.length;n++)this.oe(t[n],!1);else this.oe(t,!1);this.I.enableUpdateRender()}},{key:"clear",value:function(){for(var i=this,t=this.I.getLevels(),n=0;n<t.length;n++)s(this.I.getFloor(t[n]));for(var e=this.I.getBuildings(),r=0;r<e.length;r++)for(var o=e[r].getFloorInfos(),a=0;a<o.length;a++)s(e[r].getFloor(o[a].level));function s(t){for(var n=t.getLayers(T.MODEL_LAYER|T.EXTERNAL_MODEL_LAYER|T.DYNAMIC_MODEL_MARKER|T.WALL_MARKER|T.TUBE_MARKER|T.LINE3D_MARKER),e=0;e<n.length;e++)i.oe(n[e],!1)}this.I.enableUpdateRender()}},{key:"updateCamera",value:function(t){this.rt&&(this.H.scene=t,this.H.camera=this.I.camera);for(var n=0;n<this.U.passes.length;n++)this.U.passes[n].constructor===f&&this.U.passes[n].setPass(t,this.I.camera)}},{key:"breath",value:function(t){this.te||(this.te=!0,this.ne=t.size,this.ee=t.duration,this.$n.threshold=0,this.ie=(this.ne-1)/(30*this.ee),this.I.on("update",this.ae))}},{key:"stopBreath",value:function(){this.te&&(this.te=!1,this.$n.threshold=this.Zn,this.$n.radius=this.qn,this.$n.strength=this.Qn,this.re=1,this.I.enableUpdateRender(),this.I.off("update",this.ae))}}])&&Kf(t.prototype,n),i&&Kf(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,i})();Object.assign($f.prototype,{G:function(){"basic"===this.I.getRenderManager().type&&this.I.setRenderManager(new gs(this.I)),this.Ht=this.I.getRenderManager(),this.U=new Ra(this.Ht.getRenderer());var t=new f(this.Jn,this.I.camera,null,0,1);this.U.addPass(t),this.H=new Qa(this.Jn,this.I.camera,0,1),this.H.sampleLevel=1,this.H.unbiased=!0,this.$n=new Zf(new B(this.I.getContainer().clientWidth,this.I.getContainer().clientHeight),this.Qn,this.qn,this.Zn),this.rt?(this.U.renderToScreen=!1,this.U.addPass(this.H)):this.U.renderToScreen=!0,this.U.addPass(this.$n),this.V=this.V.bind(this),this.ae=this.ae.bind(this),this.I.on("resize",this.V)},V:function(){var t,n;this.U&&(n=(t=this.I.getContainer()).clientWidth,this.U.setSize(n,t.clientHeight))},oe:function(t,n){if(t.isLayer)for(var e=0;e<t.children.length;e++)this.ht(t.children[e],n);else this.ht(t,n)},ht:function(t,n){n=!!n||void 0;t.isbloom=n},ae:function(){this.ne<1?(this.re<=this.ne&&(this.En=-1),1<=this.re&&(this.En=1)):(this.re>=this.ne&&(this.En=-1),this.re<1&&(this.En=1)),this.re=this.re+this.En*this.ie,this.$n.radius=this.qn*this.re,this.$n.strength=this.Qn*this.re,this.I.enableUpdateRender()},X:function(t,n){var e=this.Ht.renderer.toneMapping;this.Ht.renderer.toneMapping=2,this.rt||this.se(n,!1),this.updateCamera(t),this.U.render(),this.rt||this.se(n,!0),this.Ht.renderer.toneMapping=e},se:function(t,n){n?null!==this.Ht.fogEffect&&(null!==this.Ht.fogEffect.lt&&(this.Ht.renderScene.fog.density=this.Ht.fogEffect.ct),null!==this.Ht.fogEffect.ft)&&(this.Ht.renderScene.background=this.Ht.fogEffect.ft):(null!==this.Ht.renderScene.fog&&(this.Ht.renderScene.fog.density=0),this.Ht.renderScene.background=null);for(var e=0;e<t.length;e++)for(var i=t[e].buildingID,r=t[e].level,o=this.I.getBuilding(i).getFloor(parseInt(r)).getLayers(),a=0;a<o.length;a++)if(o[a].type!==T.DOM_MARKER)for(var s=o[a].children,u=0;u<s.length;u++)!s[u].isbloom&&s[u].getRenderNode()&&(n?o[a].scene.add(s[u].getRenderNode()):o[a].scene.remove(s[u].getRenderNode()));this.Ht.postprocessing.vt(n)}});function th(t){return(th="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nh(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=th(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=th(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==th(t)?t:t+""))(i.key),i)}}function eh(t,n,e){n=oh(n);var i=t,n=ih()?Reflect.construct(n,e||[],oh(t).constructor):n.apply(t,e);if(!n||"object"!=th(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function ih(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ih=function(){return!!t})()}function rh(){return(rh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=oh(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function oh(t){return(oh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ah(t,n){return(ah=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var sh=(()=>{function a(t){var n;if(this instanceof a)return(n=eh(this,a)).isMeshDepthMaterial=!0,n.type="MeshDepthMaterial",n.depthPacking=3200,n.map=null,n.alphaMap=null,n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.wireframe=!1,n.wireframeLinewidth=1,n.setValues(t),n;throw new TypeError("Cannot call a class as a function")}var t,n=a,e=Rt;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&ah(n,e),n=a,(e=[{key:"copy",value:function(t){var n,e,i,r,o;return n=a,e="copy",i=this,o=rh(oh(1&(r=3)?n.prototype:n),e,i),(2&r&&"function"==typeof o?function(t){return o.apply(i,t)}:o)([t]),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}])&&nh(n.prototype,e),t&&nh(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function uh(t){return(uh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function lh(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=uh(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=uh(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==uh(t)?t:t+""))(i.key),i)}}function ch(t,n,e){n=hh(n);var i=t,n=fh()?Reflect.construct(n,e||[],hh(t).constructor):n.apply(t,e);if(!n||"object"!=uh(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function fh(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(fh=function(){return!!t})()}function hh(t){return(hh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function vh(t,n){return(vh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var dh=(()=>{function o(t,n,e,i){var r;if(!(this instanceof o))throw new TypeError("Cannot call a class as a function");(r=ch(this,o)).renderScene=n,r.renderCamera=e,r.selectedObjects=void 0!==i?i:[],r.visibleEdgeColor=new N(1,1,1),r.hiddenEdgeColor=new N(.1,.04,.02),r.edgeGlow=0,r.usePatternTexture=!1,r.edgeThickness=1,r.edgeStrength=3,r.downSampleRatio=2,r.pulsePeriod=0,r.resolution=void 0!==t?new B(t.x,t.y):new B(256,256);n={minFilter:O,magFilter:O,format:J},e=Math.round(r.resolution.x/r.downSampleRatio),i=Math.round(r.resolution.y/r.downSampleRatio),r.maskBufferMaterial=new b({color:16777215}),r.maskBufferMaterial.side=2,r.renderTargetMaskBuffer=new D(r.resolution.x,r.resolution.y,n),r.renderTargetMaskBuffer.texture.name="OutlinePass.mask",r.renderTargetMaskBuffer.texture.generateMipmaps=!1,r.depthMaterial=new sh,r.depthMaterial.side=2,r.depthMaterial.depthPacking=3201,r.depthMaterial.blending=0,r.prepareMaskMaterial=r.getPrepareMaskMaterial(),r.prepareMaskMaterial.side=2,r.prepareMaskMaterial.fragmentShader=((t,n)=>(n=n.isPerspectiveCamera?"perspective":"orthographic",t.replace(/DEPTH_TO_VIEW_Z/g,n+"DepthToViewZ")))(r.prepareMaskMaterial.fragmentShader,r.renderCamera),r.renderTargetDepthBuffer=new D(r.resolution.x,r.resolution.y,n),r.renderTargetDepthBuffer.texture.name="OutlinePass.depth",r.renderTargetDepthBuffer.texture.generateMipmaps=!1,r.renderTargetMaskDownSampleBuffer=new D(e,i,n),r.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",r.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,r.renderTargetBlurBuffer1=new D(e,i,n),r.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",r.renderTargetBlurBuffer1.texture.generateMipmaps=!1,r.renderTargetBlurBuffer2=new D(Math.round(e/2),Math.round(i/2),n),r.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",r.renderTargetBlurBuffer2.texture.generateMipmaps=!1,r.edgeDetectionMaterial=r.getEdgeDetectionMaterial(),r.renderTargetEdgeBuffer1=new D(e,i,n),r.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",r.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,r.renderTargetEdgeBuffer2=new D(Math.round(e/2),Math.round(i/2),n),r.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",r.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,r.separableBlurMaterial1=r.getSeperableBlurMaterial(4),r.separableBlurMaterial1.uniforms.texSize.value.set(e,i),r.separableBlurMaterial1.uniforms.kernelRadius.value=1,r.separableBlurMaterial2=r.getSeperableBlurMaterial(4),r.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(e/2),Math.round(i/2)),r.separableBlurMaterial2.uniforms.kernelRadius.value=4,r.overlayMaterial=r.getOverlayMaterial(),t=Ko;return r.copyUniforms=L.clone(t.uniforms),r.copyUniforms.opacity.value=1,r.materialCopy=new R({uniforms:r.copyUniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,blending:0,depthTest:!1,depthWrite:!1,transparent:!0}),r.enabled=!0,r.needsSwap=!1,r.oldClearColor=new N,r.oldClearAlpha=1,r.fsQuad=new h.FullScreenQuad(null),r.tempPulseColor1=new N,r.tempPulseColor2=new N,r.textureMatrix=new C,r}var t,n,e=o,i=h;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&vh(e,i),e=o,t&&lh(e.prototype,t),n&&lh(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e})();function mh(t){return(mh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ph(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=mh(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=mh(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==mh(t)?t:t+""))(i.key),i)}}function yh(t,n,e){n=bh(n);var i=t,n=gh()?Reflect.construct(n,e||[],bh(t).constructor):n.apply(t,e);if(!n||"object"!=mh(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function gh(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(gh=function(){return!!t})()}function bh(t){return(bh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _h(t,n){return(_h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}Object.assign(dh.prototype,{dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(t,n){this.renderTargetMaskBuffer.setSize(t,n);t=Math.round(t/this.downSampleRatio),n=Math.round(n/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(t,n),this.renderTargetBlurBuffer1.setSize(t,n),this.renderTargetEdgeBuffer1.setSize(t,n),this.separableBlurMaterial1.uniforms.texSize.value.set(t,n),t=Math.round(t/2),n=Math.round(n/2),this.renderTargetBlurBuffer2.setSize(t,n),this.renderTargetEdgeBuffer2.setSize(t,n),this.separableBlurMaterial2.uniforms.texSize.value.set(t,n)},changeVisibilityOfSelectedObjects:function(n){function t(t){t.isMesh&&(n?(t.visible=t.userData.oldVisible,delete t.userData.oldVisible):(t.userData.oldVisible=t.visible,t.visible=n))}for(var e=0;e<this.selectedObjects.length;e++)this.selectedObjects[e].traverse(t)},changeVisibilityOfNonSelectedObjects:function(r){var o=[];function t(t){t.isMesh&&o.push(t)}for(var n=0;n<this.selectedObjects.length;n++)this.selectedObjects[n].traverse(t);this.renderScene.traverse(function(t){if(t.isMesh||t.isLine||t.isSprite){for(var n,e=!1,i=0;i<o.length;i++)if(o[i].id===t.id){e=!0;break}e||(n=t.visible,r&&!t.bVisible||(t.visible=r),t.bVisible=n)}})},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(t,n,e,i,r){var o,a;0<this.selectedObjects.length&&(this.oldClearColor.copy(t.getClearColor(new N)),this.oldClearAlpha=t.getClearAlpha(),o=t.autoClear,t.autoClear=!1,r&&t.state.buffers.stencil.setTest(!1),t.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1),a=this.renderScene.background,this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,t.setRenderTarget(this.renderTargetDepthBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,t.setRenderTarget(this.renderTargetMaskBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.background=a,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,t.setRenderTarget(this.renderTargetMaskDownSampleBuffer),t.clear(),this.fsQuad.render(t),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),0<this.pulsePeriod&&(a=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2,this.tempPulseColor1.multiplyScalar(a),this.tempPulseColor2.multiplyScalar(a)),this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=dh.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,t.setRenderTarget(this.renderTargetBlurBuffer1),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=dh.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=dh.BlurDirectionX,t.setRenderTarget(this.renderTargetBlurBuffer2),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=dh.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer2),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,r&&t.state.buffers.stencil.setTest(!0),t.setRenderTarget(e),this.fsQuad.render(t),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=o),this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=e.texture,t.setRenderTarget(null),this.fsQuad.render(t))},getPrepareMaskMaterial:function(){return new R({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new B(.5,.5)},textureMatrix:{value:null}},vertexShader:["#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\t#include <skinbase_vertex>","\t#include <begin_vertex>","\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\tvPosition = mvPosition;","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new R({uniforms:{maskTexture:{value:null},texSize:{value:new B(.5,.5)},visibleEdgeColor:{value:new U(1,1,1)},hiddenEdgeColor:{value:new U(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(t){return new R({defines:{MAX_RADIUS:t},uniforms:{colorTexture:{value:null},texSize:{value:new B(.5,.5)},direction:{value:new B(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\t\t\t\t}"})},getOverlayMaterial:function(){return new R({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:2,depthTest:!1,depthWrite:!1,transparent:!0})}}),dh.BlurDirectionX=new B(1,0),dh.BlurDirectionY=new B(0,1);var wh=(()=>{function i(t,n){var e;if(this instanceof i)return(e=yh(this,i)).needsSwap=!1,e.clearColor=void 0!==t?t:0,e.clearAlpha=void 0!==n?n:0,e;throw new TypeError("Cannot call a class as a function")}var t,n=i,e=h;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&_h(n,e),n=i,(e=[{key:"render",value:function(t,n,e){var i,r;this.clearColor&&(i=t.getClearColor(new N).getHex(),r=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),t.setRenderTarget(this.renderToScreen?null:e),t.clear(),this.clearColor&&t.setClearColor(i,r)}}])&&ph(n.prototype,e),t&&ph(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Sh(t,n){return(t=>{if(Array.isArray(t))return t})(t)||((t,n)=>{var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var i,r,o,a,s=[],u=!0,l=!1;try{if(o=(e=e.call(t)).next,0===n){if(Object(e)!==e)return;u=!1}else for(;!(u=(i=o.call(e)).done)&&(s.push(i.value),s.length!==n);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=e.return&&(a=e.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}})(t,n)||xh(t,n)||(()=>{throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function xh(t,n){var e;if(t)return"string"==typeof t?Ah(t,n):"Map"===(e="Object"===(e={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Ah(t,n):void 0}function Ah(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=Array(n);e<n;e++)i[e]=t[e];return i}function Eh(t){return(Eh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Th(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Eh(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Eh(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Eh(t)?t:t+""))(i.key),i)}}var Mh=(()=>{function e(t,n){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.I=t,this.ue=3,void 0!==n.edgeStrength&&(this.ue=n.edgeStrength),void(this.le=0)!==n.edgeGlow&&(this.le=n.edgeGlow),this.ce=1,void 0!==n.edgeThickness&&(this.ce=n.edgeThickness),void(this.fe=0)!==n.pulsePeriod&&(this.fe=n.pulsePeriod),this.he="#FFFFFF",void 0!==n.visibleEdgeColor&&(this.he=n.visibleEdgeColor),this.ve="#FFFFFF",this.ve=void 0!==n.hiddenEdgeColor?n.hiddenEdgeColor:this.he,this.Ht=null,this.de=new Map,this.Xt=new l,this.me=new l,this.me.add(this.Xt),this.Kn=new Map,this.pe=null,this.H=null,this.ye=[],this.ge=null,this.U=null,this.G()}return t=e,(n=[{key:"enable",value:function(){(this.Ht.outLine=this).be(),this.I.on("update",this.An),this.I.on("resize",this.V),this.I.on("viewModeChanged",this._e)}},{key:"disable",value:function(){this.Ht.outLine=null,this.I.off("update",this.An),this.I.off("resize",this.V),this.I.off("viewModeChanged",this._e)}},{key:"add",value:function(t){if(this.remove(),Array.isArray(t))for(var n=0;n<t.length;n++){var e=t[n].type;e!==T.MODEL&&e!==T.EXTERNAL_MODEL&&e!==T.DYNAMIC_MODEL_MARKER||this.ye.push(t[n])}else{var i=t.type;i!==T.MODEL&&i!==T.EXTERNAL_MODEL&&i!==T.DYNAMIC_MODEL_MARKER||this.ye.push(t)}}},{key:"remove",value:function(t){var e=this;if(t){if(Array.isArray(t))for(var n=0;n<t.length;n++)t[n].type!==T.MODEL&&t[n].type!==T.EXTERNAL_MODEL&&t[n].type!==T.DYNAMIC_MODEL_MARKER||r(t[n]);else{var i=t.type;i!==T.MODEL&&i!==T.EXTERNAL_MODEL&&i!==T.DYNAMIC_MODEL_MARKER||r(t)}0===this.ye.length&&(this.pe.selectedObjects=[])}else this.ye.length=0,this.pe.selectedObjects=[];function r(t){for(var n=0;n<e.ye.length;n++)if(e.ye[n].FID===t.FID){e.ye.splice(n,1);break}}this.I.enableUpdateRender()}}])&&Th(t.prototype,n),i&&Th(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,i})();Object.assign(Mh.prototype,{G:function(){"basic"===this.I.getRenderManager().type&&this.I.setRenderManager(new gs(this.I)),this.Ht=this.I.getRenderManager(),this.U=new Ra(this.Ht.getRenderer());var t=new f(this.me,this.I.camera,null),t=(this.U.addPass(t),new wh);this.U.addPass(t),this.pe=new dh(new B(this.I.getContainer().clientWidth,this.I.getContainer().clientHeight),this.me,this.I.camera),this.pe.edgeStrength=this.ue,this.pe.edgeGlow=this.le,this.pe.edgeThickness=this.ce,this.pe.pulsePeriod=this.fe,this.pe.visibleEdgeColor=new N(this.he),this.pe.hiddenEdgeColor=new N(this.ve),this.U.addPass(this.pe),this.U.renderToScreen=!1,this.V=this.V.bind(this),this.An=this.An.bind(this),this._e=this._e.bind(this)},V:function(){var t,n;this.U&&(n=(t=this.I.getContainer()).clientWidth,this.U.setSize(n,t.clientHeight))},An:function(){for(var t=[],n=0;n<this.ye.length;n++)this.ye[n].getRenderNode()&&t.push(this.ye[n].getRenderNode());this.pe.selectedObjects=t,0<this.pe.selectedObjects.length&&this.I.enableUpdateRender()},_e:function(){this.pe.renderCamera=this.I.camera},X:function(t){this.Xt.add(t),this.U.render(),this.Xt.remove(t)},Mt:function(){for(var t=0;t<this.U.passes.length;t++)this.U.passes[t].constructor===f&&this.U.passes[t].setPass(this.me,this.I.camera)},be:function(){if(0<this.Ht.waterLayers.size){var t,n=((t,n)=>{var e,i,r,o,a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(a)return r=!(i=!0),{s:function(){a=a.call(t)},n:function(){var t=a.next();return i=t.done,t},e:function(t){r=!0,e=t},f:function(){try{i||null==a.return||a.return()}finally{if(r)throw e}}};if(Array.isArray(t)||(a=xh(t))||n&&t&&"number"==typeof t.length)return a&&(t=a),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})(this.Ht.waterLayers);try{for(n.s();!(t=n.n()).done;){var e=Sh(t.value,2);e[0];e[1].sn(!0)}}catch(t){n.e(t)}finally{n.f()}}}});function Ph(t){return(Ph="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Oh(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Ph(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Ph(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Ph(t)?t:t+""))(i.key),i)}}var Nh=(()=>{function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.I=t,this.jt=new Cs(t),this.we=[],this.Se={x:0,y:0,maxR:0,radius:0,minR:0,widthR:0,length:0,distance:0,width:0,height:0,color_a:0,color_r:0,point:null,endPoint:null,startPoint:null,se2N:null,speed:1,se2RN:null},this.xe=!1,this.Ae=!1,this.Ht=this.jt.kt(),this.Ee=(new Date).getTime(),this.Dt=this.jt.Dt.bind(this),this.Te=!1,this.G()}return t=n,(e=[{key:"enable",value:function(){this.Te=!0,(this.Ht.sweep=this).I.on("beforeRender",this.Dt)}},{key:"disable",value:function(){this.Te=!1;for(var t=Array.from(this.Ht.getRenderList()),n=0;n<t.length;n++){var e=t[n][1];this.render(e,!0)}this.Ht.sweep=null,this.I.off("beforeRender",this.Dt)}},{key:"annulus",value:function(t){this.Me("annulus",t)}},{key:"rect",value:function(t){this.Me("rect",t)}},{key:"render",value:function(t,n){var e,i=this;this.xe&&(this.Se.radius<this.Se.maxR?this.Se.radius+=((new Date).getTime()-this.Ee)*this.Se.maxR/this.Se.duration_a:this.Se.radius=this.Se.minR),this.Ae&&(e=((new Date).getTime()-this.Ee)*this.Se.distance/this.Se.duration_r,e=this.Se.se2N.clone().multiplyScalar(e),this.Se.length<=this.Se.distance?(this.Se.point.add(e),this.Se.length+=e.length()):(this.Se.point=this.Se.startPoint.clone(),this.Se.length=0)),t.traverse(function(t){"Mesh"===t.type&&"FMMeshStandardMaterial"===t.material.type&&(t.material.sweep||(t.material.sweep={sweepW:0,sweepH:0,maxR:0,minR:0,se2N:new B(0,0),se2RN:new B(0,0),moveP:new B(0,0),color_r:new N(16711935),color_a:new N(16776960),isRect:!1,isAnnulus:!1,isEnable:!1,isSweepTexture:!1,sweepTexture:null,sweepStrength:1,circleC:new B(0,0)}),i.xe&&(t.material.sweep.isAnnulus||(t.material.sweep.isAnnulus=!0,t.material.sweep.circleC=new B(i.Se.x-i.I.x,-i.Se.y+i.I.y),t.material.sweep.color_a=i.Se.color_a),t.material.sweep.maxR=i.Se.radius+i.Se.widthR,t.material.sweep.minR=i.Se.radius),i.Ae&&(t.material.sweep.isRect||(t.material.sweep.isRect=!0,t.material.sweep.sweepW=i.Se.width,t.material.sweep.sweepH=i.Se.height,t.material.sweep.se2N=i.Se.se2N,t.material.sweep.se2RN=i.Se.se2RN,t.material.sweep.color_r=i.Se.color_r),t.material.sweep.moveP=i.Se.point),t.material.sweep.isEnable=i.Te,t.material.sweep.isSweepTexture=i.Se.isSweepTexture,t.material.sweep.sweepTexture=i.Se.sweepTexture,t.material.sweep.sweepStrength=i.Se.sweepStrength,t.material.uniformsNeedUpdate=!0,n)&&i.I.enableUpdateRender()}),this.Ee=(new Date).getTime()}}])&&Oh(t.prototype,e),i&&Oh(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i})(),Ch=(Object.assign(Nh.prototype,{G:function(){for(var n=this,t=this.I.getBuilding(this.I.getMapOptions().buildingID).getFloors(),e=0;e<t.length;e++)for(var i=t[e].getLayers(),r=0;r<i.length;r++)i[r].type===T.EXTERNAL_MODEL_LAYER&&i[r].scene.traverse(function(t){t.isGltf&&"Mesh"===t.type&&n.we.push(t)})},Me:function(t,n){var e=this;"annulus"===t?(this.Se.x=n.x,this.Se.y=n.y,this.Se.maxR=n.maxRadius,this.Se.minR=n.minRadius,this.Se.radius=n.minRadius+n.width,this.Se.widthR=n.width,this.Se.duration_a=1e3*n.duration,this.Se.color_a=new N(n.color),this.xe=!0):(this.Se.endPoint=new B(n.endPoint.x-this.I.x,-n.endPoint.y+this.I.y),this.Se.startPoint=new B(n.startPoint.x-this.I.x,-n.startPoint.y+this.I.y),this.Se.point=this.Se.startPoint.clone(),t=new B(n.endPoint.x-n.startPoint.x,-n.endPoint.y+n.startPoint.y),this.Se.se2N=t.normalize(),this.Se.se2RN=t.clone().rotateAround(new B(0,0),Math.PI/2).normalize(),this.Se.duration_r=1e3*n.duration,this.Se.width=n.width,this.Se.height=n.height,this.Se.distance=this.Se.endPoint.distanceTo(this.Se.startPoint),this.Se.color_r=new N(n.color),this.Ae=!0),this.Se.sweepStrength=n.strength,void 0===this.Se.sweepStrength&&(this.Se.sweepStrength=1),this.Se.isSweepTexture=!1,void 0!==n.url&&(new Mi).load(n.url,function(t){e.Se.sweepTexture=t,e.Se.isSweepTexture=!0})}}),{uniforms:{tDiffuse:{value:null},resolution:{value:new B(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")}),Lh={defines:{NUM_SAMPLES:7,NUM_RINGS:4,NORMAL_TEXTURE:0,DIFFUSE_TEXTURE:0,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new B(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new C},cameraInverseProjectionMatrix:{value:new C},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","#if DIFFUSE_TEXTURE == 1","uniform sampler2D tDiffuse;","#endif","uniform sampler2D tDepth;","#if NORMAL_TEXTURE == 1","uniform sampler2D tNormal;","#endif","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float scale;","uniform float intensity;","uniform float bias;","uniform float kernelRadius;","uniform float minResolution;","uniform vec2 size;","uniform float randomSeed;","// RGBA depth","#include <packing>","vec4 getDefaultColor( const in vec2 screenPosition ) {","\t#if DIFFUSE_TEXTURE == 1","\treturn texture2D( tDiffuse, vUv );","\t#else","\treturn vec4( 1.0 );","\t#endif","}","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","\tclipPosition *= clipW; // unprojection.","\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {","\t#if NORMAL_TEXTURE == 1","\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","\t#else","\treturn normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );","\t#endif","}","float scaleDividedByCameraFar;","float minResolutionMultipliedByCameraFar;","float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {","\tvec3 viewDelta = sampleViewPosition - centerViewPosition;","\tfloat viewDistance = length( viewDelta );","\tfloat scaledScreenDistance = scaleDividedByCameraFar * viewDistance;","\treturn max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );","}","// moving costly divides into consts","const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );","const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );","float getAmbientOcclusion( const in vec3 centerViewPosition ) {","\t// precompute some variables require in getOcclusion.","\tscaleDividedByCameraFar = scale / cameraFar;","\tminResolutionMultipliedByCameraFar = minResolution * cameraFar;","\tvec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );","\t// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/","\tfloat angle = rand( vUv + randomSeed ) * PI2;","\tvec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;","\tvec2 radiusStep = radius;","\tfloat occlusionSum = 0.0;","\tfloat weightSum = 0.0;","\tfor( int i = 0; i < NUM_SAMPLES; i ++ ) {","\t\tvec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;","\t\tradius += radiusStep;","\t\tangle += ANGLE_STEP;","\t\tfloat sampleDepth = getDepth( sampleUv );","\t\tif( sampleDepth >= ( 1.0 - EPSILON ) ) {","\t\t\tcontinue;","\t\t}","\t\tfloat sampleViewZ = getViewZ( sampleDepth );","\t\tvec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );","\t\tocclusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );","\t\tweightSum += 1.0;","\t}","\tif( weightSum == 0.0 ) discard;","\treturn occlusionSum * ( intensity / weightSum );","}","void main() {","\tfloat centerDepth = getDepth( vUv );","\tif( centerDepth >= ( 1.0 - EPSILON ) ) {","\t\tdiscard;","\t}","\tfloat centerViewZ = getViewZ( centerDepth );","\tvec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );","\tfloat ambientOcclusion = getAmbientOcclusion( viewPosition );","\tgl_FragColor = getDefaultColor( vUv );","\tgl_FragColor.xyz *=  1.0 - ambientOcclusion;","}"].join("\n")},Rh={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new B(512,512)},sampleUvOffsets:{value:[new B(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:["#include <common>","uniform vec2 size;","varying vec2 vUv;","varying vec2 vInvSize;","void main() {","\tvUv = uv;","\tvInvSize = 1.0 / size;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","#include <packing>","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","uniform float depthCutoff;","uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];","uniform float sampleWeights[ KERNEL_RADIUS + 1 ];","varying vec2 vUv;","varying vec2 vInvSize;","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","void main() {","\tfloat depth = getDepth( vUv );","\tif( depth >= ( 1.0 - EPSILON ) ) {","\t\tdiscard;","\t}","\tfloat centerViewZ = -getViewZ( depth );","\tbool rBreak = false, lBreak = false;","\tfloat weightSum = sampleWeights[0];","\tvec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;","\tfor( int i = 1; i <= KERNEL_RADIUS; i ++ ) {","\t\tfloat sampleWeight = sampleWeights[i];","\t\tvec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;","\t\tvec2 sampleUv = vUv + sampleUvOffset;","\t\tfloat viewZ = -getViewZ( getDepth( sampleUv ) );","\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;","\t\tif( ! rBreak ) {","\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","\t\t\tweightSum += sampleWeight;","\t\t}","\t\tsampleUv = vUv - sampleUvOffset;","\t\tviewZ = -getViewZ( getDepth( sampleUv ) );","\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;","\t\tif( ! lBreak ) {","\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","\t\t\tweightSum += sampleWeight;","\t\t}","\t}","\tgl_FragColor = diffuseSum / weightSum;","}"].join("\n")},Dh={createSampleWeights:function(t,n){for(var e,i,r=[],o=0;o<=t;o++)r.push((e=o,i=n,Math.exp(-e*e/(i*i*2))/(Math.sqrt(2*Math.PI)*i)));return r},createSampleOffsets:function(t,n){for(var e=[],i=0;i<=t;i++)e.push(n.clone().multiplyScalar(i));return e},configure:function(t,n,e,i){t.defines.KERNEL_RADIUS=n,t.uniforms.sampleUvOffsets.value=Dh.createSampleOffsets(n,i),t.uniforms.sampleWeights.value=Dh.createSampleWeights(n,e),t.needsUpdate=!0}},Fh={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","#include <packing>","void main() {","\tfloat depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );","\tgl_FragColor = vec4( vec3( depth ), opacity );","}"].join("\n")};function Ih(t){return(Ih="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function kh(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Ih(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Ih(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Ih(t)?t:t+""))(i.key),i)}}function jh(t,n,e){n=Vh(n);var i=t,n=Uh()?Reflect.construct(n,e||[],Vh(t).constructor):n.apply(t,e);if(!n||"object"!=Ih(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Uh(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Uh=function(){return!!t})()}function Bh(t,n,e,i){var r=Hh(Vh(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function Hh(){return(Hh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=Vh(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function Vh(t){return(Vh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function zh(t,n){return(zh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Gh=(()=>{function h(t,n,e,i,r,o,a,s,u){var l=9<arguments.length&&void 0!==arguments[9]?arguments[9]:1026,c=this,f=h;if(!(c instanceof f))throw new TypeError("Cannot call a class as a function");if(1026!==l&&1027!==l)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return(c=jh(this,h,[null,i,r,o,a,s,l,e=void 0===(e=void 0===e&&1026===l?1014:e)&&1027===l?1020:e,u])).isDepthTexture=!0,c.image={width:t,height:n},c.magFilter=void 0!==a?a:m,c.minFilter=void 0!==s?s:m,c.flipY=!1,c.generateMipmaps=!1,c.compareFunction=null,c}var t,n=h,e=_i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&zh(n,e),n=h,(e=[{key:"copy",value:function(t){return Bh(h,"copy",this,3)([t]),this.compareFunction=t.compareFunction,this}},{key:"toJSON",value:function(t){t=Bh(h,"toJSON",this,3)([t]);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}])&&kh(n.prototype,e),t&&kh(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Xh(t){return(Xh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Yh(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Xh(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Xh(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Xh(t)?t:t+""))(i.key),i)}}function Wh(t,n,e){n=Zh(n);var i=t,n=Qh()?Reflect.construct(n,e||[],Zh(t).constructor):n.apply(t,e);if(!n||"object"!=Xh(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Qh(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Qh=function(){return!!t})()}function qh(){return(qh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=Zh(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function Zh(t){return(Zh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Jh(t,n){return(Jh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Kh=(()=>{function a(t){var n;if(this instanceof a)return(n=Wh(this,a)).isMeshNormalMaterial=!0,n.type="MeshNormalMaterial",n.bumpMap=null,n.bumpScale=1,n.normalMap=null,n.normalMapType=0,n.normalScale=new B(1,1),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.wireframe=!1,n.wireframeLinewidth=1,n.flatShading=!1,n.setValues(t),n;throw new TypeError("Cannot call a class as a function")}var t,n=a,e=Rt;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Jh(n,e),n=a,(e=[{key:"copy",value:function(t){var n,e,i,r,o;return n=a,e="copy",i=this,o=qh(Zh(1&(r=3)?n.prototype:n),e,i),(2&r&&"function"==typeof o?function(t){return o.apply(i,t)}:o)([t]),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}])&&Yh(n.prototype,e),t&&Yh(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function $h(t){return($h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tv(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=$h(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=$h(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==$h(t)?t:t+""))(i.key),i)}}function nv(t,n,e){n=iv(n);var i=t,n=ev()?Reflect.construct(n,e||[],iv(t).constructor):n.apply(t,e);if(!n||"object"!=$h(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function ev(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ev=function(){return!!t})()}function iv(t){return(iv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function rv(t,n){return(rv=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var ov=(()=>{function a(t,n,e,i,r){var o;if(this instanceof a)return(o=nv(this,a)).scene=t,o.camera=n,o.clear=!0,o.needsSwap=!1,o.supportsDepthTextureExtension=void 0!==e&&e,o.supportsNormalTexture=void 0!==i&&i,o.originalClearColor=new N,o.oldClearColor=new N,o.oldClearAlpha=1,o.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},o.resolution=void 0!==r?new B(r.x,r.y):new B(256,256),o.saoRenderTarget=new D(o.resolution.x,o.resolution.y,{minFilter:O,magFilter:O,format:J}),o.blurIntermediateRenderTarget=o.saoRenderTarget.clone(),o.beautyRenderTarget=o.saoRenderTarget.clone(),o.normalRenderTarget=new D(o.resolution.x,o.resolution.y,{minFilter:m,magFilter:m,format:J}),o.depthRenderTarget=o.normalRenderTarget.clone(),o.supportsDepthTextureExtension&&((e=new Gh).type=1012,e.minFilter=m,e.maxFilter=m,o.beautyRenderTarget.depthTexture=e,o.beautyRenderTarget.depthBuffer=!0),o.depthMaterial=new sh,o.depthMaterial.depthPacking=3201,o.depthMaterial.blending=0,o.normalMaterial=new Kh,o.normalMaterial.blending=0,o.saoMaterial=new R({defines:Object.assign({},Lh.defines),fragmentShader:Lh.fragmentShader,vertexShader:Lh.vertexShader,uniforms:L.clone(Lh.uniforms)}),o.saoMaterial.extensions.derivatives=!0,o.saoMaterial.defines.DEPTH_PACKING=o.supportsDepthTextureExtension?0:1,o.saoMaterial.defines.NORMAL_TEXTURE=o.supportsNormalTexture?1:0,o.saoMaterial.defines.PERSPECTIVE_CAMERA=o.camera.isPerspectiveCamera?1:0,o.saoMaterial.uniforms.tDepth.value=o.supportsDepthTextureExtension?e:o.depthRenderTarget.texture,o.saoMaterial.uniforms.tNormal.value=o.normalRenderTarget.texture,o.saoMaterial.uniforms.size.value.set(o.resolution.x,o.resolution.y),o.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(o.camera.projectionMatrix),o.saoMaterial.uniforms.cameraProjectionMatrix.value=o.camera.projectionMatrix,o.saoMaterial.blending=0,o.vBlurMaterial=new R({uniforms:L.clone(Rh.uniforms),defines:Object.assign({},Rh.defines),vertexShader:Rh.vertexShader,fragmentShader:Rh.fragmentShader}),o.vBlurMaterial.defines.DEPTH_PACKING=o.supportsDepthTextureExtension?0:1,o.vBlurMaterial.defines.PERSPECTIVE_CAMERA=o.camera.isPerspectiveCamera?1:0,o.vBlurMaterial.uniforms.tDiffuse.value=o.saoRenderTarget.texture,o.vBlurMaterial.uniforms.tDepth.value=o.supportsDepthTextureExtension?e:o.depthRenderTarget.texture,o.vBlurMaterial.uniforms.size.value.set(o.resolution.x,o.resolution.y),o.vBlurMaterial.blending=0,o.hBlurMaterial=new R({uniforms:L.clone(Rh.uniforms),defines:Object.assign({},Rh.defines),vertexShader:Rh.vertexShader,fragmentShader:Rh.fragmentShader}),o.hBlurMaterial.defines.DEPTH_PACKING=o.supportsDepthTextureExtension?0:1,o.hBlurMaterial.defines.PERSPECTIVE_CAMERA=o.camera.isPerspectiveCamera?1:0,o.hBlurMaterial.uniforms.tDiffuse.value=o.blurIntermediateRenderTarget.texture,o.hBlurMaterial.uniforms.tDepth.value=o.supportsDepthTextureExtension?e:o.depthRenderTarget.texture,o.hBlurMaterial.uniforms.size.value.set(o.resolution.x,o.resolution.y),o.hBlurMaterial.blending=0,o.materialCopy=new R({uniforms:L.clone(Ko.uniforms),vertexShader:Ko.vertexShader,fragmentShader:Ko.fragmentShader,blending:0}),o.materialCopy.transparent=!0,o.materialCopy.depthTest=!1,o.materialCopy.depthWrite=!1,o.materialCopy.blending=5,o.materialCopy.blendSrc=208,o.materialCopy.blendDst=200,o.materialCopy.blendEquation=100,o.materialCopy.blendSrcAlpha=206,o.materialCopy.blendDstAlpha=200,o.materialCopy.blendEquationAlpha=100,o.depthCopy=new R({uniforms:L.clone(Fh.uniforms),vertexShader:Fh.vertexShader,fragmentShader:Fh.fragmentShader,blending:0}),o.fsQuad=new h.FullScreenQuad(null),o;throw new TypeError("Cannot call a class as a function")}var t,n,e=a,i=h;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&rv(e,i),e=a,t&&tv(e.prototype,t),n&&tv(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e})();function av(t){return(av="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function sv(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=av(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=av(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==av(t)?t:t+""))(i.key),i)}}ov.OUTPUT={Beauty:1,Default:0,SAO:2,Depth:3,Normal:4},Object.assign(ov.prototype,{constructor:ov,render:function(t,n,e){var i,r;this.renderToScreen&&(this.materialCopy.blending=0,this.materialCopy.uniforms.tDiffuse.value=e.texture,this.materialCopy.needsUpdate=!0,this.renderPass(t,this.materialCopy,null)),1!==this.params.output&&(this.oldClearColor.copy(t.getClearColor(new N)),this.oldClearAlpha=t.getClearAlpha(),i=t.autoClear,t.autoClear=!1,t.setRenderTarget(this.depthRenderTarget),t.clear(),this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far,r=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near),this.vBlurMaterial.uniforms.depthCutoff.value=r,this.hBlurMaterial.uniforms.depthCutoff.value=r,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),this.prevStdDev===this.params.saoBlurStdDev&&this.prevNumSamples===this.params.saoBlurRadius||(Dh.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new B(0,1)),Dh.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new B(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),t.setClearColor(0),t.setRenderTarget(this.beautyRenderTarget),t.clear(),t.render(this.scene,this.camera),this.supportsDepthTextureExtension||this.renderOverride(t,this.depthMaterial,this.depthRenderTarget,0,1),this.supportsNormalTexture&&this.renderOverride(t,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(t,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(t,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(t,this.hBlurMaterial,this.saoRenderTarget,16777215,1)),r=this.materialCopy,3===this.params.output?this.supportsDepthTextureExtension?(this.materialCopy.uniforms.tDiffuse.value=this.beautyRenderTarget.depthTexture,this.materialCopy.needsUpdate=!0):(this.depthCopy.uniforms.tDiffuse.value=this.depthRenderTarget.texture,this.depthCopy.needsUpdate=!0,r=this.depthCopy):(4===this.params.output?this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture:this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),0===this.params.output?r.blending=5:r.blending=0,this.renderPass(t,r,this.renderToScreen?null:e),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=i)},renderPass:function(t,n,e,i,r){this.originalClearColor.copy(t.getClearColor(new N));var o=t.getClearAlpha(),a=t.autoClear;t.setRenderTarget(e),t.autoClear=!1,null!=i&&(t.setClearColor(i),t.setClearAlpha(r||0),t.clear()),this.fsQuad.material=n,this.fsQuad.render(t),t.autoClear=a,t.setClearColor(this.originalClearColor),t.setClearAlpha(o)},renderOverride:function(t,n,e,i,r){this.originalClearColor.copy(t.getClearColor(new N));var o=t.getClearAlpha(),a=t.autoClear;t.setRenderTarget(e),t.autoClear=!1,i=n.clearColor||i,r=n.clearAlpha||r,null!=i&&(t.setClearColor(i),t.setClearAlpha(r||0),t.clear()),this.scene.overrideMaterial=n,t.render(this.scene,this.camera),this.scene.overrideMaterial=null,t.autoClear=a,t.setClearColor(this.originalClearColor),t.setClearAlpha(o)},setSize:function(t,n){this.beautyRenderTarget.setSize(t,n),this.saoRenderTarget.setSize(t,n),this.blurIntermediateRenderTarget.setSize(t,n),this.normalRenderTarget.setSize(t,n),this.depthRenderTarget.setSize(t,n),this.saoMaterial.uniforms.size.value.set(t,n),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrix),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(t,n),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(t,n),this.hBlurMaterial.needsUpdate=!0}});var uv=(()=>{function e(t,n){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.I=t,this.j=new l,this.Ht=this.kt(),this.G(n)}return t=e,(n=[{key:"getAttribute",value:function(t){for(var n in this.Pe.params)if(n.toLowerCase()===("sao"+t).toLowerCase())return this.Pe.params[n]}},{key:"setAttribute",value:function(t,n){for(var e in this.Pe.params)e.toLowerCase()===("sao"+t).toLowerCase()&&(this.Pe.params[e]=n)}},{key:"add",value:function(t){this.j.add(t)}},{key:"enable",value:function(){this.Ht.sao=this}},{key:"disable",value:function(){this.Ht.sao=null}},{key:"render",value:function(){this.Oe.render()}}])&&sv(t.prototype,n),i&&sv(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,i})();Object.assign(uv.prototype,{kt:function(){return"basic"===this.I.getRenderManager().type&&this.I.setRenderManager(new gs(this.I)),this.I.getRenderManager()},G:function(t){this.Oe=new Ra(this.Ht.getRenderer()),this.Ne=new Jo(Ch),this.Ne.uniforms.resolution.value.set(1/this.I.getContainer().clientWidth,1/this.I.getContainer().clientHeight),this.B=new f(this.j,this.I.camera),this.Pe=new ov(this.j,this.I.camera,!1,!0),this.Pe.params.output=ov.OUTPUT.Default,this.Pe.params.saoBias=t.bias||-.8,this.Pe.params.saoIntensity=t.intensity||12e-5,this.Pe.params.saoScale=t.scale||30,this.Pe.params.saoKernelRadius=t.radius||30,this.Pe.params.saoMinResolution=t.minResolution||0,this.Pe.params.saoBlurRadius=t.blurRadius||4.1,this.Pe.params.saoBlurStdDev=t.blurStdDev||4,this.Pe.params.saoBlurDepthCutoff=t.blurDepthCutoff||.01,this.Oe.addPass(this.B),this.Oe.addPass(this.Pe),this.Oe.addPass(this.Ne)}});function lv(t){return(lv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function cv(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=lv(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=lv(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==lv(t)?t:t+""))(i.key),i)}}function fv(t,n,e){n=mv(n);var i=t,n=hv()?Reflect.construct(n,e||[],mv(t).constructor):n.apply(t,e);if(!n||"object"!=lv(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function hv(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(hv=function(){return!!t})()}function vv(t,n,e,i){var r=dv(mv(1&i?t.prototype:t),n,e);return 2&i&&"function"==typeof r?function(t){return r.apply(e,t)}:r}function dv(){return(dv="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=mv(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function mv(t){return(mv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pv(t,n){return(pv=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var yv=(()=>{function T(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new vc(new U(-1,-1,0),new U(-1,1,0),new U(1,1,0)),s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:64,u=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,t=4<arguments.length&&void 0!==arguments[4]&&arguments[4],n=this,e=T;if(!(n instanceof e))throw new TypeError("Cannot call a class as a function");(n=fv(this,T)).type="TubeGeometry",n.parameters={path:a,tubularSegments:s,radius:u,radialSegments:l,closed:t};for(var c=a.computeFrenetFrames(s,t),f=(n.tangents=c.tangents,n.normals=c.normals,n.binormals=c.binormals,new U),h=new U,i=new B,v=new U,d=[],m=[],r=[],o=[],p=0;p<s;p++)E(p);E(!1===t?s:0);for(var y=0;y<=s;y++)for(var g=0;g<=l;g++)i.x=y/s,i.y=g/l,r.push(i.x,i.y);for(var b=1;b<=s;b++)for(var _=1;_<=l;_++){var w=(l+1)*(b-1)+(_-1),S=(l+1)*b+(_-1),x=(l+1)*b+_,A=(l+1)*(b-1)+_;o.push(w,S,A),o.push(S,x,A)}function E(t){v=a.getPointAt(t/s,v);for(var n=c.normals[t],e=c.binormals[t],i=0;i<=l;i++){var r=i/l*Math.PI*2,o=Math.sin(r),r=-Math.cos(r);h.x=r*n.x+o*e.x,h.y=r*n.y+o*e.y,h.z=r*n.z+o*e.z,h.normalize(),m.push(h.x,h.y,h.z),f.x=v.x+u*h.x,f.y=v.y+u*h.y,f.z=v.z+u*h.z,d.push(f.x,f.y,f.z)}}return n.setIndex(o),n.setAttribute("position",new k(d,3)),n.setAttribute("normal",new k(m,3)),n.setAttribute("uv",new k(r,2)),n}var t,n=T,e=Ve;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&pv(n,e),n=T,e=[{key:"fromJSON",value:function(t){return new T((new o[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}],(t=[{key:"copy",value:function(t){return vv(T,"copy",this,3)([t]),this.parameters=Object.assign({},t.parameters),this}},{key:"toJSON",value:function(){var t=vv(T,"toJSON",this,3)([]);return t.path=this.parameters.path.toJSON(),t}}])&&cv(n.prototype,t),e&&cv(n,e),Object.defineProperty(n,"prototype",{writable:!1}),n})();function gv(t){return(gv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function bv(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=gv(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=gv(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==gv(t)?t:t+""))(i.key),i)}}function _v(t,n,e){n=Sv(n);var i=t,n=wv()?Reflect.construct(n,e||[],Sv(t).constructor):n.apply(t,e);if(!n||"object"!=gv(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function wv(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(wv=function(){return!!t})()}function Sv(t){return(Sv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function xv(t,n){return(xv=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Av=(t=>{function n(){if(this instanceof n)return _v(this,n,[{type:T.FLOW_LINE_LAYER}]);throw new TypeError("Cannot call a class as a function")}var e,i,r=n;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");return r.prototype=Object.create(t&&t.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),t&&xv(r,t),r=n,e&&bv(r.prototype,e),i&&bv(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r})(fengmap.FMMarkerLayer);function Ev(t){return(Ev="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Tv(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Ev(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Ev(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Ev(t)?t:t+""))(i.key),i)}}var Mv=(()=>{function e(t,n){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.I=t,this.Nt=n.url,this.Cn=n.color,void 0===this.Cn&&(this.Cn="#FF0000"),this.Ce=n.backgroundColor,void 0===this.Ce&&(this.Ce="#FF0000"),this.Le=n.points,this.Re=n.lineWidth,void 0===this.Re&&(this.Re=2),this.De=n.lineLength,void 0===this.De&&(this.De=500),this.yn=n.speed,void 0===this.yn&&(this.yn=1),this.Fe=n.opacity,void 0===this.Fe&&(this.Fe=1),this.Ie=n.smoothparam,void 0===this.Ie&&(this.Ie=35),this.j=new l,this.en=null,this.ke=null,this.ft=null,this.je=null,this.Ue=n.count,void 0===this.Ue&&(this.Ue=5),this.Be=null,this.fn=!1,this.V=this.V.bind(this),this.Dt=this.Dt.bind(this),this.He=this.He.bind(this),this.vertexShader="\n            varying vec2 vUv;\n            void main(){\n                    vUv = uv;\n                    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n                    gl_Position = projectionMatrix * mvPosition;\n            }\n        ",this.fragmentShader="\n            uniform float time;\n            uniform float repeat;\n            varying vec2 vUv;\n            uniform sampler2D textureMap;\n            uniform sampler2D background;\n            void main( void ) {\n                vec4 backcolor=texture2D(background,vUv);\n                if(backcolor.a==0.0) discard;\n                vec4 colora = texture2D( textureMap, vec2(fract( vUv.x + time )*repeat, vUv.y));\n                colora.r = colora.r * colora.a * 10.0;\n                colora.g = colora.g * colora.a * 10.0;\n                colora.b = colora.b * colora.a * 10.0;\n                gl_FragColor = vec4(vec3(mix(colora,backcolor,1.0-colora.a)),1.0);\n            }\n        "}return t=e,(n=[{key:"parent",get:function(){return this.en}},{key:"getUrl",value:function(){return this.Nt}},{key:"setUrl",value:function(t){var n=this;this.Nt=t,this.Ve(function(t){t=new w(t);t.wrapS=t.wrapT=Q,t.repeat.set(n.Ue,1),t.needsUpdate=!0,n.je.uniforms.textureMap.value=t})}},{key:"getColor",value:function(){return this.Cn}},{key:"setColor",value:function(t){var n=this;this.Cn=t,this.Nt=void 0,this.Ve(function(t){t=new w(t);t.wrapS=t.wrapT=Q,t.repeat.set(n.Ue,1),t.needsUpdate=!0,n.je.uniforms.textureMap.value=t})}},{key:"getBackgroundColor",value:function(){return this.Ce}},{key:"setBackgroundColor",value:function(t){this.Ce=t,this.je.uniforms.background.value=new w(this.ze())}},{key:"getLineWidth",value:function(){return this.Re}},{key:"setLineWidth",value:function(t){this.Re=t,this.en.scene.remove(this.ke),this.Ge()}},{key:"getSpeed",value:function(){return this.yn}},{key:"setSpeed",value:function(t){this.yn=t,this.ke.userData.speed=t}},{key:"addTo",value:function(t){fengmap.FMMarkerFun.LAYER_CLASS.get(T.FLOW_LINE_LAYER)||fengmap.FMMarkerFun.LAYER_CLASS.set(T.FLOW_LINE_LAYER,Av);var n=t.parent.buildingID;this.Be=n+"_"+t.level,this.fn||this.G(t)}},{key:"remove",value:function(){this.mn()}},{key:"dispose",value:function(){this.remove()}}])&&Tv(t.prototype,n),i&&Tv(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,i})();Object.assign(Mv.prototype,{Dt:function(){this.je&&(this.je.uniforms.time.value-=this.yn/1e3,this.I.enableUpdateNode())},G:function(t){this.Ge(t),this.fn=!0},Ge:function(a){var s=this;this.Ve(function(t){for(var t=new w(t),n=(s.ft=t,s.Xe(s.Le,s.Re/4)),t=(t.wrapS=t.wrapT=Q,t.repeat.set(s.Ue,1),t.needsUpdate=!0,new R({uniforms:{time:{value:0},repeat:{value:s.Ue},textureMap:{value:t},background:{value:new w(s.ze())}},transparent:!0,depthWrite:!0,depthTest:!0,side:W,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader})),e=(s.je=t,new Cc),i=0;i<n.length-1;i++){var r=new ql(n[i],n[i+1]);e.curves.push(r)}var o=new yv(e,s.Ie*(n.length-1),s.Re/2,3);s.ke=new _(o,t),s.ke.isNoPickup=!0,a?(o=a.getOrCreateLayer(T.FLOW_LINE_LAYER),s.en=o,s.en.scene.add(s.ke),s.I.on("update",s.Dt)):s.en.scene.add(s.ke)})},ze:function(){var t=document.createElement("canvas"),n=(t.width=1024,t.height=600,t.getContext("2d")),n=(n.rect(0,200,1024,200),n.fillStyle=new N(this.Ce).getStyle(),n.fill(),document.createElement("canvas"));return n.width=1024,n.height=1024,n.getContext("2d").drawImage(t,0,0,1024,1024),n},Ve:function(t){var n,e,i=this,r=document.createElement("canvas"),o=(r.width=1024,r.height=1024,r.getContext("2d")),a=document.createElement("canvas"),s=(a.width=1024,a.height=600,a.getContext("2d"));void 0!==i.Nt?((n=new Image).crossOrigin="Anonymous",n.onload=function(){s.drawImage(n,0,200,1024,200),o.drawImage(a,0,0,1024,1024),t&&t(r)},n.src=i.Nt):(i=new N(i.Cn),(e=s.createLinearGradient(0,0,1024,0)).addColorStop(0,"rgba("+255*i.r+", "+255*i.g+","+255*i.b+", 0.2)"),e.addColorStop(.8,"rgba("+255*i.r+", "+255*i.g+","+255*i.b+", 0.3)"),e.addColorStop(1,"rgba("+255*i.r+", "+255*i.g+","+255*i.b+", 1)"),s.fillStyle=e,s.fillRect(0,200,1024,200),o.drawImage(a,0,0,1024,1024),t&&t(r))},He:function(){this.j.position.y=this.en.height},V:function(){var t=this.I.getContainer();t.clientWidth},Xe:function(t,n){for(var e=[],i=t.length/3,r=0;r<i;r++){var o=new U(t[3*r]-this.I.x,t[3*r+2]+n,-t[3*r+1]+this.I.y);e.push(o)}return e},mn:function(){this.I.off("update",this.Dt),this.en.scene.remove(this.ke),this.ke.geometry.dispose(),this.ke.material.dispose(),this.ke=null,this.fn=!1}});function Pv(t){return(Pv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ov(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Pv(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Pv(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Pv(t)?t:t+""))(i.key),i)}}function Nv(t,n,e){n=Lv(n);var i=t,n=Cv()?Reflect.construct(n,e||[],Lv(t).constructor):n.apply(t,e);if(!n||"object"!=Pv(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Cv(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Cv=function(){return!!t})()}function Lv(t){return(Lv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Rv(t,n){return(Rv=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Dv=(t=>{function n(){if(this instanceof n)return Nv(this,n,[{type:T.FIRE_MARKER}]);throw new TypeError("Cannot call a class as a function")}var e,i,r=n;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");return r.prototype=Object.create(t&&t.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),t&&Rv(r,t),r=n,e&&Ov(r.prototype,e),i&&Ov(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r})(fengmap.FMMarkerLayer),Fv={FOV:35,CAMERA_NEAR:1,CAMERA_FAR:1e5,ZOOM_UPPER_BOUND:30,TILT_UPPER_BOUND:90,THOUSAND:1e3,DEG2RAD:.0174532,RAD2DEG:57.2957795,DRAW_TIME:500,EPS:.001},Iv=(Object.freeze(Fv),Fv);function kv(t){return(kv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function jv(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=kv(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=kv(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==kv(t)?t:t+""))(i.key),i)}}var Uv=(()=>{function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")}return n=t,i=[{key:"round",value:function(t){return 0<t.toFixed(2)?Math.ceil(t.toFixed(2)):Math.floor(t.toFixed(2))}},{key:"generateUUID",value:function(){for(var t=[],n=0;n<256;n++)t[n]=(n<16?"0":"")+n.toString(16);var e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,o=4294967295*Math.random()|0,e=t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&r|128]+t[r>>8&255]+"-"+t[r>>16&255]+t[r>>24&255]+t[255&o]+t[o>>8&255]+t[o>>16&255]+t[o>>24&255];return t.length=0,e.toUpperCase()}},{key:"findNearNthPowerOfTwo",value:function(t){t-=1;return(t=(t=(t=(t=(t|=t>>1)|t>>2)|t>>4)|t>>8)|t>>16)<0?1:1+t}},{key:"rgbToArray",value:function(t){var n=new N;return n.setStyle(t),[n.r,n.g,n.b]}},{key:"toRgba",value:function(t){var n;return void 0===t?t:"number"!=typeof t?3<=(n=t.split(",")).length?"rgba("+parseInt(n[0])+","+parseInt(n[1])+","+parseInt(n[2])+",1)":t:"rgba("+parseInt(255*new N(t).r)+","+parseInt(255*new N(t).g)+","+parseInt(255*new N(t).b)+",1)"}},{key:"toColor",value:function(t){var n;return"number"==typeof t?t:3<=(n=t.split(",")).length?parseInt(n[0])<<16|parseInt(n[1])<<8|parseInt(n[2]):(console.error("color format error",t),0)}},{key:"cov",value:function(t){for(var n=[],e=[0,0],i=[],r=0;r<t.length;r++)e[0]+=t[r].x,e[1]+=t[r].y;e[0]=e[0]/t.length,e[1]=e[1]/t.length;for(var o=0;o<t.length;o++)i.push([t[o].x-e[0],t[o].y-e[1]]);for(var a=[],s=0;s<i[0].length;s++){for(var u=[],l=0;l<i.length;l++)u.push(i[l][s]);a.push(u)}for(var c=0;c<a.length;c++){for(var f=[],h=0;h<i[0].length;h++){for(var v=0,d=0;d<a[c].length;d++)v+=a[c][d]*i[d][h];v/=t.length-1,f.push(v)}n.push(f)}return n}},{key:"eig",value:function(t){var n=(t[0][0]+t[1][1])/2,e=t[0][0]*t[1][1]-t[1][0]*t[0][1],i=n+Math.sqrt(n*n-e),n=n-Math.sqrt(n*n-e);return 0==t[0][1]&&0==t[1][0]?{eigValue:[i,n],eigVect:[[1,0],[0,1]]}:(e=(i-t[0][0])/t[0][1],t=(n-t[0][0])/t[0][1],{eigValue:[i,n],eigVect:[[1/Math.sqrt(1+e*e),e/Math.sqrt(1+e*e)],[1/Math.sqrt(1+t*t),t/Math.sqrt(1+t*t)]]})}}],(e=null)&&jv(n.prototype,e),i&&jv(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,e,i})();function Bv(t){return(Bv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Hv(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Bv(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Bv(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Bv(t)?t:t+""))(i.key),i)}}var Fv=(()=>{function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.Ye=(t=t||{}).src,this.We=t.dest,this.en=null,this.Qe=[],this.Ee=0,this.qe=0,this.Ze=0,this.Je=Iv.THOUSAND,this.Ke=!1,this.$e=!1,this.ti=!0,this.An=null,this.ni=null,this.ei=Uv.generateUUID()}return t=n,(e=[{key:"play",value:function(){return this.ii()}},{key:"pause",value:function(){return this.$e=!0,this}},{key:"resume",value:function(){return this.$e=!1,this.Ee+=this.Ze,this.Ze=0,this}},{key:"stop",value:function(){return this.ti=!0,this}},{key:"finish",value:function(){return this.ti=!0,this.ni&&this.ni(),this.Qe=[],this}},{key:"setSrc",value:function(t){return this.ri(t)}},{key:"setDest",value:function(t){return this.oi(t)}},{key:"setDuration",value:function(t){return this.ai(t)}},{key:"setUpdate",value:function(t){return this.si(t)}},{key:"setCallback",value:function(t){return this.ui(t)}},{key:"inverse",value:function(){return this.li()}},{key:"setDelay",value:function(t){return this.ci(t)}}])&&Hv(t.prototype,e),i&&Hv(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i})(),Vv=(Object.assign(Fv.prototype,{mn:function(){for(var t in this)this[""+t]=null,delete this[""+t]},ri:function(t){return this.Ye=t,this},oi:function(t){return this.We=t,this},ai:function(t){return this.Je=t*Iv.THOUSAND,this},ci:function(t){return this.qe=t*Iv.THOUSAND,this},si:function(t){return this.An=t,this},ui:function(t){return this.ni=t,this},fi:function(t){return this.Ke=t,this},ii:function(){return this.ti=!1,this.en&&(this.Ee=this.en.hi),this},vi:function(){var t=new this.constructor({src:this.Ye,dest:this.We});return t.Ee=this.Ee,t.qe=this.qe,t.Je=this.Je,t.Ke=this.Ke,t.An=this.An,t.ni=this.ni,t},li:function(){var t=this.We.concat(),n=this.Ye.concat();return this.Ye=t,this.We=n,this}}),Fv);function zv(t){return(zv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Gv(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=zv(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=zv(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==zv(t)?t:t+""))(i.key),i)}}function Xv(t,n,e){return n&&Gv(t.prototype,n),e&&Gv(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var Fv=Xv(function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.nn=new Map,this.di=[],this.hi=(new Date).getTime(),this.mi=new Map,this.pi=null,this.yi=this.yi.bind(this),this.gi=0,this.bi()}),Yv=(Object.assign(Fv.prototype,{cn:function(t){if(Array.isArray(t)){this.nn.set(t[0].ei,t[0]),t[0].en=this;for(var n=1;n<t.length;n++)t[n].Ee=t[n-1].Ee+t[n-1].Je,t[n].qe=t[n-1].qe+t[n-1].Je,this.nn.set(t[n].ei,t[n]),t[n].en=this}else this.nn.has(t.ei)||(this.nn.set(t.ei,t),t.en=this,t.Ee=this.hi)},vn:function(t){if(Array.isArray(t))for(var n=0;n<t.length;n++)this.nn.delete(t[n].ei);else this.nn.delete(t.ei)},_i:function(t){this.di.push(t)},wi:function(t){t=this.di.indexOf(t);-1<t&&this.di.splice(t,1)},Si:function(t){this.mi.set(t.ei=Uv.generateUUID(),t)},xi:function(t){this.mi.delete(t.ei)},An:function(t,n,e){for(var i=[],r=[],o=0;o<t.Ye.length;o++)void 0===t.Qe[o]&&(t.Qe[o]=0),1<=n?(i.push(t.We[o]),r.push(t.We[o]-t.Ye[o]-t.Qe[o])):(i.push((t.We[o]-t.Ye[o])*n+t.Ye[o]),r.push((t.We[o]-t.Ye[o])*e),t.Qe[o]+=(t.We[o]-t.Ye[o])*e);t.An({destination:i,delta:r}),r.length=i.length=0},bi:function(){var e=this,i=(this.gi=Oe.window.requestAnimationFrame(this.bi.bind(this)),(new Date).getTime()),r=i-this.hi;this.mi.forEach(function(t){return t(r)});for(var t=0;t<this.di.length;t++)this.di[t].update(r/1e3);this.nn.forEach(function(t){var n;t.ti||(t.$e?t.Ze+=r:(e.An(t,(i-t.Ee)/t.Je,r/t.Je),n=i-t.Ee-t.qe,t.Je<=n&&(t.Qe=[],t.Ke?(t.Ee=i,t.ni&&t.ni()):(n=t.ti,t.ti=!0,!n&&t.ni&&t.ni()))))}),this.hi=i},mn:function(t){this.pi=t,this.yi()},yi:function(){this.gi&&(Oe.window.cancelAnimationFrame(this.gi),this.gi=0),this.nn.forEach(function(t){t.mn()}),this.nn.clear(),this.di=[],this.mi.clear(),this.pi&&this.pi({name:"Animator"})}}),Fv),Wv={defines:{ITERATIONS:"20",OCTIVES:"3"},uniforms:{fireTex:{type:"t",value:null},color:{type:"c",value:null},time:{type:"f",value:0},seed:{type:"f",value:0},invModelMatrix:{type:"m4",value:null},scale:{type:"v3",value:null},noiseScale:{type:"v4",value:new Dr(1,2,1,.3)},magnitude:{type:"f",value:1.3},lacunarity:{type:"f",value:2},gain:{type:"f",value:.5}},vertexShader:["varying vec3 vWorldPos;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","vWorldPos = (modelMatrix * vec4(position, 1.0)).xyz;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform float time;","uniform float seed;","uniform mat4 invModelMatrix;","uniform vec3 scale;","uniform vec4 noiseScale;","uniform float magnitude;","uniform float lacunarity;","uniform float gain;","uniform sampler2D fireTex;","varying vec3 vWorldPos;","vec3 mod289(vec3 x) {","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec4 mod289(vec4 x) {","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec4 permute(vec4 x) {","return mod289(((x * 34.0) + 1.0) * x);","}","vec4 taylorInvSqrt(vec4 r) {","return 1.79284291400159 - 0.85373472095314 * r;","}","float snoise(vec3 v) {","const vec2 C = vec2(1.0 / 6.0, 1.0 / 3.0);","const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);","vec3 i  = floor(v + dot(v, C.yyy));","vec3 x0 = v - i + dot(i, C.xxx);","vec3 g = step(x0.yzx, x0.xyz);","vec3 l = 1.0 - g;","vec3 i1 = min(g.xyz, l.zxy);","vec3 i2 = max(g.xyz, l.zxy);","vec3 x1 = x0 - i1 + C.xxx;","vec3 x2 = x0 - i2 + C.yyy;","vec3 x3 = x0 - D.yyy;","i = mod289(i); ","vec4 p = permute(permute(permute( ","i.z + vec4(0.0, i1.z, i2.z, 1.0))","+ i.y + vec4(0.0, i1.y, i2.y, 1.0)) ","+ i.x + vec4(0.0, i1.x, i2.x, 1.0));","float n_ = 0.142857142857;","vec3  ns = n_ * D.wyz - D.xzx;","vec4 j = p - 49.0 * floor(p * ns.z * ns.z);","vec4 x_ = floor(j * ns.z);","vec4 y_ = floor(j - 7.0 * x_);","vec4 x = x_ * ns.x + ns.yyyy;","vec4 y = y_ * ns.x + ns.yyyy;","vec4 h = 1.0 - abs(x) - abs(y);","vec4 b0 = vec4(x.xy, y.xy);","vec4 b1 = vec4(x.zw, y.zw);","vec4 s0 = floor(b0) * 2.0 + 1.0;","vec4 s1 = floor(b1) * 2.0 + 1.0;","vec4 sh = -step(h, vec4(0.0));","vec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy;","vec4 a1 = b1.xzyw + s1.xzyw * sh.zzww;","vec3 p0 = vec3(a0.xy, h.x);","vec3 p1 = vec3(a0.zw, h.y);","vec3 p2 = vec3(a1.xy, h.z);","vec3 p3 = vec3(a1.zw, h.w);","vec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));","p0 *= norm.x;","p1 *= norm.y;","p2 *= norm.z;","p3 *= norm.w;","vec4 m = max(0.6 - vec4(dot(x0, x0), dot(x1, x1), dot(x2, x2), dot(x3, x3)), 0.0);","m = m * m;","return 42.0 * dot(m * m, vec4(dot(p0, x0), dot(p1, x1), dot(p2, x2), dot(p3, x3)));","}","float turbulence(vec3 p) {","float sum = 0.0;","float freq = 1.0;","float amp = 1.0;","for(int i = 0; i < OCTIVES; i++) {","sum += abs(snoise(p * freq)) * amp;","freq *= lacunarity;","amp *= gain;","}","return sum;","}","vec4 samplerFire (vec3 p, vec4 scale) {","vec2 st = vec2(sqrt(dot(p.xz, p.xz)), p.y);","if(st.x <= 0.0 || st.x >= 1.0 || st.y <= 0.0 || st.y >= 1.0) return vec4(0.0);","p.y -= (seed + time) * scale.w;","p *= scale.xyz;","st.y += sqrt(st.y) * magnitude * turbulence(p);","if(st.y <= 0.0 || st.y >= 1.0) return vec4(0.0);","return texture2D(fireTex, st);","}","vec3 localize(vec3 p) {","return (invModelMatrix * vec4(p, 1.0)).xyz;","}","void main() {","vec3 rayPos = vWorldPos;","vec3 rayDir = normalize(rayPos - cameraPosition);","float rayLen = 0.0288 * length(scale.xyz);","vec4 col = vec4(0.0);","for(int i = 0; i < ITERATIONS; i++) {","rayPos += rayDir * rayLen;","vec3 lp = localize(rayPos);","lp.y += 0.5;","lp.xz *= 2.0;","col += samplerFire(lp, noiseScale);","}","col.a = col.r;","gl_FragColor = col;","}"].join("\n")};function Qv(t){return(Qv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function qv(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Qv(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Qv(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Qv(t)?t:t+""))(i.key),i)}}function Zv(t,n,e){n=Kv(n);var i=t,n=Jv()?Reflect.construct(n,e||[],Kv(t).constructor):n.apply(t,e);if(!n||"object"!=Qv(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Jv(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Jv=function(){return!!t})()}function Kv(t){return(Kv=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $v(t,n){return($v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var td=(()=>{function i(t,n){var e;if(this instanceof i)return e=new R({defines:Wv.defines,uniforms:L.clone(Wv.uniforms),vertexShader:Wv.vertexShader,fragmentShader:Wv.fragmentShader,transparent:!0,depthWrite:!1,depthTest:!0}),t.magFilter=t.minFilter=O,t.wrapS=t.wrapT=q,e.uniforms.fireTex.value=t,e.uniforms.color.value=new N(n),e.uniforms.invModelMatrix.value=new C,e.uniforms.scale.value=new U(1,1,1),e.uniforms.seed.value=19.19*Math.random(),Zv(this,i,[new Hs(1,1,1),e]);throw new TypeError("Cannot call a class as a function")}var t,n=i,e=_;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&$v(n,e),n=i,(e=[{key:"update",value:function(t){var n=this.material.uniforms.invModelMatrix.value;this.updateMatrixWorld(),n.copy(this.matrixWorld.clone().invert()),void 0!==t&&(this.material.uniforms.time.value=t),this.material.uniforms.invModelMatrix.value=n,this.material.uniforms.scale.value=this.scale}}])&&qv(n.prototype,e),t&&qv(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function nd(t){return(t=>{if(Array.isArray(t))return ed(t)})(t)||(t=>{if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)})(t)||((t,n)=>{var e;if(t)return"string"==typeof t?ed(t,n):"Map"===(e="Object"===(e={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?ed(t,n):void 0})(t)||(()=>{throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function ed(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=Array(n);e<n;e++)i[e]=t[e];return i}var id=["attribute vec3  customColor;","attribute float customOpacity;","attribute float customSize;","attribute float customAngle;","attribute float customVisible;","varying vec4  vColor;","varying float vAngle;","void main()","{","if ( customVisible > 0.5 )","vColor = vec4( customColor, customOpacity );","else","vColor = vec4(0.0, 0.0, 0.0, 0.0);","vAngle = customAngle;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_PointSize = customSize * ( 300.0 / length( mvPosition.xyz ) );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),rd=["uniform sampler2D particleTexture;","varying vec4 vColor;","varying float vAngle;","void main()","{","gl_FragColor = vColor;","float c = cos(vAngle);","float s = sin(vAngle);","vec2 rotatedUV = vec2(c * (gl_PointCoord.x - 0.5) + s * (gl_PointCoord.y - 0.5) + 0.5,","c * (gl_PointCoord.y - 0.5) - s * (gl_PointCoord.x - 0.5) + 0.5);","vec4 rotatedTexture = texture2D( particleTexture,  rotatedUV );","gl_FragColor = gl_FragColor * rotatedTexture;","}"].join("\n");function od(t,n){this.times=t||[],this.values=n||[]}function ad(){this.position=new U,this.velocity=new U,this.acceleration=new U,this.angle=0,this.angleVelocity=0,this.angleAcceleration=0,this.size=16,this.color=new N,this.opacity=1,this.age=0,this.alive=0}od.prototype.lerp=function(t){for(var n,e=0,i=this.times.length;e<i&&t>this.times[e];)e++;return 0==e?this.values[0]:e==i?this.values[i-1]:(n=(t-this.times[e-1])/(this.times[e]-this.times[e-1]),this.values[0]instanceof U?this.values[e-1].clone().lerp(this.values[e],n):this.values[e-1]+n*(this.values[e]-this.values[e-1]))},ad.prototype.update=function(t){this.position.add(this.velocity.clone().multiplyScalar(t)),this.velocity.add(this.acceleration.clone().multiplyScalar(t)),this.angle+=.01745329251*this.angleVelocity*t,this.angleVelocity+=.01745329251*this.angleAcceleration*t,this.age+=t,0<this.sizeTween.times.length&&(this.size=this.sizeTween.lerp(this.age)),0<this.colorTween.times.length&&(t=this.colorTween.lerp(this.age),this.color=(new N).setHSL(t.x,t.y,t.z)),0<this.opacityTween.times.length&&(this.opacity=this.opacityTween.lerp(this.age))};var sd=Object.freeze({CUBE:1,SPHERE:2});function ud(t){this.scene=t,this.positionStyle=sd.CUBE,this.positionBase=new U,this.positionSpread=new U,this.positionRadius=0,this.velocityStyle=sd.CUBE,this.velocityBase=new U,this.velocitySpread=new U,this.speedBase=0,this.speedSpread=0,this.accelerationBase=new U,this.accelerationSpread=new U,this.angleBase=0,this.angleSpread=0,this.angleVelocityBase=0,this.angleVelocitySpread=0,this.angleAccelerationBase=0,this.angleAccelerationSpread=0,this.sizeBase=0,this.sizeSpread=0,this.sizeTween=new od,this.colorBase=new U(0,1,.5),this.colorSpread=new U(0,0,0),this.colorTween=new od,this.opacityBase=1,this.opacitySpread=0,this.opacityTween=new od,this.blendStyle=1,this.particleArray=[],this.particlesPerSecond=100,this.particleDeathAge=1,this.emitterAge=0,this.emitterAlive=!0,this.emitterDeathAge=60,this.particleCount=this.particlesPerSecond*Math.min(this.particleDeathAge,this.emitterDeathAge),this.particleGeometry={vertices:[]},this.particleTexture=null}function ld(t){return(ld="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function cd(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=ld(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=ld(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==ld(t)?t:t+""))(i.key),i)}}ud.prototype.setValues=function(t){if(void 0!==t){for(var n in this.sizeTween=new od,this.colorTween=new od,this.opacityTween=new od,t)this[n]=t[n];ad.prototype.sizeTween=this.sizeTween,ad.prototype.colorTween=this.colorTween,ad.prototype.opacityTween=this.opacityTween,this.particleArray=[],this.emitterAge=0,this.emitterAlive=!0,this.particleCount=this.particlesPerSecond*Math.min(this.particleDeathAge,this.emitterDeathAge),this.particleGeometry={vertices:[]},this.particleMaterial=new R({uniforms:{particleTexture:{value:this.particleTexture}},vertexShader:id,fragmentShader:rd,blending:1,depthTest:!0,depthWrite:!1,side:2,transparent:!0,opacity:1}),this.particleMesh=new Qi}},ud.prototype.randomValue=function(t,n){return t+n*(Math.random()-.5)},ud.prototype.randomVector3=function(t,n){var e=new U(Math.random()-.5,Math.random()-.5,Math.random()-.5);return(new U).addVectors(t,(new U).multiplyVectors(n,e))},ud.prototype.createParticle=function(){var t,n,e=new ad,i=new U,r=(this.positionStyle==sd.CUBE&&(e.position=this.randomVector3(i,this.positionSpread)),this.positionStyle==sd.SPHERE&&(n=2*Math.random()-1,t=6.2832*Math.random(),r=Math.sqrt(1-n*n),r=new U(r*Math.cos(t),r*Math.sin(t),n),e.position=(new U).addVectors(i,r.multiplyScalar(this.positionRadius))),this.velocityStyle==sd.CUBE&&(e.velocity=this.randomVector3(this.velocityBase,this.velocitySpread)),this.velocityStyle==sd.SPHERE&&(t=(new U).subVectors(e.position,i),n=this.randomValue(this.speedBase,this.speedSpread),e.velocity=t.normalize().multiplyScalar(n)),e.acceleration=this.randomVector3(this.accelerationBase,this.accelerationSpread),e.angle=this.randomValue(this.angleBase,this.angleSpread),e.angleVelocity=this.randomValue(this.angleVelocityBase,this.angleVelocitySpread),e.angleAcceleration=this.randomValue(this.angleAccelerationBase,this.angleAccelerationSpread),e.size=this.randomValue(this.sizeBase,this.sizeSpread),this.randomVector3(this.colorBase,this.colorSpread));return e.color=(new N).setHSL(r.x,r.y,r.z),e.opacity=this.randomValue(this.opacityBase,this.opacitySpread),e.age=0,e.alive=0,e},ud.prototype.initialize=function(){for(var t=[],n=[],e=[],i=[],r=[],o=0;o<this.particleCount;o++)this.particleArray[o]=this.createParticle(),this.particleGeometry.vertices.push(this.particleArray[o].position.x,this.particleArray[o].position.y,this.particleArray[o].position.z),t.push(this.particleArray[o].alive),n.push.apply(n,nd(this.particleArray[o].color.toArray())),e.push(this.particleArray[o].opacity),i.push(this.particleArray[o].size),r.push(this.particleArray[o].angle);this.bufferGeometry=new Ve,this.bufferGeometry.setAttribute("position",new H(new Float32Array(this.particleGeometry.vertices),3)),this.bufferGeometry.setAttribute("customVisible",new H(new Float32Array(t),1)),this.bufferGeometry.setAttribute("customColor",new H(new Float32Array(n),3)),this.bufferGeometry.setAttribute("customOpacity",new H(new Float32Array(e),1)),this.bufferGeometry.setAttribute("customSize",new H(new Float32Array(i),1)),this.bufferGeometry.setAttribute("customAngle",new H(new Float32Array(r),1)),this.particleMaterial.blending=this.blendStyle,1!=this.blendStyle&&(this.particleMaterial.depthTest=!0),this.particleMesh=new Qi(this.bufferGeometry,this.particleMaterial),this.particleMesh.dynamic=!0,this.particleMesh.sortParticles=!0,this.particleMesh.position.set(this.positionBase.x,this.positionBase.y,this.positionBase.z),this.scene.add(this.particleMesh),this.isShow=!0},ud.prototype.update=function(t){for(var n=[],e=(this.particleGeometry.vertices=[],[]),i=[],r=[],o=[],a=[],s=0;s<this.particleCount;s++)this.particleArray[s].alive&&(this.particleArray[s].update(t),this.particleGeometry.vertices.push(this.particleArray[s].position.x,this.particleArray[s].position.y,this.particleArray[s].position.z),this.particleArray[s].age>this.particleDeathAge&&(this.particleArray[s].alive=0,n.push(s)),e.push(this.particleArray[s].alive),i.push.apply(i,nd(this.particleArray[s].color.toArray())),r.push(this.particleArray[s].opacity),o.push(this.particleArray[s].size),a.push(this.particleArray[s].angle));if(this.bufferGeometry.getAttribute("position").copyArray(this.particleGeometry.vertices),this.bufferGeometry.getAttribute("customVisible").copyArray(e),this.bufferGeometry.getAttribute("customColor").copyArray(i),this.bufferGeometry.getAttribute("customOpacity").copyArray(r),this.bufferGeometry.getAttribute("customSize").copyArray(o),this.bufferGeometry.getAttribute("customAngle").copyArray(a),this.bufferGeometry.getAttribute("position").needsUpdate=!0,this.bufferGeometry.getAttribute("customVisible").needsUpdate=!0,this.bufferGeometry.getAttribute("customColor").needsUpdate=!0,this.bufferGeometry.getAttribute("customOpacity").needsUpdate=!0,this.bufferGeometry.getAttribute("customSize").needsUpdate=!0,this.bufferGeometry.getAttribute("customAngle").needsUpdate=!0,this.emitterAlive){if(this.emitterAge<this.particleDeathAge){var u=Math.round(this.particlesPerSecond*(this.emitterAge+0)),l=Math.round(this.particlesPerSecond*(this.emitterAge+t));l>this.particleCount&&(l=this.particleCount);for(s=u;s<l;s++)this.particleArray[s].alive=1}for(var c=0;c<n.length;c++){s=n[c];this.particleArray[s]=this.createParticle(),this.particleArray[s].alive=1,this.particleGeometry.vertices[s]=this.particleArray[s].position}this.emitterAge+=t,this.emitterAge>this.emitterDeathAge&&(this.emitterAlive=!1)}},ud.prototype.destroy=function(){this.scene.remove(this.particleMesh),this.isShow=!1},ud.prototype.show=function(){this.scene.add(this.particleMesh),this.isShow=!0},ud.prototype.hide=function(){this.scene.remove(this.particleMesh),this.isShow=!1};var fd=(()=>{function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.Ai=t,this.Ei=this.Ai.smokeDensity,void 0===this.Ei&&(this.Ei=30),this.Ti=new Ea,this.Mi=new U(this.Ai.x,this.Ai.y,this.Ai.z),this.Pi=null,this.Oi=null,this.j=null,this.Ni=null,this.Ci="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH5wEMBTcTolE0kwAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAJKUlEQVRYw41XTW4bRxOtqu6eGXIoSlTiID824I29kK6QhS+Qba5D3UcXyMIL5QBeBRYQBDCMGLAQK/ohRc50d/19C1FG4jjB94DBNAYYvNfVVa+6EP4d6O5wcnKCAEA//PADdl2Hv//+O04mE2zbFgEAHj9+DKrqzOzPnj3zV69e+d3dnb948cIAwAEAENH/leRzH90dT05O8MWLF3R5eUkAEJ4/f07v378Pk8mESim0WCw+/tv3vTOzlVKs6zodhsHm87leXl7ag5B/E/GpAFwul3h8fIw3Nzf0/PnzAADxr4+qBncPs9mMEBHbtnVVtRCCppQ0xijjOEpKSfq+l6urK33z5o29fv3aT05O/iEkfkoOAAQA9M0330QRSW3bNrXWJqXUiEgTQkgxxuDuoWkaVFUXETUzZWZumqYCQK211pxzBQA+OjqSR48eGQCYu//tSOKn5IeHh+HDhw/pq6++alJKbdM0HQBMAKCLMXbu3tZaU9M0wczQ3b2UoiEERsQiIpmIMgCMMcZcay1d19XvvvuOz87O4Ozs7G8i8OHMT09P6eLiIoYQ0t7eXnt4eNi1bTtNKfUhhJ6IenfvRaRT1ZaIQtM0FGM0EVFELDHGHELYuvu2lLLdrYcQQu77vjRNw8+ePRMAsAcBEQDwxx9/pKOjozCbzeLBwUEzmUy6GOMMAPaIaF5rnccY5wAwI6JpjLETkWhmhIjWtq2klLKZDQCwMbN1jLEdxzGmlGgymQAA+DAMfnp66rtNGyJ6XC6XeHFxQfP5PBweHqa2bbsYY9913V6McaGqCwBYiMiBu+8R0Ww6nbZN0yR3pxCCpZQ4hFBEZKOqdyIyyTk3pZTAzDCOo08mE2dme/z4sf3yyy9+cnLiAODx/Pwcv//+e+r7Ps7n86Zt287MZu6+DwCLlNKXZvYlMy/MbH86nfYi0qWUEgCQuxszMwBkANgCwMrMWmYO7g4iYoho4ziKmclqtdInT57YYrEwAMB4dHSEXdeF+XyeiKh192nbtjNVPXD3L0IIX7r7I1U9VNV9EelDCB0AREQkZjYiEjPLRLRl5lZEoruDu7uIKBHxMAy11sohBPnjjz8UAGy5XHoEAAr3iETUhhAmiDiLMc5DCAtm/kJEvjCzQwCY7wS0RBTdnXYJJQBQ3L0VkTiOI4qI1VqFmTMzj2Y25pwzM5emacJ8Ppf3799DfPr0KQFACCFEd29qrZMYY+/ue4g4Tyntxxj3iWi/1rpHRNMQQrsTjH4PUdXGzIKq4s4T6niPjYhs3H3j7ltVjXd3dyGEQMfHxxj7vkcAIBFJZta0bdsy80RV+1rrLMa4F0LYc/eZu/dmNnH3VEqJTdMgALiIiKoGEUEz81IK53tscs49AEyYuXX3RkQSEdHbt28JADB2XYcAQLXWgIjR3RsAaImoM7MJM3fM3JlZa2atqjabzSaFEAjv4eM4krsjABgz8zAMXSmlE5EJInYi0jJzU0qJIYSQc6bZbIa//fYbxtvbW+z7nlJKVGsN4zhGVU0hhISISUQaZk6ImBAxAkBIKYXpdEoAgLtOiMxsZhaZObl7AoAGAFKtNQ3DkMwsqmpgZtpsNnR5eYkAAHG9XmPf98DMGEIgIqJaK9VaSVUJEcndP75TShRjRFXFWiuaGZRSsJRCqkq70iQzIzMjEaFSCjEzmRmpKm63W6i1YowR4nw+dwAAM3NEdEQ0MzN3dzPzh7W7u6o6Ebmq+mazgRCCuzuM4+hm5gDgu+bkqmru7iEETylZztmGYfBhGDylBHd3d75YLCAeHBx4ztmJyJhZ3V2JSHalxSIiiChmJgAgzBxLKSgiAAC4E6kAoO4uZialFAEAiTFy0zRSaxVE1JyzmpmVUrxt2/tekHP2cRyt73s1M2FmRsRqZtnMMgBkIspEVEQk1VqDmcFut+juTkRKRFxrrSJSHv4DgOzuuZRSa62ccxZV1RCC3d7e+rt37zxut1sHAB3HUUMI1cyKiIwiMqjq1sy2ZjZt27aJMZKqgt4jqiruupqYWc05DyKyRcRtjHELAFsRGURkLKUURKzjOKqZ6Z9//ulPnjzx2Pe9XVxc2HQ65RBCdfdRVQdm3tRa10Q0JaJGVcMuV0xVW2aOiIi73BAAKGa2VdU1AKzcfWVm61rrZr1eD8w8MnMVEWZmOzg4sNPTU4g3Nzdea30494qIIwBsRGTFzB0iNuG+PMDMNOdcc86d+72N75qREFFGxC0irojoWlWv3f3WzFallE3OeSyl1BCC5Jz1+vraAMDjYrGwpml0vV5zCKHslG5KKY27p53fwy7JSq11lnPuaq3p4T4gIgwAOaW0MbM1AFwDwJ8ppWtmXonIhpnHnHMxM6616mw2u2/Hr1+/9m+//Vavr69lPp9XZh5rrVFVw44AhmEwM6vuPuwsuttZNzGzMTMTUQ4hbAFgTUS3KaVrRLxW1dXOkkcRqU3TyGaz0VevXhkAQDg7O4M3b97Ar7/+ikQEIgLu95cWRHQRMXeXnb9XZs6llNHdN6p6V0pZ1VpXqnpTa72utV6p6jUi3gDALTOvh2HYllLGYRhKCEG+/vprPT8/v48AIvpyufTDw0MFAByGocQY0cyg6zoDAEkplV0236nqhIgaZk4AgETkMUZW1Wpm465qNma2EZFNjHEAgJGICgDIOI76008/+ceh5TNX8jgMQ1LVdm9vrwOAbrvdTt19sl6vO2buVDU9+DoRmYioiLCq5lJKDiGMKaUhxpiZORNRWa1WDADy888/P0xMfxPwcRoCAHr79m18+vRp7LourdfrxszacRzbYRgaZk4iklSVttstIqLbPXgcR1bVqqpFREpKqYYQGADkc+T/mIz+KuIhGruGFVU13d7exs1mEwEgMDON44jM7KpqqqrDMIiqyi7TZX9/X8ZxlEePHtnnyD+djD4OC8vl0o6Pj/3ly5fetq0eHh7Ku3fveLVahaZpaBxHurq6IgCA7XYLKSUbx9G22611Xafr9Vr7vlcAsPPz878S+/81nP41GsfHx/jy5Uu6ubnBDx8+0N7eHpVSsNaKl5eXAABwdXXlROQXFxcGAA+E/0n82Qh8Jhq+E+nL5RIAAD98+ICbzQYBAM7Pz/+m+ROy/yR+wP8AibG5JpmwKwsAAAAASUVORK5CYII="}return t=n,(e=[{key:"init",value:function(t){var n=this;this.j=t,(new Mi).load(this.Ci,function(t){n.Oi=t,n.createSmoke()})}},{key:"createSmoke",value:function(){this.Pi&&this.Pi.destroy(),this.Ni=(new Date).getTime(),this.Pi=new ud(this.j);var t=this.Ei;1===t&&(t=2),this.Pi.setValues({positionStyle:sd.SPHERE,positionBase:this.Mi,positionRadius:3,velocityStyle:sd.CUBE,velocityBase:new U(0,20,0),velocitySpread:new U(8,15,8),accelerationBase:new U(0,-10,0),particleTexture:this.Oi,angleBase:0,angleSpread:720,angleVelocityBase:0,angleVelocitySpread:720,sizeTween:new od([0,.8,1.5],[10,80,50]),opacityTween:new od([0,.4,1.5],[0,.9,0]),colorTween:new od([.3,1.2],[new U(0,0,.6),new U(0,0,.3)]),worldEffectTween:new od([.5,1.5],[new U(0,0,0),new U(-1,0,-.2)]),particlesPerSecond:t,particleDeathAge:t,emitterDeathAge:60}),this.Pi.initialize(),this.Pi.particleMesh.renderOrder=1,this.Pi.particleMesh.isNoPickup=!0}},{key:"update",value:function(){var t=this.Ti.getDelta();((new Date).getTime()-this.Ni)/1e3<60?this.Pi&&this.Pi.update(.5*t):this.j&&this.Mi&&this.createSmoke()}}])&&cd(t.prototype,e),i&&cd(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i})();function hd(t){return(hd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vd(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=hd(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=hd(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==hd(t)?t:t+""))(i.key),i)}}var Fv=(()=>{function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.Li={x:Number.MAX_VALUE,y:Number.MAX_VALUE},this.Ri={x:-Number.MAX_VALUE,y:-Number.MAX_VALUE}}return n=t,(e=[{key:"min",get:function(){return this.Li}},{key:"max",get:function(){return this.Ri}},{key:"center",get:function(){var t={x:Number.NaN,y:Number.NaN};return this.valid()&&(t.x=(this.min.x+this.max.x)/2,t.y=(this.min.y+this.max.y)/2),t}},{key:"size",get:function(){var t={x:Number.NaN,y:Number.NaN};return this.valid()&&(t.x=this.max.x-this.min.x,t.y=this.max.y-this.min.y),t}},{key:"copy",value:function(t){return this.Ri.x=t.max.x,this.Ri.y=t.max.y,this.Li.x=t.min.x,this.Li.y=t.min.y,this}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"reset",value:function(){this.Li={x:Number.MAX_VALUE,y:Number.MAX_VALUE},this.Ri={x:-Number.MAX_VALUE,y:-Number.MAX_VALUE}}},{key:"toObject",value:function(){return{min:this.min,max:this.max,center:this.center,size:this.size}}},{key:"expand",value:function(t){this.Di(t)}},{key:"expandByCoords",value:function(t){this.Fi(t)}},{key:"valid",value:function(){return this.Ii()}},{key:"isCross",value:function(t){var n=!0;return t.max.x<this.min.x&&(n=!1),t.min.x>this.max.x&&(n=!1),t.max.y<this.min.y&&(n=!1),n=t.min.y>this.max.y?!1:n}}])&&vd(n.prototype,e),i&&vd(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,e,i})(),dd=(Object.assign(Fv.prototype,{Ii:function(){return!(this.min.x>this.max.x||this.min.y>this.max.y)},Di:function(t){t&&t.valid()&&(t.min.x<this.min.x&&(this.min.x=t.min.x),t.min.y<this.min.y&&(this.min.y=t.min.y),t.max.x>this.max.x&&(this.max.x=t.max.x),t.max.y>this.max.y)&&(this.max.y=t.max.y)},Fi:function(t){var n=this;t&&0!=t.length&&t.forEach(function(t){t.x<n.min.x&&(n.min.x=t.x),t.y<n.min.y&&(n.min.y=t.y),t.x>n.max.x&&(n.max.x=t.x),t.y>n.max.y&&(n.max.y=t.y)})}}),Fv);function md(t){return(md="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pd(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=md(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=md(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==md(t)?t:t+""))(i.key),i)}}Fv=(()=>{function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.Ai=t,this.en=null,this.I=null,this.T=this.Ai.x,this.M=this.Ai.y,this.F=this.Ai.height,void 0===this.F&&(this.F=0),this.ki=null,this.ji=null,this.Ui=null,this.Bi=null,this.Hi=new Yv,this.Vi=new Ea,this.zi=4,this.Gi=9.5,this.Xi=!0,this.Yi=null,void 0!==this.Ai.flameSize&&(this.Gi=this.Ai.flameSize),this.Wi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAgCAYAAAAbifjMAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH5wEMBgInI5K8yQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAClUlEQVRIx5WVXW7bQAyEv11xJcuyY7QP7RXy0Jv3QjlEgaZJHHn/+8AV5ChNmgggYMDLITkz3DWT42cu3MYCpULlU9+dnEZuQ+bHJULIEPPnQOT7EeYET15jDgr0URD5doJLhN0MYsEawH8cRI4TjAl6B65TgFqheIjlAwDSQdeBvUrOBVKBEiD/pw3JHXSAszChySFrpAyX9P4oUioYC8aAczCNcErgI4TUAN8ZRULS2TurMTg4jgrgk3ZRAqQ32pDZQxZwoiqIgbGH0wghKkCuMMd/8yGPz5q8c9ALDI2TaYC0V4CU1aWXCNtp5P7cABrI2MNoFeQwaHIsWr0U8Bt/yONZJewbwNRDdLAXVeYwqL1jWse59oc8ebBWo+/AOwg9lEGTpYPjThUJSzdhHUV8bDICwUKMSl7JQFUu+gbyHJWHmFTaCkiuQFa0VFqbLdmgne2NcnQY4OxVkbgA1AqYRkxVtheWOqPVxSrReweja6MmPWvhJasViFUPnIOuuI/6Ry8NoHnGABajNmYDkipc8jp3LmqyoanTtRy75G4wKI2TkFT7XPSwsxrWLB288VV0xlSbEwuYqpVt69oAdiGtvgNU60ryos7S8SsSrz/TlOisHqzNzrWsoPatZIsy3Tebi9HEnNttVTYkbpOdhV0Hk8DYNrQkdWnM6xsivVEj1k3lUeCmh2MPewu2qJzzclO1BJlcW9VlOZrWhwZw46A3kJuxnqPuQV46+DqsAEv1pfW9wGB0sc4BHjw8tRcsLwW/9Fesm+Z7s7otJH25fnu4j/o7XckuYnTjzIbR5Z2cM5wjPCQ4tzXO1zfSH6+XxqJ7rasDQ7vCLgkuBXyBtPGN/Jq56+y6UC8sXHQHYtUor0139xfT44J2OsN7dwAAAABJRU5ErkJggg==",this.An=this.An.bind(this)}return t=n,(e=[{key:"addTo",value:function(t){fengmap.FMMarkerFun.LAYER_CLASS.get(T.FIRE_MARKER)||fengmap.FMMarkerFun.LAYER_CLASS.set(T.FIRE_MARKER,Dv),this.G(t)}},{key:"remove",value:function(){this.en&&(this.stop(),this.en.scene.remove(this.ki),this.ji.Pi.destroy(),this.ji.Pi.particleMesh.geometry.dispose(),this.ji.Pi.particleMesh.material=void 0,this.ji.Pi.particleMesh.geometry=void 0,this.ji.Pi.particleMesh=void 0,this.ki.geometry.dispose(),this.ki.material.dispose(),this.ki.geometry=void 0,this.ki=void 0,this.I.off("update",this.An))}},{key:"stop",value:function(){this.Ui&&(this.Hi.vn(this.Ui),this.Ui=null)}},{key:"moveTo",value:function(t){var n=this,e=t.duration||.5;t.animate?(this.Ui||(this.Ui=new Vv),this.Ui.ri([this.T,this.M]),this.Ui.oi([t.x,t.y]),this.Ui.ai(e).si(function(t){n.T=t.destination[0],n.M=t.destination[1],n.Qi()}).ui(function(){n.T=t.x,n.M=t.y,n.Qi(),t.finish&&t.finish()}),this.Hi.cn(this.Ui.ii())):(this.T=t.x,this.M=t.y,this.Qi())}},{key:"x",get:function(){return this.T}},{key:"y",get:function(){return this.M}},{key:"height",get:function(){return this.F},set:function(t){this.F=t,this.ki.position.y=this.F+2.5,this.ji.Pi.particleMesh.position.y=this.F+2.5,this.ji.Mi.y=this.F+2.5,this.ji.Pi.positionBase.y=this.F+2.5,this.I.enableUpdateRender()}},{key:"flameSize",get:function(){return this.Gi},set:function(t){this.Gi=t,this.ki.material.uniforms.magnitude.value=10-t,this.I.enableUpdateRender()}},{key:"smokeDensity",get:function(){return void 0===this.Ai.smokeDensity?30:this.Ai.smokeDensity},set:function(t){this.Ai.smokeDensity=t,this.ji.Ei=t,this.ji.createSmoke(),this.I.enableUpdateRender()}},{key:"level",get:function(){return this.Bi}},{key:"type",get:function(){return T.FIRE_MARKER}},{key:"visible",get:function(){return this.Xi},set:function(t){this.Xi!==t&&(this.Xi=t,(this.ki.visible=t)?this.ji.createSmoke():this.ji.Pi.destroy())}},{key:"bound",get:function(){return null===this.Yi&&(this.Yi=new dd,void 0!==this.T)&&void 0!==this.M&&this.Yi.expandByCoords([{x:this.T,y:this.M}]),this.Yi.clone()}}])&&pd(t.prototype,e),i&&pd(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i})(),Object.assign(Fv.prototype,{G:function(t){var n=this,t=(this.I=t.parent.parent,this.Bi=t.level,t.getOrCreateLayer(T.FIRE_MARKER));this.en=t;(new Mi).load(this.Wi,function(t){n.ki=new td(t),n.ki.material.uniforms.magnitude.value=10-n.Gi,n.ki.position.set(n.T-n.I.x,n.F+2.5,-n.M+n.I.y),n.ki.scale.set(4,5,4),n.en.scene.add(n.ki),n.ki.isNoPickup=!0});t={x:this.T-this.I.x,y:this.F+2.5,z:-this.M+this.I.y,smokeDensity:this.Ai.smokeDensity};this.ji=new fd(t),this.ji.init(this.en.scene),this.I.on("update",this.An)},An:function(){var t=this.Vi.getElapsedTime()*this.zi;null!==this.ki&&this.ki.update(t),this.ji.update(),this.I.enableUpdateRender()},Qi:function(){this.ki.position.x=this.T-this.I.x,this.ki.position.z=-this.M+this.I.y,this.ji.Pi.particleMesh.position.x=this.T-this.I.x,this.ji.Pi.particleMesh.position.z=-this.M+this.I.y,this.ji.Mi.x=this.T-this.I.x,this.ji.Mi.z=-this.M+this.I.y,this.ji.Pi.positionBase.x=this.T-this.I.x,this.ji.Pi.positionBase.z=-this.M+this.I.y,this.I.enableUpdateRender()}});function yd(t){return(yd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gd(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=yd(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=yd(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==yd(t)?t:t+""))(i.key),i)}}function bd(t,n,e){n=wd(n);var i=t,n=_d()?Reflect.construct(n,e||[],wd(t).constructor):n.apply(t,e);if(!n||"object"!=yd(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function _d(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_d=function(){return!!t})()}function wd(t){return(wd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Sd(t,n){return(Sd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var xd=(()=>{function c(t,n,e,i,r,o,a,s,u,l){if(this instanceof c)return(t=bd(this,c,[t=void 0!==t?t:[],n=void 0!==n?n:301,e,i,r,o,a,s,u,l])).isCubeTexture=!0,t.flipY=!1,t;throw new TypeError("Cannot call a class as a function")}var t,n=c,e=_i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Sd(n,e),n=c,(e=[{key:"images",get:function(){return this.image},set:function(t){this.image=t}}])&&gd(n.prototype,e),t&&gd(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Ad(t){return(Ad="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ed(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Ad(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Ad(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Ad(t)?t:t+""))(i.key),i)}}function Td(t,n,e){n=Pd(n);var i=t,n=Md()?Reflect.construct(n,e||[],Pd(t).constructor):n.apply(t,e);if(!n||"object"!=Ad(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Md(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Md=function(){return!!t})()}function Pd(t){return(Pd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Od(t,n){return(Od=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Nd=(()=>{function n(t){if(this instanceof n)return Td(this,n,[t]);throw new TypeError("Cannot call a class as a function")}var t,e=n,i=Ze;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Od(e,i),e=n,(i=[{key:"load",value:function(t,e,n,i){var r=new xd,o=(r.colorSpace="srgb",new ri(this.manager)),a=(o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),0);for(var s=0;s<t.length;++s)(n=>{o.load(t[n],function(t){r.images[n]=t,6===++a&&(r.needsUpdate=!0,e)&&e(r)},void 0,i)})(s);return r}}])&&Ed(e.prototype,i),t&&Ed(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e})();function Cd(t){return(Cd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ld(t,n){var e,i,r,o,a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(a)return r=!(i=!0),{s:function(){a=a.call(t)},n:function(){var t=a.next();return i=t.done,t},e:function(t){r=!0,e=t},f:function(){try{i||null==a.return||a.return()}finally{if(r)throw e}}};if(Array.isArray(t)||(a=Dd(t))||n&&t&&"number"==typeof t.length)return a&&(t=a),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Rd(t,n){return(t=>{if(Array.isArray(t))return t})(t)||((t,n)=>{var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var i,r,o,a,s=[],u=!0,l=!1;try{if(o=(e=e.call(t)).next,0===n){if(Object(e)!==e)return;u=!1}else for(;!(u=(i=o.call(e)).done)&&(s.push(i.value),s.length!==n);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=e.return&&(a=e.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}})(t,n)||Dd(t,n)||(()=>{throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function Dd(t,n){var e;if(t)return"string"==typeof t?Fd(t,n):"Map"===(e="Object"===(e={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Fd(t,n):void 0}function Fd(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=Array(n);e<n;e++)i[e]=t[e];return i}function Id(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Cd(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Cd(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Cd(t)?t:t+""))(i.key),i)}}function kd(t,n,e){n=Ud(n);var i=t,n=jd()?Reflect.construct(n,e||[],Ud(t).constructor):n.apply(t,e);if(!n||"object"!=Cd(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function jd(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(jd=function(){return!!t})()}function Ud(t){return(Ud=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Bd(t,n){return(Bd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Hd=(()=>{function r(t,n,e){var i;if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");(i=kd(this,r)).type="CubeCamera",i.renderTarget=e,i.coordinateSystem=null,i.activeMipmapLevel=0;e=new Au(-90,1,t,n),e.layers=i.layers,i.add(e),e=new Au(-90,1,t,n),e.layers=i.layers,i.add(e),e=new Au(-90,1,t,n),e.layers=i.layers,i.add(e),e=new Au(-90,1,t,n),e.layers=i.layers,i.add(e),e=new Au(-90,1,t,n),e.layers=i.layers,i.add(e),e=new Au(-90,1,t,n);return e.layers=i.layers,i.add(e),i}var t,n=r,e=Me;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Bd(n,e),n=r,(e=[{key:"updateCoordinateSystem",value:function(){var t,n=this.coordinateSystem,e=this.children.concat(),i=Rd(e,6),r=i[0],o=i[1],a=i[2],s=i[3],u=i[4],i=i[5],l=Ld(e);try{for(l.s();!(t=l.n()).done;){var c=t.value;this.remove(c)}}catch(t){l.e(t)}finally{l.f()}if(2e3===n)r.up.set(0,1,0),r.lookAt(1,0,0),o.up.set(0,1,0),o.lookAt(-1,0,0),a.up.set(0,0,-1),a.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),u.up.set(0,1,0),u.lookAt(0,0,1),i.up.set(0,1,0);else{if(2001!==n)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+n);r.up.set(0,-1,0),r.lookAt(-1,0,0),o.up.set(0,-1,0),o.lookAt(1,0,0),a.up.set(0,0,1),a.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),u.up.set(0,-1,0),u.lookAt(0,0,1),i.up.set(0,-1,0)}i.lookAt(0,0,-1);var f,h=Ld(e);try{for(h.s();!(f=h.n()).done;){var v=f.value;this.add(v),v.updateMatrixWorld()}}catch(t){h.e(t)}finally{h.f()}}},{key:"update",value:function(t,n){null===this.parent&&this.updateMatrixWorld();var e=this.renderTarget,i=this.activeMipmapLevel,r=(this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem()),Rd(this.children,6)),o=r[0],a=r[1],s=r[2],u=r[3],l=r[4],r=r[5],c=t.getRenderTarget(),f=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),v=t.xr.enabled,d=(t.xr.enabled=!1,e.texture.generateMipmaps);e.texture.generateMipmaps=!1,t.setRenderTarget(e,0,i),t.render(n,o),t.setRenderTarget(e,1,i),t.render(n,a),t.setRenderTarget(e,2,i),t.render(n,s),t.setRenderTarget(e,3,i),t.render(n,u),t.setRenderTarget(e,4,i),t.render(n,l),e.texture.generateMipmaps=d,t.setRenderTarget(e,5,i),t.render(n,r),t.setRenderTarget(c,f,h),t.xr.enabled=v,e.texture.needsPMREMUpdate=!0}}])&&Id(n.prototype,e),t&&Id(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Vd(t){return(Vd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zd(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Vd(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Vd(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Vd(t)?t:t+""))(i.key),i)}}function Gd(t,n,e){n=Yd(n);var i=t,n=Xd()?Reflect.construct(n,e||[],Yd(t).constructor):n.apply(t,e);if(!n||"object"!=Vd(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Xd(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Xd=function(){return!!t})()}function Yd(t){return(Yd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Wd(t,n){return(Wd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Qd=(()=>{function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=this,i=r;if(!(e instanceof i))throw new TypeError("Cannot call a class as a function");(e=Gd(this,r,[t,t,n])).isWebGLCubeRenderTarget=!0;i={width:t,height:t,depth:1};return e.texture=new xd([i,i,i,i,i,i],n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),e.texture.isRenderTargetTexture=!0,e.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,e.texture.minFilter=void 0!==n.minFilter?n.minFilter:O,e}var t,n=r,e=D;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Wd(n,e),n=r,(e=[{key:"fromEquirectangularTexture",value:function(t,n){this.texture.type=n.type,this.texture.colorSpace=n.colorSpace,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;var e={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",o=new Hs(5,5,5),e=new R({name:"CubemapFromEquirect",uniforms:Io(e),vertexShader:i,fragmentShader:r,side:W,blending:0}),i=(e.uniforms.tEquirect.value=n,new _(o,e)),r=n.minFilter;return 1008===n.minFilter&&(n.minFilter=O),new Hd(1,10,this).update(t,i),n.minFilter=r,i.geometry.dispose(),i.material.dispose(),this}},{key:"clear",value:function(t,n,e,i){for(var r=t.getRenderTarget(),o=0;o<6;o++)t.setRenderTarget(this,o),t.clear(n,e,i);t.setRenderTarget(r)}}])&&zd(n.prototype,e),t&&zd(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function qd(t){return(qd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Zd(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=qd(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=qd(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==qd(t)?t:t+""))(i.key),i)}}var Jd=[.125,.215,.35,.446,.526,.582],Kd=new n,$d=new N,tm=null,nm=0,em=0,im=!1,n=(1+Math.sqrt(5))/2,rm=1/n,om=[new U(-n,rm,0),new U(n,rm,0),new U(-rm,0,n),new U(rm,0,n),new U(0,n,-rm),new U(0,n,rm),new U(-1,1,-1),new U(1,1,-1),new U(-1,1,1),new U(1,1,1)],am=(()=>{function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.qi=t,this.Zi=null,this.Ji=0,this.Ki=0,this.$i=[],this.tr=[],this.nr=[],this.er=null,this.ir=null,this.rr=null,this._compileMaterial(this.er)}return t=n,(e=[{key:"fromScene",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:100,r=(tm=this.qi.getRenderTarget(),nm=this.qi.getActiveCubeFace(),em=this.qi.getActiveMipmapLevel(),im=this.qi.xr.enabled,this.qi.xr.enabled=!1,this._setSize(256),this._allocateTargets());return r.depthBuffer=!0,this._sceneToCubeUV(t,e,i,r),0<n&&this._blur(r,0,0,n),this._applyPMREM(r),this._cleanup(r),r}},{key:"fromEquirectangular",value:function(t){return this._fromTexture(t,1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)}},{key:"fromCubemap",value:function(t){return this._fromTexture(t,1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)}},{key:"compileCubemapShader",value:function(){null===this.ir&&(this.ir=cm(),this._compileMaterial(this.ir))}},{key:"compileEquirectangularShader",value:function(){null===this.rr&&(this.rr=lm(),this._compileMaterial(this.rr))}},{key:"dispose",value:function(){this.mn(),null!==this.ir&&this.ir.dispose(),null!==this.rr&&this.rr.dispose()}},{key:"_setSize",value:function(t){this.Ji=Math.floor(Math.log2(t)),this.Ki=Math.pow(2,this.Ji)}},{key:"_dispose",value:function(){null!==this.er&&this.er.dispose(),null!==this.Zi&&this.Zi.dispose();for(var t=0;t<this.$i.length;t++)this.$i[t].dispose()}},{key:"_cleanup",value:function(t){this.qi.setRenderTarget(tm,nm,em),this.qi.xr.enabled=im,t.scissorTest=!1,um(t,0,0,t.width,t.height)}},{key:"_fromTexture",value:function(t,n){301===t.mapping||302===t.mapping?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),tm=this.qi.getRenderTarget(),nm=this.qi.getActiveCubeFace(),em=this.qi.getActiveMipmapLevel(),im=this.qi.xr.enabled,this.qi.xr.enabled=!1;n=n||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}},{key:"_allocateTargets",value:function(){var t,n,e=3*Math.max(this.Ki,112),i=4*this.Ki,r={magFilter:O,minFilter:O,generateMipmaps:!1,type:Z,format:J,colorSpace:K,depthBuffer:!1},o=sm(e,i,r);return null!==this.Zi&&this.Zi.width===e&&this.Zi.height===i||(null!==this.Zi&&this.mn(),this.Zi=sm(e,i,r),t=(t=>{for(var n=[],e=[],i=[],r=t,o=t-4+1+Jd.length,a=0;a<o;a++){for(var s=Math.pow(2,r),u=(e.push(s),1/s),u=(t-4<a?u=Jd[a-t+4-1]:0===a&&(u=0),i.push(u),1/(s-2)),s=-u,u=1+u,l=[s,s,u,s,u,u,s,s,u,u,s,u],c=new Float32Array(108),f=new Float32Array(72),h=new Float32Array(36),v=0;v<6;v++){var d=v%3*2/3-1,m=2<v?0:-1,d=[d,m,0,d+2/3,m,0,d+2/3,1+m,0,d,m,0,d+2/3,1+m,0,d,1+m,0],m=(c.set(d,18*v),f.set(l,12*v),[v,v,v,v,v,v]);h.set(m,6*v)}s=new Ve;s.setAttribute("position",new H(c,3)),s.setAttribute("uv",new H(f,2)),s.setAttribute("faceIndex",new H(h,1)),n.push(s),4<r&&r--}return{lodPlanes:n,sizeLods:e,sigmas:i}})(r=this.Ji),this.tr=t.sizeLods,this.$i=t.lodPlanes,this.nr=t.sigmas,this.er=(t=r,r=e,e=i,i=new Float32Array(20),n=new U(0,1,0),new R({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/r,CUBEUV_TEXEL_HEIGHT:1/e,CUBEUV_MAX_MIP:"".concat(t,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:fm(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1}))),o}},{key:"_compileMaterial",value:function(t){t=new _(this.$i[0],t);this.qi.compile(t,Kd)}},{key:"_sceneToCubeUV",value:function(t,n,e,i){var r=new Au(90,1,n,e),o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],s=this.qi,n=s.autoClear,e=s.toneMapping,u=(s.getClearColor($d),s.toneMapping=0,s.autoClear=!1,new b({name:"PMREM.Background",side:W,depthWrite:!1,depthTest:!1})),l=new _(new Hs,u),c=!1,f=t.background;f?f.isColor&&(u.color.copy(f),c=!(t.background=null)):(u.color.copy($d),c=!0);for(var h=0;h<6;h++){var v=h%3,d=(0==v?(r.up.set(0,o[h],0),r.lookAt(a[h],0,0)):1==v?(r.up.set(0,0,o[h]),r.lookAt(0,a[h],0)):(r.up.set(0,o[h],0),r.lookAt(0,0,a[h])),this.Ki);um(i,v*d,2<h?d:0,d,d),s.setRenderTarget(i),c&&s.render(l,r),s.render(t,r)}l.geometry.dispose(),l.material.dispose(),s.toneMapping=e,s.autoClear=n,t.background=f}},{key:"_textureToCubeUV",value:function(t,n){var e=this.qi,i=301===t.mapping||302===t.mapping,i=(i?(null===this.ir&&(this.ir=cm()),this.ir.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this.rr&&(this.rr=lm()),i?this.ir:this.rr),r=new _(this.$i[0],i),i=(i.uniforms.envMap.value=t,this.Ki);um(n,0,0,3*i,2*i),e.setRenderTarget(n),e.render(r,Kd)}},{key:"_applyPMREM",value:function(t){for(var n=this.qi,e=n.autoClear,i=(n.autoClear=!1,this.$i.length),r=1;r<i;r++){var o=Math.sqrt(this.nr[r]*this.nr[r]-this.nr[r-1]*this.nr[r-1]);this._blur(t,r-1,r,o,om[(i-r-1)%om.length])}n.autoClear=e}},{key:"_blur",value:function(t,n,e,i,r){var o=this.Zi;this._halfBlur(t,o,n,e,i,"latitudinal",r),this._halfBlur(o,t,e,e,i,"longitudinal",r)}},{key:"_halfBlur",value:function(t,n,e,i,r,o,a){for(var s=this.qi,u=this.er,l=("latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!"),new _(this.$i[i],u)),u=u.uniforms,c=this.tr[e]-1,c=isFinite(r)?Math.PI/(2*c):2*Math.PI/39,f=r/c,h=isFinite(r)?1+Math.floor(3*f):20,v=(20<h&&console.warn("sigmaRadians, ".concat(r,", is too large and will clip, as it requested ").concat(h," samples when the maximum is set to ").concat(20)),[]),d=0,m=0;m<20;++m){var p=m/f,p=Math.exp(-p*p/2);v.push(p),0===m?d+=p:m<h&&(d+=2*p)}for(var y=0;y<v.length;y++)v[y]=v[y]/d;u.envMap.value=t.texture,u.samples.value=h,u.weights.value=v,u.latitudinal.value="latitudinal"===o,a&&(u.poleAxis.value=a);r=this.Ji,u.dTheta.value=c,u.mipInt.value=r-e,t=this.tr[i];um(n,3*t*(r-4<i?i-r+4:0),4*(this.Ki-t),3*t,2*t),s.setRenderTarget(n),s.render(l,Kd)}}])&&Zd(t.prototype,e),i&&Zd(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i})();function sm(t,n,e){t=new D(t,n,e);return t.texture.mapping=306,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function um(t,n,e,i,r){t.viewport.set(n,e,i,r),t.scissor.set(n,e,i,r)}function lm(){return new R({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:fm(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function cm(){return new R({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:fm(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function fm(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}var hm={basic:{uniforms:d([F.common,F.specularmap,F.envmap,F.aomap,F.lightmap,F.fog]),vertexShader:I.meshbasic_vert,fragmentShader:I.meshbasic_frag},lambert:{uniforms:d([F.common,F.specularmap,F.envmap,F.aomap,F.lightmap,F.emissivemap,F.bumpmap,F.normalmap,F.displacementmap,F.fog,F.lights,{emissive:{value:new N(0)}}]),vertexShader:I.meshlambert_vert,fragmentShader:I.meshlambert_frag},phong:{uniforms:d([F.common,F.specularmap,F.envmap,F.aomap,F.lightmap,F.emissivemap,F.bumpmap,F.normalmap,F.displacementmap,F.fog,F.lights,{emissive:{value:new N(0)},specular:{value:new N(1118481)},shininess:{value:30}}]),vertexShader:I.meshphong_vert,fragmentShader:I.meshphong_frag},standard:{uniforms:d([F.common,F.envmap,F.aomap,F.lightmap,F.emissivemap,F.bumpmap,F.normalmap,F.displacementmap,F.roughnessmap,F.metalnessmap,F.fog,F.lights,{emissive:{value:new N(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:I.meshphysical_vert,fragmentShader:I.meshphysical_frag},toon:{uniforms:d([F.common,F.aomap,F.lightmap,F.emissivemap,F.bumpmap,F.normalmap,F.displacementmap,F.gradientmap,F.fog,F.lights,{emissive:{value:new N(0)}}]),vertexShader:I.meshtoon_vert,fragmentShader:I.meshtoon_frag},matcap:{uniforms:d([F.common,F.bumpmap,F.normalmap,F.displacementmap,F.fog,{matcap:{value:null}}]),vertexShader:I.meshmatcap_vert,fragmentShader:I.meshmatcap_frag},points:{uniforms:d([F.points,F.fog]),vertexShader:I.points_vert,fragmentShader:I.points_frag},dashed:{uniforms:d([F.common,F.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:I.linedashed_vert,fragmentShader:I.linedashed_frag},depth:{uniforms:d([F.common,F.displacementmap]),vertexShader:I.depth_vert,fragmentShader:I.depth_frag},normal:{uniforms:d([F.common,F.bumpmap,F.normalmap,F.displacementmap,{opacity:{value:1}}]),vertexShader:I.meshnormal_vert,fragmentShader:I.meshnormal_frag},sprite:{uniforms:d([F.sprite,F.fog]),vertexShader:I.sprite_vert,fragmentShader:I.sprite_frag},background:{uniforms:{uvTransform:{value:new v},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:I.background_vert,fragmentShader:I.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new v}},vertexShader:I.backgroundCube_vert,fragmentShader:I.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:I.cube_vert,fragmentShader:I.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:I.equirect_vert,fragmentShader:I.equirect_frag},distanceRGBA:{uniforms:d([F.common,F.displacementmap,{referencePosition:{value:new U},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:I.distanceRGBA_vert,fragmentShader:I.distanceRGBA_frag},shadow:{uniforms:d([F.lights,F.fog,{color:{value:new N(0)},opacity:{value:1}}]),vertexShader:I.shadow_vert,fragmentShader:I.shadow_frag}};function vm(t){return(vm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dm(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=vm(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=vm(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==vm(t)?t:t+""))(i.key),i)}}hm.physical={uniforms:d([hm.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new v},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new v},clearcoatNormalScale:{value:new B(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new v},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new v},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new v},sheen:{value:0},sheenColor:{value:new N(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new v},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new v},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new v},transmissionSamplerSize:{value:new B},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new v},attenuationDistance:{value:0},attenuationColor:{value:new N(0)},specularColor:{value:new N(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new v},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new v},anisotropyVector:{value:new B},anisotropyMap:{value:null},anisotropyMapTransform:{value:new v}}]),vertexShader:I.meshphysical_vert,fragmentShader:I.meshphysical_frag},hm.fmStandard={uniforms:d([hm.standard.uniforms,{sweepW:{value:0},sweepH:{value:0},se2N:{value:new B(0,0)},se2RN:{value:new B(0,0)},moveP:{value:new B(0,0)},color_r:{value:new N(16711935)},color_a:{value:new N(16776960)},isRect:{value:!1},isAnnulus:{value:!1},isEnable:{value:!1},circleC:{value:new B(0,0)},maxR:{value:0},minR:{value:0},isSweepTexture:{value:!1},sweepTexture:{value:null},sweepStrength:{value:1}},{isMask:{value:!1}},{maskType:{value:0}},{maskPolygons:{value:[]}},{maskHolePogygons:{value:[]}},{maskHeight:{value:0}},{maskExtrudeHeight:{value:0}},{boundCenter:{value:null}},{boundSize:{value:null}},{maskOpacity:{value:null}},{maskNodeHeight:{value:0}}]),vertexShader:I.fmMeshphysical_vert,fragmentShader:I.fmMeshphysical_frag},hm.fmLambert={uniforms:d([hm.lambert.uniforms,{mapMixColor:{value:!1}},{heatCenter:{value:new B(0,0)}},{heatSize:{value:new B(0,0)}},{isMask:{value:!1}},{maskType:{value:0}},{maskPolygons:{value:[]}},{maskHolePogygons:{value:[]}},{maskHeight:{value:0}},{maskExtrudeHeight:{value:0}},{boundCenter:{value:null}},{boundSize:{value:null}},{maskOpacity:{value:null}},{maskNodeHeight:{value:0}},{isJsonModel:{value:!1}}]),vertexShader:I.fmMeshlambert_vert,fragmentShader:I.fmMeshlambert_frag},hm.fmbasic={uniforms:d([hm.basic.uniforms,{isMask:{value:!1}},{maskType:{value:0}},{maskPolygons:{value:[]}},{maskHolePogygons:{value:[]}},{maskHeight:{value:0}},{maskExtrudeHeight:{value:0}},{boundCenter:{value:null}},{boundSize:{value:null}},{maskNodeHeight:{value:0}},{maskOpacity:{value:null}}]),vertexShader:I.fmMeshBasic_vert,fragmentShader:I.fmMeshBasic_frag};var mm=(()=>{function n(){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");var t=Io(hm.backgroundCube.uniforms);t.exposure={value:1},t.opacity={value:1},t.renderType={value:2},t.renderOutType={value:1},t.projectionMatrixFixZoom={value:[]},this.boxMesh=new _(new Hs(1,1,1),new R({type:"BackgroundCubeMaterial",uniforms:t,vertexShader:"\n    varying vec3 vWorldDirection;\n    #include <common>\n    // zoom,\n    uniform mat4 projectionMatrixFixZoom;\n    void main() {\n\n      vWorldDirection = transformDirection( position, modelMatrix );\n\n      #include <begin_vertex>\n      #include <project_vertex>\n\n      if (isPerspectiveMatrix(projectionMatrix)) {\n        gl_Position = projectionMatrix * mvPosition;\n      } else {\n        gl_Position = projectionMatrixFixZoom * mvPosition;\n      }\n      gl_Position.z = gl_Position.w; // set z to camera.far\n    }",fragmentShader:"\n      \n      #ifdef ENVMAP_TYPE_CUBE\n\n        uniform samplerCube envMap;\n\n      #elif defined( ENVMAP_TYPE_CUBE_UV )\n\n        uniform sampler2D envMap;\n\n      #endif\n\n      uniform float flipEnvMap;\n      uniform float backgroundBlurriness;\n      uniform float backgroundIntensity;\n      uniform mat3 backgroundRotation;\n\n\n      uniform float opacity;\n      uniform float exposure;\n      uniform float renderType;\n      uniform float renderOutType;\n      varying vec3 vWorldDirection;\n      #include <cube_uv_reflection_fragment>\n      void main() {\n        \n        #ifdef ENVMAP_TYPE_CUBE\n\n          vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\n        #elif defined( ENVMAP_TYPE_CUBE_UV )\n\n          vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\n        #else\n\n          vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n        #endif\n\n        texColor.rgb *= backgroundIntensity;\n\n        gl_FragColor = texColor;\n\n        gl_FragColor.a *= opacity;\n        if(renderType==1.0){\n          gl_FragColor.rgb=exposure*gl_FragColor.rgb;\n        } else if(renderType==2.0){\n          gl_FragColor.rgb=exposure*gl_FragColor.rgb;\n          saturate( ( gl_FragColor * ( 2.51 * gl_FragColor + 0.03 ) ) / ( gl_FragColor * ( 2.43 * gl_FragColor + 0.59 ) + 0.14 ) );\n        }\n        if(renderOutType==1.0){\n          gl_FragColor=vec4( mix( pow( gl_FragColor.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), gl_FragColor.rgb * 12.92, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.0031308 ) ) ) ), gl_FragColor.a );\n        }\n      }",side:W,depthTest:!1,depthWrite:!1,fog:!1})),this.boxMesh.frustumCulled=!1,this.boxMesh.geometry.deleteAttribute("normal"),this.boxMesh.geometry.deleteAttribute("uv"),this.boxMesh.onBeforeRender=function(t,n,e){this.matrixWorld.copyPosition(e.matrixWorld)},Object.defineProperty(this.boxMesh.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),this.tempMatix=new C}return t=n,(e=[{key:"setTexture",value:function(t){this.boxMesh.material.uniforms.envMap.value=t,this.boxMesh.material.uniforms.flipEnvMap.value=t.isCubeTexture?-1:1,this.boxMesh.material.needsUpdate=!0,this.ft=t}},{key:"setOrthographicScale",value:function(t,n){var e;"OrthographicCamera"===t.type&&(e=t.zoom,t.zoom=n,t.updateProjectionMatrix(),this.tempMatix.copy(t.projectionMatrix),this.boxMesh.material.uniforms.projectionMatrixFixZoom.value=this.tempMatix,t.zoom=e,t.updateProjectionMatrix())}}])&&dm(t.prototype,e),i&&dm(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i})();function pm(t){return(pm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ym(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=pm(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=pm(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==pm(t)?t:t+""))(i.key),i)}}function gm(t,n,e){n=_m(n);var i=t,n=bm()?Reflect.construct(n,e||[],_m(t).constructor):n.apply(t,e);if(!n||"object"!=pm(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function bm(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(bm=function(){return!!t})()}function _m(t){return(_m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function wm(t,n){return(wm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}Object.assign(mm.prototype,{mn:function(){this.tempMatix=null,this.boxMesh&&(this.boxMesh.geometry.dispose(),this.boxMesh.material.dispose(),this.ft&&this.ft.dispose(),this.boxMesh=null)}});var Sm={},xm=(()=>{function n(t){if(this instanceof n)return gm(this,n,[t]);throw new TypeError("Cannot call a class as a function")}var t,e=n,i=Ze;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&wm(e,i),e=n,(i=[{key:"load",value:function(a,t,n,e){void 0===a&&(a=""),void 0!==this.path&&(a=this.path+a),a=this.manager.resolveURL(a);var s=this,i=ze.get(a);if(void 0!==i)return setTimeout(function(){t&&t(i)},0),i;if(void 0===Sm[a]){var r=a.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){var o=r[1],u=!!r[2],l=r[3],l=decodeURIComponent(l);u&&(l=atob(l));try{var c=(this.responseType||"").toLowerCase();switch(c){case"arraybuffer":case"blob":for(var f=new Uint8Array(l.length),h=0;h<l.length;h++)f[h]=l.charCodeAt(h);v="blob"===c?new Blob([f.buffer],{type:o}):f.buffer;break;case"document":var v=(new DOMParser).parseFromString(l,o);break;case"json":v=JSON.parse(l);break;default:v=l}setTimeout(function(){t&&t(v),s.manager.itemEnd(a)},0)}catch(t){setTimeout(function(){e&&e(t),s.manager.itemError(a),s.manager.itemEnd(a)},0)}}else{Sm[a]=[],Sm[a].push({onLoad:t,onProgress:n,onError:e});var d,m=new Oe.XMLHttpRequest;for(d in m.open("GET",a,!0),m.addEventListener("load",function(t){var n=this.response,e=Sm[a];if(delete Sm[a],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),ze.add(a,n);for(var i=0,r=e.length;i<r;i++)(o=e[i]).onLoad&&o.onLoad(n)}else{for(var o,i=0,r=e.length;i<r;i++)(o=e[i]).onError&&o.onError(t);s.manager.itemError(a)}s.manager.itemEnd(a)},!1),m.addEventListener("progress",function(t){for(var n=Sm[a],e=0,i=n.length;e<i;e++){var r=n[e];r.onProgress&&r.onProgress(t)}},!1),m.addEventListener("error",function(t){var n=Sm[a];delete Sm[a];for(var e=0,i=n.length;e<i;e++){var r=n[e];r.onError&&r.onError(t)}s.manager.itemError(a),s.manager.itemEnd(a)},!1),m.addEventListener("abort",function(t){var n=Sm[a];delete Sm[a];for(var e=0,i=n.length;e<i;e++){var r=n[e];r.onError&&r.onError(t)}s.manager.itemError(a),s.manager.itemEnd(a)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(d,this.requestHeader[d]);m.send(null)}return s.manager.itemStart(a),m}Sm[a].push({onLoad:t,onProgress:n,onError:e})}},{key:"setResponseType",value:function(t){return this.responseType=t,this}},{key:"setWithCredentials",value:function(t){return this.withCredentials=t,this}},{key:"setMimeType",value:function(t){return this.mimeType=t,this}},{key:"setRequestHeader",value:function(t){return this.requestHeader=t,this}},{key:"dispose",value:function(){Sm={}}}])&&ym(e.prototype,i),t&&ym(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e})();function Am(t){return(Am="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Em(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Am(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Am(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Am(t)?t:t+""))(i.key),i)}}function Tm(t,n,e){n=Pm(n);var i=t,n=Mm()?Reflect.construct(n,e||[],Pm(t).constructor):n.apply(t,e);if(!n||"object"!=Am(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Mm(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Mm=function(){return!!t})()}function Pm(t){return(Pm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Om(t,n){return(Om=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Nm=(()=>{function d(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length?arguments[3]:void 0,r=4<arguments.length?arguments[4]:void 0,o=5<arguments.length?arguments[5]:void 0,a=6<arguments.length?arguments[6]:void 0,s=7<arguments.length?arguments[7]:void 0,u=8<arguments.length&&void 0!==arguments[8]?arguments[8]:m,l=9<arguments.length&&void 0!==arguments[9]?arguments[9]:m,c=10<arguments.length?arguments[10]:void 0,f=11<arguments.length?arguments[11]:void 0,h=this,v=d;if(h instanceof v)return(h=Tm(this,d,[null,o,a,s,u,l,i,r,c,f])).isDataTexture=!0,h.image={data:t,width:n,height:e},h.generateMipmaps=!1,h.flipY=!1,h.unpackAlignment=1,h;throw new TypeError("Cannot call a class as a function")}var t,n,e=d,i=_i;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Om(e,i),e=d,t&&Em(e.prototype,t),n&&Em(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e})();function Cm(t){return(Cm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Lm(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Cm(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Cm(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Cm(t)?t:t+""))(i.key),i)}}function Rm(t,n,e){n=Fm(n);var i=t,n=Dm()?Reflect.construct(n,e||[],Fm(t).constructor):n.apply(t,e);if(!n||"object"!=Cm(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Dm(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Dm=function(){return!!t})()}function Fm(t){return(Fm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Im(t,n){return(Im=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var km=(()=>{function n(t){if(this instanceof n)return Rm(this,n,[t]);throw new TypeError("Cannot call a class as a function")}var t,e=n,i=Ze;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Im(e,i),e=n,(i=[{key:"load",value:function(t,e,n,i){var r=this,o=new Nm,a=new xm(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(t,function(t){var n;try{n=r.parse(t)}catch(t){if(void 0===i)return void console.error(t);i(t)}void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:q,o.wrapT=void 0!==n.wrapT?n.wrapT:q,o.magFilter=void 0!==n.magFilter?n.magFilter:O,o.minFilter=void 0!==n.minFilter?n.minFilter:O,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(o.colorSpace=n.colorSpace),void 0!==n.flipY&&(o.flipY=n.flipY),void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=1008),1===n.mipmapCount&&(o.minFilter=O),void 0!==n.generateMipmaps&&(o.generateMipmaps=n.generateMipmaps),o.needsUpdate=!0,e&&e(o,n)},n,i),o}}])&&Lm(e.prototype,i),t&&Lm(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e})();function jm(t){return(jm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Um(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=jm(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=jm(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==jm(t)?t:t+""))(i.key),i)}}function Bm(t,n,e){n=zm(n);var i=t,n=Hm()?Reflect.construct(n,e||[],zm(t).constructor):n.apply(t,e);if(!n||"object"!=jm(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Hm(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Hm=function(){return!!t})()}function Vm(){return(Vm="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=((t,n)=>{for(;!{}.hasOwnProperty.call(t,n)&&null!==(t=zm(t)););return t})(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(null,arguments)}function zm(t){return(zm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Gm(t,n){return(Gm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Xm=(()=>{function l(t){if(this instanceof l)return(t=Bm(this,l,[t])).type=Z,t;throw new TypeError("Cannot call a class as a function")}var t,n=l,e=km;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Gm(n,e),n=l,(e=[{key:"parse",value:function(t){var n,e,i,r,o,a,s,u,l,c,f,h,b=1,v=2,_=3,w=4,S=function(t,n){switch(t){case b:throw new Error("THREE.RGBELoader: Read Error: "+(n||""));case v:throw new Error("THREE.RGBELoader: Write Error: "+(n||""));case _:throw new Error("THREE.RGBELoader: Bad File Format: "+(n||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(n||""))}},d=1,m=2,p=4,y="\n",g=function(t,n,e){n=n||1024;for(var i=t.pos,r=-1,o=0,a="",s=String.fromCharCode.apply(null,new Uint16Array(t.subarray(i,i+128)));(r=s.indexOf(y))<0&&o<n&&i<t.byteLength;)a+=s,o+=s.length,i+=128,s+=String.fromCharCode.apply(null,new Uint16Array(t.subarray(i,i+128)));return-1<r&&(!1!==e&&(t.pos+=o+r+1),a+s.slice(0,r))},t=new Uint8Array(t),x=(t.pos=0,(t=>{var n,e,i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,a=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,s={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};for((t.pos>=t.byteLength||!(n=g(t)))&&S(b,"no header found"),(e=n.match(/^#\?(\S+)/))||S(_,"bad initial token"),s.valid|=d,s.programtype=e[1],s.string+=n+"\n";;){if(!1===(n=g(t)))break;if(s.string+=n+"\n","#"===n.charAt(0))s.comments+=n+"\n";else if((e=n.match(i))&&(s.gamma=parseFloat(e[1])),(e=n.match(r))&&(s.exposure=parseFloat(e[1])),(e=n.match(o))&&(s.valid|=m,s.format=e[1]),(e=n.match(a))&&(s.valid|=p,s.height=parseInt(e[1],10),s.width=parseInt(e[2],10)),s.valid&m&&s.valid&p)break}return s.valid&m||S(_,"missing format specifier"),s.valid&p||S(_,"missing image size specifier"),s})(t)),A=x.width,E=x.height,T=((t,n,e)=>{var i=n;if(i<8||32767<i||2!==t[0]||2!==t[1]||128&t[2])return new Uint8Array(t);i!==(t[2]<<8|t[3])&&S(_,"wrong scanline width");for(var r=new Uint8Array(4*n*e),o=(r.length||S(w,"unable to allocate buffer space"),0),a=0,s=4*i,u=new Uint8Array(4),l=new Uint8Array(s),c=e;0<c&&a<t.byteLength;){a+4>t.byteLength&&S(b),u[0]=t[a++],u[1]=t[a++],u[2]=t[a++],u[3]=t[a++],2==u[0]&&2==u[1]&&(u[2]<<8|u[3])==i||S(_,"bad rgbe scanline format");for(var f=0,h=void 0;f<s&&a<t.byteLength;){var v=128<(h=t[a++]);if(v&&(h-=128),(0===h||s<f+h)&&S(_,"bad scanline data"),v)for(var d=t[a++],m=0;m<h;m++)l[f++]=d;else l.set(t.subarray(a,a+h),f),f+=h,a+=h}for(var p=i,y=0;y<p;y++){var g=0;r[o]=l[y+0],g+=i,r[o+1]=l[y+g],g+=i,r[o+2]=l[y+g],g+=i,r[o+3]=l[y+g],o+=4}c--}return r})(t.subarray(t.pos),A,E);switch(this.type){case 1015:for(var M=T.length/4,P=new Float32Array(4*M),O=0;O<M;O++)c=P,f=l=4*O,h=void 0,h=(u=T)[l+3],h=Math.pow(2,h-128)/255,c[f+0]=u[l+0]*h,c[f+1]=u[l+1]*h,c[f+2]=u[l+2]*h,c[f+3]=1;n=P,e=1015;break;case Z:M=T.length/4;for(var N=new Uint16Array(4*M),C=0;C<M;C++)o=N,a=r=4*C,s=void 0,s=(i=T)[r+3],s=Math.pow(2,s-128)/255,o[a+0]=Sn.toHalfFloat(Math.min(i[r+0]*s,65504)),o[a+1]=Sn.toHalfFloat(Math.min(i[r+1]*s,65504)),o[a+2]=Sn.toHalfFloat(Math.min(i[r+2]*s,65504)),o[a+3]=Sn.toHalfFloat(1);n=N,e=Z;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:A,height:E,data:n,header:x.string,gamma:x.gamma,exposure:x.exposure,type:e}}},{key:"setDataType",value:function(t){return this.type=t,this}},{key:"load",value:function(t,e,n,i){return r=l,o="load",a=this,u=Vm(zm(1&(s=3)?r.prototype:r),o,a),(2&s&&"function"==typeof u?function(t){return u.apply(a,t)}:u)([t,function(t,n){switch(t.type){case 1015:case Z:t.colorSpace=K,t.minFilter=O,t.magFilter=O,t.generateMipmaps=!1,t.flipY=!0}e&&e(t,n)},n,i]);var r,o,a,s,u}}])&&Um(n.prototype,e),t&&Um(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Ym(t){return(Ym="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wm(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Ym(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Ym(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Ym(t)?t:t+""))(i.key),i)}}function Qm(t,n,e){n=Zm(n);var i=t,n=qm()?Reflect.construct(n,e||[],Zm(t).constructor):n.apply(t,e);if(!n||"object"!=Ym(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function qm(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(qm=function(){return!!t})()}function Zm(t){return(Zm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Jm(t,n){return(Jm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Km=(()=>{function n(t){if(this instanceof n)return(t=Qm(this,n,[t])).hdrLoader=new Xm,t.type=Z,t;throw new TypeError("Cannot call a class as a function")}var t,e=n,i=Ze;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Jm(e,i),e=n,(i=[{key:"load",value:function(r,t,n,e){var o=new xd;switch(o.type=this.type,o.type){case FloatType:case Z:o.colorSpace=K,o.minFilter=O,o.magFilter=O,o.generateMipmaps=!1}var a=this,s=0;for(var i=0;i<r.length;i++)((n,e,t,i)=>{new xm(a.manager).setPath(a.path).setResponseType("arraybuffer").setWithCredentials(a.withCredentials).load(r[n],function(t){s++;var t=a.hdrLoader.parse(t);t&&(void 0!==t.data&&((t=new Nm(t.data,t.width,t.height)).type=o.type,t.colorSpace=o.colorSpace,t.format=o.format,t.minFilter=o.minFilter,t.magFilter=o.magFilter,t.generateMipmaps=o.generateMipmaps,o.images[n]=t),6===s)&&(o.needsUpdate=!0,e)&&e(o)},t,i)})(i,t,n,e);return o}},{key:"setDataType",value:function(t){return this.type=t,this.hdrLoader.setDataType(t),this}}])&&Wm(e.prototype,i),t&&Wm(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e})();function $m(t,n,e){return(n=ep(n))in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function tp(t){return(tp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function np(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,ep(i.key),i)}}function ep(t){t=((t,n)=>{if("object"!=tp(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=tp(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string");return"symbol"==tp(t)?t:t+""}n=(()=>{function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.SkyBoxType={cube6HDR:0,cube6Normal:1,cube1HDR:2,cube1Normal:3},this.I=t,this.ar=!0,this.sr=1,this.Dn=2e3,this.ur=!1,this.j=null,this.lr=null,this.cr=[],this.hr=!1,this.vr=null,this.dr=null,this.mr=this.pr(),this.yr=this.gr(),"basic"===this.I.getRenderManager().type&&this.I.setRenderManager(new gs(this.I)),this.Ht=this.I.getRenderManager()}return t=n,(e=[{key:"isHDR",get:function(){return this.hr}},{key:"exposure",get:function(){return this.sr},set:function(t){null!==this.vr&&(this.sr=t,this.vr.boxMesh.material.uniforms.exposure.value=t,this.vr.boxMesh.material.uniformsNeedUpdate=!0,this.I.enableUpdateNode())}},{key:"imagePath",get:function(){return this.lr},set:function(t){this.lr=t,this.vr&&(this.br(),this.I.enableUpdateNode())}},{key:"scale",get:function(){return this.Dn},set:function(t){this.Dn=t,this.vr&&(this.vr.setOrthographicScale(this.I.camera,this.Dn),this.I.enableUpdateNode())}},{key:"imageNames",get:function(){return this.cr},set:function(t){var n=t[0],n=n.slice(n.match(/(?=\.)/).index+1).toLocaleLowerCase();this.hr="hdr"===n,this.cr=t,this.vr&&(this.br(),this.I.enableUpdateNode())}},{key:"enable",value:function(){this.ar=!0,(this.I.getRenderManager().skyNeedTexture=this).j&&this.I.getRenderManager().renderScene.add(this.j),this.I.enableUpdateNode()}},{key:"disable",value:function(){this.ar=!1,this.I.getRenderManager().skyNeedTexture=null,this.j&&this.I.getRenderManager().renderScene.remove(this.j),this.I.enableUpdateNode()}},{key:"setState",value:function(t){var n=t.imagePath,e=t.imageNames,i=t.exposure,t=t.scale;n&&(this.imagePath=n),e&&(this.imageNames=e),(n||e)&&this.br(),void 0!==i&&(this.exposure=i),void 0!==t&&(this.scale=t),this.I.enableUpdateNode()}},{key:"getState",value:function(){return{exposure:this.sr,imageNames:this.cr,imagePath:this.lr,scale:this.Dn}}},{key:"dispose",value:function(){this.disable(),this.vr&&this.vr.mn(),this.lr=null,this.cr=[],this.vr=null,this.mr=null,this.yr=null,this.ur=!1}}])&&np(t.prototype,e),i&&np(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i})(),Object.assign(n.prototype,{pr:function(){var t=this;return $m($m($m($m({},this.SkyBoxType.cube6HDR,function(){t.vr.boxMesh.material.uniforms.exposure.value=t.exposure,t.vr.boxMesh.material.uniforms.renderType.value=1,t.vr.boxMesh.material.uniforms.renderOutType.value=1,t.vr.boxMesh.material.uniformsNeedUpdate=!0}),this.SkyBoxType.cube6Normal,function(){t.vr.boxMesh.material.uniforms.renderType.value=3,t.vr.boxMesh.material.uniforms.renderOutType.value=2,t.vr.boxMesh.material.uniformsNeedUpdate=!0}),this.SkyBoxType.cube1HDR,function(){t.vr.boxMesh.material.uniforms.exposure.value=t.exposure,t.vr.boxMesh.material.uniforms.renderType.value=2,t.vr.boxMesh.material.uniforms.renderOutType.value=1,t.vr.boxMesh.material.uniformsNeedUpdate=!0}),this.SkyBoxType.cube1Normal,function(){t.vr.boxMesh.material.uniforms.renderType.value=4,t.vr.boxMesh.material.uniforms.renderOutType.value=3,t.vr.boxMesh.material.uniformsNeedUpdate=!0})},gr:function(){var i=this;return $m($m($m($m({},this.SkyBoxType.cube6HDR,function(){(new Km).setPath(i.lr).setDataType(1009).load(i.cr,function(t){t.magFilter=O,t.needsUpdate=!0,i._r(t),i.ur=!0})}),this.SkyBoxType.cube6Normal,function(){var n=[];i.imageNames.forEach(function(t){n.push(i.lr+t)}),(new Nd).load(n,function(t){t.mapping=301,i._r(t),i.ur=!0})}),this.SkyBoxType.cube1HDR,function(){var e=new am(i.I.getRenderManager().renderer);e.compileEquirectangularShader(),(new Xm).setPath(i.lr).load(i.cr[0],function(t){var n=e.fromEquirectangular(t);t.dispose(),e.dispose(),i._r(n.texture),i.ur=!0})}),this.SkyBoxType.cube1Normal,function(){(new Mi).load(i.lr+i.cr[0],function(t){t.mapping=300;t=new Qd(1024,{generateMipmaps:!0,minFilter:1008,magFilter:O}).fromEquirectangularTexture(i.I.getRenderManager().renderer,t);i._r(t),i.ur=!0})})},_r:function(t){t.colorSpace=mt,this.vr&&this.vr.mn(),this.vr=new mm,this.vr.setTexture(t),0<this.j.children.length&&this.j.remove(this.j.children[0]),this.j.add(this.vr.boxMesh);t=this.mr[this.dr];t&&t(),this.I.enableUpdateNode()},X:function(t,n){var e,i,r,o;this.ar&&this.ur&&(e=t.toneMappingExposure,i=t.toneMapping,r=t.outputEncoding,this.vr&&this.vr.setOrthographicScale(n,this.Dn),(o=this.mr[this.dr])&&o(t),t.render(this.j,n),t.toneMappingExposure=e,t.toneMapping=i,t.outputEncoding=r)},br:function(){null!==this.lr&&0!==this.cr.length&&null!=this.yr&&(this.j||(this.j=new l,this.Ht.renderScene.add(this.j)),this.dr=null,6===this.imageNames.length&&this.isHDR&&(this.dr=this.SkyBoxType.cube6HDR),6===this.imageNames.length&&!1===this.isHDR&&(this.dr=this.SkyBoxType.cube6Normal),1===this.imageNames.length&&this.isHDR&&(this.dr=this.SkyBoxType.cube1HDR),1===this.imageNames.length&&!1===this.isHDR&&(this.dr=this.SkyBoxType.cube1Normal),null===this.dr?console.warn("..."):this.yr[this.dr]())}}),rm=n;function ip(t){return(ip="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function rp(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=ip(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=ip(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==ip(t)?t:t+""))(i.key),i)}}n=(()=>{function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.url=t.url,this.exposure=t.exposure,void 0===this.exposure&&(this.exposure=.5)}return t=n,(e=[{key:"load",value:function(r,o){var a=this;(new Xm).load(this.url,function(t){var n=r.getRenderManager().renderer,e=n.toneMapping,i=(n.toneMapping=2,n.toneMappingExposure=a.exposure,new am(n)),i=(i.compileEquirectangularShader(),i.fromEquirectangular(t).texture);o&&o(i),n.toneMapping=e})}}])&&rp(t.prototype,e),i&&rp(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i})();function op(t){return(op="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ap(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=op(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=op(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==op(t)?t:t+""))(i.key),i)}}var sp=(()=>{function e(t,n){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.Cn=t.Cn,this.Nt=n.url,this.Lt=n.count;n=n.getRenderNode();this.wr=n.material.uniforms.isGradient.value,this.Sr=n.material.uniforms.gradientLength.value,this.Ar=n.material.uniforms.direction.value,this.Er=n.material.uniforms.gradientPercent.value,this.Tr=n.material.uniforms.gradientColor.value,this.Mr=t.Mr,this.yn=t.yn,null==this.yn&&(this.yn=0),void(this.Pr=0)!==t.Pr&&"y"===t.Pr&&(this.Pr=1),0===this.Pr&&(this.yn=this.yn/this.Lt),void 0===this.Mr&&(this.Mr=1),this.Or=null,this.Nr=null,this.Cr="\n            #include <common>\n            #include <logdepthbuf_pars_vertex>\n            varying vec2 vUv;\n            varying vec3 fNormal;\n            varying vec3 vPosition;\n            void main(){\n                    vUv = uv;\n                    vPosition = position;\n                    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n                    gl_Position = projectionMatrix * mvPosition;\n                    #include <logdepthbuf_vertex>\n            }\n        ",this.Lr="\n            uniform float time;\n            uniform float luminanceWall;\n            uniform float repeat;\n            varying vec2 vUv;\n            uniform sampler2D flowTexturefront;\n            uniform sampler2D flowTextureback;\n            uniform sampler2D bgTexture;\n            uniform float direct;\n            uniform float isBgColor;\n\n            uniform bool isGradient;\n            uniform int direction;//0x,1y\n            uniform int gradientLength;\n            uniform float gradientPercent[{num}];\n            uniform vec4 gradientColor[{num}];\n\n            #include <logdepthbuf_pars_fragment>\n\n            vec4 getColor(vec2 uv){\n                int begin=0;\n                int end=0;\n                float value=uv.x;\n                if(direction==1){\n                    if(uv.y<=0.5){\n                        value=(0.5-uv.y)/0.5;\n                    } else {\n                        value=(uv.y-0.5)/0.5;\n                    }\n                }\n                vec4 colorBegin=gradientColor[0];//gradientColor[begin];\n                vec4 colorEnd=gradientColor[0];\n                float beginPercent=gradientPercent[0];\n                float endPercent=gradientPercent[0];\n                if(direction==1){\n                    for(int i=0;i<{num};i++){\n                        if(value>gradientPercent[i]){\n                            colorBegin=gradientColor[i];\n                            colorEnd=gradientColor[i];\n                            beginPercent=gradientPercent[i];\n                            endPercent=gradientPercent[i];\n                            if(i+1<={num}-1){\n                                colorEnd=gradientColor[i+1];\n                                endPercent=gradientPercent[i+1];\n                            }\n                        }\n                    }\n                } else {\n                    for(int i=0;i<{num};i++){\n                        if(value>gradientPercent[i]){\n                            colorBegin=gradientColor[i];\n                            colorEnd=gradientColor[i];\n                            beginPercent=gradientPercent[i];\n                            endPercent=gradientPercent[i];\n                            if(i+1<={num}-1){\n                                colorEnd=gradientColor[i+1];\n                                endPercent=gradientPercent[i+1];\n                            }\n                        }\n                    }\n                }\n                \n                float perCent=0.0;\n                if(direction==0){\n                    perCent=(uv.x-beginPercent)/(endPercent-beginPercent);\n                    return mix(colorBegin,colorEnd,perCent);\n                } else {\n                    if(uv.y<=0.5){\n                        perCent=(((0.5-uv.y)/0.5)-beginPercent)/(endPercent-beginPercent);\n                        return mix(colorBegin,colorEnd,perCent);\n                    } else {\n                        perCent=(((uv.y-0.5)/0.5)-beginPercent)/(endPercent-beginPercent);\n                        return mix(colorBegin,colorEnd,perCent);\n                    }\n                }\n                \n            }\n            void main( void ) {\n                #include <logdepthbuf_fragment>\n                vec2 position = vUv;\n                if(direct==1.0){\n                    vec4 colora = texture2D( flowTextureback, vec2( vUv.x*repeat, fract(vUv.y + time )));\n                    if(vUv.y>0.5){\n                        colora = texture2D( flowTexturefront, vec2( vUv.x*repeat, fract(vUv.y - time )));\n                    }\n                    if(!isGradient){\n                        if(isBgColor==1.0){\n                            vec4 colorb = texture2D( bgTexture , position.xy);\n                            colora.r = colora.r * colorb.a * luminanceWall;\n                            colora.g = colora.g * colorb.a * luminanceWall;\n                            colora.b = colora.b * colorb.a * luminanceWall;\n\n                            colorb.r = colorb.r * colorb.a * luminanceWall;\n                            colorb.g = colorb.g * colorb.a * luminanceWall;\n                            colorb.b = colorb.b * colorb.a * luminanceWall;\n\n                            gl_FragColor = colorb + colora;  \n                        } else {\n                            gl_FragColor = colora; \n                        }    \n                    } else {\n                        vec4 gradientColor=getColor(vUv);\n                        vec4 resultColor=mix(colora,gradientColor,1.0-colora.a);\n                        resultColor.r = resultColor.r * resultColor.a * luminanceWall;\n                        resultColor.g = resultColor.g * resultColor.a * luminanceWall;\n                        resultColor.b = resultColor.b * resultColor.a * luminanceWall;\n\n                        gl_FragColor = resultColor;\n                    }\n                } else {\n                    vec4 colora = texture2D( flowTextureback, vec2( fract( vUv.x - time )*repeat, vUv.y));\n                    if(vUv.y>0.5){\n                        colora = texture2D( flowTexturefront, vec2( fract( vUv.x - time )*repeat, vUv.y));\n                    }\n                    if(!isGradient){\n                        if(isBgColor==1.0){\n                            vec4 colorb = texture2D( bgTexture , position.xy);\n                        \n                            colora.r = colora.r * colorb.a* luminanceWall;\n                            colora.g = colora.g * colorb.a* luminanceWall;\n                            colora.b = colora.b * colorb.a* luminanceWall;\n\n                            colorb.r = colorb.r * colorb.a * luminanceWall;\n                            colorb.g = colorb.g * colorb.a * luminanceWall;\n                            colorb.b = colorb.b * colorb.a * luminanceWall;\n                            gl_FragColor = colorb + colora;\n                        } else {\n                            colora.r = colora.r * colora.a * luminanceWall;\n                            colora.g = colora.g * colora.a * luminanceWall;\n                            colora.b = colora.b * colora.a * luminanceWall;\n                            gl_FragColor = colora; \n                        }   \n                    } else {\n                        vec4 gradientColor=getColor(vUv);\n                        vec4 resultColor=vec4(0.0);\n                        if(colora.a!=0.0){\n                            resultColor=colora;\n                        } else {\n                            resultColor=gradientColor;\n                        }\n                        \n                        resultColor.r = resultColor.r * resultColor.a * luminanceWall;\n                        resultColor.g = resultColor.g * resultColor.a * luminanceWall;\n                        resultColor.b = resultColor.b * resultColor.a * luminanceWall;\n\n                        gl_FragColor = resultColor;\n                    }\n                }\n            }\n        "}return t=e,(n=[{key:"init",value:function(i){var r=this,c=this;function o(t){var n=document.createElement("canvas"),e=(n.width=t.width,n.height=t.height,n.getContext("2d"));return e.translate(n.width,0),e.scale(-1,1),e.drawImage(t,0,0,n.width,n.height),n}function a(t,e){if(!t){for(var n=(t=>{var n=t.toLowerCase();if(n&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(n)){if(4===n.length){for(var e="#",i=1;i<4;i+=1)e+=n.slice(i,i+1).concat(n.slice(i,i+1));n=e}for(var r=[],i=1;i<7;i+=2)r.push(parseInt("0x"+n.slice(i,i+2)));return r}return n})(c.Cn),i=document.createElement("canvas"),r=(i.width=1024,i.height=2048,i.getContext("2d")),o=r.createLinearGradient(0,0,0,1024),a=.3,s=0;s<=1e3;s++)o.addColorStop(s/1e3,"rgba("+n[0]+", "+n[1]+","+n[2]+", "+a+")"),a+=7e-4;r.fillStyle=o,r.fillRect(0,0,1024,1024);for(var o=r.createLinearGradient(0,1024,0,2048),a=1,u=0;u<=1e3;u++)o.addColorStop(u/1e3,"rgba("+n[0]+", "+n[1]+","+n[2]+", "+a+")"),a-=7e-4;return r.fillStyle=o,r.fillRect(0,1024,1024,1024),i}var l=new Image;l.crossOrigin="Anonymous",l.onload=function(){var t=document.createElement("canvas"),n=(t.width=512,t.height=512,t.getContext("2d"));n.drawImage(l,0,0,512,256),n.drawImage(l,0,256,512,256),e&&e(t)},l.src=t}a(this.Nt,function(t){r.Or=new w(o(t)),r.Or.wrapS=r.Or.wrapT=Q,r.Nr=new w(o((t=t,(e=document.createElement("canvas")).width=512,e.height=512,(n=e.getContext("2d")).translate(256,256),n.rotate(Math.PI),n.drawImage(t,-256,-256),o(e)))),r.Nr.wrapS=r.Nr.wrapT=Q;var n=null,t=0,e=(void 0!==r.Cn&&(n=new w(a()),t=1),r.Lr.replace(/{num}/g,""+r.Sr)),n=new R({uniforms:{time:{value:0},luminanceWall:{value:r.Mr},flowTexturefront:{value:r.Or},flowTextureback:{value:r.Nr},bgTexture:{value:n},isBgColor:{value:t},direct:{value:r.Pr},repeat:{value:r.Lt},isGradient:{value:r.wr},direction:{value:r.Ar},gradientLength:{value:r.Sr},gradientPercent:{value:r.Er},gradientColor:{value:r.Tr}},transparent:!0,depthWrite:!0,depthTest:!0,side:Y,vertexShader:r.Cr,fragmentShader:e});i(n)})}}])&&ap(t.prototype,n),i&&ap(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,i})();function up(t){return(up="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function lp(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=up(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=up(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==up(t)?t:t+""))(i.key),i)}}var cp=(()=>{function e(t,n){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.Cn=t.Cn,this.Nt=n.url,this.Lt=n.count,this.Mr=t.Mr,this.yn=t.yn,this.yn=this.yn/this.Lt,this.ft=null,this.Cr="\n            #include <common>\n            #include <logdepthbuf_pars_vertex>\n            varying vec2 vUv;\n            void main(){\n                    vUv = uv;\n                    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n                    gl_Position = projectionMatrix * mvPosition;\n                    #include <logdepthbuf_vertex>\n            }\n        ",this.Lr="\n            uniform float time;\n            uniform float luminanceLine;\n            uniform float repeat;\n            varying vec2 vUv;\n            uniform sampler2D textureMap;\n            uniform sampler2D background;\n            uniform bool isbackground;\n            #include <logdepthbuf_pars_fragment>\n            void main( void ) {\n                #include <logdepthbuf_fragment>\n                vec4 backcolor=texture2D(background,vUv);\n                vec4 colora = texture2D( textureMap, vec2(fract( vUv.x + time )*repeat, vUv.y));\n                colora.r = colora.r * colora.a * luminanceLine;\n                colora.g = colora.g * colora.a * luminanceLine;\n                colora.b = colora.b * colora.a * luminanceLine;\n                if(isbackground){\n                    gl_FragColor = vec4(vec3(mix(colora,backcolor,1.0-colora.a)),1.0);\n                } else {\n                    gl_FragColor = colora;\n                }\n            }\n        "}return t=e,(n=[{key:"init",value:function(e){var t,i,r,o=this,a=this;t=this.Nt,i=function(t){o.ft=new w(t);var t=null,n=!(o.ft.wrapS=o.ft.wrapT=Q),t=(void 0!==o.Cn&&(t=new w(a.getBackgroundCanvas()),n=!0),new R({uniforms:{time:{value:0},luminanceLine:{value:o.Mr},textureMap:{value:o.ft},background:{value:t},isbackground:{value:n},repeat:{value:o.Lt}},transparent:!0,depthWrite:!0,depthTest:!0,side:2,vertexShader:o.Cr,fragmentShader:o.Lr}));e(t)},(r=new Image).crossOrigin="Anonymous",r.onload=function(){var t=document.createElement("canvas"),n=(t.width=512,t.height=512,t.getContext("2d"));n.drawImage(r,0,0,r.width,r.height/2,0,256,512,256),n.drawImage(r,0,r.height/2,r.width,r.height/2,0,0,512,256),i&&i(t)},r.src=t}},{key:"getBackgroundCanvas",value:function(){var t=document.createElement("canvas"),n=(t.width=128,t.height=128,t.getContext("2d"));return n.rect(0,0,128,128),n.fillStyle=new N(this.Cn).getStyle(),n.fill(),t}}])&&lp(t.prototype,n),i&&lp(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,i})();function fp(t){return(fp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function hp(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=fp(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=fp(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==fp(t)?t:t+""))(i.key),i)}}var vp=(()=>{function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.Rr="FMFlowEffect",this.Dr=null,this.Fr=null,this.Cn=t.color,this.Nt=t.url,this.Lt=t.count,this.Mr=t.strength,this.yn=t.speed,null==this.yn&&(this.yn=0),this.Pr=t.direct,void 0===this.Pr&&(this.Pr="x")}return t=n,(e=[{key:"type",get:function(){return this.Rr}},{key:"direct",get:function(){return this.Pr},set:function(t){this.Pr=t}},{key:"speed",get:function(){return this.yn},set:function(t){this.yn=t}},{key:"add",value:function(t){if(Array.isArray(t))for(var n=0;n<t.length;n++)t[n].addEffect(this,this.Mr,this.Cn);else t.addEffect(this,this.Mr,this.Cn)}},{key:"remove",value:function(t){t.removeEffect(this)}},{key:"update",value:function(t){var n=t.getRenderNode().material,e=0,i=(1===(e=void 0!==this.Pr&&"y"===this.Pr?1:e)&&t.type!==T.WALL_MARKER&&(e=0),n.uniforms.direct&&n.uniforms.direct.value!==e&&(n.uniforms.direct.value=e),n.uniforms.repeat&&n.uniforms.repeat.value!==t.count&&(n.uniforms.repeat.value=t.count),this.yn);0===e&&(i=this.yn/t.count),n.uniforms.time&&(n.uniforms.time.value+=i/1e3)}},{key:"getMaterial",value:function(t,n){t.type===T.WALL_MARKER?new sp(this,t).init(function(t){n(t)}):t.type===T.TUBE_MARKER&&new cp(this,t).init(function(t){n(t)})}}])&&hp(t.prototype,e),i&&hp(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i})();function dp(t){return(dp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function mp(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=dp(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=dp(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==dp(t)?t:t+""))(i.key),i)}}var pp=(()=>{function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.Rr="FMDiffusion",this.Cn=t.color,this.Ir=t.maxScale,void 0===this.Ir&&(this.Ir=10),this.yn=t.speed,void 0===this.yn&&(this.yn=1),this.kr=!1,void 0!==this.Cn&&(this.kr=!0),this.Cr="\n            #include <common>\n            #include <logdepthbuf_pars_vertex>\n            varying vec3 vPosition;\n            varying vec3 vNormal;\n            varying vec2 vUv;\n\n            void main() {\n\n                vPosition =  vec3(modelMatrix * vec4( position, 1.0 ));\n                vNormal =  normal;\n                vUv = uv;\n                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n                #include <logdepthbuf_vertex>\n\n            }\n        ",this.Lr="\n            varying vec3 vPosition;\n            varying vec3 vNormal;\n            varying vec2 vUv;\n\n            uniform vec3 color;\n            uniform bool iscolor;\n            uniform float opacity;\n            uniform bool isTexture;\n            uniform sampler2D textureMap;\n            #include <logdepthbuf_pars_fragment>\n\n            void main() {\n                #include <logdepthbuf_fragment>\n\n                vec3 viewDir = normalize(cameraPosition - vPosition);\n\n                float res = max(dot(viewDir,vNormal),0.20);\n\n                float alpha = (1.0 - res);\n\n                alpha *= alpha;\n                if(!isTexture){\n                    gl_FragColor = 1.0*vec4(color, alpha * opacity);\n                } else {\n                    vec4 tex = texture2D( textureMap, vUv );\n                    if(!iscolor){\n                        gl_FragColor = 1.0*vec4(tex.rgb, alpha * opacity*tex.a);\n                    } else {\n                        gl_FragColor = 1.0*vec4(tex.rgb+color, alpha * opacity*tex.a);\n                    }\n                }\n            }\n        "}return t=n,(e=[{key:"type",get:function(){return this.Rr}},{key:"maxScale",get:function(){return this.Ir},set:function(t){this.Ir=t}},{key:"speed",get:function(){return this.yn},set:function(t){this.yn=t}},{key:"getMaterial",value:function(t,n){var e,i,r,o=this;void 0!==t.url?(e=t.url,i=function(t){t=new w(t),t=new R({uniforms:{color:{value:new N(o.Cn)},opacity:{value:1},textureMap:{value:t},isTexture:{value:!0},iscolor:{value:o.kr}},transparent:!0,depthTest:!0,depthWrite:!1,vertexShader:o.Cr,fragmentShader:o.Lr});n(t)},(r=new Image).crossOrigin="Anonymous",r.onload=function(){var t=document.createElement("canvas");t.width=512,t.height=512,t.getContext("2d").drawImage(r,0,0,512,512),i&&i(t)},r.src=e):(void 0===(e=this.Cn)&&(e=t.color),t=new R({uniforms:{color:{value:new N(e)},opacity:{value:1},texture:{value:null},isTexture:{value:!1},iscolor:{value:!0}},transparent:!0,depthTest:!0,depthWrite:!1,vertexShader:this.Cr,fragmentShader:this.Lr}),n(t))}},{key:"add",value:function(t){if(Array.isArray(t))for(var n=0;n<t.length;n++)t[n].addEffect(this);else t.addEffect(this)}},{key:"remove",value:function(t){t.removeEffect(this)}},{key:"update",value:function(t){var n=this.yn/60;t.scale.x+=n,t.scale.y+=n,t.scale.z+=n,t.scale.x>this.Ir-.4*this.Ir&&(t.material.uniforms.opacity.value-=.005),t.scale.x>this.Ir&&(t.scale.x=.1,t.scale.y=.1,t.scale.z=.1,t.material.uniforms.opacity.value=.8)}}])&&mp(t.prototype,e),i&&mp(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i})();function yp(t){return(yp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gp(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=yp(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=yp(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==yp(t)?t:t+""))(i.key),i)}}var bp=(()=>{function r(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:25e-5,e=this,i=r;if(!(e instanceof i))throw new TypeError("Cannot call a class as a function");this.isFogExp2=!0,this.name="",this.color=new N(t),this.density=n}return t=r,(n=[{key:"clone",value:function(){return new r(this.color,this.density)}},{key:"toJSON",value:function(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}])&&gp(t.prototype,n),e&&gp(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,e})();function _p(t){return(_p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wp(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=_p(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=_p(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==_p(t)?t:t+""))(i.key),i)}}var Sp=(()=>{function e(t,n){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.I=t,this.jr=(n=void 0===n?{}:n).color,void 0===this.jr&&(this.jr="#CCE0FF"),this.ct=n.density,void 0===this.ct&&(this.ct=25e-5),this.Te=!1,this.lt=null,this.ft=null,this.An=this.An.bind(this)}return t=e,(n=[{key:"color",get:function(){return this.jr},set:function(t){this.jr=t,this.Ur("color")}},{key:"density",get:function(){return this.ct},set:function(t){this.ct=t,this.Ur("density")}},{key:"enable",value:function(){this.Te=!0,this.ar(this.Te),this.I.on("update",this.An)}},{key:"disable",value:function(){this.Te=!1,this.ar(this.Te),this.I.off("update",this.An),this.ut(!1)}}])&&wp(t.prototype,n),i&&wp(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,i})(),xp=(Object.assign(Sp.prototype,{ar:function(t){var n=this,e=this.I.getRenderManager();"basic"===e.type&&this.I.setRenderManager(new gs(this.I)),t?null!==(e.fogEffect=this).lt?(e.renderScene.fog=this.lt.clone(),e.renderScene.background=this.ft.clone()):this.ze(function(t){t=new w(t);n.lt=new bp(new N(n.jr),n.ct),n.ft=t,e.renderScene.fog=new bp(new N(n.jr),n.ct),e.renderScene.background=t,n.I.enableUpdateRender()}):(e.fogEffect=null,e.renderScene.fog=null,e.renderScene.background=null,this.I.enableUpdateRender())},An:function(){this.ut(!0)},ze:function(e){var t,n,i,r,o=this,a=this.I.getMapOptions().container.style.backgroundImage;""===a?((t=document.createElement("canvas")).height=1024,t.width=1024,n=t.getContext("2d"),""!==(i=this.I.getMapOptions().container.style.backgroundColor)&&(n.fillStyle=i,n.fillRect(0,0,t.width,t.height)),n.globalAlpha=.8,n.fillStyle=this.jr,n.fillRect(0,0,t.width,t.height),e&&e(t)):(a=(a=a.substring(a.indexOf("(")+1,a.indexOf(")"))).replaceAll('"',""),(r=new Image).crossOrigin="Anonymous",r.onload=function(){var t=document.createElement("canvas"),n=(t.height=1024,t.width=1024,t.getContext("2d"));n.drawImage(r,0,0,t.width,t.height),n.globalAlpha=.8,n.fillStyle=o.jr,n.fillRect(0,0,t.width,t.height),e&&e(t)},r.src=a)},ut:function(t){for(var n=this.I.getVisibleLevels(),e=0;e<n.length;e++)for(var i=this.I.getFloor(n[e]).getLayers(T.MODEL_LAYER),r=0;r<i.length;r++)for(var o=i[r].scene.children,a=0;a<o.length;a++)o[a].mapNode&&o[a].mapNode.type===T.MODEL&&(t?o[a].material.polygonOffset||(o[a].material.polygonOffset=!0,o[a].material.polygonOffsetFactor=1,o[a].material.polygonOffsetUnits=4):(o[a].material.polygonOffset=!1,o[a].material.polygonOffsetFactor=0,o[a].material.polygonOffsetUnits=0));this.I.enableUpdateRender()},Ur:function(t){var n=this,e=this.I.getRenderManager();"density"===t?(e.renderScene.fog.density=this.ct,this.I.enableUpdateRender()):this.ze(function(t){t=new w(t);e.renderScene.fog.color=new N(n.jr),e.renderScene.background=t,n.I.enableUpdateRender()})}}),{defines:{MAX_STEP:0,PERSPECTIVE_CAMERA:!0,DISTANCE_ATTENUATION:!0,FRESNEL:!0,INFINITE_THICK:!1,SELECTIVE:!1},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tMetalness:{value:null},tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new B},cameraProjectionMatrix:{value:new C},cameraInverseProjectionMatrix:{value:new C},opacity:{value:.5},maxDistance:{value:180},cameraRange:{value:0},thickness:{value:.018}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}\n\n\t",fragmentShader:'\n\t\t// precision highp float;\n\t\tprecision highp sampler2D;\n\t\tvarying vec2 vUv;\n\t\tuniform sampler2D tDepth;\n\t\tuniform sampler2D tNormal;\n\t\tuniform sampler2D tMetalness;\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float cameraRange;\n\t\tuniform vec2 resolution;\n\t\tuniform float opacity;\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform float maxDistance;\n\t\tuniform float thickness;\n\t\tuniform mat4 cameraProjectionMatrix;\n\t\tuniform mat4 cameraInverseProjectionMatrix;\n\t\t#include <packing>\n\t\tfloat pointToLineDistance(vec3 x0, vec3 x1, vec3 x2) {\n\t\t\t//x0: point, x1: linePointA, x2: linePointB\n\t\t\t//https://mathworld.wolfram.com/Point-LineDistance3-Dimensional.html\n\t\t\treturn length(cross(x0-x1,x0-x2))/length(x2-x1);\n\t\t}\n\t\tfloat pointPlaneDistance(vec3 point,vec3 planePoint,vec3 planeNormal){\n\t\t\t// https://mathworld.wolfram.com/Point-PlaneDistance.html\n\t\t\t//// https://en.wikipedia.org/wiki/Plane_(geometry)\n\t\t\t//// http://paulbourke.net/geometry/pointlineplane/\n\t\t\tfloat a=planeNormal.x,b=planeNormal.y,c=planeNormal.z;\n\t\t\tfloat x0=point.x,y0=point.y,z0=point.z;\n\t\t\tfloat x=planePoint.x,y=planePoint.y,z=planePoint.z;\n\t\t\tfloat d=-(a*x+b*y+c*z);\n\t\t\tfloat distance=(a*x0+b*y0+c*z0+d)/sqrt(a*a+b*b+c*c);\n\t\t\treturn distance;\n\t\t}\n\t\tfloat getDepth( const in vec2 uv ) {\n\t\t\treturn texture2D( tDepth, uv ).x;\n\t\t}\n\t\tfloat getViewZ( const in float depth ) {\n\t\t\t#ifdef PERSPECTIVE_CAMERA\n\t\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#else\n\t\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#endif\n\t\t}\n\t\tvec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {\n\t\t\tvec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc\n\t\t\tclipPosition *= clipW; //clip\n\t\t\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;//view\n\t\t}\n\t\tvec3 getViewNormal( const in vec2 uv ) {\n\t\t\treturn unpackRGBToNormal( texture2D( tNormal, uv ).xyz );\n\t\t}\n\t\tvec2 viewPositionToXY(vec3 viewPosition){\n\t\t\tvec2 xy;\n\t\t\tvec4 clip=cameraProjectionMatrix*vec4(viewPosition,1);\n\t\t\txy=clip.xy;//clip\n\t\t\tfloat clipW=clip.w;\n\t\t\txy/=clipW;//NDC\n\t\t\txy=(xy+1.)/2.;//uv\n\t\t\txy*=resolution;//screen\n\t\t\treturn xy;\n\t\t}\n\t\tvoid main(){\n\t\t\t#ifdef SELECTIVE\n\t\t\t\tfloat metalness=texture2D(tMetalness,vUv).r;\n\t\t\t\tif(metalness==0.) return;\n\t\t\t#endif\n\n\t\t\tfloat depth = getDepth( vUv );\n\t\t\tfloat viewZ = getViewZ( depth );\n\t\t\tif(-viewZ>=cameraFar) return;\n\n\t\t\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ+cameraProjectionMatrix[3][3];\n\t\t\tvec3 viewPosition=getViewPosition( vUv, depth, clipW );\n\n\t\t\tvec2 d0=gl_FragCoord.xy;\n\t\t\tvec2 d1;\n\n\t\t\tvec3 viewNormal=getViewNormal( vUv );\n\n\t\t\t#ifdef PERSPECTIVE_CAMERA\n\t\t\t\tvec3 viewIncidentDir=normalize(viewPosition);\n\t\t\t\tvec3 viewReflectDir=reflect(viewIncidentDir,viewNormal);\n\t\t\t#else\n\t\t\t\tvec3 viewIncidentDir=vec3(0,0,-1);\n\t\t\t\tvec3 viewReflectDir=reflect(viewIncidentDir,viewNormal);\n\t\t\t#endif\n\n\t\t\tfloat maxReflectRayLen=maxDistance/dot(-viewIncidentDir,viewNormal);\n\t\t\t// dot(a,b)==length(a)*length(b)*cos(theta) // https://www.mathsisfun.com/algebra/vectors-dot-product.html\n\t\t\t// if(a.isNormalized&&b.isNormalized) dot(a,b)==cos(theta)\n\t\t\t// maxDistance/maxReflectRayLen=cos(theta)\n\t\t\t// maxDistance/maxReflectRayLen==dot(a,b)\n\t\t\t// maxReflectRayLen==maxDistance/dot(a,b)\n\n\t\t\tvec3 d1viewPosition=viewPosition+viewReflectDir*maxReflectRayLen;\n\t\t\t#ifdef PERSPECTIVE_CAMERA\n\t\t\t\tif(d1viewPosition.z>-cameraNear){\n\t\t\t\t\t//https://tutorial.math.lamar.edu/Classes/CalcIII/EqnsOfLines.aspx\n\t\t\t\t\tfloat t=(-cameraNear-viewPosition.z)/viewReflectDir.z;\n\t\t\t\t\td1viewPosition=viewPosition+viewReflectDir*t;\n\t\t\t\t}\n\t\t\t#endif\n\t\t\td1=viewPositionToXY(d1viewPosition);\n\n\t\t\tfloat totalLen=length(d1-d0);\n\t\t\tfloat xLen=d1.x-d0.x;\n\t\t\tfloat yLen=d1.y-d0.y;\n\t\t\tfloat totalStep=max(abs(xLen),abs(yLen));\n\t\t\tfloat xSpan=xLen/totalStep;\n\t\t\tfloat ySpan=yLen/totalStep;\n\t\t\tfor(float i=0.;i<float(MAX_STEP);i++){\n\t\t\t\tif(i>=totalStep) break;\n\t\t\t\tvec2 xy=vec2(d0.x+i*xSpan,d0.y+i*ySpan);\n\t\t\t\tif(xy.x<0.||xy.x>resolution.x||xy.y<0.||xy.y>resolution.y) break;\n\t\t\t\tfloat s=length(xy-d0)/totalLen;\n\t\t\t\tvec2 uv=xy/resolution;\n\n\t\t\t\tfloat d = getDepth(uv);\n\t\t\t\tfloat vZ = getViewZ( d );\n\t\t\t\tif(-vZ>=cameraFar) continue;\n\t\t\t\tfloat cW = cameraProjectionMatrix[2][3] * vZ+cameraProjectionMatrix[3][3];\n\t\t\t\tvec3 vP=getViewPosition( uv, d, cW );\n\n\t\t\t\t#ifdef PERSPECTIVE_CAMERA\n\t\t\t\t\t// https://comp.nus.edu.sg/~lowkl/publications/lowk_persp_interp_techrep.pdf\n\t\t\t\t\tfloat recipVPZ=1./viewPosition.z;\n\t\t\t\t\tfloat viewReflectRayZ=1./(recipVPZ+s*(1./d1viewPosition.z-recipVPZ));\n\t\t\t\t#else\n\t\t\t\t\tfloat viewReflectRayZ=viewPosition.z+s*(d1viewPosition.z-viewPosition.z);\n\t\t\t\t#endif\n\n\t\t\t\t// if(viewReflectRayZ>vZ) continue; // will cause "npm run make-screenshot webgl_postprocessing_ssr" high probability hang.\n\t\t\t\t// https://github.com/mrdoob/three.js/pull/21539#issuecomment-821061164\n\t\t\t\tif(viewReflectRayZ<=vZ){\n\n\t\t\t\t\tbool hit;\n\t\t\t\t\t#ifdef INFINITE_THICK\n\t\t\t\t\t\thit=true;\n\t\t\t\t\t#else\n\t\t\t\t\t\tfloat away=pointToLineDistance(vP,viewPosition,d1viewPosition);\n\n\t\t\t\t\t\tfloat minThickness;\n\t\t\t\t\t\tvec2 xyNeighbor=xy;\n\t\t\t\t\t\txyNeighbor.x+=1.;\n\t\t\t\t\t\tvec2 uvNeighbor=xyNeighbor/resolution;\n\t\t\t\t\t\tvec3 vPNeighbor=getViewPosition(uvNeighbor,d,cW);\n\t\t\t\t\t\tminThickness=vPNeighbor.x-vP.x;\n\t\t\t\t\t\tminThickness*=3.;\n\t\t\t\t\t\tfloat tk=max(minThickness,thickness);\n\n\t\t\t\t\t\thit=away<=tk;\n\t\t\t\t\t#endif\n\n\t\t\t\t\tif(hit){\n\t\t\t\t\t\tvec3 vN=getViewNormal( uv );\n\t\t\t\t\t\tif(dot(viewReflectDir,vN)>=0.) continue;\n\t\t\t\t\t\tfloat distance=pointPlaneDistance(vP,viewPosition,viewNormal);\n\t\t\t\t\t\tif(distance>maxDistance) break;\n\t\t\t\t\t\tfloat op=opacity;\n\t\t\t\t\t\t#ifdef DISTANCE_ATTENUATION\n\t\t\t\t\t\t\tfloat ratio=1.-(distance/maxDistance);\n\t\t\t\t\t\t\tfloat attenuation=ratio*ratio;\n\t\t\t\t\t\t\top=opacity*attenuation;\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#ifdef FRESNEL\n\t\t\t\t\t\t\tfloat fresnelCoe=(dot(viewIncidentDir,viewReflectDir)+1.)/2.;\n\t\t\t\t\t\t\top*=fresnelCoe;\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\tvec4 reflectColor=texture2D(tDiffuse,uv);\n\t\t\t\t\t\tgl_FragColor.xyz=reflectColor.xyz;\n\t\t\t\t\t\tgl_FragColor.a=op;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t'}),Ap={PERSPECTIVE_CAMERA:1},Ep={tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},Tp="\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}\n\n\t",Mp="\n\n\t\tuniform sampler2D tDepth;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tfloat getLinearDepth( const in vec2 uv ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\tfloat fragCoordZ = texture2D( tDepth, uv ).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn texture2D( tDepth, uv ).x;\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = getLinearDepth( vUv );\n\t\t\tfloat d = 1.0 - depth;\n\t\t\t// d=(d-.999)*1000.;\n\t\t\tgl_FragColor = vec4( vec3( d ), 1.0 );\n\n\t\t}\n\n\t",Pp={uniforms:{tDiffuse:{value:null},resolution:{value:new B},opacity:{value:.5}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}\n\n\t",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec2 resolution;\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\t//reverse engineering from PhotoShop blur filter, then change coefficient\n\n\t\t\tvec2 texelSize = ( 1.0 / resolution );\n\n\t\t\tvec4 c=texture2D(tDiffuse,vUv);\n\n\t\t\tvec2 offset;\n\n\t\t\toffset=(vec2(-1,0))*texelSize;\n\t\t\tvec4 cl=texture2D(tDiffuse,vUv+offset);\n\n\t\t\toffset=(vec2(1,0))*texelSize;\n\t\t\tvec4 cr=texture2D(tDiffuse,vUv+offset);\n\n\t\t\toffset=(vec2(0,-1))*texelSize;\n\t\t\tvec4 cb=texture2D(tDiffuse,vUv+offset);\n\n\t\t\toffset=(vec2(0,1))*texelSize;\n\t\t\tvec4 ct=texture2D(tDiffuse,vUv+offset);\n\n\t\t\t// float coeCenter=.5;\n\t\t\t// float coeSide=.125;\n\t\t\tfloat coeCenter=.2;\n\t\t\tfloat coeSide=.2;\n\t\t\tfloat a=c.a*coeCenter+cl.a*coeSide+cr.a*coeSide+cb.a*coeSide+ct.a*coeSide;\n\t\t\tvec3 rgb=(c.rgb*c.a*coeCenter+cl.rgb*cl.a*coeSide+cr.rgb*cr.a*coeSide+cb.rgb*cb.a*coeSide+ct.rgb*ct.a*coeSide)/a;\n\t\t\tgl_FragColor=vec4(rgb,a);\n\n\t\t}\n\t"};function Op(t){return(Op="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Np(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Op(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Op(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Op(t)?t:t+""))(i.key),i)}}function Cp(t,n,e){n=Rp(n);var i=t,n=Lp()?Reflect.construct(n,e||[],Rp(t).constructor):n.apply(t,e);if(!n||"object"!=Op(n)&&"function"!=typeof n){if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(n=i))throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return n}function Lp(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Lp=function(){return!!t})()}function Rp(t){return(Rp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Dp(t,n){return(Dp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Fp=(()=>{function l(t){var n,e=t.renderer,i=t.scene,r=t.camera,o=t.width,a=t.height,s=t.selects,u=t.bouncing,u=void 0!==u&&u,t=t.groundReflector;if(!(this instanceof l))throw new TypeError("Cannot call a class as a function");(n=Cp(this,l)).width=void 0!==o?o:512,n.height=void 0!==a?a:512,n.clear=!0,n.renderer=e,n.scene=i,n.camera=r,n.groundReflector=t,n.opacity=xp.uniforms.opacity.value,n.output=0,n.maxDistance=xp.uniforms.maxDistance.value,n.thickness=xp.uniforms.thickness.value,n.tempColor=new N,n.Br=s,n.selective=Array.isArray(n.Br),Object.defineProperty(n,"selects",{get:function(){return this.Br},set:function(t){this.Br!==t&&(this.Br=t,Array.isArray(t)?(this.selective=!0,this.ssrMaterial.defines.SELECTIVE=!0):(this.selective=!1,this.ssrMaterial.defines.SELECTIVE=!1),this.ssrMaterial.needsUpdate=!0)}}),n.Hr=u,Object.defineProperty(n,"bouncing",{get:function(){return this.Hr},set:function(t){this.Hr!==t&&(this.Hr=t,this.ssrMaterial.uniforms.tDiffuse.value=(t?this.prevRenderTarget:this.beautyRenderTarget).texture)}}),n.blur=!0,n.Vr=xp.defines.DISTANCE_ATTENUATION,Object.defineProperty(n,"distanceAttenuation",{get:function(){return this.Vr},set:function(t){this.Vr!==t&&(this.Vr=t,this.ssrMaterial.defines.DISTANCE_ATTENUATION=t,this.ssrMaterial.needsUpdate=!0)}}),n.zr=xp.defines.SSR,Object.defineProperty(n,"fresnel",{get:function(){return this.zr},set:function(t){this.zr!==t&&(this.zr=t,this.ssrMaterial.defines.FRESNEL=t,this.ssrMaterial.needsUpdate=!0)}}),n.Gr=xp.defines.INFINITE_THICK,Object.defineProperty(n,"infiniteThick",{get:function(){return this.Gr},set:function(t){this.Gr!==t&&(this.Gr=t,this.ssrMaterial.defines.INFINITE_THICK=t,this.ssrMaterial.needsUpdate=!0)}});o=new Gh;return o.type=1012,o.minFilter=m,n.beautyRenderTarget=new D(n.width,n.height,{minFilter:o.magFilter=m,magFilter:m,depthTexture:o,depthBuffer:!0}),n.prevRenderTarget=new D(n.width,n.height,{minFilter:m,magFilter:m}),n.normalRenderTarget=new D(n.width,n.height,{minFilter:m,magFilter:m,type:Z}),n.metalnessRenderTarget=new D(n.width,n.height,{minFilter:m,magFilter:m}),n.ssrRenderTarget=new D(n.width,n.height,{minFilter:m,magFilter:m}),n.blurRenderTarget=n.ssrRenderTarget.clone(),n.blurRenderTarget2=n.ssrRenderTarget.clone(),n.ssrMaterial=new R({defines:Object.assign({},xp.defines,{MAX_STEP:Math.sqrt(n.width*n.width+n.height*n.height)}),uniforms:L.clone(xp.uniforms),vertexShader:xp.vertexShader,fragmentShader:xp.fragmentShader,blending:0}),n.ssrMaterial.uniforms.tDiffuse.value=n.beautyRenderTarget.texture,n.ssrMaterial.uniforms.tNormal.value=n.normalRenderTarget.texture,n.ssrMaterial.defines.SELECTIVE=n.selective,n.ssrMaterial.needsUpdate=!0,n.ssrMaterial.uniforms.tMetalness.value=n.metalnessRenderTarget.texture,n.ssrMaterial.uniforms.tDepth.value=n.beautyRenderTarget.depthTexture,n.ssrMaterial.uniforms.cameraNear.value=n.camera.near,n.ssrMaterial.uniforms.cameraFar.value=n.camera.far,n.ssrMaterial.uniforms.thickness.value=n.thickness,n.ssrMaterial.uniforms.resolution.value.set(n.width,n.height),n.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(n.camera.projectionMatrix),n.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(n.camera.projectionMatrixInverse),n.normalMaterial=new Kh,n.normalMaterial.blending=0,n.metalnessOnMaterial=new b({color:"white"}),n.metalnessOffMaterial=new b({color:"black"}),n.blurMaterial=new R({defines:Object.assign({},Pp.defines),uniforms:L.clone(Pp.uniforms),vertexShader:Pp.vertexShader,fragmentShader:Pp.fragmentShader}),n.blurMaterial.uniforms.tDiffuse.value=n.ssrRenderTarget.texture,n.blurMaterial.uniforms.resolution.value.set(n.width,n.height),n.blurMaterial2=new R({defines:Object.assign({},Pp.defines),uniforms:L.clone(Pp.uniforms),vertexShader:Pp.vertexShader,fragmentShader:Pp.fragmentShader}),n.blurMaterial2.uniforms.tDiffuse.value=n.blurRenderTarget.texture,n.blurMaterial2.uniforms.resolution.value.set(n.width,n.height),n.depthRenderMaterial=new R({defines:Object.assign({},Ap),uniforms:L.clone(Ep),vertexShader:Tp,fragmentShader:Mp,blending:0}),n.depthRenderMaterial.uniforms.tDepth.value=n.beautyRenderTarget.depthTexture,n.depthRenderMaterial.uniforms.cameraNear.value=n.camera.near,n.depthRenderMaterial.uniforms.cameraFar.value=n.camera.far,n.copyMaterial=new R({uniforms:L.clone(Ko.uniforms),vertexShader:Ko.vertexShader,fragmentShader:Ko.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:204,blendDst:205,blendEquation:100,blendSrcAlpha:204,blendDstAlpha:205,blendEquationAlpha:100}),n.fsQuad=new h.FullScreenQuad(null),n.originalClearColor=new N,n}var t,n=l,e=h;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Dp(n,e),n=l,(e=[{key:"dispose",value:function(){this.beautyRenderTarget.dispose(),this.prevRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.metalnessRenderTarget.dispose(),this.ssrRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.blurRenderTarget2.dispose(),this.normalMaterial.dispose(),this.metalnessOnMaterial.dispose(),this.metalnessOffMaterial.dispose(),this.blurMaterial.dispose(),this.blurMaterial2.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}},{key:"render",value:function(t,n){switch(t.setRenderTarget(this.beautyRenderTarget),t.clear(),this.groundReflector&&(this.groundReflector.visible=!1,this.groundReflector.doRender(this.renderer,this.scene,this.camera),this.groundReflector.visible=!0),t.render(this.scene,this.camera),this.groundReflector&&(this.groundReflector.visible=!1),this.renderOverride(t,this.normalMaterial,this.normalRenderTarget,0,0),this.selective&&this.renderMetalness(t,this.metalnessOnMaterial,this.metalnessRenderTarget,0,0),this.ssrMaterial.uniforms.opacity.value=this.opacity,this.ssrMaterial.uniforms.maxDistance.value=this.maxDistance,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.renderPass(t,this.ssrMaterial,this.ssrRenderTarget),this.blur&&(this.renderPass(t,this.blurMaterial,this.blurRenderTarget),this.renderPass(t,this.blurMaterial2,this.blurRenderTarget2)),this.output){case l.OUTPUT.Default:this.bouncing?(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(t,this.copyMaterial,this.prevRenderTarget),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=1,this.renderPass(t,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture,this.copyMaterial.blending=0):(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:n),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=1),this.renderPass(t,this.copyMaterial,this.renderToScreen?null:n);break;case l.OUTPUT.SSR:this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:n),this.bouncing&&(this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(t,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=1,this.renderPass(t,this.copyMaterial,this.prevRenderTarget));break;case l.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:n);break;case l.OUTPUT.Depth:this.renderPass(t,this.depthRenderMaterial,this.renderToScreen?null:n);break;case l.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:n);break;case l.OUTPUT.Metalness:this.copyMaterial.uniforms.tDiffuse.value=this.metalnessRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:n);break;default:console.warn("THREE.SSRPass: Unknown output type.")}}},{key:"renderPass",value:function(t,n,e,i,r){this.originalClearColor.copy(t.getClearColor(this.tempColor));var o=t.getClearAlpha(this.tempColor),a=t.autoClear;t.setRenderTarget(e),t.autoClear=!1,null!=i&&(t.setClearColor(i),t.setClearAlpha(r||0),t.clear()),this.fsQuad.material=n,this.fsQuad.render(t),t.autoClear=a,t.setClearColor(this.originalClearColor),t.setClearAlpha(o)}},{key:"renderOverride",value:function(t,n,e,i,r){this.originalClearColor.copy(t.getClearColor(this.tempColor));var o=t.getClearAlpha(this.tempColor),a=t.autoClear;t.setRenderTarget(e),t.autoClear=!1,i=n.clearColor||i,r=n.clearAlpha||r,null!=i&&(t.setClearColor(i),t.setClearAlpha(r||0),t.clear()),this.scene.overrideMaterial=n,t.render(this.scene,this.camera),this.scene.overrideMaterial=null,t.autoClear=a,t.setClearColor(this.originalClearColor),t.setClearAlpha(o)}},{key:"renderMetalness",value:function(t,n,e,i,r){var o=this,a=(this.originalClearColor.copy(t.getClearColor(this.tempColor)),t.getClearAlpha(this.tempColor)),s=t.autoClear;t.setRenderTarget(e),t.autoClear=!1,i=n.clearColor||i,r=n.clearAlpha||r,null!=i&&(t.setClearColor(i),t.setClearAlpha(r||0),t.clear()),this.scene.traverseVisible(function(t){t.Xr=t.material,o.Br.includes(t)?t.material=o.metalnessOnMaterial:t.material=o.metalnessOffMaterial}),t.render(this.scene,this.camera),this.scene.traverseVisible(function(t){t.material=t.Xr}),t.autoClear=s,t.setClearColor(this.originalClearColor),t.setClearAlpha(a)}},{key:"setSize",value:function(t,n){this.width=t,this.height=n,this.ssrMaterial.defines.MAX_STEP=Math.sqrt(t*t+n*n),this.ssrMaterial.needsUpdate=!0,this.beautyRenderTarget.setSize(t,n),this.prevRenderTarget.setSize(t,n),this.ssrRenderTarget.setSize(t,n),this.normalRenderTarget.setSize(t,n),this.metalnessRenderTarget.setSize(t,n),this.blurRenderTarget.setSize(t,n),this.blurRenderTarget2.setSize(t,n),this.ssrMaterial.uniforms.resolution.value.set(t,n),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(t,n),this.blurMaterial2.uniforms.resolution.value.set(t,n)}}])&&Np(n.prototype,e),t&&Np(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n})();function Ip(t,n){return(t=>{if(Array.isArray(t))return t})(t)||((t,n)=>{var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var i,r,o,a,s=[],u=!0,l=!1;try{if(o=(e=e.call(t)).next,0===n){if(Object(e)!==e)return;u=!1}else for(;!(u=(i=o.call(e)).done)&&(s.push(i.value),s.length!==n);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=e.return&&(a=e.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}})(t,n)||jp(t,n)||(()=>{throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")})()}function kp(t,n){var e,i,r,o,a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(a)return r=!(i=!0),{s:function(){a=a.call(t)},n:function(){var t=a.next();return i=t.done,t},e:function(t){r=!0,e=t},f:function(){try{i||null==a.return||a.return()}finally{if(r)throw e}}};if(Array.isArray(t)||(a=jp(t))||n&&t&&"number"==typeof t.length)return a&&(t=a),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function jp(t,n){var e;if(t)return"string"==typeof t?Up(t,n):"Map"===(e="Object"===(e={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Up(t,n):void 0}function Up(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=Array(n);e<n;e++)i[e]=t[e];return i}function Bp(t){return(Bp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Hp(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(t=>(t=((t,n)=>{if("object"!=Bp(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);if("object"!=Bp(e=e.call(t,n||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")})(t,"string"),"symbol"==Bp(t)?t:t+""))(i.key),i)}}Fp.OUTPUT={Default:0,SSR:1,Beauty:3,Depth:4,Normal:5,Metalness:7};var Vp=(()=>{function e(t,n){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.I=t,this.Yr=n.targets,void 0===this.Yr&&(this.Yr=[]),this.Wr=n.reflectivity,void 0===this.Wr&&(this.Wr=.5),this.Qr=n.maxDistance,void 0===this.Qr&&(this.Qr=30),this.Ht=null,this.U=null,this.qr=null,this.Zr=new l,this.Jr=new l,this._t=null,this.wt=null,this.St=null,this.Kr=null,this.$r=new Map,this.no=new Map,this.no.set("0",new b({color:new N(0,0,0)})),this.no.set("0.1",new b({color:new N(.1,0,0)})),this.no.set("0.2",new b({color:new N(.2,0,0)})),this.no.set("0.3",new b({color:new N(.3,0,0)})),this.no.set("0.4",new b({color:new N(.4,0,0)})),this.no.set("0.5",new b({color:new N(.5,0,0)})),this.no.set("0.6",new b({color:new N(.6,0,0)})),this.no.set("0.7",new b({color:new N(.7,0,0)})),this.no.set("0.8",new b({color:new N(.8,0,0)})),this.no.set("0.9",new b({color:new N(.9,0,0)})),this.no.set("1",new b({color:new N(1,0,0)})),this.eo=new Map,this.eo.set("0",new b({color:new N(0,0,0)})),this.eo.set("0.1",new b({color:new N(.1,0,0)})),this.eo.set("0.2",new b({color:new N(.2,0,0)})),this.eo.set("0.3",new b({color:new N(.3,0,0)})),this.eo.set("0.4",new b({color:new N(.4,0,0)})),this.eo.set("0.5",new b({color:new N(.5,0,0)})),this.eo.set("0.6",new b({color:new N(.6,0,0)})),this.eo.set("0.7",new b({color:new N(.7,0,0)})),this.eo.set("0.8",new b({color:new N(.8,0,0)})),this.eo.set("0.9",new b({color:new N(.9,0,0)})),this.eo.set("1",new b({color:new N(1,0,0)})),this.io=new b({color:"white"}),this.ro=new b({color:"white"}),this.oo=new b({color:"black"}),this.J={},this.Pt=null,this.G(),this.ao()}return t=e,(n=[{key:"add",value:function(t,n,e){var i=this;if(Array.isArray(t))for(var r=0;r<t.length;r++)(t[r].isLayer?o:a)(t[r]);else(t.isLayer?o:a)(t);function o(t){for(var n=0;n<t.children.length;n++)a(t.children[n])}function a(t){i.$r.set(t.FID+"%a%b%c"+t.level,{node:t,reflectivity:n,reflectSetInfo:e})}this.I.enableUpdateRender()}},{key:"remove",value:function(t){var n=[];if(Array.isArray(t))for(var e=0;e<t.length;e++)n.push(t[e]);else n.push(t);for(var i=0;i<n.length;i++)if(n[i].isLayer)for(var r=n[i].children,o=0;o<r.length;o++)this.$r.delete(r[o].FID+"%a%b%c"+r[o].level);else this.$r.delete(n[i].FID+"%a%b%c"+n[i].level);this.I.enableUpdateRender()}},{key:"enable",value:function(){(this.Ht.reflect=this).I.enableUpdateRender()}},{key:"disable",value:function(){this.Ht.reflect=null,this.I.enableUpdateRender()}},{key:"clear",value:function(){this.$r.clear(),this.I.enableUpdateRender()}},{key:"getMaxDistance",value:function(){return this.Qr}},{key:"setMaxDistance",value:function(t){this.Qr=t,this.qr.maxDistance=this.Qr,this.I.enableUpdateRender()}}])&&Hp(t.prototype,n),i&&Hp(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,i})();Object.assign(Vp.prototype,{G:function(){"basic"===this.I.getRenderManager().type&&this.I.setRenderManager(new gs(this.I)),this.Ht=this.I.getRenderManager(),this.At();var t=this.Ht.getRenderer(),n=this.Zr,e=this.I.camera;this.Ht=this.I.getRenderManager(),this.U=new Ra(this.Ht.getRenderer()),this.U.renderToScreen=!1,this.qr=new Fp({renderer:t,scene:n,camera:e,width:this.I.getContainer().clientWidth,height:this.I.getContainer().clientHeight}),this.qr.FRESNEL=!1,this.qr.output=Fp.OUTPUT.Default,this.qr.maxDistance=this.Qr,this.U.addPass(this.qr),this.V=this.V.bind(this),this._e=this._e.bind(this),this.I.on("resize",this.V),this.I.on("viewModeChanged",this._e)},ao:function(){this.Pt=new Ra(this.Ht.getRenderer()),this.Pt.renderToScreen=!1;var t=new f(this.Jr,this.I.camera,null,16777215,1);this.Pt.addPass(t)},At:function(){var t=this.Ht.effectTool;this._t=t._t.clone(),this._t.start_y=t._t.start_y,this.wt=t.wt.clone(),this.wt.start_y=t.wt.start_y,this.St=t.wt.clone(),this.St.start_y=t.wt.start_y,this.Kr=t.xt.clone(),this.Kr.start_y=t.xt.start_y,this.wt.target=this.Kr,this.St.target=this.Kr,this.Zr.add(this._t),this.Zr.add(this.wt),this.Zr.add(this.St),this.Zr.add(this.Kr)},X:function(){var t,n=this.I.getFloor(this.I.getLevel()),e=(this.Zr.position.y=this.I.getFloor(this.I.getLevel()).height,this.Jr.position.y=this.I.getFloor(this.I.getLevel()).height,kp(this.$r));try{for(e.s();!(t=e.n()).done;){var i=Ip(t.value,2),r=i[0],o=i[1],a=r.split("%a%b%c")[1],s=o.node;s.getRenderNode()&&""+a==""+this.I.getLevel()&&this.Zr.add(s.getRenderNode())}}catch(t){e.e(t)}finally{e.f()}this.U.render();var u,l=kp(this.$r);try{for(l.s();!(u=l.n()).done;){var c=Ip(u.value,2),f=c[0],h=c[1],v=f.split("%a%b%c")[1],d=h.node;d.getRenderNode()&&""+v==""+this.I.getLevel()&&d.parent.scene.add(d.getRenderNode())}}catch(t){l.e(t)}finally{l.f()}for(var m=n.getLayers(T.EXTERNAL_MODEL_LAYER|T.DYNAMIC_MODEL_MARKER),p=0;p<m.length;p++)for(var y=m[p].children,g=0;g<y.length;g++){var b,_,w=y[g].getRenderNode();w&&(b=this.Wr,(_=this.$r.get(y[g].FID+"%a%b%c"+y[g].level))?(b=1-(b=void 0!==_.reflectivity?_.reflectivity:b),b=Math.floor(10*b)/10,y[g].isGltf||y[g].type===T.DYNAMIC_MODEL_MARKER?this.ht(w,b,!1,!1,_.reflectSetInfo):this.so(w,b,_.reflectSetInfo)):this.ht(w,b,!0,!1),this.Jr.add(w))}this.Pt.render();for(var S=0;S<m.length;S++)for(var x=m[S].children,A=0;A<x.length;A++){var E=x[A].getRenderNode();E&&(this.ht(E,null,!1,!0),x[A].parent.scene.add(E))}},so:function(t,n,e){var i=null;if(Array.isArray(t.material))for(var i=[],r=0;r<t.material.length;r++){var o=n;e&&(o=this.uo(e,t.material[r].name,n)),i.push(this.no.get(""+o))}else{var a=n;e&&(a=this.uo(e,t.material.name,n)),i=this.no.get(""+a)}this.J[t.uuid]=t.material,t.material=i},ht:function(t,n,e,i,r){"Mesh"!==t.type&&"SkinnedMesh"!==t.type||(i?(t.material=this.J[t.uuid],delete this.J[t.uuid]):(r&&(this.I.getMapOptions().shadingMode===fengmap.FMShadingMode.REAL?t.material.uniforms&&t.material.uniforms.map&&t.material.uniforms.map.value&&(n=this.uo(r,t.material.uniforms.map.value.name,n)):t.material.map&&(n=this.uo(r,t.material.map.name,n))),this.J[t.uuid]=t.material,e?"SkinnedMesh"===t.type?t.material=this.ro:t.material=this.io:"SkinnedMesh"===t.type?t.material=this.eo.get(""+n):t.material=this.no.get(""+n)));for(var o=t.children,a=0;a<o.length;a++)this.ht(o[a],n,e,i,r)},uo:function(t,n,e){for(var i=null,r=0;r<t.length;r++)if(n===t[r].textureName){i=t[r].reflectivity;break}return i=null!==i?(i=1-i,Math.floor(10*i)/10):e},V:function(){var t,n;this.U&&(t=(n=this.I.getContainer()).clientWidth,this.U.setSize(t,n=n.clientHeight),this.qr.setSize(t,n),this.Pt.setSize(t,n),this.I.enableUpdateRender())},_e:function(){for(var t=0;t<this.Pt.passes.length;t++)this.Pt.passes[t].constructor===f&&this.Pt.passes[t].setPass(this.Jr,this.I.camera);this.qr.camera=this.I.camera}});var zp,Gp={FMParticle:t,FMRain:e,FMSky:au,FMTextureBasedSkybox:rm,FMWater:Of,FMBloom:$f,FMOutline:Mh,FMSweep:Nh,FMSAO:uv,FMFlowline:Mv,FMFireMarker:Fv,FMFlow:vp,FMDiffusion:pp,FMFog:Sp,FMHDR:n,FMReflect:Vp};for(zp in Gp)window.fengmap[zp]=Gp[zp];x.default=fengmap}],i={},r.m=e,r.c=i,r.d=function(t,n,e){r.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"lo",{value:!0})},r.t=function(n,t){if(1&t&&(n=r(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.lo)return n;var e=Object.create(null);if(r.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var i in n)r.d(e,i,function(t){return n[t]}.bind(null,i));return e},r.n=function(t){var n=t&&t.lo?function(){return t.default}:function(){return t};return r.d(n,"a",n),n},r.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},r.p="",r(r.s=0).default;function r(t){var n;return(i[t]||(n=i[t]={i:t,l:!1,exports:{}},e[t].call(n.exports,n,n.exports,r),n.l=!0,n)).exports}var e,i});