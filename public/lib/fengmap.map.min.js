/**Released Version v3.1.7,BUILD 62,Time 1719469114765. Fengmap Javascript SDK , see: https://www.fengmap.com for details**/
!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.fengmap=n():t.fengmap=n()}(this,function(){return function(e){var i={};function r(t){var n;return(i[t]||(n=i[t]={i:t,l:!1,exports:{}},e[t].call(n.exports,n,n.exports,r),n.l=!0,n)).exports}return r.m=e,r.c=i,r.d=function(t,n,e){r.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},r.t=function(n,t){if(1&t&&(n=r(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.u)return n;var e=Object.create(null);if(r.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var i in n)r.d(e,i,function(t){return n[t]}.bind(null,i));return e},r.n=function(t){var n=t&&t.u?function(){return t.default}:function(){return t};return r.d(n,"a",n),n},r.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},r.p="",r(r.s=47)}([function(t,n,e){"use strict";e.d(n,"a",function(){return i});var n=e(1),i={document:"undefined"!=typeof document?document:{},window:"undefined"!=typeof window?window:{},environment:n.a.BROWSER,XMLHttpRequest:"undefined"!=typeof XMLHttpRequest?XMLHttpRequest:{}}},function(t,n,e){"use strict";var i={BROWSER:0,WX:1};Object.freeze(i),n.a=i},function(t,n,e){"use strict";var i,r,o=t.exports=e(4),s=e(19),a=(o.codegen=e(44),o.fetch=e(45),o.path=e(46),o.fs=o.inquire("fs"),o.toArray=function(t){if(t){for(var n=Object.keys(t),e=new Array(n.length),i=0;i<n.length;)e[i]=t[n[i++]];return e}return[]},o.toObject=function(t){for(var n={},e=0;e<t.length;){var i=t[e++],r=t[e++];void 0!==r&&(n[i]=r)}return n},/\\/g),u=/"/g,c=(o.isReserved=function(t){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(t)},o.safeProp=function(t){return!/^[$\w_]+$/.test(t)||o.isReserved(t)?'["'+t.replace(a,"\\\\").replace(u,'\\"')+'"]':"."+t},o.ucFirst=function(t){return t.charAt(0).toUpperCase()+t.substring(1)},/_([a-z])/g),f=(o.camelCase=function(t){return t.substring(0,1)+t.substring(1).replace(c,function(t,n){return n.toUpperCase()})},o.compareFieldsById=function(t,n){return t.id-n.id},o.decorateType=function(t,n){return t.$type?(n&&t.$type.name!==n&&(o.decorateRoot.remove(t.$type),t.$type.name=n,o.decorateRoot.add(t.$type)),t.$type):(n=new(i=i||e(21))(n||t.name),o.decorateRoot.add(n),n.ctor=t,Object.defineProperty(t,"$type",{value:n,enumerable:!1}),Object.defineProperty(t.prototype,"$type",{value:n,enumerable:!1}),n)},0);o.decorateEnum=function(t){var n;return t.$type||(n=new(r=r||e(5))("Enum"+f++,t),o.decorateRoot.add(n),Object.defineProperty(t,"$type",{value:n,enumerable:!1}),n)},o.setProperty=function(t,n,e){if("object"!=typeof t)throw TypeError("dst must be an object");if(n)return function t(n,e,i){var r=e.shift();return"__proto__"!==r&&"prototype"!==r&&(0<e.length?n[r]=t(n[r]||{},e,i):((e=n[r])&&(i=[].concat(e).concat(i)),n[r]=i)),n}(t,n=n.split("."),e);throw TypeError("path must be specified")},Object.defineProperty(o,"decorateRoot",{get:function(){return s.decorated||(s.decorated=new(e(29)))}})},function(t,n,e){"use strict";!function(s){var a=e(1),u=e(0);function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=r(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=r(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==r(t)?t:String(t)}(i.key),i)}}var f=null,t=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")}var n,e,i,r;function o(){return r.apply(this,arguments)}return n=t,e=null,i=[{key:"global",value:(r=function(){if("undefined"!=typeof self&&null!==self&&0!==Object.keys(self).length)return self;if("undefined"!=typeof window&&null!==window&&0!==Object.keys(window).length)return window;if(null!=s&&0!==Object.keys(s).length)return s;var t;if("undefined"!=typeof my)return f||(t=my.getAppIdSync(),f={location:{host:t.appId+".hybrid.alipay-eco.com"}}),f;if(u.a.environment==a.a.WX)return{};throw new Error("unable to locate global object")},o.toString=function(){return r.toString()},o)}],e&&c(n.prototype,e),i&&c(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}();n.a=t}.call(this,e(15))},function(t,e,o){"use strict";!function(t){var i=e;function r(t,n,e){for(var i=Object.keys(n),r=0;r<i.length;++r)void 0!==t[i[r]]&&e||(t[i[r]]=n[i[r]]);return t}function n(t){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&r(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e}i.asPromise=o(16),i.base64=o(35),i.EventEmitter=o(36),i.float=o(37),i.inquire=o(17),i.utf8=o(38),i.pool=o(39),i.LongBits=o(40),i.isNode=Boolean(void 0!==t&&t&&t.process&&t.process.versions&&t.process.versions.node),i.global=i.isNode&&t||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,i.emptyArray=Object.freeze?Object.freeze([]):[],i.emptyObject=Object.freeze?Object.freeze({}):{},i.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},i.isString=function(t){return"string"==typeof t||t instanceof String},i.isObject=function(t){return t&&"object"==typeof t},i.isset=i.isSet=function(t,n){var e=t[n];return!(null==e||!t.hasOwnProperty(n))&&("object"!=typeof e||0<(Array.isArray(e)?e:Object.keys(e)).length)},i.Buffer=function(){try{var t=i.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),i._=null,i.S=null,i.newBuffer=function(t){return"number"==typeof t?i.Buffer?i.S(t):new i.Array(t):i.Buffer?i._(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},i.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,i.Long=i.global.dcodeIO&&i.global.dcodeIO.Long||i.global.Long||i.inquire("long"),i.key2Re=/^true|false|0|1$/,i.key32Re=/^-?(?:0|[1-9][0-9]*)$/,i.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,i.longToHash=function(t){return t?i.LongBits.from(t).toHash():i.LongBits.zeroHash},i.longFromHash=function(t,n){t=i.LongBits.fromHash(t);return i.Long?i.Long.fromBits(t.lo,t.hi,n):t.toNumber(Boolean(n))},i.merge=r,i.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},i.newError=n,i.ProtocolError=n("ProtocolError"),i.oneOfGetter=function(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;-1<n;--n)if(1===e[t[n]]&&void 0!==this[t[n]]&&null!==this[t[n]])return t[n]}},i.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},i.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},i.T=function(){var e=i.Buffer;e?(i._=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},i.S=e.allocUnsafe||function(t){return new e(t)}):i._=i.S=null}}.call(this,o(15))},function(t,n,e){"use strict";t.exports=o;var a=e(6),i=(((o.prototype=Object.create(a.prototype)).constructor=o).className="Enum",e(8)),r=e(2);function o(t,n,e,i,r){if(a.call(this,t,e),n&&"object"!=typeof n)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=r||{},this.reserved=void 0,n)for(var o=Object.keys(n),s=0;s<o.length;++s)"number"==typeof n[o[s]]&&(this.valuesById[this.values[o[s]]=n[o[s]]]=o[s])}o.fromJSON=function(t,n){t=new o(t,n.values,n.options,n.comment,n.comments);return t.reserved=n.reserved,t},o.prototype.toJSON=function(t){t=!!t&&Boolean(t.keepComments);return r.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},o.prototype.add=function(t,n,e){if(!r.isString(t))throw TypeError("name must be a string");if(!r.isInteger(n))throw TypeError("id must be an integer");if(void 0!==this.values[t])throw Error("duplicate name '"+t+"' in "+this);if(this.isReservedId(n))throw Error("id "+n+" is reserved in "+this);if(this.isReservedName(t))throw Error("name '"+t+"' is reserved in "+this);if(void 0!==this.valuesById[n]){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+n+" in "+this);this.values[t]=n}else this.valuesById[this.values[t]=n]=t;return this.comments[t]=e||null,this},o.prototype.remove=function(t){if(!r.isString(t))throw TypeError("name must be a string");var n=this.values[t];if(null==n)throw Error("name '"+t+"' does not exist in "+this);return delete this.valuesById[n],delete this.values[t],delete this.comments[t],this},o.prototype.isReservedId=function(t){return i.isReservedId(this.reserved,t)},o.prototype.isReservedName=function(t){return i.isReservedName(this.reserved,t)}},function(t,n,e){"use strict";(t.exports=r).className="ReflectionObject";var i,s=e(2);function r(t,n){if(!s.isString(t))throw TypeError("name must be a string");if(n&&!s.isObject(n))throw TypeError("options must be an object");this.options=n,this.parsedOptions=null,this.name=t,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(r.prototype,{root:{get:function(){for(var t=this;null!==t.parent;)t=t.parent;return t}},fullName:{get:function(){for(var t=[this.name],n=this.parent;n;)t.unshift(n.name),n=n.parent;return t.join(".")}}}),r.prototype.toJSON=function(){throw Error()},r.prototype.onAdd=function(t){this.parent&&this.parent!==t&&this.parent.remove(this),this.parent=t,this.resolved=!1;t=t.root;t instanceof i&&t.A(this)},r.prototype.onRemove=function(t){t=t.root;t instanceof i&&t.M(this),this.parent=null,this.resolved=!1},r.prototype.resolve=function(){return this.resolved||this.root instanceof i&&(this.resolved=!0),this},r.prototype.getOption=function(t){if(this.options)return this.options[t]},r.prototype.setOption=function(t,n,e){return e&&this.options&&void 0!==this.options[t]||((this.options||(this.options={}))[t]=n),this},r.prototype.setParsedOption=function(n,t,e){this.parsedOptions||(this.parsedOptions=[]);var i,r,o=this.parsedOptions;return e?(i=o.find(function(t){return Object.prototype.hasOwnProperty.call(t,n)}))?(r=i[n],s.setProperty(r,e,t)):((i={})[n]=s.setProperty({},e,t),o.push(i)):((r={})[n]=t,o.push(r)),this},r.prototype.setOptions=function(t,n){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)this.setOption(e[i],t[e[i]],n);return this},r.prototype.toString=function(){var t=this.constructor.className,n=this.fullName;return n.length?t+" "+n:t},r.T=function(t){i=t}},function(t,n,e){"use strict";t.exports=s;var i,a=e(6),r=(((s.prototype=Object.create(a.prototype)).constructor=s).className="Field",e(5)),u=e(9),c=e(2),f=/^required|optional|repeated$/;function s(t,n,e,i,r,o,s){if(c.isObject(i)?(s=r,o=i,i=r=void 0):c.isObject(r)&&(s=o,o=r,r=void 0),a.call(this,t,o),!c.isInteger(n)||n<0)throw TypeError("id must be a non-negative integer");if(!c.isString(e))throw TypeError("type must be a string");if(void 0!==i&&!f.test(i=i.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==r&&!c.isString(r))throw TypeError("extend must be a string");this.rule=(i="proto3_optional"===i?"optional":i)&&"optional"!==i?i:void 0,this.type=e,this.id=n,this.extend=r||void 0,this.required="required"===i,this.optional=!this.required,this.repeated="repeated"===i,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!c.Long&&void 0!==u.long[e],this.bytes="bytes"===e,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.O=null,this.comment=s}s.fromJSON=function(t,n){return new s(t,n.id,n.type,n.rule,n.extend,n.options,n.comment)},Object.defineProperty(s.prototype,"packed",{get:function(){return null===this.O&&(this.O=!1!==this.getOption("packed")),this.O}}),s.prototype.setOption=function(t,n,e){return"packed"===t&&(this.O=null),a.prototype.setOption.call(this,t,n,e)},s.prototype.toJSON=function(t){t=!!t&&Boolean(t.keepComments);return c.toObject(["rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},s.prototype.resolve=function(){var t;return this.resolved?this:(void 0===(this.typeDefault=u.defaults[this.type])&&(this.resolvedType=(this.declaringField||this).parent.lookupTypeOrEnum(this.type),this.resolvedType instanceof i?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof r)&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault]),this.options&&(!0!==this.options.packed&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof r)||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long?(this.typeDefault=c.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault)):this.bytes&&"string"==typeof this.typeDefault&&(c.base64.test(this.typeDefault)?c.base64.decode(this.typeDefault,t=c.newBuffer(c.base64.length(this.typeDefault)),0):c.utf8.write(this.typeDefault,t=c.newBuffer(c.utf8.length(this.typeDefault)),0),this.typeDefault=t),this.map?this.defaultValue=c.emptyObject:this.repeated?this.defaultValue=c.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof i&&(this.parent.ctor.prototype[this.name]=this.defaultValue),a.prototype.resolve.call(this))},s.d=function(e,i,r,o){return"function"==typeof i?i=c.decorateType(i).name:i&&"object"==typeof i&&(i=c.decorateEnum(i).name),function(t,n){c.decorateType(t.constructor).add(new s(n,e,i,r,{default:o}))}},s.T=function(t){i=t}},function(t,n,e){"use strict";t.exports=h;var r,o,s,i=e(6),a=(((h.prototype=Object.create(i.prototype)).constructor=h).className="Namespace",e(7)),u=e(10),c=e(2);function f(t,n){if(t&&t.length){for(var e={},i=0;i<t.length;++i)e[t[i].name]=t[i].toJSON(n);return e}}function h(t,n){i.call(this,t,n),this.nested=void 0,this.L=null}function l(t){return t.L=null,t}h.fromJSON=function(t,n){return new h(t,n.options).addJSON(n.nested)},h.arrayToJSON=f,h.isReservedId=function(t,n){if(t)for(var e=0;e<t.length;++e)if("string"!=typeof t[e]&&t[e][0]<=n&&t[e][1]>n)return!0;return!1},h.isReservedName=function(t,n){if(t)for(var e=0;e<t.length;++e)if(t[e]===n)return!0;return!1},Object.defineProperty(h.prototype,"nestedArray",{get:function(){return this.L||(this.L=c.toArray(this.nested))}}),h.prototype.toJSON=function(t){return c.toObject(["options",this.options,"nested",f(this.nestedArray,t)])},h.prototype.addJSON=function(t){if(t)for(var n,e=Object.keys(t),i=0;i<e.length;++i)n=t[e[i]],this.add((void 0!==n.fields?r:void 0!==n.values?s:void 0!==n.methods?o:void 0!==n.id?a:h).fromJSON(e[i],n));return this},h.prototype.get=function(t){return this.nested&&this.nested[t]||null},h.prototype.getEnum=function(t){if(this.nested&&this.nested[t]instanceof s)return this.nested[t].values;throw Error("no such enum: "+t)},h.prototype.add=function(t){if(!(t instanceof a&&void 0!==t.extend||t instanceof r||t instanceof s||t instanceof o||t instanceof h||t instanceof u))throw TypeError("object must be a valid nested object");if(this.nested){var n=this.get(t.name);if(n){if(!(n instanceof h&&t instanceof h)||n instanceof r||n instanceof o)throw Error("duplicate name '"+t.name+"' in "+this);for(var e=n.nestedArray,i=0;i<e.length;++i)t.add(e[i]);this.remove(n),this.nested||(this.nested={}),t.setOptions(n.options,!0)}}else this.nested={};return(this.nested[t.name]=t).onAdd(this),l(this)},h.prototype.remove=function(t){if(!(t instanceof i))throw TypeError("object must be a ReflectionObject");if(t.parent!==this)throw Error(t+" is not a member of "+this);return delete this.nested[t.name],Object.keys(this.nested).length||(this.nested=void 0),t.onRemove(this),l(this)},h.prototype.define=function(t,n){if(c.isString(t))t=t.split(".");else if(!Array.isArray(t))throw TypeError("illegal path");if(t&&t.length&&""===t[0])throw Error("path must be relative");for(var e=this;0<t.length;){var i=t.shift();if(e.nested&&e.nested[i]){if(!((e=e.nested[i])instanceof h))throw Error("path conflicts with non-namespace objects")}else e.add(e=new h(i))}return n&&e.addJSON(n),e},h.prototype.resolveAll=function(){for(var t=this.nestedArray,n=0;n<t.length;)t[n]instanceof h?t[n++].resolveAll():t[n++].resolve();return this.resolve()},h.prototype.lookup=function(t,n,e){if("boolean"==typeof n?(e=n,n=void 0):n&&!Array.isArray(n)&&(n=[n]),c.isString(t)&&t.length){if("."===t)return this.root;t=t.split(".")}else if(!t.length)return this;if(""===t[0])return this.root.lookup(t.slice(1),n);var i=this.get(t[0]);if(i){if(1===t.length){if(!n||-1<n.indexOf(i.constructor))return i}else if(i instanceof h&&(i=i.lookup(t.slice(1),n,!0)))return i}else for(var r=0;r<this.nestedArray.length;++r)if(this.L[r]instanceof h&&(i=this.L[r].lookup(t,n,!0)))return i;return null===this.parent||e?null:this.parent.lookup(t,n)},h.prototype.lookupType=function(t){var n=this.lookup(t,[r]);if(n)return n;throw Error("no such type: "+t)},h.prototype.lookupEnum=function(t){var n=this.lookup(t,[s]);if(n)return n;throw Error("no such Enum '"+t+"' in "+this)},h.prototype.lookupTypeOrEnum=function(t){var n=this.lookup(t,[r,s]);if(n)return n;throw Error("no such Type or Enum '"+t+"' in "+this)},h.prototype.lookupService=function(t){var n=this.lookup(t,[o]);if(n)return n;throw Error("no such Service '"+t+"' in "+this)},h.T=function(t,n,e){r=t,o=n,s=e}},function(t,n,e){"use strict";var e=e(2),r=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function i(t,n){var e=0,i={};for(n|=0;e<t.length;)i[r[e+n]]=t[e++];return i}n.basic=i([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),n.defaults=i([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",e.emptyArray,null]),n.long=i([0,0,0,1,1],7),n.mapKey=i([0,0,0,5,5,0,0,0,1,1,0,2],2),n.packed=i([1,5,0,0,0,5,5,0,0,0,1,1,0])},function(t,n,e){"use strict";t.exports=s;var r=e(6),i=(((s.prototype=Object.create(r.prototype)).constructor=s).className="OneOf",e(7)),o=e(2);function s(t,n,e,i){if(Array.isArray(n)||(e=n,n=void 0),r.call(this,t,e),void 0!==n&&!Array.isArray(n))throw TypeError("fieldNames must be an Array");this.oneof=n||[],this.fieldsArray=[],this.comment=i}function a(t){if(t.parent)for(var n=0;n<t.fieldsArray.length;++n)t.fieldsArray[n].parent||t.parent.add(t.fieldsArray[n])}s.fromJSON=function(t,n){return new s(t,n.oneof,n.options,n.comment)},s.prototype.toJSON=function(t){t=!!t&&Boolean(t.keepComments);return o.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},s.prototype.add=function(t){if(t instanceof i)return t.parent&&t.parent!==this.parent&&t.parent.remove(t),this.oneof.push(t.name),this.fieldsArray.push(t),a(t.partOf=this),this;throw TypeError("field must be a Field")},s.prototype.remove=function(t){if(!(t instanceof i))throw TypeError("field must be a Field");var n=this.fieldsArray.indexOf(t);if(n<0)throw Error(t+" is not a member of "+this);return this.fieldsArray.splice(n,1),-1<(n=this.oneof.indexOf(t.name))&&this.oneof.splice(n,1),t.partOf=null,this},s.prototype.onAdd=function(t){r.prototype.onAdd.call(this,t);for(var n=0;n<this.oneof.length;++n){var e=t.get(this.oneof[n]);e&&!e.partOf&&(e.partOf=this).fieldsArray.push(e)}a(this)},s.prototype.onRemove=function(t){for(var n,e=0;e<this.fieldsArray.length;++e)(n=this.fieldsArray[e]).parent&&n.parent.remove(n);r.prototype.onRemove.call(this,t)},s.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,n){o.decorateType(t.constructor).add(new s(n,e)),Object.defineProperty(t,n,{get:o.oneOfGetter(e),set:o.oneOfSetter(e)})}}},function(t,n,e){var i;void 0!==(n="function"==typeof(i=function(){var f=function t(n){return n.reduce(function(t,n){return t*2+n},0)},h=function t(n){var e=[];for(var i=7;i>=0;i--)e.push(!!(n&1<<i));return e},nt=function t(n){this.data=n;this.len=this.data.length;this.pos=0;this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");if(n instanceof Uint8Array)return n[this.pos++];else return n.charCodeAt(this.pos++)&255};this.readBytes=function(t){var n=[];for(var e=0;e<t;e++)n.push(this.readByte());return n};this.read=function(t){var n="";for(var e=0;e<t;e++)n+=String.fromCharCode(this.readByte());return n};this.readUnsigned=function(){var t=this.readBytes(2);return(t[1]<<8)+t[0]}},l=function t(e,r){var o=0;var n=function t(n){var e=0;for(var i=0;i<n;i++){if(r.charCodeAt(o>>3)&1<<(o&7))e|=1<<i;o++}return e};var i=[];var s=1<<e;var a=s+1;var u=e+1;var c=[];var f=function t(){c=[];u=e+1;for(var n=0;n<s;n++)c[n]=[n];c[s]=[];c[a]=null};var h;var l;while(true){l=h;h=n(u);if(h===s){f();continue}if(h===a)break;if(h<c.length){if(l!==s)c.push(c[l].concat(c[h][0]))}else{if(h!==c.length)throw new Error("Invalid LZW code.");c.push(c[l].concat(c[l][0]))}i.push.apply(i,c[h]);if(c.length===1<<u&&u<12)u++}return i},et=function t(a,u){u||(u={});var o=function t(n){var e=[];for(var i=0;i<n;i++)e.push(a.readBytes(3));return e};var c=function t(){var n,e;e="";do{n=a.readByte();e+=a.read(n)}while(n!==0);return e};var n=function t(){var n={};n.sig=a.read(3);n.ver=a.read(3);if(n.sig!=="GIF")throw new Error("Not a GIF file.");n.width=a.readUnsigned();n.height=a.readUnsigned();var e=h(a.readByte());n.gctFlag=e.shift();n.colorRes=f(e.splice(0,3));n.sorted=e.shift();n.gctSize=f(e.splice(0,3));n.bgColor=a.readByte();n.pixelAspectRatio=a.readByte();if(n.gctFlag)n.gct=o(1<<n.gctSize+1);u.hdr&&u.hdr(n)};var e=function t(n){var e=function t(n){var e=a.readByte();var i=h(a.readByte());n.reserved=i.splice(0,3);n.disposalMethod=f(i.splice(0,3));n.userInput=i.shift();n.transparencyGiven=i.shift();n.delayTime=a.readUnsigned();n.transparencyIndex=a.readByte();n.terminator=a.readByte();u.gce&&u.gce(n)};var i=function t(n){n.comment=c();u.com&&u.com(n)};var r=function t(n){var e=a.readByte();n.ptHeader=a.readBytes(12);n.ptData=c();u.pte&&u.pte(n)};var o=function t(n){var e=function t(n){var e=a.readByte();n.unknown=a.readByte();n.iterations=a.readUnsigned();n.terminator=a.readByte();u.app&&u.app.NETSCAPE&&u.app.NETSCAPE(n)};var i=function t(n){n.appData=c();u.app&&u.app[n.identifier]&&u.app[n.identifier](n)};var r=a.readByte();n.identifier=a.read(8);n.authCode=a.read(3);switch(n.identifier){case"NETSCAPE":e(n);break;default:i(n);break}};var s=function t(n){n.data=c();u.unknown&&u.unknown(n)};n.label=a.readByte();switch(n.label){case 249:n.extType="gce";e(n);break;case 254:n.extType="com";i(n);break;case 1:n.extType="pte";r(n);break;case 255:n.extType="app";o(n);break;default:n.extType="unknown";s(n);break}};var i=function t(n){var e=function t(r,o){var s=new Array(r.length);var n=r.length/o;var e=function t(n,e){var i=r.slice(e*o,(e+1)*o);s.splice.apply(s,[n*o,o].concat(i))};var i=[0,4,2,1];var a=[8,8,4,2];var u=0;for(var c=0;c<4;c++)for(var f=i[c];f<n;f+=a[c]){e(f,u);u++}return s};n.leftPos=a.readUnsigned();n.topPos=a.readUnsigned();n.width=a.readUnsigned();n.height=a.readUnsigned();var i=h(a.readByte());n.lctFlag=i.shift();n.interlaced=i.shift();n.sorted=i.shift();n.reserved=i.splice(0,2);n.lctSize=f(i.splice(0,3));if(n.lctFlag)n.lct=o(1<<n.lctSize+1);n.lzwMinCodeSize=a.readByte();var r=c();n.pixels=l(n.lzwMinCodeSize,r);if(n.interlaced)n.pixels=e(n.pixels,n.width);u.img&&u.img(n)};var r=function t(){var n={};n.sentinel=a.readByte();switch(String.fromCharCode(n.sentinel)){case"!":n.type="ext";e(n);break;case",":n.type="img";i(n);break;case";":n.type="eof";u.eof&&u.eof(n);break;default:throw new Error("Unknown block: 0x"+n.sentinel.toString(16))}if(n.type!=="eof")setTimeout(t,0)};var s=function t(){n();setTimeout(r,0)};s()},t;return function C(t){var d={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(var n in t)d[n]=t[n];if(d.vp_w&&d.vp_h)d.is_vp=true;var r;var o;var f=null;var e=false;var s=null;var i=null;var a=null;var u=null;var c=null;var h=null;var l=null;var v=true;var k=true;var p=false;var m=[];var y=[];var b=d.gif;if(typeof d.auto_play=="undefined")d.auto_play=!b.getAttribute("rel:auto_play")||b.getAttribute("rel:auto_play")=="1";var g=d.hasOwnProperty("on_end")?d.on_end:null;var D=d.hasOwnProperty("loop_delay")?d.loop_delay:0;var U=d.hasOwnProperty("loop_mode")?d.loop_mode:"auto";var w=d.hasOwnProperty("draw_while_loading")?d.draw_while_loading:true;var B=w?d.hasOwnProperty("show_progress_bar")?d.show_progress_bar:true:false;var G=d.hasOwnProperty("progressbar_height")?d.progressbar_height:25;var H=d.hasOwnProperty("progressbar_background_color")?d.progressbar_background_color:"rgba(255,255,255,0.4)";var X=d.hasOwnProperty("progressbar_foreground_color")?d.progressbar_foreground_color:"rgba(255,0,22,.8)";var _=function t(){s=null;i=null;c=a;a=null;h=null};var E=function t(){try{et(r,K)}catch(t){x("parse")}};var z=function t(n){P.innerHTML=n;P.style.visibility="visible"};var S=function t(n,e){R.width=n*L();R.height=e*L();P.style.minWidth=n*L()+"px";j.width=n;j.height=e;j.style.width=n+"px";j.style.height=e+"px";j.getContext("2d").setTransform(1,0,0,1,0,0)};var V=function t(n,e){if(!y[n]){y[n]=e;return}if(typeof e.x!=="undefined")y[n].x=e.x;if(typeof e.y!=="undefined")y[n].y=e.y};var T=function t(n,e,i){if(i&&B){var r=G;var o,s,a,u;if(d.is_vp){if(!p){a=d.vp_t+d.vp_h-r;r=r;o=d.vp_l;s=o+n/e*d.vp_w;u=R.width}else{a=(d.vp_t+d.vp_h-r)/L();r=r/L();o=d.vp_l/L();s=o+n/e*(d.vp_w/L());u=R.width/L()}if(false)var c,f,h,l}else{a=(R.height-r)/(p?L():1);s=n/e*R.width/(p?L():1);u=R.width/(p?L():1);r/=p?L():1}N.fillStyle=H;N.fillRect(s,a,u-s,r);N.fillStyle=X;N.fillRect(0,a,s,r)}};var x=function t(n){var e=function t(){N.fillStyle="black";N.fillRect(0,0,d.c_w?d.c_w:o.width,d.c_h?d.c_h:o.height);N.strokeStyle="red";N.lineWidth=3;N.moveTo(0,0);N.lineTo(d.c_w?d.c_w:o.width,d.c_h?d.c_h:o.height);N.moveTo(0,d.c_h?d.c_h:o.height);N.lineTo(d.c_w?d.c_w:o.width,0);N.stroke()};f=n;o={width:b.width,height:b.height};m=[];e()};var W=function t(n){o=n;S(o.width,o.height)};var Y=function t(n){A();_();s=n.transparencyGiven?n.transparencyIndex:null;i=n.delayTime;a=n.disposalMethod};var A=function t(){if(!h)return;m.push({data:h.getImageData(0,0,o.width,o.height),delay:i});y.push({x:0,y:0})};var Q=function t(n){if(!h)h=j.getContext("2d");var e=m.length;var i=n.lctFlag?n.lct:o.gct;if(e>0){if(c===3)if(u!==null)h.putImageData(m[u].data,0,0);else h.clearRect(l.leftPos,l.topPos,l.width,l.height);else u=e-1;if(c===2)h.clearRect(l.leftPos,l.topPos,l.width,l.height)}var r=h.getImageData(n.leftPos,n.topPos,n.width,n.height);n.pixels.forEach(function(t,n){if(t!==s){r.data[n*4+0]=i[t][0];r.data[n*4+1]=i[t][1];r.data[n*4+2]=i[t][2];r.data[n*4+3]=255}});h.putImageData(r,n.leftPos,n.topPos);if(!p){N.scale(L(),L());p=true}if(w){N.drawImage(j,0,0);w=d.auto_play}l=n};var M=function(){var o=-1;var e=0;var t=false;var n=false;var s=function t(){var n=k?1:-1;return(o+n+m.length)%m.length};var a=function t(n){o=o+n;r()};var i=function(){var i=false;var r=function t(){if(g!==null)g(b);e++;if(U!==false||e<0)n();else{i=false;v=false}};var n=function t(){i=v;if(!i)return;a(1);var n=m[o].delay*10;if(!n)n=100;var e=s();if(e===0){n+=D;setTimeout(r,n)}else setTimeout(t,n)};return function(){if(!i)setTimeout(n,0)}}();var r=function t(){var n;o=parseInt(o,10);if(o>m.length-1)o=0;if(o<0)o=0;n=y[o];j.getContext("2d").putImageData(m[o].data,n.x,n.y);N.globalCompositeOperation="copy";N.drawImage(j,0,0)};var u=function t(){v=true;i()};var c=function t(){v=false};return{init:function t(){if(f)return;if(!(d.c_w&&d.c_h))N.scale(L(),L());if(d.auto_play)i();else{o=0;r()}},step:i,play:u,pause:c,playing:v,move_relative:a,current_frame:function t(){return o},length:function t(){return m.length},move_to:function t(n){o=n;r()}}}();var Z=function t(n){T(r.pos,r.data.length,n)};var q=function t(){};var O=function t(n,e){return function(t){n(t);Z(e)}};var K={hdr:O(W),gce:O(Y),com:O(q),app:{NETSCAPE:O(q)},img:O(Q,true),eof:function t(n){A();Z(false);if(!(d.c_w&&d.c_h)){R.width=o.width*L();R.height=o.height*L()}M.init();e=false;if(I)I(b)}};var J=function t(){var n=b.parentNode;var e=document.createElement("div");R=document.createElement("canvas");N=R.getContext("2d");P=document.createElement("div");j=document.createElement("canvas");e.width=R.width=b.width;e.height=R.height=b.height;P.style.minWidth=b.width+"px";e.className="jsgif";P.className="jsgif_toolbar";e.appendChild(R);e.appendChild(P);n.insertBefore(e,b);n.removeChild(b);if(d.c_w&&d.c_h)S(d.c_w,d.c_h);F=true};var L=function t(){var n;if(d.max_width&&o&&o.width>d.max_width)n=d.max_width/o.width;else n=1;return n};var R,N,P,j;var F=false;var I=false;var $=function t(n){if(e)return false;if(n)I=n;else I=false;e=true;m=[];_();u=null;c=null;h=null;l=null;return true};var tt=function t(){return m.reduce(function(t,n){return t+n.delay},0)};return{play:M.play,pause:M.pause,move_relative:M.move_relative,move_to:M.move_to,get_playing:function t(){return v},get_canvas:function t(){return R},get_canvas_scale:function t(){return L()},get_loading:function t(){return e},get_auto_play:function t(){return d.auto_play},get_length:function t(){return M.length()},get_frames:function t(){return m},get_duration:function t(){return tt()},get_duration_ms:function t(){return tt()*10},get_current_frame:function t(){return M.current_frame()},load_url:function t(n,e){if(!$(e))return;var i=new XMLHttpRequest;i.open("GET",n,true);if("overrideMimeType"in i)i.overrideMimeType("text/plain; charset=x-user-defined");else if("responseType"in i)i.responseType="arraybuffer";else i.setRequestHeader("Accept-Charset","x-user-defined");i.onloadstart=function(){if(!F)J()};i.onload=function(t){if(this.status!=200)x("xhr - response");if(!("response"in this))this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join("");var n=this.response;if(n.toString().indexOf("ArrayBuffer")>0)n=new Uint8Array(n);r=new nt(n);setTimeout(E,0)};i.onprogress=function(t){if(t.lengthComputable)T(t.loaded,t.total,true)};i.onerror=function(){x("xhr")};i.send()},load:function t(n){this.load_url(b.getAttribute("rel:animated_src")||b.src,n)},load_raw:function t(n,e){if(!$(e))return;if(!F)J();r=new nt(n);setTimeout(E,0)},set_frame_offset:V}}})?i.apply(n,[]):i)&&(t.exports=n)},function(t,n,e){"use strict";t.exports=h;var i,r=e(4),o=r.LongBits,s=r.base64,a=r.utf8;function u(t,n,e){this.fn=t,this.len=n,this.next=void 0,this.val=e}function c(){}function f(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function h(){this.len=0,this.head=new u(c,0,0),this.tail=this.head,this.states=null}function l(){return r.Buffer?function(){return(h.create=function(){return new i})()}:function(){return new h}}function d(t,n,e){n[e]=255&t}function v(t,n){this.len=t,this.next=void 0,this.val=n}function p(t,n,e){for(;t.hi;)n[e++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;127<t.lo;)n[e++]=127&t.lo|128,t.lo=t.lo>>>7;n[e++]=t.lo}function m(t,n,e){n[e]=255&t,n[e+1]=t>>>8&255,n[e+2]=t>>>16&255,n[e+3]=t>>>24}h.create=l(),h.alloc=function(t){return new r.Array(t)},r.Array!==Array&&(h.alloc=r.pool(h.alloc,r.Array.prototype.subarray)),h.prototype.R=function(t,n,e){return this.tail=this.tail.next=new u(t,n,e),this.len+=n,this},(v.prototype=Object.create(u.prototype)).fn=function(t,n,e){for(;127<t;)n[e++]=127&t|128,t>>>=7;n[e]=t},h.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new v((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},h.prototype.int32=function(t){return t<0?this.R(p,10,o.fromNumber(t)):this.uint32(t)},h.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},h.prototype.int64=h.prototype.uint64=function(t){t=o.from(t);return this.R(p,t.length(),t)},h.prototype.sint64=function(t){t=o.from(t).zzEncode();return this.R(p,t.length(),t)},h.prototype.bool=function(t){return this.R(d,1,t?1:0)},h.prototype.sfixed32=h.prototype.fixed32=function(t){return this.R(m,4,t>>>0)},h.prototype.sfixed64=h.prototype.fixed64=function(t){t=o.from(t);return this.R(m,4,t.lo).R(m,4,t.hi)},h.prototype.float=function(t){return this.R(r.float.writeFloatLE,4,t)},h.prototype.double=function(t){return this.R(r.float.writeDoubleLE,8,t)};var y=r.Array.prototype.set?function(t,n,e){n.set(t,e)}:function(t,n,e){for(var i=0;i<t.length;++i)n[e+i]=t[i]};h.prototype.bytes=function(t){var n,e=t.length>>>0;return e?(r.isString(t)&&(n=h.alloc(e=s.length(t)),s.decode(t,n,0),t=n),this.uint32(e).R(y,e,t)):this.R(d,1,0)},h.prototype.string=function(t){var n=a.length(t);return n?this.uint32(n).R(a.write,n,t):this.R(d,1,0)},h.prototype.fork=function(){return this.states=new f(this),this.head=this.tail=new u(c,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new u(c,0,0),this.len=0),this},h.prototype.ldelim=function(){var t=this.head,n=this.tail,e=this.len;return this.reset().uint32(e),e&&(this.tail.next=t.next,this.tail=n,this.len+=e),this},h.prototype.finish=function(){for(var t=this.head.next,n=this.constructor.alloc(this.len),e=0;t;)t.fn(t.val,n,e),e+=t.len,t=t.next;return n},h.T=function(t){i=t,h.create=l(),i.T()}},function(t,n,e){"use strict";t.exports=u;var i,r=e(4),o=r.LongBits,s=r.utf8;function a(t,n){return RangeError("index out of range: "+t.pos+" + "+(n||1)+" > "+t.len)}function u(t){this.buf=t,this.pos=0,this.len=t.length}function c(){return r.Buffer?function(t){return(u.create=function(t){return r.Buffer.isBuffer(t)?new i(t):h(t)})(t)}:h}var f,h="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new u(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new u(t);throw Error("illegal buffer")};function l(){var t=new o(0,0),n=0;if(!(4<this.len-this.pos)){for(;n<3;++n){if(this.pos>=this.len)throw a(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*n)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*n)>>>0,t}for(;n<4;++n)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*n)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(n=0,4<this.len-this.pos){for(;n<5;++n)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*n+3)>>>0,this.buf[this.pos++]<128)return t}else for(;n<5;++n){if(this.pos>=this.len)throw a(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*n+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function d(t,n){return(t[n-4]|t[n-3]<<8|t[n-2]<<16|t[n-1]<<24)>>>0}function v(){if(this.pos+8>this.len)throw a(this,8);return new o(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}u.create=c(),u.prototype.N=r.Array.prototype.subarray||r.Array.prototype.slice,u.prototype.uint32=(f=4294967295,function(){if(f=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(f=(f|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(f=(f|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(f=(f|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(f=(f|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)||!((this.pos+=5)>this.len))return f;throw this.pos=this.len,a(this,10)}),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},u.prototype.bool=function(){return 0!==this.uint32()},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return d(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|d(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var t=r.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},u.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var t=r.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},u.prototype.bytes=function(){var t=this.uint32(),n=this.pos,e=this.pos+t;if(e>this.len)throw a(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(n,e):n===e?new this.buf.constructor(0):this.N.call(this.buf,n,e)},u.prototype.string=function(){var t=this.bytes();return s.read(t,0,t.length)},u.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw a(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},u.T=function(t){i=t,u.create=c(),i.T();var n=r.Long?"toLong":"toNumber";r.merge(u.prototype,{int64:function(){return l.call(this)[n](!1)},uint64:function(){return l.call(this)[n](!0)},sint64:function(){return l.call(this).zzDecode()[n](!1)},fixed64:function(){return v.call(this)[n](!0)},sfixed64:function(){return v.call(this)[n](!1)}})}},function(t,n,e){"use strict";t.exports=r;var i=e(4);function r(t){if(t)for(var n=Object.keys(t),e=0;e<n.length;++e)this[n[e]]=t[n[e]]}r.create=function(t){return this.$type.create(t)},r.encode=function(t,n){return this.$type.encode(t,n)},r.encodeDelimited=function(t,n){return this.$type.encodeDelimited(t,n)},r.decode=function(t){return this.$type.decode(t)},r.decodeDelimited=function(t){return this.$type.decodeDelimited(t)},r.verify=function(t){return this.$type.verify(t)},r.fromObject=function(t){return this.$type.fromObject(t)},r.toObject=function(t,n){return this.$type.toObject(t,n)},r.prototype.toJSON=function(){return this.$type.toObject(this,i.toJSONOptions)}},function(t,n){var e=function(){return this}();try{e=e||new Function("return this")()}catch(t){"object"==typeof window&&(e=window)}t.exports=e},function(t,n,e){"use strict";t.exports=function(t,n){var e=new Array(arguments.length-1),o=0,i=2,s=!0;for(;i<arguments.length;)e[o++]=arguments[i++];return new Promise(function(i,r){e[o]=function(t){if(s)if(s=!1,t)r(t);else{for(var n=new Array(arguments.length-1),e=0;e<n.length;)n[e++]=arguments[e];i.apply(null,n)}};try{t.apply(n||null,e)}catch(t){s&&(s=!1,r(t))}})}},function(module,exports,__webpack_require__){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},function(t,n,e){"use strict";n.Service=e(43)},function(t,n,e){"use strict";t.exports={}},function(t,n,e){"use strict";t.exports=function(t){for(var n,e=h.codegen(["m","w"],t.name+"$encode")("if(!w)")("w=Writer.create()"),i=t.fieldsArray.slice().sort(h.compareFieldsById),r=0;r<i.length;++r){var o=i[r].resolve(),s=t.P.indexOf(o),a=o.resolvedType instanceof c?"int32":o.type,u=f.basic[a];n="m"+h.safeProp(o.name),o.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",n,o.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",n)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(o.id<<3|2)>>>0,8|f.mapKey[o.keyType],o.keyType),void 0===u?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",s,n):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|u,a,n),e("}")("}")):o.repeated?(e("if(%s!=null&&%s.length){",n,n),o.packed&&void 0!==f.packed[a]?e("w.uint32(%i).fork()",(o.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",n)("w.%s(%s[i])",a,n)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",n),void 0===u?l(e,o,s,n+"[i]"):e("w.uint32(%i).%s(%s[i])",(o.id<<3|u)>>>0,a,n)),e("}")):(o.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",n,o.name),void 0===u?l(e,o,s,n):e("w.uint32(%i).%s(%s)",(o.id<<3|u)>>>0,a,n))}return e("return w")};var c=e(5),f=e(9),h=e(2);function l(t,n,e,i){n.resolvedType.group?t("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",e,i,(n.id<<3|3)>>>0,(n.id<<3|4)>>>0):t("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",e,i,(n.id<<3|2)>>>0)}},function(t,n,e){"use strict";t.exports=g;var s=e(8),a=(((g.prototype=Object.create(s.prototype)).constructor=g).className="Type",e(5)),u=e(10),c=e(7),f=e(22),h=e(23),r=e(14),o=e(13),l=e(12),d=e(2),v=e(20),p=e(25),m=e(26),y=e(27),b=e(28);function g(t,n){s.call(this,t,n),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this.j=null,this.P=null,this.F=null,this.I=null}function i(t){return t.j=t.P=t.F=null,delete t.encode,delete t.decode,delete t.verify,t}Object.defineProperties(g.prototype,{fieldsById:{get:function(){if(!this.j){this.j={};for(var t=Object.keys(this.fields),n=0;n<t.length;++n){var e=this.fields[t[n]],i=e.id;if(this.j[i])throw Error("duplicate id "+i+" in "+this);this.j[i]=e}}return this.j}},fieldsArray:{get:function(){return this.P||(this.P=d.toArray(this.fields))}},oneofsArray:{get:function(){return this.F||(this.F=d.toArray(this.oneofs))}},ctor:{get:function(){return this.I||(this.ctor=g.generateConstructor(this)())},set:function(t){for(var n=t.prototype,e=(n instanceof r||((t.prototype=new r).constructor=t,d.merge(t.prototype,n)),t.$type=t.prototype.$type=this,d.merge(t,r,!0),this.I=t,0);e<this.fieldsArray.length;++e)this.P[e].resolve();for(var i={},e=0;e<this.oneofsArray.length;++e)i[this.F[e].resolve().name]={get:d.oneOfGetter(this.F[e].oneof),set:d.oneOfSetter(this.F[e].oneof)};e&&Object.defineProperties(t.prototype,i)}}}),g.generateConstructor=function(t){for(var n,e=d.codegen(["p"],t.name),i=0;i<t.fieldsArray.length;++i)(n=t.P[i]).map?e("this%s={}",d.safeProp(n.name)):n.repeated&&e("this%s=[]",d.safeProp(n.name));return e("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},g.fromJSON=function(t,n){for(var e=new g(t,n.options),i=(e.extensions=n.extensions,e.reserved=n.reserved,Object.keys(n.fields)),r=0;r<i.length;++r)e.add((void 0!==n.fields[i[r]].keyType?f:c).fromJSON(i[r],n.fields[i[r]]));if(n.oneofs)for(i=Object.keys(n.oneofs),r=0;r<i.length;++r)e.add(u.fromJSON(i[r],n.oneofs[i[r]]));if(n.nested)for(i=Object.keys(n.nested),r=0;r<i.length;++r){var o=n.nested[i[r]];e.add((void 0!==o.id?c:void 0!==o.fields?g:void 0!==o.values?a:void 0!==o.methods?h:s).fromJSON(i[r],o))}return n.extensions&&n.extensions.length&&(e.extensions=n.extensions),n.reserved&&n.reserved.length&&(e.reserved=n.reserved),n.group&&(e.group=!0),n.comment&&(e.comment=n.comment),e},g.prototype.toJSON=function(t){var n=s.prototype.toJSON.call(this,t),e=!!t&&Boolean(t.keepComments);return d.toObject(["options",n&&n.options||void 0,"oneofs",s.arrayToJSON(this.oneofsArray,t),"fields",s.arrayToJSON(this.fieldsArray.filter(function(t){return!t.declaringField}),t)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",n&&n.nested||void 0,"comment",e?this.comment:void 0])},g.prototype.resolveAll=function(){for(var t=this.fieldsArray,n=0;n<t.length;)t[n++].resolve();for(var e=this.oneofsArray,n=0;n<e.length;)e[n++].resolve();return s.prototype.resolveAll.call(this)},g.prototype.get=function(t){return this.fields[t]||this.oneofs&&this.oneofs[t]||this.nested&&this.nested[t]||null},g.prototype.add=function(t){if(this.get(t.name))throw Error("duplicate name '"+t.name+"' in "+this);if(t instanceof c&&void 0===t.extend){if((this.j||this.fieldsById)[t.id])throw Error("duplicate id "+t.id+" in "+this);if(this.isReservedId(t.id))throw Error("id "+t.id+" is reserved in "+this);if(this.isReservedName(t.name))throw Error("name '"+t.name+"' is reserved in "+this);return t.parent&&t.parent.remove(t),(this.fields[t.name]=t).message=this,t.onAdd(this),i(this)}return t instanceof u?(this.oneofs||(this.oneofs={}),(this.oneofs[t.name]=t).onAdd(this),i(this)):s.prototype.add.call(this,t)},g.prototype.remove=function(t){if(t instanceof c&&void 0===t.extend){if(this.fields&&this.fields[t.name]===t)return delete this.fields[t.name],t.parent=null,t.onRemove(this),i(this);throw Error(t+" is not a member of "+this)}if(t instanceof u){if(this.oneofs&&this.oneofs[t.name]===t)return delete this.oneofs[t.name],t.parent=null,t.onRemove(this),i(this);throw Error(t+" is not a member of "+this)}return s.prototype.remove.call(this,t)},g.prototype.isReservedId=function(t){return s.isReservedId(this.reserved,t)},g.prototype.isReservedName=function(t){return s.isReservedName(this.reserved,t)},g.prototype.create=function(t){return new this.ctor(t)},g.prototype.setup=function(){for(var t=this.fullName,n=[],e=0;e<this.fieldsArray.length;++e)n.push(this.P[e].resolve().resolvedType);this.encode=v(this)({Writer:l,types:n,util:d}),this.decode=p(this)({Reader:o,types:n,util:d}),this.verify=m(this)({types:n,util:d}),this.fromObject=y.fromObject(this)({types:n,util:d}),this.toObject=y.toObject(this)({types:n,util:d});var i,t=b[t];return t&&((i=Object.create(this)).fromObject=this.fromObject,this.fromObject=t.fromObject.bind(i),i.toObject=this.toObject,this.toObject=t.toObject.bind(i)),this},g.prototype.encode=function(t,n){return this.setup().encode(t,n)},g.prototype.encodeDelimited=function(t,n){return this.encode(t,n&&n.len?n.fork():n).ldelim()},g.prototype.decode=function(t,n){return this.setup().decode(t,n)},g.prototype.decodeDelimited=function(t){return t instanceof o||(t=o.create(t)),this.decode(t,t.uint32())},g.prototype.verify=function(t){return this.setup().verify(t)},g.prototype.fromObject=function(t){return this.setup().fromObject(t)},g.prototype.toObject=function(t,n){return this.setup().toObject(t,n)},g.d=function(n){return function(t){d.decorateType(t,n)}}},function(t,n,e){"use strict";t.exports=o;var s=e(7),i=(((o.prototype=Object.create(s.prototype)).constructor=o).className="MapField",e(9)),a=e(2);function o(t,n,e,i,r,o){if(s.call(this,t,n,i,void 0,void 0,r,o),!a.isString(e))throw TypeError("keyType must be a string");this.keyType=e,this.resolvedKeyType=null,this.map=!0}o.fromJSON=function(t,n){return new o(t,n.id,n.keyType,n.type,n.options,n.comment)},o.prototype.toJSON=function(t){t=!!t&&Boolean(t.keepComments);return a.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},o.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return s.prototype.resolve.call(this)},o.d=function(e,i,r){return"function"==typeof r?r=a.decorateType(r).name:r&&"object"==typeof r&&(r=a.decorateEnum(r).name),function(t,n){a.decorateType(t.constructor).add(new o(n,e,i,r))}}},function(t,n,e){"use strict";t.exports=s;var i=e(8),o=(((s.prototype=Object.create(i.prototype)).constructor=s).className="Service",e(24)),a=e(2),u=e(18);function s(t,n){i.call(this,t,n),this.methods={},this.C=null}function r(t){return t.C=null,t}s.fromJSON=function(t,n){var e=new s(t,n.options);if(n.methods)for(var i=Object.keys(n.methods),r=0;r<i.length;++r)e.add(o.fromJSON(i[r],n.methods[i[r]]));return n.nested&&e.addJSON(n.nested),e.comment=n.comment,e},s.prototype.toJSON=function(t){var n=i.prototype.toJSON.call(this,t),e=!!t&&Boolean(t.keepComments);return a.toObject(["options",n&&n.options||void 0,"methods",i.arrayToJSON(this.methodsArray,t)||{},"nested",n&&n.nested||void 0,"comment",e?this.comment:void 0])},Object.defineProperty(s.prototype,"methodsArray",{get:function(){return this.C||(this.C=a.toArray(this.methods))}}),s.prototype.get=function(t){return this.methods[t]||i.prototype.get.call(this,t)},s.prototype.resolveAll=function(){for(var t=this.methodsArray,n=0;n<t.length;++n)t[n].resolve();return i.prototype.resolve.call(this)},s.prototype.add=function(t){if(this.get(t.name))throw Error("duplicate name '"+t.name+"' in "+this);return t instanceof o?r((this.methods[t.name]=t).parent=this):i.prototype.add.call(this,t)},s.prototype.remove=function(t){if(t instanceof o){if(this.methods[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.methods[t.name],t.parent=null,r(this)}return i.prototype.remove.call(this,t)},s.prototype.create=function(t,n,e){for(var i,r=new u.Service(t,n,e),o=0;o<this.methodsArray.length;++o){var s=a.lcFirst((i=this.C[o]).resolve().name).replace(/[^$\w_]/g,"");r[s]=a.codegen(["r","c"],a.isReserved(s)?s+"_":s)("return this.rpcCall(m,q,s,r,c)")({m:i,q:i.resolvedRequestType.ctor,s:i.resolvedResponseType.ctor})}return r}},function(t,n,e){"use strict";t.exports=i;var c=e(6),f=(((i.prototype=Object.create(c.prototype)).constructor=i).className="Method",e(2));function i(t,n,e,i,r,o,s,a,u){if(f.isObject(r)?(s=r,r=o=void 0):f.isObject(o)&&(s=o,o=void 0),void 0!==n&&!f.isString(n))throw TypeError("type must be a string");if(!f.isString(e))throw TypeError("requestType must be a string");if(!f.isString(i))throw TypeError("responseType must be a string");c.call(this,t,s),this.type=n||"rpc",this.requestType=e,this.requestStream=!!r||void 0,this.responseType=i,this.responseStream=!!o||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=u}i.fromJSON=function(t,n){return new i(t,n.type,n.requestType,n.responseType,n.requestStream,n.responseStream,n.options,n.comment,n.parsedOptions)},i.prototype.toJSON=function(t){t=!!t&&Boolean(t.keepComments);return f.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},i.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),c.prototype.resolve.call(this))}},function(t,n,e){"use strict";t.exports=function(t){var n=c.codegen(["r","l"],t.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(t.fieldsArray.filter(function(t){return t.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");t.group&&n("if((t&7)===4)")("break");n("switch(t>>>3){");for(var e=0;e<t.fieldsArray.length;++e){var i=t.P[e].resolve(),r=i.resolvedType instanceof a?"int32":i.type,o="m"+c.safeProp(i.name);n("case %i:",i.id),i.map?(n("if(%s===util.emptyObject)",o)("%s={}",o)("var c2 = r.uint32()+r.pos"),void 0!==u.defaults[i.keyType]?n("k=%j",u.defaults[i.keyType]):n("k=null"),void 0!==u.defaults[r]?n("value=%j",u.defaults[r]):n("value=null"),n("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",i.keyType)("case 2:"),void 0===u.basic[r]?n("value=types[%i].decode(r,r.uint32())",e):n("value=r.%s()",r),n("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),void 0!==u.long[i.keyType]?n('%s[typeof k==="object"?util.longToHash(k):k]=value',o):n("%s[k]=value",o)):i.repeated?(n("if(!(%s&&%s.length))",o,o)("%s=[]",o),void 0!==u.packed[r]&&n("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",o,r)("}else"),void 0===u.basic[r]?n(i.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",o,e):n("%s.push(r.%s())",o,r)):void 0===u.basic[r]?n(i.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",o,e):n("%s=r.%s()",o,r),n("break")}for(n("default:")("r.skipType(t&7)")("break")("}")("}"),e=0;e<t.P.length;++e){var s=t.P[e];s.required&&n("if(!m.hasOwnProperty(%j))",s.name)("throw util.ProtocolError(%j,{instance:m})","missing required '"+s.name+"'")}return n("return m")};var a=e(5),u=e(9),c=e(2)},function(t,n,e){"use strict";t.exports=function(t){var n=u.codegen(["m"],t.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),e=t.oneofsArray,i={};e.length&&n("var p={}");for(var r=0;r<t.fieldsArray.length;++r){var o,s=t.P[r].resolve(),a="m"+u.safeProp(s.name);s.optional&&n("if(%s!=null&&m.hasOwnProperty(%j)){",a,s.name),s.map?(n("if(!util.isObject(%s))",a)("return%j",c(s,"object"))("var k=Object.keys(%s)",a)("for(var i=0;i<k.length;++i){"),function(t,n,e){switch(n.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":t("if(!util.key32Re.test(%s))",e)("return%j",c(n,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":t("if(!util.key64Re.test(%s))",e)("return%j",c(n,"integer|Long key"));break;case"bool":t("if(!util.key2Re.test(%s))",e)("return%j",c(n,"boolean key"))}}(n,s,"k[i]"),f(n,s,r,a+"[k[i]]")("}")):s.repeated?(n("if(!Array.isArray(%s))",a)("return%j",c(s,"array"))("for(var i=0;i<%s.length;++i){",a),f(n,s,r,a+"[i]")("}")):(s.partOf&&(o=u.safeProp(s.partOf.name),1===i[s.partOf.name]&&n("if(p%s===1)",o)("return%j",s.partOf.name+": multiple values"),i[s.partOf.name]=1,n("p%s=1",o)),f(n,s,r,a)),s.optional&&n("}")}return n("return null")};var s=e(5),u=e(2);function c(t,n){return t.name+": "+n+(t.repeated&&"array"!==n?"[]":t.map&&"object"!==n?"{k:"+t.keyType+"}":"")+" expected"}function f(t,n,e,i){if(n.resolvedType)if(n.resolvedType instanceof s){t("switch(%s){",i)("default:")("return%j",c(n,"enum value"));for(var r=Object.keys(n.resolvedType.values),o=0;o<r.length;++o)t("case %i:",n.resolvedType.values[r[o]]);t("break")("}")}else t("{")("var e=types[%i].verify(%s);",e,i)("if(e)")("return%j+e",n.name+".")("}");else switch(n.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":t("if(!util.isInteger(%s))",i)("return%j",c(n,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":t("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",c(n,"integer|Long"));break;case"float":case"double":t('if(typeof %s!=="number")',i)("return%j",c(n,"number"));break;case"bool":t('if(typeof %s!=="boolean")',i)("return%j",c(n,"boolean"));break;case"string":t("if(!util.isString(%s))",i)("return%j",c(n,"string"));break;case"bytes":t('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",c(n,"buffer"))}return t}},function(t,n,e){"use strict";var l=e(5),d=e(2);function s(t,n,e,i){if(n.resolvedType)if(n.resolvedType instanceof l){t("switch(d%s){",i);for(var r=n.resolvedType.values,o=Object.keys(r),s=0;s<o.length;++s)n.repeated&&r[o[s]]===n.typeDefault&&t("default:"),t("case%j:",o[s])("case %i:",r[o[s]])("m%s=%j",i,r[o[s]])("break");t("}")}else t('if(typeof d%s!=="object")',i)("throw TypeError(%j)",n.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",i,e,i);else{var a=!1;switch(n.type){case"double":case"float":t("m%s=Number(d%s)",i,i);break;case"uint32":case"fixed32":t("m%s=d%s>>>0",i,i);break;case"int32":case"sint32":case"sfixed32":t("m%s=d%s|0",i,i);break;case"uint64":a=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":t("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",i,i,a)('else if(typeof d%s==="string")',i)("m%s=parseInt(d%s,10)",i,i)('else if(typeof d%s==="number")',i)("m%s=d%s",i,i)('else if(typeof d%s==="object")',i)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",i,i,i,a?"true":"");break;case"bytes":t('if(typeof d%s==="string")',i)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",i,i,i)("else if(d%s.length)",i)("m%s=d%s",i,i);break;case"string":t("m%s=String(d%s)",i,i);break;case"bool":t("m%s=Boolean(d%s)",i,i)}}return t}function v(t,n,e,i){if(n.resolvedType)n.resolvedType instanceof l?t("d%s=o.enums===String?types[%i].values[m%s]:m%s",i,e,i,i):t("d%s=types[%i].toObject(m%s,o)",i,e,i);else{var r=!1;switch(n.type){case"double":case"float":t("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",i,i,i,i);break;case"uint64":r=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":t('if(typeof m%s==="number")',i)("d%s=o.longs===String?String(m%s):m%s",i,i,i)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",i,i,i,i,r?"true":"",i);break;case"bytes":t("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",i,i,i,i,i);break;default:t("d%s=m%s",i,i)}}return t}n.fromObject=function(t){var n=t.fieldsArray,e=d.codegen(["d"],t.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!n.length)return e("return new this.ctor");e("var m=new this.ctor");for(var i=0;i<n.length;++i){var r=n[i].resolve(),o=d.safeProp(r.name);r.map?(e("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",r.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),s(e,r,i,o+"[ks[i]]")("}")("}")):r.repeated?(e("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",r.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),s(e,r,i,o+"[i]")("}")("}")):(r.resolvedType instanceof l||e("if(d%s!=null){",o),s(e,r,i,o),r.resolvedType instanceof l||e("}"))}return e("return m")},n.toObject=function(t){var n=t.fieldsArray.slice().sort(d.compareFieldsById);if(!n.length)return d.codegen()("return {}");for(var e=d.codegen(["m","o"],t.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],r=[],o=[],s=0;s<n.length;++s)n[s].partOf||(n[s].resolve().repeated?i:n[s].map?r:o).push(n[s]);if(i.length){for(e("if(o.arrays||o.defaults){"),s=0;s<i.length;++s)e("d%s=[]",d.safeProp(i[s].name));e("}")}if(r.length){for(e("if(o.objects||o.defaults){"),s=0;s<r.length;++s)e("d%s={}",d.safeProp(r[s].name));e("}")}if(o.length){for(e("if(o.defaults){"),s=0;s<o.length;++s){var a,u=o[s],c=d.safeProp(u.name);u.resolvedType instanceof l?e("d%s=o.enums===String?%j:%j",c,u.resolvedType.valuesById[u.typeDefault],u.typeDefault):u.long?e("if(util.Long){")("var n=new util.Long(%i,%i,%j)",u.typeDefault.low,u.typeDefault.high,u.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,u.typeDefault.toString(),u.typeDefault.toNumber()):u.bytes?(a="["+Array.prototype.slice.call(u.typeDefault).join(",")+"]",e("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,u.typeDefault))("else{")("d%s=%s",c,a)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")):e("d%s=%j",c,u.typeDefault)}e("}")}for(var f=!1,s=0;s<n.length;++s){var u=n[s],h=t.P.indexOf(u),c=d.safeProp(u.name);u.map?(f||(f=!0,e("var ks2")),e("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),v(e,u,h,c+"[ks2[j]]")("}")):u.repeated?(e("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),v(e,u,h,c+"[j]")("}")):(e("if(m%s!=null&&m.hasOwnProperty(%j)){",c,u.name),v(e,u,h,c),u.partOf&&e("if(o.oneofs)")("d%s=%j",d.safeProp(u.partOf.name),u.name)),e("}")}return e("return d")}},function(t,n,e){"use strict";var s=e(14);n[".google.protobuf.Any"]={fromObject:function(t){if(t&&t["@type"]){var n,e=t["@type"].substring(t["@type"].lastIndexOf("/")+1),e=this.lookup(e);if(e)return-1===(n="."===t["@type"].charAt(0)?t["@type"].substr(1):t["@type"]).indexOf("/")&&(n="/"+n),this.create({type_url:n,value:e.encode(e.fromObject(t)).finish()})}return this.fromObject(t)},toObject:function(t,n){var e,i,r="",o="";return!((t=n&&n.json&&t.type_url&&t.value&&(o=t.type_url.substring(t.type_url.lastIndexOf("/")+1),r=t.type_url.substring(0,t.type_url.lastIndexOf("/")+1),e=this.lookup(o))?e.decode(t.value):t)instanceof this.ctor)&&t instanceof s?(e=t.$type.toObject(t,n),i="."===t.$type.fullName[0]?t.$type.fullName.substr(1):t.$type.fullName,e["@type"]=o=(r=""===r?"type.googleapis.com/":r)+i,e):this.toObject(t,n)}}},function(t,n,e){"use strict";t.exports=u;var i,d,v,r=e(8),o=(((u.prototype=Object.create(r.prototype)).constructor=u).className="Root",e(7)),s=e(5),a=e(10),p=e(2);function u(t){r.call(this,"",t),this.deferred=[],this.files=[]}function m(){}u.fromJSON=function(t,n){return n=n||new u,t.options&&n.setOptions(t.options),n.addJSON(t.nested)},u.prototype.resolvePath=p.path.resolve,u.prototype.fetch=p.fetch,u.prototype.load=function t(n,o,r){"function"==typeof o&&(r=o,o=void 0);var s=this;if(!r)return p.asPromise(t,s,n,o);var a=r===m;function u(t,n){if(r){var e=r;if(r=null,a)throw t;e(t,n)}}function c(t){var n=t.lastIndexOf("google/protobuf/");if(-1<n){t=t.substring(n);if(t in v)return t}return null}function f(t,n){try{if(p.isString(n)&&"{"===n.charAt(0)&&(n=JSON.parse(n)),p.isString(n)){d.filename=t;var e,i=d(n,s,o),r=0;if(i.imports)for(;r<i.imports.length;++r)(e=c(i.imports[r])||s.resolvePath(t,i.imports[r]))&&h(e);if(i.weakImports)for(r=0;r<i.weakImports.length;++r)(e=c(i.weakImports[r])||s.resolvePath(t,i.weakImports[r]))&&h(e,!0)}else s.setOptions(n.options).addJSON(n.nested)}catch(t){u(t)}a||l||u(null,s)}function h(e,i){if(!(-1<s.files.indexOf(e)))if(s.files.push(e),e in v)a?f(e,v[e]):(++l,setTimeout(function(){--l,f(e,v[e])}));else if(a){var t;try{t=p.fs.readFileSync(e).toString("utf8")}catch(t){return void(i||u(t))}f(e,t)}else++l,s.fetch(e,function(t,n){--l,r&&(t?i?l||u(null,s):u(t):f(e,n))})}var l=0;p.isString(n)&&(n=[n]);for(var e,i=0;i<n.length;++i)(e=s.resolvePath("",n[i]))&&h(e);if(a)return s;l||u(null,s)},u.prototype.loadSync=function(t,n){if(p.isNode)return this.load(t,n,m);throw Error("not supported")},u.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(t){return"'extend "+t.extend+"' in "+t.parent.fullName}).join(", "));return r.prototype.resolveAll.call(this)};var c=/^[A-Z]/;function f(t,n){var e,i=n.parent.lookup(n.extend);if(i)return((e=new o(n.fullName,n.id,n.type,n.rule,void 0,n.options)).declaringField=n).extensionField=e,i.add(e),1}u.prototype.A=function(t){if(t instanceof o)void 0===t.extend||t.extensionField||f(0,t)||this.deferred.push(t);else if(t instanceof s)c.test(t.name)&&(t.parent[t.name]=t.values);else if(!(t instanceof a)){if(t instanceof i)for(var n=0;n<this.deferred.length;)f(0,this.deferred[n])?this.deferred.splice(n,1):++n;for(var e=0;e<t.nestedArray.length;++e)this.A(t.L[e]);c.test(t.name)&&(t.parent[t.name]=t)}},u.prototype.M=function(t){var n;if(t instanceof o)void 0!==t.extend&&(t.extensionField?(t.extensionField.parent.remove(t.extensionField),t.extensionField=null):-1<(n=this.deferred.indexOf(t))&&this.deferred.splice(n,1));else if(t instanceof s)c.test(t.name)&&delete t.parent[t.name];else if(t instanceof r){for(var e=0;e<t.nestedArray.length;++e)this.M(t.L[e]);c.test(t.name)&&delete t.parent[t.name]}},u.T=function(t,n,e){i=t,d=n,v=e}},function(t,n,e){var i;function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}i=function(t){"use strict";function n(t){return 180*t/Math.PI}function d(t){return n(Math.atan2(t[1][1]-t[0][1],t[1][0]-t[0][0]))}function l(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=[],i=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(e.push(s.value),!n||e.length!==n);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}return e}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(t){return function(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function v(t){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],t=l(t,2),e=l(t[0],2),i=e[0],r=e[1],e=l(t[1],2),o=e[0],s=e[1];return function(t){t=n?t<0?0:1<t?1:t:t;return[(o-i)*t+i,(s-r)*t+r]}}function p(t){return Math.sqrt(Math.pow(t[1][0]-t[0][0],2)+Math.pow(t[1][1]-t[0][1],2))}function r(t){return[(t[0][0]+t[1][0])/2,(t[0][1]+t[1][1])/2]}function o(t){return t/180*Math.PI}function s(t,n,e){n=o(n||0);return!e||0===e[0]&&0===e[1]?a(t,n):a(t.map(function(t,n){return t-e[n]}),n).map(function(t,n){return t+e[n]})}function a(t,n){return[t[0]*Math.cos(n)-t[1]*Math.sin(n),t[0]*Math.sin(n)+t[1]*Math.cos(n)]}function h(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=o(n);return[t[0]+e*Math.cos(n),t[1]+e*Math.sin(n)]}function m(t){for(var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],e=0,i=0,r=t.length;i<r;i++)var o=t[i],s=t[i===r-1?0:i+1],e=(e+=o[0]*s[1])-s[0]*o[1];return n?e/2:Math.abs(e/2)}function y(t){if(t.length<3)return null;for(var n=1/0,e=-1/0,i=1/0,r=-1/0,o=!1,s=0,a=t.length;s<a;s++){var u=t[s],c=u[0],u=u[1];null!=c&&isFinite(c)&&null!=u&&isFinite(u)&&(o=!0,c<n&&(n=c),e<c&&(e=c),u<i&&(i=u),r<u)&&(r=u)}return o?[[n,i],[e,r]]:null}function b(t){for(var n=0,e=0,i=0,r=t.length,o=0;o<r;o++){var s=t[o],a=t[o===r-1?0:o+1],u=s[0]*a[1]-a[0]*s[1];n+=u,e+=(s[0]+a[0])*u,i+=(s[1]+a[1])*u}var c=3*n;return[e/c,i/c]}function u(t,n,e){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])}function g(t){return e=(n=t)[0],n=n[n.length-1],e[0]===n[0]&&e[1]===n[1]?t:[].concat(i(t),[t[0]]);var n,e}function w(t){if(0===t.length)return 0;for(var n,e,i=-1,r=t.length,o=t[r-1],s=o[0],a=o[1],u=0;++i<r;)n=s,e=a,n-=s=(o=t[i])[0],e-=a=o[1],u+=Math.sqrt(n*n+e*e);return u}function _(t,n,e){e=e||b(t);for(var i=[],r=0,o=t.length;r<o;r++){var s=t[r],a=p([e,s]),s=d([e,s]);i[r]=h(e,s,a*Math.sqrt(n))}return i}function E(t,n,e){for(var i=[],r=0,o=t.length;r<o;r++)i[r]=h(t[r],n,e);return i}function S(t,n,e){for(var i=n,r=n,o=[],s=1;s<t.length-1;s++){var a=t[s];.5<Math.random()?(o.push(a-i),i=a):(o.push(r-a),r=a)}return o.push(e-i),o.push(r-e),o}function e(t){return t[1][1]>t[0][1]?t:[t[1],t[0]]}function f(t,n){var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=p(n);return c(t,n,e)&&p([n[0],t])<=i&&p([n[1],t])<=i}function c(t,n){var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return Math.abs(u(t,n[0],n[1]))<=e}function T(t,n){var e=l(t,2),i=l(e[0],2),r=i[0],i=i[1],e=l(e[1],2),o=e[0],e=e[1],s=l(n,2),a=l(s[0],2),u=a[0],a=a[1],s=l(s[1],2),c=s[0],s=s[1];return r===u&&i===a||o===c&&e===s||!!(f(t[0],n)||f(t[1],n)||f(n[0],t)||f(n[1],t))||0!=(n=(s-a)*(o-r)-(c-u)*(e-i))&&(e=((o-r)*(t=i-a)-(e-i)*(o=r-u))/n,0<(i=((c-u)*t-(s-a)*o)/n))&&i<1&&0<e&&e<1}function x(t,n){for(var e=!1,i=g(n),r=0,o=i.length-1;r<o;r++){var s=i[r],a=i[r+1];if(T(t,[s,a])||f(s,t)&&f(a,t)){e=!0;break}}return e}function A(t,n){for(var e=t[0],i=t[1],r=!1,o=0,s=n.length-1;o<n.length;s=o++){var a=n[o][0],u=n[o][1],c=n[s][0],f=n[s][1];i<u!=i<f&&e<(c-a)*(i-u)/(f-u)+a&&(r=!r)}return r}function M(t,n){for(var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=!1,r=g(n),o=0,s=r.length-1;o<s;o++)if(f(t,[r[o],r[o+1]],e)){i=!0;break}return i}t.lineAngle=d,t.lineInterpolate=v,t.lineLength=p,t.lineMidpoint=r,t.lineRotate=function(n,e,i){return n.map(function(t){return s(t,e,i||r(n))})},t.lineTranslate=function(t,n,e){return t.map(function(t){return h(t,n,e)})},t.pointRotate=s,t.pointTranslate=h,t.polygonArea=m,t.polygonBounds=y,t.polygonCentroid=b,t.polygonHull=function(t){if(t.length<3)return null;for(var n=t.slice().sort(function(t,n){return t[0]===n[0]?t[1]-n[1]:t[0]-n[0]}),e=[],i=0;i<n.length;i++){for(;2<=e.length&&u(e[e.length-2],e[e.length-1],n[i])<=0;)e.pop();e.push(n[i])}for(var r=[],o=n.length-1;0<=o;o--){for(;2<=r.length&&u(r[r.length-2],r[r.length-1],n[o])<=0;)r.pop();r.push(n[o])}return r.pop(),e.pop(),e.concat(r)},t.polygonInterpolate=function(f){return function(t){if(t<=0)return f[0];var n=g(f);if(1<=t)return n[n.length-1];for(var e=w(n)*t,i=[],r=0,o=0;o<n.length-1;o++){var s=[n[o],n[o+1]],a=p(s),u=d(s),c=e-(r+=a);if(c<0){i=h(s[0],u,a+c);break}o===f.length-2&&(i=h(s[0],u,c))}return i}},t.polygonLength=w,t.polygonMean=function(t){for(var n=0,e=0,i=t.length,r=0;r<i;r++){var o=t[r];n+=o[0],e+=o[1]}return[n/i,e/i]},t.polygonRandom=function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:3,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[0,0],i=Math.sqrt(n/Math.PI),r=Array.from({length:t},function(){return 2*i*Math.random()}),t=Array.from({length:t},function(){return 2*i*Math.random()}),r=(r.sort(function(t,n){return t-n}),t.sort(function(t,n){return t-n}),S(r,r[0],r[r.length-1])),o=S(t,t[0],t[t.length-1]),s=o,a=s.length-1;0<a;a--){var u=Math.floor(Math.random()*(a+1)),c=[s[u],s[a]];s[a]=c[0],s[u]=c[1]}var f=[],h=0,l=0,t=(r.map(function(t,n){return[t,o[n]]}).sort(function(t,n){return Math.atan2(n[1],n[0])-Math.atan2(t[1],t[0])}).forEach(function(t){h+=+t[0],l+=+t[1],f.push([h,l])}),b(f));return E(_(f,n/m(f)),d([t,e]),p([t,e]))},t.polygonReflectX=function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,e=l(y(t),2),i=l(e[0],2),r=i[0];i[1];for(var o=(i=l(e[1],2))[0],s=(i[1],[]),a=0,u=t.length;a<u;a++){var c=l(t[a],2),f=c[0],c=c[1],h=[r+o-f,c];0===n?s[a]=[f,c]:1===n?s[a]=h:(f=v([[f,c],h]),s[a]=f(Math.max(Math.min(n,1),0)))}return s},t.polygonReflectY=function(t){for(var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,e=l(y(t),2),i=l(e[0],2),r=(i[0],i[1]),o=((i=l(e[1],2))[0],i[1]),s=[],a=0,u=t.length;a<u;a++){var c=l(t[a],2),f=c[0],c=c[1],h=[f,r+o-c];0===n?s[a]=[f,c]:1===n?s[a]=h:(f=v([[f,c],h]),s[a]=f(Math.max(Math.min(n,1),0)))}return s},t.polygonRegular=function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:3,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100,e=2<arguments.length?arguments[2]:void 0,i=[],r=[0,0],o=[0,0],s=0,a=0;a<t;a++)i[a]=r,o[0]+=r[0],o[1]+=r[1],r=h(r,s,Math.sqrt(4*n*Math.tan(Math.PI/t)/t)),s-=360/t;return i=e?E(i,d(e=[[o[0]/t,o[1]/t],e]),p(e)):i},t.polygonRotate=function(t,n,e){for(var i=[],r=0,o=t.length;r<o;r++)i[r]=s(t[r],n,e);return i},t.polygonScale=function(t,n,e){e=e||b(t);for(var i=[],r=0,o=t.length;r<o;r++){var s=t[r],a=p([e,s]),s=d([e,s]);i[r]=h(e,s,a*n)}return i},t.polygonScaleArea=_,t.polygonScaleX=function(t,n,e){e=e||b(t);for(var i=[],r=0,o=t.length;r<o;r++){var s=t[r],a=p([e,s]),a=h(e,d([e,s]),a*n);i[r]=[a[0],s[1]]}return i},t.polygonScaleY=function(t,n,e){e=e||b(t);for(var i=[],r=0,o=t.length;r<o;r++){var s=t[r],a=p([e,s]),a=h(e,d([e,s]),a*n);i[r]=[s[0],a[1]]}return i},t.polygonTranslate=E,t.polygonWind=function(t){var n,e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"ccw";return t.length<3?null:(n=t.slice().reverse(),e=0<m(t,!0),"cw"===i||"clockwise"===i?e?t:n:e?n:t)},t.lineIntersectsLine=T,t.lineIntersectsPolygon=x,t.pointInPolygon=A,t.pointOnPolygon=M,t.pointLeftofLine=function(t,n){return n=e(n),u(t,n[1],n[0])<0},t.pointRightofLine=function(t,n){return n=e(n),0<u(t,n[1],n[0])},t.pointOnLine=f,t.pointWithLine=c,t.polygonInPolygon=function(t,n){for(var e=!0,i=g(t),r=0,o=i.length-1;r<o;r++){var s=i[r];if(!A(s,n)){e=!1;break}if(x([s,i[r+1]],n)){e=!1;break}}return e},t.polygonIntersectsPolygon=function(t,n){for(var e=!1,i=0,r=g(t),o=0,s=r.length-1;o<s;o++){var a=r[o];if(x([a,r[o+1]],n)){e=!0;break}if(M(a,n)&&++i,2===i){e=!0;break}}return e},t.angleReflect=function(t,n){return 360<=(n=2*n-t)?n-360:n<0?360+n:n},t.angleToDegrees=n,t.angleToRadians=o,Object.defineProperty(t,"u",{value:!0})},"object"===r(n)&&void 0!==t?i(n):void 0!==(n="function"==typeof(i=i)?i.apply(n,[n]):i)&&(t.exports=n)},function(t,n,e){"use strict";t.exports=e(33)},function(t,n,e){var i;i=function(){var c,r={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},o=(c=r.defaultRadius,t.prototype={k:function(t,n){var e=t[this.D],i=t[this.U],r=this.B,o=this.G,s=this.H,a=this.X,u=t[this.V]||1,t=t.radius||this.W||c,r=(o[e]||(o[e]=[],r[e]=[]),o[e][i]?o[e][i]+=u:(o[e][i]=u,r[e][i]=t),o[e][i]);return s<r?(n?this.setDataMax(r):this.H=r,!1):r<a?(n?this.setDataMin(r):this.X=r,!1):{x:e,y:i,value:u,radius:t,min:a,max:s}},Y:function(){var t,n=[],e=this.G,i=this.B;for(t in e)for(var r in e[t])n.push({x:t,y:r,radius:i[t][r],value:e[t][r]});return{min:this.X,max:this.H,data:n}},Z:function(){this.K.emit("extremachange",{min:this.X,max:this.H})},addData:function(){if(0<arguments[0].length)for(var t=arguments[0],n=t.length;n--;)this.addData.call(this,t[n]);else{var e=this.k(arguments[0],!0);e&&(0===this.G.length&&(this.X=this.H=e.value),this.K.emit("renderpartial",{min:this.X,max:this.H,data:[e]}))}return this},setData:function(t){var n=t.data,e=n.length;this.G=[],this.B=[];for(var i=0;i<e;i++)this.k(n[i],!1);return this.H=t.max,this.X=t.min||0,this.Z(),this.K.emit("renderall",this.J()),this},removeData:function(){},setDataMax:function(t){return this.H=t,this.Z(),this.K.emit("renderall",this.J()),this},setDataMin:function(t){return this.X=t,this.Z(),this.K.emit("renderall",this.J()),this},setCoordinator:function(t){this.K=t},J:function(){return{max:this.H,min:this.X,data:this.G,radi:this.B}},getData:function(){return this.Y()}},t);function t(t){this.K={},this.G=[],this.B=[],this.X=10,this.H=1,this.D=t.xField||t.defaultXField,this.U=t.yField||t.defaultYField,this.V=t.valueField||t.defaultValueField,t.radius&&(this.W=t.radius)}function i(t){var n,e=t.gradient||t.defaultGradient,i=(t=document.createElement("canvas")).getContext("2d"),r=(t.width=256,t.height=1,i.createLinearGradient(0,0,256,1));for(n in e)r.addColorStop(n,e[n]);return i.fillStyle=r,i.fillRect(0,0,256,1),i.getImageData(0,0,256,1).data}function n(t){var n=this.shadowCanvas=document.createElement("canvas"),e=this.canvas=t.canvas;this.$=[1e4,1e4,0,0];n.width=e.width,n.height=e.height,this.tt=e.width,this.nt=e.height,this.shadowCtx=n.getContext("2d"),this.ctx=e.getContext("2d"),this.et=i(t),this.it={},this.rt(t)}e=!(n.prototype={renderPartial:function(t){0<t.data.length&&(this.ot(t),this.st())},renderAll:function(t){this.ut(),0<t.data.length&&(this.ot(function(t){for(var n=[],e=t.min,i=t.max,r=t.radi,t=t.data,o=Object.keys(t),s=o.length;s--;)for(var a=o[s],u=Object.keys(t[a]),c=u.length;c--;){var f=u[c],h=t[a][f],l=r[a][f];n.push({x:a,y:f,value:h,radius:l})}return{min:e,max:i,data:n}}(t)),this.st())},ct:function(t){this.et=i(t)},updateConfig:function(t){t.gradient&&this.ct(t),this.rt(t)},setDimensions:function(t,n){this.tt=t,this.nt=n,this.canvas.width=this.shadowCanvas.width=t,this.canvas.height=this.shadowCanvas.height=n},ut:function(){this.shadowCtx.clearRect(0,0,this.tt,this.nt),this.ctx.clearRect(0,0,this.tt,this.nt)},rt:function(t){this.ft=0==t.blur?0:t.blur||t.defaultBlur,t.backgroundColor&&(this.canvas.style.backgroundColor=t.backgroundColor),this.tt=this.canvas.width=this.shadowCanvas.width=t.width||this.tt,this.nt=this.canvas.height=this.shadowCanvas.height=t.height||this.nt,this.ht=255*(t.opacity||0),this.lt=255*(t.maxOpacity||t.defaultMaxOpacity),this.dt=255*(t.minOpacity||t.defaultMinOpacity),this.vt=!!t.useGradientOpacity},ot:function(t){for(var n,e,i,r,o,s=this.X=t.min,a=this.H=t.max,u=(t=t.data||[]).length,c=1-this.ft;u--;){var f,h=t[u],l=h.x,d=h.y,v=h.radius,h=Math.min(h.value,a),l=l-v,d=d-v,p=this.shadowCtx,m=(this.it[v]?f=this.it[v]:this.it[v]=(n=v,e=c,o=m=r=i=void 0,i=document.createElement("canvas"),r=i.getContext("2d"),o=m=n,i.width=i.height=2*n,1==e?(r.beginPath(),r.arc(m,o,n,0,2*Math.PI,!1),r.fillStyle="rgba(0,0,0,1)",r.fill()):((e=r.createRadialGradient(m,o,n*e,m,o,n)).addColorStop(0,"rgba(0,0,0,1)"),e.addColorStop(1,"rgba(0,0,0,0)"),r.fillStyle=e,r.fillRect(0,0,2*n,2*n)),f=i),(h-s)/(a-s));p.globalAlpha=m<.01?.01:m,p.drawImage(f,l,d),l<this.$[0]&&(this.$[0]=l),d<this.$[1]&&(this.$[1]=d),l+2*v>this.$[2]&&(this.$[2]=l+2*v),d+2*v>this.$[3]&&(this.$[3]=d+2*v)}},st:function(){for(var t=this.$[0],n=this.$[1],e=this.$[2]-t,i=this.$[3]-n,r=this.tt,o=this.nt,s=this.ht,a=this.lt,u=this.dt,c=this.vt,r=this.shadowCtx.getImageData(t=t<0?0:t,n=n<0?0:n,e=r<t+e?r-t:e,i=o<n+i?o-n:i),f=r.data,h=f.length,l=this.et,d=3;d<h;d+=4){var v=f[d],p=4*v;p&&(v=0<s?s:v<a?v<u?u:v:a,f[d-3]=l[p],f[d-2]=l[1+p],f[d-1]=l[2+p],f[d]=c?l[3+p]:v)}r.data=f,this.ctx.putImageData(r,t,n),this.$=[1e3,1e3,0,0]},getValueAt:function(t){var t=this.shadowCtx.getImageData(t.x,t.y,1,1).data[3],n=this.H,e=this.X;return Math.abs(n-e)*(t/255)>>0},getDataURL:function(){return this.canvas.toDataURL()}});var e,s,a=e="canvas2d"===r.defaultRenderer?n:e,u=function(){for(var t={},n=arguments.length,e=0;e<n;e++){var i,r=arguments[e];for(i in r)t[i]=r[i]}return t},f=(h.prototype={on:function(t,n,e){var i=this.cStore;i[t]||(i[t]=[]),i[t].push(function(t){return n.call(e,t)})},emit:function(t,n){var e=this.cStore;if(e[t])for(var i=e[t].length,r=0;r<i;r++)(0,e[t][r])(n)}},s=h,l.prototype={addData:function(){return this.yt.addData.apply(this.yt,arguments),this},removeData:function(){return this.yt.removeData&&this.yt.removeData.apply(this.yt,arguments),this},setData:function(){return this.yt.setData.apply(this.yt,arguments),this},setDataMax:function(){return this.yt.setDataMax.apply(this.yt,arguments),this},setDataMin:function(){return this.yt.setDataMin.apply(this.yt,arguments),this},configure:function(t){return this.bt=u(this.bt,t),this.gt.updateConfig(this.bt),this.K.emit("renderall",this.yt.J()),this},repaint:function(){return this.K.emit("renderall",this.yt.J()),this},getData:function(){return this.yt.getData()},getDataURL:function(){return this.gt.getDataURL()},getValueAt:function(t){return this.yt.getValueAt?this.yt.getValueAt(t):this.gt.getValueAt?this.gt.getValueAt(t):null}},l);function h(){this.cStore={}}function l(){var n,t,e=this.bt=u(r,arguments[0]||{});if(this.K=new s,e.plugin){var i=e.plugin;if(!r.plugins[i])throw new Error("Plugin '"+i+"' not found. Maybe it was not registered.");var i=r.plugins[i];this.gt=new i.renderer(e),this.yt=new i.store(e)}else this.gt=new a(e),this.yt=new o(e);i=(n=this).gt,e=n.K,t=n.yt,e.on("renderpartial",i.renderPartial,i),e.on("renderall",i.renderAll,i),e.on("extremachange",function(t){n.bt.onExtremaChange&&n.bt.onExtremaChange({min:t.min,max:t.max,gradient:n.bt.gradient||n.bt.defaultGradient})}),t.setCoordinator(e)}return{create:function(t){return new f(t)},register:function(t,n){r.plugins[t]=n}}},t.exports?t.exports=i():void 0!==(e="function"==typeof(i=i)?i.call(n,e,n,t):i)&&(t.exports=e)},function(t,n,e){"use strict";var i=t.exports=e(34);i.build="light",i.load=function(t,n,e){return(n="function"==typeof n?(e=n,new i.Root):n||new i.Root).load(t,e)},i.loadSync=function(t,n){return(n=n||new i.Root).loadSync(t)},i.encoder=e(20),i.decoder=e(25),i.verifier=e(26),i.converter=e(27),i.ReflectionObject=e(6),i.Namespace=e(8),i.Root=e(29),i.Enum=e(5),i.Type=e(21),i.Field=e(7),i.OneOf=e(10),i.MapField=e(22),i.Service=e(23),i.Method=e(24),i.Message=e(14),i.wrappers=e(28),i.types=e(9),i.util=e(2),i.ReflectionObject.T(i.Root),i.Namespace.T(i.Type,i.Service,i.Enum),i.Root.T(i.Type),i.Field.T(i.Type)},function(t,n,e){"use strict";var i=n;function r(){i.util.T(),i.Writer.T(i.BufferWriter),i.Reader.T(i.BufferReader)}i.build="minimal",i.Writer=e(12),i.BufferWriter=e(41),i.Reader=e(13),i.BufferReader=e(42),i.util=e(4),i.rpc=e(18),i.roots=e(19),i.configure=r,r()},function(t,n,e){"use strict";n.length=function(t){var n=t.length;if(!n)return 0;for(var e=0;1<--n%4&&"="===t.charAt(n);)++e;return Math.ceil(3*t.length)/4-e};for(var c=new Array(64),u=new Array(123),i=0;i<64;)u[c[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;n.encode=function(t,n,e){for(var i,r=null,o=[],s=0,a=0;n<e;){var u=t[n++];switch(a){case 0:o[s++]=c[u>>2],i=(3&u)<<4,a=1;break;case 1:o[s++]=c[i|u>>4],i=(15&u)<<2,a=2;break;case 2:o[s++]=c[i|u>>6],o[s++]=c[63&u],a=0}8191<s&&((r=r||[]).push(String.fromCharCode.apply(String,o)),s=0)}return a&&(o[s++]=c[i],o[s++]=61,1===a)&&(o[s++]=61),r?(s&&r.push(String.fromCharCode.apply(String,o.slice(0,s))),r.join("")):String.fromCharCode.apply(String,o.slice(0,s))};var f="invalid encoding";n.decode=function(t,n,e){for(var i,r=e,o=0,s=0;s<t.length;){var a=t.charCodeAt(s++);if(61===a&&1<o)break;if(void 0===(a=u[a]))throw Error(f);switch(o){case 0:i=a,o=1;break;case 1:n[e++]=i<<2|(48&a)>>4,i=a,o=2;break;case 2:n[e++]=(15&i)<<4|(60&a)>>2,i=a,o=3;break;case 3:n[e++]=(3&i)<<6|a,o=0}}if(1===o)throw Error(f);return e-r},n.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}},function(t,n,e){"use strict";function i(){this.wt={}}(t.exports=i).prototype.on=function(t,n,e){return(this.wt[t]||(this.wt[t]=[])).push({fn:n,ctx:e||this}),this},i.prototype.off=function(t,n){if(void 0===t)this.wt={};else if(void 0===n)this.wt[t]=[];else for(var e=this.wt[t],i=0;i<e.length;)e[i].fn===n?e.splice(i,1):++i;return this},i.prototype.emit=function(t){var n=this.wt[t];if(n){for(var e=[],i=1;i<arguments.length;)e.push(arguments[i++]);for(i=0;i<n.length;)n[i].fn.apply(n[i++].ctx,e)}return this}},function(t,n,e){"use strict";function i(t){function n(t,n,e,i){var r=n<0?1:0;0===(n=r?-n:n)?t(0<1/n?0:2147483648,e,i):isNaN(n)?t(2143289344,e,i):t(34028234663852886e22<n?(r<<31|2139095040)>>>0:n<11754943508222875e-54?(r<<31|Math.round(n/1401298464324817e-60))>>>0:(r<<31|(t=Math.floor(Math.log(n)/Math.LN2))+127<<23|8388607&Math.round(n*Math.pow(2,-t)*8388608))>>>0,e,i)}function e(t,n,e){t=t(n,e),n=2*(t>>31)+1,e=t>>>23&255,t&=8388607;return 255==e?t?NaN:1/0*n:0==e?1401298464324817e-60*n*t:n*Math.pow(2,e-150)*(8388608+t)}function i(t,n,e){a[0]=t,n[e]=u[0],n[e+1]=u[1],n[e+2]=u[2],n[e+3]=u[3]}function r(t,n,e){a[0]=t,n[e]=u[3],n[e+1]=u[2],n[e+2]=u[1],n[e+3]=u[0]}function o(t,n){return u[0]=t[n],u[1]=t[n+1],u[2]=t[n+2],u[3]=t[n+3],a[0]}function s(t,n){return u[3]=t[n],u[2]=t[n+1],u[1]=t[n+2],u[0]=t[n+3],a[0]}var a,u,c,f,h;function l(t,n,e,i,r,o){var s,a,u=i<0?1:0;0===(i=u?-i:i)?(t(0,r,o+n),t(0<1/i?0:2147483648,r,o+e)):isNaN(i)?(t(0,r,o+n),t(2146959360,r,o+e)):17976931348623157e292<i?(t(0,r,o+n),t((u<<31|2146435072)>>>0,r,o+e)):i<22250738585072014e-324?(t((s=i/5e-324)>>>0,r,o+n),t((u<<31|s/4294967296)>>>0,r,o+e)):(1024===(a=Math.floor(Math.log(i)/Math.LN2))&&(a=1023),t(4503599627370496*(s=i*Math.pow(2,-a))>>>0,r,o+n),t((u<<31|a+1023<<20|1048576*s&1048575)>>>0,r,o+e))}function d(t,n,e,i,r){n=t(i,r+n),t=t(i,r+e),i=2*(t>>31)+1,r=t>>>20&2047,e=4294967296*(1048575&t)+n;return 2047==r?e?NaN:1/0*i:0==r?5e-324*i*e:i*Math.pow(2,r-1075)*(e+4503599627370496)}function v(t,n,e){c[0]=t,n[e]=f[0],n[e+1]=f[1],n[e+2]=f[2],n[e+3]=f[3],n[e+4]=f[4],n[e+5]=f[5],n[e+6]=f[6],n[e+7]=f[7]}function p(t,n,e){c[0]=t,n[e]=f[7],n[e+1]=f[6],n[e+2]=f[5],n[e+3]=f[4],n[e+4]=f[3],n[e+5]=f[2],n[e+6]=f[1],n[e+7]=f[0]}function m(t,n){return f[0]=t[n],f[1]=t[n+1],f[2]=t[n+2],f[3]=t[n+3],f[4]=t[n+4],f[5]=t[n+5],f[6]=t[n+6],f[7]=t[n+7],c[0]}function y(t,n){return f[7]=t[n],f[6]=t[n+1],f[5]=t[n+2],f[4]=t[n+3],f[3]=t[n+4],f[2]=t[n+5],f[1]=t[n+6],f[0]=t[n+7],c[0]}return"undefined"!=typeof Float32Array?(a=new Float32Array([-0]),u=new Uint8Array(a.buffer),h=128===u[3],t.writeFloatLE=h?i:r,t.writeFloatBE=h?r:i,t.readFloatLE=h?o:s,t.readFloatBE=h?s:o):(t.writeFloatLE=n.bind(null,b),t.writeFloatBE=n.bind(null,g),t.readFloatLE=e.bind(null,w),t.readFloatBE=e.bind(null,_)),"undefined"!=typeof Float64Array?(c=new Float64Array([-0]),f=new Uint8Array(c.buffer),h=128===f[7],t.writeDoubleLE=h?v:p,t.writeDoubleBE=h?p:v,t.readDoubleLE=h?m:y,t.readDoubleBE=h?y:m):(t.writeDoubleLE=l.bind(null,b,0,4),t.writeDoubleBE=l.bind(null,g,4,0),t.readDoubleLE=d.bind(null,w,0,4),t.readDoubleBE=d.bind(null,_,4,0)),t}function b(t,n,e){n[e]=255&t,n[e+1]=t>>>8&255,n[e+2]=t>>>16&255,n[e+3]=t>>>24}function g(t,n,e){n[e]=t>>>24,n[e+1]=t>>>16&255,n[e+2]=t>>>8&255,n[e+3]=255&t}function w(t,n){return(t[n]|t[n+1]<<8|t[n+2]<<16|t[n+3]<<24)>>>0}function _(t,n){return(t[n]<<24|t[n+1]<<16|t[n+2]<<8|t[n+3])>>>0}t.exports=i(i)},function(t,n,e){"use strict";n.length=function(t){for(var n,e=0,i=0;i<t.length;++i)(n=t.charCodeAt(i))<128?e+=1:n<2048?e+=2:55296==(64512&n)&&56320==(64512&t.charCodeAt(i+1))?(++i,e+=4):e+=3;return e},n.read=function(t,n,e){if(e-n<1)return"";for(var i,r=null,o=[],s=0;n<e;)(i=t[n++])<128?o[s++]=i:191<i&&i<224?o[s++]=(31&i)<<6|63&t[n++]:239<i&&i<365?(i=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536,o[s++]=55296+(i>>10),o[s++]=56320+(1023&i)):o[s++]=(15&i)<<12|(63&t[n++])<<6|63&t[n++],8191<s&&((r=r||[]).push(String.fromCharCode.apply(String,o)),s=0);return r?(s&&r.push(String.fromCharCode.apply(String,o.slice(0,s))),r.join("")):String.fromCharCode.apply(String,o.slice(0,s))},n.write=function(t,n,e){for(var i,r,o=e,s=0;s<t.length;++s)(i=t.charCodeAt(s))<128?n[e++]=i:(i<2048?n[e++]=i>>6|192:(55296==(64512&i)&&56320==(64512&(r=t.charCodeAt(s+1)))?(++s,n[e++]=(i=65536+((1023&i)<<10)+(1023&r))>>18|240,n[e++]=i>>12&63|128):n[e++]=i>>12|224,n[e++]=i>>6&63|128),n[e++]=63&i|128);return e-o}},function(t,n,e){"use strict";t.exports=function(n,e,t){var i=t||8192,r=i>>>1,o=null,s=i;return function(t){if(t<1||r<t)return n(t);i<s+t&&(o=n(i),s=0);t=e.call(o,s,s+=t);return 7&s&&(s=1+(7|s)),t}}},function(t,n,e){"use strict";t.exports=r;var i=e(4);function r(t,n){this.lo=t>>>0,this.hi=n>>>0}var o=r.zero=new r(0,0),s=(o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1},r.zeroHash="\0\0\0\0\0\0\0\0",r.fromNumber=function(t){var n,e;return 0===t?o:(e=(t=(n=t<0)?-t:t)>>>0,t=(t-e)/4294967296>>>0,n&&(t=~t>>>0,e=~e>>>0,4294967295<++e)&&(e=0,4294967295<++t)&&(t=0),new r(e,t))},r.from=function(t){if("number"==typeof t)return r.fromNumber(t);if(i.isString(t)){if(!i.Long)return r.fromNumber(parseInt(t,10));t=i.Long.fromString(t)}return t.low||t.high?new r(t.low>>>0,t.high>>>0):o},r.prototype.toNumber=function(t){var n;return!t&&this.hi>>>31?(t=1+~this.lo>>>0,n=~this.hi>>>0,-(t+4294967296*(n=t?n:n+1>>>0))):this.lo+4294967296*this.hi},r.prototype.toLong=function(t){return i.Long?new i.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}},String.prototype.charCodeAt);r.fromHash=function(t){return"\0\0\0\0\0\0\0\0"===t?o:new r((s.call(t,0)|s.call(t,1)<<8|s.call(t,2)<<16|s.call(t,3)<<24)>>>0,(s.call(t,4)|s.call(t,5)<<8|s.call(t,6)<<16|s.call(t,7)<<24)>>>0)},r.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},r.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},r.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},r.prototype.length=function(){var t=this.lo,n=(this.lo>>>28|this.hi<<4)>>>0,e=this.hi>>>24;return 0==e?0==n?t<16384?t<128?1:2:t<2097152?3:4:n<16384?n<128?5:6:n<2097152?7:8:e<128?9:10}},function(t,n,e){"use strict";t.exports=o;var i=e(12),r=((o.prototype=Object.create(i.prototype)).constructor=o,e(4));function o(){i.call(this)}function s(t,n,e){t.length<40?r.utf8.write(t,n,e):n.utf8Write?n.utf8Write(t,e):n.write(t,e)}o.T=function(){o.alloc=r.S,o.writeBytesBuffer=r.Buffer&&r.Buffer.prototype instanceof Uint8Array&&"set"===r.Buffer.prototype.set.name?function(t,n,e){n.set(t,e)}:function(t,n,e){if(t.copy)t.copy(n,e,0,t.length);else for(var i=0;i<t.length;)n[e++]=t[i++]}},o.prototype.bytes=function(t){var n=(t=r.isString(t)?r._(t,"base64"):t).length>>>0;return this.uint32(n),n&&this.R(o.writeBytesBuffer,n,t),this},o.prototype.string=function(t){var n=r.Buffer.byteLength(t);return this.uint32(n),n&&this.R(s,n,t),this},o.T()},function(t,n,e){"use strict";t.exports=o;var i=e(13),r=((o.prototype=Object.create(i.prototype)).constructor=o,e(4));function o(t){i.call(this,t)}o.T=function(){r.Buffer&&(o.prototype.N=r.Buffer.prototype.slice)},o.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},o.T()},function(t,n,e){"use strict";t.exports=i;var a=e(4);function i(t,n,e){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");a.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(n),this.responseDelimited=Boolean(e)}((i.prototype=Object.create(a.EventEmitter.prototype)).constructor=i).prototype.rpcCall=function t(e,n,i,r,o){if(!r)throw TypeError("request must be specified");var s=this;if(!o)return a.asPromise(t,s,e,n,i,r);if(s.rpcImpl)try{return s.rpcImpl(e,n[s.requestDelimited?"encodeDelimited":"encode"](r).finish(),function(t,n){if(t)return s.emit("error",t,e),o(t);if(null!==n){if(!(n instanceof i))try{n=i[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(t){return s.emit("error",t,e),o(t)}return s.emit("data",n,e),o(null,n)}s.end(!0)})}catch(t){s.emit("error",t,e),setTimeout(function(){o(t)},0)}else setTimeout(function(){o(Error("already ended"))},0)},i.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(t,n,e){"use strict";function i(n,e){"string"==typeof n&&(e=n,n=void 0);var u=[];function c(t){if("string"!=typeof t){var n="return "+f();if(t){for(var e=Object.keys(t),i=new Array(e.length+1),r=new Array(e.length),o=0;o<e.length;)i[o]=e[o],r[o]=t[e[o++]];return i[o]=n,Function.apply(null,i).apply(null,r)}return Function(n)()}for(var s=new Array(arguments.length-1),a=0;a<s.length;)s[a]=arguments[++a];if(a=0,t=t.replace(/%([%dfijs])/g,function(t,n){var e=s[a++];switch(n){case"d":case"f":return String(Number(e));case"i":return String(Math.floor(e));case"j":return JSON.stringify(e);case"s":return String(e)}return"%"}),a!==s.length)throw Error("parameter count mismatch");return u.push(t),c}function f(t){return"function "+(t||e||"")+"("+(n&&n.join(",")||"")+"){\n  "+u.join("\n  ")+"\n}"}return c.toString=f,c}(t.exports=i).verbose=!1},function(t,n,e){"use strict";t.exports=a;var o=e(16),s=e(17)("fs");function a(e,i,r){return i="function"==typeof i?(r=i,{}):i||{},r?!i.xhr&&s&&s.readFile?s.readFile(e,function(t,n){return t&&"undefined"!=typeof XMLHttpRequest?a.xhr(e,i,r):t?r(t):r(null,i.binary?n:n.toString("utf8"))}):a.xhr(e,i,r):o(a,this,e,i)}a.xhr=function(t,e,i){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState){if(0!==r.status&&200!==r.status)return i(Error("status "+r.status));if(e.binary){if(!(t=r.response))for(var t=[],n=0;n<r.responseText.length;++n)t.push(255&r.responseText.charCodeAt(n));return i(null,"undefined"!=typeof Uint8Array?new Uint8Array(t):t)}return i(null,r.responseText)}},e.binary&&("overrideMimeType"in r&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.responseType="arraybuffer"),r.open("GET",t),r.send()}},function(t,n,e){"use strict";var r=n.isAbsolute=function(t){return/^(?:\/|\w+:)/.test(t)},i=n.normalize=function(t){var n=(t=t.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),e=r(t),t="";e&&(t=n.shift()+"/");for(var i=0;i<n.length;)".."===n[i]?0<i&&".."!==n[i-1]?n.splice(--i,2):e?n.splice(i,1):++i:"."===n[i]?n.splice(i,1):++i;return t+n.join("/")};n.resolve=function(t,n,e){return e||(n=i(n)),!r(n)&&(t=(t=e?t:i(t)).replace(/(?:\/|^)[^/]+$/,"")).length?i(t+"/"+n):n}},function(i,r,t){"use strict";t.r(r);var u={};t.r(u),t.d(u,"ShadowMaterial",function(){return Rd}),t.d(u,"SpriteMaterial",function(){return sl}),t.d(u,"RawShaderMaterial",function(){return ul}),t.d(u,"ShaderMaterial",function(){return Hs}),t.d(u,"PointsMaterial",function(){return Nd}),t.d(u,"MeshPhysicalMaterial",function(){return jd}),t.d(u,"MeshStandardMaterial",function(){return Pd}),t.d(u,"MeshPhongMaterial",function(){return Fd}),t.d(u,"MeshToonMaterial",function(){return Id}),t.d(u,"MeshNormalMaterial",function(){return Cd}),t.d(u,"MeshLambertMaterial",function(){return kd}),t.d(u,"MeshDepthMaterial",function(){return ac}),t.d(u,"MeshDistanceMaterial",function(){return uc}),t.d(u,"MeshBasicMaterial",function(){return ta}),t.d(u,"MeshMatcapMaterial",function(){return Dd}),t.d(u,"LineDashedMaterial",function(){return Ud}),t.d(u,"LineBasicMaterial",function(){return al}),t.d(u,"Material",function(){return h});for(var b="v3.1.7",T=62,s=[],x=0;x<256;x++)s[x]=(x<16?"0":"")+x.toString(16);var Tt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(s[255&t]+s[t>>8&255]+s[t>>16&255]+s[t>>24&255]+"-"+s[255&n]+s[n>>8&255]+"-"+s[n>>16&15|64]+s[n>>24&255]+"-"+s[63&e|128]+s[e>>8&255]+"-"+s[e>>16&255]+s[e>>24&255]+s[255&i]+s[i>>8&255]+s[i>>16&255]+s[i>>24&255]).toUpperCase()},clamp:function(t,n,e){return Math.max(n,Math.min(e,t))},euclideanModulo:function(t,n){return(t%n+n)%n},mapLinear:function(t,n,e,i,r){return i+(t-n)*(r-i)/(e-n)},lerp:function(t,n,e){return(1-e)*t+e*n},smoothstep:function(t,n,e){return t<=n?0:e<=t?1:(t=(t-n)/(e-n))*t*(3-2*t)},smootherstep:function(t,n,e){return t<=n?0:e<=t?1:(t=(t-n)/(e-n))*t*t*(t*(6*t-15)+10)},randInt:function(t,n){return t+Math.floor(Math.random()*(n-t+1))},randFloat:function(t,n){return t+Math.random()*(n-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*Tt.DEG2RAD},radToDeg:function(t){return t*Tt.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,n,e,i,r){var o=Math.cos,s=Math.sin,a=o(e/2),e=s(e/2),u=o((n+i)/2),c=s((n+i)/2),f=o((n-i)/2),h=s((n-i)/2),o=o((i-n)/2),s=s((i-n)/2);"XYX"===r?t.set(a*c,e*f,e*h,a*u):"YZY"===r?t.set(e*h,a*c,e*f,a*u):"ZXZ"===r?t.set(e*f,e*h,a*c,a*u):"XZX"===r?t.set(a*c,e*s,e*o,a*u):"YXY"===r?t.set(e*o,a*c,e*s,a*u):"ZYZ"===r?t.set(e*s,e*o,a*c,a*u):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function at(t,n,e,i){this._t=t||0,this.Et=n||0,this.St=e||0,this.Tt=void 0!==i?i:1}Object.assign(at,{slerp:function(t,n,e,i){return e.copy(t).slerp(n,i)},slerpFlat:function(t,n,e,i,r,o,s){var a,u,c,f=e[i+0],h=e[i+1],l=e[i+2],e=e[i+3],i=r[o+0],d=r[o+1],v=r[o+2],r=r[o+3];e===r&&f===i&&h===d&&l===v||(o=1-s,a=0<=(u=f*i+h*d+l*v+e*r)?1:-1,(c=1-u*u)>Number.EPSILON&&(c=Math.sqrt(c),u=Math.atan2(c,u*a),o=Math.sin(o*u)/c,s=Math.sin(s*u)/c),f=f*o+i*(u=s*a),h=h*o+d*u,l=l*o+v*u,e=e*o+r*u,o===1-s&&(f*=c=1/Math.sqrt(f*f+h*h+l*l+e*e),h*=c,l*=c,e*=c)),t[n]=f,t[n+1]=h,t[n+2]=l,t[n+3]=e}}),Object.defineProperties(at.prototype,{x:{get:function(){return this._t},set:function(t){this._t=t,this.xt()}},y:{get:function(){return this.Et},set:function(t){this.Et=t,this.xt()}},z:{get:function(){return this.St},set:function(t){this.St=t,this.xt()}},w:{get:function(){return this.Tt},set:function(t){this.Tt=t,this.xt()}}}),Object.assign(at.prototype,{isQuaternion:!0,set:function(t,n,e,i){return this._t=t,this.Et=n,this.St=e,this.Tt=i,this.xt(),this},clone:function(){return new this.constructor(this._t,this.Et,this.St,this.Tt)},copy:function(t){return this._t=t.x,this.Et=t.y,this.St=t.z,this.Tt=t.w,this.xt(),this},setFromEuler:function(t,n){var e,i,r,o,s,a,u;if(t&&t.isEuler)return s=t._t,a=t.Et,e=t.St,t=t.order,o=Math.cos,u=Math.sin,i=o(s/2),r=o(a/2),o=o(e/2),s=u(s/2),a=u(a/2),u=u(e/2),"XYZ"===t?(this._t=s*r*o+i*a*u,this.Et=i*a*o-s*r*u,this.St=i*r*u+s*a*o,this.Tt=i*r*o-s*a*u):"YXZ"===t?(this._t=s*r*o+i*a*u,this.Et=i*a*o-s*r*u,this.St=i*r*u-s*a*o,this.Tt=i*r*o+s*a*u):"ZXY"===t?(this._t=s*r*o-i*a*u,this.Et=i*a*o+s*r*u,this.St=i*r*u+s*a*o,this.Tt=i*r*o-s*a*u):"ZYX"===t?(this._t=s*r*o-i*a*u,this.Et=i*a*o+s*r*u,this.St=i*r*u-s*a*o,this.Tt=i*r*o+s*a*u):"YZX"===t?(this._t=s*r*o+i*a*u,this.Et=i*a*o+s*r*u,this.St=i*r*u-s*a*o,this.Tt=i*r*o-s*a*u):"XZY"===t&&(this._t=s*r*o-i*a*u,this.Et=i*a*o-s*r*u,this.St=i*r*u+s*a*o,this.Tt=i*r*o+s*a*u),!1!==n&&this.xt(),this;throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.")},setFromAxisAngle:function(t,n){var n=n/2,e=Math.sin(n);return this._t=t.x*e,this.Et=t.y*e,this.St=t.z*e,this.Tt=Math.cos(n),this.xt(),this},setFromRotationMatrix:function(t){var n,t=t.elements,e=t[0],i=t[4],r=t[8],o=t[1],s=t[5],a=t[9],u=t[2],c=t[6],t=t[10],f=e+s+t;return 0<f?(n=.5/Math.sqrt(f+1),this.Tt=.25/n,this._t=(c-a)*n,this.Et=(r-u)*n,this.St=(o-i)*n):s<e&&t<e?(n=2*Math.sqrt(1+e-s-t),this.Tt=(c-a)/n,this._t=.25*n,this.Et=(i+o)/n,this.St=(r+u)/n):t<s?(n=2*Math.sqrt(1+s-e-t),this.Tt=(r-u)/n,this._t=(i+o)/n,this.Et=.25*n,this.St=(a+c)/n):(n=2*Math.sqrt(1+t-e-s),this.Tt=(o-i)/n,this._t=(r+u)/n,this.Et=(a+c)/n,this.St=.25*n),this.xt(),this},setFromUnitVectors:function(t,n){var e=t.dot(n)+1;return e<1e-6?(e=0,Math.abs(t.x)>Math.abs(t.z)?(this._t=-t.y,this.Et=t.x,this.St=0):(this._t=0,this.Et=-t.z,this.St=t.y)):(this._t=t.y*n.z-t.z*n.y,this.Et=t.z*n.x-t.x*n.z,this.St=t.x*n.y-t.y*n.x),this.Tt=e,this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(Tt.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,n){var e=this.angleTo(t);return 0!==e&&(n=Math.min(1,n/e),this.slerp(t,n)),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._t*=-1,this.Et*=-1,this.St*=-1,this.xt(),this},dot:function(t){return this._t*t._t+this.Et*t.Et+this.St*t.St+this.Tt*t.Tt},lengthSq:function(){return this._t*this._t+this.Et*this.Et+this.St*this.St+this.Tt*this.Tt},length:function(){return Math.sqrt(this._t*this._t+this.Et*this.Et+this.St*this.St+this.Tt*this.Tt)},normalize:function(){var t=this.length();return 0===t?(this._t=0,this.Et=0,this.St=0,this.Tt=1):(this._t=this._t*(t=1/t),this.Et=this.Et*t,this.St=this.St*t,this.Tt=this.Tt*t),this.xt(),this},multiply:function(t,n){return void 0!==n?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,n)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,n){var e=t._t,i=t.Et,r=t.St,t=t.Tt,o=n._t,s=n.Et,a=n.St,n=n.Tt;return this._t=e*n+t*o+i*a-r*s,this.Et=i*n+t*s+r*o-e*a,this.St=r*n+t*a+e*s-i*o,this.Tt=t*n-e*o-i*s-r*a,this.xt(),this},slerp:function(t,n){if(0!==n){if(1===n)return this.copy(t);var e,i=this._t,r=this.Et,o=this.St,s=this.Tt,a=s*t.Tt+i*t._t+r*t.Et+o*t.St;a<0?(this.Tt=-t.Tt,this._t=-t._t,this.Et=-t.Et,this.St=-t.St,a=-a):this.copy(t),1<=a?(this.Tt=s,this._t=i,this.Et=r,this.St=o):((t=1-a*a)<=Number.EPSILON?(this.Tt=(e=1-n)*s+n*this.Tt,this._t=e*i+n*this._t,this.Et=e*r+n*this.Et,this.St=e*o+n*this.St,this.normalize()):(e=Math.sqrt(t),t=Math.atan2(e,a),a=Math.sin((1-n)*t)/e,n=Math.sin(n*t)/e,this.Tt=s*a+this.Tt*n,this._t=i*a+this._t*n,this.Et=r*a+this.Et*n,this.St=o*a+this.St*n),this.xt())}return this},equals:function(t){return t._t===this._t&&t.Et===this.Et&&t.St===this.St&&t.Tt===this.Tt},fromArray:function(t,n){return this._t=t[n=void 0===n?0:n],this.Et=t[n+1],this.St=t[n+2],this.Tt=t[n+3],this.xt(),this},toArray:function(t,n){return(t=void 0===t?[]:t)[n=void 0===n?0:n]=this._t,t[n+1]=this.Et,t[n+2]=this.St,t[n+3]=this.Tt,t},fromBufferAttribute:function(t,n){return this._t=t.getX(n),this.Et=t.getY(n),this.St=t.getZ(n),this.Tt=t.getW(n),this},onChange:function(t){return this.xt=t,this},xt:function(){}});var A=new xt,M=new at;function xt(t,n,e){this.x=t||0,this.y=n||0,this.z=e||0}Object.assign(xt.prototype,{isVector3:!0,set:function(t,n,e){return this.x=t,this.y=n,this.z=e,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,n){return void 0!==n?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,n)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this.z=t.z+n.z,this},addScaledVector:function(t,n){return this.x+=t.x*n,this.y+=t.y*n,this.z+=t.z*n,this},sub:function(t,n){return void 0!==n?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,n)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this.z=t.z-n.z,this},multiply:function(t,n){return void 0!==n?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,n)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,n){return this.x=t.x*n.x,this.y=t.y*n.y,this.z=t.z*n.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(M.setFromEuler(t))},applyAxisAngle:function(t,n){return this.applyQuaternion(M.setFromAxisAngle(t,n))},applyMatrix3:function(t){var n=this.x,e=this.y,i=this.z,t=t.elements;return this.x=t[0]*n+t[3]*e+t[6]*i,this.y=t[1]*n+t[4]*e+t[7]*i,this.z=t[2]*n+t[5]*e+t[8]*i,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var n=this.x,e=this.y,i=this.z,t=t.elements,r=1/(t[3]*n+t[7]*e+t[11]*i+t[15]);return this.x=(t[0]*n+t[4]*e+t[8]*i+t[12])*r,this.y=(t[1]*n+t[5]*e+t[9]*i+t[13])*r,this.z=(t[2]*n+t[6]*e+t[10]*i+t[14])*r,this},applyQuaternion:function(t){var n=this.x,e=this.y,i=this.z,r=t.x,o=t.y,s=t.z,t=t.w,a=t*n+o*i-s*e,u=t*e+s*n-r*i,c=t*i+r*e-o*n,n=-r*n-o*e-s*i;return this.x=a*t+n*-r+u*-s-c*-o,this.y=u*t+n*-o+c*-r-a*-s,this.z=c*t+n*-s+a*-o-u*-r,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var n=this.x,e=this.y,i=this.z,t=t.elements;return this.x=t[0]*n+t[4]*e+t[8]*i,this.y=t[1]*n+t[5]*e+t[9]*i,this.z=t[2]*n+t[6]*e+t[10]*i,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this.z=Math.max(t.z,Math.min(n.z,this.z)),this},clampScalar:function(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this.z=Math.max(t,Math.min(n,this.z)),this},clampLength:function(t,n){var e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(n,e)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this.z+=(t.z-this.z)*n,this},lerpVectors:function(t,n,e){return this.subVectors(n,t).multiplyScalar(e).add(t)},cross:function(t,n){return void 0!==n?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,n)):this.crossVectors(this,t)},crossVectors:function(t,n){var e=t.x,i=t.y,t=t.z,r=n.x,o=n.y,n=n.z;return this.x=i*n-t*o,this.y=t*r-e*n,this.z=e*o-i*r,this},projectOnVector:function(t){var n=t.lengthSq();return 0===n?this.set(0,0,0):(n=t.dot(this)/n,this.copy(t).multiplyScalar(n))},projectOnPlane:function(t){return A.copy(this).projectOnVector(t),this.sub(A)},reflect:function(t){return this.sub(A.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var n=Math.sqrt(this.lengthSq()*t.lengthSq());return 0===n?Math.PI/2:(t=this.dot(t)/n,Math.acos(Tt.clamp(t,-1,1)))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var n=this.x-t.x,e=this.y-t.y,t=this.z-t.z;return n*n+e*e+t*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,n,e){var i=Math.sin(n)*t;return this.x=i*Math.sin(e),this.y=Math.cos(n)*t,this.z=i*Math.cos(e),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,n,e){return this.x=t*Math.sin(n),this.y=e,this.z=t*Math.cos(n),this},setFromMatrixPosition:function(t){t=t.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(t){var n=this.setFromMatrixColumn(t,0).length(),e=this.setFromMatrixColumn(t,1).length(),t=this.setFromMatrixColumn(t,2).length();return this.x=n,this.y=e,this.z=t,this},setFromMatrixColumn:function(t,n){return this.fromArray(t.elements,4*n)},setFromMatrix3Column:function(t,n){return this.fromArray(t.elements,3*n)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,n){return this.x=t[n=void 0===n?0:n],this.y=t[n+1],this.z=t[n+2],this},toArray:function(t,n){return(t=void 0===t?[]:t)[n=void 0===n?0:n]=this.x,t[n+1]=this.y,t[n+2]=this.z,t},fromBufferAttribute:function(t,n,e){return void 0!==e&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(n),this.y=t.getY(n),this.z=t.getZ(n),this}});var O=new xt,L=new At,P=new xt(0,0,0),j=new xt(1,1,1),F=new xt,C=new xt,k=new xt;function At(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function D(){}Object.assign(At.prototype,{isMatrix4:!0,set:function(t,n,e,i,r,o,s,a,u,c,f,h,l,d,v,p){var m=this.elements;return m[0]=t,m[4]=n,m[8]=e,m[12]=i,m[1]=r,m[5]=o,m[9]=s,m[13]=a,m[2]=u,m[6]=c,m[10]=f,m[14]=h,m[3]=l,m[7]=d,m[11]=v,m[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new At).fromArray(this.elements)},copy:function(t){var n=this.elements,t=t.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],this},copyPosition:function(t){var n=this.elements,t=t.elements;return n[12]=t[12],n[13]=t[13],n[14]=t[14],this},extractBasis:function(t,n,e){return t.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),e.setFromMatrixColumn(this,2),this},makeBasis:function(t,n,e){return this.set(t.x,n.x,e.x,0,t.y,n.y,e.y,0,t.z,n.z,e.z,0,0,0,0,1),this},extractRotation:function(t){var n=this.elements,e=t.elements,i=1/O.setFromMatrixColumn(t,0).length(),r=1/O.setFromMatrixColumn(t,1).length(),t=1/O.setFromMatrixColumn(t,2).length();return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=0,n[4]=e[4]*r,n[5]=e[5]*r,n[6]=e[6]*r,n[7]=0,n[8]=e[8]*t,n[9]=e[9]*t,n[10]=e[10]*t,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var n,e,i,r,o,s,a,u,c,f,h,l,d=this.elements,v=t.x,p=t.y,m=t.z,y=Math.cos(v),v=Math.sin(v),b=Math.cos(p),p=Math.sin(p),g=Math.cos(m),m=Math.sin(m);return"XYZ"===t.order?(o=y*g,s=y*m,a=v*g,u=v*m,d[0]=b*g,d[4]=-b*m,d[8]=p,d[1]=s+a*p,d[5]=o-u*p,d[9]=-v*b,d[2]=u-o*p,d[6]=a+s*p,d[10]=y*b):"YXZ"===t.order?(e=b*m,i=p*g,d[0]=(n=b*g)+(r=p*m)*v,d[4]=i*v-e,d[8]=y*p,d[1]=y*m,d[5]=y*g,d[9]=-v,d[2]=e*v-i,d[6]=r+n*v,d[10]=y*b):"ZXY"===t.order?(e=b*m,i=p*g,d[0]=(n=b*g)-(r=p*m)*v,d[4]=-y*m,d[8]=i+e*v,d[1]=e+i*v,d[5]=y*g,d[9]=r-n*v,d[2]=-y*p,d[6]=v,d[10]=y*b):"ZYX"===t.order?(o=y*g,s=y*m,a=v*g,u=v*m,d[0]=b*g,d[4]=a*p-s,d[8]=o*p+u,d[1]=b*m,d[5]=u*p+o,d[9]=s*p-a,d[2]=-p,d[6]=v*b,d[10]=y*b):"YZX"===t.order?(c=y*b,f=y*p,h=v*b,l=v*p,d[0]=b*g,d[4]=l-c*m,d[8]=h*m+f,d[1]=m,d[5]=y*g,d[9]=-v*g,d[2]=-p*g,d[6]=f*m+h,d[10]=c-l*m):"XZY"===t.order&&(c=y*b,f=y*p,h=v*b,l=v*p,d[0]=b*g,d[4]=-m,d[8]=p*g,d[1]=c*m+l,d[5]=y*g,d[9]=f*m-h,d[2]=h*m-f,d[6]=v*g,d[10]=l*m+c),d[3]=0,d[7]=0,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(P,t,j)},lookAt:function(t,n,e){var i=this.elements;return k.subVectors(t,n),0===k.lengthSq()&&(k.z=1),k.normalize(),F.crossVectors(e,k),0===F.lengthSq()&&(1===Math.abs(e.z)?k.x+=1e-4:k.z+=1e-4,k.normalize(),F.crossVectors(e,k)),F.normalize(),C.crossVectors(k,F),i[0]=F.x,i[4]=C.x,i[8]=k.x,i[1]=F.y,i[5]=C.y,i[9]=k.y,i[2]=F.z,i[6]=C.z,i[10]=k.z,this},multiply:function(t,n){return void 0!==n?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,n)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,n){var t=t.elements,n=n.elements,e=this.elements,i=t[0],r=t[4],o=t[8],s=t[12],a=t[1],u=t[5],c=t[9],f=t[13],h=t[2],l=t[6],d=t[10],v=t[14],p=t[3],m=t[7],y=t[11],t=t[15],b=n[0],g=n[4],w=n[8],_=n[12],E=n[1],S=n[5],T=n[9],x=n[13],A=n[2],M=n[6],O=n[10],L=n[14],R=n[3],N=n[7],P=n[11],n=n[15];return e[0]=i*b+r*E+o*A+s*R,e[4]=i*g+r*S+o*M+s*N,e[8]=i*w+r*T+o*O+s*P,e[12]=i*_+r*x+o*L+s*n,e[1]=a*b+u*E+c*A+f*R,e[5]=a*g+u*S+c*M+f*N,e[9]=a*w+u*T+c*O+f*P,e[13]=a*_+u*x+c*L+f*n,e[2]=h*b+l*E+d*A+v*R,e[6]=h*g+l*S+d*M+v*N,e[10]=h*w+l*T+d*O+v*P,e[14]=h*_+l*x+d*L+v*n,e[3]=p*b+m*E+y*A+t*R,e[7]=p*g+m*S+y*M+t*N,e[11]=p*w+m*T+y*O+t*P,e[15]=p*_+m*x+y*L+t*n,this},multiplyScalar:function(t){var n=this.elements;return n[0]*=t,n[4]*=t,n[8]*=t,n[12]*=t,n[1]*=t,n[5]*=t,n[9]*=t,n[13]*=t,n[2]*=t,n[6]*=t,n[10]*=t,n[14]*=t,n[3]*=t,n[7]*=t,n[11]*=t,n[15]*=t,this},determinant:function(){var t=this.elements,n=t[0],e=t[4],i=t[8],r=t[12],o=t[1],s=t[5],a=t[9],u=t[13],c=t[2],f=t[6],h=t[10],l=t[14];return t[3]*(+r*a*f-i*u*f-r*s*h+e*u*h+i*s*l-e*a*l)+t[7]*(+n*a*l-n*u*h+r*o*h-i*o*l+i*u*c-r*a*c)+t[11]*(+n*u*f-n*s*l-r*o*f+e*o*l+r*s*c-e*u*c)+t[15]*(-i*s*c-n*a*f+n*s*h+i*o*f-e*o*h+e*a*c)},transpose:function(){var t=this.elements,n=t[1];return t[1]=t[4],t[4]=n,n=t[2],t[2]=t[8],t[8]=n,n=t[6],t[6]=t[9],t[9]=n,n=t[3],t[3]=t[12],t[12]=n,n=t[7],t[7]=t[13],t[13]=n,n=t[11],t[11]=t[14],t[14]=n,this},setPosition:function(t,n,e){var i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=n,i[14]=e),this},getInverse:function(t,n){void 0!==n&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");var n=this.elements,t=t.elements,e=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],u=t[6],c=t[7],f=t[8],h=t[9],l=t[10],d=t[11],v=t[12],p=t[13],m=t[14],t=t[15],y=h*m*c-p*l*c+p*u*d-a*m*d-h*u*t+a*l*t,b=v*l*c-f*m*c-v*u*d+s*m*d+f*u*t-s*l*t,g=f*p*c-v*h*c+v*a*d-s*p*d-f*a*t+s*h*t,w=v*h*u-f*p*u-v*a*l+s*p*l+f*a*m-s*h*m,_=e*y+i*b+r*g+o*w;return 0==_?this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0):(n[0]=y*(y=1/_),n[1]=(p*l*o-h*m*o-p*r*d+i*m*d+h*r*t-i*l*t)*y,n[2]=(a*m*o-p*u*o+p*r*c-i*m*c-a*r*t+i*u*t)*y,n[3]=(h*u*o-a*l*o-h*r*c+i*l*c+a*r*d-i*u*d)*y,n[4]=b*y,n[5]=(f*m*o-v*l*o+v*r*d-e*m*d-f*r*t+e*l*t)*y,n[6]=(v*u*o-s*m*o-v*r*c+e*m*c+s*r*t-e*u*t)*y,n[7]=(s*l*o-f*u*o+f*r*c-e*l*c-s*r*d+e*u*d)*y,n[8]=g*y,n[9]=(v*h*o-f*p*o-v*i*d+e*p*d+f*i*t-e*h*t)*y,n[10]=(s*p*o-v*a*o+v*i*c-e*p*c-s*i*t+e*a*t)*y,n[11]=(f*a*o-s*h*o-f*i*c+e*h*c+s*i*d-e*a*d)*y,n[12]=w*y,n[13]=(f*p*r-v*h*r+v*i*l-e*p*l-f*i*m+e*h*m)*y,n[14]=(v*a*r-s*p*r-v*i*u+e*p*u+s*i*m-e*a*m)*y,n[15]=(s*h*r-f*a*r+f*i*u-e*h*u-s*i*l+e*a*l)*y,this)},invert:function(){var t=this.elements,n=t[0],e=t[1],i=t[2],r=t[3],o=t[4],s=t[5],a=t[6],u=t[7],c=t[8],f=t[9],h=t[10],l=t[11],d=t[12],v=t[13],p=t[14],m=t[15],y=f*p*u-v*h*u+v*a*l-s*p*l-f*a*m+s*h*m,b=d*h*u-c*p*u-d*a*l+o*p*l+c*a*m-o*h*m,g=c*v*u-d*f*u+d*s*l-o*v*l-c*s*m+o*f*m,w=d*f*a-c*v*a-d*s*h+o*v*h+c*s*p-o*f*p,_=n*y+e*b+i*g+r*w;return 0==_?this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0):(t[0]=y*(y=1/_),t[1]=(v*h*r-f*p*r-v*i*l+e*p*l+f*i*m-e*h*m)*y,t[2]=(s*p*r-v*a*r+v*i*u-e*p*u-s*i*m+e*a*m)*y,t[3]=(f*a*r-s*h*r-f*i*u+e*h*u+s*i*l-e*a*l)*y,t[4]=b*y,t[5]=(c*p*r-d*h*r+d*i*l-n*p*l-c*i*m+n*h*m)*y,t[6]=(d*a*r-o*p*r-d*i*u+n*p*u+o*i*m-n*a*m)*y,t[7]=(o*h*r-c*a*r+c*i*u-n*h*u-o*i*l+n*a*l)*y,t[8]=g*y,t[9]=(d*f*r-c*v*r-d*e*l+n*v*l+c*e*m-n*f*m)*y,t[10]=(o*v*r-d*s*r+d*e*u-n*v*u-o*e*m+n*s*m)*y,t[11]=(c*s*r-o*f*r-c*e*u+n*f*u+o*e*l-n*s*l)*y,t[12]=w*y,t[13]=(c*v*i-d*f*i+d*e*h-n*v*h-c*e*p+n*f*p)*y,t[14]=(d*s*i-o*v*i-d*e*a+n*v*a+o*e*p-n*s*p)*y,t[15]=(o*f*i-c*s*i+c*e*a-n*f*a-o*e*h+n*s*h)*y,this)},scale:function(t){var n=this.elements,e=t.x,i=t.y,t=t.z;return n[0]*=e,n[4]*=i,n[8]*=t,n[1]*=e,n[5]*=i,n[9]*=t,n[2]*=e,n[6]*=i,n[10]*=t,n[3]*=e,n[7]*=i,n[11]*=t,this},getMaxScaleOnAxis:function(){var t=this.elements,n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],e=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(n,e,t))},makeTranslation:function(t,n,e){return this.set(1,0,0,t,0,1,0,n,0,0,1,e,0,0,0,1),this},makeRotationX:function(t){var n=Math.cos(t),t=Math.sin(t);return this.set(1,0,0,0,0,n,-t,0,0,t,n,0,0,0,0,1),this},makeRotationY:function(t){var n=Math.cos(t),t=Math.sin(t);return this.set(n,0,t,0,0,1,0,0,-t,0,n,0,0,0,0,1),this},makeRotationZ:function(t){var n=Math.cos(t),t=Math.sin(t);return this.set(n,-t,0,0,t,n,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,n){var e=Math.cos(n),n=Math.sin(n),i=1-e,r=t.x,o=t.y,t=t.z,s=i*r,a=i*o;return this.set(s*r+e,s*o-n*t,s*t+n*o,0,s*o+n*t,a*o+e,a*t-n*r,0,s*t-n*o,a*t+n*r,i*t*t+e,0,0,0,0,1),this},makeScale:function(t,n,e){return this.set(t,0,0,0,0,n,0,0,0,0,e,0,0,0,0,1),this},makeShear:function(t,n,e){return this.set(1,n,e,0,t,1,e,0,t,n,1,0,0,0,0,1),this},compose:function(t,n,e){var i=this.elements,r=n._t,o=n.Et,s=n.St,n=n.Tt,a=r+r,u=o+o,c=s+s,f=r*a,h=r*u,r=r*c,l=o*u,o=o*c,s=s*c,a=n*a,u=n*u,n=n*c,c=e.x,d=e.y,e=e.z;return i[0]=(1-(l+s))*c,i[1]=(h+n)*c,i[2]=(r-u)*c,i[3]=0,i[4]=(h-n)*d,i[5]=(1-(f+s))*d,i[6]=(o+a)*d,i[7]=0,i[8]=(r+u)*e,i[9]=(o-a)*e,i[10]=(1-(f+l))*e,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this},decompose:function(t,n,e){var i=this.elements,r=O.set(i[0],i[1],i[2]).length(),o=O.set(i[4],i[5],i[6]).length(),s=O.set(i[8],i[9],i[10]).length(),t=(this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],L.copy(this),1/r),i=1/o,a=1/s;return L.elements[0]*=t,L.elements[1]*=t,L.elements[2]*=t,L.elements[4]*=i,L.elements[5]*=i,L.elements[6]*=i,L.elements[8]*=a,L.elements[9]*=a,L.elements[10]*=a,n.setFromRotationMatrix(L),e.x=r,e.y=o,e.z=s,this},makePerspective:function(t,n,e,i,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var s=this.elements,a=2*r/(e-i),u=(n+t)/(n-t),e=(e+i)/(e-i),i=-(o+r)/(o-r),o=-2*o*r/(o-r);return s[0]=2*r/(n-t),s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=a,s[9]=e,s[13]=0,s[2]=0,s[6]=0,s[10]=i,s[14]=o,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(t,n,e,i,r,o){var s=this.elements,a=1/(n-t),u=1/(e-i),c=1/(o-r),n=(n+t)*a,t=(e+i)*u,e=(o+r)*c;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-n,s[1]=0,s[5]=2*u,s[9]=0,s[13]=-t,s[2]=0,s[6]=0,s[10]=-2*c,s[14]=-e,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(t){for(var n=this.elements,e=t.elements,i=0;i<16;i++)if(n[i]!==e[i])return!1;return!0},fromArray:function(t,n){void 0===n&&(n=0);for(var e=0;e<16;e++)this.elements[e]=t[e+n];return this},toArray:function(t,n){var e=this.elements;return(t=void 0===t?[]:t)[n=void 0===n?0:n]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t[n+4]=e[4],t[n+5]=e[5],t[n+6]=e[6],t[n+7]=e[7],t[n+8]=e[8],t[n+9]=e[9],t[n+10]=e[10],t[n+11]=e[11],t[n+12]=e[12],t[n+13]=e[13],t[n+14]=e[14],t[n+15]=e[15],t}}),Object.assign(D.prototype,{addEventListener:function(t,n){void 0===this.wt&&(this.wt={});var e=this.wt;void 0===e[t]&&(e[t]=[]),-1===e[t].indexOf(n)&&e[t].push(n)},hasEventListener:function(t,n){var e;return void 0!==this.wt&&void 0!==(e=this.wt)[t]&&-1!==e[t].indexOf(n)},removeEventListener:function(t,n){var e;void 0!==this.wt&&void 0!==(t=this.wt[t])&&-1!==(e=t.indexOf(n))&&t.splice(e,1)},dispatchEvent:function(t){if(void 0!==this.wt){var n=this.wt[t.type];if(void 0!==n){t.target=this;for(var e=n.slice(0),i=0,r=e.length;i<r;i++)e[i].call(this,t)}}}});var z=new At,V=new at;function Y(t,n,e,i){this._t=t||0,this.Et=n||0,this.St=e||0,this.At=i||Y.DefaultOrder}function Q(){this.mask=1}function Z(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Y.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Y.DefaultOrder="XYZ",Object.defineProperties(Y.prototype,{x:{get:function(){return this._t},set:function(t){this._t=t,this.xt()}},y:{get:function(){return this.Et},set:function(t){this.Et=t,this.xt()}},z:{get:function(){return this.St},set:function(t){this.St=t,this.xt()}},order:{get:function(){return this.At},set:function(t){this.At=t,this.xt()}}}),Object.assign(Y.prototype,{isEuler:!0,set:function(t,n,e,i){return this._t=t,this.Et=n,this.St=e,this.At=i||this.At,this.xt(),this},clone:function(){return new this.constructor(this._t,this.Et,this.St,this.At)},copy:function(t){return this._t=t._t,this.Et=t.Et,this.St=t.St,this.At=t.At,this.xt(),this},setFromRotationMatrix:function(t,n,e){var i=Tt.clamp,t=t.elements,r=t[0],o=t[4],s=t[8],a=t[1],u=t[5],c=t[9],f=t[2],h=t[6],t=t[10];return"XYZ"===(n=n||this.At)?(this.Et=Math.asin(i(s,-1,1)),Math.abs(s)<.9999999?(this._t=Math.atan2(-c,t),this.St=Math.atan2(-o,r)):(this._t=Math.atan2(h,u),this.St=0)):"YXZ"===n?(this._t=Math.asin(-i(c,-1,1)),Math.abs(c)<.9999999?(this.Et=Math.atan2(s,t),this.St=Math.atan2(a,u)):(this.Et=Math.atan2(-f,r),this.St=0)):"ZXY"===n?(this._t=Math.asin(i(h,-1,1)),Math.abs(h)<.9999999?(this.Et=Math.atan2(-f,t),this.St=Math.atan2(-o,u)):(this.Et=0,this.St=Math.atan2(a,r))):"ZYX"===n?(this.Et=Math.asin(-i(f,-1,1)),Math.abs(f)<.9999999?(this._t=Math.atan2(h,t),this.St=Math.atan2(a,r)):(this._t=0,this.St=Math.atan2(-o,u))):"YZX"===n?(this.St=Math.asin(i(a,-1,1)),Math.abs(a)<.9999999?(this._t=Math.atan2(-c,u),this.Et=Math.atan2(-f,r)):(this._t=0,this.Et=Math.atan2(s,t))):"XZY"===n?(this.St=Math.asin(-i(o,-1,1)),Math.abs(o)<.9999999?(this._t=Math.atan2(h,u),this.Et=Math.atan2(s,r)):(this._t=Math.atan2(-c,t),this.Et=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+n),this.At=n,!1!==e&&this.xt(),this},setFromQuaternion:function(t,n,e){return z.makeRotationFromQuaternion(t),this.setFromRotationMatrix(z,n,e)},setFromVector3:function(t,n){return this.set(t.x,t.y,t.z,n||this.At)},reorder:function(t){return V.setFromEuler(this),this.setFromQuaternion(V,t)},equals:function(t){return t._t===this._t&&t.Et===this.Et&&t.St===this.St&&t.At===this.At},fromArray:function(t){return this._t=t[0],this.Et=t[1],this.St=t[2],void 0!==t[3]&&(this.At=t[3]),this.xt(),this},toArray:function(t,n){return(t=void 0===t?[]:t)[n=void 0===n?0:n]=this._t,t[n+1]=this.Et,t[n+2]=this.St,t[n+3]=this.At,t},toVector3:function(t){return t?t.set(this._t,this.Et,this.St):new xt(this._t,this.Et,this.St)},onChange:function(t){return this.xt=t,this},xt:function(){}}),Object.assign(Q.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}}),Object.assign(Z.prototype,{isMatrix3:!0,set:function(t,n,e,i,r,o,s,a,u){var c=this.elements;return c[0]=t,c[1]=i,c[2]=s,c[3]=n,c[4]=r,c[5]=a,c[6]=e,c[7]=o,c[8]=u,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var n=this.elements,t=t.elements;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],this},extractBasis:function(t,n,e){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),e.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){t=t.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,n){var t=t.elements,n=n.elements,e=this.elements,i=t[0],r=t[3],o=t[6],s=t[1],a=t[4],u=t[7],c=t[2],f=t[5],t=t[8],h=n[0],l=n[3],d=n[6],v=n[1],p=n[4],m=n[7],y=n[2],b=n[5],n=n[8];return e[0]=i*h+r*v+o*y,e[3]=i*l+r*p+o*b,e[6]=i*d+r*m+o*n,e[1]=s*h+a*v+u*y,e[4]=s*l+a*p+u*b,e[7]=s*d+a*m+u*n,e[2]=c*h+f*v+t*y,e[5]=c*l+f*p+t*b,e[8]=c*d+f*m+t*n,this},multiplyScalar:function(t){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this},determinant:function(){var t=this.elements,n=t[0],e=t[1],i=t[2],r=t[3],o=t[4],s=t[5],a=t[6],u=t[7],t=t[8];return n*o*t-n*s*u-e*r*t+e*s*a+i*r*u-i*o*a},getInverse:function(t,n){void 0!==n&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var n=t.elements,t=this.elements,e=n[0],i=n[1],r=n[2],o=n[3],s=n[4],a=n[5],u=n[6],c=n[7],n=n[8],f=n*s-a*c,h=a*u-n*o,l=c*o-s*u,d=e*f+i*h+r*l;return 0==d?this.set(0,0,0,0,0,0,0,0,0):(t[0]=f*(f=1/d),t[1]=(r*c-n*i)*f,t[2]=(a*i-r*s)*f,t[3]=h*f,t[4]=(n*e-r*u)*f,t[5]=(r*o-a*e)*f,t[6]=l*f,t[7]=(i*u-c*e)*f,t[8]=(s*e-i*o)*f,this)},transpose:function(){var t=this.elements,n=t[1];return t[1]=t[3],t[3]=n,n=t[2],t[2]=t[6],t[6]=n,n=t[5],t[5]=t[7],t[7]=n,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this},setUvTransform:function(t,n,e,i,r,o,s){var a=Math.cos(r),r=Math.sin(r);this.set(e*a,e*r,-e*(a*o+r*s)+o+t,-i*r,i*a,-i*(-r*o+a*s)+s+n,0,0,1)},scale:function(t,n){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=n,e[4]*=n,e[7]*=n,this},rotate:function(t){var n=Math.cos(t),t=Math.sin(t),e=this.elements,i=e[0],r=e[3],o=e[6],s=e[1],a=e[4],u=e[7];return e[0]=n*i+t*s,e[3]=n*r+t*a,e[6]=n*o+t*u,e[1]=-t*i+n*s,e[4]=-t*r+n*a,e[7]=-t*o+n*u,this},translate:function(t,n){var e=this.elements;return e[0]+=t*e[2],e[3]+=t*e[5],e[6]+=t*e[8],e[1]+=n*e[2],e[4]+=n*e[5],e[7]+=n*e[8],this},equals:function(t){for(var n=this.elements,e=t.elements,i=0;i<9;i++)if(n[i]!==e[i])return!1;return!0},fromArray:function(t,n){void 0===n&&(n=0);for(var e=0;e<9;e++)this.elements[e]=t[e+n];return this},toArray:function(t,n){var e=this.elements;return(t=void 0===t?[]:t)[n=void 0===n?0:n]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t[n+4]=e[4],t[n+5]=e[5],t[n+6]=e[6],t[n+7]=e[7],t[n+8]=e[8],t}});var q=0,K=new xt,J=new at,$=new At,tt=new xt,nt=new xt,et=new xt,it=new at,rt=new xt(1,0,0),ot=new xt(0,1,0),ut=new xt(0,0,1),ct={type:"added"},ft={type:"removed"};function a(){Object.defineProperty(this,"id",{value:q++}),this.uuid=Tt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=a.DefaultUp.clone();var t=new xt,n=new Y,e=new at,i=new xt(1,1,1);n.onChange(function(){e.setFromEuler(n,!1)}),e.onChange(function(){n.setFromQuaternion(e,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:e},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new At},normalMatrix:{value:new Z}}),this.matrix=new At,this.matrixWorld=new At,this.matrixAutoUpdate=a.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Q,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function ht(){a.call(this),this.type="Camera",this.matrixWorldInverse=new At,this.projectionMatrix=new At,this.projectionMatrixInverse=new At}function dt(t,n,e,i){ht.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==e?e:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==n?n:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function vt(t,n,e,i,r,o){ht.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==n?n:1,this.top=void 0!==e?e:1,this.bottom=void 0!==i?i:-1,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}a.DefaultUp=new xt(0,1,0),a.DefaultMatrixAutoUpdate=!0,a.prototype=Object.assign(Object.create(D.prototype),{constructor:a,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,n){this.quaternion.setFromAxisAngle(t,n)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,n){return J.setFromAxisAngle(t,n),this.quaternion.multiply(J),this},rotateOnWorldAxis:function(t,n){return J.setFromAxisAngle(t,n),this.quaternion.premultiply(J),this},rotateX:function(t){return this.rotateOnAxis(rt,t)},rotateY:function(t){return this.rotateOnAxis(ot,t)},rotateZ:function(t){return this.rotateOnAxis(ut,t)},translateOnAxis:function(t,n){return K.copy(t).applyQuaternion(this.quaternion),this.position.add(K.multiplyScalar(n)),this},translateX:function(t){return this.translateOnAxis(rt,t)},translateY:function(t){return this.translateOnAxis(ot,t)},translateZ:function(t){return this.translateOnAxis(ut,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4($.getInverse(this.matrixWorld))},lookAt:function(t,n,e){t.isVector3?tt.copy(t):tt.set(t,n,e);t=this.parent;this.updateWorldMatrix(!0,!1),nt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?$.lookAt(nt,tt,this.up):$.lookAt(tt,nt,this.up),this.quaternion.setFromRotationMatrix($),t&&($.extractRotation(t.matrixWorld),J.setFromRotationMatrix($),this.quaternion.premultiply(J.inverse()))},add:function(t){if(1<arguments.length)for(var n=0;n<arguments.length;n++)this.add(arguments[n]);else t===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",t):t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),(t.parent=this).children.push(t),t.dispatchEvent(ct)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t);return this},remove:function(t){if(1<arguments.length)for(var n=0;n<arguments.length;n++)this.remove(arguments[n]);else{var e=this.children.indexOf(t);-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(ft))}return this},attach:function(t){return this.updateWorldMatrix(!0,!1),$.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),$.multiply(t.parent.matrixWorld)),t.applyMatrix4($),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,n){if(this[t]===n)return this;for(var e=0,i=this.children.length;e<i;e++){var r=this.children[e].getObjectByProperty(t,n);if(void 0!==r)return r}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new xt),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new at),this.updateMatrixWorld(!0),this.matrixWorld.decompose(nt,t,et),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new xt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(nt,it,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new xt),this.updateMatrixWorld(!0);var n=this.matrixWorld.elements;return t.set(n[8],n[9],n[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var n=this.children,e=0,i=n.length;e<i;e++)n[e].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var n=this.children,e=0,i=n.length;e<i;e++)n[e].traverseVisible(t)}},traverseAncestors:function(t){var n=this.parent;null!==n&&(t(n),n.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t=!(this.matrixWorldNeedsUpdate=!1));for(var n=this.children,e=0,i=n.length;e<i;e++)n[e].updateMatrixWorld(t)},updateWorldMatrix:function(t,n){var e=this.parent;if(!0===t&&null!==e&&e.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===n)for(var i=this.children,r=0,o=i.length;r<o;r++)i[r].updateWorldMatrix(!1,!0)},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,n){if(void 0===n&&(n=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===n)for(var e=0;e<t.children.length;e++){var i=t.children[e];this.add(i.clone())}return this}}),ht.prototype=Object.assign(Object.create(a.prototype),{constructor:ht,isCamera:!0,copy:function(t,n){return a.prototype.copy.call(this,t,n),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new xt),this.updateMatrixWorld(!0);var n=this.matrixWorld.elements;return t.set(-n[8],-n[9],-n[10]).normalize()},updateMatrixWorld:function(t){a.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(t,n){a.prototype.updateWorldMatrix.call(this,t,n),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),dt.prototype=Object.assign(Object.create(ht.prototype),{constructor:dt,isPerspectiveCamera:!0,copy:function(t,n){return ht.prototype.copy.call(this,t,n),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){t=.5*this.getFilmHeight()/t;this.fov=2*Tt.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*Tt.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Tt.RAD2DEG*Math.atan(Math.tan(.5*Tt.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,n,e,i,r,o){this.aspect=t/n,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=n,this.view.offsetX=e,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t,n=this.near,e=n*Math.tan(.5*Tt.DEG2RAD*this.fov)/this.zoom,i=2*e,r=this.aspect*i,o=-.5*r,s=this.view,a=(null!==this.view&&this.view.enabled&&(a=s.fullWidth,t=s.fullHeight,o+=s.offsetX*r/a,e-=s.offsetY*i/t,r*=s.width/a,i*=s.height/t),this.filmOffset);0!==a&&(o+=n*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+r,e,e-i,n,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}}),vt.prototype=Object.assign(Object.create(ht.prototype),{constructor:vt,isOrthographicCamera:!0,copy:function(t,n){return ht.prototype.copy.call(this,t,n),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,n,e,i,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=n,this.view.offsetX=e,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t,n=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,o=i-n,i=i+n,n=r+e,r=r-e;null!==this.view&&this.view.enabled&&(e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom,i=(o+=e*this.view.offsetX)+e*this.view.width,r=(n-=t*this.view.offsetY)-t*this.view.height),this.projectionMatrix.makeOrthographic(o,i,n,r,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}});var pt=[new xt,new xt,new xt,new xt,new xt,new xt,new xt,new xt],mt=new xt,yt=new Ft,bt=new xt,gt=new xt,wt=new xt,_t=new xt,Et=new xt,St=new xt,Rt=new xt,Nt=new xt,Pt=new xt,jt=new xt;function Ft(t,n){this.min=void 0!==t?t:new xt(1/0,1/0,1/0),this.max=void 0!==n?n:new xt(-1/0,-1/0,-1/0)}function It(t,n,e,i,r){for(var o=0,s=t.length-3;o<=s;o+=3){jt.fromArray(t,o);var a=r.x*Math.abs(jt.x)+r.y*Math.abs(jt.y)+r.z*Math.abs(jt.z),u=n.dot(jt),c=e.dot(jt),f=i.dot(jt);if(Math.max(-Math.max(u,c,f),Math.min(u,c,f))>a)return!1}return!0}Object.assign(Ft.prototype,{isBox3:!0,set:function(t,n){return this.min.copy(t),this.max.copy(n),this},setFromArray:function(t){for(var n=1/0,e=1/0,i=1/0,r=-1/0,o=-1/0,s=-1/0,a=0,u=t.length;a<u;a+=3){var c=t[a],f=t[a+1],h=t[a+2];c<n&&(n=c),f<e&&(e=f),h<i&&(i=h),r<c&&(r=c),o<f&&(o=f),s<h&&(s=h)}return this.min.set(n,e,i),this.max.set(r,o,s),this},setFromBufferAttribute:function(t){for(var n=1/0,e=1/0,i=1/0,r=-1/0,o=-1/0,s=-1/0,a=0,u=t.count;a<u;a++){var c=t.getX(a),f=t.getY(a),h=t.getZ(a);c<n&&(n=c),f<e&&(e=f),h<i&&(i=h),r<c&&(r=c),o<f&&(o=f),s<h&&(s=h)}return this.min.set(n,e,i),this.max.set(r,o,s),this},setFromPoints:function(t){this.makeEmpty();for(var n=0,e=t.length;n<e;n++)this.expandByPoint(t[n]);return this},setFromCenterAndSize:function(t,n){n=mt.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new xt),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new xt),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);for(var n=t.geometry,e=(void 0!==n&&(null===n.boundingBox&&n.computeBoundingBox(),yt.copy(n.boundingBox),yt.applyMatrix4(t.matrixWorld),this.union(yt)),t.children),i=0,r=e.length;i<r;i++)this.expandByObject(e[i]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,n){return void 0===n&&(console.warn("THREE.Box3: .getParameter() target is now required"),n=new xt),n.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,mt),mt.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){var n,e=0<t.normal.x?(n=t.normal.x*this.min.x,t.normal.x*this.max.x):(n=t.normal.x*this.max.x,t.normal.x*this.min.x);return 0<t.normal.y?(n+=t.normal.y*this.min.y,e+=t.normal.y*this.max.y):(n+=t.normal.y*this.max.y,e+=t.normal.y*this.min.y),0<t.normal.z?(n+=t.normal.z*this.min.z,e+=t.normal.z*this.max.z):(n+=t.normal.z*this.max.z,e+=t.normal.z*this.min.z),n<=-t.constant&&e>=-t.constant},intersectsTriangle:function(t){return!this.isEmpty()&&(this.getCenter(Rt),Nt.subVectors(this.max,Rt),bt.subVectors(t.a,Rt),gt.subVectors(t.b,Rt),wt.subVectors(t.c,Rt),_t.subVectors(gt,bt),Et.subVectors(wt,gt),St.subVectors(bt,wt),!!It([0,-_t.z,_t.y,0,-Et.z,Et.y,0,-St.z,St.y,_t.z,0,-_t.x,Et.z,0,-Et.x,St.z,0,-St.x,-_t.y,_t.x,0,-Et.y,Et.x,0,-St.y,St.x,0],bt,gt,wt,Nt))&&!!It([1,0,0,0,1,0,0,0,1],bt,gt,wt,Nt)&&(Pt.crossVectors(_t,Et),It([Pt.x,Pt.y,Pt.z],bt,gt,wt,Nt))},clampPoint:function(t,n){return void 0===n&&(console.warn("THREE.Box3: .clampPoint() target is now required"),n=new xt),n.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return mt.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(mt).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()||(pt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),pt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),pt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),pt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),pt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),pt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),pt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),pt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(pt)),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var Ct=new Ft;function kt(t,n){this.center=void 0!==t?t:new xt,this.radius=void 0!==n?n:0}Object.assign(kt.prototype,{set:function(t,n){return this.center.copy(t),this.radius=n,this},setFromPoints:function(t,n){for(var e=this.center,i=(void 0!==n?e.copy(n):Ct.setFromPoints(t).getCenter(e),0),r=0,o=t.length;r<o;r++)i=Math.max(i,e.distanceToSquared(t[r]));return this.radius=Math.sqrt(i),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var n=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=n*n},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,n){var e=this.center.distanceToSquared(t);return void 0===n&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),n=new xt),n.copy(t),e>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Ft),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});var Dt=new xt,Ut=new xt,Bt=new Z;function Gt(t,n){this.normal=void 0!==t?t:new xt(1,0,0),this.constant=void 0!==n?n:0}Object.assign(Gt.prototype,{isPlane:!0,set:function(t,n){return this.normal.copy(t),this.constant=n,this},setComponents:function(t,n,e,i){return this.normal.set(t,n,e),this.constant=i,this},setFromNormalAndCoplanarPoint:function(t,n){return this.normal.copy(t),this.constant=-n.dot(this.normal),this},setFromCoplanarPoints:function(t,n,e){e=Dt.subVectors(e,n).cross(Ut.subVectors(t,n)).normalize();return this.setFromNormalAndCoplanarPoint(e,t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,n){return void 0===n&&(console.warn("THREE.Plane: .projectPoint() target is now required"),n=new xt),n.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,n){void 0===n&&(console.warn("THREE.Plane: .intersectLine() target is now required"),n=new xt);var e=t.delta(Dt),i=this.normal.dot(e);return 0===i?0===this.distanceToPoint(t.start)?n.copy(t.start):void 0:(i=-(t.start.dot(this.normal)+this.constant)/i)<0||1<i?void 0:n.copy(e).multiplyScalar(i).add(t.start)},intersectsLine:function(t){var n=this.distanceToPoint(t.start),t=this.distanceToPoint(t.end);return n<0&&0<t||t<0&&0<n},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new xt),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,n){n=n||Bt.getNormalMatrix(t),t=this.coplanarPoint(Dt).applyMatrix4(t),n=this.normal.applyMatrix3(n).normalize();return this.constant=-t.dot(n),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});var Ht=new kt,Xt=new xt;function zt(t,n,e,i,r,o){this.planes=[void 0!==t?t:new Gt,void 0!==n?n:new Gt,void 0!==e?e:new Gt,void 0!==i?i:new Gt,void 0!==r?r:new Gt,void 0!==o?o:new Gt]}Object.assign(zt.prototype,{set:function(t,n,e,i,r,o){var s=this.planes;return s[0].copy(t),s[1].copy(n),s[2].copy(e),s[3].copy(i),s[4].copy(r),s[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var n=this.planes,e=0;e<6;e++)n[e].copy(t.planes[e]);return this},setFromProjectionMatrix:function(t){var n=this.planes,t=t.elements,e=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],u=t[6],c=t[7],f=t[8],h=t[9],l=t[10],d=t[11],v=t[12],p=t[13],m=t[14],t=t[15];return n[0].setComponents(o-e,c-s,d-f,t-v).normalize(),n[1].setComponents(o+e,c+s,d+f,t+v).normalize(),n[2].setComponents(o+i,c+a,d+h,t+p).normalize(),n[3].setComponents(o-i,c-a,d-h,t-p).normalize(),n[4].setComponents(o-r,c-u,d-l,t-m).normalize(),n[5].setComponents(o+r,c+u,d+l,t+m).normalize(),this},intersectsObject:function(t){var n=t.geometry;return null===n.boundingSphere&&n.computeBoundingSphere(),Ht.copy(n.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Ht)},intersectsSprite:function(t){return Ht.center.set(0,0,0),Ht.radius=.7071067811865476,Ht.applyMatrix4(t.matrixWorld),this.intersectsSphere(Ht)},intersectsSphere:function(t){for(var n=this.planes,e=t.center,i=-t.radius,r=0;r<6;r++)if(n[r].distanceToPoint(e)<i)return!1;return!0},intersectsBox:function(t){for(var n=this.planes,e=0;e<6;e++){var i=n[e];if(Xt.x=(0<i.normal.x?t.max:t.min).x,Xt.y=(0<i.normal.y?t.max:t.min).y,Xt.z=(0<i.normal.z?t.max:t.min).z,i.distanceToPoint(Xt)<0)return!1}return!0},containsPoint:function(t){for(var n=this.planes,e=0;e<6;e++)if(n[e].distanceToPoint(t)<0)return!1;return!0}});var Vt=0,Wt=1,Yt=2,Qt=3,Zt=0,qt=1,Kt=2,Jt=3,$t=0,tn=1,nn=2,en=1,rn=3,on=0,sn=1,an=2,un=0,cn=1,fn=2,hn=3,ln=4,dn=5,vn=100,pn=101,mn=102,yn=103,bn=104,gn=200,wn=201,_n=202,En=203,Sn=204,Tn=205,xn=206,An=207,Mn=208,On=209,Ln=210,Rn=0,Nn=1,Pn=2,jn=3,Fn=4,In=5,Cn=6,kn=7,Dn=0,Un=0,Bn=306,Gn=307,Hn=1e3,Xn=1001,zn=1002,Vn=1003,Wn=1004,Yn=1005,B=1006,Qn=1007,Zn=1008,qn=1008,Kn=1009,Jn=1010,$n=1011,te=1012,ne=1013,ee=1014,ie=1015,re=1016,oe=1017,se=1018,ae=1019,ue=1020,ce=1021,fe=1022,he=1023,le=1024,de=1025,ve=1026,pe=1027,me=1028,ye=1029,be=1030,ge=1031,we=1032,_e=1033,Ee=33776,Se=33777,Te=33778,xe=33779,Ae=35840,Me=35841,Oe=35842,Le=35843,Re=36196,Ne=37492,Pe=37496,je=37808,Fe=37809,Ie=37810,Ce=37811,ke=37812,De=37813,Ue=37814,Be=37815,Ge=37816,He=37817,Xe=37818,ze=37819,Ve=37820,We=37821,Ye=36492,Qe=37840,Ze=37841,qe=37842,Ke=37843,Je=37844,$e=37845,ti=37846,ni=37847,ei=37848,ii=37849,ri=37850,oi=37851,si=37852,ai=37853,ui=2300,ci=2301,fi=2400,hi=2401,li=3e3,di=3200,vi=3201,pi=0,mi=1,yi=7680,bi=7681,gi=519,wi=35044;function _i(t,n,e){return this.radius=void 0!==t?t:1,this.phi=void 0!==n?n:0,this.theta=void 0!==e?e:0,this}function Mt(t,n){this.x=t||0,this.y=n||0}function Ei(t){return(Ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Si(){Si=function(){return s};var u,s={},t=Object.prototype,c=t.hasOwnProperty,f=Object.defineProperty||function(t,n,e){t[n]=e.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",e=n.asyncIterator||"@@asyncIterator",r=n.toStringTag||"@@toStringTag";function o(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{o({},"")}catch(u){o=function(t,n,e){return t[n]=e}}function a(t,n,e,i){var r,o,s,a,n=n&&n.prototype instanceof y?n:y,n=Object.create(n.prototype),i=new A(i||[]);return f(n,"_invoke",{value:(r=t,o=e,s=i,a=l,function(t,n){if(a===v)throw new Error("Generator is already running");if(a===p){if("throw"===t)throw n;return{value:u,done:!0}}for(s.method=t,s.arg=n;;){var e=s.delegate;if(e){e=function t(n,e){var i=e.method,r=n.iterator[i];if(r===u)return e.delegate=null,"throw"===i&&n.iterator.return&&(e.method="return",e.arg=u,t(n,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),m;i=h(r,n.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,m;r=i.arg;return r?r.done?(e[n.resultName]=r.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=u),e.delegate=null,m):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}(e,s);if(e){if(e===m)continue;return e}}if("next"===s.method)s.sent=s.Mt=s.arg;else if("throw"===s.method){if(a===l)throw a=p,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);a=v;e=h(r,o,s);if("normal"===e.type){if(a=s.done?p:d,e.arg===m)continue;return{value:e.arg,done:s.done}}"throw"===e.type&&(a=p,s.method="throw",s.arg=e.arg)}})}),n}function h(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}s.wrap=a;var l="suspendedStart",d="suspendedYield",v="executing",p="completed",m={};function y(){}function b(){}function g(){}var n={},w=(o(n,i,function(){return this}),Object.getPrototypeOf),w=w&&w(w(M([]))),_=(w&&w!==t&&c.call(w,i)&&(n=w),g.prototype=y.prototype=Object.create(n));function E(t){["next","throw","return"].forEach(function(n){o(t,n,function(t){return this._invoke(n,t)})})}function S(s,a){var n;f(this,"_invoke",{value:function(e,i){function t(){return new a(function(t,n){!function n(t,e,i,r){var o,t=h(s[t],s,e);if("throw"!==t.type)return(e=(o=t.arg).value)&&"object"==Ei(e)&&c.call(e,"__await")?a.resolve(e.Ot).then(function(t){n("next",t,i,r)},function(t){n("throw",t,i,r)}):a.resolve(e).then(function(t){o.value=t,i(o)},function(t){return n("throw",t,i,r)});r(t.arg)}(e,i,t,n)})}return n=n?n.then(t,t):t()}})}function T(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function x(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function M(n){if(n||""===n){var e,t=n[i];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return e=-1,(t=function t(){for(;++e<n.length;)if(c.call(n,e))return t.value=n[e],t.done=!1,t;return t.value=u,t.done=!0,t}).next=t}throw new TypeError(Ei(n)+" is not iterable")}return f(_,"constructor",{value:b.prototype=g,configurable:!0}),f(g,"constructor",{value:b,configurable:!0}),b.displayName=o(g,r,"GeneratorFunction"),s.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},s.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,o(t,r,"GeneratorFunction")),t.prototype=Object.create(_),t},s.awrap=function(t){return{Ot:t}},E(S.prototype),o(S.prototype,e,function(){return this}),s.AsyncIterator=S,s.async=function(t,n,e,i,r){void 0===r&&(r=Promise);var o=new S(a(t,n,e,i),r);return s.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},E(_),o(_,r,"Generator"),o(_,i,function(){return this}),o(_,"toString",function(){return"[object Generator]"}),s.keys=function(t){var n,e=Object(t),i=[];for(n in e)i.push(n);return i.reverse(),function t(){for(;i.length;){var n=i.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},s.values=M,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this.Mt=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(x),!t)for(var n in this)"t"===n.charAt(0)&&c.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=u)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function t(t,n){return o.type="throw",o.arg=e,i.next=t,n&&(i.method="next",i.arg=u),!!n}for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var s=c.call(r,"catchLoc"),a=c.call(r,"finallyLoc");if(s&&a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var o=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=n&&n<=r.finallyLoc?null:r)?r.completion:{};return o.type=t,o.arg=n,r?(this.method="next",this.next=r.finallyLoc,m):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),m},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),x(e),m}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e,i,r=this.tryEntries[n];if(r.tryLoc===t)return"throw"===(e=r.completion).type&&(i=e.arg,x(r)),i}throw new Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:M(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=u),m}},s}function Ti(t,n,e,i,r,o,s){try{var a=t[o](s),u=a.value}catch(t){return void e(t)}a.done?n(u):Promise.resolve(u).then(i,r)}function xi(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Ei(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Ei(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Ei(t)?t:String(t)}(i.key),i)}}Object.assign(_i.prototype,{set:function(t,n,e){return this.radius=t,this.phi=n,this.theta=e,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,n,e){return this.radius=Math.sqrt(t*t+n*n+e*e),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,e),this.phi=Math.acos(Tt.clamp(n/this.radius,-1,1))),this}}),Object.defineProperties(Mt.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(Mt.prototype,{isVector2:!0,set:function(t,n){return this.x=t,this.y=n,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,n){return void 0!==n?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,n)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this},addScaledVector:function(t,n){return this.x+=t.x*n,this.y+=t.y*n,this},sub:function(t,n){return void 0!==n?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,n)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var n=this.x,e=this.y,t=t.elements;return this.x=t[0]*n+t[3]*e+t[6],this.y=t[1]*n+t[4]*e+t[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this},clampScalar:function(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this},clampLength:function(t,n){var e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(n,e)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var n=this.x-t.x,t=this.y-t.y;return n*n+t*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this},lerpVectors:function(t,n,e){return this.subVectors(n,t).multiplyScalar(e).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,n){return this.x=t[n=void 0===n?0:n],this.y=t[n+1],this},toArray:function(t,n){return(t=void 0===t?[]:t)[n=void 0===n?0:n]=this.x,t[n+1]=this.y,t},fromBufferAttribute:function(t,n,e){return void 0!==e&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(n),this.y=t.getY(n),this},rotateAround:function(t,n){var e=Math.cos(n),n=Math.sin(n),i=this.x-t.x,r=this.y-t.y;return this.x=i*e-r*n+t.x,this.y=i*n+r*e+t.y,this}});function Ai(C,t,k){var i,r,D,o,s,a,n=this,u=(void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=C,this.isScreenLock=!1,this.domElement=t,this.Lt=k,this.enabled=!0,this.useRange=!1,this.target=new xt,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.isDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.zoomSpeedParam=1,this.enableRotate=!0,this.enableRotateLeft=!0,this.enableRotateUp=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:Vt,MIDDLE:Wt,RIGHT:Yt},this.touches={ONE:Zt,TWO:Kt},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.rotateLeftStart=new Mt,this.rotateLeftEnd=new Mt,this.mapStateArray=[],this.timelone=null,this.Rt=function(){n.isDamping&&(v.theta>l||v.phi>l||m.length()>l?(n.update(),n.Lt.enableUpdateRender()):(n.isDamping=!1,n.update()))},this.Rt=this.Rt.bind(this),this.Lt.on("beforeRender",this.Rt),this.getPolarAngle=function(){return d.phi},this.getAzimuthalAngle=function(){return d.theta},this.panAdd=function(t){m.add(t)},this.saveState=function(){u.target0.copy(u.target),u.position0.copy(u.object.position),u.zoom0=u.object.zoom},this.resetState=function(){h=f.NONE},this.reset=function(){u.target.copy(u.target0),u.object.position.copy(u.position0),u.object.zoom=u.zoom0,u.object.updateProjectionMatrix(),u.dispatchEvent(U),u.update(),h=f.NONE},this.updateCheck=function(){if(this.Lt.Nt&&this.Lt.Nt.enableDragRange)if(this.Lt.Nt.Pt())this.saveMapState();else{for(var t,n=this.mapStateArray.length-1;0<=n;){var e=this.mapStateArray[n];if(e.viewMode=this.Lt.getViewMode(),this.updateState(e),this.Lt.Nt.Pt())break;n--}n<0&&(t=(t=this.Lt.getBuilding(this.Lt.Nt.Ft.jt)).getFloor(t.level),this.Lt.setCenter({x:t.x,y:t.y}))}},this.updateState=function(t){var n=this;this.Lt.Nt.pauseDamping(),this.Lt.setCenter({animate:!1,x:t.center.x,y:t.center.y,finish:function(){n.Lt.setRotation({animate:!1,rotation:t.rotation,finish:function(){n.Lt.setTilt({animate:!1,tilt:t.tiltAngle,finish:function(){n.Lt.setZoom({animate:!1,zoom:t.zoom})}})}})}})},this.saveMapState=function(){var t=this.Lt.getState();!function(t){var n,e=!0;for(n in t)if(""+n!="level"&&""+n!="visibleLevels"&&""+n!="viewBuildingID"&&""+n!="floorSpace"&&""+n!="viewMode")if(""+n=="center"){var i=t[n];if(isNaN(parseFloat(""+i.x))||isNaN(parseFloat(""+i.y))){e=!1;break}}else if(isNaN(parseFloat(""+t[n]))){e=!1;break}return e}(t)||(200<=this.mapStateArray.length&&this.mapStateArray.splice(0,1),this.mapStateArray.push(t))},this.getTarget=function(t,n){var e,i;return 0===this.Lt.It.length?t:(e=this.Lt.getMapOptions().screenLockCoords,i={x:this.Lt.getContainer().clientWidth/2,y:this.Lt.getContainer().clientHeight/2},e={x:this.Lt.getContainer().clientWidth*e.x,y:this.Lt.getContainer().clientHeight*e.y},(i=Oi.coordsScreenToMap(this.Lt,i,n)).x=i.x-this.Lt.x,i.y=-i.y+this.Lt.y,(e=Oi.coordsScreenToMap(this.Lt,e,n)).x=e.x-this.Lt.x,e.y=-e.y+this.Lt.y,n=e.x-i.x,e=e.y-i.y,i=t.clone(),isNaN(n)||isNaN(e)||1e3<Math.abs(e)||1e3<Math.abs(n)||(i.x=i.x-n,i.z=i.z-e),i)},this.update=(i=new xt,r=(new at).setFromUnitVectors(C.up,new xt(0,1,0)),D=r.clone().inverse(),o=new xt,s=new at,a=0,function(t){t=t||{};var n,e=u.object.position;return i.copy(e).sub(u.target),i.applyQuaternion(r),d.setFromVector3(i),u.autoRotate&&h===f.NONE&&M(2*Math.PI/60/60*u.autoRotateSpeed),u.enableDamping&&u.isDamping?(d.theta+=v.theta*u.dampingFactor,d.phi+=v.phi*u.dampingFactor):(d.theta+=v.theta,d.phi+=v.phi),d.theta=Math.max(u.minAzimuthAngle,Math.min(u.maxAzimuthAngle,d.theta)),t&&void 0!==t.theta&&(d.theta=Math.max(u.minAzimuthAngle,Math.min(u.maxAzimuthAngle,t.theta))),d.phi=Math.max(u.minPolarAngle,Math.min(u.maxPolarAngle,d.phi)),t&&void 0!==t.phi&&(d.phi=Math.max(u.minPolarAngle,Math.min(u.maxPolarAngle,t.phi))),d.makeSafe(),d.radius*=p,d.radius=Math.max(u.minDistance,Math.min(u.maxDistance,d.radius)),this.useRange?((n=(new xt).setFromMatrixPosition(u.object.matrixWorld)).add(m),n=(new At).copy(u.object.matrixWorld).setPosition(n),n=(new At).getInverse(n),(new zt).setFromProjectionMatrix((new At).multiplyMatrices(u.object.projectionMatrix,n)).intersectsSphere(u.viewSphere)&&u.target.add(m)):u.enableDamping&&u.isDamping?u.target.addScaledVector(m,u.dampingFactor):u.target.add(m),i.setFromSpherical(d),i.applyQuaternion(D),t&&t.offset&&i.add(t.offset),this.useRange&&((n=(new xt).setFromMatrixPosition(u.object.matrixWorld)).add(i),t=(new At).copy(u.object.matrixWorld).setPosition(n),n=(new At).getInverse(t),!(new zt).setFromProjectionMatrix((new At).multiplyMatrices(u.object.projectionMatrix,n)).intersectsSphere(u.viewSphere))||e.copy(u.target).add(i),u.isScreenLock&&void 0!==this.Lt.getMapOptions().screenLockCoords?((t=u.object.clone()).lookAt(u.target),u.object.lookAt(this.getTarget(u.target,t)),u.object.rotation.z=t.rotation.z):u.object.lookAt(u.target),u.enableDamping&&u.isDamping?(v.theta*=1-u.dampingFactor,v.phi*=1-u.dampingFactor,m.multiplyScalar(1-u.dampingFactor)):(v.set(0,0,0),m.set(0,0,0)),p=1,!(!(y||o.distanceToSquared(u.object.position)>l||8*(1-s.dot(u.object.quaternion))>l||a!==u.object.zoom)||(u.dispatchEvent(U),o.copy(u.object.position),s.copy(u.object.quaternion),a=u.object.zoom,y=!1))}),this.dispose=function(){u.domElement.removeEventListener("contextmenu",ot,!1),u.domElement.removeEventListener("mousedown",$,!1),u.domElement.removeEventListener("wheel",tt,!1),u.domElement.removeEventListener("touchstart",et,!1),u.domElement.removeEventListener("touchend",rt,!1),u.domElement.removeEventListener("touchmove",it,!1),st.a.document.removeEventListener("mousemove",F,!1),st.a.document.removeEventListener("mouseup",I,!1),u.domElement.removeEventListener("keydown",nt,!1)},this),U={type:"change"},e={type:"start"},c={type:"end"},f={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},h=f.NONE,l=1e-6,d=new _i,v=new _i,p=1,m=new xt,y=!1,b=new Mt,g=new Mt,w=new Mt,_=new Mt,E=new Mt,S=new Mt,T=new Mt,x=new Mt,A=new Mt,B=null;function G(){return Math.pow(.95,u.zoomSpeed)}function M(t){u.enableRotateLeft&&(v.theta-=t)}function H(t){u.enableRotateUp&&(v.phi-=t)}O=new xt;var O,L,R,X=function(t,n){O.setFromMatrixColumn(n,0),O.multiplyScalar(-t),m.add(O)},z=(L=new xt,function(t,n){!0===u.screenSpacePanning?L.setFromMatrixColumn(n,1):(L.setFromMatrixColumn(n,0),L.crossVectors(u.object.up,L)),L.multiplyScalar(t),m.add(L)}),N=(this.panUp=function(t){var n=new xt(0,1,0);n.multiplyScalar(t),m.add(n)},R=new xt,function(t,n){var e,i=u.domElement;u.object.isPerspectiveCamera?(e=u.object.position,R.copy(e).sub(u.target),e=R.length(),e*=Math.tan(u.object.fov/2*Math.PI/180),X(2*t*e/i.clientHeight,u.object.matrix),z(2*n*e/i.clientHeight,u.object.matrix)):u.object.isOrthographicCamera?(X(t*(u.object.right-u.object.left)/u.object.zoom/i.clientWidth,u.object.matrix),z(n*(u.object.top-u.object.bottom)/u.object.zoom/i.clientHeight,u.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),u.enablePan=!1)});function P(t){u.object.isPerspectiveCamera?p/=t:u.object.isOrthographicCamera?(u.object.zoom=Math.max(u.minZoom,Math.min(u.maxZoom,u.object.zoom*t)),u.object.updateProjectionMatrix(),p/=t,y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),u.enableZoom=!1)}function V(t){u.object.isPerspectiveCamera?p*=t:u.object.isOrthographicCamera?(u.object.zoom=Math.max(u.minZoom,Math.min(u.maxZoom,u.object.zoom/t)),u.object.updateProjectionMatrix(),p*=t,y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),u.enableZoom=!1)}function j(t){b.set(t.clientX,t.clientY)}function W(t){_.set(t.clientX,t.clientY)}function Y(t){var n,e;1==t.touches.length?b.set(t.touches[0].pageX,t.touches[0].pageY):(n=.5*(t.touches[0].pageX+t.touches[1].pageX),e=.5*(t.touches[0].pageY+t.touches[1].pageY),b.set(n,e),n=t.touches[0].pageX-t.touches[1].pageX,e=t.touches[0].pageY-t.touches[1].pageY,u.rotateLeftStart.set(n,e))}function Q(t){var n;1==t.touches.length?_.set(t.touches[0].pageX,t.touches[0].pageY):(n=.5*(t.touches[0].pageX+t.touches[1].pageX),t=.5*(t.touches[0].pageY+t.touches[1].pageY),_.set(n,t))}function Z(t){var n=t.touches[0].pageX-t.touches[1].pageX,t=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(n*n+t*t);T.set(0,n)}function q(t){1==t.touches.length?g.set(t.touches[0].pageX,t.touches[0].pageY):(e=.5*(t.touches[0].pageX+t.touches[1].pageX),n=.5*(t.touches[0].pageY+t.touches[1].pageY),g.set(e,n),e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,u.rotateLeftEnd.set(e,n),t=u.rotateLeftStart.angle(),M((-u.rotateLeftEnd.angle()+t)*u.rotateSpeed),u.rotateLeftStart.copy(u.rotateLeftEnd)),w.subVectors(g,b).multiplyScalar(u.rotateSpeed);var n,e=u.domElement;H(2*Math.PI*w.y/e.clientHeight),b.copy(g)}function K(t){var n;1==t.touches.length?(E.set(t.touches[0].pageX,t.touches[0].pageY),E.x<0&&E.copy(_)):(n=.5*(t.touches[0].pageX+t.touches[1].pageX),t=.5*(t.touches[0].pageY+t.touches[1].pageY),E.set(n,t)),S.subVectors(E,_).multiplyScalar(u.panSpeed),N(S.x,S.y),_.copy(E)}function J(t){var n;t.touches[0]&&t.touches[1]&&(n=t.touches[0].pageX-t.touches[1].pageX,t=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(n*n+t*t),x.set(0,n),A.set(0,Math.pow(x.y/T.y,u.zoomSpeed)),P(A.y),T.copy(x))}function $(t){if(!1!==u.enabled){switch(u.activeing=!0,t.preventDefault(),(u.domElement.focus?u.domElement:window).focus(),t.button){case 0:switch(u.mouseButtons.LEFT){case Vt:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===u.enablePan)return;W(t),h=f.PAN}else{if(!1===u.enableRotate)return;j(t),h=f.ROTATE}break;case Yt:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===u.enableRotate)return;j(t),h=f.ROTATE}else{if(!1===u.enablePan)return;W(t),h=f.PAN}break;default:h=f.NONE}break;case 1:switch(u.mouseButtons.MIDDLE){case Wt:if(!1===u.enableZoom)return;T.set(t.clientX,t.clientY),h=f.DOLLY;break;case Vt:if(!1===u.enableRotate)return;j(t),h=f.ROTATE;break;default:h=f.NONE}break;case 2:switch(u.mouseButtons.RIGHT){case Vt:if(!1===u.enableRotate)return;j(t),h=f.ROTATE;break;case Yt:if(!1===u.enablePan)return;W(t),h=f.PAN;break;default:h=f.NONE}}h!==f.NONE&&(st.a.document.addEventListener("mousemove",F,!1),st.a.document.addEventListener("mouseup",I,!1),u.dispatchEvent(e))}}function F(t){var n;if(!1!==u.enabled)switch(t.preventDefault(),h){case f.ROTATE:!1!==u.enableRotate&&(n=t,g.set(n.clientX,n.clientY),w.subVectors(g,b).multiplyScalar(u.rotateSpeed),n=u.domElement,M(2*Math.PI*w.x/n.clientHeight),H(2*Math.PI*w.y/n.clientHeight),b.copy(g),u.isDamping=!0,u.update(),u.updateCheck());break;case f.DOLLY:!1!==u.enableZoom&&(x.set(t.clientX,t.clientY),A.subVectors(x,T),0<A.y?P(G()):A.y<0&&V(G()),T.copy(x),u.isDamping=!0,u.update(),u.updateCheck());break;case f.PAN:!1!==u.enablePan&&(E.set(t.clientX,t.clientY),S.subVectors(E,_).multiplyScalar(u.panSpeed),N(S.x,S.y),_.copy(E),u.isDamping=!0,u.update(),u.updateCheck())}}function I(t){!1!==u.enabled&&(u.activeing=!1,st.a.document.removeEventListener("mousemove",F,!1),st.a.document.removeEventListener("mouseup",I,!1),u.dispatchEvent(c),h=f.NONE)}function tt(t){var n;!1===u.enabled||!1===u.enableZoom||h!==f.NONE&&h!==f.ROTATE||(u.activeing=!0,void 0!==u.wheelTimer&&clearTimeout(u.wheelTimer),u.wheelTimer=setTimeout(function(){u.activeing=!1},100),t.preventDefault(),t.stopPropagation(),u.dispatchEvent(e),t=t,n=Math.pow(.95,u.zoomSpeed*u.zoomSpeedParam),t.deltaY<0?V(n):0<t.deltaY&&P(n),u.isDamping=!0,u.update(),u.updateCheck(),u.dispatchEvent(c))}function nt(t){if(!1!==u.enabled&&!1!==u.enableKeys&&!1!==u.enablePan){var n=!1;switch(t.keyCode){case u.keys.UP:N(0,u.keyPanSpeed),n=!0;break;case u.keys.BOTTOM:N(0,-u.keyPanSpeed),n=!0;break;case u.keys.LEFT:N(u.keyPanSpeed,0),n=!0;break;case u.keys.RIGHT:N(-u.keyPanSpeed,0),n=!0}n&&(t.preventDefault(),u.isDamping=!0,u.update(),u.updateCheck())}}function et(t){if(!1!==u.enabled){switch(u.activeing=!0,t.preventDefault(),t.touches.length){case 1:switch(u.touches.ONE){case Zt:if(!1===u.enableRotate)return;Y(t),h=f.TOUCH_ROTATE;break;case qt:if(!1===u.enablePan)return;Q(t),h=f.TOUCH_PAN;break;default:h=f.NONE}break;case 2:switch(B=t.touches[0].identifier,u.touches.TWO){case Kt:if(!1===u.enableZoom&&!1===u.enablePan)return;n=t,u.enableZoom&&Z(n),u.enablePan&&Q(n),h=f.TOUCH_DOLLY_PAN;break;case Jt:if(!1===u.enableZoom&&!1===u.enableRotate)return;n=t,u.enableZoom&&Z(n),u.enableRotate&&Y(n),h=f.TOUCH_DOLLY_ROTATE;break;default:h=f.NONE}break;default:h=f.NONE}var n;h!==f.NONE&&u.dispatchEvent(e)}}function it(t){var n,e;if(!1!==u.enabled)switch(u.activeing=!0,2===t.touches.length&&t.touches[1].identifier===B&&(n=t.touches[0],t.touches[0]=t.touches[1],t.touches[1]=n),t.preventDefault(),t.stopPropagation(),h){case f.TOUCH_ROTATE:!1!==u.enableRotate&&(q(t),u.isDamping=!0,u.update(),u.updateCheck());break;case f.TOUCH_PAN:!1!==u.enablePan&&(K(t),u.isDamping=!0,u.update(),u.updateCheck());break;case f.TOUCH_DOLLY_PAN:!1===u.enableZoom&&!1===u.enablePan||(e=t,u.enableZoom&&J(e),u.enablePan&&K(e),u.isDamping=!0,u.update(),u.updateCheck());break;case f.TOUCH_DOLLY_ROTATE:!1===u.enableZoom&&!1===u.enableRotate||(e=t,u.enableZoom&&J(e),u.enableRotate&&q(e),u.isDamping=!0,u.update(),u.updateCheck());break;default:h=f.NONE}}function rt(t){!1!==u.enabled&&(u.activeing=!1,u.dispatchEvent(c),h=f.NONE)}function ot(t){!1!==u.enabled&&t.preventDefault()}this.dollyIn=P,this.dollyOut=V,u.domElement.addEventListener("contextmenu",ot,!1),u.domElement.addEventListener("mousedown",$,!1),u.domElement.addEventListener("wheel",tt,!1),u.domElement.addEventListener("touchstart",et,!1),u.domElement.addEventListener("touchend",rt,!1),u.domElement.addEventListener("touchmove",it,!1),u.domElement.addEventListener("keydown",nt,!1),-1===u.domElement.tabIndex&&(u.domElement.tabIndex=0),u.isDamping=!0,this.update(),this.updateCheck(),this.removeEvent=function(){u.domElement.removeEventListener("contextmenu",ot,!1),u.domElement.removeEventListener("mousedown",$,!1),u.domElement.removeEventListener("wheel",tt,!1),u.domElement.removeEventListener("touchstart",et,!1),u.domElement.removeEventListener("touchend",rt,!1),u.domElement.removeEventListener("touchmove",it,!1),u.domElement.removeEventListener("keydown",nt,!1),st.a.document.removeEventListener("mousemove",F,!1),st.a.document.removeEventListener("mouseup",I,!1)}}function Mi(t,n,e){Ai.call(this,t,n,e),this.mouseButtons.LEFT=Yt,this.mouseButtons.RIGHT=Vt,this.touches.ONE=qt,this.touches.TWO=Jt,this.Ct=null}var Oi=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")}var n,e,i,a,o;return n=t,e=null,i=[{key:"coordsMapToScreen",value:function(t,n){var e=void 0!==n.height?n.height:0,i=t.getMapOptions().buildingID,i=(n.buildingID&&(i=n.buildingID),t.getBuilding(i)),r=(void 0!==n.level?n:i).level,i=void 0!==n.z?n.z:i.getFloor(r).nt;return this.coordsMapToScreen_(t,{x:n.x,y:n.y,z:i+e})}},{key:"coordsScreenToMap",value:function(t,n,e){var i,r,o=(void 0!==n.buildingID?n:t.getMapOptions()).buildingID,o=t.getBuilding(o),s=t.kt,a=(void 0!==n.level?n:o).level,o=void 0!==n.z?n.z:o.getFloor(a).nt,a=null,u=t.Dt.renderer.domElement.clientWidth,c=t.Dt.renderer.domElement.clientHeight,f=new xt,h=new xt,t=(null!=(e=(a=e||t.Nt.Ut.object).userData)&&e.near?a.userData:a).near,e=(null!=(e=a.userData)&&e.far?a.userData:a).far,u=(a.isPerspectiveCamera?(a.updateMatrixWorld(),f.setFromMatrixPosition(a.matrixWorld),i=n.x/u*2-1,r=-n.y/c*2+1,h.set(i,r,t).unproject(a).sub(f).normalize()):(i=n.x/u*2-1,r=-n.y/c*2+1,f.set(i,r,(t+e)/(t-e)).unproject(a),h.set(0,0,-1).transformDirection(a.matrixWorld)),(-f.y+o)/h.y),n=(u<0&&(u=e),(new xt).copy(f).add((new xt).copy(h).multiplyScalar(u)));return{x:n.x+s.x,y:s.y-n.z,z:o}}},{key:"coordsMapToScreen_",value:function(t,n){var e=t.Nt.Ut.object,i=(null!=(i=e.userData)&&i.near?e.userData:e).near,r=(null!=(r=e.userData)&&r.far?e.userData:e).far,o=e.near,s=e.far,i=(e.near=i,e.far=r,e.updateProjectionMatrix(),t.kt),r=new xt(n.x-i.x,n.z,-n.y+i.y).project(e),n=t.Dt.renderer.domElement.clientWidth,i=t.Dt.renderer.domElement.clientHeight;return e.near=o,e.far=s,e.updateProjectionMatrix(),r.z<-1||1<r.z?null:{x:Math.round(n/2*r.x+n/2),y:Math.round(-i/2*r.y+i/2)}}},{key:"exportToImage",value:(a=Si().mark(function t(n,e,i,r,o){return Si().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t)}),o=function(){var t=this,s=arguments;return new Promise(function(n,e){var i=a.apply(t,s);function r(t){Ti(i,n,e,r,o,"next",t)}function o(t){Ti(i,n,e,r,o,"throw",t)}r(void 0)})},function(t,n,e,i,r){return o.apply(this,arguments)})},{key:"screenshot",value:function(t,n,e,i,r,o,s,a){}}],e&&xi(n.prototype,e),i&&xi(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}(),st=t(0),n=((Ai.prototype=Object.create(D.prototype)).constructor=Ai,(Mi.prototype=Object.create(D.prototype)).constructor=Mi,Object.assign(Mi.prototype,{setMouseMiddleButtonRotation:function(){this.mouseButtons.RIGHT=Qt,this.mouseButtons.MIDDLE=Vt},dispose:function(){this.removeEvent(),this.object=null,this.domElement=null,this.Lt.off("beforeRender",this.Lt.Rt),this.Lt=null},pauseDamping:function(){this.Ct={dampingFactor:this.dampingFactor,enableDamping:this.enableDamping},this.enableDamping=!1,this.dampingFactor=1},resumeDamping:function(){this.Ct&&(this.enableDamping=this.Ct.enableDamping,this.dampingFactor=this.Ct.dampingFactor)}}),{FOV:35,CAMERA_NEAR:1,CAMERA_FAR:1e5,ZOOM_UPPER_BOUND:30,TILT_UPPER_BOUND:90,THOUSAND:1e3,DEG2RAD:.0174532,RAD2DEG:57.2957795,DRAW_TIME:500,EPS:.001}),f=(Object.freeze(n),n),n={MODE_3D:2,MODE_2D:4},Li=(Object.freeze(n),n),n={NONE:0,EXTRUDE_MARKER:2,FM3DTILE_LAYER:4,IMAGE_MARKER:8,LOCATION_MARKER:16,POLYGON_MARKER:32,TEXT_MARKER:64,LINE_MARKER:128,LINE3D_MARKER:256,HEAT_MAP_MARKER:512,EXTENT:1024,EXTERNAL_MODEL:2048,MODEL:4096,FACILITY:8192,LABEL:16384,DYNAMIC_MODEL_MARKER:32768,DOM_MARKER:65536,SPHERE_MARKER:1<<17,CAD_LAYER:1<<18,EXTENT_LAYER:1<<20,EXTERNAL_MODEL_LAYER:1<<21,MODEL_LAYER:1<<22,FACILITY_LAYER:1<<23,LABEL_LAYER:1<<24,MARKER_GROUP:1<<25,FLOW_LINE_LAYER:1<<27,FLOW_LINE_MARKER:1<<27,FIRE_MARKER:1<<28,WALL_MARKER:1<<29,TUBE_MARKER:1<<30},S=(n.LAYER_NODE_TYPE=new Map,n.LAYER_NODE_TYPE.set(n.EXTENT_LAYER,n.EXTENT),n.LAYER_NODE_TYPE.set(n.EXTERNAL_MODEL_LAYER,n.EXTERNAL_MODEL),n.LAYER_NODE_TYPE.set(n.MODEL_LAYER,n.MODEL),n.LAYER_NODE_TYPE.set(n.FACILITY_LAYER,n.FACILITY),n.LAYER_NODE_TYPE.set(n.LABEL_LAYER,n.LABEL),n.LAYER_NODE_TYPE.set(n.DOM_MARKER,n.DOM_MARKER),n.LAYER_NODE_TYPE.set(n.DYNAMIC_MODEL_MARKER,n.DYNAMIC_MODEL_MARKER),n.LAYER_NODE_TYPE.set(n.EXTRUDE_MARKER,n.EXTRUDE_MARKER),n.LAYER_NODE_TYPE.set(n.HEAT_MAP_MARKER,n.HEAT_MAP_MARKER),n.LAYER_NODE_TYPE.set(n.LINE_MARKER,n.LINE_MARKER),n.LAYER_NODE_TYPE.set(n.LOCATION_MARKER,n.LOCATION_MARKER),n.LAYER_NODE_TYPE.set(n.POLYGON_MARKER,n.POLYGON_MARKER),n.LAYER_NODE_TYPE.set(n.TEXT_MARKER,n.TEXT_MARKER),n.LAYER_NODE_TYPE.set(n.IMAGE_MARKER,n.IMAGE_MARKER),n.LAYER_NODE_TYPE.set(n.FLOW_LINE_LAYER,n.FLOW_LINE_MARKER),n.LAYER_NODE_TYPE.set(n.FIRE_MARKER,n.FIRE_MARKER),n.LAYER_NODE_TYPE.set(n.WALL_MARKER,n.WALL_MARKER),n.LAYER_NODE_TYPE.set(n.TUBE_MARKER,n.TUBE_MARKER),n.LAYER_NODE_TYPE.set(n.LINE3D_MARKER,n.LINE3D_MARKER),n.LAYER_NODE_TYPE.set(n.SPHERE_MARKER,n.SPHERE_MARKER),n.LAYER_NODE_TYPE.set(n.CAD_LAYER,n.CAD_LAYER),n),Ri={NAME_KEY_ERROR:0,MAP_ID_URL_ERROR:2,THEME_ID_URL_ERROR:4,LICENSE_ERROR:8,PATH_ERROR:404,INFO:32,DEFAULT_LEVEL_ERROR:64},n={RIGHT:2,LEFT:4,BOTTOM:8,TOP:16,RIGHT_BOTTOM:32,LEFT_BOTTOM:64,RIGHT_TOP:128,LEFT_TOP:256,CENTER:512},Ni=(Object.freeze(n),n);function Ot(t,n,e,i){this.x=t||0,this.y=n||0,this.z=e||0,this.w=void 0!==i?i:1}Object.defineProperties(Ot.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(Ot.prototype,{isVector4:!0,set:function(t,n,e,i){return this.x=t,this.y=n,this.z=e,this.w=i,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,n){return void 0!==n?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,n)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this.z=t.z+n.z,this.w=t.w+n.w,this},addScaledVector:function(t,n){return this.x+=t.x*n,this.y+=t.y*n,this.z+=t.z*n,this.w+=t.w*n,this},sub:function(t,n){return void 0!==n?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,n)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this.z=t.z-n.z,this.w=t.w-n.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var n=this.x,e=this.y,i=this.z,r=this.w,t=t.elements;return this.x=t[0]*n+t[4]*e+t[8]*i+t[12]*r,this.y=t[1]*n+t[5]*e+t[9]*i+t[13]*r,this.z=t[2]*n+t[6]*e+t[10]*i+t[14]*r,this.w=t[3]*n+t[7]*e+t[11]*i+t[15]*r,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var n=Math.sqrt(1-t.w*t.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/n,this.y=t.y/n,this.z=t.z/n),this},setAxisAngleFromRotationMatrix:function(t){var n,e,i,r,o,s,a,u,c,f,t=t.elements,h=t[0],l=t[4],d=t[8],v=t[1],p=t[5],m=t[9],y=t[2],b=t[6],t=t[10];return Math.abs(l-v)<.01&&Math.abs(d-y)<.01&&Math.abs(m-b)<.01?Math.abs(l+v)<.1&&Math.abs(d+y)<.1&&Math.abs(m+b)<.1&&Math.abs(h+p+t-3)<.1?this.set(1,0,0,0):(r=Math.PI,s=(t+1)/2,a=(l+v)/4,u=(d+y)/4,c=(m+b)/4,(o=(p+1)/2)<(f=(h+1)/2)&&s<f?i=f<.01?(n=0,e=.707106781):(e=a/(n=Math.sqrt(f)),u/n):s<o?i=o<.01?(e=0,n=.707106781):(n=a/(e=Math.sqrt(o)),c/e):s<.01?(e=n=.707106781,i=0):(n=u/(i=Math.sqrt(s)),e=c/i),this.set(n,e,i,r)):(f=Math.sqrt((b-m)*(b-m)+(d-y)*(d-y)+(v-l)*(v-l)),Math.abs(f)<.001&&(f=1),this.x=(b-m)/f,this.y=(d-y)/f,this.z=(v-l)/f,this.w=Math.acos((h+p+t-1)/2)),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this.z=Math.max(t.z,Math.min(n.z,this.z)),this.w=Math.max(t.w,Math.min(n.w,this.w)),this},clampScalar:function(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this.z=Math.max(t,Math.min(n,this.z)),this.w=Math.max(t,Math.min(n,this.w)),this},clampLength:function(t,n){var e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(n,e)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this.z+=(t.z-this.z)*n,this.w+=(t.w-this.w)*n,this},lerpVectors:function(t,n,e){return this.subVectors(n,t).multiplyScalar(e).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,n){return this.x=t[n=void 0===n?0:n],this.y=t[n+1],this.z=t[n+2],this.w=t[n+3],this},toArray:function(t,n){return(t=void 0===t?[]:t)[n=void 0===n?0:n]=this.x,t[n+1]=this.y,t[n+2]=this.z,t[n+3]=this.w,t},fromBufferAttribute:function(t,n,e){return void 0!==e&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(n),this.y=t.getY(n),this.z=t.getZ(n),this.w=t.getW(n),this}});var G=t(1);function Pi(t){return(Pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ji(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Pi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Pi(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Pi(t)?t:String(t)}(i.key),i)}}var Fi=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function")}var t,n,i;return t=e,i=[{key:"convertPointCoordsByCenter",value:function(t,n){return t.x=t.x-n.x,t.y=t.y-n.y,void 0!==t.z&&void 0!==n.z&&(t.z=t.z-n.z),t}},{key:"convertPointsCoordsByCenter",value:function(t,n){for(var e=0;e<t.length;e++)this.convertPointCoordsByCenter(t[e],n);return t}},{key:"getMapScaleInfo",value:function(){if(!e.scaleInfo){var t,n;if(st.a.environment===G.a.WX)return 96/2.54;window.screen.deviceXDPI?t=window.screen.deviceXDPI:((n=document.createElement("DIV")).style.cssText="width:1in;height:1in;position:absolute;left:0px;top:0px;z-index:99;visibility:hidden",document.body.appendChild(n),t=parseInt(n.offsetWidth),n.parentNode.removeChild(n)),e.scaleInfo=t/2.54}return e.scaleInfo}},{key:"getCenterByAnchor",value:function(t){var n=new Mt(.5,.5);switch(t){case Ni.LEFT:n.setX(0);break;case Ni.RIGHT:n.setX(1);break;case Ni.TOP:n.setY(1);break;case Ni.BOTTOM:n.setY(0);break;case Ni.LEFT_TOP:n.set(0,1);break;case Ni.RIGHT_TOP:n.set(1,1);break;case Ni.LEFT_BOTTOM:n.set(0,0);break;case Ni.RIGHT_BOTTOM:n.set(1,0)}return n}},{key:"uniqWithArrayOne",value:function(t){var n=[];return t.forEach(function(t){n.includes(t)||n.push(t)}),n}},{key:"uniqWithArrayTwo",value:function(t){if(t.length<1)return[];t=JSON.parse(JSON.stringify(t));for(var n=[],e=0;e<t.length;e++){var i=(i=this.uniqWithArrayOne(t[e])).filter(function(t){return!n.includes(t)});t[e]=i,n=n.concat(i)}return t.filter(function(t){return 0<t.length})}},{key:"compareArrays",value:function(t,n){if(t.length!==n.length)return!1;for(var e=0;e<t.length;e++){var i,r=t[e],o=n[e];if(Object.keys(r).length!==Object.keys(o).length)return!1;for(i in r)if(r[i]&&o[i]&&r[i]!==o[i])return!1}return!0}}],(n=null)&&ji(t.prototype,n),i&&ji(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}(),Ii={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ci={h:0,s:0,l:0},ki={h:0,s:0,l:0};function lt(t,n,e){return void 0===n&&void 0===e?this.set(t):this.setRGB(t,n,e)}function Di(t,n,e){return e<0&&(e+=1),1<e&&--e,e<1/6?t+6*(n-t)*e:e<.5?n:e<2/3?t+6*(n-t)*(2/3-e):t}function Ui(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Bi(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}function Gi(t){return(Gi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Hi(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Gi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Gi(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Gi(t)?t:String(t)}(i.key),i)}}Object.assign(lt.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,n,e){return this.r=t,this.g=n,this.b=e,this},setHSL:function(t,n,e){return t=Tt.euclideanModulo(t,1),n=Tt.clamp(n,0,1),e=Tt.clamp(e,0,1),0===n?this.r=this.g=this.b=e:(this.r=Di(n=2*e-(e=e<=.5?e*(1+n):e+n-e*n),e,t+1/3),this.g=Di(n,e,t),this.b=Di(n,e,t-1/3)),this},setStyle:function(n){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+n+" will be ignored.")}if(u=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(n)){var e,i,r,o,s=u[1],a=u[2];switch(s){case"rgb":case"rgba":if(e=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[5]),this;if(e=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[5]),this;break;case"hsl":case"hsla":if(e=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return i=parseFloat(e[1])/360,r=parseInt(e[2],10)/100,o=parseInt(e[3],10)/100,t(e[5]),this.setHSL(i,r,o)}}else if(u=/^\#([A-Fa-f0-9]+)$/.exec(n)){var s=u[1],u=s.length;if(3===u)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,this}return n&&0<n.length?this.setColorName(n):this},setColorName:function(t){var n=Ii[t];return void 0!==n?this.setHex(n):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,n){return void 0===n&&(n=2),this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this},copyLinearToGamma:function(t,n){n=0<(n=void 0===n?2:n)?1/n:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=Ui(t.r),this.g=Ui(t.g),this.b=Ui(t.b),this},copyLinearToSRGB:function(t){return this.r=Bi(t.r),this.g=Bi(t.g),this.b=Bi(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var n,e=this.r,i=this.g,r=this.b,o=Math.max(e,i,r),s=Math.min(e,i,r),a=(s+o)/2;if(s===o)c=n=0;else{var u=o-s,c=a<=.5?u/(o+s):u/(2-o-s);switch(o){case e:n=(i-r)/u+(i<r?6:0);break;case i:n=(r-e)/u+2;break;case r:n=(e-i)/u+4}n/=6}return t.h=n,t.s=c,t.l=a,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,n,e){return this.getHSL(Ci),Ci.h+=t,Ci.s+=n,Ci.l+=e,this.setHSL(Ci.h,Ci.s,Ci.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this},lerpHSL:function(t,n){this.getHSL(Ci),t.getHSL(ki);var t=Tt.lerp(Ci.h,ki.h,n),e=Tt.lerp(Ci.s,ki.s,n),n=Tt.lerp(Ci.l,ki.l,n);return this.setHSL(t,e,n),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,n){return this.r=t[n=void 0===n?0:n],this.g=t[n+1],this.b=t[n+2],this},toArray:function(t,n){return(t=void 0===t?[]:t)[n=void 0===n?0:n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}}),lt.NAMES=Ii;var Xi=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")}var n,e,i;return n=t,i=[{key:"round",value:function(t){return 0<t.toFixed(2)?Math.ceil(t.toFixed(2)):Math.floor(t.toFixed(2))}},{key:"generateUUID",value:function(){for(var t=[],n=0;n<256;n++)t[n]=(n<16?"0":"")+n.toString(16);var e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,o=4294967295*Math.random()|0,e=t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&r|128]+t[r>>8&255]+"-"+t[r>>16&255]+t[r>>24&255]+t[255&o]+t[o>>8&255]+t[o>>16&255]+t[o>>24&255];return t.length=0,e.toUpperCase()}},{key:"findNearNthPowerOfTwo",value:function(t){t-=1;return(t=(t=(t=(t=(t|=t>>1)|t>>2)|t>>4)|t>>8)|t>>16)<0?1:1+t}},{key:"rgbToArray",value:function(t){var n=new lt;return n.setStyle(t),[n.r,n.g,n.b]}},{key:"toRgba",value:function(t){var n;return void 0===t?t:"number"!=typeof t?3<=(n=t.split(",")).length?"rgba("+parseInt(n[0])+","+parseInt(n[1])+","+parseInt(n[2])+",1)":t:"rgba("+parseInt(255*new lt(t).r)+","+parseInt(255*new lt(t).g)+","+parseInt(255*new lt(t).b)+",1)"}},{key:"toColor",value:function(t){var n;return"number"==typeof t?t:3<=(n=t.split(",")).length?parseInt(n[0])<<16|parseInt(n[1])<<8|parseInt(n[2]):(console.error("color format error",t),0)}},{key:"cov",value:function(t){for(var n=[],e=[0,0],i=[],r=0;r<t.length;r++)e[0]+=t[r].x,e[1]+=t[r].y;e[0]=e[0]/t.length,e[1]=e[1]/t.length;for(var o=0;o<t.length;o++)i.push([t[o].x-e[0],t[o].y-e[1]]);for(var s=[],a=0;a<i[0].length;a++){for(var u=[],c=0;c<i.length;c++)u.push(i[c][a]);s.push(u)}for(var f=0;f<s.length;f++){for(var h=[],l=0;l<i[0].length;l++){for(var d=0,v=0;v<s[f].length;v++)d+=s[f][v]*i[v][l];d/=t.length-1,h.push(d)}n.push(h)}return n}},{key:"eig",value:function(t){var n=(t[0][0]+t[1][1])/2,e=t[0][0]*t[1][1]-t[1][0]*t[0][1],i=n+Math.sqrt(n*n-e),n=n-Math.sqrt(n*n-e);return 0==t[0][1]&&0==t[1][0]?{eigValue:[i,n],eigVect:[[1,0],[0,1]]}:(e=(i-t[0][0])/t[0][1],t=(n-t[0][0])/t[0][1],{eigValue:[i,n],eigVect:[[1/Math.sqrt(1+e*e),e/Math.sqrt(1+e*e)],[1/Math.sqrt(1+t*t),t/Math.sqrt(1+t*t)]]})}}],(e=null)&&Hi(n.prototype,e),i&&Hi(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}();function zi(t){return(zi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Vi(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=zi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=zi(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==zi(t)?t:String(t)}(i.key),i)}}var n=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.Bt=(t=t||{}).src,this.Gt=t.dest,this.Ht=null,this.Xt=[],this.zt=0,this.Vt=0,this.Wt=0,this.Yt=f.THOUSAND,this.Qt=!1,this.Zt=!1,this.qt=!0,this.Kt=null,this.Jt=null,this.$t=Xi.generateUUID()}var t,e,i;return t=n,(e=[{key:"play",value:function(){return this.tn()}},{key:"pause",value:function(){return this.Zt=!0,this}},{key:"resume",value:function(){return this.Zt=!1,this.zt+=this.Wt,this.Wt=0,this}},{key:"stop",value:function(){return this.qt=!0,this}},{key:"finish",value:function(){return this.qt=!0,this.Jt&&this.Jt(),this.Xt=[],this}}])&&Vi(t.prototype,e),i&&Vi(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}(),Wi=(Object.assign(n.prototype,{nn:function(){for(var t in this)this[""+t]=null,delete this[""+t]},en:function(t){return this.Bt=t,this},rn:function(t){return this.Gt=t,this},sn:function(t){return this.Yt=t*f.THOUSAND,this},an:function(t){return this.Vt=t*f.THOUSAND,this},un:function(t){return this.Kt=t,this},cn:function(t){return this.Jt=t,this},hn:function(t){return this.Qt=t,this},tn:function(){return this.qt=!1,this.Ht&&(this.zt=this.Ht.ln),this},dn:function(){var t=new this.constructor({src:this.Bt,dest:this.Gt});return t.zt=this.zt,t.Vt=this.Vt,t.Yt=this.Yt,t.Qt=this.Qt,t.Kt=this.Kt,t.Jt=this.Jt,t},vn:function(){var t=this.Gt.concat(),n=this.Bt.concat();return this.Bt=t,this.Gt=n,this}}),n);function Yi(t){return(Yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qi(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Yi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Yi(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Yi(t)?t:String(t)}(i.key),i)}}function Zi(t,n,e){return n&&Qi(t.prototype,n),e&&Qi(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var qi=Zi(function t(n,e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.start=null!=n?n:0,this.stop=null!=e?e:0});function I(t){return null!=t}function Ki(t){return(Ki="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ji(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Ki(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Ki(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Ki(t)?t:String(t)}(i.key),i)}}var $i=function(){function u(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,e=this,i=u;if(!(e instanceof i))throw new TypeError("Cannot call a class as a function");this.center=null==t?void 0:t.clone(),this.radius=n}var t,n,e;return t=u,e=[{key:"computePlaneDistances",value:function(t,n,e,i){I(i)||(i=new qi);var r=new xt,n=(r.subVectors(t.center,n),e.dot(r));return i.start=n-t.radius,i.stop=n+t.radius,i}},{key:"clone",value:function(t,n){if(I(t))return I(n)?(n.center=t.center.clone(),n.radius=t.radius,n):new u(t.center,t.radius)}},{key:"expand",value:function(t,n,e){e=u.clone(t,e);t=n.distance(e.center);return t>e.radius&&(e.radius=t),e}},{key:"union",value:function(t,n,e){I(e)||(e=new u);var i=t.center,r=t.radius,o=n.center,s=n.radius,a=new xt,o=(a.subVectors(o,i),a.length());return o+s<=r?u.clone(t,e):o+r<=s?u.clone(n,e):(t=.5*(r+o+s),(n=a.clone()).multiplyScalar((t-r)/o),n.add(i),e.center=n.clone(),e.radius=t),e}},{key:"equals",value:function(t,n){return t===n||I(t)&&I(n)&&t.equals(n.center)&&t.radius===n.radius}}],(n=[{key:"valid",get:function(){return null!==this.center&&null!==this.radius}},{key:"reset",value:function(){this.center=null,this.radius=null}}])&&Ji(t.prototype,n),e&&Ji(t,e),Object.defineProperty(t,"prototype",{writable:!1}),u}();function tr(t){return(tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nr(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=tr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=tr(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==tr(t)?t:String(t)}(i.key),i)}}var er=function(){function i(t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.Ut=t,this.pn=new qi,this.mn=new $i}var t,n,e;return t=i,e=[{key:"getMeshBoudinggSphere",value:function(t){var t=(new Ft).setFromObject(t),n=new xt,e=(t.getCenter(n),new xt),t=(t.getSize(e),.5*e.length());return new $i(n,t)}},{key:"getSceneBoudingSphere",value:function(t,e){t.traverse(function(t){var n;"Mesh"===t.type?n=i.getMeshBoudinggSphere(t):"Scene"!==t.type&&"Group"!==t.type&&"DirectionalLight"!==t.type&&"AmbientLight"!==t.type&&(n=new $i(t.position,0)),!n||isNaN(n.radius)||isNaN(n.center.x)||isNaN(n.center.y)||isNaN(n.center.z)||(e.valid||$i.clone(n,e),$i.union(n,e,e))})}}],(n=[{key:"reset",value:function(){this.yn()}},{key:"update",value:function(t){this.bn(t)}}])&&nr(t.prototype,n),e&&nr(t,e),Object.defineProperty(t,"prototype",{writable:!1}),i}();function ir(t){return(ir="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function rr(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=ir(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=ir(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==ir(t)?t:String(t)}(i.key),i)}}function or(t,n,e){return n&&rr(t.prototype,n),e&&rr(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}Object.assign(er.prototype,{gn:function(){var t,n,e;!this.mn.valid||this.mn.radius<=0||(e=(t=this.Ut).target,((t=t.object).far>f.CAMERA_FAR||void 0===t.userData.far)&&(t.userData.far=Math.max(t.far,null!=(n=t.userData.far)?n:0)),void 0===t.userData.near&&(t.userData.near=t.near),n=t.position,e=e.clone().sub(n).normalize(),$i.computePlaneDistances(this.mn,n,e,this.pn),this.pn.start>=this.pn.stop)||(t.near=Math.max(this.pn.start,t.userData.near),t.far=this.pn.stop,t.updateProjectionMatrix())},yn:function(){this.mn.reset()},bn:function(t){var n=this;t.forEach(function(t){t&&er.getSceneBoudingSphere(t,n.mn)}),this.gn()}});var n=or(function t(n,e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.wn=n,this._n=e}),sr=(Object.assign(n.prototype,{En:function(t){return!1},Sn:function(t,n){}}),n),n={NONE:0,POINT:1,LINE:2,POLYGON:4,MULTIPOINT:8,MULTILINE:16,MULTIPOLYGON:32,GROUP:64,EXTENT:1024,EXTERNALMODEL:2048,MODEL:4096,FACILITY:8192,LABEL:16384,EXTENTGROUP:1<<20,EXTERNALMODELGROUP:1<<21,MODELGROUP:1<<22,FACILITYGROUP:1<<23,LABELGROUP:1<<24},ar=(Object.freeze(n),n),ur=function(t,n,e){e=e||2;var i,r,o,s,a,u=n&&n.length,c=u?n[0]*e:t.length,f=cr(t,0,c,e,!0),h=[];if(f&&f.next!==f.prev){if(u&&(f=function(t,n,e,i){var r,o,s,a,u=[];for(r=0,o=n.length;r<o;r++)a=n[r]*i,s=r<o-1?n[r+1]*i:t.length,(a=cr(t,a,s,i,!1))===a.next&&(a.steiner=!0),u.push(function(t){var n=t,e=t;for(;(n.x<e.x||n.x===e.x&&n.y<e.y)&&(e=n),n=n.next,n!==t;);return e}(a));for(u.sort(lr),r=0;r<u.length;r++)!function(t,n){(n=function(t,n){var e,i=n,r=t.x,o=t.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&s<a){if((s=a)===r){if(o===i.y)return i;if(o===i.next.y)return i.next}e=i.x<i.next.x?i:i.next}}}while(i=i.next,i!==n);if(!e)return null;if(r!==s){var u,c=e,f=e.x,h=e.y,l=1/0;for(i=e;r>=i.x&&i.x>=f&&r!==i.x&&vr(o<h?r:s,o,f,h,o<h?s:r,o,i.x,i.y)&&(u=Math.abs(o-i.y)/(r-i.x),wr(i,t))&&(u<l||u===l&&(i.x>e.x||i.x===e.x&&function(t,n){return pr(t.prev,t,n.prev)<0&&pr(n.next,t,t.next)<0}(e,i)))&&(e=i,l=u),(i=i.next)!==c;);}return e}(t,n))&&(t=_r(n,t),fr(n,n.next),fr(t,t.next))}(u[r],e),e=fr(e,e.next);return e}(t,n,f,e)),t.length>80*e){for(var l=i=t[0],d=r=t[1],v=e;v<c;v+=e)(o=t[v])<l&&(l=o),(s=t[v+1])<d&&(d=s),i<o&&(i=o),r<s&&(r=s);a=0!==(a=Math.max(i-l,r-d))?1/a:0}hr(f,h,e,l,d,a)}return h};function cr(t,n,e,i,r){var o,s;if(r===0<function(t,n,e,i){for(var r=0,o=n,s=e-i;o<e;o+=i)r+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return r}(t,n,e,i))for(o=n;o<e;o+=i)s=Er(o,t[o],t[o+1],s);else for(o=e-i;n<=o;o-=i)s=Er(o,t[o],t[o+1],s);return s&&mr(s,s.next)&&(Sr(s),s=s.next),s}function fr(t,n){if(!t)return t;n=n||t;var e,i=t;do{if(e=!1,i.steiner||!mr(i,i.next)&&0!==pr(i.prev,i,i.next))i=i.next;else{if(Sr(i),(i=n=i.prev)===i.next)break;e=!0}}while(e||i!==n);return n}function hr(t,n,e,i,r,o,s){if(t){if(!s&&o){for(var a=t,u=i,c=r,f=o,h=a;null===h.z&&(h.z=dr(h.x,h.y,u,c,f)),h.prevZ=h.prev,h.nextZ=h.next,(h=h.next)!==a;);h.prevZ.nextZ=null,h.prevZ=null;var l,d,v,p,m,y,b,g,w=h,_=1;do{for(d=w,m=w=null,y=0;d;){for(y++,v=d,l=b=0;l<_&&(b++,v=v.nextZ);l++);for(g=_;0<b||0<g&&v;)0!==b&&(0===g||!v||d.z<=v.z)?(d=(p=d).nextZ,b--):(v=(p=v).nextZ,g--),m?m.nextZ=p:w=p,p.prevZ=m,m=p;d=v}}while(m.nextZ=null,_*=2,1<y)}for(var E,S,T=t;t.prev!==t.next;)if(E=t.prev,S=t.next,o?function(t,n,e,i){var r=t.prev,o=t,s=t.next;if(0<=pr(r,o,s))return;var a=(r.x<o.x?r.x<s.x?r:s:o.x<s.x?o:s).x,u=(r.y<o.y?r.y<s.y?r:s:o.y<s.y?o:s).y,c=(r.x>o.x?r.x>s.x?r:s:o.x>s.x?o:s).x,f=(r.y>o.y?r.y>s.y?r:s:o.y>s.y?o:s).y,h=dr(a,u,n,e,i),l=dr(c,f,n,e,i),d=t.prevZ,v=t.nextZ;for(;d&&d.z>=h&&v&&v.z<=l;){if(d!==t.prev&&d!==t.next&&vr(r.x,r.y,o.x,o.y,s.x,s.y,d.x,d.y)&&0<=pr(d.prev,d,d.next))return;if(d=d.prevZ,v!==t.prev&&v!==t.next&&vr(r.x,r.y,o.x,o.y,s.x,s.y,v.x,v.y)&&0<=pr(v.prev,v,v.next))return;v=v.nextZ}for(;d&&d.z>=h;){if(d!==t.prev&&d!==t.next&&vr(r.x,r.y,o.x,o.y,s.x,s.y,d.x,d.y)&&0<=pr(d.prev,d,d.next))return;d=d.prevZ}for(;v&&v.z<=l;){if(v!==t.prev&&v!==t.next&&vr(r.x,r.y,o.x,o.y,s.x,s.y,v.x,v.y)&&0<=pr(v.prev,v,v.next))return;v=v.nextZ}return 1}(t,i,r,o):function(t){var n=t.prev,e=t,i=t.next;if(0<=pr(n,e,i))return;var r=t.next.next;for(;r!==t.prev;){if(vr(n.x,n.y,e.x,e.y,i.x,i.y,r.x,r.y)&&0<=pr(r.prev,r,r.next))return;r=r.next}return 1}(t))n.push(E.i/e),n.push(t.i/e),n.push(S.i/e),Sr(t),t=S.next,T=S.next;else if((t=S)===T){s?1===s?hr(t=function(t,n,e){var i=t;do{var r=i.prev,o=i.next.next}while(!mr(r,o)&&yr(r,i,i.next,o)&&wr(r,o)&&wr(o,r)&&(n.push(r.i/e),n.push(i.i/e),n.push(o.i/e),Sr(i),Sr(i.next),i=t=o),i=i.next,i!==t);return fr(i)}(fr(t),n,e),n,e,i,r,o,2):2===s&&function(t,n,e,i,r,o){var s=t;do{for(var a,u=s.next.next;u!==s.prev;){if(s.i!==u.i&&function(t,n){return t.next.i!==n.i&&t.prev.i!==n.i&&!function(t,n){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==n.i&&e.next.i!==n.i&&yr(e,e.next,t,n))return 1}while(e=e.next,e!==t);return}(t,n)&&(wr(t,n)&&wr(n,t)&&function(t,n){var e=t,i=!1,r=(t.x+n.x)/2,o=(t.y+n.y)/2;for(;e.y>o!=e.next.y>o&&e.next.y!==e.y&&r<(e.next.x-e.x)*(o-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next,e!==t;);return i}(t,n)&&(pr(t.prev,t,n.prev)||pr(t,n.prev,n))||mr(t,n)&&0<pr(t.prev,t,t.next)&&0<pr(n.prev,n,n.next))}(s,u))return a=_r(s,u),s=fr(s,s.next),a=fr(a,a.next),hr(s,n,e,i,r,o),hr(a,n,e,i,r,o);u=u.next}}while(s=s.next,s!==t)}(t,n,e,i,r,o):hr(fr(t),n,e,i,r,o,1);break}}}function lr(t,n){return t.x-n.x}function dr(t,n,e,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-e)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-i)*r)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function vr(t,n,e,i,r,o,s,a){return 0<=(r-s)*(n-a)-(t-s)*(o-a)&&0<=(t-s)*(i-a)-(e-s)*(n-a)&&0<=(e-s)*(o-a)-(r-s)*(i-a)}function pr(t,n,e){return(n.y-t.y)*(e.x-n.x)-(n.x-t.x)*(e.y-n.y)}function mr(t,n){return t.x===n.x&&t.y===n.y}function yr(t,n,e,i){var r=gr(pr(t,n,e)),o=gr(pr(t,n,i)),s=gr(pr(e,i,t)),a=gr(pr(e,i,n));return r!==o&&s!==a||0===r&&br(t,e,n)||0===o&&br(t,i,n)||0===s&&br(e,t,i)||!(0!==a||!br(e,n,i))}function br(t,n,e){return n.x<=Math.max(t.x,e.x)&&n.x>=Math.min(t.x,e.x)&&n.y<=Math.max(t.y,e.y)&&n.y>=Math.min(t.y,e.y)}function gr(t){return 0<t?1:t<0?-1:0}function wr(t,n){return pr(t.prev,t,t.next)<0?0<=pr(t,n,t.next)&&0<=pr(t,t.prev,n):pr(t,n,t.prev)<0||pr(t,t.next,n)<0}function _r(t,n){var e=new Tr(t.i,t.x,t.y),i=new Tr(n.i,n.x,n.y),r=t.next,o=n.prev;return(t.next=n).prev=t,(e.next=r).prev=e,(i.next=e).prev=i,(o.next=i).prev=o,i}function Er(t,n,e,i){t=new Tr(t,n,e);return i?(t.next=i.next,(t.prev=i).next.prev=t,i.next=t):(t.prev=t).next=t,t}function Sr(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Tr(t,n,e){this.i=t,this.x=n,this.y=e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xr(t){return function(t){if(Array.isArray(t))return Ar(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){var e;if(t)return"string"==typeof t?Ar(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Ar(t,n):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ar(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}var Mr={area:function(t){for(var n=t.length,e=0,i=n-1,r=0;r<n;i=r++)e+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*e},isClockWise:function(t){return Mr.area(t)<0},triangulateShape:function(t,n){var e=[],i=[],r=[],o=(Or(t),Lr(e,t),t.length);n.forEach(Or);for(var s=0;s<n.length;s++)i.push(o),o+=n[s].length,Lr(e,n[s]);for(var a=ur(e,i),u=0;u<a.length;u+=3)r.push(a.slice(u,u+3));return r},triangulate:function(t){(r=[]).push.apply(r,xr(t[0]));for(var n=[],e=1;e<t.length;e++){var i=[];i.push.apply(i,xr(t[e])),n.push(i)}if(!Mr.isClockWise(r))for(var r=r.reverse(),o=0,s=n.length;o<s;o++){var a=n[o];Mr.isClockWise(a)&&(n[o]=a.reverse())}return Mr.triangulateShape(r,n)}};function Or(t){var n,e=t.length;2<e&&(e=t[e-1],n=t[0],e.x===n.x)&&e.y===n.y&&t.pop()}function Lr(t,n){for(var e=0;e<n.length;e++)t.push(n[e].x),t.push(n[e].y)}function Rr(t){return(Rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Nr(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Rr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Rr(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Rr(t)?t:String(t)}(i.key),i)}}function Pr(t,n,e){return n&&Nr(t.prototype,n),e&&Nr(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var jr=1e-5,Fr=.001,Ir=Math.PI/180,Cr=180/Math.PI,n=Pr(function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")});Object.assign(n.prototype,{Tn:function(){return jr},xn:function(){return Ir},An:function(){return Cr},Mn:function(t){return t<jr&&-jr<t},On:function(t){return jr<t},Ln:function(t){return t<-jr},Rn:function(t,n,e){n=(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y);return Math.abs(n)<jr?0:n},distanceOfTwoPoints:function(t,n){return t&&n?Math.sqrt((t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y)):Number.NaN},distance:function(t,n){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))},isPolygonContainPoint:function(t,n){for(var e=0,i=0;i<t.length;i++){var r=t[i].x,o=t[i].y,s=0,a=0,a=(i<t.length-1?(s=t[i+1].x,t[i+1]):(s=t[0].x,t[0])).y;if(r===n.x&&o===n.y||s===n.x&&a===n.y)return!0;if(a!==o){var u=r+(n.y-o)*(s-r)/(a-o);if(u===n.x)return!0;r!==s?u<=Math.max(r,s)&&u>=Math.min(r,s)&&u>n.x&&u!==r&&(u===s&&0<(o-n.y)*(a-n.y)?e+=2:e++):u<=Math.max(r,s)&&u>=Math.min(r,s)&&u>n.x&&(u===s&&0<(o-n.y)*(a-n.y)?e+=2:e++)}}return 0<e%2},isPolygonContainPoint2:function(t,n){var e=t.length;if(e<3)return!1;for(var i=e-1,r=0,o=0;o<e;o++){var s=t[o],a=t[i];s.y>n.y!=a.y>n.y&&n.x<(a.x-s.x)*(n.y-s.y)/(a.y-s.y)+s.x&&(s.y>a.y?r++:r--),i=o}return 0!=r},isPolygonInPolygon:function(t,n){var e=Object.assign([],t),i=Object.assign([],n);e.push(e[0]),i.push(i[0]);for(var r=0;r<e.length-1;r++){var o=e[r];if(!this.isPolygonContainPoint(i,o)&&!this.isPolygonContainPoint2(i,o))return!1}for(var s=0;s<e.length-1;s++)for(var a=0;a<i.length-1;a++)if(this.Nn(e[s],e[s+1],i[a],i[a+1]).isintersect&&!this.Pn(i[a],i[a+1],e[s])&&!this.Pn(i[a],i[a+1],e[s+1]))return!1;return!0},jn:function(t,n,e,i){return!(Math.max(t.x,n.x)<Math.min(e.x,i.x)||Math.max(t.y,n.y)<Math.min(e.y,i.y)||Math.max(e.x,i.x)<Math.min(t.x,n.x)||Math.max(e.y,i.y)<Math.min(t.y,n.y))},Fn:function(t,n,e,i){return!(Math.max(t.x,n.x)<Math.min(e.x,i.x)||Math.max(t.y,n.y)<Math.min(e.y,i.y)||Math.max(e.x,i.x)<Math.min(t.x,n.x)||Math.max(e.y,i.y)<Math.min(t.y,n.y)||0===this.Rn(e,n,t)&&0===this.Rn(n,i,t)||this.Rn(e,n,t)*this.Rn(n,i,t)<0||this.Rn(t,i,e)*this.Rn(i,n,e)<0)},Cn:function(t,n,e){return!(t.x<n.x||t.y<n.y||t.x>e.x||t.y>e.y)},kn:function(t,n,e){var i=Math.min(n.x,e.x),r=Math.max(n.x,e.x),o=Math.min(n.y,e.y),n=Math.max(n.y,e.y);return!(t.x<i||t.x>r||t.y<o||t.y>n)},Dn:function(t,n,e){var i=Math.min(e.x,n.x),r=Math.max(e.x,n.x),o=Math.min(e.y,n.y),e=Math.max(e.y,n.y);return!(t.x<i||t.x>r||t.y<o||t.y>e)},Un:function(t,n,e){for(var i,r,o=!1,s=0;s<e;s++)i=n[s],r=n[(s+1)%e],(i.y<t.y&&r.y>=t.y||r.y<t.y&&i.y>=t.y)&&(i.x<=t.x||r.x<=t.x)&&i.x+(t.y-i.y)/(r.y-i.y)*(r.x-i.x)<t.x&&(o=!o);return o},Bn:function(t,n,e){return(t.x-n.x)*(e.y-n.y)==(e.x-n.x)*(t.y-n.y)&&Math.min(n.x,e.x)<=t.x&&t.x<=Math.max(n.x,e.x)&&Math.min(n.y,e.y)<=t.y&&t.y<=Math.max(n.y,e.y)},Gn:function(t,n){return Math.sqrt((t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y))},Hn:function(t,n){return(t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y)},Xn:function(t,n,e){var i=n.x,n=n.y,r=e.x,e=e.y,o=t.x,t=t.y,s=r-i,a=e-n,u=s*s+a*a,c=o-i,f=t-n,h=c*c+f*f;return this.Mn(u)?this.Mn(h)?0:h:(u=Math.sqrt(u),f=this.On(a=(s=s/u)*c+(c=a/u)*f)?this.Ln(a-u)?(f=o-(i+a*s))*f+(u=t-(n+a*c))*u:(i=o-r)*i+(s=t-e)*s:h,this.Mn(f)?0:f)},zn:function(t,n,e,i){var r,o=n.x,s=n.y,a=e.x,u=e.y,c=t.x,t=t.y,f=a-o,h=u-s,l=Math.sqrt(f*f+h*h),d=c-o,v=t-s,p=Math.sqrt(d*d+v*v);return this.Mn(l)?(i.x=n.x,i.y=n.y,this.Mn(r=p)?0:r):(r=this.On(h=(f=f/l)*d+(d=h/l)*v)?this.Ln(h-l)?(l=c-(v=o+h*f),f=t-(o=s+h*d),s=Math.sqrt(l*l+f*f),i.x=v,i.y=o,s):(h=c-a,d=t-u,l=Math.sqrt(h*h+d*d),i.x=e.x,i.y=e.y,l):(i.x=n.x,i.y=n.y,p),this.Mn(r)?0:r)},Vn:function(t,n){for(var e=0,i=0,r=0,o=0;o<n;o++){var s=t[o],a=t[(o+1)%n],u=(s.x*a.y-s.y*a.x)/2;e+=u,i+=u*(s.x+a.x)/3,r+=u*(s.y+a.y)/3}return{x:i/=e,y:r/=e}},Wn:function(t){for(var n=Mr.triangulate([t]),e=0,i=0,r=0,o=0;o<n.length;o++){var s=t[n[o][0]],a=t[n[o][1]],u=t[n[o][2]],c=a.x-s.x,f=a.y-s.y,h=u.x-s.x,c=(c*(u.y-s.y)-h*f)/2;e+=c,i+=(s.x+a.x+u.x)/3*c,r+=(s.y+a.y+u.y)/3*c}return{x:i/e,y:r/e}},Yn:function(t,n){if(n<3)return 0;for(var e=0,i=0;i<n;++i){var r=t[i],o=t[(i+1)%n];e+=r.x*o.y-r.y*o.x}return Math.abs(e/2)},Qn:function(t,n,e,i,r){var o,s;return this.Fn(t,n,e,i)?(o=(i.x-e.x)*(t.y-n.y)-(n.x-t.x)*(e.y-i.y),s=(t.y-e.y)*(n.x-t.x)*(i.x-e.x)+e.x*(i.y-e.y)*(n.x-t.x)-t.x*(n.y-t.y)*(i.x-e.x),r.x=s/o,o=(t.x-n.x)*(i.y-e.y)-(n.y-t.y)*(e.x-i.x),s=n.y*(t.x-n.x)*(i.y-e.y)+(i.x-n.x)*(i.y-e.y)*(t.y-n.y)-i.y*(e.x-i.x)*(n.y-t.y),r.y=s/o,1):0},Zn:function(t,n,e,i,r){var o=Math.min(e.x,i.x),s=Math.max(e.x,i.x),a=Math.min(e.y,i.y),u=Math.max(e.y,i.y),c=t.x,f=t.y,h=e.x,l=e.y,d=i.x,v=i.y;if(90==n)return!(t.x<o||t.x>s||(s-o<Fr?t.y>=l&&t.y<=v||t.y>=v&&t.y<=l?(r.x=t.x,r.y=t.y,0):l<v&&t.x<l?(r.x=h,r.y=l,0):!(v<l&&t.x<v)||(r.x=d,r.y=v,0):(r.y=p=(v-l)/(d-h)*(c-h)+l,r.x=c,p<f||!this.Dn(r,e,i))));if(270==n)return!(t.x<o||t.x>s||(Math.abs(s-o<Fr)?t.y>=l&&t.y<=v||t.y>=v&&t.y<=l?(r.x=t.x,r.y=t.y,0):l<v&&t.y>v?(r.x=d,r.y=v,0):!(v<l&&t.y>l)||(r.x=h,r.y=l,0):(r.y=p=(v-l)/(d-h)*(c-h)+l,r.x=c,f<p||!this.Dn(r,e,i))));if(270!=n&&90!=n&&Math.abs(s-o<Fr)){var t=o,p=Math.tan(n/180*Math.PI)*(t-c)+f;if(r.y=p,r.x=t,this.Dn(r,e,i))return s=p-f,0<(o=t-c)/Math.sqrt(o*o+s*s)*Math.cos(n/180*Math.PI)}return Math.abs(u-a<=Fr)?(p=a,t=1/Math.tan(n/180*Math.PI)*(p-f)+c,r.x=t,r.y=p,!!this.Dn(r,e,i)&&(o=p-f,0<(s=t-c)/Math.sqrt(s*s+o*o)*Math.cos(n/180*Math.PI))):(t=f+(u=Math.tan(n/180*Math.PI))*((p=(l-f-((a=(v-l)/(d-h))*h-u*c))/(u-a))-c),r.x=p,r.y=t,!!this.Dn(r,e,i)&&(s=p-c,o=t-f,Math.abs(s)<=Fr&&Math.abs(o)<=Fr||0<s/Math.sqrt(s*s+o*o)*Math.cos(n/180*Math.PI)))},qn:function(t,n){return Math.abs(t.x-n.x)<jr&&Math.abs(t.y-n.y)<jr},Kn:function(t,n,e,i){var r,o,s,a,u=t.x,c=t.y,f=n.x,h=n.y,l=e.x,d=e.y;return this.qn(t,n)||this.qn(t,e)?(i.x=u,i.y=c,!0):(s=Math.min(n.x,e.x),a=Math.max(n.x,e.x),r=Math.min(n.y,e.y),o=Math.max(n.y,e.y),Math.abs(f-l)<1e-5?(i.x=f,r<=(i.y=c)&&c<=o):Math.abs(h-d)<1e-5?(i.x=u,i.y=h,s<=u&&u<=a):(a=c+(r=-1/((d-h)/(l-f)))*((s=(h-c-((o=(d-h)/(l-f))*f-r*u))/(r-o))-u),i.x=s,i.y=a,!!this.Dn(i,n,e)||!(!this.qn(t,n)&&!this.qn(t,e))))},Jn:function(t,n){return{x:t.y*n.z-t.z*n.y,y:t.z*n.x-t.x*n.z,z:t.x*n.y-t.y*n.x}},$n:function(t,n){return t.x*n.x+t.y*n.y+t.z*n.z},te:function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},ne:function(t,n){return t.x*n.x+t.y*n.y},ee:function(t,n){return t.x*n.y-t.y*n.x},ie:function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},re:function(t,n){var e,i;return 0==t.x&&0==t.y||0==n.x&&0==n.y?0:(e={x:t.x,y:t.y,z:0},i={x:n.x,y:n.y,z:0},e=this.Jn(e,i),i=this.ne(t,n),i=Math.acos(i/(this.ie(t)*this.ie(n))),0<e.z?i/Math.PI*180:360-i/Math.PI*180)},oe:function(t,n,e,i){for(var r=0;r<e.length;r++){var o=e[r],s=e[(r+1)%e.length];if(1==this.Qn(t,n,o,s,i))return!0}return!1},se:function(t,n,e,i,r){var o=Math.min(t.x,e.x,i.x),s=Math.max(t.x,e.x,i.x),a=Math.min(t.y,e.y,i.y),u=Math.max(t.y,e.y,i.y),s=Math.sqrt((s-o)*(s-o)+(u-a)*(u-a)),o=n/180*Math.PI,u=s*Math.cos(o)+t.x,a=s*Math.sin(o)+t.y;return 1==this.Qn(t,{x:u,y:a},e,i,r)},ae:function(t){var n={x:null,y:null},e=0,i=0,r=t.length;1<t.length&&t[0].x===t[t.length-1].x&&t[0].y===t[t.length-1].y&&r--;for(var o=0;o<r;o++)e+=t[o].x,i+=t[o].y;return n.x=e/t.length,n.y=i/t.length,n},ue:function(t,n,e,i){var r=[],o=t.x-n,s=t.x+n,a=t.y-n,u=t.y+n,c=Math.min(e.x,i.x),f=Math.max(e.x,i.x),h=Math.min(e.y,i.y),l=Math.max(e.y,i.y);return f<o||s<c||l<a||u<h||(o=i.x-e.x,s=i.y-e.y,(a=(t=(o*(a=t.x-e.x)+s*(u=t.y-e.y))/(i=o*o+s*s))*t-(a*a+u*u-n*n)/i)<0)||(u=Math.sqrt(a),i={x:e.x-o*(n=-t+u),y:e.y-s*n},o={x:e.x-o*(a=-t-u),y:e.y-s*a},n!==a&&(c<=i.x&&i.x<=f&&h<=i.y&&i.y<=l&&r.push(i),c<=o.x)&&o.x<=f&&h<=o.y&&o.y<=l&&r.push(o)),r},ce:function(t,n,e){var i,r={};if(t.x!=n.x)return i=n=(n.y-t.y)/(n.x-t.x),n=t.y-n*t.x,r.x=(+e.x- -1*i*e.y-i*n)/(i*i+1),r.y=(i*i*e.y- -1*i*e.x- -1*n)/(i*i+1),r;r.x=t.x,r.y=e.y},Nn:function(t,n,e,i){var r,o,s,a,u={point:null,isintersect:!1};return this.distanceOfTwoPoints(t,e)<.001||this.distanceOfTwoPoints(t,i)<.001?(u.isintersect=!0,u.point=t):this.distanceOfTwoPoints(n,e)<.001||this.distanceOfTwoPoints(n,i)<.001?(u.isintersect=!0,u.point=n):(r={x:n.x-t.x,y:n.y-t.y},o={x:i.x-e.x,y:i.y-e.y},s={x:e.x-t.x,y:e.y-t.y},i={x:i.x-t.x,y:i.y-t.y},n={x:n.x-e.x,y:n.y-e.y},e={x:-s.x,y:-s.y},a=this.ee(o,r),Math.abs(a)<=1e-5||this.ee(s,r)*this.ee(i,r)<=-5e-4&&this.ee(e,o)*this.ee(n,o)<-5e-4&&(i=this.ee(o,s)/a,u.point={x:t.x+r.x*i,y:t.y+r.y*i},u.isintersect=!0)),u},fe:function(t,n,e){t.x===n.x&&(n.x=n.x+1),t.y===n.y&&(n.y=n.y+1),n.x===e.x&&(e.x=e.x+1),n.y===e.y&&(e.y=e.y+1);var i=n.x-t.x,t=n.y-t.y,r=e.x-n.x;return!(0<i*(e.y-n.y)-t*r)},getAngle:function(t){var n=t.p1,t=t.p2,e=t.x-n.x,t=t.y-n.y,n=Math.sqrt(e*e+t*t),n=Math.asin(Math.abs(t)/n);return 0<e&&0<t?n:e<0&&0<t?Math.PI-n:e<0&&t<0?Math.PI+n:0<e&&t<0?2*Math.PI-n:0==e&&0<t?n:0==e&&t<0?3*Math.PI/2:0<e&&0==t?n:e<0&&0==t?Math.PI:null},he:function(t){var n=this.distanceOfTwoPoints(t[0],t[1]),e=this.distanceOfTwoPoints(t[1],t[2]),t=this.distanceOfTwoPoints(t[0],t[2]),i=(n+e+t)/2;return Math.sqrt(i*(i-n)*(i-e)*(i-t))},le:function(t,n){var e,i,r,o,s;return this.zn(t,n[0],n[1],{})<1e-4||this.zn(t,n[0],n[2],{})<1e-4||this.zn(t,n[1],n[2],{})<1e-4||(o={x:n[1].x-n[0].x,y:n[1].y-n[0].y},e={x:n[0].x-n[2].x,y:n[0].y-n[2].y},i={x:n[2].x-n[1].x,y:n[2].y-n[1].y},s={x:t.x-n[0].x,y:t.y-n[0].y},r={x:t.x-n[1].x,y:t.y-n[1].y},t={x:t.x-n[2].x,y:t.y-n[2].y},n=this.ee(o,s),o=this.ee(i,r),s=this.ee(e,t),jr<n*o&&jr<o*s)},de:function(t,n,e){var i=e.length,r={isintersect:!1,start:null,end:null,type:0,outer:null},o=[];if(this.le(t,e)&&(r.start=t),this.le(n,e)&&(r.end=n),null!=r.start&&null!=r.end)r.isintersect=!0,r.type=1;else{for(var s=(e[1].x+e[2].x)/2,a=(e[1].y+e[2].y)/2,u=1;u<i;u++){var c,f=this.Nn(t,n,e[u-1],e[u]);if(f.isintersect){if(null!=r.start)return r.end=f.point,r.isintersect=!0,r.outer="end",c=this.re({x:s-e[0].x,y:a-e[0].y},{x:n.x-e[0].x,y:n.y-e[0].y}),r.type=0<(c=c<180?c:c-360)?2:3,r;if(null!=r.end)return r.start=f.point,r.isintersect=!0,r.outer="start",c=this.re({x:s-e[0].x,y:a-e[0].y},{x:t.x-e[0].x,y:t.y-e[0].y}),r.type=0<(c=c<180?c:c-360)?2:3,r;o.push(f)}}var h,l=this.Nn(t,n,e[0],e[i-1]);if(l.isintersect){if(null!=r.start)return r.end=l.point,r.isintersect=!0,r.outer="end",h=this.re({x:s-e[0].x,y:a-e[0].y},{x:n.x-e[0].x,y:n.y-e[0].y}),r.type=0<(h=h<180?h:h-360)?2:3,r;if(null!=r.end)return r.start=l.point,r.isintersect=!0,r.outer="start",h=this.re({x:s-e[0].x,y:a-e[0].y},{x:t.x-e[0].x,y:t.y-e[0].y}),r.type=0<(h=h<180?h:h-360)?2:3,r;o.push(l)}2!=o.length||this.distanceOfTwoPoints(o[0].point,o[1].point)<.01||(this.distanceOfTwoPoints(o[0].point,t)<=this.distanceOfTwoPoints(o[0].point,n)?(r.start=o[0].point,r.end=o[1].point):(r.start=o[1].point,r.end=o[0].point),r.isintersect=!0,r.type=4)}return r},ve:function(t,n,e){var i=e.length,r={isintersect:!1,start:null,end:null},o=[];if(this.le(t,e)&&(r.start=t),this.le(n,e)&&(r.end=n),null!=r.start&&null!=r.end)r.isintersect=!0;else{for(var s=1;s<i;s++){var a=this.Nn(t,n,e[s-1],e[s]);if(a.isintersect){if(null!=r.start)return r.end=a.point,r.isintersect=!0,r;if(null!=r.end)return r.start=t,r.isintersect=!0,r;o.push(a)}}var u=this.Nn(t,n,e[0],e[i-1]);if(u.isintersect){if(null!=r.start)return r.end=u.point,r.isintersect=!0,r;if(null!=r.end)return r.start=t,r.isintersect=!0,r;o.push(u)}2==o.length&&(r.start=(this.distanceOfTwoPoints(o[0].point,t)<=this.distanceOfTwoPoints(o[0].point,n)?o[0]:o[1]).point,r.end=(this.distanceOfTwoPoints(o[0].point,t)>this.distanceOfTwoPoints(o[0].point,n)?o[0]:o[1]).point,r.isintersect=!0)}return r},pe:function(r,t){if(0==t.length)return[r];for(var n,e,i=this.me(t),o=[],s=(i.sort(function(t,n){var e=(t.ye.x-r.ye.x)*(t.ye.x-r.ye.x)+(t.ye.y-r.ye.y)*(t.ye.y-r.ye.y),i=(n.ye.x-r.ye.x)*(n.ye.x-r.ye.x)+(n.ye.y-r.ye.y)*(n.ye.y-r.ye.y),t=(t.be.x-r.ye.x)*(t.be.x-r.ye.x)+(t.be.y-r.ye.y)*(t.be.y-r.ye.y),n=(n.be.x-r.ye.x)*(n.be.x-r.ye.x)+(n.be.y-r.ye.y)*(n.be.y-r.ye.y);return(e<t?e:t)<(i<n?i:n)}),0),s=0;s<i.length;s++)this.distanceOfTwoPoints(i[s].ye,i[s].be)<.01||(n=this.distanceOfTwoPoints(i[s].ye,r.ye),e=this.distanceOfTwoPoints(i[s].be,r.ye),n<.01?r.ye=i[s].be:e<.01?r.ye=i[s].ye:n<e?.1<this.distanceOfTwoPoints(r.ye,i[s].ye)&&(o.push({ge:r.ge,ye:r.ye,be:i[s].ye,Gn:r.Gn,we:r.we}),r.ye=i[s].be):.1<this.distanceOfTwoPoints(r.ye,i[s].be)&&(o.push({ge:r.ge,ye:r.ye,be:i[s].be,Gn:r.Gn,we:r.we}),r.ye=i[s].ye),i.splice(s,1));return.1<this.distanceOfTwoPoints(r.ye,r.be)&&o.push(r),o},me:function(t){var n=[];if(1==t.length)return t;for(var e=t[0],i=1;0<t.length;){if(i>=t.length){if(n.push(e),t.splice(0,1),t.length<1)break;e=t[0],i=1}if(1===t.length){n.push(e);break}this.Pn(e.ye,e.be,t[i].ye)?(this.Pn(e.ye,e.be,t[i].be)||(e.be=t[i].be),t.splice(i,1)):this.Pn(e.ye,e.be,t[i].be)?(e.ye=t[i].ye,t.splice(i,1)):this.Pn(t[i].ye,t[i].be,e.ye)?(e=(this.Pn(t[i].ye,t[i].be,e.be)||(t[i].be=e.be),t[i]),t.splice(i,1)):this.Pn(t[i].ye,t[i].be,e.be)?(t[i].ye=e.ye,e=t[i],t.splice(i,1)):i++}return n},Pn:function(t,n,e){var i=t.x-e.x,r=t.y-e.y,o=n.x-e.x,s=n.y-e.y,a=this.distanceOfTwoPoints(t,e),e=this.distanceOfTwoPoints(n,e),t=this.distanceOfTwoPoints(t,n);return i*s-r*o<1e-5&&a+e-t<.001},_e:function(t,n,e){var i=n.x-t.x,t=n.y-t.y,r=Math.sqrt(i*i+t*t);return{x:n.x+i/r*e,y:n.y+t/r*e}}});var W=new n;function kr(t){return(kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dr(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=kr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=kr(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==kr(t)?t:String(t)}(i.key),i)}}var n=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.X={x:Number.MAX_VALUE,y:Number.MAX_VALUE},this.H={x:-Number.MAX_VALUE,y:-Number.MAX_VALUE}}var n,e,i;return n=t,(e=[{key:"min",get:function(){return this.X}},{key:"max",get:function(){return this.H}},{key:"center",get:function(){var t={x:Number.NaN,y:Number.NaN};return this.valid()&&(t.x=(this.min.x+this.max.x)/2,t.y=(this.min.y+this.max.y)/2),t}},{key:"size",get:function(){var t={x:Number.NaN,y:Number.NaN};return this.valid()&&(t.x=this.max.x-this.min.x,t.y=this.max.y-this.min.y),t}},{key:"copy",value:function(t){return this.H.x=t.max.x,this.H.y=t.max.y,this.X.x=t.min.x,this.X.y=t.min.y,this}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"reset",value:function(){this.X={x:Number.MAX_VALUE,y:Number.MAX_VALUE},this.H={x:-Number.MAX_VALUE,y:-Number.MAX_VALUE}}},{key:"toObject",value:function(){return{min:this.min,max:this.max,center:this.center,size:this.size}}},{key:"expand",value:function(t){this.Ee(t)}},{key:"expandByCoords",value:function(t){this.Se(t)}},{key:"valid",value:function(){return this.Te()}},{key:"isCross",value:function(t){var n=!0;return t.max.x<this.min.x&&(n=!1),t.min.x>this.max.x&&(n=!1),t.max.y<this.min.y&&(n=!1),n=t.min.y>this.max.y?!1:n}}])&&Dr(n.prototype,e),i&&Dr(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}(),Ur=(Object.assign(n.prototype,{Te:function(){return!(this.min.x>this.max.x||this.min.y>this.max.y)},Ee:function(t){t&&t.valid()&&(t.min.x<this.min.x&&(this.min.x=t.min.x),t.min.y<this.min.y&&(this.min.y=t.min.y),t.max.x>this.max.x&&(this.max.x=t.max.x),t.max.y>this.max.y)&&(this.max.y=t.max.y)},Se:function(t){var n=this;t&&0!=t.length&&t.forEach(function(t){t.x<n.min.x&&(n.min.x=t.x),t.y<n.min.y&&(n.min.y=t.y),t.x>n.max.x&&(n.max.x=t.x),t.y>n.max.y&&(n.max.y=t.y)})}}),n);function Br(t){return(Br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Gr(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Br(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Br(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Br(t)?t:String(t)}(i.key),i)}}function Hr(t,n,e){n=zr(n);var i=t,n=Xr()?Reflect.construct(n,e||[],zr(t).constructor):n.apply(t,e);if(n&&("object"===Br(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function Xr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Xr=function(){return!!t})()}function zr(t){return(zr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Vr(t,n){return(Vr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var n=function(){var t,n,e=r,i=sr;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(t,n){if(this instanceof r)return(t=Hr(this,r,[t,n])).xe=new Ur,t.Ae=null,t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Vr(e,i),e=r,t&&Gr(e.prototype,t),n&&Gr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(),Wr=(Object.assign(n.prototype,{En:function(t){return t.getType()!=ar.MODEL?this.Me(t):this.Oe(t)},Oe:function(t){return!0},Le:function(t){t=t.getBound();return!!W.jn(this.xe.X,this.xe.H,t.min,t.max)},Sn:function(t,n){var e=t.getCoordinates();if(t.getType()!==ar.MODEL)n.Gn=Math.sqrt(W.Hn(e[0],this.Re));else{for(var i=Number.MAX_VALUE,r=0,o=e.length;r<o;r++)for(var s=1,a=e[r].length;s<a;s++){var u=e[r][s-1],c=e[r][s],u=W.Xn(this.Re,u,c);u<i&&(i=u)}n.Gn=Math.sqrt(i)}},Me:function(t){t=t.getCoordinates()[0];return!!W.Cn(t,this.xe.X,this.xe.H)&&("circle"===this.Ae?W.Hn(t,this.Re)<this._radiusSquare:W.Un(t,this.Ne,this.Ne.length-1))}}),n);function Yr(t){return(Yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qr(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Yr(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Yr(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Yr(t)?t:String(t)}(i.key),i)}}function Zr(t,n,e){n=Kr(n);var i=t,n=qr()?Reflect.construct(n,e||[],Kr(t).constructor):n.apply(t,e);if(n&&("object"===Yr(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function qr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(qr=function(){return!!t})()}function Kr(t){return(Kr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Jr(t,n){return(Jr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var n=function(){var t,n,e=r,i=Wr;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(t,n){if(this instanceof r)return(t=Zr(this,r,[t,n])).Ae="polygon",t.Ne=t._n,t.Pe=t.Ne.length-1,t.Re=W.Wn(t.Ne),t.xe.Se(t.Ne),t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Jr(e,i),e=r,t&&Qr(e.prototype,t),n&&Qr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(),$r=(Object.assign(n.prototype,{Oe:function(t){if(this.Le(t)){for(var n=t.getCoordinates(),e=0,i=n.length;e<i;e++)for(var r=0,o=n[e].length-1;r<o;r++)if(W.Un(n[e][r],this.Ne,this.Ne.length))return!0;for(var s=0;s<this.Pe;s++){for(var a=!1,u=0,c=n.length;u<c;u++)W.Un(this.Ne[s],n[u],n[u].length-1)&&(a=0==u);if(a)return!0}for(var f=0;f<=this.Pe;f++)for(var h=null,l=null,l=f===this.Pe?(h=this.Ne[0],this.Ne[f]):(h=this.Ne[f],this.Ne[f+1]),d=0,v=n.length;d<v;d++)for(var p=0,m=n[d].length-1;p<m;p++){var y=n[d][p],b=n[d][p+1];if(W.Fn(h,l,y,b))return!0}}return!1}}),n),to=t(30),n={STOP:0,PASS:1,PUSH:2},no=(Object.freeze(n),n);function eo(t){return(eo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function io(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=eo(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=eo(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==eo(t)?t:String(t)}(i.key),i)}}var n=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.je=-1,this.Fe=ar.NONE,this.Ie=null,this.xe=null}var n,e,i;return n=t,(e=[{key:"getType",value:function(){return this.Fe}},{key:"getCoordinates",value:function(){return this.Ie}},{key:"getBound",value:function(){return this.xe||this.Ce(),this.xe}}])&&io(n.prototype,e),i&&io(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}(),ro=(Object.assign(n.prototype,{nn:function(){},ke:function(t){t._support(this)==no.PUSH&&t._result.push(this)}}),n);function oo(t){return(oo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function so(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=oo(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=oo(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==oo(t)?t:String(t)}(i.key),i)}}function ao(t,n,e){n=co(n);var i=t,n=uo()?Reflect.construct(n,e||[],co(t).constructor):n.apply(t,e);if(n&&("object"===oo(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return fo(i)}function uo(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(uo=function(){return!!t})()}function co(t){return(co=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function fo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ho(t,n){return(ho=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var n=function(){var t,n=i,e=ro;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(this instanceof i)return(n=ao(this,i)).je=t.eid,n.Fe=ar.POLYGON,Object.assign(fo(n),t),n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&ho(n,e),n=i,(e=[{key:"getCenter",value:function(){return this.Re}}])&&so(n.prototype,e),t&&so(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),lo=(Object.assign(n.prototype,{Ce:function(){var n=this;this.xe=new Ur,this.Ie&&this.Ie.forEach(function(t){n.xe.Se(t)})},ke:function(t){t._support(this)==no.PUSH&&t._result.push(this)}}),n),n={NO_RIGHT_CLICK:2,NORMAL:4},vo=(Object.freeze(n),n);function po(t){return function(t){if(Array.isArray(t))return mo(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){var e;if(t)return"string"==typeof t?mo(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?mo(t,n):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mo(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function yo(t){return(yo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function bo(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=yo(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=yo(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==yo(t)?t:String(t)}(i.key),i)}}var n=function(){function r(t,n,e){var i=this;if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");this.Lt=t,this.Ft=e,this.De=[295829355.45,147914677.73,73957338.86,36978669.43,18489334.72,9244667.36,4622333.68,2311166.84,1155583.42,577791.71,288895.85,144447.93,72223.96,36111.98,18056,9028,4514,2257,1128,564,282,141,70,35,17,8,4,2,1],this.It=[],this.Ue=new Map,this.Be=null,this.Ge=this.Ft.He,this.Xe=null,this.Ut=new Mi(this.Lt.ze,n,this.Lt),this.Ut.enableDamping=this.Lt.Ve.enableDamping,this.Ut.dampingFactor=.08,this.Lt.Ve.mouseMode===vo.NO_RIGHT_CLICK&&this.Ut.setMouseMiddleButtonRotation(),this.We=null,this.Ut.addEventListener("change",function(){i.Jt(),i.Lt.Qe.Ye({type:"viewChanged"}),i.Lt.Dt.Ze=1,null!==i.We&&clearTimeout(i.We),i.We=setTimeout(function(){i.Lt.Dt.Ze=0,i.Lt.enableUpdateRender()},10)}),this.qe=new er(this.Ut,this.Lt.Ke,this.Lt.Je);t=!this.Lt.Ve.lock;this.Ut.enableZoom=t,this.Ut.enablePan=t,this.Ut.enableRotate=t,this.Ut.enableRotateLeft=t,this.Ut.enableRotateUp=t,this.$e=t,this.ti=t,this.ni=t,this.ei=t,this.ii=this.Ut.useRange,this.ri={},this.oi=this.oi.bind(this)}var t,n,e;return t=r,(n=[{key:"enableZoom",get:function(){return this.$e},set:function(t){this.$e=t,this.Ut.enableZoom=t}},{key:"enableDragRange",get:function(){return this.ii},set:function(t){this.ii=t}},{key:"enableDrag",get:function(){return this.ti},set:function(t){this.ti=t,this.Ut.enablePan=t}},{key:"enableRotate",get:function(){return this.ni},set:function(t){this.ni=t,this.Ut.enableRotateLeft=t}},{key:"enableTilt",get:function(){return this.ei},set:function(t){this.ei=t,this.Ut.enableRotateUp=t}},{key:"enableDamping",get:function(){return this.Ut.enableDamping},set:function(t){this.Ut.enableDamping=t}},{key:"controls",get:function(){return this.Ut},set:function(t){this.Ut=t}},{key:"autoCameraNearFar",get:function(){return this.qe}},{key:"mouseMode",get:function(){return this.Lt.Ve.mouseMode}},{key:"zoomSpeed",get:function(){return this.Ut.zoomSpeedParam},set:function(t){this.Ut.zoomSpeedParam=t}},{key:"copyControls",value:function(t){t=new Mi(t,this.Ut.domElement,this.Lt);return t.target=(new xt).copy(this.Ut.target),t.maxDistance=this.Ut.maxDistance,t.minDistance=this.Ut.minDistance,t.minZoom=this.Ut.minZoom,t.maxZoom=this.Ut.maxZoom,t.minPolarAngle=this.Ut.minPolarAngle,t.maxPolarAngle=this.Ut.maxPolarAngle,t.update({theta:this.Ut.getAzimuthalAngle()}),t}},{key:"pauseDamping",value:function(){this.Ut&&this.Ut.pauseDamping()}},{key:"resumeDamping",value:function(){this.Ut&&this.Ut.pauseDamping()}}])&&bo(t.prototype,n),e&&bo(t,e),Object.defineProperty(t,"prototype",{writable:!1}),r}(),go=(Object.assign(n.prototype,{nn:function(){for(var t in clearTimeout(this.We),this.Ut.dispose(),this)this[""+t]=null,delete this[""+t]},si:function(){var t,n=this.ai(this.Ft.zoom),e=this.ui(n),i=this.Ft.Re,r=this.Lt.fi.ci(this.Lt.kt.je,this.Lt.kt.level);r?(i.y=r.nt,this.Ut.target=(new xt).copy(i),this.Ut.object.lookAt(i),this.li(),this.Ft.He===Li.MODE_3D?(r=(f.TILT_UPPER_BOUND-this.Ft.di)*f.DEG2RAD,t=e*Math.cos(r),r=e*Math.sin(r),this.Ut.object.position.set(i.x,i.y+t,i.z+r),this.Ut.minPolarAngle=(f.TILT_UPPER_BOUND-this.Lt.Ve.maxTiltAngle)*f.DEG2RAD,this.Ut.maxPolarAngle=(f.TILT_UPPER_BOUND-this.Lt.Ve.minTiltAngle)*f.DEG2RAD):(t=this.vi(n),this.Ut.minPolarAngle=0,this.Ut.maxPolarAngle=0,this.Ut.object.position.set(i.x,i.y+e,i.z),this.Ut.object.zoom=1/t,this.Ut.object.updateProjectionMatrix()),r=this.pi(this.Ft.mi),this.Ut.update({theta:this.Ut.getAzimuthalAngle()+r})):(this.Lt.yi.error.push(n={type:"info",InfoMode:Ri.DEFAULT_LEVEL_ERROR}),this.Lt.Qe.Ye(n))},bi:function(t){this.Ut.target=t,this.Ut.update()},gi:function(e){var i,t,n,r,o=this;this.Ge===e.mode?e.mode===this.Lt.getViewMode()&&e.finish&&e.finish():(this.Ge=e.mode,i=this.Ut,void 0===(t=e.duration)&&(t=1),this.Xe&&!1===this.Xe.qt&&this.Xe.finish(),e.mode===Li.MODE_2D?(i.minPolarAngle=-90*f.DEG2RAD,this.Ft.di=this.Lt.getTilt(),this.wi({animate:void 0===e.animate||e.animate,duration:t,tilt:90,finish:function(){i.maxPolarAngle=0;var t=o.Lt.Je,n=o._i(),n=o.vi(n);t.quaternion.copy(i.object.quaternion),t.position.copy(i.object.position),t.zoom=1/n,t.updateProjectionMatrix(),i.object=t,i.update(),o.Lt.ze=t,o.Lt.Dt.Ei(),o.Lt.Qe.Ye({type:"viewModeChanged"}),e.finish&&e.finish()}})):e.mode===Li.MODE_3D&&(i.maxPolarAngle=(f.TILT_UPPER_BOUND-this.Lt.Ve.minTiltAngle)*f.DEG2RAD,n=this.Lt.Ke,r=this.Si(),r=this.ui(r),n.quaternion.copy(i.object.quaternion),n.position.copy(i.object.position),n.position.setY(i.target.y+r),n.updateMatrix(),i.object=n,i.update(),this.Lt.ze=n,this.Lt.Dt.Ei(),this.wi({animate:void 0===e.animate||e.animate,duration:t,tilt:this.Ft.di,finish:e.finish}),this.Lt.Qe.Ye({type:"viewModeChanged"})))},Ti:function(t){var n;(n=this.It).push.apply(n,po(t))},Jt:function(){for(var t=0;t<this.It.length;t++)this.It[t].call(this.Lt.Dt)},Pt:function(){try{var t=!1,n=this.Lt.camera,e=this.Lt.getBuilding(this.Ft.jt),i=e.getFloor(e.level),r=i.getLayers(S.EXTENT_LAYER)[0];if(this.Lt.Ve.panRangeValue){for(var o,s,a,u,c=new zt,f=(c.setFromProjectionMatrix((new At).multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse)),null),h=0;h<r.It.length;h++)r.It[h].xi&&(f=r.It[h].xi);return null===f?!1:(o=f.geometry.boundingSphere,(s=new kt).copy(o).applyMatrix4(f.matrixWorld),u=new kt(new xt((a=this.Lt.Ve.panRangeValue).center.x-this.Lt.x,s.center.y,this.Lt.y-a.center.y),a.radius),c.intersectsSphere(u))}for(var l=[],d=this.Lt.Ve.container.clientWidth,v=this.Lt.Ve.container.clientHeight,p=(l.push(Oi.coordsScreenToMap(this.Lt,{x:0,y:0,level:i.level,buildingID:e.je})),l.push(Oi.coordsScreenToMap(this.Lt,{x:d,y:0,level:i.level,buildingID:e.je})),l.push(Oi.coordsScreenToMap(this.Lt,{x:d,y:v,level:i.level,buildingID:e.je})),l.push(Oi.coordsScreenToMap(this.Lt,{x:0,y:v,level:i.level,buildingID:e.je})),new $r("polygon",l)),m=0;m<r.It.length;m++){var y=function(t){for(var n=[],e=0;e<t.length;e++)n.push([t[e].x,t[e].y]);for(var i=Object(to.polygonScale)(n,.9),r=[],o=0;o<i.length;o++)r.push({x:i[o][0],y:i[o][1]});return new lo({eid:"1",Ie:[r]})}(r.It[m].G.Ie[0]);if(p.Oe(y)){t=!0;break}}return t}catch(t){return!0}},oi:function(){var t,n,e,i,r,o,s,a,u,c=this;this.ri.counter<this.ri.num?(n=(t=(new Date).getTime())-this.ri.frameTime,this.ri.counter+n>this.ri.num&&(n=this.ri.num-this.ri.counter),e=this.ri.num-this.ri.counter,a=(this.ri.targetX-this.Ut.target.x)/e,u=(this.ri.targetZ-this.Ut.target.z)/e,i=this.ai(this.ri.state.zoom),o=this.ui(i),s=this.Ut.object.position.distanceTo(this.Ut.target),r=(new xt).copy(this.Ut.object.position).sub(this.Ut.target).normalize(),r=(new xt).copy(r).multiplyScalar(o-s),this.Ut.panAdd({x:a*n,y:0,z:u*n}),o=this.Ut.getAzimuthalAngle(),s=(f.TILT_UPPER_BOUND-(this.ri.tilt+n*this.ri.perTilt))*f.DEG2RAD,this.ri.tilt=this.ri.tilt+n*this.ri.perTilt,"OrthographicCamera"===this.Lt.ze.type&&(a=this.Si(),u=this.vi(a+(i-a)/e*n),this.Lt.ze.zoom=1/u,this.Lt.ze.updateProjectionMatrix(),this.Lt.Ai()),this.Ut.update({offset:new xt(r.x/e*n,r.y/e*n,r.z/e*n)}),this.Ut.update({theta:o+this.ri.disRotation*n}),this.Ut.update({phi:s}),this.Lt.Dt.Ei(),this.ri.counter=this.ri.counter+n,this.ri.frameTime=t):("2d"===this.ri.modeUpdateType&&this.Lt.setViewMode({mode:this.ri.state.viewMode,animate:!1}),this.Lt.setVisibleLevels(this.ri.state.visibleLevels,function(){c.Lt.getLevel()!==c.ri.state.level&&c.Lt.setLevel({level:c.ri.state.level,animate:!1})}),this.Lt.Oi.Mi(this.oi),this.ri.options.finish&&this.ri.options.finish())},Li:function(t,n){this.Lt.Oi.Mi(this.oi),this.ri={},this.ri.options=n,this.ri.targetX=t.center.x-this.Lt.x,this.ri.targetZ=-t.center.y+this.Lt.y,this.ri.num=1e3*n.duration,this.ri.counter=0;var e,i,n=this.pi(t.rotation,!0),n=(this.ri.disRotation=n/this.ri.num,t.tiltAngle=Tt.clamp(t.tiltAngle,this.Lt.Ve.minTiltAngle,this.Lt.Ve.maxTiltAngle),this.ri.state=t,this.Lt.getTilt()),r=(t.tiltAngle-n)/this.ri.num,r=(this.ri.tilt=n,this.ri.perTilt=r,"no");this.Lt.getViewMode()!==t.viewMode&&(t.viewMode===Li.MODE_3D?(r="3d",this.Ut.maxPolarAngle=(f.TILT_UPPER_BOUND-this.Lt.Ve.minTiltAngle)*f.DEG2RAD,e=this.Lt.Ke,i=this.Si(),i=this.ui(i),e.quaternion.copy(this.Ut.object.quaternion),e.position.copy(this.Ut.object.position),e.position.setY(this.Ut.target.y+i),e.updateMatrix(),this.Ut.object=e,this.Ut.update(),this.Lt.ze=e,this.Ge=Li.MODE_3D):(r="2d",this.ri.perTilt=(90-n)/this.ri.num)),this.ri.frameTime=(new Date).getTime(),this.ri.modeUpdateType=r,this.Lt.setFloorSpace(t.floorSpace),this.Lt.Oi.Ri(this.oi)}}),Object.assign(n.prototype,{Ni:function(t){var n=this,t=this.Lt.getZoom()*t,e=new Wi({src:[this.Lt.getZoom()],dest:[t]});t>this.Ft.Pi[1]||t<this.Ft.Pi[0]||(e.sn(.5).un(function(t){return n.Lt.setZoom({animate:!1,zoom:t.destination[0]})}).cn(function(){return n.Lt.Oi.ji(e)}),this.Lt.Oi.Ti(e.tn()))},Fi:function(){var t=this.Lt.ze.isPerspectiveCamera?this._i():this.Si();return this.Ii(t)},Ci:function(n){var e,i,r=this,t=(this.Ft.zoom=n.zoom,Number.isFinite(n.duration)?n.duration:.5),o=this.ai(this.Ft.zoom),s=this.ui(o),a=this.Ut.object.position.distanceTo(this.Ut.target),u=(new xt).copy(this.Ut.object.position).sub(this.Ut.target).normalize(),c=(new xt).copy(u).multiplyScalar(s-a);this.Lt.ze.isPerspectiveCamera?"animate"in n&&!n.animate?(this.Ut.update({offset:c}),n.finish&&n.finish()):((e=new Wi({src:[0,0,0],dest:[c.x,c.y,c.z]})).sn(t).un(function(t){"PerspectiveCamera"===r.Lt.ze.type?r.Ut.update({offset:new xt(t.delta[0],t.delta[1],t.delta[2])}):(r.Lt.Oi.ji(e),r.Ci({zoom:n.zoom,animate:!1,finish:n.finish}))}).cn(function(){r.Lt.Oi.ji(e),n.finish&&n.finish()}),this.Lt.Oi.Ti(e.tn())):"animate"in n&&!n.animate?(u=this.vi(o),this.Lt.ze.zoom=1/u,this.Lt.ze.updateProjectionMatrix(),this.Lt.Dt.Ei(),this.Ut.update({offset:c}),n.finish&&n.finish()):((i=new Wi({src:[this.Si()],dest:[o]})).sn(t).un(function(t){"OrthographicCamera"===r.Lt.ze.type?(t=r.vi(t.destination[0]),r.Lt.ze.zoom=1/t,r.Lt.ze.updateProjectionMatrix(),r.Lt.Dt.Ei(),r.Lt.enableUpdateRender(),r.Lt.Ai()):(r.Lt.Oi.ji(i),r.Ci({zoom:n.zoom,animate:!1,finish:n.finish}))}).cn(function(){r.Ut.update({offset:c}),r.Lt.Oi.ji(i),n.finish&&n.finish()}),this.Lt.Oi.Ti(i.tn()))},ki:function(t){this.Ft.Pi=t,this.li(),this.Ut.update()},li:function(){var t=this.ai(this.Ft.Pi[0]),n=this.ai(this.Ft.Pi[1]);this.Ut.maxDistance=this.ui(t),this.Ut.minDistance=this.ui(n),this.Ut.minZoom=1/this.vi(t),this.Ut.maxZoom=1/this.vi(n)},ai:function(t){var n=this.De.length-1,e=(--t,t=Math.max(0,Math.min(t,n)),Math.floor(t)),t=t-e,i=Math.max(0,Math.min(e,n)),n=Math.max(0,Math.min(e+1,n)),i=this.De[i]-this.De[n];return this.De[e]-i*t},Ii:function(t){for(var n=0,e=.1,i=!1,r=0;r<this.De.length-1;r++)if(t<=this.De[r]&&t>this.De[r+1]){n=r,e=(this.De[r]-t)/(this.De[r]-this.De[r+1]),i=!0;break}var o;return i?parseFloat((n+1+e).toFixed(2)):(o=this.De.length-1,t<=this.De[o]?1+o:1)},ui:function(t){return t/100*(this.Lt.Dt.renderer.domElement.clientHeight/Fi.getMapScaleInfo())/2/Math.tan(f.FOV/2*f.DEG2RAD)},_i:function(){return(new xt).copy(this.Ut.object.position).sub(this.Ut.target).length()*(100*Math.tan(f.FOV/2*f.DEG2RAD)*2/(this.Lt.Dt.renderer.domElement.clientHeight/Fi.getMapScaleInfo()))},Si:function(){var t=this.Lt.ze.top,n=this.Lt.ze.bottom;return Math.abs(t-n)*Fi.getMapScaleInfo()*100/this.Lt.Dt.renderer.domElement.clientHeight/this.Lt.ze.zoom},vi:function(t){var n=this.Lt.Je.top,e=this.Lt.Je.bottom;return t/(Math.abs(n-e)*Fi.getMapScaleInfo()*100/this.Lt.Dt.renderer.domElement.clientHeight)}}),Object.assign(n.prototype,{wi:function(t){var n,e=this,i=this.Ut,r=t.finish;"animate"in t&&!t.animate?(i.update({phi:(f.TILT_UPPER_BOUND-t.tilt)*f.DEG2RAD}),i.update(),r&&r()):(null===this.Xe&&(this.Xe=new Wi),n=Number.isFinite(t.duration)?t.duration:.5,this.Xe.en([this.Lt.getTilt()]).rn([t.tilt]).sn(n).un(function(t){i.update({phi:(f.TILT_UPPER_BOUND-t.destination[0])*f.DEG2RAD})}).cn(function(){i.update({phi:(f.TILT_UPPER_BOUND-t.tilt)*f.DEG2RAD}),i.update(),e.Lt.Oi.ji(e.Xe),r&&r()}),this.Lt.Oi.Ti(this.Xe.tn()))},Di:function(){var t=Xi.round(-this.Ut.getAzimuthalAngle()*f.RAD2DEG);return 360<(t=t<0?360+t:t)&&(t%=360),t},pi:function(t,n){var e=-t%360*f.DEG2RAD,t=(e=!1===n?-t*f.DEG2RAD:e)-this.Ut.getAzimuthalAngle();return t=0!==t&&n?Math.sin(t)/Math.abs(Math.sin(t))*Math.acos(Math.cos(t)):t},Ui:function(t){var n,e=this,i=void 0!==t.loop&&t.loop,r=void 0!==t.direction?t.direction:0,o=void 0===t.minimumAngleTransformation||t.minimumAngleTransformation,s=this.Ut.getAzimuthalAngle();if(r=i?0===r?s-2*Math.PI:2*Math.PI+s:s+this.pi(t.rotation,o),!("animate"in t)||t.animate)return o=t&&t.duration&&Number.isFinite(t.duration)?t.duration:.5,(n=new Wi({src:[s],dest:[r]})).sn(o).hn(i).un(function(t){e.Ut.update({theta:t.destination[0]})}).cn(function(){i||e.Lt.Oi.ji(n),t.finish&&t.finish()}),this.Lt.Oi.Ti(n.tn()),n;this.Ut.update({theta:r}),t.finish&&t.finish()}}),Object.assign(n.prototype,{Bi:function(){var t=this.Ut.target,n=this.Lt.It[0];return{x:parseFloat((n.x+t.x).toFixed(4)),y:parseFloat((n.y-t.z).toFixed(4))}},Gi:function(t){var n,e,i,r=this,o=this.Ut,s=this.Lt.It[0],a=t.x-s.x,s=-t.y+s.y,u=o.target.x,c=o.target.z,f=t.height;!!f&&Number.isFinite(f)?(e=o.target.y,n=f):e=n=0,"animate"in t&&t.animate?(f=Number.isFinite(t.duration)?t.duration:.5,(i=new Wi({src:[u,e,c],dest:[a,n,s]})).sn(f).un(function(t){o.panAdd({x:t.delta[0],y:t.delta[1],z:t.delta[2]}),o.update(),r.Lt.Dt.Ei()}).cn(function(){r.Lt.Oi.ji(i),r.Lt.Dt.Ei(),t.finish&&t.finish()}),this.Lt.Oi.Ti(i.tn())):(o.panAdd({x:a-u,y:n-e,z:s-c}),o.update(),t.finish&&t.finish(),this.Lt.Dt.Ei())},Hi:function(n,e){function t(){i.Ft.Xi(n.je).level=e.level,i.Lt.Dt.zi(),i.Lt.fi.Vi();var t={type:"levelChanged",level:e.level};n!==i.Lt.kt&&(t.buildingID=n.je),i.Lt.Qe.Ye(t),i.enableDragRange&&r.saveState(),i.Lt.Dt.Ei(),e.finish&&e.finish(e.level)}var i=this,r=this.Ut;n===this.Lt.kt||this.Lt.Wi?this.Yi(n,{level:e.level,animate:e.animate,duration:e.duration,callback:e.callback,finish:function(){t()}}):t()},Yi:function(t,n){var e=void 0!==n.duration?n.duration:.5,i=void 0===n.animate||n.animate,r=this.Ut,o=r.target.y,s=t.getFloor(n.level).nt;i?(null===this.Be&&(this.Be=new Wi),this.Be.en([o]).rn([s]).sn(e).un(function(t){r.panUp(t.delta[0]),r.update()}).cn(function(){r.panUp(s-r.target.y),r.update(),n.finish&&n.finish()}),this.Lt.Oi.Ti(this.Be.tn()),n.callback&&n.callback(this.Be)):(r.panUp(s-o),r.update(),n.callback&&n.callback(null),n.finish&&n.finish())}}),n),wo=new xt,_o=new xt,Eo=new xt,So=new xt,To=new xt,xo=new xt,Ao=new xt;function Mo(t,n){this.origin=void 0!==t?t:new xt,this.direction=void 0!==n?n:new xt(0,0,-1)}function Oo(t,n,e,i){this.ray=new Mo(t,n),this.near=e||0,this.far=i||1/0,this.camera=null,this.layers=new Q,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Lo(t,n){return t.distance-n.distance}function Ro(t,n,e,i){if(t.layers.test(n.layers)&&t.raycast(n,e),!0===i)for(var r=t.children,o=0,s=r.length;o<s;o++)Ro(r[o],n,e,!0)}Object.assign(Mo.prototype,{set:function(t,n){return this.origin.copy(t),this.direction.copy(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,n){return void 0===n&&(console.warn("THREE.Ray: .at() target is now required"),n=new xt),n.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,wo)),this},closestPointToPoint:function(t,n){void 0===n&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),n=new xt),n.subVectors(t,this.origin);t=n.dot(this.direction);return t<0?n.copy(this.origin):n.copy(this.direction).multiplyScalar(t).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){var n=wo.subVectors(t,this.origin).dot(this.direction);return(n<0?this.origin:(wo.copy(this.direction).multiplyScalar(n).add(this.origin),wo)).distanceToSquared(t)},distanceSqToSegment:function(t,n,e,i){_o.copy(t).add(n).multiplyScalar(.5),Eo.copy(n).sub(t).normalize(),So.copy(this.origin).sub(_o);var r,o,s,t=.5*t.distanceTo(n),n=-this.direction.dot(Eo),a=So.dot(this.direction),u=-So.dot(Eo),c=So.lengthSq(),f=Math.abs(1-n*n);return f=0<f?(o=n*a-u,s=t*f,0<=(r=n*u-a)?-s<=o?o<=s?(r*=f=1/f)*(r+n*(o*=f)+2*a)+o*(n*r+o+2*u)+c:(o=t,-(r=Math.max(0,-(n*o+a)))*r+o*(o+2*u)+c):(o=-t,-(r=Math.max(0,-(n*o+a)))*r+o*(o+2*u)+c):o<=-s?-(r=Math.max(0,-(-n*t+a)))*r+(o=0<r?-t:Math.min(Math.max(-t,-u),t))*(o+2*u)+c:o<=s?(r=0,(o=Math.min(Math.max(-t,-u),t))*(o+2*u)+c):-(r=Math.max(0,-(n*t+a)))*r+(o=0<r?t:Math.min(Math.max(-t,-u),t))*(o+2*u)+c):(o=0<n?-t:t,-(r=Math.max(0,-(n*o+a)))*r+o*(o+2*u)+c),e&&e.copy(this.direction).multiplyScalar(r).add(this.origin),i&&i.copy(Eo).multiplyScalar(o).add(_o),f},intersectSphere:function(t,n){wo.subVectors(t.center,this.origin);var e=wo.dot(this.direction),i=wo.dot(wo)-e*e,t=t.radius*t.radius;return t<i||(i=e+(t=Math.sqrt(t-i)),(e=e-t)<0&&i<0)?null:e<0?this.at(i,n):this.at(e,n)},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var n=t.normal.dot(this.direction);return 0===n?0===t.distanceToPoint(this.origin)?0:null:0<=(t=-(this.origin.dot(t.normal)+t.constant)/n)?t:null},intersectPlane:function(t,n){t=this.distanceToPlane(t);return null===t?null:this.at(t,n)},intersectsPlane:function(t){var n=t.distanceToPoint(this.origin);return 0===n||t.normal.dot(this.direction)*n<0},intersectBox:function(t,n){var e,i,r,o=1/this.direction.x,s=1/this.direction.y,a=1/this.direction.z,u=this.origin,o=0<=o?(e=(t.min.x-u.x)*o,(t.max.x-u.x)*o):(e=(t.max.x-u.x)*o,(t.min.x-u.x)*o),s=0<=s?(r=(t.min.y-u.y)*s,(t.max.y-u.y)*s):(r=(t.max.y-u.y)*s,(t.min.y-u.y)*s);return s<e||o<r||((e<r||e!=e)&&(e=r),(s<o||o!=o)&&(o=s),(r=0<=a?(i=(t.min.z-u.z)*a,(t.max.z-u.z)*a):(i=(t.max.z-u.z)*a,(t.min.z-u.z)*a))<e)||o<i||((e<i||e!=e)&&(e=i),(o=r<o||o!=o?r:o)<0)?null:this.at(0<=e?e:o,n)},intersectsBox:function(t){return null!==this.intersectBox(t,wo)},intersectTriangle:function(t,n,e,i,r){To.subVectors(n,t),xo.subVectors(e,t),Ao.crossVectors(To,xo);var o,n=this.direction.dot(Ao);if(0<n){if(i)return null;o=1}else{if(!(n<0))return null;o=-1,n=-n}So.subVectors(this.origin,t);e=o*this.direction.dot(xo.crossVectors(So,xo));return e<0||(i=o*this.direction.dot(To.cross(So)))<0||n<e+i||(t=-o*So.dot(Ao))<0?null:this.at(t/n,r)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}),Object.assign(Oo.prototype,{set:function(t,n){this.ray.set(t,n)},setFromCamera:function(t,n){n&&n.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(n).sub(this.ray.origin).normalize(),this.camera=n):n&&n.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(n.near+n.far)/(n.near-n.far)).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld),this.camera=n):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,n,e){e=e||[];return Ro(t,this,e,n),e.sort(Lo),e},intersectObjects:function(t,n,e){var i=e||[];if(!1===Array.isArray(t))console.warn("THREE.Raycaster.intersectObjects: objects is not an Array.");else{for(var r=0,o=t.length;r<o;r++)Ro(t[r],this,i,n);i.sort(Lo)}return i}});var n={CLASSIC:2,REAL:4},No=(Object.freeze(n),n);function Po(t){return(Po="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function jo(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Po(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Po(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Po(t)?t:String(t)}(i.key),i)}}var n=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.je=-1,this.Fe=S.NONE,this.Qi=!0,this.Ht=null,this.It=[],this.xe=new Ur,this.Zi=!0}var n,e,i;return n=t,(e=[{key:"type",get:function(){return this.Fe}},{key:"visible",get:function(){return this.Qi},set:function(t){this.Qi=t}},{key:"children",get:function(){return this.It}},{key:"parent",get:function(){return this.Ht},set:function(t){this.Ht=t}},{key:"needUpdateBound",get:function(){return this.Zi},set:function(t){!0===(this.Zi=t)&&null!==this.parent&&(this.parent.needUpdateBound=t)}},{key:"isLayer",get:function(){return!1}},{key:"setType",value:function(t){this.Fe=t}},{key:"traverse",value:function(t){if(this.It)for(var n=this.It.length-1;0<=n;n--)t(this.It[n])}},{key:"remove",value:function(t){var n=this.It.indexOf(t);-1<n&&this.It.splice(n,1),t.parent=null,this.needUpdateBound=!0}},{key:"dispose",value:function(){var t,n=this;for(t in this.traverse(function(t){n.remove(t),t.dispose()}),this.parent&&this.parent.remove(this),this)this[""+t]&&this[""+t].nn&&this[""+t].nn(),this[""+t]&&this[""+t].dispose&&this[""+t].dispose(),this[""+t]=null,delete this[""+t]}}])&&jo(n.prototype,e),i&&jo(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}(),Fo=(Object.assign(n.prototype,{qi:function(t){for(var n=this;n;){if(n instanceof t)return n;n=n.Ht}return null}}),n);function Io(t){return(Io="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Co(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Io(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Io(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Io(t)?t:String(t)}(i.key),i)}}function ko(t,n,e){n=Uo(n);var i=t,n=Do()?Reflect.construct(n,e||[],Uo(t).constructor):n.apply(t,e);if(n&&("object"===Io(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function Do(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Do=function(){return!!t})()}function Uo(t){return(Uo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Bo(t,n){return(Bo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var n=function(){var t,n=i,e=Fo;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(this instanceof i)return(n=ko(this,i)).je=t.bid,n.Ki=t.bcode,n.Ji=t.mid,n.$i=t.name,n.tr=t.ename,n.nr=t.alias,n._t=t.x,n.Et=t.y,n.er=t.levels,n.ir=[],n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Bo(n,e),n=i,(e=[{key:"type",get:function(){return this.Fe}},{key:"x",get:function(){return this._t}},{key:"y",get:function(){return this.Et}},{key:"bound",get:function(){var n=this;return!0===this.needUpdateBound&&(this.xe.reset(),void 0!==this.rr&&this.xe.copy(this.rr),this.It.forEach(function(t){n.xe.expand(t.bound)}),this.needUpdateBound=!1),this.xe.clone()}},{key:"buildingID",get:function(){return this.je}},{key:"bcode",get:function(){return this.Ki}},{key:"name",get:function(){return this.$i}},{key:"eName",get:function(){return this.tr}},{key:"alias",get:function(){return this.nr}},{key:"floorSpace",get:function(){return this.Ht.Ft.Xi(this.je).floorSpace},set:function(t){this.Ht.Ft.Xi(this.je).floorSpace=t,this.traverse(function(t){t.sr({animate:!1})})}},{key:"level",get:function(){return this.Ht.Ft.Xi(this.je).level}},{key:"visibleLevels",get:function(){return this.Ht.Ft.Xi(this.je).visibleLevels}},{key:"getFloor",value:function(n){var e=null;return this.traverse(function(t){t.ar===n&&(e=t)}),e}},{key:"getFloorInfos",value:function(){return this.ur()}},{key:"setLevel",value:function(t){this.Ht.fi.cr(this,t)}},{key:"setVisibleLevels",value:function(t,n){this.Ht.fi.hr({levels:t,building:this},n)}},{key:"getVisibleLevels",value:function(){return this.visibleLevels}}])&&Co(n.prototype,e),t&&Co(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),Go=(Object.assign(n.prototype,{ur:function(){for(var t,n=this,e=(0===this.ir.length&&(t=this.Ht.dr.lr.get(this.Ji))&&(this.ir=[],t.It.forEach(function(t){n.ir.push(t)})),{alias:"alias",floorId:"floorID",gid:"level",gname:"name"}),i=Object.keys(e),r=[],o=0;o<this.ir.length;o++){var s=this.ir[o];r[o]={};for(var a=0;a<i.length;a++){var u=i[a],c=e[u];s[u]?r[o][c]=s[u]:r[o][c]=null}}return r}}),n);function Ho(t){return(Ho="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xo(t){return function(t){if(Array.isArray(t))return zo(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){var e;if(t)return"string"==typeof t?zo(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?zo(t,n):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zo(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function Vo(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Ho(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Ho(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Ho(t)?t:String(t)}(i.key),i)}}function Wo(t,n,e){return n&&Vo(t.prototype,n),e&&Vo(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var n=Wo(function t(n,e,i){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.Lt=n,this.Ft=i,this.Ve=e,this.vr=[],this.pr=null,this.mr=Xi.generateUUID(),this.yr=new Oo,this.br=new xt,this.gr=0,this.wr=0,this.Jt=this.Jt.bind(this),this.zt=0,this.Lt.Dt.renderer.domElement.addEventListener("mousedown",this.Jt,!1),this.Lt.Dt.renderer.domElement.addEventListener("mouseup",this.Jt,!1),this.Lt.Dt.renderer.domElement.addEventListener("mousemove",this.Jt,!1),this.Lt.Dt.renderer.domElement.addEventListener("touchstart",this.Jt,!1),this.Lt.Dt.renderer.domElement.addEventListener("touchend",this.Jt,!1),this.Lt.Dt.renderer.domElement.addEventListener("touchmove",this.Jt,!1)}),Yo=(Object.assign(n.prototype,{nn:function(){for(var t in this.Lt.Dt.renderer.domElement.removeEventListener("mousedown",this.Jt,!1),this.Lt.Dt.renderer.domElement.removeEventListener("mouseup",this.Jt,!1),this.Lt.Dt.renderer.domElement.removeEventListener("touchstart",this.Jt,!1),this.Lt.Dt.renderer.domElement.removeEventListener("mousemove",this.Jt,!1),this.Lt.Dt.renderer.domElement.removeEventListener("touchmove",this.Jt,!1),this.Lt.Dt.renderer.domElement.removeEventListener("touchend",this.Jt,!1),delete this.Lt,delete this.Ft,delete this.Ve,this)this[""+t]&&this[""+t].nn&&this[""+t].nn(),this[""+t]=null,delete this[""+t]},Ti:function(t){var n;(n=this.vr).push.apply(n,Xo(t))},Jt:function(t){if((st.a.environment!==G.a.WX||"touchmove"!==t.type)&&(!this.Ft||"mousemove"!==t.type||this.Ft._r))if("mousedown"===t.type||"touchstart"===t.type)this.zt=(new Date).getTime(),"touchstart"===t.type&&(this.gr=t.changedTouches[0].clientX,this.wr=t.changedTouches[0].clientY);else{if("mouseup"===t.type||"touchend"===t.type){if(200<(new Date).getTime()-this.zt)return;if("touchend"===t.type&&Math.pow(t.changedTouches[0].clientX-this.gr,2)+Math.pow(t.changedTouches[0].clientY-this.wr,2)>Math.pow(t.changedTouches[0].radiusX,2))return;this.zt=(new Date).getTime()}for(var n=this.Er(t),e=0;e<this.vr.length;e++)this.vr[e](n);var i=this.Sr(n),r=null,o=null,s=(i[0]&&i[0].type!==S.FM3DTILE_LAYER&&(s=i[0].qi(Go))&&(r=i[0].level,s!==this.Lt.kt)&&(o=s.je),this.Tr(n));if(null!==r)s.height=null!==o?s.height-this.Lt.getBuilding(o).getFloor(r).height:s.height-this.Lt.getFloor(r).height;else{var a=this.Lt.getLevel();if(void 0===a)return;s.height=s.height-this.Lt.getFloor(a).height}a="mousemove"===t.type||"touchmove"===t.type?"hover":"click",s={type:a,targets:i,coords:s,mouseEvent:t,level:r,buildingID:o};-1<this.Ve.Ar.indexOf(a)&&this.Mr(i),this.Lt.Qe.Ye(s)}},Mr:function(a){for(var t,u=this,c=[S.MODEL,S.EXTERNAL_MODEL],n=0;n<a.length&&0!==(t=function(s){if(-1<c.indexOf(a[s].Fe)){if(a[s]===u.pr)return{v:void 0};if(a[s].xi){u.Ue&&(u.Ue.stop(),u.Lt.Oi.ji(u.Ue)),f(u.pr),u.pr=a[s],u.pr.Or=u.Ft.highlightColor;var n=a[s].xi;if(a[s].Fe===S.MODEL){n.userData.sourceMaterial=n.material,n.material=n.material.clone();var t=n.material.color,e=new lt(u.Ft.highlightColor);u.Ue?(u.Ue.en([t.r,t.g,t.b]),u.Ue.rn([e.r,e.g,e.b])):u.Ue=new Wi({src:[t.r,t.g,t.b],dest:[e.r,e.g,e.b]}),u.Ue.sn(.5).un(function(t){t=new lt(t.destination[0],t.destination[1],t.destination[2]);n&&n.material&&(n.material.color=t),u.Lt.enableUpdateRender()}).cn(function(){u.Ue.stop(),u.Lt.Oi.ji(u.Ue),n&&n.material&&(n.material.color=e),u.Lt.enableUpdateRender()}),u.Lt.Oi.Ti(u.Ue.tn())}else if(a[s].Fe===S.EXTERNAL_MODEL)if("Mesh"===n.type)if(n.userData.sourceMaterial||(n.userData.sourceMaterial=n.material),Array.isArray(n.material)){for(var i=[],r=!0,o=0;o<n.material.length;o++)"MeshLambertMaterial"!==n.material[o].type?r=!1:(i[o]=n.material[o].clone(),i[o].color=new lt(u.Ft.highlightColor));r&&(n.material=i)}else"MeshLambertMaterial"===n.material.type&&(n.material=n.material.clone(),n.material.color=new lt(u.Ft.highlightColor));else"Scene"===n.type&&n.traverse(function(t){if("Mesh"===t.type)if(t.userData.sourceMaterial||(t.userData.sourceMaterial=t.material),Array.isArray(t.material)){for(var n,e=[],i=0;i<t.material.length;i++)t.material.isBasic?e.push(t.material):(n=u.Lr(t.material[i]),e.push(n));t.material=e}else{var r,o;t.material.isBasic||(r=u.Lr(t.material),a[s].Rr&&u.Lt.getMapOptions().materialMode!==No.CLASSIC?((o=a[s].Nr(r)).uniforms.diffuse.value=r.uniforms.diffuse.value,o.uniforms.isMask.value=!0,o.uniforms.maskType.value=a[s].Pr,o.uniforms.maskTexture.value=a[s].jr,void 0!==a[s].Fr&&void 0!==a[s].Ir&&(o.uniforms.maskHeight.value=a[s].Fr,o.uniforms.maskExtrudeHeight.value=a[s].Ir),o.uniforms.boundCenter.value=a[s].Cr,o.uniforms.boundSize.value=a[s].kr,o.uniformsNeedUpdate=!0,o.userData=r.userData,t.material=o):t.material=r)}});return u.Lt.enableUpdateRender(),{v:void 0}}return 0}}(n));n++)if(t)return t.v;function f(t){var n,e;t&&(t.Or=null,n=t.xi)&&(t.Fe===S.MODEL?n.userData.sourceMaterial&&!1!==n.userData.sourceMaterial.canDispose&&(e=n.material,n.material=n.userData.sourceMaterial,e.dispose(),delete n.userData.sourceMaterial):t.Fe===S.EXTERNAL_MODEL&&("Mesh"===n.type?(n.material=n.userData.sourceMaterial,delete n.userData.sourceMaterial):"Scene"===n.type&&n.parent&&n.traverse(function(t){"Mesh"===t.type&&t.userData.sourceMaterial&&(t.material=t.userData.sourceMaterial,delete t.userData.sourceMaterial)})))}this.Ue&&(this.Ue.stop(),this.Lt.Oi.ji(this.Ue)),f(this.pr),this.pr=null,this.Lt.enableUpdateRender()},Lr:function(t){var n=this.Dr(t);return n.color=this.Ft.highlightColor,(n=this.Lt.getMapOptions().materialMode===No.REAL?this.Lt.fi.Br.Ur(n):this.Lt.fi.Br.Gr(t,n)).userData=t.userData,n},Dr:function(t){var n={};return(n=this.Lt.Ve.materialMode!==No.REAL||t.isBasic?n:{alphaTest:t.alphaTest,USE_EMISSIVEMAP:t.defines.USE_EMISSIVEMAP,USE_MAP:t.defines.USE_MAP,USE_AOMAP:t.defines.USE_AOMAP,USE_METALNESSMAP:t.defines.USE_METALNESSMAP,USE_NORMALMAP:t.defines.USE_NORMALMAP,TANGENTSPACE_NORMALMAP:t.defines.TANGENTSPACE_NORMALMAP,USE_ROUGHNESSMAP:t.defines.USE_ROUGHNESSMAP,aoMap:t.uniforms.aoMap.value,map:t.uniforms.map.value,color:t.uniforms.diffuse.value.getHex(),emissive:t.uniforms.emissive.value.getHex(),emissiveMap:t.uniforms.emissiveMap.value,metalness:t.uniforms.metalness.value,metalnessMap:t.uniforms.metalnessMap.value,roughness:t.uniforms.roughness.value,roughnessMap:t.uniforms.roughnessMap.value,normalScale:t.uniforms.normalScale.value,normalMap:t.uniforms.normalMap.value,vertexColors:t.vertexColors,side:t.side}).opacity=t.opacity,n.transparent=t.transparent,n},Sr:function(t){for(var n=[],e=0;e<t.length;e++)if(void 0!==t[e].type&&t[e].type===S.FM3DTILE_LAYER)n.push({type:S.FM3DTILE_LAYER,object:t[e].object});else{var i=t[e].object;if("LineSegments"!==i.type&&!(i.isNoPickup||i.parent&&i.parent.mapNode&&i.parent.mapNode.Hr&&i===i.parent.mapNode.Hr.top)){for(;!i.mapNode;)i=i.parent;for(var r=!0,o=0;o<n.length;o++)if(n[o].xi&&n[o].xi.uuid===i.uuid){r=!1;break}this.Lt.pickFilterFunction({type:i.mapNode.Fe,data:i.mapNode.G})&&r&&i.visible&&n.push(i.mapNode)}}return n},Tr:function(t){for(var n,e=null,i=0;i<t.length;i++)if("LineSegments"!==t[i].object.type){e=t[i];break}return t.length<1||!e?{x:NaN,y:NaN,z:NaN,height:NaN}:(n=e.point.clone(),{x:this.Lt.x+n.x,y:this.Lt.y-n.z,z:e.point.y,height:e.point.y})},Er:function(t){var n,e,i,o=this,r=[],s=(t.touches?(e=t.touches[0],"touchend"===t.type&&(e=t.changedTouches[0]),n=this.Lt.Dt.renderer.domElement.getBoundingClientRect(),i=e.clientX-n.left,e=e.clientY-n.top,this.br.x=i/n.width*2-1,this.br.y=2*-(e/n.height)+1):(this.br.x=(i=t).offsetX/this.Lt.Dt.renderer.domElement.clientWidth*2-1,this.br.y=2*-(i.offsetY/this.Lt.Dt.renderer.domElement.clientHeight)+1),this.br.z=.5,this.yr.setFromCamera(this.br,this.Lt.ze),new Map),a=[];if(this.Lt.Dt.Xr.forEach(function(t,n){for(var n=n.split("%A%B%C%D")[0],e=s.get(n),i=(e||(s.set(n,e=[]),a.unshift(n)),o.yr.intersectObject(t,!0)),r=0;r<i.length;r++)i[r].object.visible&&!i[r].object.isNoPick&&e.push(i[r])}),0<this.Lt.Dt.zr.length)for(var u=s.get("other1"),c=(u||(s.set("other1",u=[]),a.push("other1")),this.Lt.Dt.zr),f=0;f<c.length;f++)if(c[f].visible)for(var h=this.yr.intersectObject(c[f],!0),l=0;l<h.length;l++)h[f].type=S.FM3DTILE_LAYER,u.push(h[f]);if(this.Lt.Dt.Vr)for(var d=s.get("other2"),v=(d||(s.set("other2",d=[]),a.push("other2")),this.yr.intersectObject(this.Lt.Dt.Vr,!0)),p=0;p<v.length;p++)v[p].object.visible&&(v[p].object.isNoPickup=!0,d.push(v[p]));for(var m=0;m<a.length;m++){var y=s.get(a[m]);y.sort(function(t,n){return t.distance-n.distance});for(var b=0;b<y.length;b++)r.push(y[b])}return r}}),n),Qo=0;function l(t,n,e,i,r,o,s,a,u,c){Object.defineProperty(this,"id",{value:Qo++}),this.uuid=Tt.generateUUID(),this.name="",this.image=void 0!==t?t:l.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==n?n:l.DEFAULT_MAPPING,this.wrapS=void 0!==e?e:Xn,this.wrapT=void 0!==i?i:Xn,this.magFilter=void 0!==r?r:B,this.minFilter=void 0!==o?o:Zn,this.anisotropy=void 0!==u?u:1,this.format=void 0!==s?s:he,this.internalFormat=null,this.type=void 0!==a?a:Kn,this.offset=new Mt(0,0),this.repeat=new Mt(1,1),this.center=new Mt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Z,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:li,this.version=0,this.onUpdate=null}function Zo(t,n,e,i,r,o,s,a,u,c,f,h){l.call(this,null,o,s,a,u,c,i,r,f,h),this.image={data:t||null,width:n||1,height:e||1},this.magFilter=void 0!==u?u:Vn,this.minFilter=void 0!==c?c:Vn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}l.DEFAULT_IMAGE=void 0,l.DEFAULT_MAPPING=300,l.prototype=Object.assign(Object.create(D.prototype),{constructor:l,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300===this.mapping){if(t.applyMatrix3(this.matrix),t.x<0||1<t.x)switch(this.wrapS){case Hn:t.x=t.x-Math.floor(t.x);break;case Xn:t.x=t.x<0?0:1;break;case zn:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||1<t.y)switch(this.wrapT){case Hn:t.y=t.y-Math.floor(t.y);break;case Xn:t.y=t.y<0?0:1;break;case zn:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}return t}}),Object.defineProperty(l.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),((Zo.prototype=Object.create(l.prototype)).constructor=Zo).prototype.isDataTexture=!0;var Lt={common:{diffuse:{value:new lt(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Z},uv2Transform:{value:new Z},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Mt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new lt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new lt(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Z}},sprite:{diffuse:{value:new lt(15658734)},opacity:{value:1},center:{value:new Mt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Z}}};function qo(){a.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Ko(){var e=null,i=!1,r=null;function o(t,n){!1!==i&&(r(t,n),e.requestAnimationFrame(o))}return{start:function(){!0!==i&&null!==r&&(e.requestAnimationFrame(o),i=!0)},stop:function(){i=!1},setAnimationLoop:function(t){r=t},setContext:function(t){e=t}}}function Jo(u,t){var c=t.isWebGL2,f=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),f.get(t)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=f.get(t);n&&(u.deleteBuffer(n.buffer),f.delete(t))},update:function(t,n){t.isInterleavedBufferAttribute&&(t=t.data);var e,i,r,o,s,a=f.get(t);void 0===a?f.set(t,(i=n,r=(e=t).array,o=e.usage,s=u.createBuffer(),u.bindBuffer(i,s),u.bufferData(i,r,o),e.onUploadCallback(),i=u.FLOAT,r instanceof Float32Array?i=u.FLOAT:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?i=u.UNSIGNED_SHORT:r instanceof Int16Array?i=u.SHORT:r instanceof Uint32Array?i=u.UNSIGNED_INT:r instanceof Int32Array?i=u.INT:r instanceof Int8Array?i=u.BYTE:r instanceof Uint8Array&&(i=u.UNSIGNED_BYTE),{buffer:s,type:i,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version})):a.version<t.version&&(o=a.buffer,s=n,r=(i=t).array,i=i.updateRange,u.bindBuffer(s,o),-1===i.count?u.bufferSubData(s,0,r):(c?u.bufferSubData(s,i.offset*r.BYTES_PER_ELEMENT,r,i.offset,i.count):u.bufferSubData(s,i.offset*r.BYTES_PER_ELEMENT,r.subarray(i.offset,i.offset+i.count)),i.count=-1),a.version=t.version)}}}function $o(t,n,e,i,r,o){this.a=t,this.b=n,this.c=e,this.normal=i&&i.isVector3?i:new xt,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new lt,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==o?o:0}qo.prototype=Object.assign(Object.create(a.prototype),{constructor:qo,isScene:!0,copy:function(t,n){return a.prototype.copy.call(this,t,n),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.assign($o.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var n=0,e=t.vertexNormals.length;n<e;n++)this.vertexNormals[n]=t.vertexNormals[n].clone();for(n=0,e=t.vertexColors.length;n<e;n++)this.vertexColors[n]=t.vertexColors[n].clone();return this}});var ts=0,ns=new At,es=new a,is=new xt;function rs(){Object.defineProperty(this,"id",{value:ts+=2}),this.uuid=Tt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}rs.prototype=Object.assign(Object.create(D.prototype),{constructor:rs,isGeometry:!0,applyMatrix4:function(t){for(var n=(new Z).getNormalMatrix(t),e=0,i=this.vertices.length;e<i;e++)this.vertices[e].applyMatrix4(t);for(e=0,i=this.faces.length;e<i;e++){var r=this.faces[e];r.normal.applyMatrix3(n).normalize();for(var o=0,s=r.vertexNormals.length;o<s;o++)r.vertexNormals[o].applyMatrix3(n).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return ns.makeRotationX(t),this.applyMatrix4(ns),this},rotateY:function(t){return ns.makeRotationY(t),this.applyMatrix4(ns),this},rotateZ:function(t){return ns.makeRotationZ(t),this.applyMatrix4(ns),this},translate:function(t,n,e){return ns.makeTranslation(t,n,e),this.applyMatrix4(ns),this},scale:function(t,n,e){return ns.makeScale(t,n,e),this.applyMatrix4(ns),this},lookAt:function(t){return es.lookAt(t),es.updateMatrix(),this.applyMatrix4(es.matrix),this},fromBufferGeometry:function(t){var o=this,n=null!==t.index?t.index.array:void 0,e=t.attributes;if(void 0===e.position)console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion.");else{var i=e.position.array,s=void 0!==e.normal?e.normal.array:void 0,a=void 0!==e.color?e.color.array:void 0,u=void 0!==e.uv?e.uv.array:void 0,c=void 0!==e.uv2?e.uv2.array:void 0;void 0!==c&&(this.faceVertexUvs[1]=[]);for(var r=0;r<i.length;r+=3)o.vertices.push((new xt).fromArray(i,r)),void 0!==a&&o.colors.push((new lt).fromArray(a,r));var f=t.groups;if(0<f.length)for(r=0;r<f.length;r++)for(var h=f[r],l=h.start,d=l,v=l+h.count;d<v;d+=3)void 0!==n?p(n[d],n[d+1],n[d+2],h.materialIndex):p(d,d+1,d+2,h.materialIndex);else if(void 0!==n)for(r=0;r<n.length;r+=3)p(n[r],n[r+1],n[r+2]);else for(r=0;r<i.length/3;r+=3)p(r,r+1,r+2);this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone())}return this;function p(t,n,e,i){var r=void 0===a?[]:[o.colors[t].clone(),o.colors[n].clone(),o.colors[e].clone()],r=new $o(t,n,e,void 0===s?[]:[(new xt).fromArray(s,3*t),(new xt).fromArray(s,3*n),(new xt).fromArray(s,3*e)],r,i);o.faces.push(r),void 0!==u&&o.faceVertexUvs[0].push([(new Mt).fromArray(u,2*t),(new Mt).fromArray(u,2*n),(new Mt).fromArray(u,2*e)]),void 0!==c&&o.faceVertexUvs[1].push([(new Mt).fromArray(c,2*t),(new Mt).fromArray(c,2*n),(new Mt).fromArray(c,2*e)])}},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(is).negate(),this.translate(is.x,is.y,is.z),this},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,n=this.boundingSphere.radius,n=0===n?1:1/n,e=new At;return e.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applyMatrix4(e),this},computeFaceNormals:function(){for(var t=new xt,n=new xt,e=0,i=this.faces.length;e<i;e++){var r=this.faces[e],o=this.vertices[r.a],s=this.vertices[r.b],a=this.vertices[r.c];t.subVectors(a,s),n.subVectors(o,s),t.cross(n),t.normalize(),r.normal.copy(t)}},computeVertexNormals:function(t){var n,e,i;for(void 0===t&&(t=!0),i=new Array(this.vertices.length),n=0,e=this.vertices.length;n<e;n++)i[n]=new xt;if(t)for(var r,o,s,a=new xt,u=new xt,c=0,f=this.faces.length;c<f;c++)h=this.faces[c],r=this.vertices[h.a],o=this.vertices[h.b],s=this.vertices[h.c],a.subVectors(s,o),u.subVectors(r,o),a.cross(u),i[h.a].add(a),i[h.b].add(a),i[h.c].add(a);else for(this.computeFaceNormals(),c=0,f=this.faces.length;c<f;c++)i[(h=this.faces[c]).a].add(h.normal),i[h.b].add(h.normal),i[h.c].add(h.normal);for(n=0,e=this.vertices.length;n<e;n++)i[n].normalize();for(c=0,f=this.faces.length;c<f;c++){var h,l=(h=this.faces[c]).vertexNormals;3===l.length?(l[0].copy(i[h.a]),l[1].copy(i[h.b]),l[2].copy(i[h.c])):(l[0]=i[h.a].clone(),l[1]=i[h.b].clone(),l[2]=i[h.c].clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,n;for(this.computeFaceNormals(),t=0,n=this.faces.length;t<n;t++){var e,i=(e=this.faces[t]).vertexNormals;3===i.length?(i[0].copy(e.normal),i[1].copy(e.normal),i[2].copy(e.normal)):(i[0]=e.normal.clone(),i[1]=e.normal.clone(),i[2]=e.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,n,e;for(s=0,a=this.faces.length;s<a;s++)for((e=this.faces[s]).Wr?e.Wr.copy(e.normal):e.Wr=e.normal.clone(),e.Yr||(e.Yr=[]),t=0,n=e.vertexNormals.length;t<n;t++)e.Yr[t]?e.Yr[t].copy(e.vertexNormals[t]):e.Yr[t]=e.vertexNormals[t].clone();var i=new rs;for(i.faces=this.faces,t=0,n=this.morphTargets.length;t<n;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];for(var r=this.morphNormals[t].faceNormals,o=this.morphNormals[t].vertexNormals,s=0,a=this.faces.length;s<a;s++)u=new xt,c={a:new xt,b:new xt,c:new xt},r.push(u),o.push(c)}var u,c,f=this.morphNormals[t];for(i.vertices=this.morphTargets[t].vertices,i.computeFaceNormals(),i.computeVertexNormals(),s=0,a=this.faces.length;s<a;s++)e=this.faces[s],u=f.faceNormals[s],c=f.vertexNormals[s],u.copy(e.normal),c.a.copy(e.vertexNormals[0]),c.b.copy(e.vertexNormals[1]),c.c.copy(e.vertexNormals[2])}for(s=0,a=this.faces.length;s<a;s++)(e=this.faces[s]).normal=e.Wr,e.vertexNormals=e.Yr},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ft),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new kt),this.boundingSphere.setFromPoints(this.vertices)},mergeVertices:function(){for(var t,n,e,i,r={},o=[],s=[],a=Math.pow(10,4),u=0,c=this.vertices.length;u<c;u++)t=this.vertices[u],void 0===r[t=Math.round(t.x*a)+"_"+Math.round(t.y*a)+"_"+Math.round(t.z*a)]?(r[t]=u,o.push(this.vertices[u]),s[u]=o.length-1):s[u]=s[r[t]];var f=[];for(u=0,c=this.faces.length;u<c;u++){(n=this.faces[u]).a=s[n.a],n.b=s[n.b],n.c=s[n.c];for(var h=[n.a,n.b,n.c],l=0;l<3;l++)if(h[l]===h[(l+1)%3]){f.push(u);break}}for(u=f.length-1;0<=u;u--){var d=f[u];for(this.faces.splice(d,1),e=0,i=this.faceVertexUvs.length;e<i;e++)this.faceVertexUvs[e].splice(d,1)}var v=this.vertices.length-o.length;return this.vertices=o,v},setFromPoints:function(t){this.vertices=[];for(var n=0,e=t.length;n<e;n++){var i=t[n];this.vertices.push(new xt(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,n=t.length,e=0;e<n;e++)t[e].je=e;t.sort(function(t,n){return t.materialIndex-n.materialIndex});var i,r,o=this.faceVertexUvs[0],s=this.faceVertexUvs[1];o&&o.length===n&&(i=[]),s&&s.length===n&&(r=[]);for(e=0;e<n;e++){var a=t[e].je;i&&i.push(o[a]),r&&r.push(s[a])}i&&(this.faceVertexUvs[0]=i),r&&(this.faceVertexUvs[1]=r)},dispose:function(){this.dispatchEvent({type:"dispose"})}});var os=new xt;function R(t,n,e){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=n,this.count=void 0!==t?t.length/n:0,this.normalized=!0===e,this.usage=wi,this.updateRange={offset:0,count:-1},this.version=0}function ss(t,n,e){R.call(this,new Int8Array(t),n,e)}function as(t,n,e){R.call(this,new Uint8Array(t),n,e)}function us(t,n,e){R.call(this,new Uint8ClampedArray(t),n,e)}function cs(t,n,e){R.call(this,new Int16Array(t),n,e)}function fs(t,n,e){R.call(this,new Uint16Array(t),n,e)}function hs(t,n,e){R.call(this,new Int32Array(t),n,e)}function ls(t,n,e){R.call(this,new Uint32Array(t),n,e)}function E(t,n,e){R.call(this,new Float32Array(t),n,e)}function ds(t,n,e){R.call(this,new Float64Array(t),n,e)}function vs(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function ps(t){if(0===t.length)return-1/0;for(var n=t[0],e=1,i=t.length;e<i;++e)t[e]>n&&(n=t[e]);return n}Object.defineProperty(R.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(R.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,n,e){t*=this.itemSize,e*=n.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[t+i]=n.array[e+i];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var n=this.array,e=0,i=0,r=t.length;i<r;i++){var o=t[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),o=new lt),n[e++]=o.r,n[e++]=o.g,n[e++]=o.b}return this},copyVector2sArray:function(t){for(var n=this.array,e=0,i=0,r=t.length;i<r;i++){var o=t[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),o=new Mt),n[e++]=o.x,n[e++]=o.y}return this},copyVector3sArray:function(t){for(var n=this.array,e=0,i=0,r=t.length;i<r;i++){var o=t[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),o=new xt),n[e++]=o.x,n[e++]=o.y,n[e++]=o.z}return this},copyVector4sArray:function(t){for(var n=this.array,e=0,i=0,r=t.length;i<r;i++){var o=t[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),o=new Ot),n[e++]=o.x,n[e++]=o.y,n[e++]=o.z,n[e++]=o.w}return this},applyMatrix3:function(t){for(var n=0,e=this.count;n<e;n++)os.x=this.getX(n),os.y=this.getY(n),os.z=this.getZ(n),os.applyMatrix3(t),this.setXYZ(n,os.x,os.y,os.z);return this},applyMatrix4:function(t){for(var n=0,e=this.count;n<e;n++)os.x=this.getX(n),os.y=this.getY(n),os.z=this.getZ(n),os.applyMatrix4(t),this.setXYZ(n,os.x,os.y,os.z);return this},applyNormalMatrix:function(t){for(var n=0,e=this.count;n<e;n++)os.x=this.getX(n),os.y=this.getY(n),os.z=this.getZ(n),os.applyNormalMatrix(t),this.setXYZ(n,os.x,os.y,os.z);return this},transformDirection:function(t){for(var n=0,e=this.count;n<e;n++)os.x=this.getX(n),os.y=this.getY(n),os.z=this.getZ(n),os.transformDirection(t),this.setXYZ(n,os.x,os.y,os.z);return this},set:function(t,n){return this.array.set(t,n=void 0===n?0:n),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,n){return this.array[t*this.itemSize]=n,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,n){return this.array[t*this.itemSize+1]=n,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,n){return this.array[t*this.itemSize+2]=n,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,n){return this.array[t*this.itemSize+3]=n,this},setXY:function(t,n,e){return t*=this.itemSize,this.array[t+0]=n,this.array[t+1]=e,this},setXYZ:function(t,n,e,i){return t*=this.itemSize,this.array[t+0]=n,this.array[t+1]=e,this.array[t+2]=i,this},setXYZW:function(t,n,e,i,r){return t*=this.itemSize,this.array[t+0]=n,this.array[t+1]=e,this.array[t+2]=i,this.array[t+3]=r,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(ss.prototype=Object.create(R.prototype)).constructor=ss,(as.prototype=Object.create(R.prototype)).constructor=as,(us.prototype=Object.create(R.prototype)).constructor=us,(cs.prototype=Object.create(R.prototype)).constructor=cs,fs.prototype=Object.create(R.prototype),fs.prototype.constructor=fs,(hs.prototype=Object.create(R.prototype)).constructor=hs,ls.prototype=Object.create(R.prototype),ls.prototype.constructor=ls,(E.prototype=Object.create(R.prototype)).constructor=E,(ds.prototype=Object.create(R.prototype)).constructor=ds,Object.assign(vs.prototype,{computeGroups:function(t){for(var n,e=[],i=void 0,r=t.faces,o=0;o<r.length;o++){var s=r[o];s.materialIndex!==i&&(i=s.materialIndex,void 0!==n&&(n.count=3*o-n.start,e.push(n)),n={start:3*o,materialIndex:i})}void 0!==n&&(n.count=3*o-n.start,e.push(n)),this.groups=e},fromGeometry:function(t){var n=t.faces,e=t.vertices,i=t.faceVertexUvs,r=i[0]&&0<i[0].length,o=i[1]&&0<i[1].length,s=t.morphTargets,a=s.length;if(0<a){for(var u=[],c=0;c<a;c++)u[c]={name:s[c].name,data:[]};this.morphTargets.position=u}var f=t.morphNormals,h=f.length;if(0<h){for(var l=[],c=0;c<h;c++)l[c]={name:f[c].name,data:[]};this.morphTargets.normal=l}var d=t.skinIndices,v=t.skinWeights,p=d.length===e.length,m=v.length===e.length;0<e.length&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(c=0;c<n.length;c++){var y,b=n[c],g=(this.vertices.push(e[b.a],e[b.b],e[b.c]),b.vertexNormals),g=(3===g.length?this.normals.push(g[0],g[1],g[2]):(g=b.normal,this.normals.push(g,g,g)),b.vertexColors);3===g.length?this.colors.push(g[0],g[1],g[2]):(g=b.color,this.colors.push(g,g,g)),!0===r&&(void 0!==(y=i[0][c])?this.uvs.push(y[0],y[1],y[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new Mt,new Mt,new Mt))),!0===o&&(void 0!==(y=i[1][c])?this.uvs2.push(y[0],y[1],y[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new Mt,new Mt,new Mt)));for(var w=0;w<a;w++){var _=s[w].vertices;u[w].data.push(_[b.a],_[b.b],_[b.c])}for(w=0;w<h;w++){var E=f[w].vertexNormals[c];l[w].data.push(E.a,E.b,E.c)}p&&this.skinIndices.push(d[b.a],d[b.b],d[b.c]),m&&this.skinWeights.push(v[b.a],v[b.b],v[b.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});var ms=1,ys=new At,bs=new a,gs=new xt,ws=new Ft,_s=new Ft,Es=new xt;function N(){Object.defineProperty(this,"id",{value:ms+=2}),this.uuid=Tt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function Ss(t){return(Ss="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ts(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Ss(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Ss(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Ss(t)?t:String(t)}(i.key),i)}}function xs(t,n,e){return n&&Ts(t.prototype,n),e&&Ts(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function As(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function Ms(t,n,e){n=Rs(n);var i=t,n=Ls()?Reflect.construct(n,e||[],Rs(t).constructor):n.apply(t,e);if(n&&("object"===Ss(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return Os(i)}function Os(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ls(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ls=function(){return!!t})()}function Rs(t){return(Rs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ns(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),n&&Ps(t,n)}function Ps(t,n){return(Ps=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}N.prototype=Object.assign(Object.create(D.prototype),{constructor:N,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(65535<ps(t)?ls:fs)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,n){return this.attributes[t]=n,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,n,e){this.groups.push({start:t,count:n,materialIndex:void 0!==e?e:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,n){this.drawRange.start=t,this.drawRange.count=n},applyMatrix4:function(t){var n=this.attributes.position,n=(void 0!==n&&(n.applyMatrix4(t),n.needsUpdate=!0),this.attributes.normal),e=(void 0!==n&&(e=(new Z).getNormalMatrix(t),n.applyNormalMatrix(e),n.needsUpdate=!0),this.attributes.tangent);return void 0!==e&&(e.transformDirection(t),e.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return ys.makeRotationX(t),this.applyMatrix4(ys),this},rotateY:function(t){return ys.makeRotationY(t),this.applyMatrix4(ys),this},rotateZ:function(t){return ys.makeRotationZ(t),this.applyMatrix4(ys),this},translate:function(t,n,e){return ys.makeTranslation(t,n,e),this.applyMatrix4(ys),this},scale:function(t,n,e){return ys.makeScale(t,n,e),this.applyMatrix4(ys),this},lookAt:function(t){return bs.lookAt(t),bs.updateMatrix(),this.applyMatrix4(bs.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(gs).negate(),this.translate(gs.x,gs.y,gs.z),this},setFromObject:function(t){var n,e,i=t.geometry;return t.isPoints||t.isLine?(e=new E(3*i.vertices.length,3),n=new E(3*i.colors.length,3),this.setAttribute("position",e.copyVector3sArray(i.vertices)),this.setAttribute("color",n.copyColorsArray(i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length&&(e=new E(i.lineDistances.length,1),this.setAttribute("lineDistance",e.copyArray(i.lineDistances))),null!==i.boundingSphere&&(this.boundingSphere=i.boundingSphere.clone()),null!==i.boundingBox&&(this.boundingBox=i.boundingBox.clone())):t.isMesh&&i&&i.isGeometry&&this.fromGeometry(i),this},setFromPoints:function(t){for(var n=[],e=0,i=t.length;e<i;e++){var r=t[e];n.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new E(n,3)),this},updateFromObject:function(t){var n,e=t.geometry;if(t.isMesh){var i=e.Qr;if(!0===e.elementsNeedUpdate&&(i=void 0,e.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(e);i.verticesNeedUpdate=e.verticesNeedUpdate,i.normalsNeedUpdate=e.normalsNeedUpdate,i.colorsNeedUpdate=e.colorsNeedUpdate,i.uvsNeedUpdate=e.uvsNeedUpdate,i.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=i}return!0===e.verticesNeedUpdate&&(void 0!==(n=this.attributes.position)&&(n.copyVector3sArray(e.vertices),n.needsUpdate=!0),e.verticesNeedUpdate=!1),!0===e.normalsNeedUpdate&&(void 0!==(n=this.attributes.normal)&&(n.copyVector3sArray(e.normals),n.needsUpdate=!0),e.normalsNeedUpdate=!1),!0===e.colorsNeedUpdate&&(void 0!==(n=this.attributes.color)&&(n.copyColorsArray(e.colors),n.needsUpdate=!0),e.colorsNeedUpdate=!1),e.uvsNeedUpdate&&(void 0!==(n=this.attributes.uv)&&(n.copyVector2sArray(e.uvs),n.needsUpdate=!0),e.uvsNeedUpdate=!1),e.lineDistancesNeedUpdate&&(void 0!==(n=this.attributes.lineDistance)&&(n.copyArray(e.lineDistances),n.needsUpdate=!0),e.lineDistancesNeedUpdate=!1),e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.Qr=(new vs).fromGeometry(t),this.fromDirectGeometry(t.Qr)},fromDirectGeometry:function(t){var n,e=new Float32Array(3*t.vertices.length);for(n in this.setAttribute("position",new R(e,3).copyVector3sArray(t.vertices)),0<t.normals.length&&(e=new Float32Array(3*t.normals.length),this.setAttribute("normal",new R(e,3).copyVector3sArray(t.normals))),0<t.colors.length&&(e=new Float32Array(3*t.colors.length),this.setAttribute("color",new R(e,3).copyColorsArray(t.colors))),0<t.uvs.length&&(e=new Float32Array(2*t.uvs.length),this.setAttribute("uv",new R(e,2).copyVector2sArray(t.uvs))),0<t.uvs2.length&&(e=new Float32Array(2*t.uvs2.length),this.setAttribute("uv2",new R(e,2).copyVector2sArray(t.uvs2))),this.groups=t.groups,t.morphTargets){for(var i=[],r=t.morphTargets[n],o=0,s=r.length;o<s;o++){var a=r[o],u=new E(3*a.data.length,3);u.name=a.name,i.push(u.copyVector3sArray(a.data))}this.morphAttributes[n]=i}return 0<t.skinIndices.length&&(e=new E(4*t.skinIndices.length,4),this.setAttribute("skinIndex",e.copyVector4sArray(t.skinIndices))),0<t.skinWeights.length&&(e=new E(4*t.skinWeights.length,4),this.setAttribute("skinWeight",e.copyVector4sArray(t.skinWeights))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ft);var t=this.attributes.position,n=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),n)for(var e=0,i=n.length;e<i;e++){var r=n[e];ws.setFromBufferAttribute(r),this.morphTargetsRelative?(Es.addVectors(this.boundingBox.min,ws.min),this.boundingBox.expandByPoint(Es),Es.addVectors(this.boundingBox.max,ws.max),this.boundingBox.expandByPoint(Es)):(this.boundingBox.expandByPoint(ws.min),this.boundingBox.expandByPoint(ws.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new kt);var t=this.attributes.position,n=this.morphAttributes.position;if(t){var e=this.boundingSphere.center;if(ws.setFromBufferAttribute(t),n)for(var i=0,r=n.length;i<r;i++){var o=n[i];_s.setFromBufferAttribute(o),this.morphTargetsRelative?(Es.addVectors(ws.min,_s.min),ws.expandByPoint(Es),Es.addVectors(ws.max,_s.max),ws.expandByPoint(Es)):(ws.expandByPoint(_s.min),ws.expandByPoint(_s.max))}ws.getCenter(e);for(var s=0,i=0,r=t.count;i<r;i++)Es.fromBufferAttribute(t,i),s=Math.max(s,e.distanceToSquared(Es));if(n)for(i=0,r=n.length;i<r;i++)for(var o=n[i],a=this.morphTargetsRelative,u=0,c=o.count;u<c;u++)Es.fromBufferAttribute(o,u),a&&(gs.fromBufferAttribute(t,u),Es.add(gs)),s=Math.max(s,e.distanceToSquared(Es));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,n=this.attributes;if(n.position){var e=n.position.array;if(void 0===n.normal)this.setAttribute("normal",new R(new Float32Array(e.length),3));else for(var i=n.normal.array,r=0,o=i.length;r<o;r++)i[r]=0;var s,a,u,c=n.normal.array,f=new xt,h=new xt,l=new xt,d=new xt,v=new xt;if(t)for(var p=t.array,r=0,o=t.count;r<o;r+=3)s=3*p[r+0],a=3*p[r+1],u=3*p[r+2],f.fromArray(e,s),h.fromArray(e,a),l.fromArray(e,u),d.subVectors(l,h),v.subVectors(f,h),d.cross(v),c[s]+=d.x,c[1+s]+=d.y,c[2+s]+=d.z,c[a]+=d.x,c[1+a]+=d.y,c[2+a]+=d.z,c[u]+=d.x,c[1+u]+=d.y,c[2+u]+=d.z;else for(r=0,o=e.length;r<o;r+=9)f.fromArray(e,r),h.fromArray(e,r+3),l.fromArray(e,r+6),d.subVectors(l,h),v.subVectors(f,h),d.cross(v),c[r]=d.x,c[r+1]=d.y,c[r+2]=d.z,c[r+3]=d.x,c[r+4]=d.y,c[r+5]=d.z,c[r+6]=d.x,c[r+7]=d.y,c[r+8]=d.z;this.normalizeNormals(),n.normal.needsUpdate=!0}},normalizeNormals:function(){for(var t=this.attributes.normal,n=0,e=t.count;n<e;n++)Es.x=t.getX(n),Es.y=t.getY(n),Es.z=t.getZ(n),Es.normalize(),t.setXYZ(n,Es.x,Es.y,Es.z)},dispose:function(){this.dispatchEvent({type:"dispose"})}});var js=function(){function u(t,n,e,i,r,o){As(this,u),(s=Ms(this,u)).type="BoxBufferGeometry",s.parameters={width:t,height:n,depth:e,widthSegments:i,heightSegments:r,depthSegments:o};var s,O=Os(s),L=(t=t||1,n=n||1,e=e||1,i=Math.floor(i)||1,r=Math.floor(r)||1,o=Math.floor(o)||1,[]),R=[],N=[],P=[],j=0,F=0;function a(t,n,e,i,r,o,s,a,u,c,f){for(var h=o/u,l=s/c,d=o/2,v=s/2,p=a/2,m=u+1,y=c+1,b=0,g=0,w=new xt,_=0;_<y;_++)for(var E=_*l-v,S=0;S<m;S++)w[t]=(S*h-d)*i,w[n]=E*r,w[e]=p,R.push(w.x,w.y,w.z),w[t]=0,w[n]=0,w[e]=0<a?1:-1,N.push(w.x,w.y,w.z),P.push(S/u),P.push(1-_/c),b+=1;for(_=0;_<c;_++)for(S=0;S<u;S++){var T=j+S+m*_,x=j+S+m*(_+1),A=j+(S+1)+m*(_+1),M=j+(S+1)+m*_;L.push(T,x,M),L.push(x,A,M),g+=6}O.addGroup(F,g,f),F+=g,j+=b}return a("z","y","x",-1,-1,e,n,t,o,r,0),a("z","y","x",1,-1,e,n,-t,o,r,1),a("x","z","y",1,1,t,e,n,i,o,2),a("x","z","y",1,-1,t,e,-n,i,o,3),a("x","y","z",1,-1,t,n,e,i,r,4),a("x","y","z",-1,-1,t,n,-e,i,r,5),s.setIndex(L),s.setAttribute("position",new E(R,3)),s.setAttribute("normal",new E(N,3)),s.setAttribute("uv",new E(P,2)),s}return Ns(u,N),xs(u)}();function Fs(t,n,e,i){N.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:n,widthSegments:e,heightSegments:i};for(var r=(t=t||1)/2,o=(n=n||1)/2,s=Math.floor(e)||1,a=Math.floor(i)||1,u=s+1,c=a+1,f=t/s,h=n/a,l=[],d=[],v=[],p=[],m=0;m<c;m++)for(var y=m*h-o,b=0;b<u;b++)d.push(b*f-r,-y,0),v.push(0,0,1),p.push(b/s),p.push(1-m/a);for(m=0;m<a;m++)for(b=0;b<s;b++){var g=b+u*(m+1),w=b+1+u*(m+1),_=b+1+u*m;l.push(b+u*m,g,_),l.push(g,w,_)}this.setIndex(l),this.setAttribute("position",new E(d,3)),this.setAttribute("normal",new E(v,3)),this.setAttribute("uv",new E(p,2))}(Fs.prototype=Object.create(N.prototype)).constructor=Fs;var Is={alphaTest:.001},Cs=0;function h(){Object.defineProperty(this,"id",{value:Cs++}),this.uuid=Tt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=cn,this.side=on,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Sn,this.blendDst=Tn,this.blendEquation=vn,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=jn,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=gi,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=yi,this.stencilZFail=yi,this.stencilZPass=yi,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=Is.alphaTest,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function ks(t){var n,e={};for(n in t)for(var i in e[n]={},t[n]){var r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}return e}function Ds(t){for(var n={},e=0;e<t.length;e++){var i,r=ks(t[e]);for(i in r)n[i]=r[i]}return n}h.prototype=Object.assign(Object.create(D.prototype),{constructor:h,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var n in t){var e,i=t[n];void 0===i?console.warn("THREE.Material: '"+n+"' parameter is undefined."):"shading"===n?(console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i):void 0===(e=this[n])?console.warn("THREE."+this.type+": '"+n+"' is not a property of this material."):e&&e.isColor?e.set(i):e&&e.isVector3&&i&&i.isVector3?e.copy(i):this[n]=i}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var n=t.clippingPlanes,e=null;if(null!==n)for(var i=n.length,e=new Array(i),r=0;r!==i;++r)e[r]=n[r].clone();return this.clippingPlanes=e,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(h.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}});var Us={clone:ks,merge:Ds},Bs="\nvoid main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",Gs="\nvoid main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}\n";function Hs(t){h.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=Bs,this.fragmentShader=Gs,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}((Hs.prototype=Object.create(h.prototype)).constructor=Hs).prototype.isShaderMaterial=!0,Hs.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=ks(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this};var Xs=new xt,zs=new xt,Vs=new xt,Ws=new xt,Ys=new xt,Qs=new xt,Zs=new xt,qs=new xt,Ks=new xt,Js=new xt;function $s(t,n,e){this.a=void 0!==t?t:new xt,this.b=void 0!==n?n:new xt,this.c=void 0!==e?e:new xt}function ta(t){h.call(this),this.type="MeshBasicMaterial",this.color=new lt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Dn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}Object.assign($s,{getNormal:function(t,n,e,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new xt),i.subVectors(e,n),Xs.subVectors(t,n),i.cross(Xs);e=i.lengthSq();return 0<e?i.multiplyScalar(1/Math.sqrt(e)):i.set(0,0,0)},getBarycoord:function(t,n,e,i,r){Xs.subVectors(i,n),zs.subVectors(e,n),Vs.subVectors(t,n);var i=Xs.dot(Xs),e=Xs.dot(zs),t=Xs.dot(Vs),n=zs.dot(zs),o=zs.dot(Vs),s=i*n-e*e;return void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new xt),0==s?r.set(-2,-1,-1):r.set(1-(n=(n*t-e*o)*(r=1/s))-(s=(i*o-e*t)*r),s,n)},containsPoint:function(t,n,e,i){return $s.getBarycoord(t,n,e,i,Ws),0<=Ws.x&&0<=Ws.y&&Ws.x+Ws.y<=1},getUV:function(t,n,e,i,r,o,s,a){return this.getBarycoord(t,n,e,i,Ws),a.set(0,0),a.addScaledVector(r,Ws.x),a.addScaledVector(o,Ws.y),a.addScaledVector(s,Ws.z),a},isFrontFacing:function(t,n,e,i){return Xs.subVectors(e,n),zs.subVectors(t,n),Xs.cross(zs).dot(i)<0}}),Object.assign($s.prototype,{set:function(t,n,e){return this.a.copy(t),this.b.copy(n),this.c.copy(e),this},setFromPointsAndIndices:function(t,n,e,i){return this.a.copy(t[n]),this.b.copy(t[e]),this.c.copy(t[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return Xs.subVectors(this.c,this.b),zs.subVectors(this.a,this.b),.5*Xs.cross(zs).length()},getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new xt),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return $s.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Gt),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,n){return $s.getBarycoord(t,this.a,this.b,this.c,n)},getUV:function(t,n,e,i,r){return $s.getUV(t,this.a,this.b,this.c,n,e,i,r)},containsPoint:function(t){return $s.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return $s.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(t,n){void 0===n&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),n=new xt);var e=this.a,i=this.b,r=this.c,o=(Ys.subVectors(i,e),Qs.subVectors(r,e),qs.subVectors(t,e),Ys.dot(qs)),s=Qs.dot(qs);if(o<=0&&s<=0)return n.copy(e);Ks.subVectors(t,i);var a=Ys.dot(Ks),u=Qs.dot(Ks);if(0<=a&&u<=a)return n.copy(i);var c=o*u-a*s;if(c<=0&&0<=o&&a<=0)return f=o/(o-a),n.copy(e).addScaledVector(Ys,f);Js.subVectors(t,r);var f,h,t=Ys.dot(Js),l=Qs.dot(Js);return 0<=l&&t<=l?n.copy(r):(o=t*s-o*l)<=0&&0<=s&&l<=0?(h=s/(s-l),n.copy(e).addScaledVector(Qs,h)):(s=a*l-t*u)<=0&&0<=u-a&&0<=t-l?(Zs.subVectors(r,i),h=(u-a)/(u-a+(t-l)),n.copy(i).addScaledVector(Zs,h)):(f=o*(r=1/(s+o+c)),h=c*r,n.copy(e).addScaledVector(Ys,f).addScaledVector(Qs,h))},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}),((ta.prototype=Object.create(h.prototype)).constructor=ta).prototype.isMeshBasicMaterial=!0,ta.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};var na=new At,ea=new Mo,ia=new kt,ra=new xt,oa=new xt,sa=new xt,aa=new xt,ua=new xt,ca=new xt,fa=new xt,ha=new xt,la=new xt,da=new Mt,va=new Mt,pa=new Mt,ma=new xt,ya=new xt;function ba(t,n){a.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new N,this.material=void 0!==n?n:new ta,this.updateMorphTargets()}function ga(t,n,e,i,r,o,s,a){i=n.side===sn?i.intersectTriangle(s,o,r,!0,a):i.intersectTriangle(r,o,s,n.side!==an,a);if(null===i)return null;ya.copy(a),ya.applyMatrix4(t.matrixWorld);r=e.ray.origin.distanceTo(ya);return r<e.near||r>e.far?null:{distance:r,point:ya.clone(),object:t}}function wa(t,n,e,i,r,o,s,a,u,c,f,h){ra.fromBufferAttribute(r,c),oa.fromBufferAttribute(r,f),sa.fromBufferAttribute(r,h);var l=t.morphTargetInfluences;if(n.morphTargets&&o&&l){fa.set(0,0,0),ha.set(0,0,0),la.set(0,0,0);for(var d=0,v=o.length;d<v;d++){var p=l[d],m=o[d];0!==p&&(aa.fromBufferAttribute(m,c),ua.fromBufferAttribute(m,f),ca.fromBufferAttribute(m,h),s?(fa.addScaledVector(aa,p),ha.addScaledVector(ua,p),la.addScaledVector(ca,p)):(fa.addScaledVector(aa.sub(ra),p),ha.addScaledVector(ua.sub(oa),p),la.addScaledVector(ca.sub(sa),p)))}ra.add(fa),oa.add(ha),sa.add(la)}r=ga(t,n,e,i,ra,oa,sa,ma);return r&&(a&&(da.fromBufferAttribute(a,c),va.fromBufferAttribute(a,f),pa.fromBufferAttribute(a,h),r.uv=$s.getUV(ma,ra,oa,sa,da,va,pa,new Mt)),u&&(da.fromBufferAttribute(u,c),va.fromBufferAttribute(u,f),pa.fromBufferAttribute(u,h),r.uv2=$s.getUV(ma,ra,oa,sa,da,va,pa,new Mt)),t=new $o(c,f,h),$s.getNormal(ra,oa,sa,t.normal),r.face=t),r}ba.prototype=Object.assign(Object.create(a.prototype),{constructor:ba,isMesh:!0,copy:function(t){return a.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,n,e,i=this.geometry;if(i.isBufferGeometry){var r=i.morphAttributes,o=Object.keys(r);if(0<o.length){var s=r[o[0]];if(void 0!==s)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,n=s.length;t<n;t++)e=s[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}else{r=i.morphTargets;void 0!==r&&0<r.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,n){var e=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i&&(null===e.boundingSphere&&e.computeBoundingSphere(),ia.copy(e.boundingSphere),ia.applyMatrix4(r),!1!==t.ray.intersectsSphere(ia)&&(na.getInverse(r),ea.copy(t.ray).applyMatrix4(na),null===e.boundingBox||!1!==ea.intersectsBox(e.boundingBox))))if(e.isBufferGeometry){var o,s,a,u,c,f,h,l,d,v=e.index,p=e.attributes.position,m=e.morphAttributes.position,y=e.morphTargetsRelative,b=e.attributes.uv,g=e.attributes.uv2,w=e.groups,_=e.drawRange;if(null!==v)if(Array.isArray(i))for(u=0,f=w.length;u<f;u++)for(d=i[(l=w[u]).materialIndex],c=Math.max(l.start,_.start),h=Math.min(l.start+l.count,_.start+_.count);c<h;c+=3)o=v.getX(c),s=v.getX(c+1),a=v.getX(c+2),(N=wa(this,d,t,ea,p,m,y,b,g,o,s,a))&&(N.faceIndex=Math.floor(c/3),N.face.materialIndex=l.materialIndex,n.push(N));else for(u=Math.max(0,_.start),f=Math.min(v.count,_.start+_.count);u<f;u+=3)o=v.getX(u),s=v.getX(u+1),a=v.getX(u+2),(N=wa(this,i,t,ea,p,m,y,b,g,o,s,a))&&(N.faceIndex=Math.floor(u/3),n.push(N));else if(void 0!==p)if(Array.isArray(i))for(u=0,f=w.length;u<f;u++)for(d=i[(l=w[u]).materialIndex],c=Math.max(l.start,_.start),h=Math.min(l.start+l.count,_.start+_.count);c<h;c+=3)(N=wa(this,d,t,ea,p,m,y,b,g,o=c,s=c+1,a=c+2))&&(N.faceIndex=Math.floor(c/3),N.face.materialIndex=l.materialIndex,n.push(N));else for(u=Math.max(0,_.start),f=Math.min(p.count,_.start+_.count);u<f;u+=3)(N=wa(this,i,t,ea,p,m,y,b,g,o=u,s=u+1,a=u+2))&&(N.faceIndex=Math.floor(u/3),n.push(N))}else if(e.isGeometry){var E,S=Array.isArray(i),T=e.vertices,x=e.faces,r=e.faceVertexUvs[0];0<r.length&&(E=r);for(var A=0,M=x.length;A<M;A++){var O,L,R,N,P=x[A],j=S?i[P.materialIndex]:i;void 0!==j&&(O=T[P.a],L=T[P.b],R=T[P.c],N=ga(this,j,t,ea,O,L,R,ma))&&(E&&E[A]&&(j=E[A],da.copy(j[0]),va.copy(j[1]),pa.copy(j[2]),N.uv=$s.getUV(ma,O,L,R,da,va,pa,new Mt)),N.face=P,N.faceIndex=A,n.push(N))}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var _={alphamap_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",alphamap_pars_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",alphatest_fragment:"\n#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",aomap_fragment:"\n#ifdef USE_AOMAP\n\n\t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\n\t#endif\n\n#endif\n",aomap_pars_fragment:"\n#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif\n",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n\n#ifdef USE_TANGENT\n\n\tvec3 objectTangent = vec3( tangent.xyz );\n\n#endif\n",bsdfs:'\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via \'environmentBRDF\' from "Physically Based Shading on Mobile"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n\tvec4 r = roughness * c0 + c1;\n\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n}\n\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\n\t// page 32, equation 26: E[window1]\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\t// this is intended to be used on spot and point lights who are represented as luminous intensity\n\t// but who must be converted to luminous irradiance for surface lighting calculation\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\n\tif( cutoffDistance > 0.0 ) {\n\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\n\t}\n\n\treturn distanceFalloff;\n\n#else\n\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n\t}\n\n\treturn 1.0;\n\n#endif\n\n}\n\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\n\treturn RECIPROCAL_PI * diffuseColor;\n\n} // validated\n\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\n\t// Original approximation by Christophe Schlick \'94\n\t// float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH \'13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n\n} // validated\n\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\n\t// See F_Schlick\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\n\treturn Fr * fresnel + F0;\n\n}\n\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (34)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disneys reparameterization\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\t// geometry term (normalized) = G(l)G(v) / 4(nl)(nv)\n\t// also see #12151\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\n\treturn 1.0 / ( gl * gv );\n\n} // validated\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\tfloat a2 = pow2( alpha );\n\n\t// dotNL and dotNV are explicitly swapped. This is not a mistake.\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\n\treturn 0.5 / max( gv + gl, EPSILON );\n\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disneys reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\n\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n\n}\n\n// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\tfloat D = D_GGX( alpha, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// Rect Area Light\n\n// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines\n// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt\n// code: https://github.com/selfshadow/ltc_code/\n\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\n\tfloat dotNV = saturate( dot( N, V ) );\n\n\t// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\treturn uv;\n\n}\n\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\n\t// Real-Time Area Lighting: a Journey from Research to Production (p.102)\n\t// An approximation of the form factor of a horizon-clipped rectangle.\n\n\tfloat l = length( f );\n\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n\n}\n\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\n\tfloat x = dot( v1, v2 );\n\n\tfloat y = abs( x );\n\n\t// rational polynomial approximation to theta / sin( theta ) / 2PI\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\n\treturn cross( v1, v2 ) * theta_sintheta;\n\n}\n\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\n\t// bail if point is on back side of plane of light\n\t// assumes ccw winding order of light vertices\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\n\t// construct orthonormal basis around N\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system\n\n\t// compute transform\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\n\t// transform rect\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\n\t// project rect onto sphere\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\n\t// calculate vector form factor\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\n\t// adjust for horizon clipping\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\n/*\n\t// alternate method of adjusting for horizon clipping (see referece)\n\t// refactoring required\n\tfloat len = length( vectorFormFactor );\n\tfloat z = vectorFormFactor.z / len;\n\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\n\t// tabulated horizon-clipped sphere, apparently...\n\tvec2 uv = vec2( z * 0.5 + 0.5, len );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\tfloat scale = texture2D( ltc_2, uv ).w;\n\n\tfloat result = len * scale;\n*/\n\n\treturn vec3( result );\n\n}\n\n// End Rect Area Light\n\n// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\n\treturn specularColor * brdf.x + brdf.y;\n\n} // validated\n\n// Fdez-Agera\'s "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619; // 1/21\n\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\n\n\t// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\n\t//float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\t//float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// source: http://simonstechblog.blogspot.ca/2011/12/microfacet-brdf.html\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\n\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n\n#if defined( USE_SHEEN )\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L94\nfloat D_Charlie(float roughness, float NoH) {\n\t// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF"\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125); // 2^(-14/2), so sin2h^2 > 0 in fp16\n\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L136\nfloat V_Neubelt(float NoV, float NoL) {\n\t// Neubelt and Pettineo 2013, "Crafting a Next-gen Material Pipeline for The Order: 1886"\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\n\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n\n}\n\n#endif\n',bumpmap_pars_fragment:"\n#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n\t// http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",clipping_planes_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvec4 plane;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\n\t\tbool clipped = true;\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t\tif ( clipped ) discard;\n\n\t#endif\n\n#endif\n",clipping_planes_pars_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n\n#endif\n",clipping_planes_pars_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n#endif\n",clipping_planes_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvClipPosition = - mvPosition.xyz;\n\n#endif\n",color_fragment:"\n#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif\n",color_pars_fragment:"\n#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",color_pars_vertex:"\n#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",color_vertex:"\n#ifdef USE_COLOR\n\n\tvColor.xyz = color.xyz;\n\n#endif\n",common:"\n#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#ifndef saturate\n// <tonemapping_pars_fragment> may have defined saturate() already\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t// dir can be either a direction vector or a normal vector\n\t// upper-left 3x3 of matrix is assumed to be orthogonal\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nmat3 transposeMat3( const in mat3 m ) {\n\n\tmat3 tmp;\n\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\n\treturn tmp;\n\n}\n\n// https://en.wikipedia.org/wiki/Relative_luminance\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\n\treturn dot( weights, color.rgb );\n\n}\n\nbool isPerspectiveMatrix( mat4 m ) {\n\n  return m[ 2 ][ 3 ] == - 1.0;\n\n}\n",cube_uv_reflection_fragment:"\n#ifdef ENVMAP_TYPE_CUBE_UV\n\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\n\n// These shader functions convert between the UV coordinates of a single face of\n// a cubemap, the 0-5 integer index of a cube face, and the direction vector for\n// sampling a textureCube (not generally normalized).\n\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\n\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);\n    } else if (face == 1.0) {\n      uv = vec2(direction.x, -direction.z) / abs(direction.y);\n    } else if (face == 2.0) {\n      uv = direction.xy / abs(direction.z);\n    } else if (face == 3.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);\n    } else if (face == 4.0) {\n      uv = direction.xz / abs(direction.y);\n    } else {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);\n    }\n    return 0.5 * (uv + 1.0);\n}\n\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n\n// These defines must match with PMREMGenerator\n\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\n\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n  }\n  return mip;\n}\n\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif\n",defaultnormal_vertex:"\nvec3 transformedNormal = objectNormal;\n\n#ifdef USE_INSTANCING\n\n\t// this is in lieu of a per-instance normal-matrix\n\t// shear transforms in the instance matrix are not supported\n\n\tmat3 m = mat3( instanceMatrix );\n\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\n\ttransformedNormal = m * transformedNormal;\n\n#endif\n\ntransformedNormal = normalMatrix * transformedNormal;\n\n#ifdef FLIP_SIDED\n\n\ttransformedNormal = - transformedNormal;\n\n#endif\n\n#ifdef USE_TANGENT\n\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#ifdef FLIP_SIDED\n\n\t\ttransformedTangent = - transformedTangent;\n\n\t#endif\n\n#endif\n",displacementmap_pars_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n\n#endif\n",displacementmap_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n\n#endif\n",emissivemap_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n#endif\n",emissivemap_pars_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n",encodings_fragment:"\ngl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\n// For a discussion of what this is, please read this: http://lousodrome.net/blog/light/2013/05/26/gamma-correct-and-hdr-rendering-in-a-32-bits-buffer/\n\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\n\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\n\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\n\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\n\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\n\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\n\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n//  return vec4( value.brg, ( 3.0 + 128.0 ) / 256.0 );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\n\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\n\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\t// NOTE: The implementation with min causes the shader to not compile on\n\t// a common Alcatel A502DL in Chrome 78/Android 8.1. Some research suggests \n\t// that the chipset is Mediatek MT6739 w/ IMG PowerVR GE8100 GPU.\n\t// D = min( floor( D ) / 255.0, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\n\n// LogLuv reference: http://graphicrants.blogspot.ca/2009/04/rgbm-color-encoding.html\n\n// M matrix, for encoding\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\n\n// Inverse M matrix, for decoding\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}\n",envmap_fragment:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t}  else {\n\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\n\t\t}\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\n\t\tvec2 sampleUV;\n\n\t\treflectVec = normalize( reflectVec );\n\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\n\t\treflectVec = normalize( reflectVec );\n\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\n\t#else\n\n\t\tvec4 envColor = vec4( 0.0 );\n\n\t#endif\n\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\n\t\tenvColor = envMapTexelToLinear( envColor );\n\n\t#endif\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",envmap_common_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif\n",envmap_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n\n#endif\n",envmap_pars_vertex:"\n#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\n\t#endif\n\n#endif\n",envmap_physical_pars_fragment:"\n#if defined( USE_ENVMAP )\n\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\n\tvec3 getLightProbeIndirectIrradiance( /*const in SpecularLightProbe specularLightProbe,*/ const in GeometricContext geometry, const in int maxMIPLevel ) {\n\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\n\t\t\t// TODO: replace with properly filtered cubemaps and access the irradiance LOD level, be it the last LOD level\n\t\t\t// of a specular cubemap, or just the default level of a specially created irradiance cubemap.\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#else\n\n\t\t\t\t// force the bias high to get the last LOD level as it is the most blurred.\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\n\t\t#else\n\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\n\t\t#endif\n\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\n\t}\n\n\t// Trowbridge-Reitz distribution to Mip level, following the logic of http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\n\t\t// clamp to allowable LOD ranges.\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\n\t}\n\n\tvec3 getLightProbeIndirectRadiance( /*const in SpecularLightProbe specularLightProbe,*/ const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\n\t\t  // Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\n\t\t#else\n\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\n\t\t#endif\n\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#endif\n\n\t\treturn envMapColor.rgb * envMapIntensity;\n\n\t}\n\n#endif\n",envmap_vertex:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvWorldPosition = worldPosition.xyz;\n\n\t#else\n\n\t\tvec3 cameraToVertex;\n\n\t\tif ( isOrthographic ) { \n\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t\t}\n\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\n\n\tfogDepth = -mvPosition.z;\n\n#endif\n",fog_pars_vertex:"\n#ifdef USE_FOG\n\n\tvarying float fogDepth;\n\n#endif\n",fog_fragment:"\n#ifdef USE_FOG\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\n\t#endif\n\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif\n",fog_pars_fragment:"\n#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\n\t#endif\n\n#endif\n",gradientmap_pars_fragment:"\n\n#ifdef USE_GRADIENTMAP\n\n\tuniform sampler2D gradientMap;\n\n#endif\n\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\n\t// dotNL will be from -1.0 to 1.0\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\n\t#ifdef USE_GRADIENTMAP\n\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\n\t#else\n\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\n\t#endif\n\n}\n\n",lightmap_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity; // factor of PI should not be present; included here to prevent breakage\n\n#endif\n",lightmap_pars_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n\n#endif\n",lights_lambert_vertex:"\nvec3 diffuse = vec3( 1.0 );\n\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\n\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\n\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n\n#if NUM_POINT_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if NUM_SPOT_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n/*\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\t// TODO (abelnation): implement\n\n\t}\n\n#endif\n*/\n\n#if NUM_DIR_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if NUM_HEMI_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n",lights_pars_begin:"\nuniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\n\n// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\n\t// normal is assumed to have unit length\n\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\n\t// band 0\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\n\t// band 1\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\n\t// band 2\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\n\treturn result;\n\n}\n\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\n\treturn irradiance;\n\n}\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n\tvec3 irradiance = ambientLightColor;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI;\n\n\t#endif\n\n\treturn irradiance;\n\n}\n\n#if NUM_DIR_LIGHTS > 0\n\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\n\t}\n\n#endif\n\n\n#if NUM_POINT_LIGHTS > 0\n\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\n\t}\n\n#endif\n\n\n#if NUM_SPOT_LIGHTS > 0\n\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\n\t\tif ( angleCos > spotLight.coneCos ) {\n\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\n\t\t} else {\n\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\n\t\t}\n\t}\n\n#endif\n\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\n\t// Pre-computed values of LinearTransformedCosine approximation of BRDF\n\t// BRDF approximation Texture is 64x64\n\tuniform sampler2D ltc_1; // RGBA Float\n\tuniform sampler2D ltc_2; // RGBA Float\n\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n\n#endif\n\n\n#if NUM_HEMI_LIGHTS > 0\n\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tirradiance *= PI;\n\n\t\t#endif\n\n\t\treturn irradiance;\n\n\t}\n\n#endif\n",lights_toon_fragment:"\nToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_toon_pars_fragment:"\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct ToonMaterial {\n\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n\n};\n\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_phong_fragment:"\nBlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct BlinnPhongMaterial {\n\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n\n};\n\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"\nPhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\n\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\n\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.\nmaterial.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n\n#ifdef REFLECTIVITY\n\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\n#else\n\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n\n#endif\n\n#ifdef CLEARCOAT\n\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\n\t#ifdef USE_CLEARCOATMAP\n\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\n\t#endif\n\n\tmaterial.clearcoat = saturate( material.clearcoat ); // Burley clearcoat model\n\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n\n#endif\n\n#ifdef USE_SHEEN\n\n\tmaterial.sheenColor = sheen;\n\n#endif\n",lights_physical_pars_fragment:"\nstruct PhysicalMaterial {\n\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n\n};\n\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n// Clear coat directional hemishperical reflectance (this approximation should be improved)\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n\n}\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction\n\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\n\t\t// LTC Fresnel Approximation by Stephen Hill\n\t\t// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\n\t}\n\n#endif\n\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tccIrradiance *= PI; // punctual light\n\n\t\t#endif\n\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\n\t// Both indirect specular and indirect diffuse light accumulate here\n\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n}\n",lights_fragment_begin:"\n/**\n * This is a template that can be used to light a material, it uses pluggable\n * RenderEquations (RE)for specific lighting scenarios.\n *\n * Instructions for use:\n * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???\n * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n *\n * TODO:\n * - Add area light support.\n * - Add sphere light support.\n * - Add diffuse light probe (irradiance cubemap) support.\n */\n\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n#ifdef CLEARCOAT\n\n\tgeometry.clearcoatNormal = clearcoatNormal;\n\n#endif\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 iblIrradiance = vec3( 0.0 );\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n\n#endif\n",lights_fragment_maps:"\n#if defined( RE_IndirectDiffuse )\n\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tlightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage\n\n\t\t#endif\n\n\t\tirradiance += lightMapIrradiance;\n\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( /*lightProbe,*/ geometry, maxMipLevel );\n\n\t#endif\n\n#endif\n\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\n\tradiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\n\t#ifdef CLEARCOAT\n\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\n\t#endif\n\n#endif\n",lights_fragment_end:"\n#if defined( RE_IndirectDiffuse )\n\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n\n#endif\n",logdepthbuf_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\t// Doing a strict comparison with == 1.0 can cause noise artifacts\n\t// on some platforms. See issue #17623.\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n\n#endif\n",logdepthbuf_pars_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n\n#endif\n",logdepthbuf_pars_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\n\t#else\n\n\t\tuniform float logDepthBufFC;\n\n\t#endif\n\n#endif\n",logdepthbuf_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\n\t#else\n\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\n\t\t\tgl_Position.z *= gl_Position.w;\n\n\t\t}\n\n\t#endif\n\n#endif\n",map_fragment:"\n#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\n#endif\n",map_fragment_1:"\n#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\t\n\tif(mapMixColor){\n\t    diffuseColor = texelColor*texelColor.a + diffuseColor*(1.0-texelColor.a);\n\t}else {\n\t    diffuseColor *= texelColor;\n\t}\n\n#endif\n",map_pars_fragment:"\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n",map_particle_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\n#endif\n\n#ifdef USE_MAP\n\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n\n#endif\n",map_particle_pars_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tuniform mat3 uvTransform;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",metalnessmap_fragment:"\nfloat metalnessFactor = metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n",metalnessmap_pars_fragment:"\n#ifdef USE_METALNESSMAP\n\n\tuniform sampler2D metalnessMap;\n\n#endif\n",morphnormal_vertex:"\n#ifdef USE_MORPHNORMALS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\n#endif\n",morphtarget_pars_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\tuniform float morphTargetBaseInfluence;\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif\n",morphtarget_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in position = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n#endif\n",normal_fragment_begin:"\n#ifdef FLAT_SHADED\n\n\t// Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\n\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#else\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\t#ifdef USE_TANGENT\n\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n\n// non perturbed normal for clearcoat among others\n\nvec3 geometryNormal = normal;\n\n",normal_fragment_maps:"\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n\t#ifdef FLIP_SIDED\n\n\t\tnormal = - normal;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\tnormal = normalize( normalMatrix * normal );\n\n#elif defined( TANGENTSPACE_NORMALMAP )\n\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tnormal = normalize( vTBN * mapN );\n\n\t#else\n\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\n\t#endif\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n",normalmap_pars_fragment:"\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n#endif\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tuniform mat3 normalMatrix;\n\n#endif\n\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tmat3 tsn = mat3( S, T, N );\n\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",clearcoat_normal_fragment_begin:"\n#ifdef CLEARCOAT\n\n\tvec3 clearcoatNormal = geometryNormal;\n\n#endif\n",clearcoat_normal_fragment_maps:"\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\n\t#else\n\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\n\t#endif\n\n#endif\n",clearcoat_pars_fragment:"\n\n#ifdef USE_CLEARCOATMAP\n\n\tuniform sampler2D clearcoatMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tuniform sampler2D clearcoatRoughnessMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n\n#endif\n",packing:"\nvec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\n\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\n\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\n\treturn r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\n\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\n\n// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions\n\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\n\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"\n#ifdef PREMULTIPLIED_ALPHA\n\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\n\tgl_FragColor.rgb *= gl_FragColor.a;\n\n#endif\n",project_vertex:"\nvec4 mvPosition = vec4( transformed, 1.0 );\n\n#ifdef USE_INSTANCING\n\n\tmvPosition = instanceMatrix * mvPosition;\n\n#endif\n\nmvPosition = modelViewMatrix * mvPosition;\n\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"\n#ifdef DITHERING\n\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n\n#endif\n",dithering_pars_fragment:"\n#ifdef DITHERING\n\n\t// based on https://www.shadertoy.com/view/MslGR8\n\tvec3 dithering( vec3 color ) {\n\t\t//Calculate grid position\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\n\t\t//Shift the individual colors differently, thus making it even harder to see the dithering pattern\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\n\t\t//modify shift acording to grid position.\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\n\t\t//shift the color by dither_shift\n\t\treturn color + dither_shift_RGB;\n\t}\n\n#endif\n",roughnessmap_fragment:"\nfloat roughnessFactor = roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n",roughnessmap_pars_fragment:"\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform sampler2D roughnessMap;\n\n#endif\n",shadowmap_pars_fragment:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): create uniforms for area light shadows\n\n\t#endif\n\t*/\n\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n\t}\n\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n\t}\n\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n\t\tfloat occlusion = 1.0;\n\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\n\t\tfloat hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n\t\tif (hard_shadow != 1.0 ) {\n\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n\t\t}\n\t\treturn occlusion;\n\n\t}\n\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n\t\tfloat shadow = 1.0;\n\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\n\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#else // no percentage-closer filtering:\n\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#endif\n\n\t\t}\n\n\t\treturn shadow;\n\n\t}\n\n\t// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n\t// vector suitable for 2D texture mapping. This code uses the following layout for the\n\t// 2D texture:\n\t//\n\t// xzXZ\n\t//  y Y\n\t//\n\t// Y - Positive y direction\n\t// y - Negative y direction\n\t// X - Positive x direction\n\t// x - Negative x direction\n\t// Z - Positive z direction\n\t// z - Negative z direction\n\t//\n\t// Source and test bed:\n\t// https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\t\t// Number of texels to avoid at the edge of each square\n\n\t\tvec3 absV = abs( v );\n\n\t\t// Intersect unit cube\n\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\n\t\t// Apply scale to avoid seams\n\n\t\t// two texels less per square (one texel will do for NEAREST)\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\t\t// Unwrap\n\n\t\t// space: -1 ... 1 range for each square\n\t\t//\n\t\t// #X##\t\tdim    := ( 4 , 2 )\n\t\t//  # #\t\tcenter := ( 1 , 1 )\n\n\t\tvec2 planar = v.xy;\n\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\n\t\tif ( absV.z >= almostOne ) {\n\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\n\t\t} else if ( absV.x >= almostOne ) {\n\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\n\t\t} else if ( absV.y >= almostOne ) {\n\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\n\t\t}\n\n\t\t// Transform to UV space\n\n\t\t// scale := 0.5 / dim\n\t\t// translate := ( center + 0.5 ) / dim\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n\t}\n\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n\t\t// for point lights, the uniform @vShadowCoord is re-purposed to hold\n\t\t// the vector from the light to the world-space position of the fragment.\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\n\t\t// dp = normalized distance from light to fragment position\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n\t\tdp += shadowBias;\n\n\t\t// bd3D = base direction 3D\n\t\tvec3 bd3D = normalize( lightToPosition );\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#else // no percentage-closer filtering\n\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\n\t\t#endif\n\n\t}\n\n#endif\n",shadowmap_pars_vertex:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): uniforms for area light shadows\n\n\t#endif\n\t*/\n\n#endif\n",shadowmap_vertex:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update vAreaShadowCoord with area light info\n\n\t#endif\n\t*/\n\n#endif\n",shadowmask_pars_fragment:"\nfloat getShadowMask() {\n\n\tfloat shadow = 1.0;\n\n\t#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\tDirectionalLightShadow directionalLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\tSpotLightShadow spotLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\tPointLightShadow pointLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update shadow for Area light\n\n\t#endif\n\t*/\n\n\t#endif\n\n\treturn shadow;\n\n}\n",skinbase_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif\n",skinning_pars_vertex:"\n#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",skinning_vertex:"\n#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n\n#endif\n",skinnormal_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n\t#ifdef USE_TANGENT\n\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#endif\n\n#endif\n",specularmap_fragment:"\nfloat specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif\n",specularmap_pars_fragment:"\n#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif\n",tonemapping_fragment:"\n#if defined( TONE_MAPPING )\n\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n#endif\n",tonemapping_pars_fragment:"\n#ifndef saturate\n// <common> may have defined saturate() already\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\n\n// exposure only\nvec3 LinearToneMapping( vec3 color ) {\n\n\treturn toneMappingExposure * color;\n\n}\n\n// source: https://www.cs.utah.edu/~reinhard/cdrom/\nvec3 ReinhardToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n\n}\n\n// source: http://filmicgames.com/archives/75\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\n\t// John Hable's filmic operator from Uncharted 2 video game\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n\n}\n\n// source: http://filmicgames.com/archives/75\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\n\t// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n\n}\n\n// source: https://knarkowicz.wordpress.com/2016/01/06/aces-filmic-tone-mapping-curve/\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n\n}\n",uv_pars_fragment:"\n#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\n\tvarying vec2 vUv;\n\n#endif\n",uv_pars_vertex:"\n#ifdef USE_UV\n\n\t#ifdef UVS_VERTEX_ONLY\n\n\t\tvec2 vUv;\n\n\t#else\n\n\t\tvarying vec2 vUv;\n\n\t#endif\n\n\tuniform mat3 uvTransform;\n\n#endif\n",uv_vertex:"\n#ifdef USE_UV\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n#endif\n",uv2_pars_fragment:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvarying vec2 vUv2;\n\n#endif\n",uv2_pars_vertex:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\n\tuniform mat3 uv2Transform;\n\n#endif\n",uv2_vertex:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n\n#endif\n",worldpos_vertex:"\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\n\t#ifdef USE_INSTANCING\n\n\t\tworldPosition = instanceMatrix * worldPosition;\n\n\t#endif\n\n\tworldPosition = modelMatrix * worldPosition;\n\n#endif\n",background_frag:"\nuniform sampler2D t2D;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tvec4 texColor = texture2D( t2D, vUv );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",background_vert:"\nvarying vec2 vUv;\nuniform mat3 uvTransform;\n\nvoid main() {\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n\n}\n",cube_frag:"\n\n#include <envmap_common_pars_fragment>\nuniform float opacity;\n\nvarying vec3 vWorldDirection;\n\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",cube_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n}\n",depth_frag:"\n#if DEPTH_PACKING == 3200\n\n\tuniform float opacity;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tdiffuseColor.a = opacity;\n\n\t#endif\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\t#include <logdepthbuf_fragment>\n\n\t// Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\n\t#elif DEPTH_PACKING == 3201\n\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\n\t#endif\n\n}\n",depth_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n// This is used for computing an equivalent of gl_FragCoord.z that is as high precision as possible.\n// Some platforms compute gl_FragCoord at a lower precision which makes the manually computed value better for\n// depth-based postprocessing effects. Reproduced on iPad with A10 processor / iPadOS 13.3.1.\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvHighPrecisionZW = gl_Position.zw;\n\n}\n",distanceRGBA_frag:"\n#define DISTANCE\n\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main () {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist ); // clamp to [ 0, 1 ]\n\n\tgl_FragColor = packDepthToRGBA( dist );\n\n}\n",distanceRGBA_vert:"\n#define DISTANCE\n\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvWorldPosition = worldPosition.xyz;\n\n}\n",equirect_frag:"\nuniform sampler2D tEquirect;\n\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvec3 direction = normalize( vWorldDirection );\n\n\tvec2 sampleUV;\n\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",equirect_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n}\n",linedashed_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\nuniform float dashSize;\nuniform float totalSize;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\n\t\tdiscard;\n\n\t}\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\n\toutgoingLight = diffuseColor.rgb; // simple shader\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",linedashed_vert:"\nuniform float scale;\nattribute float lineDistance;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\tvLineDistance = scale * lineDistance;\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",meshbasic_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",meshbasic_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_ENVMAP\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshlambert_frag:"\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\n\t#endif\n\n\t#include <lightmap_fragment>\n\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\n\t#else\n\n\t\treflectedLight.directDiffuse = vLightFront;\n\n\t#endif\n\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"\n#define LAMBERT\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshmatcap_frag:"\n#define MATCAP\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\n\t#ifdef USE_MATCAP\n\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\n\t#else\n\n\t\tvec4 matcapColor = vec4( 1.0 );\n\n\t#endif\n\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",meshmatcap_vert:"\n#define MATCAP\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\t\tvNormal = normalize( transformedNormal );\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n}\n",meshtoon_frag:"\n#define TOON\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshtoon_vert:"\n#define TOON\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphong_frag:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphong_vert:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphysical_frag:"\n#define STANDARD\n\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t// this is a stub for the transparency model\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphysical_vert:"\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",normal_frag:"\n#define NORMAL\n\nuniform float opacity;\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\n}\n",normal_vert:"\n#define NORMAL\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvViewPosition = - mvPosition.xyz;\n\n#endif\n\n}\n",points_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",points_vert:"\nuniform float size;\nuniform float scale;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\n\tgl_PointSize = size;\n\n\t#ifdef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\n\t#endif\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n\n}\n",shadow_frag:"\nuniform vec3 color;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n\nvoid main() {\n\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",shadow_vert:"\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n\nvoid main() {\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",sprite_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",sprite_vert:"\nuniform float rotation;\nuniform vec2 center;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n\t#ifndef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\n\t#endif\n\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n\tmvPosition.xy += rotatedPosition;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n"},_a={basic:{uniforms:Ds([Lt.common,Lt.specularmap,Lt.envmap,Lt.aomap,Lt.lightmap,Lt.fog]),vertexShader:_.meshbasic_vert,fragmentShader:_.meshbasic_frag},lambert:{uniforms:Ds([Lt.common,Lt.specularmap,Lt.envmap,Lt.aomap,Lt.lightmap,Lt.emissivemap,Lt.fog,Lt.lights,{emissive:{value:new lt(0)}}]),vertexShader:_.meshlambert_vert,fragmentShader:_.meshlambert_frag},phong:{uniforms:Ds([Lt.common,Lt.specularmap,Lt.envmap,Lt.aomap,Lt.lightmap,Lt.emissivemap,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,Lt.fog,Lt.lights,{emissive:{value:new lt(0)},specular:{value:new lt(1118481)},shininess:{value:30}}]),vertexShader:_.meshphong_vert,fragmentShader:_.meshphong_frag},standard:{uniforms:Ds([Lt.common,Lt.envmap,Lt.aomap,Lt.lightmap,Lt.emissivemap,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,Lt.roughnessmap,Lt.metalnessmap,Lt.fog,Lt.lights,{emissive:{value:new lt(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:_.meshphysical_vert,fragmentShader:_.meshphysical_frag},toon:{uniforms:Ds([Lt.common,Lt.specularmap,Lt.aomap,Lt.lightmap,Lt.emissivemap,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,Lt.gradientmap,Lt.fog,Lt.lights,{emissive:{value:new lt(0)},specular:{value:new lt(1118481)},shininess:{value:30}}]),vertexShader:_.meshtoon_vert,fragmentShader:_.meshtoon_frag},matcap:{uniforms:Ds([Lt.common,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,Lt.fog,{matcap:{value:null}}]),vertexShader:_.meshmatcap_vert,fragmentShader:_.meshmatcap_frag},points:{uniforms:Ds([Lt.points,Lt.fog]),vertexShader:_.points_vert,fragmentShader:_.points_frag},dashed:{uniforms:Ds([Lt.common,Lt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:_.linedashed_vert,fragmentShader:_.linedashed_frag},depth:{uniforms:Ds([Lt.common,Lt.displacementmap]),vertexShader:_.depth_vert,fragmentShader:_.depth_frag},normal:{uniforms:Ds([Lt.common,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,{opacity:{value:1}}]),vertexShader:_.normal_vert,fragmentShader:_.normal_frag},sprite:{uniforms:Ds([Lt.sprite,Lt.fog]),vertexShader:_.sprite_vert,fragmentShader:_.sprite_frag},background:{uniforms:{uvTransform:{value:new Z},t2D:{value:null}},vertexShader:_.background_vert,fragmentShader:_.background_frag},cube:{uniforms:Ds([Lt.envmap,{opacity:{value:1}}]),vertexShader:_.cube_vert,fragmentShader:_.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:_.equirect_vert,fragmentShader:_.equirect_frag},distanceRGBA:{uniforms:Ds([Lt.common,Lt.displacementmap,{referencePosition:{value:new xt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:_.distanceRGBA_vert,fragmentShader:_.distanceRGBA_frag},shadow:{uniforms:Ds([Lt.lights,Lt.fog,{color:{value:new lt(0)},opacity:{value:1}}]),vertexShader:_.shadow_vert,fragmentShader:_.shadow_frag}};function Ea(o,e,s,i){var a,u,c=new lt(0),f=0,h=null,l=0,d=null;function v(t,n){e.buffers.color.setClear(t.r,t.g,t.b,n,i)}return{getClearColor:function(){return c},setClearColor:function(t,n){c.set(t),v(c,f=void 0!==n?n:1)},getClearAlpha:function(){return f},setClearAlpha:function(t){v(c,f=t)},render:function(t,n,e,i){var n=n.background,r=(r=o.xr).getSession&&r.getSession();null===(n=r&&"additive"===r.environmentBlendMode?null:n)?v(c,f):n&&n.isColor&&(v(n,1),i=!0),(o.autoClear||i)&&o.clear(o.autoClearColor,o.autoClearDepth,o.autoClearStencil),n&&(n.isCubeTexture||n.isWebGLCubeRenderTarget||n.mapping===Bn)?(void 0===u&&((u=new ba(new js(1,1,1),new Hs({type:"BackgroundCubeMaterial",uniforms:ks(_a.cube.uniforms),vertexShader:_a.cube.vertexShader,fragmentShader:_a.cube.fragmentShader,side:sn,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(t,n,e){this.matrixWorld.copyPosition(e.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(u)),r=n.isWebGLCubeRenderTarget?n.texture:n,u.material.uniforms.envMap.value=r,u.material.uniforms.flipEnvMap.value=r.isCubeTexture?-1:1,h===n&&l===r.version&&d===o.toneMapping||(u.material.needsUpdate=!0,h=n,l=r.version,d=o.toneMapping),t.unshift(u,u.geometry,u.material,0,0,null)):n&&n.isTexture&&(void 0===a&&((a=new ba(new Fs(2,2),new Hs({type:"BackgroundMaterial",uniforms:ks(_a.background.uniforms),vertexShader:_a.background.vertexShader,fragmentShader:_a.background.fragmentShader,side:on,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(a)),!0===(a.material.uniforms.t2D.value=n).matrixAutoUpdate&&n.updateMatrix(),a.material.uniforms.uvTransform.value.copy(n.matrix),h===n&&l===n.version&&d===o.toneMapping||(a.material.needsUpdate=!0,l=(h=n).version,d=o.toneMapping),t.unshift(a,a.geometry,a.material,0,0,null))}}}function Sa(s,a,u,t){var c,f=t.isWebGL2;this.setMode=function(t){c=t},this.render=function(t,n){s.drawArrays(c,t,n),u.update(n,c)},this.renderInstances=function(t,n,e,i){if(0!==i){var r,o;if(f)r=s,o="drawArraysInstanced";else if(o="drawArraysInstancedANGLE",null===(r=a.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");r[o](c,n,e,i),u.update(e,c,i)}}}function Ta(n,e,t){var i;function r(t){if("highp"===t){if(0<n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision&&0<n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision)return"highp";t="mediump"}return"mediump"===t&&0<n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision&&0<n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&n instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&n instanceof WebGL2ComputeRenderingContext,s=void 0!==t.precision?t.precision:"highp",a=r(s),a=(a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a),!0===t.logarithmicDepthBuffer),t=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),u=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),c=n.getParameter(n.MAX_TEXTURE_SIZE),f=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),h=n.getParameter(n.MAX_VERTEX_ATTRIBS),l=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),d=n.getParameter(n.MAX_VARYING_VECTORS),v=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),p=0<u,m=o||!!e.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){var t;return void 0===i&&(t=e.get("EXT_texture_filter_anisotropic"),i=null!==t?n.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0),i},getMaxPrecision:r,precision:s,logarithmicDepthBuffer:a,maxTextures:t,maxVertexTextures:u,maxTextureSize:c,maxCubemapSize:f,maxAttributes:h,maxVertexUniforms:l,maxVaryings:d,maxFragmentUniforms:v,vertexTextures:p,floatFragmentTextures:m,floatVertexTextures:p&&m,maxSamples:o?n.getParameter(n.MAX_SAMPLES):0}}function xa(){var c=this,f=null,h=0,l=!1,d=!1,v=new Gt,p=new Z,m={value:null,needsUpdate:!1};function y(){m.value!==f&&(m.value=f,m.needsUpdate=0<h),c.numPlanes=h,c.numIntersection=0}function b(t,n,e,i){var r=null!==t?t.length:0,o=null;if(0!==r){if(o=m.value,!0!==i||null===o){var i=e+4*r,s=n.matrixWorldInverse;p.getNormalMatrix(s),(null===o||o.length<i)&&(o=new Float32Array(i));for(var a=0,u=e;a!==r;++a,u+=4)v.copy(t[a]).applyMatrix4(s,p),v.normal.toArray(o,u),o[u+3]=v.constant}m.value=o,m.needsUpdate=!0}return c.numPlanes=r,c.numIntersection=0,o}this.uniform=m,this.numPlanes=0,this.numIntersection=0,this.init=function(t,n,e){var i=0!==t.length||n||0!==h||l;return l=n,f=b(t,e,0),h=t.length,i},this.beginShadows=function(){d=!0,b(null)},this.endShadows=function(){d=!1,y()},this.setState=function(t,n,e,i,r,o){if(!l||null===t||0===t.length||d&&!e)d?b(null):y();else{var e=d?0:h,s=4*e,a=r.clippingState||null;m.value=a;for(var a=b(t,i,s,o),u=0;u!==s;++u)a[u]=f[u];r.clippingState=a,this.numIntersection=n?this.numPlanes:0,this.numPlanes+=e}}}function Aa(e){var i={};return{get:function(t){if(void 0!==i[t])return i[t];var n;switch(t){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(t)}return null===n&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),i[t]=n}}}function Ma(h,l,i){var r=new WeakMap,d=new WeakMap;function o(t){var n,t=t.target,e=r.get(t);for(n in null!==e.index&&l.remove(e.index),e.attributes)l.remove(e.attributes[n]);t.removeEventListener("dispose",o),r.delete(t);t=d.get(e);t&&(l.remove(t),d.delete(e)),i.memory.geometries--}function s(t){var n=[],e=t.index,i=t.attributes.position,r=0;if(null!==e)for(var o=e.array,r=e.version,s=0,a=o.length;s<a;s+=3){var u=o[s+0],c=o[s+1],f=o[s+2];n.push(u,c,c,f,f,u)}else{o=i.array;r=i.version;for(s=0,a=o.length/3-1;s<a;s+=3){u=s+0,c=s+1,f=s+2;n.push(u,c,c,f,f,u)}}e=new(65535<ps(n)?ls:fs)(n,1),e.version=r,l.update(e,h.ELEMENT_ARRAY_BUFFER),i=d.get(t);i&&l.remove(i),d.set(t,e)}return{get:function(t,n){var e=r.get(n);return e||(n.addEventListener("dispose",o),n.isBufferGeometry?e=n:n.isGeometry&&(void 0===n.Zr&&(n.Zr=(new N).setFromObject(t)),e=n.Zr),r.set(n,e),i.memory.geometries++),e},update:function(t){var n=t.index,e=t.attributes;for(i in null!==n&&l.update(n,h.ELEMENT_ARRAY_BUFFER),e)l.update(e[i],h.ARRAY_BUFFER);var i,r=t.morphAttributes;for(i in r)for(var o=r[i],s=0,a=o.length;s<a;s++)l.update(o[s],h.ARRAY_BUFFER)},getWireframeAttribute:function(t){var n,e=d.get(t);return(!e||null!==(n=t.index)&&e.version<n.version)&&s(t),d.get(t)}}}function Oa(s,a,u,t){var c,f,h,l=t.isWebGL2;this.setMode=function(t){c=t},this.setIndex=function(t){f=t.type,h=t.bytesPerElement},this.render=function(t,n){s.drawElements(c,n,f,t*h),u.update(n,c)},this.renderInstances=function(t,n,e,i){if(0!==i){var r,o;if(l)r=s,o="drawElementsInstanced";else if(o="drawElementsInstancedANGLE",null===(r=a.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");r[o](c,e,f,n*h,i),u.update(e,c,i)}}}function La(i){var r={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:r,programs:null,autoReset:!0,reset:function(){r.frame++,r.calls=0,r.triangles=0,r.points=0,r.lines=0},update:function(t,n,e){switch(e=e||1,r.calls++,n){case i.TRIANGLES:r.triangles+=e*(t/3);break;case i.LINES:r.lines+=e*(t/2);break;case i.LINE_STRIP:r.lines+=e*(t-1);break;case i.LINE_LOOP:r.lines+=e*t;break;case i.POINTS:r.points+=e*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Ra(t,n){return Math.abs(n[1])-Math.abs(t[1])}function Na(v){var p={},m=new Float32Array(8);return{update:function(t,n,e,i){var r=t.morphTargetInfluences,o=void 0===r?0:r.length;if(void 0===(s=p[n.id])){for(var s=[],a=0;a<o;a++)s[a]=[a,0];p[n.id]=s}for(var u=e.morphTargets&&n.morphAttributes.position,c=e.morphNormals&&n.morphAttributes.normal,a=0;a<o;a++)0!==(f=s[a])[1]&&(u&&n.deleteAttribute("morphTarget"+a),c)&&n.deleteAttribute("morphNormal"+a);for(a=0;a<o;a++)(f=s[a])[0]=a,f[1]=r[a];s.sort(Ra);for(var f,h=0,a=0;a<8;a++){if(f=s[a]){var l=f[0],d=f[1];if(d){u&&n.setAttribute("morphTarget"+a,u[l]),c&&n.setAttribute("morphNormal"+a,c[l]),h+=m[a]=d;continue}}m[a]=0}t=n.morphTargetsRelative?1:1-h,i.getUniforms().setValue(v,"morphTargetBaseInfluence",t),i.getUniforms().setValue(v,"morphTargetInfluences",m)}}}function Pa(r,o,s,a){var u=new WeakMap;return{update:function(t){var n=a.render.frame,e=t.geometry,i=o.get(t,e);return u.get(i)!==n&&(e.isGeometry&&i.updateFromObject(t),o.update(i),u.set(i,n)),t.isInstancedMesh&&s.update(t.instanceMatrix,r.ARRAY_BUFFER),i},dispose:function(){u=new WeakMap}}}function ja(t,n,e,i,r,o,s,a,u,c){l.call(this,t=void 0!==t?t:[],n=void 0!==n?n:301,e,i,r,o,s=void 0!==s?s:fe,a,u,c),this.flipY=!1}function Fa(t,n,e,i){l.call(this,null),this.image={data:t||null,width:n||1,height:e||1,depth:i||1},this.magFilter=Vn,this.minFilter=Vn,this.wrapR=Xn,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function Ia(t,n,e,i){l.call(this,null),this.image={data:t||null,width:n||1,height:e||1,depth:i||1},this.magFilter=Vn,this.minFilter=Vn,this.wrapR=Xn,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}_a.physical={uniforms:Ds([_a.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Mt(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new lt(0)},transparency:{value:0}}]),vertexShader:_.meshphysical_vert,fragmentShader:_.meshphysical_frag},((ja.prototype=Object.create(l.prototype)).constructor=ja).prototype.isCubeTexture=!0,Object.defineProperty(ja.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),((Fa.prototype=Object.create(l.prototype)).constructor=Fa).prototype.isDataTexture2DArray=!0,((Ia.prototype=Object.create(l.prototype)).constructor=Ia).prototype.isDataTexture3D=!0;var Ca=new l,ka=new Fa,Da=new Ia,Ua=new ja,Ba=[],Ga=[],Ha=new Float32Array(16),Xa=new Float32Array(9),za=new Float32Array(4);function Va(t,n,e){var i=t[0];if(i<=0||0<i)return t;var r=n*e,o=Ba[r];if(void 0===o&&(o=new Float32Array(r),Ba[r]=o),0!==n){i.toArray(o,0);for(var s=1,a=0;s!==n;++s)t[s].toArray(o,a+=e)}return o}function Wa(t,n){if(t.length===n.length){for(var e=0,i=t.length;e<i;e++)if(t[e]!==n[e])return;return 1}}function Ya(t,n){for(var e=0,i=n.length;e<i;e++)t[e]=n[e]}function Qa(t,n){var e=Ga[n];void 0===e&&(e=new Int32Array(n),Ga[n]=e);for(var i=0;i!==n;++i)e[i]=t.allocateTextureUnit();return e}function Za(t,n){var e=this.cache;e[0]!==n&&(t.uniform1f(this.addr,n),e[0]=n)}function qa(t,n){var e=this.cache;void 0!==n.x?e[0]===n.x&&e[1]===n.y||(t.uniform2f(this.addr,n.x,n.y),e[0]=n.x,e[1]=n.y):Wa(e,n)||(t.uniform2fv(this.addr,n),Ya(e,n))}function Ka(t,n){var e=this.cache;void 0!==n.x?e[0]===n.x&&e[1]===n.y&&e[2]===n.z||(t.uniform3f(this.addr,n.x,n.y,n.z),e[0]=n.x,e[1]=n.y,e[2]=n.z):void 0!==n.r?e[0]===n.r&&e[1]===n.g&&e[2]===n.b||(t.uniform3f(this.addr,n.r,n.g,n.b),e[0]=n.r,e[1]=n.g,e[2]=n.b):Wa(e,n)||(t.uniform3fv(this.addr,n),Ya(e,n))}function Ja(t,n){var e=this.cache;void 0!==n.x?e[0]===n.x&&e[1]===n.y&&e[2]===n.z&&e[3]===n.w||(t.uniform4f(this.addr,n.x,n.y,n.z,n.w),e[0]=n.x,e[1]=n.y,e[2]=n.z,e[3]=n.w):Wa(e,n)||(t.uniform4fv(this.addr,n),Ya(e,n))}function $a(t,n){var e=this.cache,i=n.elements;void 0===i?Wa(e,n)||(t.uniformMatrix2fv(this.addr,!1,n),Ya(e,n)):Wa(e,i)||(za.set(i),t.uniformMatrix2fv(this.addr,!1,za),Ya(e,i))}function tu(t,n){var e=this.cache,i=n.elements;void 0===i?Wa(e,n)||(t.uniformMatrix3fv(this.addr,!1,n),Ya(e,n)):Wa(e,i)||(Xa.set(i),t.uniformMatrix3fv(this.addr,!1,Xa),Ya(e,i))}function nu(t,n){var e=this.cache,i=n.elements;void 0===i?Wa(e,n)||(t.uniformMatrix4fv(this.addr,!1,n),Ya(e,n)):Wa(e,i)||(Ha.set(i),t.uniformMatrix4fv(this.addr,!1,Ha),Ya(e,i))}function eu(t,n,e){var i=this.cache,r=e.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),e.safeSetTexture2D(n||Ca,r)}function iu(t,n,e){var i=this.cache,r=e.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),e.setTexture2DArray(n||ka,r)}function ru(t,n,e){var i=this.cache,r=e.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),e.setTexture3D(n||Da,r)}function ou(t,n,e){var i=this.cache,r=e.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),e.safeSetTextureCube(n||Ua,r)}function su(t,n){var e=this.cache;e[0]!==n&&(t.uniform1i(this.addr,n),e[0]=n)}function au(t,n){var e=this.cache;Wa(e,n)||(t.uniform2iv(this.addr,n),Ya(e,n))}function uu(t,n){var e=this.cache;Wa(e,n)||(t.uniform3iv(this.addr,n),Ya(e,n))}function cu(t,n){var e=this.cache;Wa(e,n)||(t.uniform4iv(this.addr,n),Ya(e,n))}function fu(t,n){var e=this.cache;e[0]!==n&&(t.uniform1ui(this.addr,n),e[0]=n)}function hu(t,n){t.uniform1fv(this.addr,n)}function lu(t,n){t.uniform1iv(this.addr,n)}function du(t,n){t.uniform2iv(this.addr,n)}function vu(t,n){t.uniform3iv(this.addr,n)}function pu(t,n){t.uniform4iv(this.addr,n)}function mu(t,n){n=Va(n,this.size,2);t.uniform2fv(this.addr,n)}function yu(t,n){n=Va(n,this.size,3);t.uniform3fv(this.addr,n)}function bu(t,n){n=Va(n,this.size,4);t.uniform4fv(this.addr,n)}function gu(t,n){n=Va(n,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function wu(t,n){n=Va(n,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function _u(t,n){n=Va(n,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Eu(t,n,e){var i=n.length,r=Qa(e,i);t.uniform1iv(this.addr,r);for(var o=0;o!==i;++o)e.safeSetTexture2D(n[o]||Ca,r[o])}function Su(t,n,e){var i=n.length,r=Qa(e,i);t.uniform1iv(this.addr,r);for(var o=0;o!==i;++o)e.safeSetTextureCube(n[o]||Ua,r[o])}function Tu(t,n,e){this.id=t,this.addr=e,this.cache=[],this.setValue=function(t){switch(t){case 5126:return Za;case 35664:return qa;case 35665:return Ka;case 35666:return Ja;case 35674:return $a;case 35675:return tu;case 35676:return nu;case 5124:case 35670:return su;case 35667:case 35671:return au;case 35668:case 35672:return uu;case 35669:case 35673:return cu;case 5125:return fu;case 35678:case 36198:case 36298:case 36306:case 35682:return eu;case 35679:case 36299:case 36307:return ru;case 35680:case 36300:case 36308:case 36293:return ou;case 36289:case 36303:case 36311:case 36292:return iu}}(n.type)}function xu(t,n,e){this.id=t,this.addr=e,this.cache=[],this.size=n.size,this.setValue=function(t){switch(t){case 5126:return hu;case 35664:return mu;case 35665:return yu;case 35666:return bu;case 35674:return gu;case 35675:return wu;case 35676:return _u;case 5124:case 35670:return lu;case 35667:case 35671:return du;case 35668:case 35672:return vu;case 35669:case 35673:return pu;case 35678:case 36198:case 36298:case 36306:case 35682:return Eu;case 35680:case 36300:case 36308:case 36293:return Su}}(n.type)}function Au(t){this.id=t,this.seq=[],this.map={}}xu.prototype.updateCache=function(t){var n=this.cache;t instanceof Float32Array&&n.length!==t.length&&(this.cache=new Float32Array(t.length)),Ya(n,t)},Au.prototype.setValue=function(t,n,e){for(var i=this.seq,r=0,o=i.length;r!==o;++r){var s=i[r];s.setValue(t,n[s.id],e)}};var Mu=/([\w\d_]+)(\])?(\[|\.)?/g;function Ou(t,n){t.seq.push(n),t.map[n.id]=n}function Lu(t,n){this.seq=[],this.map={};for(var e=t.getProgramParameter(n,t.ACTIVE_UNIFORMS),i=0;i<e;++i){var r=t.getActiveUniform(n,i),o=t.getUniformLocation(n,r.name),s=(v=d=l=h=f=c=u=a=s=void 0,r),a=o,u=this,c=s.name,f=c.length;for(Mu.lastIndex=0;;){var h=Mu.exec(c),l=Mu.lastIndex,d=h[1],v="]"===h[2],h=h[3];if(v&&(d|=0),void 0===h||"["===h&&l+2===f){Ou(u,new(void 0===h?Tu:xu)(d,s,a));break}v=u.map[d];void 0===v&&Ou(u,v=new Au(d)),u=v}}}function Ru(t,n,e){n=t.createShader(n);return t.shaderSource(n,e),t.compileShader(n),n}Lu.prototype.setValue=function(t,n,e,i){n=this.map[n];void 0!==n&&n.setValue(t,e,i)},Lu.prototype.setOptional=function(t,n,e){n=n[e];void 0!==n&&this.setValue(t,e,n)},Lu.upload=function(t,n,e,i){for(var r=0,o=n.length;r!==o;++r){var s=n[r],a=e[s.id];!1!==a.needsUpdate&&s.setValue(t,a.value,i)}},Lu.seqWithValue=function(t,n){for(var e=[],i=0,r=t.length;i!==r;++i){var o=t[i];o.id in n&&e.push(o)}return e};var Nu=0;function Pu(t){switch(t){case li:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+t)}}function ju(t,n,e){var i=t.getShaderParameter(n,t.COMPILE_STATUS),r=t.getShaderInfoLog(n).trim();return i&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+e+"\n"+r+function(t){for(var n=t.split("\n"),e=0;e<n.length;e++)n[e]=e+1+": "+n[e];return n.join("\n")}(t.getShaderSource(n))}function Fu(t,n){n=Pu(n);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Iu(t){return""!==t}function Cu(t,n){return t.replace(/NUM_DIR_LIGHTS/g,n.numDirLights).replace(/NUM_SPOT_LIGHTS/g,n.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,n.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,n.numPointLights).replace(/NUM_HEMI_LIGHTS/g,n.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,n.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,n.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,n.numPointLightShadows)}function ku(t,n){return t.replace(/NUM_CLIPPING_PLANES/g,n.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,n.numClippingPlanes-n.numClipIntersection)}var Du=/^[ \t]*#include +<([\w\d./]+)>/gm;function Uu(t){return t.replace(Du,Bu)}function Bu(t,n){var e=_[n];if(void 0===e)throw new Error("Can not resolve #include <"+n+">");return Uu(e)}var Gu=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Hu=/#pragma unroll_loop_start[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g;function Xu(t){return t.replace(Hu,Vu).replace(Gu,zu)}function zu(t,n,e,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Vu(0,n,e,i)}function Vu(t,n,e,i){for(var r="",o=parseInt(n);o<parseInt(e);o++)r+=i.replace(/\[ i \]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function Wu(t){var n="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?n+="\n#define HIGH_PRECISION":"mediump"===t.precision?n+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(n+="\n#define LOW_PRECISION"),n}function Yu(t,n,e){var i,r,o,s,a,u,c=t.getContext(),f=e.defines,h=e.vertexShader,l=e.fragmentShader,d=(v="SHADOWMAP_TYPE_BASIC",(d=e).shadowMapType===en?v="SHADOWMAP_TYPE_PCF":2===d.shadowMapType?v="SHADOWMAP_TYPE_PCF_SOFT":d.shadowMapType===rn&&(v="SHADOWMAP_TYPE_VSM"),v),v=function(t){var n="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case 301:case 302:n="ENVMAP_TYPE_CUBE";break;case Bn:case Gn:n="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:n="ENVMAP_TYPE_EQUIREC";break;case 305:n="ENVMAP_TYPE_SPHERE"}return n}(e),p=function(t){var n="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case 302:case 304:n="ENVMAP_MODE_REFRACTION"}return n}(e),m=function(t){var n="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Dn:n="ENVMAP_BLENDING_MULTIPLY";break;case 1:n="ENVMAP_BLENDING_MIX";break;case 2:n="ENVMAP_BLENDING_ADD"}return n}(e),y=0<t.gammaFactor?t.gammaFactor:1,b=e.isWebGL2?"":(g=[(b=e).extensionDerivatives||b.envMapCubeUV||b.bumpMap||b.tangentSpaceNormalMap||b.clearcoatNormalMap||b.flatShading||"physical"===b.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(b.extensionFragDepth||b.logarithmicDepthBuffer)&&b.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",b.extensionDrawBuffers&&b.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(b.extensionShaderTextureLOD||b.envMap)&&b.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""],"FMMeshStandardMaterial"===b.shaderName&&g.push("#extension GL_OES_standard_derivatives : enable"),g.filter(Iu).join("\n")),g=function(t){var n,e=[];for(n in t){var i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}(f),w=c.createProgram(),m=(e.isRawShaderMaterial?(0<(i=[g].filter(Iu).join("\n")).length&&(i+="\n"),0<(r=[b,g].filter(Iu).join("\n")).length&&(r+="\n")):(i=[Wu(e),"#define SHADER_NAME "+e.shaderName,g,e.instancing?"#define USE_INSTANCING":"",e.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+y,"#define MAX_BONES "+e.maxBones,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+p:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.displacementMap&&e.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.useVertexTexture?"#define BONE_TEXTURE":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&!1===e.flatShading?"#define USE_MORPHNORMALS":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+d:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Iu).join("\n"),r=[b,Wu(e),"#define SHADER_NAME "+e.shaderName,g,e.alphaTest?"#define ALPHATEST "+e.alphaTest+(e.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+y,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+v:"",e.envMap?"#define "+p:"",e.envMap?"#define "+m:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.sheen?"#define USE_SHEEN":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+d:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",e.toneMapping!==Un?"#define TONE_MAPPING":"",e.toneMapping!==Un?_.tonemapping_pars_fragment:"",e.toneMapping!==Un?function(t,n){var e;switch(n){case 1:e="Linear";break;case 2:e="Reinhard";break;case 3:e="Uncharted2";break;case 4:e="OptimizedCineon";break;case 5:e="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+n)}return"vec3 "+t+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.outputEncoding||e.mapEncoding||e.matcapEncoding||e.envMapEncoding||e.emissiveMapEncoding||e.lightMapEncoding?_.encodings_pars_fragment:"",e.mapEncoding?Fu("mapTexelToLinear",e.mapEncoding):"",e.matcapEncoding?Fu("matcapTexelToLinear",e.matcapEncoding):"",e.envMapEncoding?Fu("envMapTexelToLinear",e.envMapEncoding):"",e.emissiveMapEncoding?Fu("emissiveMapTexelToLinear",e.emissiveMapEncoding):"",e.lightMapEncoding?Fu("lightMapTexelToLinear",e.lightMapEncoding):"",e.outputEncoding?(f="linearToOutputTexel",y=Pu(y=e.outputEncoding),"vec4 "+f+"( vec4 value ) { return LinearTo"+y[0]+y[1]+"; }"):"",e.depthPacking?"#define DEPTH_PACKING "+e.depthPacking:"","\n"].filter(Iu).join("\n")),h=ku(h=Cu(h=Uu(h),e),e),l=ku(l=Cu(l=Uu(l),e),e),h=Xu(h),l=Xu(l),e.isWebGL2&&!e.isRawShaderMaterial&&(v=!1,p=/^\s*#version\s+300\s+es\s*\n/,e.isShaderMaterial&&null!==h.match(p)&&null!==l.match(p)&&(v=!0,h=h.replace(p,""),l=l.replace(p,"")),i=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+i,r=["#version 300 es\n","#define varying in",v?"":"out highp vec4 pc_fragColor;",v?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+r),i+h),d=r+l,f=Ru(c,c.VERTEX_SHADER,m),y=Ru(c,c.FRAGMENT_SHADER,d);return c.attachShader(w,f),c.attachShader(w,y),void 0!==e.index0AttributeName?c.bindAttribLocation(w,0,e.index0AttributeName):!0===e.morphTargets&&c.bindAttribLocation(w,0,"position"),c.linkProgram(w),t.debug.checkShaderErrors&&(p=c.getProgramInfoLog(w).trim(),v=c.getShaderInfoLog(f).trim(),h=c.getShaderInfoLog(y).trim(),!(t=l=!0)===c.getProgramParameter(w,c.LINK_STATUS)?(l=!1,o=ju(c,f,"vertex"),s=ju(c,y,"fragment"),console.error("THREE.WebGLProgram: shader error: ",c.getError(),"gl.VALIDATE_STATUS",c.getProgramParameter(w,c.VALIDATE_STATUS),"gl.getProgramInfoLog",p,o,s)):""!==p?(console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",p),st.a.environment===G.a.WX&&(""!==v&&(console.error("vertexLog",v),console.error("vertexGlsl",m)),""!==h)&&(console.error("fragmentLog",h),console.error("fragmentGlsl",d))):""!==v&&""!==h||(t=!1),t)&&(this.diagnostics={runnable:l,programLog:p,vertexShader:{log:v,prefix:i},fragmentShader:{log:h,prefix:r}}),c.detachShader(w,f),c.detachShader(w,y),c.deleteShader(f),c.deleteShader(y),this.getUniforms=function(){return a=void 0===a?new Lu(c,w):a},this.getAttributes=function(){return u=void 0===u?function(t,n){for(var e={},i=t.getProgramParameter(n,t.ACTIVE_ATTRIBUTES),r=0;r<i;r++){var o=t.getActiveAttrib(n,r).name;e[o]=t.getAttribLocation(n,o)}return e}(c,w):u},this.destroy=function(){c.deleteProgram(w),this.program=void 0},this.name=e.shaderName,this.id=Nu++,this.cacheKey=n,this.usedTimes=1,this.program=w,this.vertexShader=f,this.fragmentShader=y,this}function Qu(d,v,p){var s=[],m=p.isWebGL2,y=p.logarithmicDepthBuffer,b=p.floatVertexTextures,g=p.precision,w=p.maxVertexUniforms,_=p.vertexTextures,E={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},r=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function S(t){var n;return t?t.isTexture?n=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),n=t.texture.encoding):n=li,n}this.getParameters=function(t,n,e,i,r,o,s){var a,u=i.fog,i=t.isMeshStandardMaterial?i.environment:null,i=t.envMap||i,c=E[t.type],f=s.isSkinnedMesh?(f=(f=s).skeleton.bones,b?1024:(a=Math.floor((w-20)/4),(a=Math.min(a,f.length))<f.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+f.length+" bones. This GPU supports "+a+"."),0):a)):0,h=(null!==t.precision&&(g=p.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",g,"instead."),a=t,(h=c)?(h=_a[h],{name:a.type,uniforms:Us.clone(h.uniforms),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader}):{name:a.type,uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),l=(t.onBeforeCompile(h,d),d.getRenderTarget());return{isWebGL2:m,shaderID:c,shaderName:h.name,uniforms:h.uniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,defines:t.defines,isRawShaderMaterial:t.isRawShaderMaterial,isShaderMaterial:t.isShaderMaterial,precision:g,instancing:!0===s.isInstancedMesh,supportsVertexTextures:_,outputEncoding:null!==l?S(l.texture):d.outputEncoding,map:!!t.map,mapEncoding:S(t.map),matcap:!!t.matcap,matcapEncoding:S(t.matcap),envMap:!!i,envMapMode:i&&i.mapping,envMapEncoding:S(i),envMapCubeUV:!!i&&(i.mapping===Bn||i.mapping===Gn),lightMap:!!t.lightMap,lightMapEncoding:S(t.lightMap),aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:S(t.emissiveMap),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:t.normalMapType===mi,tangentSpaceNormalMap:t.normalMapType===pi,clearcoatMap:!!t.clearcoatMap,clearcoatRoughnessMap:!!t.clearcoatRoughnessMap,clearcoatNormalMap:!!t.clearcoatNormalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,sheen:!!t.sheen,combine:t.combine,vertexTangents:t.normalMap&&t.vertexTangents,vertexColors:t.vertexColors,vertexUvs:!!(t.map||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t.emissiveMap||t.roughnessMap||t.metalnessMap||t.clearcoatMap||t.clearcoatRoughnessMap||t.clearcoatNormalMap||t.displacementMap),uvsVertexOnly:!(t.map||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t.emissiveMap||t.roughnessMap||t.metalnessMap||t.clearcoatNormalMap||!t.displacementMap),fog:!!u,useFog:t.fog,fogExp2:u&&u.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:y,skinning:t.skinning&&0<f,maxBones:f,useVertexTexture:b,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:d.maxMorphTargets,maxMorphNormals:d.maxMorphNormals,numDirLights:n.directional.length,numPointLights:n.point.length,numSpotLights:n.spot.length,numRectAreaLights:n.rectArea.length,numHemiLights:n.hemi.length,numDirLightShadows:n.directionalShadowMap.length,numPointLightShadows:n.pointShadowMap.length,numSpotLightShadows:n.spotShadowMap.length,numClippingPlanes:r,numClipIntersection:o,dithering:t.dithering,shadowMapEnabled:d.shadowMap.enabled&&0<e.length,shadowMapType:d.shadowMap.type,toneMapping:t.toneMapped?d.toneMapping:Un,physicallyCorrectLights:d.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===an,flipSided:t.side===sn,depthPacking:void 0!==t.depthPacking&&t.depthPacking,index0AttributeName:t.index0AttributeName,extensionDerivatives:t.extensions&&t.extensions.derivatives,extensionFragDepth:t.extensions&&t.extensions.fragDepth,extensionDrawBuffers:t.extensions&&t.extensions.drawBuffers,extensionShaderTextureLOD:t.extensions&&t.extensions.shaderTextureLOD,rendererExtensionFragDepth:m||null!==v.get("EXT_frag_depth"),rendererExtensionDrawBuffers:m||null!==v.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:m||null!==v.get("EXT_shader_texture_lod"),onBeforeCompile:t.onBeforeCompile}},this.getProgramCacheKey=function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var e in t.defines)n.push(e),n.push(t.defines[e]);if(void 0===t.isRawShaderMaterial){for(var i=0;i<r.length;i++)n.push(t[r[i]]);n.push(d.outputEncoding),n.push(d.gammaFactor)}return n.push(t.onBeforeCompile.toString()),n.join()},this.acquireProgram=function(t,n){for(var e,i=0,r=s.length;i<r;i++){var o=s[i];if(o.cacheKey===n){++(e=o).usedTimes;break}}return void 0===e&&(e=new Yu(d,n,t),s.push(e)),e},this.releaseProgram=function(t){var n;0==--t.usedTimes&&(n=s.indexOf(t),s[n]=s[s.length-1],s.pop(),t.destroy())},this.programs=s}function Zu(){var i=new WeakMap;return{get:function(t){var n=i.get(t);return void 0===n&&i.set(t,n={}),n},remove:function(t){i.delete(t)},update:function(t,n,e){i.get(t)[n]=e},dispose:function(){i=new WeakMap}}}function qu(t,n){return t.groupOrder!==n.groupOrder?t.groupOrder-n.groupOrder:t.renderOrder!==n.renderOrder?t.renderOrder-n.renderOrder:t.program!==n.program?t.program.id-n.program.id:t.material.id!==n.material.id?t.material.id-n.material.id:t.z!==n.z?t.z-n.z:t.id-n.id}function Ku(t,n){return t.groupOrder!==n.groupOrder?t.groupOrder-n.groupOrder:t.renderOrder!==n.renderOrder?t.renderOrder-n.renderOrder:t.z!==n.z?n.z-t.z:t.id-n.id}function Ju(){var a=[],u=0,s=[],c=[],f={id:-1};function h(t,n,e,i,r,o){var s=a[u];return void 0===s?(s={id:t.id,object:t,geometry:n,material:e,program:e.program||f,groupOrder:i,renderOrder:t.renderOrder,z:r,group:o},a[u]=s):(s.id=t.id,s.object=t,s.geometry=n,s.material=e,s.program=e.program||f,s.groupOrder=i,s.renderOrder=t.renderOrder,s.z=r,s.group=o),u++,s}return{opaque:s,transparent:c,init:function(){u=0,c.length=s.length=0},push:function(t,n,e,i,r,o){n=h(t,n,e,i,r,o),(!1!==t.userData.transparent&&!0===e.transparent?c:s).push(n)},unshift:function(t,n,e,i,r,o){n=h(t,n,e,i,r,o),!1===t.userData.transparent?s.push(n):(!0===e.transparent?c:s).unshift(n)},finish:function(){for(var t=u,n=a.length;t<n;t++){var e=a[t];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.program=null,e.group=null}},sort:function(t,n){1<s.length&&s.sort(t||qu),1<c.length&&c.sort(n||Ku)}}}function $u(){var r=new WeakMap;function o(t){t=t.target;t.removeEventListener("dispose",o),r.delete(t)}return{get:function(t,n){var e,i=r.get(t);return void 0===i?(e=new Ju,r.set(t,new WeakMap),r.get(t).set(n,e),t.addEventListener("dispose",o)):void 0===(e=i.get(n))&&(e=new Ju,i.set(n,e)),e},dispose:function(){r=new WeakMap}}}function tc(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new xt,color:new lt};break;case"SpotLight":n={position:new xt,direction:new xt,color:new lt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new xt,color:new lt,distance:0,decay:0};break;case"HemisphereLight":n={direction:new xt,skyColor:new lt,groundColor:new lt};break;case"RectAreaLight":n={color:new lt,position:new xt,halfWidth:new xt,halfHeight:new xt}}return e[t.id]=n}}}var nc=0;function ec(t,n){return(n.castShadow?1:0)-(t.castShadow?1:0)}function ic(){for(var e,A=new tc,M=(e={},{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowRadius:1,shadowMapSize:new Mt};break;case"PointLight":n={shadowBias:0,shadowRadius:1,shadowMapSize:new Mt,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n}}),O={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},t=0;t<9;t++)O.probe.push(new xt);var L=new xt,R=new At,N=new At;return{setup:function(t,n,e){for(var i=0,r=0,o=0,s=0;s<9;s++)O.probe[s].set(0,0,0);var a=0,u=0,c=0,f=0,h=0,l=0,d=0,v=0,p=e.matrixWorldInverse;t.sort(ec);for(var s=0,m=t.length;s<m;s++){var y,b,g,w=t[s],_=w.color,E=w.intensity,S=w.distance,T=w.shadow&&w.shadow.map?w.shadow.map.texture:null;if(w.isAmbientLight)i+=_.r*E,r+=_.g*E,o+=_.b*E;else if(w.isLightProbe)for(var x=0;x<9;x++)O.probe[x].addScaledVector(w.sh.coefficients[x],E);else w.isDirectionalLight?((g=A.get(w)).color.copy(w.color).multiplyScalar(w.intensity),g.direction.setFromMatrixPosition(w.matrixWorld),L.setFromMatrixPosition(w.target.matrixWorld),g.direction.sub(L),g.direction.transformDirection(p),w.castShadow&&(y=w.shadow,(b=M.get(w)).shadowBias=y.bias,b.shadowRadius=y.radius,b.shadowMapSize=y.mapSize,O.directionalShadow[a]=b,O.directionalShadowMap[a]=T,O.directionalShadowMatrix[a]=w.shadow.matrix,l++),O.directional[a]=g,a++):w.isSpotLight?((g=A.get(w)).position.setFromMatrixPosition(w.matrixWorld),g.position.applyMatrix4(p),g.color.copy(_).multiplyScalar(E),g.distance=S,g.direction.setFromMatrixPosition(w.matrixWorld),L.setFromMatrixPosition(w.target.matrixWorld),g.direction.sub(L),g.direction.transformDirection(p),g.coneCos=Math.cos(w.angle),g.penumbraCos=Math.cos(w.angle*(1-w.penumbra)),g.decay=w.decay,w.castShadow&&(y=w.shadow,(b=M.get(w)).shadowBias=y.bias,b.shadowRadius=y.radius,b.shadowMapSize=y.mapSize,O.spotShadow[c]=b,O.spotShadowMap[c]=T,O.spotShadowMatrix[c]=w.shadow.matrix,v++),O.spot[c]=g,c++):w.isRectAreaLight?((g=A.get(w)).color.copy(_).multiplyScalar(E),g.position.setFromMatrixPosition(w.matrixWorld),g.position.applyMatrix4(p),N.identity(),R.copy(w.matrixWorld),R.premultiply(p),N.extractRotation(R),g.halfWidth.set(.5*w.width,0,0),g.halfHeight.set(0,.5*w.height,0),g.halfWidth.applyMatrix4(N),g.halfHeight.applyMatrix4(N),O.rectArea[f]=g,f++):w.isPointLight?((g=A.get(w)).position.setFromMatrixPosition(w.matrixWorld),g.position.applyMatrix4(p),g.color.copy(w.color).multiplyScalar(w.intensity),g.distance=w.distance,g.decay=w.decay,w.castShadow&&(y=w.shadow,(b=M.get(w)).shadowBias=y.bias,b.shadowRadius=y.radius,b.shadowMapSize=y.mapSize,b.shadowCameraNear=y.camera.near,b.shadowCameraFar=y.camera.far,O.pointShadow[u]=b,O.pointShadowMap[u]=T,O.pointShadowMatrix[u]=w.shadow.matrix,d++),O.point[u]=g,u++):w.isHemisphereLight&&((g=A.get(w)).direction.setFromMatrixPosition(w.matrixWorld),g.direction.transformDirection(p),g.direction.normalize(),g.skyColor.copy(w.color).multiplyScalar(E),g.groundColor.copy(w.groundColor).multiplyScalar(E),O.hemi[h]=g,h++)}O.ambient[0]=i,O.ambient[1]=r,O.ambient[2]=o,(e=O.hash).directionalLength===a&&e.pointLength===u&&e.spotLength===c&&e.rectAreaLength===f&&e.hemiLength===h&&e.numDirectionalShadows===l&&e.numPointShadows===d&&e.numSpotShadows===v||(O.directional.length=a,O.spot.length=c,O.rectArea.length=f,O.point.length=u,O.hemi.length=h,O.directionalShadow.length=l,O.directionalShadowMap.length=l,O.pointShadow.length=d,O.pointShadowMap.length=d,O.spotShadow.length=v,O.spotShadowMap.length=v,O.directionalShadowMatrix.length=l,O.pointShadowMatrix.length=d,O.spotShadowMatrix.length=v,e.directionalLength=a,e.pointLength=u,e.spotLength=c,e.rectAreaLength=f,e.hemiLength=h,e.numDirectionalShadows=l,e.numPointShadows=d,e.numSpotShadows=v,O.version=nc++)},state:O}}function rc(){var n=new ic,e=[],i=[];return{init:function(){e.length=0,i.length=0},state:{lightsArray:e,shadowsArray:i,lights:n},setupLights:function(t){n.setup(e,i,t)},pushLight:function(t){e.push(t)},pushShadow:function(t){i.push(t)}}}function oc(){var i=new WeakMap;function r(t){t=t.target;t.removeEventListener("dispose",r),i.delete(t)}return{get:function(t,n){var e;return!1===i.has(t)?(e=new rc,i.set(t,new WeakMap),i.get(t).set(n,e),t.addEventListener("dispose",r)):!1===i.get(t).has(n)?(e=new rc,i.get(t).set(n,e)):e=i.get(t).get(n),e},dispose:function(){i=new WeakMap}}}function sc(t,n,e){this.width=t,this.height=n,this.scissor=new Ot(0,0,t,n),this.scissorTest=!1,this.viewport=new Ot(0,0,t,n),this.texture=new l(void 0,(e=e||{}).mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=n,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:B,this.depthBuffer=void 0===e.depthBuffer||e.depthBuffer,this.stencilBuffer=void 0===e.stencilBuffer||e.stencilBuffer,this.depthTexture=void 0!==e.depthTexture?e.depthTexture:null}function ac(t){h.call(this),this.type="MeshDepthMaterial",this.depthPacking=di,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function uc(t){h.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new xt,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}sc.prototype=Object.assign(Object.create(D.prototype),{constructor:sc,isWebGLRenderTarget:!0,setSize:function(t,n){this.width===t&&this.height===n||(this.width=t,this.height=n,this.texture.image.width=t,this.texture.image.height=n,this.dispose()),this.viewport.set(0,0,t,n),this.scissor.set(0,0,t,n)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),((ac.prototype=Object.create(h.prototype)).constructor=ac).prototype.isMeshDepthMaterial=!0,ac.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},((uc.prototype=Object.create(h.prototype)).constructor=uc).prototype.isMeshDistanceMaterial=!0,uc.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};var cc="\nuniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n\n#include <packing>\n\nvoid main() {\n\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\n\t// This seems totally useless but it's a crazy work around for a Adreno compiler bug\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\n    #ifdef HORIZONAL_PASS\n\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\n    #else\n\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n\n    #endif\n\n  }\n\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n\n  float std_dev = sqrt( squared_mean - mean * mean );\n\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n\n}\n",fc="\n\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n\n";function hc(b,g,w){var _=new zt,E=new Mt,S=new Mt,T=new Ot,r=[],o=[],h={},l={0:sn,1:on,2:an},x=new Hs({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Mt},radius:{value:4}},vertexShader:fc,fragmentShader:cc}),A=x.clone(),t=(A.defines.HORIZONAL_PASS=1,new N),M=(t.setAttribute("position",new R(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3)),new ba(t,x)),O=this;function d(t,n,e){var e=t<<0|n<<1|e<<2,i=r[e];return void 0===i&&(i=new ac({depthPacking:vi,morphTargets:t,skinning:n}),r[e]=i),i}function v(t,n,e){var e=t<<0|n<<1|e<<2,i=o[e];return void 0===i&&(i=new uc({morphTargets:t,skinning:n}),o[e]=i),i}function L(t,n,e,i,r,o){var s,a=t.geometry,u=null,c=d,f=t.customDepthMaterial;return!0===e.isPointLight&&(c=v,f=t.customDistanceMaterial),u=void 0===f?(!(s=!1)===n.morphTargets&&(!0===a.isBufferGeometry?s=a.morphAttributes&&a.morphAttributes.position&&0<a.morphAttributes.position.length:!0===a.isGeometry&&(s=a.morphTargets&&0<a.morphTargets.length)),!(a=!1)===t.isSkinnedMesh&&(!0===n.skinning?a=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),c(s,a,!0===t.isInstancedMesh)):f,b.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length&&(c=u.uuid,s=n.uuid,void 0===(a=h[c])&&(h[c]=a={}),void 0===(t=a[s])&&(t=u.clone(),a[s]=t),u=t),u.visible=n.visible,u.wireframe=n.wireframe,u.side=o===rn?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:l[n.side],u.clipShadows=n.clipShadows,u.clippingPlanes=n.clippingPlanes,u.clipIntersection=n.clipIntersection,u.wireframeLinewidth=n.wireframeLinewidth,u.linewidth=n.linewidth,!0===e.isPointLight&&!0===u.isMeshDistanceMaterial&&(u.referencePosition.setFromMatrixPosition(e.matrixWorld),u.nearDistance=i,u.farDistance=r),u}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=en,this.render=function(t,n,e){if(!1!==O.enabled&&(!1!==O.autoUpdate||!1!==O.needsUpdate)&&0!==t.length){var i=b.getRenderTarget(),r=b.getActiveCubeFace(),o=b.getActiveMipmapLevel(),s=b.state;s.setBlending(un),s.buffers.color.setClear(1,1,1,1),s.buffers.depth.setTest(!0),s.setScissorTest(!1);for(var a,u,c=0,f=t.length;c<f;c++){var h=t[c],l=h.shadow;if(void 0===l)console.warn("THREE.WebGLShadowMap:",h,"has no shadow.");else{E.copy(l.mapSize);for(var d,v=l.getFrameExtents(),p=(E.multiply(v),S.copy(l.mapSize),(E.x>w||E.y>w)&&(console.warn("THREE.WebGLShadowMap:",h,"has shadow exceeding max texture size, reducing"),E.x>w&&(S.x=Math.floor(w/v.x),E.x=S.x*v.x,l.mapSize.x=S.x),E.y>w)&&(S.y=Math.floor(w/v.y),E.y=S.y*v.y,l.mapSize.y=S.y),null!==l.map||l.isPointLightShadow||this.type!==rn||(l.map=new sc(E.x,E.y,d={minFilter:B,magFilter:B,format:he}),l.map.texture.name=h.name+".shadowMap",l.mapPass=new sc(E.x,E.y,d),l.camera.updateProjectionMatrix()),null===l.map&&(l.map=new sc(E.x,E.y,d={minFilter:Vn,magFilter:Vn,format:he}),l.map.texture.name=h.name+".shadowMap",l.camera.updateProjectionMatrix()),b.setRenderTarget(l.map),b.clear(),l.getViewportCount()),m=0;m<p;m++){var y=l.getViewport(m);T.set(S.x*y.x,S.y*y.y,S.x*y.z,S.y*y.w),s.viewport(T),l.updateMatrices(h,m),_=l.getFrustum(),!function t(n,e,i,r,o){if(!1===n.visible)return;var s=n.layers.test(e.layers);if(s&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&o===rn)&&(!n.frustumCulled||_.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,n.matrixWorld);var a=g.update(n),u=n.material;if(Array.isArray(u))for(var c=a.groups,f=0,h=c.length;f<h;f++){var l,d=c[f],v=u[d.materialIndex];v&&v.visible&&(l=L(n,v,r,i.near,i.far,o),b.renderBufferDirect(i,null,a,l,n,d))}else u.visible&&(l=L(n,u,r,i.near,i.far,o),b.renderBufferDirect(i,null,a,l,n,null))}var p=n.children;for(var m=0,y=p.length;m<y;m++)t(p[m],e,i,r,o)}(n,e,l.camera,h,this.type)}l.isPointLightShadow||this.type!==rn||(v=l,a=e,u=void 0,u=g.update(M),x.uniforms.shadow_pass.value=v.map.texture,x.uniforms.resolution.value=v.mapSize,x.uniforms.radius.value=v.radius,b.setRenderTarget(v.mapPass),b.clear(),b.renderBufferDirect(a,null,u,x,M,null),A.uniforms.shadow_pass.value=v.mapPass.texture,A.uniforms.resolution.value=v.mapSize,A.uniforms.radius.value=v.radius,b.setRenderTarget(v.map),b.clear(),b.renderBufferDirect(a,null,u,A,M,null))}}O.needsUpdate=!1,b.setRenderTarget(i,r,o)}}}function lc(t){return(lc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dc(t,n,e){return(n=function(t){t=function(t,n){if("object"!=lc(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=lc(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==lc(t)?t:String(t)}(n))in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function vc(f,e,t){var i=t.isWebGL2;var r=new function(){var n=!1,o=new Ot,e=null,s=new Ot(0,0,0,0);return{setMask:function(t){e===t||n||(f.colorMask(t,t,t,t),e=t)},setLocked:function(t){n=t},setClear:function(t,n,e,i,r){!0===r&&(t*=i,n*=i,e*=i),o.set(t,n,e,i),!1===s.equals(o)&&(f.clearColor(t,n,e,i),s.copy(o))},reset:function(){n=!1,e=null,s.set(-1,0,0,0)}}},o=new function(){var n=!1,e=null,i=null,r=null;return{setTest:function(t){(t?R:N)(f.DEPTH_TEST)},setMask:function(t){e===t||n||(f.depthMask(t),e=t)},setFunc:function(t){if(i!==t){if(t)switch(t){case Rn:f.depthFunc(f.NEVER);break;case Nn:f.depthFunc(f.ALWAYS);break;case Pn:f.depthFunc(f.LESS);break;case jn:f.depthFunc(f.LEQUAL);break;case Fn:f.depthFunc(f.EQUAL);break;case In:f.depthFunc(f.GEQUAL);break;case Cn:f.depthFunc(f.GREATER);break;case kn:f.depthFunc(f.NOTEQUAL);break;default:f.depthFunc(f.LEQUAL)}else f.depthFunc(f.LEQUAL);i=t}},setLocked:function(t){n=t},setClear:function(t){r!==t&&(f.clearDepth(t),r=t)},reset:function(){n=!1,r=i=e=null}}},s=new function(){var n=!1,e=null,i=null,r=null,o=null,s=null,a=null,u=null,c=null;return{setTest:function(t){n||(t?R:N)(f.STENCIL_TEST)},setMask:function(t){e===t||n||(f.stencilMask(t),e=t)},setFunc:function(t,n,e){i===t&&r===n&&o===e||(f.stencilFunc(t,n,e),i=t,r=n,o=e)},setOp:function(t,n,e){s===t&&a===n&&u===e||(f.stencilOp(t,n,e),s=t,a=n,u=e)},setLocked:function(t){n=t},setClear:function(t){c!==t&&(f.clearStencil(t),c=t)},reset:function(){n=!1,c=u=a=s=o=r=i=e=null}}},t=f.getParameter(f.MAX_VERTEX_ATTRIBS),a=new Uint8Array(t),u=new Uint8Array(t),c=new Uint8Array(t),n={},h=null,l=null,d=null,v=null,p=null,m=null,y=null,b=null,g=null,w=!1,_=null,E=null,S=null,T=null,C=null,k=f.getParameter(f.MAX_COMBINED_TEXTURE_IMAGE_UNITS),x=!1,t=0,A=f.getParameter(f.VERSION),M=(-1!==A.indexOf("WebGL")?(t=parseFloat(/^WebGL\ ([0-9])/.exec(A)[1]),x=1<=t):-1!==A.indexOf("OpenGL ES")&&(t=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(A)[1]),x=2<=t),null),O={},D=new Ot,U=new Ot;function B(t,n,e){var i=new Uint8Array(4),r=f.createTexture();f.bindTexture(t,r),f.texParameteri(t,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(t,f.TEXTURE_MAG_FILTER,f.NEAREST);for(var o=0;o<e;o++)f.texImage2D(n+o,0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,i);return r}var L={};function G(t,n){a[t]=1,0===u[t]&&(f.enableVertexAttribArray(t),u[t]=1),c[t]!==n&&((i?f:e.get("ANGLE_instanced_arrays"))[i?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](t,n),c[t]=n)}function R(t){!0!==n[t]&&(f.enable(t),n[t]=!0)}function N(t){!1!==n[t]&&(f.disable(t),n[t]=!1)}L[f.TEXTURE_2D]=B(f.TEXTURE_2D,f.TEXTURE_2D,1),L[f.TEXTURE_CUBE_MAP]=B(f.TEXTURE_CUBE_MAP,f.TEXTURE_CUBE_MAP_POSITIVE_X,6),r.setClear(0,0,0,1),o.setClear(1),s.setClear(0),R(f.DEPTH_TEST),o.setFunc(jn),I(!1),H(tn),R(f.CULL_FACE),F(un);var P=dc(dc(dc({},vn,f.FUNC_ADD),pn,f.FUNC_SUBTRACT),mn,f.FUNC_REVERSE_SUBTRACT),j=(i?(P[yn]=f.MIN,P[bn]=f.MAX):null!==(A=e.get("EXT_blend_minmax"))&&(P[yn]=A.MIN_EXT,P[bn]=A.MAX_EXT),dc(dc(dc(dc(dc(dc(dc(dc(dc(dc(t={},gn,f.ZERO),wn,f.ONE),_n,f.SRC_COLOR),Sn,f.SRC_ALPHA),Ln,f.SRC_ALPHA_SATURATE),Mn,f.DST_COLOR),xn,f.DST_ALPHA),En,f.ONE_MINUS_SRC_COLOR),Tn,f.ONE_MINUS_SRC_ALPHA),On,f.ONE_MINUS_DST_COLOR),dc(t,An,f.ONE_MINUS_DST_ALPHA));function F(t,n,e,i,r,o,s,a){if(t===un)l&&(N(f.BLEND),l=!1);else if(l||(R(f.BLEND),l=!0),t!==dn){if(t!==d||a!==w){if(v===vn&&y===vn||(f.blendEquation(f.FUNC_ADD),y=v=vn),a)switch(t){case cn:f.blendFuncSeparate(f.ONE,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA);break;case fn:f.blendFunc(f.ONE,f.ONE);break;case hn:f.blendFuncSeparate(f.ZERO,f.ZERO,f.ONE_MINUS_SRC_COLOR,f.ONE_MINUS_SRC_ALPHA);break;case ln:f.blendFuncSeparate(f.ZERO,f.SRC_COLOR,f.ZERO,f.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case cn:f.blendFuncSeparate(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA);break;case fn:f.blendFunc(f.SRC_ALPHA,f.ONE);break;case hn:f.blendFunc(f.ZERO,f.ONE_MINUS_SRC_COLOR);break;case ln:f.blendFunc(f.ZERO,f.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}g=b=m=p=null,d=t,w=a}}else r=r||n,o=o||e,s=s||i,n===v&&r===y||(f.blendEquationSeparate(P[n],P[r]),v=n,y=r),e===p&&i===m&&o===b&&s===g||(f.blendFuncSeparate(j[e],j[i],j[o],j[s]),p=e,m=i,b=o,g=s),d=t,w=null}function I(t){_!==t&&(t?f.frontFace(f.CW):f.frontFace(f.CCW),_=t)}function H(t){t!==$t?(R(f.CULL_FACE),t!==E&&(t===tn?f.cullFace(f.BACK):t===nn?f.cullFace(f.FRONT):f.cullFace(f.FRONT_AND_BACK))):N(f.CULL_FACE),E=t}function X(t,n,e){t?(R(f.POLYGON_OFFSET_FILL),T===n&&C===e||(f.polygonOffset(n,e),T=n,C=e)):N(f.POLYGON_OFFSET_FILL)}function z(t){void 0===t&&(t=f.TEXTURE0+k-1),M!==t&&(f.activeTexture(t),M=t)}return{buffers:{color:r,depth:o,stencil:s},initAttributes:function(){for(var t=0,n=a.length;t<n;t++)a[t]=0},enableAttribute:function(t){G(t,0)},enableAttributeAndDivisor:G,disableUnusedAttributes:function(){for(var t=0,n=u.length;t!==n;++t)u[t]!==a[t]&&(f.disableVertexAttribArray(t),u[t]=0)},enable:R,disable:N,useProgram:function(t){return h!==t&&(f.useProgram(t),h=t,!0)},setBlending:F,setMaterial:function(t,n,e){(t.side===an?N:R)(f.CULL_FACE);var i=t.side===sn,n=(I(i=n?!i:i),t.blending!==cn||!1!==t.transparent&&!1!==e.userData.transparent?F(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):F(un),o.setFunc(t.depthFunc),o.setTest(t.depthTest),o.setMask(t.depthWrite),r.setMask(t.colorWrite),t.stencilWrite);s.setTest(n),n&&(s.setMask(t.stencilWriteMask),s.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),s.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),X(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:I,setCullFace:H,setLineWidth:function(t){t!==S&&(x&&f.lineWidth(t),S=t)},setPolygonOffset:X,setScissorTest:function(t){(t?R:N)(f.SCISSOR_TEST)},activeTexture:z,bindTexture:function(t,n){null===M&&z();var e=O[M];void 0===e&&(O[M]=e={type:void 0,texture:void 0}),e.type===t&&e.texture===n||(f.bindTexture(t,n||L[t]),e.type=t,e.texture=n)},unbindTexture:function(){var t=O[M];void 0!==t&&void 0!==t.type&&(f.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{f.compressedTexImage2D.apply(f,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{f.texImage2D.apply(f,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{f.texImage3D.apply(f,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===D.equals(t)&&(f.scissor(t.x,t.y,t.z,t.w),D.copy(t))},viewport:function(t){!1===U.equals(t)&&(f.viewport(t.x,t.y,t.z,t.w),U.copy(t))},reset:function(){for(var t=0;t<u.length;t++)1===u[t]&&(f.disableVertexAttribArray(t),u[t]=0);n={},O={},E=_=d=h=M=null,r.reset(),o.reset(),s.reset()}}}function pc(t){return(pc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function mc(t,n,e){return(n=function(t){t=function(t,n){if("object"!=pc(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=pc(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==pc(t)?t:String(t)}(n))in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function yc(m,i,y,b,r,g,u){var o,w=r.isWebGL2,n=r.maxTextures,_=r.maxCubemapSize,k=r.maxTextureSize,D=r.maxSamples,s=new WeakMap,e=!1;try{e="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function a(t,n){return e?new OffscreenCanvas(t,n):st.a.document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function E(t,n,e,i){var r=1;return(r=t.width>i||t.height>i?i/Math.max(t.width,t.height):r)<1||!0===n?"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?(n=(i=n?Tt.floorPowerOfTwo:Math.floor)(r*t.width),i=i(r*t.height),void 0===o&&(o=a(n,i)),(r=e?a(n,i):o).width=n,r.height=i,r.getContext("2d").drawImage(t,0,0,n,i),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+n+"x"+i+")."),r):("data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t):t}function S(t){return Tt.isPowerOfTwo(t.width)&&Tt.isPowerOfTwo(t.height)}function T(t,n){return t.generateMipmaps&&n&&t.minFilter!==Vn&&t.minFilter!==B}function x(t,n,e,i){m.generateMipmap(t),b.get(n).qr=Math.log(Math.max(e,i))*Math.LOG2E}function A(t,n,e){if(!1===w)return n;if(null!==t){if(void 0!==m[t])return m[t];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+t+"'")}t=n;return n===m.RED&&(e===m.FLOAT&&(t=m.R32F),e===m.HALF_FLOAT&&(t=m.R16F),e===m.UNSIGNED_BYTE)&&(t=m.R8),n===m.RGB&&(e===m.FLOAT&&(t=m.RGB32F),e===m.HALF_FLOAT&&(t=m.RGB16F),e===m.UNSIGNED_BYTE)&&(t=m.RGB8),(t=n===m.RGBA&&(e===m.FLOAT&&(t=m.RGBA32F),e===m.HALF_FLOAT&&(t=m.RGBA16F),e===m.UNSIGNED_BYTE)?m.RGBA8:t)!==m.R16F&&t!==m.R32F&&t!==m.RGBA16F&&t!==m.RGBA32F||i.get("EXT_color_buffer_float"),t}function c(t){return t===Vn||t===Wn||t===Yn?m.NEAREST:m.LINEAR}function f(t){var n,e,t=t.target;t.removeEventListener("dispose",f),n=t,void 0!==(e=b.get(n)).Kr&&(m.deleteTexture(e.Jr),b.remove(n)),t.isVideoTexture&&s.delete(t),u.memory.textures--}function h(t){var t=t.target,n=(t.removeEventListener("dispose",h),b.get(t)),e=b.get(t.texture);if(t){if(void 0!==e.Jr&&m.deleteTexture(e.Jr),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(var i=0;i<6;i++)m.deleteFramebuffer(n.$r[i]),n.no&&m.deleteRenderbuffer(n.no[i]);else m.deleteFramebuffer(n.$r),n.no&&m.deleteRenderbuffer(n.no),n.eo&&m.deleteFramebuffer(n.eo),n.io&&m.deleteRenderbuffer(n.io),n.ro&&m.deleteRenderbuffer(n.ro);b.remove(t.texture),b.remove(t)}u.memory.textures--}var l=0;function d(t,n){var e,i=b.get(t);if(t.isVideoTexture&&(e=t,r=u.render.frame,s.get(e)!==r)&&(s.set(e,r),e.update()),0<t.version&&i.oo!==t.version){var r=t.image;if(void 0===r)st.a.environment===G.a.BROWSER&&console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==r.complete)return void N(i,t,n);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}y.activeTexture(m.TEXTURE0+n),y.bindTexture(m.TEXTURE_2D,i.Jr)}function v(t,n){if(6===t.image.length){var e=b.get(t);if(0<t.version&&e.oo!==t.version){R(e,t),y.activeTexture(m.TEXTURE0+n),y.bindTexture(m.TEXTURE_CUBE_MAP,e.Jr),m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var i=t&&(t.isCompressedTexture||t.image[0].isCompressedTexture),r=t.image[0]&&t.image[0].isDataTexture,o=[],s=0;s<6;s++)o[s]=i||r?r?t.image[s].image:t.image[s]:E(t.image[s],!1,!0,_);var a=o[0],u=S(a)||w,c=g.convert(t.format),f=g.convert(t.type),h=A(t.internalFormat,c,f);if(L(m.TEXTURE_CUBE_MAP,t,u),i){for(s=0;s<6;s++)for(var l=o[s].mipmaps,d=0;d<l.length;d++){var v=l[d];t.format!==he&&t.format!==fe?null!==c?y.compressedTexImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+s,d,h,v.width,v.height,0,v.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):y.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+s,d,h,v.width,v.height,0,c,f,v.data)}e.qr=l.length-1}else{l=t.mipmaps;for(s=0;s<6;s++)if(r){y.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,h,o[s].width,o[s].height,0,c,f,o[s].data);for(d=0;d<l.length;d++){var p=(v=l[d]).image[s].image;y.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+s,d+1,h,p.width,p.height,0,c,f,p.data)}}else{y.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,h,c,f,o[s]);for(d=0;d<l.length;d++){v=l[d];y.texImage2D(m.TEXTURE_CUBE_MAP_POSITIVE_X+s,d+1,h,c,f,v.image[s])}}e.qr=l.length}T(t,u)&&x(m.TEXTURE_CUBE_MAP,t,a.width,a.height),e.oo=t.version,t.onUpdate&&t.onUpdate(t)}else y.activeTexture(m.TEXTURE0+n),y.bindTexture(m.TEXTURE_CUBE_MAP,e.Jr)}}function p(t,n){y.activeTexture(m.TEXTURE0+n),y.bindTexture(m.TEXTURE_CUBE_MAP,b.get(t).Jr)}var M=mc(mc(mc({},Hn,m.REPEAT),Xn,m.CLAMP_TO_EDGE),zn,m.MIRRORED_REPEAT),O=mc(mc(mc(mc(mc(mc({},Vn,m.NEAREST),Wn,m.NEAREST_MIPMAP_NEAREST),Yn,m.NEAREST_MIPMAP_LINEAR),B,m.LINEAR),Qn,m.LINEAR_MIPMAP_NEAREST),Zn,m.LINEAR_MIPMAP_LINEAR);function L(t,n,e){e?(m.texParameteri(t,m.TEXTURE_WRAP_S,M[n.wrapS]),m.texParameteri(t,m.TEXTURE_WRAP_T,M[n.wrapT]),t!==m.TEXTURE_3D&&t!==m.TEXTURE_2D_ARRAY||m.texParameteri(t,m.TEXTURE_WRAP_R,M[n.wrapR]),m.texParameteri(t,m.TEXTURE_MAG_FILTER,O[n.magFilter]),m.texParameteri(t,m.TEXTURE_MIN_FILTER,O[n.minFilter])):(m.texParameteri(t,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(t,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),t!==m.TEXTURE_3D&&t!==m.TEXTURE_2D_ARRAY||m.texParameteri(t,m.TEXTURE_WRAP_R,m.CLAMP_TO_EDGE),n.wrapS===Xn&&n.wrapT===Xn||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),m.texParameteri(t,m.TEXTURE_MAG_FILTER,c(n.magFilter)),m.texParameteri(t,m.TEXTURE_MIN_FILTER,c(n.minFilter)),n.minFilter!==Vn&&n.minFilter!==B&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));e=i.get("EXT_texture_filter_anisotropic");!e||n.type===ie&&null===i.get("OES_texture_float_linear")||n.type===re&&null===(w||i.get("OES_texture_half_float_linear"))||(1<n.anisotropy||b.get(n).so)&&(m.texParameterf(t,e.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n.anisotropy,r.getMaxAnisotropy())),b.get(n).so=n.anisotropy)}function R(t,n){void 0===t.Kr&&(t.Kr=!0,n.addEventListener("dispose",f),t.Jr=m.createTexture(),u.memory.textures++)}function N(t,n,e){var i=m.TEXTURE_2D,e=(n.isDataTexture2DArray&&(i=m.TEXTURE_2D_ARRAY),n.isDataTexture3D&&(i=m.TEXTURE_3D),R(t,n),y.activeTexture(m.TEXTURE0+e),y.bindTexture(i,t.Jr),m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,n.flipY),m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),m.pixelStorei(m.UNPACK_ALIGNMENT,n.unpackAlignment),e=n,!w&&(e.wrapS!==Xn||e.wrapT!==Xn||e.minFilter!==Vn&&e.minFilter!==B)&&!1===S(n.image)),e=E(n.image,e,!1,k),r=S(e)||w,o=g.convert(n.format),s=g.convert(n.type),a=A(n.internalFormat,o,s);L(i,n,r);var u,c=n.mipmaps;if(n.isDepthTexture)a=m.DEPTH_COMPONENT,w?a=n.type===ie?m.DEPTH_COMPONENT32F:n.type===ee?m.DEPTH_COMPONENT24:n.type===ue?m.DEPTH24_STENCIL8:m.DEPTH_COMPONENT16:n.type===ie&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===ve&&a===m.DEPTH_COMPONENT&&n.type!==te&&n.type!==ee&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=te,s=g.convert(n.type)),n.format===pe&&a===m.DEPTH_COMPONENT&&(a=m.DEPTH_STENCIL,n.type!==ue)&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=ue,s=g.convert(n.type)),y.texImage2D(m.TEXTURE_2D,0,a,e.width,e.height,0,o,s,null);else if(n.isDataTexture)if(0<c.length&&r){for(var f=0,h=c.length;f<h;f++)u=c[f],y.texImage2D(m.TEXTURE_2D,f,a,u.width,u.height,0,o,s,u.data);n.generateMipmaps=!1,t.qr=c.length-1}else y.texImage2D(m.TEXTURE_2D,0,a,e.width,e.height,0,o,s,e.data),t.qr=0;else if(n.isCompressedTexture){for(f=0,h=c.length;f<h;f++)u=c[f],n.format!==he&&n.format!==fe?null!==o?y.compressedTexImage2D(m.TEXTURE_2D,f,a,u.width,u.height,0,u.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):y.texImage2D(m.TEXTURE_2D,f,a,u.width,u.height,0,o,s,u.data);t.qr=c.length-1}else if(n.isDataTexture2DArray)y.texImage3D(m.TEXTURE_2D_ARRAY,0,a,e.width,e.height,e.depth,0,o,s,e.data),t.qr=0;else if(n.isDataTexture3D)y.texImage3D(m.TEXTURE_3D,0,a,e.width,e.height,e.depth,0,o,s,e.data),t.qr=0;else if(0<c.length&&r){for(f=0,h=c.length;f<h;f++)u=c[f],y.texImage2D(m.TEXTURE_2D,f,a,o,s,u);n.generateMipmaps=!1,t.qr=c.length-1}else y.texImage2D(m.TEXTURE_2D,0,a,o,s,e),t.qr=0;T(n,r)&&x(i,n,e.width,e.height),t.oo=n.version,n.onUpdate&&n.onUpdate(n)}function P(t,n,e,i){var r=g.convert(n.texture.format),o=g.convert(n.texture.type),s=A(n.texture.internalFormat,r,o);y.texImage2D(i,0,s,n.width,n.height,0,r,o,null),m.bindFramebuffer(m.FRAMEBUFFER,t),m.framebufferTexture2D(m.FRAMEBUFFER,e,i,b.get(n.texture).Jr,0),m.bindFramebuffer(m.FRAMEBUFFER,null)}function j(t,n,e){var i,r,o;m.bindRenderbuffer(m.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer?(r=m.DEPTH_COMPONENT16,e?((o=n.depthTexture)&&o.isDepthTexture&&(o.type===ie?r=m.DEPTH_COMPONENT32F:o.type===ee&&(r=m.DEPTH_COMPONENT24)),o=F(n),m.renderbufferStorageMultisample(m.RENDERBUFFER,o,r,n.width,n.height)):m.renderbufferStorage(m.RENDERBUFFER,r,n.width,n.height),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,t)):n.depthBuffer&&n.stencilBuffer?(e?(o=F(n),m.renderbufferStorageMultisample(m.RENDERBUFFER,o,m.DEPTH24_STENCIL8,n.width,n.height)):m.renderbufferStorage(m.RENDERBUFFER,m.DEPTH_STENCIL,n.width,n.height),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.RENDERBUFFER,t)):(t=g.convert(n.texture.format),i=g.convert(n.texture.type),r=A(n.texture.internalFormat,t,i),e?(o=F(n),m.renderbufferStorageMultisample(m.RENDERBUFFER,o,r,n.width,n.height)):m.renderbufferStorage(m.RENDERBUFFER,r,n.width,n.height)),m.bindRenderbuffer(m.RENDERBUFFER,null)}function U(t){var n=b.get(t),e=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(e)throw new Error("target.depthTexture not supported in Cube render targets");var i=n.$r,r=t;if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(m.bindFramebuffer(m.FRAMEBUFFER,i),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");if(b.get(r.depthTexture).Jr&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),d(r.depthTexture,0),i=b.get(r.depthTexture).Jr,r.depthTexture.format===ve)m.framebufferTexture2D(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.TEXTURE_2D,i,0);else{if(r.depthTexture.format!==pe)throw new Error("Unknown depthTexture format");m.framebufferTexture2D(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.TEXTURE_2D,i,0)}}else if(e){n.no=[];for(var o=0;o<6;o++)m.bindFramebuffer(m.FRAMEBUFFER,n.$r[o]),n.no[o]=m.createRenderbuffer(),j(n.no[o],t,!1)}else m.bindFramebuffer(m.FRAMEBUFFER,n.$r),n.no=m.createRenderbuffer(),j(n.no,t,!1);m.bindFramebuffer(m.FRAMEBUFFER,null)}function F(t){return w&&t.isWebGLMultisampleRenderTarget?Math.min(D,t.samples):0}var I=!1,C=!1;this.allocateTextureUnit=function(){var t=l;return n<=t&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+n),l+=1,t},this.resetTextureUnits=function(){l=0},this.setTexture2D=d,this.setTexture2DArray=function(t,n){var e=b.get(t);0<t.version&&e.oo!==t.version?N(e,t,n):(y.activeTexture(m.TEXTURE0+n),y.bindTexture(m.TEXTURE_2D_ARRAY,e.Jr))},this.setTexture3D=function(t,n){var e=b.get(t);0<t.version&&e.oo!==t.version?N(e,t,n):(y.activeTexture(m.TEXTURE0+n),y.bindTexture(m.TEXTURE_3D,e.Jr))},this.setTextureCube=v,this.setTextureCubeDynamic=p,this.setupRenderTarget=function(t){var n,e=b.get(t),i=b.get(t.texture),r=(t.addEventListener("dispose",h),i.Jr=m.createTexture(),u.memory.textures++,!0===t.isWebGLCubeRenderTarget),o=!0===t.isWebGLMultisampleRenderTarget,s=S(t)||w;if(!w||t.texture.format!==fe||t.texture.type!==ie&&t.texture.type!==re||(t.texture.format=he,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),r){e.$r=[];for(var a=0;a<6;a++)e.$r[a]=m.createFramebuffer()}else e.$r=m.createFramebuffer(),o&&(w?(e.eo=m.createFramebuffer(),e.io=m.createRenderbuffer(),m.bindRenderbuffer(m.RENDERBUFFER,e.io),o=g.convert(t.texture.format),n=g.convert(t.texture.type),o=A(t.texture.internalFormat,o,n),n=F(t),m.renderbufferStorageMultisample(m.RENDERBUFFER,n,o,t.width,t.height),m.bindFramebuffer(m.FRAMEBUFFER,e.eo),m.framebufferRenderbuffer(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.RENDERBUFFER,e.io),m.bindRenderbuffer(m.RENDERBUFFER,null),t.depthBuffer&&(e.ro=m.createRenderbuffer(),j(e.ro,t,!0)),m.bindFramebuffer(m.FRAMEBUFFER,null)):console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2."));if(r){y.bindTexture(m.TEXTURE_CUBE_MAP,i.Jr),L(m.TEXTURE_CUBE_MAP,t.texture,s);for(a=0;a<6;a++)P(e.$r[a],t,m.COLOR_ATTACHMENT0,m.TEXTURE_CUBE_MAP_POSITIVE_X+a);T(t.texture,s)&&x(m.TEXTURE_CUBE_MAP,t.texture,t.width,t.height),y.bindTexture(m.TEXTURE_CUBE_MAP,null)}else y.bindTexture(m.TEXTURE_2D,i.Jr),L(m.TEXTURE_2D,t.texture,s),P(e.$r,t,m.COLOR_ATTACHMENT0,m.TEXTURE_2D),T(t.texture,s)&&x(m.TEXTURE_2D,t.texture,t.width,t.height),y.bindTexture(m.TEXTURE_2D,null);t.depthBuffer&&U(t)},this.updateRenderTargetMipmap=function(t){var n,e,i=t.texture;T(i,S(t)||w)&&(n=t.isWebGLCubeRenderTarget?m.TEXTURE_CUBE_MAP:m.TEXTURE_2D,e=b.get(i).Jr,y.bindTexture(n,e),x(n,i,t.width,t.height),y.bindTexture(n,null))},this.updateMultisampleRenderTarget=function(t){var n,e,i,r;t.isWebGLMultisampleRenderTarget&&(w?(n=b.get(t),m.bindFramebuffer(m.READ_FRAMEBUFFER,n.eo),m.bindFramebuffer(m.DRAW_FRAMEBUFFER,n.$r),e=t.width,i=t.height,r=m.COLOR_BUFFER_BIT,t.depthBuffer&&(r|=m.DEPTH_BUFFER_BIT),t.stencilBuffer&&(r|=m.STENCIL_BUFFER_BIT),m.blitFramebuffer(0,0,e,i,0,0,e,i,r,m.NEAREST),m.bindFramebuffer(m.FRAMEBUFFER,n.eo)):console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2."))},this.safeSetTexture2D=function(t,n){t&&t.isWebGLRenderTarget&&(!1===I&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),I=!0),t=t.texture),d(t,n)},this.safeSetTextureCube=function(t,n){t&&t.isWebGLCubeRenderTarget&&(!1===C&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),C=!0),t=t.texture),(t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?v:p)(t,n)}}function bc(e,i,t){var r=t.isWebGL2;return{convert:function(t){var n;if(t===Kn)return e.UNSIGNED_BYTE;if(t===oe)return e.UNSIGNED_SHORT_4_4_4_4;if(t===se)return e.UNSIGNED_SHORT_5_5_5_1;if(t===ae)return e.UNSIGNED_SHORT_5_6_5;if(t===Jn)return e.BYTE;if(t===$n)return e.SHORT;if(t===te)return e.UNSIGNED_SHORT;if(t===ne)return e.INT;if(t===ee)return e.UNSIGNED_INT;if(t===ie)return e.FLOAT;if(t===re)return r?e.HALF_FLOAT:null!==(n=i.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(t===ce)return e.ALPHA;if(t===fe)return e.RGB;if(t===he)return e.RGBA;if(t===le)return e.LUMINANCE;if(t===de)return e.LUMINANCE_ALPHA;if(t===ve)return e.DEPTH_COMPONENT;if(t===pe)return e.DEPTH_STENCIL;if(t===me)return e.RED;if(t===ye)return e.RED_INTEGER;if(t===be)return e.RG;if(t===ge)return e.RG_INTEGER;if(t===we)return e.RGB_INTEGER;if(t===_e)return e.RGBA_INTEGER;if(t===Ee||t===Se||t===Te||t===xe){if(null===(n=i.get("WEBGL_compressed_texture_s3tc")))return null;if(t===Ee)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===Se)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Te)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===xe)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===Ae||t===Me||t===Oe||t===Le){if(null===(n=i.get("WEBGL_compressed_texture_pvrtc")))return null;if(t===Ae)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===Me)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===Oe)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===Le)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===Re)return null!==(n=i.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===Ne||t===Pe)&&null!==(n=i.get("WEBGL_compressed_texture_etc"))){if(t===Ne)return n.COMPRESSED_RGB8_ETC2;if(t===Pe)return n.COMPRESSED_RGBA8_ETC2_EAC}return t===je||t===Fe||t===Ie||t===Ce||t===ke||t===De||t===Ue||t===Be||t===Ge||t===He||t===Xe||t===ze||t===Ve||t===We||t===Qe||t===Ze||t===qe||t===Ke||t===Je||t===$e||t===ti||t===ni||t===ei||t===ii||t===ri||t===oi||t===si||t===ai?null!==(n=i.get("WEBGL_compressed_texture_astc"))?t:null:t===Ye?null!==(n=i.get("EXT_texture_compression_bptc"))?t:null:t===ue?r?e.UNSIGNED_INT_24_8:null!==(n=i.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function gc(t){dt.call(this),this.cameras=t||[]}function wc(){a.call(this),this.type="Group"}function _c(d,n){var e=this,m=null,i=1,v=null,r="local-floor",p=null,y=[],o=new Map,b=new dt,g=(b.layers.enable(1),b.viewport=new Ot,new dt),w=(g.layers.enable(2),g.viewport=new Ot,new gc([b,g])),_=(w.layers.enable(1),w.layers.enable(2),null),E=null;function s(t){var n=o.get(t.inputSource);n&&(n.targetRay&&n.targetRay.dispatchEvent({type:t.type}),n.grip)&&n.grip.dispatchEvent({type:t.type})}function a(){o.forEach(function(t,n){t.targetRay&&(t.targetRay.dispatchEvent({type:"disconnected",data:n}),t.targetRay.visible=!1),t.grip&&(t.grip.dispatchEvent({type:"disconnected",data:n}),t.grip.visible=!1)}),o.clear(),d.setFramebuffer(null),d.setRenderTarget(d.getRenderTarget()),f.stop(),e.isPresenting=!1,e.dispatchEvent({type:"sessionend"})}function u(t){v=t,f.setContext(m),f.start(),e.isPresenting=!0,e.dispatchEvent({type:"sessionstart"})}function c(t){for(var n=m.inputSources,e=0;e<y.length;e++)o.set(n[e],y[e]);for(e=0;e<t.removed.length;e++){var i=t.removed[e];(r=o.get(i))&&(r.targetRay&&r.targetRay.dispatchEvent({type:"disconnected",data:i}),r.grip&&r.grip.dispatchEvent({type:"disconnected",data:i}),o.delete(i))}for(e=0;e<t.added.length;e++){var r,i=t.added[e];(r=o.get(i))&&(r.targetRay&&r.targetRay.dispatchEvent({type:"connected",data:i}),r.grip)&&r.grip.dispatchEvent({type:"connected",data:i})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){var n=y[t];return void 0===n&&(y[t]=n={}),void 0===n.targetRay&&(n.targetRay=new wc,n.targetRay.matrixAutoUpdate=!1,n.targetRay.visible=!1),n.targetRay},this.getControllerGrip=function(t){var n=y[t];return void 0===n&&(y[t]=n={}),void 0===n.grip&&(n.grip=new wc,n.grip.matrixAutoUpdate=!1,n.grip.visible=!1),n.grip},this.setFramebufferScaleFactor=function(t){i=t,1==e.isPresenting&&console.warn("WebXRManager: Cannot change framebuffer scale while presenting VR content")},this.setReferenceSpaceType=function(t){r=t},this.getReferenceSpace=function(){return v},this.getSession=function(){return m},this.setSession=function(t){null!==(m=t)&&(m.addEventListener("select",s),m.addEventListener("selectstart",s),m.addEventListener("selectend",s),m.addEventListener("squeeze",s),m.addEventListener("squeezestart",s),m.addEventListener("squeezeend",s),m.addEventListener("end",a),t={antialias:(t=n.getContextAttributes()).antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:i},t=new XRWebGLLayer(m,n,t),m.updateRenderState({baseLayer:t}),m.requestReferenceSpace(r).then(u),m.addEventListener("inputsourceschange",c))};var S=new xt,T=new xt;function x(t,n){null===n?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(n.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}this.getCamera=function(t){w.near=g.near=b.near=t.near,w.far=g.far=b.far=t.far,_===w.near&&E===w.far||(m.updateRenderState({depthNear:w.near,depthFar:w.far}),_=w.near,E=w.far);var n=t.parent,e=w.cameras;x(w,n);for(var i=0;i<e.length;i++)x(e[i],n);t.matrixWorld.copy(w.matrixWorld);for(var r,o,s,a,u,c,f,h,l,d,v=t.children,i=0,p=v.length;i<p;i++)v[i].updateMatrixWorld(!0);return t=w,r=b,o=g,S.setFromMatrixPosition(r.matrixWorld),T.setFromMatrixPosition(o.matrixWorld),s=S.distanceTo(T),a=r.projectionMatrix.elements,o=o.projectionMatrix.elements,u=a[14]/(a[10]-1),c=a[14]/(a[10]+1),f=(a[9]+1)/a[5],h=(a[9]-1)/a[5],a=(a[8]-1)/a[0],o=(o[8]+1)/o[0],l=u*a,d=u*o,a=(o=s/(o-a))*-a,r.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(a),t.translateZ(o),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld),r=u+o,u=c+o,t.projectionMatrix.makePerspective(l-a,s-a+d,f*c/u*r,h*c/u*r,r,u),w};var A=null;var f=new Ko;f.setAnimationLoop(function(t,n){if(null!==(p=n.getViewerPose(v))){var e=p.views,i=m.renderState.baseLayer;d.setFramebuffer(i.framebuffer);for(var r=0;r<e.length;r++){var o=e[r],s=i.getViewport(o),a=w.cameras[r];a.matrix.fromArray(o.transform.matrix),a.projectionMatrix.fromArray(o.projectionMatrix),a.viewport.set(s.x,s.y,s.width,s.height),0===r&&w.matrix.copy(a.matrix)}}for(var u=m.inputSources,r=0;r<y.length;r++){var c=y[r],f=u[r],h=null,l=null;f&&(c.targetRay&&null!==(h=n.getPose(f.targetRaySpace,v))&&(c.targetRay.matrix.fromArray(h.transform.matrix),c.targetRay.matrix.decompose(c.targetRay.position,c.targetRay.rotation,c.targetRay.scale)),c.grip)&&f.gripSpace&&null!==(l=n.getPose(f.gripSpace,v))&&(c.grip.matrix.fromArray(l.transform.matrix),c.grip.matrix.decompose(c.grip.position,c.grip.rotation,c.grip.scale)),c.targetRay&&(c.targetRay.visible=null!==h),c.grip&&(c.grip.visible=null!==l)}A&&A(t,n)}),this.setAnimationLoop=function(t){A=t},this.dispose=function(){}}function Ec(t){var w,_,E,S,y,m,b,T,D,g,h,o,u,s,U,B,G,l,i=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==t.context?t.context:null,e=void 0!==t.alpha&&t.alpha,H=void 0===t.depth||t.depth,X=void 0===t.stencil||t.stencil,z=void 0!==t.antialias&&t.antialias,V=void 0===t.premultipliedAlpha||t.premultipliedAlpha,W=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,Y=void 0!==t.powerPreference?t.powerPreference:"default",Q=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat,Z=void 0!==t.useWebGL2&&t.useWebGL2,x=null,A=null,M=(this.domElement=i,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=li,this.physicallyCorrectLights=!1,this.toneMapping=1,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4,this),q=!1,K=null,J=0,$=0,a=null,d=null,O=-1,v={geometry:null,program:null,wireframe:!1},L=null,tt=null,p=new Ot,c=new Ot,nt=null,r=i.width,R=i.height,N=1,et=null,it=null,f=new Ot(0,0,r,R),P=new Ot(0,0,r,R),rt=!1,ot=new zt,j=new xa,st=!1,at=!1,F=new At,I=new xt;function ut(){return null===a?N:1}try{var ct={alpha:e,depth:H,stencil:X,antialias:z,premultipliedAlpha:V,preserveDrawingBuffer:W,powerPreference:Y,failIfMajorPerformanceCaveat:Q,xrCompatible:!1};if(i.addEventListener("webglcontextlost",lt,!1),i.addEventListener("webglcontextrestored",dt,!1),null===(w=Z?i.getContext("webgl2",ct):n||i.getContext("webgl",ct)||i.getContext("experimental-webgl",ct)))throw null!==i.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===w.getShaderPrecisionFormat&&(w.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function ft(){_=new Aa(w),!1===(E=new Ta(w,_,t)).isWebGL2&&(_.get("WEBGL_depth_texture"),_.get("OES_texture_float"),_.get("OES_texture_half_float"),_.get("OES_texture_half_float_linear"),_.get("OES_standard_derivatives"),_.get("OES_element_index_uint"),_.get("ANGLE_instanced_arrays")),_.get("OES_texture_float_linear"),l=new bc(w,_,E),(S=new vc(w,_,E)).scissor(c.copy(P).multiplyScalar(N).floor()),S.viewport(p.copy(f).multiplyScalar(N).floor()),y=new La(w),m=new Zu,b=new yc(w,_,S,m,E,l,y),T=new Jo(w,E),D=new Ma(w,T,y),g=new Pa(w,D,T,y),U=new Na(w),h=new Qu(M,_,E),o=new $u,u=new oc,s=new Ea(M,S,g,V),B=new Sa(w,_,y,E),G=new Oa(w,_,y,E),y.programs=h.programs,M.capabilities=E,M.extensions=_,M.properties=m,M.renderLists=o,M.state=S,M.info=y}ft();var C=new _c(M,w),ht=(this.xr=C,new hc(M,g,E.maxTextureSize));function lt(t){t.preventDefault(),q=!0}function dt(){q=!1,ft()}function vt(t){var t=t.target;t.removeEventListener("dispose",vt),pt(t=t),m.remove(t)}function pt(t){var n=m.get(t).program;(t.program=void 0)!==n&&h.releaseProgram(n)}this.shadowMap=ht,this.getContext=function(){return w},this.getContextAttributes=function(){return w.getContextAttributes()},this.forceContextLoss=function(){var t=_.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=_.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return N},this.setPixelRatio=function(t){void 0!==t&&(N=t,this.setSize(r,R,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new Mt),t.set(r,R)},this.setSize=function(t,n,e){C.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(r=t,R=n,i.width=Math.floor(t*N),i.height=Math.floor(n*N),!1!==e&&(i.style.width=t+"px",i.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new Mt),t.set(r*N,R*N).floor()},this.setDrawingBufferSize=function(t,n,e){r=t,R=n,N=e,i.width=Math.floor(t*e),i.height=Math.floor(n*e),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new Ot),t.copy(p)},this.getViewport=function(t){return t.copy(f)},this.setViewport=function(t,n,e,i){t.isVector4?f.set(t.x,t.y,t.z,t.w):f.set(t,n,e,i),S.viewport(p.copy(f).multiplyScalar(N).floor())},this.getScissor=function(t){return t.copy(P)},this.setScissor=function(t,n,e,i){t.isVector4?P.set(t.x,t.y,t.z,t.w):P.set(t,n,e,i),S.scissor(c.copy(P).multiplyScalar(N).floor())},this.getScissorTest=function(){return rt},this.setScissorTest=function(t){S.setScissorTest(rt=t)},this.setOpaqueSort=function(t){et=t},this.setTransparentSort=function(t){it=t},this.getClearColor=function(){return s.getClearColor()},this.setClearColor=function(){s.setClearColor.apply(s,arguments)},this.getClearAlpha=function(){return s.getClearAlpha()},this.setClearAlpha=function(){s.setClearAlpha.apply(s,arguments)},this.clear=function(t,n,e){var i=0;void 0!==t&&!t||(i|=w.COLOR_BUFFER_BIT),void 0!==n&&!n||(i|=w.DEPTH_BUFFER_BIT),void 0!==e&&!e||(i|=w.STENCIL_BUFFER_BIT),w.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",lt,!1),i.removeEventListener("webglcontextrestored",dt,!1),o.dispose(),u.dispose(),m.dispose(),g.dispose(),C.dispose(),bt.stop(),this.forceContextLoss()},this.renderBufferImmediate=function(t,n){S.initAttributes();var e=m.get(t),n=(t.hasPositions&&!e.position&&(e.position=w.createBuffer()),t.hasNormals&&!e.normal&&(e.normal=w.createBuffer()),t.hasUvs&&!e.uv&&(e.uv=w.createBuffer()),t.hasColors&&!e.color&&(e.color=w.createBuffer()),n.getAttributes());t.hasPositions&&(w.bindBuffer(w.ARRAY_BUFFER,e.position),w.bufferData(w.ARRAY_BUFFER,t.positionArray,w.DYNAMIC_DRAW),S.enableAttribute(n.position),w.vertexAttribPointer(n.position,3,w.FLOAT,!1,0,0)),t.hasNormals&&(w.bindBuffer(w.ARRAY_BUFFER,e.normal),w.bufferData(w.ARRAY_BUFFER,t.normalArray,w.DYNAMIC_DRAW),S.enableAttribute(n.normal),w.vertexAttribPointer(n.normal,3,w.FLOAT,!1,0,0)),t.hasUvs&&(w.bindBuffer(w.ARRAY_BUFFER,e.uv),w.bufferData(w.ARRAY_BUFFER,t.uvArray,w.DYNAMIC_DRAW),S.enableAttribute(n.uv),w.vertexAttribPointer(n.uv,2,w.FLOAT,!1,0,0)),t.hasColors&&(w.bindBuffer(w.ARRAY_BUFFER,e.color),w.bufferData(w.ARRAY_BUFFER,t.colorArray,w.DYNAMIC_DRAW),S.enableAttribute(n.color),w.vertexAttribPointer(n.color,3,w.FLOAT,!1,0,0)),S.disableUnusedAttributes(),w.drawArrays(w.TRIANGLES,0,t.count),t.count=0};var mt=new qo;this.renderBufferDirect=function(t,n,e,i,r,o){null===n&&(n=mt);var s=r.isMesh&&r.matrixWorld.determinant()<0,t=Et(t,n,i,r),n=(S.setMaterial(i,s,r),!1),s=(v.geometry===e.id&&v.program===t.id&&v.wireframe===(!0===i.wireframe)||(v.geometry=e.id,v.program=t.id,v.wireframe=!0===i.wireframe,n=!0),(i.morphTargets||i.morphNormals)&&(U.update(r,e,i,t),n=!0),e.index),a=e.attributes.position;if(null===s){if(void 0===a||0===a.count)return}else if(0===s.count)return;var u=1,c=(!0===i.wireframe&&(s=D.getWireframeAttribute(e),u=2),B),n=(null!==s&&(f=T.get(s),(c=G).setIndex(f)),n&&(function(t,n,e,i){if(!1===E.isWebGL2&&(t.isInstancedMesh||n.isInstancedBufferGeometry)&&null===_.get("ANGLE_instanced_arrays"))return;S.initAttributes();var r,o=n.attributes,s=i.getAttributes(),a=e.defaultAttributeValues;for(r in s){var u=s[r];if(0<=u){var c=o[r];if(void 0!==c){var f,h,l,d,v,p,m,y=c.normalized,b=c.itemSize;void 0!==(f=T.get(c))&&(h=f.buffer,l=f.type,d=f.bytesPerElement,c.isInterleavedBufferAttribute?(v=c.data,p=v.stride,m=c.offset,v&&v.isInstancedInterleavedBuffer?(S.enableAttributeAndDivisor(u,v.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=v.meshPerAttribute*v.count)):S.enableAttribute(u),w.bindBuffer(w.ARRAY_BUFFER,h),w.vertexAttribPointer(u,b,l,y,p*d,m*d)):(c.isInstancedBufferAttribute?(S.enableAttributeAndDivisor(u,c.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=c.meshPerAttribute*c.count)):S.enableAttribute(u),w.bindBuffer(w.ARRAY_BUFFER,h),w.vertexAttribPointer(u,b,l,y,0,0)))}else if("instanceMatrix"===r)void 0!==(f=T.get(t.instanceMatrix))&&(h=f.buffer,l=f.type,S.enableAttributeAndDivisor(u+0,1),S.enableAttributeAndDivisor(u+1,1),S.enableAttributeAndDivisor(u+2,1),S.enableAttributeAndDivisor(u+3,1),w.bindBuffer(w.ARRAY_BUFFER,h),w.vertexAttribPointer(u+0,4,l,!1,64,0),w.vertexAttribPointer(u+1,4,l,!1,64,16),w.vertexAttribPointer(u+2,4,l,!1,64,32),w.vertexAttribPointer(u+3,4,l,!1,64,48));else if(void 0!==a){var g=a[r];if(void 0!==g)switch(g.length){case 2:w.vertexAttrib2fv(u,g);break;case 3:w.vertexAttrib3fv(u,g);break;case 4:w.vertexAttrib4fv(u,g);break;default:w.vertexAttrib1fv(u,g)}}}}S.disableUnusedAttributes()}(r,e,i,t),null!==s)&&w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,f.buffer),(null!==s?s:a).count),t=e.drawRange.start*u,f=e.drawRange.count*u,s=null!==o?o.start*u:0,a=null!==o?o.count*u:1/0,o=Math.max(t,s),u=Math.min(n,t+f,s+a)-1,n=Math.max(0,u-o+1);0!==n&&(r.isMesh?!0===i.wireframe?(S.setLineWidth(i.wireframeLinewidth*ut()),c.setMode(w.LINES)):c.setMode(w.TRIANGLES):r.isLine?(t=i.linewidth,S.setLineWidth((t=void 0===t?1:t)*ut()),r.isLineSegments?c.setMode(w.LINES):r.isLineLoop?c.setMode(w.LINE_LOOP):c.setMode(w.LINE_STRIP)):r.isPoints?c.setMode(w.POINTS):r.isSprite&&c.setMode(w.TRIANGLES),r.isInstancedMesh?c.renderInstances(e,o,n,r.count):e.isInstancedBufferGeometry?c.renderInstances(e,o,n,e.maxInstancedCount):c.render(o,n))},this.compile=function(e,t){(A=u.get(e,t)).init(),e.traverse(function(t){t.isLight&&(A.pushLight(t),t.castShadow)&&A.pushShadow(t)}),A.setupLights(t);var i={};e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var n=0;n<t.material.length;n++)t.material[n].uuid in i==!1&&(_t(t.material[n],e,t),i[t.material[n].uuid]=!0);else t.material.uuid in i==!1&&(_t(t.material,e,t),i[t.material.uuid]=!0)})};var yt=null;var bt=new Ko;function gt(t,n,e,i){for(var r=0,o=t.length;r<o;r++){var s=t[r],a=s.object,u=s.geometry,c=void 0===i?s.material:i,f=s.group;if(e.isArrayCamera)for(var h=(tt=e).cameras,l=0,d=h.length;l<d;l++){var v=h[l];a.layers.test(v.layers)&&(S.viewport(p.copy(v.viewport)),A.setupLights(v),wt(a,n,v,u,c,f))}else tt=null,wt(a,n,e,u,c,f)}}function wt(t,n,e,i,r,o){var s,a;r&&r.opacity<.001||(t.onBeforeRender(M,n,e,i,r,o),A=u.get(n,tt||e),t.userData.resetLight&&A.setupLights(e),t.modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject?(s=Et(e,n,r,t),S.setMaterial(r),v.geometry=null,v.program=null,v.wireframe=!1,a=s,t.render(function(t){M.renderBufferImmediate(t,a)})):M.renderBufferDirect(e,n,i,r,t,o),t.onAfterRender(M,n,e,i,r,o),A=u.get(n,tt||e))}function _t(t,n,e){var i=m.get(t),r=A.state.lights,o=A.state.shadowsArray,s=r.state.version,o=h.getParameters(t,r.state,o,n,j.numPlanes,j.numIntersection,e),e=h.getProgramCacheKey(o),a=i.program,u=!0;if(void 0===a)t.addEventListener("dispose",vt);else if(a.cacheKey!==e)pt(t);else{if(i.lightsStateVersion!==s)i.lightsStateVersion=s;else if(void 0!==o.shaderID)return;u=!1}u&&(a=h.acquireProgram(o,e),i.program=a,i.uniforms=o.uniforms,i.environment=t.isMeshStandardMaterial?n.environment:null,i.outputEncoding=M.outputEncoding,t.program=a);var c=a.getAttributes();if(t.morphTargets)for(var f=t.numSupportedMorphTargets=0;f<M.maxMorphTargets;f++)0<=c["morphTarget"+f]&&t.numSupportedMorphTargets++;if(t.morphNormals)for(f=t.numSupportedMorphNormals=0;f<M.maxMorphNormals;f++)0<=c["morphNormal"+f]&&t.numSupportedMorphNormals++;u=i.uniforms,(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(i.numClippingPlanes=j.numPlanes,i.numIntersection=j.numIntersection,u.clippingPlanes=j.uniform),i.fog=n.fog,i.needsLights=(e=t).isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights,i.lightsStateVersion=s,i.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotShadowMatrix.value=r.state.spotShadowMatrix,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix),o=i.program.getUniforms(),a=Lu.seqWithValue(o.seq,u);i.uniformsList=a}function Et(t,n,e,i){b.resetTextureUnits();var r,o,s,a,u=n.fog,c=e.isMeshStandardMaterial?n.environment:null,f=m.get(e),h=A.state.lights,l=(st&&(at||t!==L)&&(l=t===L&&e.id===O,j.setState(e.clippingPlanes,e.clipIntersection,e.clipShadows,t,f,l)),e.version===f.oo?(void 0===f.program||e.fog&&f.fog!==u||f.environment!==c||f.needsLights&&f.lightsStateVersion!==h.state.version||void 0!==f.numClippingPlanes&&(f.numClippingPlanes!==j.numPlanes||f.numIntersection!==j.numIntersection)||f.outputEncoding!==M.outputEncoding)&&_t(e,n,i):(_t(e,n,i),f.oo=e.version),!1),h=!1,n=!1,d=f.program,v=d.getUniforms(),p=f.uniforms;return S.useProgram(d.program)&&(n=h=l=!0),e.id!==O&&(O=e.id,h=!0),(l||L!==t)&&(v.setValue(w,"projectionMatrix",t.projectionMatrix),E.logarithmicDepthBuffer&&v.setValue(w,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),L!==t&&(L=t,n=h=!0),(e.isShaderMaterial||e.isMeshPhongMaterial||e.isMeshToonMaterial||e.isMeshStandardMaterial||e.envMap)&&void 0!==(l=v.map.cameraPosition)&&l.setValue(w,I.setFromMatrixPosition(t.matrixWorld)),(e.isMeshPhongMaterial||e.isMeshToonMaterial||e.isMeshLambertMaterial||e.isMeshBasicMaterial||e.isMeshStandardMaterial||e.isShaderMaterial)&&v.setValue(w,"isOrthographic",!0===t.isOrthographicCamera),e.isMeshPhongMaterial||e.isMeshToonMaterial||e.isMeshLambertMaterial||e.isMeshBasicMaterial||e.isMeshStandardMaterial||e.isShaderMaterial||e.skinning)&&v.setValue(w,"viewMatrix",t.matrixWorldInverse),e.skinning&&(v.setOptional(w,i,"bindMatrix"),v.setOptional(w,i,"bindMatrixInverse"),l=i.skeleton)&&(t=l.bones,E.floatVertexTextures?(void 0===l.boneTexture&&(t=Math.sqrt(4*t.length),t=Tt.ceilPowerOfTwo(t),t=Math.max(t,4),(a=new Float32Array(t*t*4)).set(l.boneMatrices),s=new Zo(a,t,t,he,ie),l.boneMatrices=a,l.boneTexture=s,l.boneTextureSize=t),v.setValue(w,"boneTexture",l.boneTexture,b),v.setValue(w,"boneTextureSize",l.boneTextureSize)):v.setOptional(w,l,"boneMatrices")),!h&&f.receiveShadow===i.receiveShadow||(f.receiveShadow=i.receiveShadow,v.setValue(w,"receiveShadow",i.receiveShadow)),h&&(v.setValue(w,"toneMappingExposure",M.toneMappingExposure),v.setValue(w,"toneMappingWhitePoint",M.toneMappingWhitePoint),f.needsLights&&(a=n,(s=p).ambientLightColor.needsUpdate=a,s.lightProbe.needsUpdate=a,s.directionalLights.needsUpdate=a,s.directionalLightShadows.needsUpdate=a,s.pointLights.needsUpdate=a,s.pointLightShadows.needsUpdate=a,s.spotLights.needsUpdate=a,s.spotLightShadows.needsUpdate=a,s.rectAreaLights.needsUpdate=a,s.hemisphereLights.needsUpdate=a),u&&e.fog&&(t=u,(l=p).fogColor.value.copy(t.color),t.isFog?(l.fogNear.value=t.near,l.fogFar.value=t.far):t.isFogExp2&&(l.fogDensity.value=t.density)),e.isMeshBasicMaterial?k(p,e):e.isMeshLambertMaterial?(k(p,e),h=p,(n=e).emissiveMap&&(h.emissiveMap.value=n.emissiveMap)):e.isMeshToonMaterial?(k(p,e),u=e,(t=p).specular.value.copy(u.specular),t.shininess.value=Math.max(u.shininess,1e-4),u.gradientMap&&(t.gradientMap.value=u.gradientMap),u.emissiveMap&&(t.emissiveMap.value=u.emissiveMap),u.bumpMap&&(t.bumpMap.value=u.bumpMap,t.bumpScale.value=u.bumpScale,u.side===sn)&&(t.bumpScale.value*=-1),u.normalMap&&(t.normalMap.value=u.normalMap,t.normalScale.value.copy(u.normalScale),u.side===sn)&&t.normalScale.value.negate(),u.displacementMap&&(t.displacementMap.value=u.displacementMap,t.displacementScale.value=u.displacementScale,t.displacementBias.value=u.displacementBias)):e.isMeshPhongMaterial?(k(p,e),h=e,(n=p).specular.value.copy(h.specular),n.shininess.value=Math.max(h.shininess,1e-4),h.emissiveMap&&(n.emissiveMap.value=h.emissiveMap),h.bumpMap&&(n.bumpMap.value=h.bumpMap,n.bumpScale.value=h.bumpScale,h.side===sn)&&(n.bumpScale.value*=-1),h.normalMap&&(n.normalMap.value=h.normalMap,n.normalScale.value.copy(h.normalScale),h.side===sn)&&n.normalScale.value.negate(),h.displacementMap&&(n.displacementMap.value=h.displacementMap,n.displacementScale.value=h.displacementScale,n.displacementBias.value=h.displacementBias)):e.isMeshStandardMaterial?(k(p,e,c),e.isMeshPhysicalMaterial?(St(t=p,u=e,c),t.reflectivity.value=u.reflectivity,t.clearcoat.value=u.clearcoat,t.clearcoatRoughness.value=u.clearcoatRoughness,u.sheen&&t.sheen.value.copy(u.sheen),u.clearcoatMap&&(t.clearcoatMap.value=u.clearcoatMap),u.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=u.clearcoatRoughnessMap),u.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(u.clearcoatNormalScale),t.clearcoatNormalMap.value=u.clearcoatNormalMap,u.side===sn)&&t.clearcoatNormalScale.value.negate(),t.transparency.value=u.transparency):St(p,e,c)):e.isMeshMatcapMaterial?(k(p,e),n=p,(h=e).matcap&&(n.matcap.value=h.matcap),h.bumpMap&&(n.bumpMap.value=h.bumpMap,n.bumpScale.value=h.bumpScale,h.side===sn)&&(n.bumpScale.value*=-1),h.normalMap&&(n.normalMap.value=h.normalMap,n.normalScale.value.copy(h.normalScale),h.side===sn)&&n.normalScale.value.negate(),h.displacementMap&&(n.displacementMap.value=h.displacementMap,n.displacementScale.value=h.displacementScale,n.displacementBias.value=h.displacementBias)):e.isMeshDepthMaterial?(k(p,e),t=p,(u=e).displacementMap&&(t.displacementMap.value=u.displacementMap,t.displacementScale.value=u.displacementScale,t.displacementBias.value=u.displacementBias)):e.isMeshDistanceMaterial?(k(p,e),c=p,(n=e).displacementMap&&(c.displacementMap.value=n.displacementMap,c.displacementScale.value=n.displacementScale,c.displacementBias.value=n.displacementBias),c.referencePosition.value.copy(n.referencePosition),c.nearDistance.value=n.nearDistance,c.farDistance.value=n.farDistance):e.isMeshNormalMaterial?(k(p,e),h=p,(t=e).bumpMap&&(h.bumpMap.value=t.bumpMap,h.bumpScale.value=t.bumpScale,t.side===sn)&&(h.bumpScale.value*=-1),t.normalMap&&(h.normalMap.value=t.normalMap,h.normalScale.value.copy(t.normalScale),t.side===sn)&&h.normalScale.value.negate(),t.displacementMap&&(h.displacementMap.value=t.displacementMap,h.displacementScale.value=t.displacementScale,h.displacementBias.value=t.displacementBias)):e.isLineBasicMaterial?(u=e,(c=p).diffuse.value.copy(u.color),c.opacity.value=u.opacity,e.isLineDashedMaterial&&(n=e,(h=p).dashSize.value=n.dashSize,h.totalSize.value=n.dashSize+n.gapSize,h.scale.value=n.scale)):e.isPointsMaterial?(t=e,(c=p).diffuse.value.copy(t.color),c.opacity.value=t.opacity,c.size.value=t.size*N,c.scale.value=.5*R,t.map&&(c.map.value=t.map),t.alphaMap&&(c.alphaMap.value=t.alphaMap),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),c.uvTransform.value.copy(r.matrix))):e.isSpriteMaterial?(u=e,(h=p).diffuse.value.copy(u.color),h.opacity.value=u.opacity,h.rotation.value=u.rotation,u.map&&(h.map.value=u.map),u.alphaMap&&(h.alphaMap.value=u.alphaMap),u.map?o=u.map:u.alphaMap&&(o=u.alphaMap),void 0!==o&&(!0===o.matrixAutoUpdate&&o.updateMatrix(),h.uvTransform.value.copy(o.matrix))):e.isShadowMaterial&&(p.color.value.copy(e.color),p.opacity.value=e.opacity),void 0!==p.ltc_1&&(p.ltc_1.value=Lt.LTC_1),void 0!==p.ltc_2&&(p.ltc_2.value=Lt.LTC_2),Lu.upload(w,f.uniformsList,p,b),e.isShaderMaterial)&&(e.uniformsNeedUpdate=!1),e.isShaderMaterial&&!0===e.uniformsNeedUpdate&&(Lu.upload(w,f.uniformsList,p,b),e.uniformsNeedUpdate=!1),e.isSpriteMaterial&&v.setValue(w,"center",i.center),v.setValue(w,"modelViewMatrix",i.modelViewMatrix),v.setValue(w,"normalMatrix",i.normalMatrix),v.setValue(w,"modelMatrix",i.matrixWorld),d}function k(t,n,e){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);var i,r,e=n.envMap||e;e&&(t.envMap.value=e,t.flipEnvMap.value=e.isCubeTexture?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio,t.maxMipLevel.value=m.get(e).qr),n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap&&(i=n.emissiveMap),void 0!==i&&(!0===(i=i.isWebGLRenderTarget?i.texture:i).matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix)),n.aoMap?r=n.aoMap:n.lightMap&&(r=n.lightMap),void 0!==r&&(!0===(r=r.isWebGLRenderTarget?r.texture:r).matrixAutoUpdate&&r.updateMatrix(),t.uv2Transform.value.copy(r.matrix))}function St(t,n,e){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,n.side===sn)&&(t.bumpScale.value*=-1),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),n.side===sn)&&t.normalScale.value.negate(),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),(n.envMap||e)&&(t.envMapIntensity.value=n.envMapIntensity)}bt.setAnimationLoop(function(t){C.isPresenting||yt&&yt(t)}),"undefined"!=typeof window&&bt.setContext(window),this.setAnimationLoop=function(t){yt=t,C.setAnimationLoop(t),bt.start()},this.render=function(t,n){var e,i,r;void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),i=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),n&&n.isCamera?q||(v.geometry=null,v.program=null,v.wireframe=!1,O=-1,!(L=null)===t.autoUpdate&&t.updateMatrixWorld(),null===n.parent&&n.updateMatrixWorld(),C.enabled&&C.isPresenting&&(n=C.getCamera(n)),(A=u.get(t,n)).init(),t.onBeforeRender(M,t,n,i||a),F.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),ot.setFromProjectionMatrix(F),at=this.localClippingEnabled,st=j.init(this.clippingPlanes,at,n),(x=o.get(t,n)).init(),function t(n,e,i,r){if(!1===n.visible)return;var o=n.layers.test(e.layers);if(o)if(n.isGroup)i=n.renderOrder;else if(n.isLOD)!0===n.autoUpdate&&n.update(e);else if(n.isLight)A.pushLight(n),n.castShadow&&A.pushShadow(n);else if(n.isSprite)n.frustumCulled&&!ot.intersectsSprite(n)||(r&&I.setFromMatrixPosition(n.matrixWorld).applyMatrix4(F),c=g.update(n),(f=n.material).visible&&x.push(n,c,f,i,I.z,null));else if(n.isImmediateRenderObject)r&&I.setFromMatrixPosition(n.matrixWorld).applyMatrix4(F),x.push(n,null,n.material,i,I.z,null);else if((n.isMesh||n.isLine||n.isPoints)&&(n.isSkinnedMesh&&n.skeleton.frame!==y.render.frame&&(n.skeleton.update(),n.skeleton.frame=y.render.frame),!n.frustumCulled||ot.intersectsObject(n))){r&&(o=e.position.clone(),u=new kt,n.geometry.boundingBox||n.geometry.computeBoundingBox(),n.geometry.boundingSphere||n.geometry.computeBoundingSphere(),a=n.geometry.boundingSphere,u.copy(a).applyMatrix4(n.matrixWorld),a=n.geometry.boundingBox,(s=new Ft).copy(a).applyMatrix4(n.matrixWorld),a=new Mo(o,u.center.clone().sub(o).normalize()),u=new xt,a.intersectBox(s,u),I.z=u.distanceTo(o),isNaN(I.z)||I.z<=0)&&I.setFromMatrixPosition(n.matrixWorld).applyMatrix4(F);var s,a,u,c=g.update(n),f=n.material;if(Array.isArray(f))for(var h=c.groups,l=0,d=h.length;l<d;l++){var v=h[l],p=f[v.materialIndex];p&&p.visible&&x.push(n,c,p,i,I.z,v)}else f.visible&&x.push(n,c,f,i,I.z,null)}var m=n.children;for(l=0,d=m.length;l<d;l++)t(m[l],e,i,r)}(t,n,0,M.sortObjects),x.finish(),!0===M.sortObjects&&x.sort(et,it),st&&j.beginShadows(),e=A.state.shadowsArray,ht.render(e,t,n),A.setupLights(n),st&&j.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==i&&this.setRenderTarget(i),s.render(x,t,n,r),e=x.opaque,i=x.transparent,t.overrideMaterial?(r=t.overrideMaterial,e.length&&gt(e,t,n,r),i.length&&gt(i,t,n,r)):(e.length&&gt(e,t,n),i.length&&gt(i,t,n)),t.onAfterRender(M,t,n),null!==a&&(b.updateRenderTargetMipmap(a),b.updateMultisampleRenderTarget(a)),S.buffers.depth.setTest(!0),S.buffers.depth.setMask(!0),S.buffers.color.setMask(!0),S.setPolygonOffset(!1),A=x=null):console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(t){K!==t&&null===a&&w.bindFramebuffer(w.FRAMEBUFFER,t),K=t},this.getActiveCubeFace=function(){return J},this.getActiveMipmapLevel=function(){return $},this.getRenderTarget=function(){return a},this.setRenderTarget=function(t,n,e){J=n,$=e,(a=t)&&void 0===m.get(t).$r&&b.setupRenderTarget(t);var i,r=K,o=!1;nt=t?(i=m.get(t).$r,t.isWebGLCubeRenderTarget?(r=i[n||0],o=!0):r=t.isWebGLMultisampleRenderTarget?m.get(t).eo:i,p.copy(t.viewport),c.copy(t.scissor),t.scissorTest):(p.copy(f).multiplyScalar(N).floor(),c.copy(P).multiplyScalar(N).floor(),rt),d!==r&&(w.bindFramebuffer(w.FRAMEBUFFER,r),d=r),S.viewport(p),S.scissor(c),S.setScissorTest(nt),o&&(i=m.get(t.texture),w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+(n||0),i.Jr,e||0))},this.readRenderTargetPixels=function(t,n,e,i,r,o,s){if(t&&t.isWebGLRenderTarget){var a=m.get(t).$r;if(a=t.isWebGLCubeRenderTarget&&void 0!==s?a[s]:a){s=!1;a!==d&&(w.bindFramebuffer(w.FRAMEBUFFER,a),s=!0);try{var u=t.texture,c=u.format,f=u.type;c!==he&&l.convert(c)!==w.getParameter(w.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):f===Kn||l.convert(f)===w.getParameter(w.IMPLEMENTATION_COLOR_READ_TYPE)||f===ie&&(E.isWebGL2||_.get("OES_texture_float")||_.get("WEBGL_color_buffer_float"))||f===re&&(E.isWebGL2?_.get("EXT_color_buffer_float"):_.get("EXT_color_buffer_half_float"))?w.checkFramebufferStatus(w.FRAMEBUFFER)===w.FRAMEBUFFER_COMPLETE?0<=n&&n<=t.width-i&&0<=e&&e<=t.height-r&&w.readPixels(n,e,i,r,l.convert(c),l.convert(f),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{s&&w.bindFramebuffer(w.FRAMEBUFFER,d)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,n,e){void 0===e&&(e=0);var i=Math.pow(2,-e),r=Math.floor(n.image.width*i),i=Math.floor(n.image.height*i),o=l.convert(n.format);b.setTexture2D(n,0),w.copyTexImage2D(w.TEXTURE_2D,e,o,t.x,t.y,r,i,0),S.unbindTexture()},this.copyTextureToTexture=function(t,n,e,i){var r=n.image.width,o=n.image.height,s=l.convert(e.format),a=l.convert(e.type);b.setTexture2D(e,0),n.isDataTexture?w.texSubImage2D(w.TEXTURE_2D,i||0,t.x,t.y,r,o,s,a,n.image.data):w.texSubImage2D(w.TEXTURE_2D,i||0,t.x,t.y,s,a,n.image),S.unbindTexture()},this.initTexture=function(t){b.setTexture2D(t,0),S.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}gc.prototype=Object.assign(Object.create(dt.prototype),{constructor:gc,isArrayCamera:!0}),wc.prototype=Object.assign(Object.create(a.prototype),{constructor:wc,isGroup:!0}),Object.assign(_c.prototype,D.prototype);var n={vert:"\n                      \n                        uniform vec2 offset;\n                        uniform float rotation;\n                        uniform vec2 scale;\n                        varying vec2 vUv;\n                        void main() {\n                          vUv = uv;\n                  \n                          \n                          vec2 rotatedPosition;\n                            rotatedPosition.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\n                            rotatedPosition.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n                      \n        \n                            rotatedPosition.x *= scale.x * abs(projectionMatrix[0][0] / projectionMatrix[1][1]);\n                            rotatedPosition.y *= scale.y;\n                          \n                          rotatedPosition.xy += offset;\n                          gl_Position = vec4(rotatedPosition,0.0,1.0);\n                        }\n                        ",frag:"\n                    uniform vec3 diffuse;\n                    uniform sampler2D mmap;\n                    #include <common>\n                    varying vec2 vUv;\n               \n                    void main() {\n                \n                        // vec2 muv = vec2(vUv.x , 1.0 - vUv.y);\n                        vec4 diffuseColor = texture2D( mmap, vUv );\n                       \n                        \n                        gl_FragColor = diffuseColor;\n                    }\n                    "},Sc=n;function Tc(t){return(Tc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xc(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Tc(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Tc(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Tc(t)?t:String(t)}(i.key),i)}}function Ac(t,n,e){n=Oc(n);var i=t,n=Mc()?Reflect.construct(n,e||[],Oc(t).constructor):n.apply(t,e);if(n&&("object"===Tc(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function Mc(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Mc=function(){return!!t})()}function Oc(t){return(Oc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Lc(t,n){return(Lc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Rc=function(){var t,n,e=r,i=Hs;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(t){if(this instanceof r)return(t=Ac(this,r,[t])).uniforms.offset={value:new Mt},t.uniforms.rotation={value:0},t.uniforms.scale={value:new Mt(1,1)},t.depthTest=!1,t.vertexShader=Sc.vert,t.fragmentShader=Sc.frag,t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Lc(e,i),e=r,t&&xc(e.prototype,t),n&&xc(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}();function Nc(t,n){this.array=t,this.stride=n,this.count=void 0!==t?t.length/n:0,this.usage=wi,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(Nc.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Nc.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,n,e){t*=this.stride,e*=n.stride;for(var i=0,r=this.stride;i<r;i++)this.array[t+i]=n.array[e+i];return this},set:function(t,n){return this.array.set(t,n=void 0===n?0:n),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}});var Pc=new xt;function jc(t,n,e,i){this.data=t,this.itemSize=n,this.offset=e,this.normalized=!0===i}function Fc(t){return(Fc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ic(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Fc(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Fc(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Fc(t)?t:String(t)}(i.key),i)}}function Cc(t,n,e){n=Dc(n);var i=t,n=kc()?Reflect.construct(n,e||[],Dc(t).constructor):n.apply(t,e);if(n&&("object"===Fc(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function kc(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(kc=function(){return!!t})()}function Dc(t){return(Dc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Uc(t,n){return(Uc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}Object.defineProperties(jc.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(jc.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(var n=0,e=this.data.count;n<e;n++)Pc.x=this.getX(n),Pc.y=this.getY(n),Pc.z=this.getZ(n),Pc.applyMatrix4(t),this.setXYZ(n,Pc.x,Pc.y,Pc.z);return this},setX:function(t,n){return this.data.array[t*this.data.stride+this.offset]=n,this},setY:function(t,n){return this.data.array[t*this.data.stride+this.offset+1]=n,this},setZ:function(t,n){return this.data.array[t*this.data.stride+this.offset+2]=n,this},setW:function(t,n){return this.data.array[t*this.data.stride+this.offset+3]=n,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,n,e){return t=t*this.data.stride+this.offset,this.data.array[t+0]=n,this.data.array[t+1]=e,this},setXYZ:function(t,n,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=n,this.data.array[t+1]=e,this.data.array[t+2]=i,this},setXYZW:function(t,n,e,i,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=n,this.data.array[t+1]=e,this.data.array[t+2]=i,this.data.array[t+3]=r,this}});var Bc=function(){var t,n,e=r,i=N;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(){var t,n;if(this instanceof r)return t=Cc(this,r),n=new Nc(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5),t.setIndex([0,1,2,0,2,3]),t.setAttribute("position",new jc(n,3,0,!1)),t.setAttribute("uv",new jc(n,2,3,!1)),t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Uc(e,i),e=r,t&&Ic(e.prototype,t),n&&Ic(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}();function Gc(t,n,e,i,r,o,s,a,u){l.call(this,t,n,e,i,r,o,s,a,u),this.needsUpdate=!0}function Hc(t,n,e,i,r,o){var s=(t+e)/2,a=(n+i)/2,u=((t-e)*(t-e)+(n-i)*(n-i))/4,c=Math.sqrt(u),c=c*(c/Math.sqrt(r*r-u)),r=Math.PI/2,u=(e-t)/(n-i),f=(t-e)/(n-i),h=Math.sqrt(1+u*u),l=Math.sqrt(1+f*f),u={x:s+c*(1/h),y:a+c*(u/h),theta:r},h={x:s+c*(-1/l),y:a+c*(f/l),theta:r};return 0<(e-t)*(u.y-n)-(i-n)*(u.x-t)?0===o?u:h:0===o?h:u}function Xc(t,n,e,i){for(var r=0;r<t.length;r++)switch(t[r]){case"m":n.moveTo(i.x+parseFloat(t[r+1]),i.y+parseFloat(t[r+2])),e.x=i.x+parseFloat(t[r+1]),e.y=i.y+parseFloat(t[r+2]),i.x=e.x,i.y=e.y,r+=2;break;case"M":n.moveTo(parseFloat(t[r+1]),parseFloat(t[r+2])),e.x=parseFloat(t[r+1]),e.y=parseFloat(t[r+2]),i.x=e.x,i.y=e.y,r+=2;break;case"l":n.lineTo(e.x+parseFloat(t[r+1]),e.y+parseFloat(t[r+2])),e.x=e.x+parseFloat(t[r+1]),e.y=e.y+parseFloat(t[r+2]),r+=2;break;case"L":n.lineTo(parseFloat(t[r+1]),parseFloat(t[r+2])),e.x=parseFloat(t[r+1]),e.y=parseFloat(t[r+2]),r+=2;break;case"A":var o=parseFloat(t[r+1]),s=parseFloat(t[r+2]),a=(parseFloat(t[r+3]),Math.PI,parseFloat(t[r+4]),parseFloat(t[r+5])),u=e.x,c=e.y,f=parseFloat(t[r+6]),h=parseFloat(t[r+7]);o===s&&(l=Hc(u,c,f,h,o,a),n.arcTo(l.x,l.y,f,h,l.theta),e.x=f,e.y=h),r+=7;break;case"a":var l,o=parseFloat(t[r+1]),s=parseFloat(t[r+2]),a=(parseFloat(t[r+3]),Math.PI,parseFloat(t[r+4]),parseFloat(t[r+5])),u=e.x,c=e.y,f=u+parseFloat(t[r+6]),h=c+parseFloat(t[r+7]);o===s&&(l=Hc(u,c,f,h,o,a),n.arcTo(l.x,l.y,f,h,l.theta),e.x=f,e.y=h),r+=7;break;case"h":n.lineTo(e.x+parseFloat(t[r+1]),e.y),e.x=e.x+parseFloat(t[r+1]),r+=1;break;case"H":n.lineTo(parseFloat(t[r+1]),e.y),e.x=parseFloat(t[r+1]),r+=1;break;case"z":case"Z":n.lineTo(i.x,i.y)}}Gc.prototype=Object.create(l.prototype);var zc=["M","0","15.07","L","0.69","1.92","A","2","2","0","0","1","2.66","0","L","11.8","0","l","-0.07","1.37","H","3.09","A","1.09","1.09","0","0","0","2","2.44","l","-0.2","4.44","h","9.37","l","-0.07","1.37","H","1.72","l","-0.36","6.82","Z"],Vc=["M","13.79","11","l","-0.08","1.63","a","1","1","0","0","0","1","1.08","h","8.53","l","-0.07","1.36","h","-9","A","1.84","1.84","0","0","1","12.31","13","l","0.48","-9.16","h","8.9","a","2","2","0","0","1","2","2","L","23.53","9","A","2.11","2.11","0","0","1","21.47","11","Z","m","8.4","-2.49","l","0.08","-2.16","a","1.07","1.07","0","0","0","-1.09","-1.09","H","14.09","l","-0.22","4.33","H","21","A","1.15","1.15","0","0","0","22.19","8.51","Z"],Wc=["M","33.94","3.86","a","1.93","1.93","0","0","1","2","1.95","l","-0.47","9.27","H","34.07","l","0.45","-8.72","a","1.09","1.09","0","0","0","-1.09","-1.1","H","26.3","l","-0.51","9.82","H","24.41","L","25","3.85","Z"],Yc=["M","36.48","17.72","H","45","a","1.16","1.16","0","0","0","1.16","-1.22","l","0.07","-1.43","H","38.72","a","2","2","0","0","1","-2","-2.06","l","0.37","-7.19","a","2","2","0","0","1","2.15","-2","H","48.2","l","-0.69","13.28","a","2.09","2.09","0","0","1","-2.06","2","h","-9","Z","m","9.85","-4.05","l","0.44","-8.45","H","39.53","a","1.07","1.07","0","0","0","-1.08","1.1","l","-0.32","6.27","a","1.16","1.16","0","0","0","1.1","1.1","Z"],Qc=["M","57.43","11.59","L","63.48","0","h","1.83","l","-0.79","15.05","H","63.15","l","0.67","-12.79","L","57.67","14","h","-0.75","L","52.07","2.34","l","-0.64","12.72","H","50","L","50.83","0","H","52.6","Z"],Zc=["M","69.6","10.2","l","-2.37","4.87","h","-1.5","L","73.09","0","h","1.49","l","5.77","15.05","h","-1.5","L","77","10.2","Z","m","6.86","-1.39","L","73.74","1.73","L","70.28","8.81","Z"],qc=["M","82.95","15.07","H","81.57","L","82.35","0","h","10","a","1.94","1.94","0","0","1","1.85","2","L","93.89","7.4","a","2","2","0","0","1","-2","1.92","H","83.25","Z","m","8.43","-7.15","a","1.13","1.13","0","0","0","1.09","-1.09","l","0.35","-4.37","a","1.1","1.1","0","0","0","-1.08","-1.06","H","83.66","l","-0.34","6.53","Z"];var Kc={ao:(Gc.prototype.constructor=Gc).prototype.isCanvasTexture=!0};function Jc(){Jc=function(){return s};var u,s={},t=Object.prototype,c=t.hasOwnProperty,f=Object.defineProperty||function(t,n,e){t[n]=e.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",e=n.asyncIterator||"@@asyncIterator",r=n.toStringTag||"@@toStringTag";function o(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{o({},"")}catch(u){o=function(t,n,e){return t[n]=e}}function a(t,n,e,i){var r,o,s,a,n=n&&n.prototype instanceof y?n:y,n=Object.create(n.prototype),i=new A(i||[]);return f(n,"_invoke",{value:(r=t,o=e,s=i,a=l,function(t,n){if(a===v)throw new Error("Generator is already running");if(a===p){if("throw"===t)throw n;return{value:u,done:!0}}for(s.method=t,s.arg=n;;){var e=s.delegate;if(e){e=function t(n,e){var i=e.method,r=n.iterator[i];if(r===u)return e.delegate=null,"throw"===i&&n.iterator.return&&(e.method="return",e.arg=u,t(n,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),m;i=h(r,n.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,m;r=i.arg;return r?r.done?(e[n.resultName]=r.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=u),e.delegate=null,m):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}(e,s);if(e){if(e===m)continue;return e}}if("next"===s.method)s.sent=s.Mt=s.arg;else if("throw"===s.method){if(a===l)throw a=p,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);a=v;e=h(r,o,s);if("normal"===e.type){if(a=s.done?p:d,e.arg===m)continue;return{value:e.arg,done:s.done}}"throw"===e.type&&(a=p,s.method="throw",s.arg=e.arg)}})}),n}function h(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}s.wrap=a;var l="suspendedStart",d="suspendedYield",v="executing",p="completed",m={};function y(){}function b(){}function g(){}var n={},w=(o(n,i,function(){return this}),Object.getPrototypeOf),w=w&&w(w(M([]))),_=(w&&w!==t&&c.call(w,i)&&(n=w),g.prototype=y.prototype=Object.create(n));function E(t){["next","throw","return"].forEach(function(n){o(t,n,function(t){return this._invoke(n,t)})})}function S(s,a){var n;f(this,"_invoke",{value:function(e,i){function t(){return new a(function(t,n){!function n(t,e,i,r){var o,t=h(s[t],s,e);if("throw"!==t.type)return(e=(o=t.arg).value)&&"object"==tf(e)&&c.call(e,"__await")?a.resolve(e.Ot).then(function(t){n("next",t,i,r)},function(t){n("throw",t,i,r)}):a.resolve(e).then(function(t){o.value=t,i(o)},function(t){return n("throw",t,i,r)});r(t.arg)}(e,i,t,n)})}return n=n?n.then(t,t):t()}})}function T(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function x(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function M(n){if(n||""===n){var e,t=n[i];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return e=-1,(t=function t(){for(;++e<n.length;)if(c.call(n,e))return t.value=n[e],t.done=!1,t;return t.value=u,t.done=!0,t}).next=t}throw new TypeError(tf(n)+" is not iterable")}return f(_,"constructor",{value:b.prototype=g,configurable:!0}),f(g,"constructor",{value:b,configurable:!0}),b.displayName=o(g,r,"GeneratorFunction"),s.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},s.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,o(t,r,"GeneratorFunction")),t.prototype=Object.create(_),t},s.awrap=function(t){return{Ot:t}},E(S.prototype),o(S.prototype,e,function(){return this}),s.AsyncIterator=S,s.async=function(t,n,e,i,r){void 0===r&&(r=Promise);var o=new S(a(t,n,e,i),r);return s.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},E(_),o(_,r,"Generator"),o(_,i,function(){return this}),o(_,"toString",function(){return"[object Generator]"}),s.keys=function(t){var n,e=Object(t),i=[];for(n in e)i.push(n);return i.reverse(),function t(){for(;i.length;){var n=i.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},s.values=M,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this.Mt=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(x),!t)for(var n in this)"t"===n.charAt(0)&&c.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=u)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function t(t,n){return o.type="throw",o.arg=e,i.next=t,n&&(i.method="next",i.arg=u),!!n}for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var s=c.call(r,"catchLoc"),a=c.call(r,"finallyLoc");if(s&&a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var o=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=n&&n<=r.finallyLoc?null:r)?r.completion:{};return o.type=t,o.arg=n,r?(this.method="next",this.next=r.finallyLoc,m):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),m},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),x(e),m}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e,i,r=this.tryEntries[n];if(r.tryLoc===t)return"throw"===(e=r.completion).type&&(i=e.arg,x(r)),i}throw new Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:M(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=u),m}},s}function $c(t,n,e,i,r,o,s){try{var a=t[o](s),u=a.value}catch(t){return void e(t)}a.done?n(u):Promise.resolve(u).then(i,r)}function tf(t){return(tf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nf(t){return function(t){if(Array.isArray(t))return ef(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){var e;if(t)return"string"==typeof t?ef(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?ef(t,n):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ef(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function rf(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=tf(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=tf(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==tf(t)?t:String(t)}(i.key),i)}}function of(t){r=st.a.document.createElement("canvas"),o=r.getContext("2d"),r.width=500,r.height=120,r.style.width="500px",r.style.height="120px",i={x:0,y:0},e={x:0,y:0},o.transform(5,0,0,5,10,10),(s=o.createLinearGradient(5.9,15.07,5.9,0)).addColorStop(0,"#232323"),s.addColorStop(1,"#585858"),o.fillStyle=s,o.beginPath(),Xc(zc,o,e,i),o.closePath(),o.fill(),o.beginPath(),Xc(Vc,o,e,i),o.closePath(),o.fill(),o.beginPath(),Xc(Wc,o,e,i),o.closePath(),o.fill(),o.beginPath(),Xc(Yc,o,e,i),o.closePath(),o.fill(),(s=o.createLinearGradient(57.68,15.07,57.68,0)).addColorStop(0,"#77bf00"),s.addColorStop(1,"#addc0c"),o.fillStyle=s,o.beginPath(),Xc(Qc,o,e,i),o.closePath(),o.fill(),o.beginPath(),Xc(Zc,o,e,i),o.closePath(),o.fill(),o.beginPath(),Xc(qc,o,e,i),o.closePath(),o.fill(),st.a.environment==G.a.BROWSER?n=new Gc(r):(s=r.toDataURL("image/png"),o.restore(),n=new l,st.a.textureHelper.createImage({url:s,onload:function(t){n.image=t,n.needsUpdate=!0}}));var n,e=n,i=new Mt(.4,.096),r=new Rc,o=-1*(.5*i.x/t-1),s=-1*(1-.5*i.y);return e.minFilter=B,e.generateMipmaps=!1,r.transparent=!0,r.depthTest=!1,r.uniforms={scale:{value:i},offset:{value:new Mt(o,s)},mmap:{value:e}},r.needsUpdate=!0,new ba(new Bc,r)}var n=function(){function i(t,n,e){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.uo=0,this.Ze=0,this.Lt=t,this.Ve=n,this.Ft=e,this.renderer=this.co(n.container,n.logarithmicDepthBuffer,n.preserveDrawingBuffer),this.Xr=new Map;e=this.Lt.getMapOptions().depthPeeling;e&&st.a.environment===G.a.BROWSER&&(this.fo=new st.a.DepthPeelingRenderer({map:t,renderManager:this,mode:e.mode,layers:e.layers,type:e.types})),this.ho=JSON.parse(JSON.stringify(n.renderOrder)),this.do=0,this.vo=!1,this.po=null,this.mo=Kc.ao,this.mo&&(this.po=of(this.renderer.domElement.clientWidth/this.renderer.domElement.clientHeight),this.po.frustumCulled=!1,this.xx45f6=this.po),this.yo=!1,this.bo=!1,this.Tt=this.renderer.domElement.clientWidth,this.wo=this.renderer.domElement.clientHeight,this.type="basic",this.Qt=!0,this.Vr=void 0,this._o=void 0,this.zr=[],this.Eo()}var t,n,e;return t=i,(n=[{key:"setTileLayScene",value:function(t){this.Vr=t}},{key:"getTileLayScene",value:function(){return this.Vr}},{key:"setGroundLayerScene",value:function(t){this._o=t}},{key:"getGroundLayerScene",value:function(){return this._o}},{key:"set3DTilesLayerSceneArr",value:function(t){this.zr.push(t)}},{key:"get3DTilesLayerSceneArr",value:function(){return this.zr}},{key:"needLogo",get:function(){return this.mo}},{key:"render",value:function(){var i=this,r=this;if(this.renderer&&(this.uo+=1,15e6<this.uo&&(this.uo=0),st.a.environment!==G.a.WX||1!=this.Ze||this.uo%2!=0)){this.Lt.Nt.qe.yn(),this.Lt.Nt.qe.bn(this.Xr),this.Lt.Nt.qe.bn([this.Vr,this._o].concat(nf(this.zr))),this.renderer.clear(),this.Vr&&this.renderer.render(this.Vr,this.Lt.ze),this._o&&this.renderer.render(this._o,this.Lt.ze);for(var t=0;t<this.zr.length;t++)this.renderer.render(this.zr[t],this.Lt.ze);this.Lt.getMapOptions().depthPeeling?this.fo.render():this.Xr.forEach(function(t){return i.renderer.render(t,i.Lt.ze)});var o={min:1/0,max:-1/0},s=(this.Lt.So.It.forEach(function(t){var e=[];t.To.forEach(function(t){var n;(function(t){for(var n=!1,e=Array.from(r.getRenderList()),i=0;i<e.length;i++)if(e[i][0].split("%A%B%C%D")[0]===t){n=!0;break}return n})(t.buildingID||i.Lt.getMapOptions().mapID)&&t.isCross&&(e.push(t),(n=Math.min(t.levelRange[0],t.levelRange[1]))<o.min&&(o.min=n),n=Math.max(t.levelRange[0],t.levelRange[1]),o.max<n)&&(o.max=n)}),e.forEach(function(t){i.renderer.render(t.line,i.Lt.ze)})}),this.ho.indexOf(S.LINE_MARKER));this.Xr.forEach(function(t,n){var n=n.split("%A%B%C%D"),e=n[1],n=n[2];+e===o.max&&(e=i.ho.indexOf(S.LAYER_NODE_TYPE.get(+n)),s<e)&&i.renderer.render(t,i.Lt.ze)}),this.Lt.So&&this.renderer.render(this.Lt.So.xo,this.Lt.ze),this.mo&&this.po&&this.renderer.render(this.po,this.Lt.ze)}}},{key:"resize",value:function(){this.renderer&&(5<Math.abs(this.renderer.domElement.parentElement.clientHeight-this.wo)||5<Math.abs(this.renderer.domElement.parentElement.clientWidth-this.Tt))&&(this.Ao(this.renderer.domElement.parentElement.clientWidth,this.renderer.domElement.parentElement.clientHeight),this.Tt=this.renderer.domElement.clientWidth,this.wo=this.renderer.domElement.clientHeight,this.Lt.Qe.Ye({type:"resize"}))}},{key:"getRenderList",value:function(){return this.Xr}},{key:"parent",get:function(){return this.Lt}},{key:"getWebGLRenderer",value:function(){return Ec}}])&&rf(t.prototype,n),e&&rf(t,e),Object.defineProperty(t,"prototype",{writable:!1}),i}(),sf=(Object.assign(n.prototype,{Mo:function(){for(var t in this.Lt=null,this.Ve=null,this.Ft=null,this)this[""+t]=null,delete this[""+t]},nn:function(){this.Qt=!1,this.Xr.clear(),st.a.window.cancelAnimationFrame(this.Oo)},co:function(t,n,e){n=new Ec({useWebGL2:this.Lt.getMapOptions().depthPeeling,antialias:!0,alpha:!0,logarithmicDepthBuffer:n,preserveDrawingBuffer:e,canvas:st.a.environment==G.a.BROWSER?void 0:t});return n.setPixelRatio(st.a.window.devicePixelRatio),st.a.environment===G.a.BROWSER&&n.setSize(t.clientWidth,t.clientHeight),n.autoClear=!1,n.domElement.style.position="absolute",n.domElement.style.top=0,n.domElement.style.zIndex=0,n.setClearAlpha(0),st.a.environment==G.a.BROWSER&&t.appendChild(n.domElement),n},Lo:function(t){this.renderer=t},Ro:function(t){t="3D"===t?this.Lt.Ke:this.Lt.Je;return t.updateMatrixWorld(!0),(new zt).setFromProjectionMatrix((new At).multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse))},No:function(t){for(var n=[],e=[],i=0;i<t.length;i++){var r=this.ho.indexOf(t[i]);-1!==r&&(n.push(r),e.push(t[i]))}n.sort(function(t,n){return t-n});for(var o=0;o<n.length;o++)this.ho[n[o]]=e[o];this.zi()},Po:function(t){this.ho=t,this.zi()},jo:function(t,n){var e=1,i=this.renderer.domElement.clientHeight,n=this.Lt.ze.isPerspectiveCamera?n?n/(i/(2*Math.tan(this.Lt.Ke.fov*f.DEG2RAD/2))):t.mapNode.Fo/(i/(2*Math.tan(this.Lt.Ke.fov*f.DEG2RAD/2))):n?n*Math.abs(this.Lt.ze.top-this.Lt.ze.bottom)/this.Lt.ze.zoom/i:t.mapNode.Fo*Math.abs(this.Lt.ze.top-this.Lt.ze.bottom)/this.Lt.ze.zoom/i;t.material.userData.scaleRatio&&(e=t.material.userData.scaleRatio),t.scale.set(n,n/e,n)},Ei:function(){var r=this;this.Xr.forEach(function(t){switch(t.userData.type){case"label":for(var n=0;n<t.children.length;n++)t.children[n].mapNode.Io(r.Lt.fi);break;case"facility":for(var e=0;e<t.children.length;e++)r.jo(t.children[e]);break;default:for(var i=0;i<t.children.length;i++)!t.children[i].mapNode||t.children[i].mapNode.type!==S.IMAGE_MARKER&&t.children[i].mapNode.type!==S.LOCATION_MARKER||t.children[i].mapNode.Co()}})},Ao:function(t,n){var e=this.Lt.Ke,i=this.Lt.Je,r=new Mt(.4,.096),o=-1*(.5*r.x/(t/n)-1),s=-1*(1-.5*r.y);for(e.aspect=t/n,e.updateProjectionMatrix(),i.left=-t/2,i.right=t/2,i.top=n/2,i.bottom=-n/2,i.updateProjectionMatrix(),this.po&&(this.po.material.uniforms.scale={value:r},this.po.material.uniforms.offset={value:new Mt(o,s)}),this.renderer.setSize(t,n),this.Ei(),this.Lt.enableUpdateRender(),this.Lt.enableUpdateNode(),this.Lt.fi.ko();0<this.Lt.fi.Do.length;)this.Lt.fi.Uo()},Bo:function(t,n){e=t.ndcPos||(st.a.environment===G.a.BROWSER&&(t.updateMatrixWorld(!0),t.parent.updateMatrixWorld(!0)),e=this.Lt.ze,(new xt).setFromMatrixPosition(t.matrixWorld).applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix));var e,i,r,o=t.mapNode.Fo;if(n){if("string"==typeof t.mapNode.text){if(!t.material.map.image)return;i=t.mapNode.type===S.LABEL?(o=t.material.map.image.height/2/1.2,t.material.map.image.width/2/1.2):(o*=t.mapNode.text.split("%rn%").length)/t.material.userData.scaleRatio}else i=(o*=t.mapNode.text.length)/t.material.userData.scaleRatio;void 0!==t.material.userData.style&&(n=t.material.userData.style,r=o*t.material.userData.itHeightRatio*1.1,"limage-rtext"===n||"ltext-rimage"===n?o<r&&(i=(o=r)/t.material.userData.scaleRatio):"timage-btext"===n||"ttext-bimage"===n?i=(o+=r)/t.material.userData.scaleRatio:"overlay-text"===n&&o<r&&(i=(o=r)/t.material.userData.scaleRatio))}else i=o;return o=o/this.renderer.domElement.clientHeight*2,i=i/this.renderer.domElement.clientWidth*2,{leftTop:new Mt(e.x-i/2,e.y+o/2),rightDown:new Mt(e.x+i/2,e.y-o/2)}},Go:function(l){var d=this;return new Promise(function(o,t){if(0===l.length)o();else{for(var n=[],e=new xt,s=[],i=0;i<l.length;i++){var r=l[i].children[0]||l[i];"Sprite"===r.type&&(r.updateMatrixWorld(!0),r.parent.updateMatrixWorld(!0),r.getWorldPosition(e),n.push(e.x,e.y,e.z),s.push(r))}var a=new ArrayBuffer(8*n.length),u=new Float64Array(a),c=(u.set(n),d.Lt.ze),f=new ArrayBuffer(128),h=((u=new Float64Array(f)).set(c.matrixWorldInverse.elements),new ArrayBuffer(128));(u=new Float64Array(h)).set(c.projectionMatrix.elements),d.Lt.fi.Xo.Ho({type:S.LABEL,spritePositions:a,matrixWorldInverse:f,projectionMatrix:h}).then(function(t){for(var n=t.result.ndcPositions,e=0,i=0;i<n.length;i+=2){var r=s[e];r&&(r.ndcPos={x:n[i],y:n[i+1]}),e+=1}o()})}})},zo:function(t,n,e,i,r){for(var o=0;o<n.length;o++){var s=n[o].mapNode.Vo;if(!n[o].mapNode.Qi||n[o].mapNode.Wo)s?n[o].mapNode.collisionTargetShow=!1:n[o].visible=!1;else if(n[o].mapNode.G&&(n[o].mapNode.G.maxlevel<=i||n[o].mapNode.G.minlevel>i))s?n[o].mapNode.collisionTargetShow=!1:n[o].visible=!1;else if(!1===r)s?n[o].mapNode.collisionTargetShow=!0:n[o].visible=!0;else if(!1===n[o].mapNode.Yo)s?n[o].mapNode.collisionTargetShow=!0:n[o].visible=!0;else{var a=n[o].children[0]||n[o];if("Sprite"===a.type&&a.material.map){var u=this.Bo(a,e);if(u){n[o].userData.bounds=u;for(var c=!0,f=0;f<t.length;f++){var h=t[f].userData.bounds;if(!(c=!W.jn(u.leftTop,u.rightDown,h.leftTop,h.rightDown)))break}c?(s?n[o].mapNode.collisionTargetShow=!0:n[o].visible=!0,t.push(n[o])):s?n[o].mapNode.collisionTargetShow=!1:n[o].visible=!1}}}}for(var l=0;l<n.length;l++)n[l].mapNode.Vo&&n[l].mapNode.Qo()},Zo:function(b){var g=this;this.bo&&(this.Lt.traverse(function(){a=Jc().mark(function t(n){var e,i,r,o,s,a,u,c,f,h,l,d,v,p,m,y;return Jc().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!g.Lt.fi.qo(n)){t.next=52;break}e=n.visibleLevels,i=[],r=null!=b?b:g.Lt.getZoom(),o=g.Ft.Ko,s=0;case 6:if(!(s<e.length)){t.next=52;break}if(a=n.getFloor(e[s])){t.next=10;break}return t.abrupt("continue",49);case 10:if(d=a.getLayers(S.LABEL_LAYER),u=void 0,0<d.length&&(u=d[0].scene),d=a.getLayers(S.FACILITY_LAYER),c=void 0,0<d.length&&(c=d[0].scene),d=[],u&&d.push.apply(d,nf(u.children)),c&&d.push.apply(d,nf(c.children)),g.Lt.Ft.Jo)return t.next=22,g.Go(d);t.next=22;break;case 22:i.length=0,u&&g.zo(i,u.children,!0,r,u.mapNode.Yo),c&&g.zo(i,c.children,!1,r,c.mapNode.Yo),f=0;case 26:if(!(f<o.length)){t.next=49;break}h=o[f],i.length=0,l=0;case 30:if(l<h.length)if(d=h[l],v=a.getLayers(d),m=p=void 0,y=!1,0<v.length&&(p=v[0],m=p.scene,y=!0===p.isHasText),m&&void 0!==p.collision){if(g.Lt.Ft.Jo)return t.next=41,g.Go(m.children);t.next=41}else t.next=43;else t.next=46;break;case 41:m.children.forEach(function(t){t.mapNode&&t.mapNode.avoidAfter&&t.mapNode.avoidBefor()}),g.zo(i,m.children,y,r,p.collision);case 43:l++,t.next=30;break;case 46:f++,t.next=26;break;case 49:s++,t.next=6;break;case 52:case"end":return t.stop()}},t)});var a,n=function(){var t=this,s=arguments;return new Promise(function(n,e){var i=a.apply(t,s);function r(t){$c(i,n,e,r,o,"next",t)}function o(t){$c(i,n,e,r,o,"throw",t)}r(void 0)})};return function(t){return n.apply(this,arguments)}}()),this.bo=!1,this.Lt.enableUpdateRender())},$o:function(){!0!==this.Ft.ts&&!0!==this.Ft.ns||(this.bo=!0)},zi:function(){this.yo=!0},ji:function(t){this.Xr.delete(t)},ut:function(){this.Xr.clear()},es:function(){var i,r=this;this.yo&&(this.Xr.clear(),i=[],this.Lt.traverse(function(t){if(r.Lt.fi.qo(t))for(var n=0;n<t.visibleLevels.length;n++){var e=t.getFloor(t.visibleLevels[n]);e&&i.push(e)}}),i.sort(function(t,n){return t.height<n.height?-1:t.height>n.height?1:t.parent===r.Lt.kt?-1:n.parent===r.Lt.kt?1:0}),i.forEach(function(t){var n=[];t.traverse(function(t){n.unshift(t)}),n.sort(function(t,n){var t=r.ho.indexOf(S.LAYER_NODE_TYPE.get(t.Fe)),n=r.ho.indexOf(S.LAYER_NODE_TYPE.get(n.Fe)),e=r.ho.length-1;return(t=-1===t?e:t)-(n=-1===n?e:n)}),n.forEach(function(t,n,e){var i=t.parent,i=i.parent.je+"%A%B%C%D"+i.level+"%A%B%C%D"+t.Fe;r.Xr.set(i,t.scene)})}),this.yo=!1,this.Ei(),this.$o())},Kt:function(){this.Xr&&0<this.Xr.size&&!this.vo&&(this.Lt.Qe.Ye({type:"firstRender"}),this.vo=!0)},Eo:function(){var t;this.Lt&&this.Qt&&(this.Qt&&(this.Oo=st.a.window.requestAnimationFrame(this.Eo.bind(this))),this.Lt.Qe.Ye({type:"beforeRender"}),this.resize(),t={type:"update",renderType:this.Ft.rs?0:1},this.Ft.rs&&(this.render(),this.Kt(),this.Ft.rs=!1),this.Lt.Qe.Ye(t))}}),n),af=t(3);function uf(t){return(uf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function cf(n,t){var e,i=Object.keys(n);return Object.getOwnPropertySymbols&&(e=Object.getOwnPropertySymbols(n),t&&(e=e.filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})),i.push.apply(i,e)),i}function ff(i){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?cf(Object(r),!0).forEach(function(t){var n,e;n=i,e=r[t=t],(t=df(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):cf(Object(r)).forEach(function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(r,t))})}return i}function hf(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,df(i.key),i)}}function lf(t,n,e){return n&&hf(t.prototype,n),e&&hf(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function df(t){t=function(t,n){if("object"!=uf(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=uf(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==uf(t)?t:String(t)}var n=lf(function t(n){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.ss=ff({data:null,method:"GET",responseType:"json"},n),this.us=null}),vf=(Object.assign(n.prototype,{cs:function(t,n,e){var i=this.ss,r=i.data,o=i.method,s=i.url,a=i.responseType,u=i.header,c=null;if((c=new(st.a.environment===G.a.WX?st.a.XMLHttpRequest:"undefined"!=typeof XMLHttpRequest?XMLHttpRequest:af.a.global().fengmap.XMLHttpRequest)).responseType=a,c.open(o,s),"object"==uf(u))for(var f in u)c.setRequestHeader(f,u[f]);c.addEventListener("load",function(){200===c.status||0===c.status||201===c.status?t&&t(c.response):n&&(404===c.status?n(Ri.PATH_ERROR):2069===c.response.error_code?n(Ri.NAME_KEY_ERROR):2063===c.response.error_code?n(Ri.MAP_ID_URL_ERROR):400===c.response.error_code?n(Ri.THEME_ID_URL_ERROR):n(c.response))}),c.addEventListener("timeout",function(t){e&&e(t)}),c.addEventListener("error",function(t){n&&n(t)}),c.send(JSON.stringify(r)),this.us=c},nn:function(){this.us&&this.us.abort&&(this.us.abort(),this.us=null)}}),n),n=t(31),pf=t.n(n);function mf(t){return(mf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yf(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=mf(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=mf(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==mf(t)?t:String(t)}(i.key),i)}}function bf(t,n,e){return n&&yf(t.prototype,n),e&&yf(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}for(var n=["TmF2aVNlZ21lbg==","YWNjZXNzaWJsZQ==","Zmlk","bmZv","Rmxvb3JHZW8=","bGlmdFR5cGU=","bGVu","dmVs","ZXh0ZW50TGF5ZQ==","RXh0ZW50Qml6SQ==","cmVhZE9ubHk=","LnByb3RvYnVm","aW50MzI=","ZG9vcnR5cGU=","R0VPUE9JTlRfTQ==","TmF2aVpvbmU=","ZW50cmFuY2VGbA==","bGVuZ3Ro","ZWxCaXpJbmZv","c3RhaXJMYXllcg==","dG9CaWQ=","R2F0ZQ==","b2Zmc2V0WQ==","Zmlkcw==","aXNTZWxlY3RhYg==","ZmxhZw==","ZXh0ZXJuYWxNbw==","bGlmdEVudHJ5","VklTRUdNRU5U","SW5kZXhJbmZv","ZGF0YQ==","ZGVsQml6SW5mbw==","bWlk","cG9pTGF5ZXI=","bW9kZWxpZA==","cGFja2Vk","dGhyb3VnaA==","bmF2aVNlZ21lbg==","bGlmdExheWVy","cmVwZWF0ZWQ=","ZGVmQ2VuWQ==","b29y","bm9kZUlk","TmF2aU1vZGVs","cmFuaw==","c25vZGU=","cHRz","ZGVmR2lk","aGFzaENvZGU=","bmVzdGVk","Ymlk","cmVxdWlyZWQ=","R0VPTElORV9OQQ==","b2Zmc2V0WA==","TmF2aU5vZGU=","bHR5cGU=","T1ZFUkxBWURBVA==","ZGVmQ2VuWA==","b3B0aW9ucw==","YmFzZUxldmVs","YXJlYQ==","TGF5ZXJHcm91cA==","ZmllbGRz","cGFzcw==","Zmxvb3Jz","SUZU","Rmxvb3JOYXZp","amF2YV9vdXRlcg==","UG9seWdvbkxhYg==","ZW50cmFuY2VUeQ==","VHlwZQ==","bmF2aVpvbmVz","ZWxMYXllcg==","YWxpYXM=","d2lkdGg=","YXllcg==","ZW50cnl0eXBlcw==","TGlmdEJpekluZg==","bm9kZXR5cGVz","amF2YV9wYWNrYQ==","bmF2aVR5cGU=","ZGF0ZVZlcg==","bGlmdEZsYWc=","Z2lk","bWF4WA==","bW5hbWU=","bWluU2NhbGVMZQ==","Zmxvb3JJZA==","X2NsYXNzbmFtZQ==","TW9kZWxCaXpJbg==","Zmxvb3I=","bmFtZQ==","c2NhbGVMZXZlbA==","RXh0ZXJuYWxNbw==","cGdpZA==","ZmlsZVZlcg==","VEFJUg==","bWlubGV2ZWw=","Rmxvb3JDb25maQ==","R2VuZXJhbEdlbw==","ZHJpdmU=","Ym9vbA==","a2V5","R0VPUE9MWUdPTg==","dG9HaWQ=","ZGVmQ2VuWg==","YnR5cGU=","R0VPUE9JTlRfUw==","cC5wbGF0Zm9ybQ==","TmF2aUZsb29y","ZmxvYXQ=","bmF2aUV4dGVudA==","UE9JQml6SW5mbw==","TGFiZWxCaXpJbg==","TGF5ZXI=","cnVsZQ==","bGlk","Y29tLmZlbmdtYQ==","c2NhbGU=","c2VnbWVudElk","ZGVzYw==","ZGVsTGF5ZXI=","R0VPUE9JTlRfUA==","cm90YXRlQW5nbA==","X0xBQkVM","cG9seWdvbkxheQ==","ZmlsZURhdGU=","R0VPUE9JTlRfTA==","U3RhaXJCaXpJbg==","ZXNjYWxhdG9yTA==","bGlua1NlZw==","QnVmZmVy","TmF2aUV4dGVudA==","Z2Vv","R0VPTElORQ==","bmF2aU5vZGVz","cmVqZWN0cw==","UG9seWdvbkJpeg==","aXNWaXNpYmxl","b25zaGlw","YnVmZmVycw==","bWF4bGV2ZWw=","ZG91Ymxl","R0VPUE9JTlRfRQ==","bmF2aQ==","Rmxvb3JCaXo=","Z1Byb3RvQnVm","T0RFTA==","ZW5hbWU=","bW9kZWxMYXllcg==","a2V5cw==","ZWlk","bGF5ZXJz","QU5PUkFNQQ==","UkRFUg==","R0VPUE9JTlQ=","QnVpbGRpbmc=","bWluWA==","TWFw","aGVpZ2h0","c3RyaW5n","dHlwZQ==","ZGVmYXVsdA==","cG9seWdvbkxhYg==","TmF2aVJlbGF0aQ==","dWludDY0","aWR4cw==","SW5mbw==","X0VYVEVOVA=="],gf=n,wf=218;--wf;)gf.push(gf.shift());var _f=bf(function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.id={nested:{protobuf:{options:{java_package:"com.fengmap.platform.protobuf",java_outer_classname:"FloorConfigProtoBuf"},nested:{Map:{fields:{mid:{rule:"required",type:"string",id:1},fileVer:{rule:"required",type:"int32",id:2},dateVer:{rule:"required",type:"uint64",id:3},mname:{rule:"required",type:"string",id:4},hashCode:{rule:"required",type:"string",id:5},key:{type:"string",id:6},fileDate:{type:"string",id:7},desc:{type:"string",id:8},readOnly:{type:"bool",id:9,options:{default:!1}},buffers:{rule:"repeated",type:"Buffer",id:10},keys:{rule:"repeated",type:"string",id:11}},nested:{Buffer:{fields:{gid:{rule:"required",type:"int32",id:1},fileVer:{rule:"required",type:"int32",id:2},btype:{rule:"required",type:"int32",id:3},len:{rule:"required",type:"uint64",id:4},data:{rule:"required",type:"bytes",id:5}}}}},Scene:{fields:{mid:{rule:"required",type:"string",id:19},fileVer:{rule:"required",type:"int32",id:20},dateVer:{rule:"required",type:"uint64",id:21},mname:{rule:"required",type:"string",id:22},hashCode:{rule:"required",type:"string",id:23},key:{type:"string",id:24},desc:{type:"string",id:25},readOnly:{type:"bool",id:26,options:{default:!1}},x:{type:"float",id:1},y:{type:"float",id:2},z:{type:"float",id:3},minX:{type:"float",id:4},minY:{type:"float",id:5},maxX:{type:"float",id:6},maxY:{type:"float",id:7},defGid:{type:"string",id:8},defCenX:{type:"float",id:9},defCenY:{type:"float",id:10},defCenZ:{type:"float",id:11},height:{type:"float",id:12},rotateAngleX:{type:"float",id:13},rotateAngleY:{type:"float",id:14},rotateAngleZ:{type:"float",id:15},scale:{type:"float",id:16},scaleLevel:{type:"string",id:17},naviType:{type:"int32",id:28},layerGroups:{rule:"repeated",type:"LayerGroup",id:18},buildings:{rule:"repeated",type:"Building",id:27}},nested:{Layer:{fields:{lid:{type:"int32",id:1},lname:{type:"string",id:2},alias:{type:"string",id:3},ltype:{type:"Type",id:4},offsetX:{type:"float",id:5},offsetY:{type:"float",id:6},height:{type:"float",id:7},rotateAngleX:{type:"float",id:8},rotateAngleY:{type:"float",id:9},rotateAngleZ:{type:"float",id:10},minScaleLevel:{type:"float",id:11},maxScaleLevel:{type:"float",id:12},isVisible:{type:"bool",id:13},isSelectable:{type:"bool",id:14},isEditable:{type:"bool",id:15},desc:{type:"string",id:16}},nested:{Type:{values:{GEOPOINT:1,GEOPOINT_ESCALATOR:2,GEOPOINT_LIFT:3,GEOPOINT_STAIR:4,GEOPOINT_PANORAMA:5,GEOPOINT_POI:6,GEOPOINT_STORELABEL:7,GEOPOINT_NAVINODE:8,GEOPOINT_MODEL:9,GEOLINE:20,GEOLINE_NAVISEGMENT:21,GEOLINE_BORDER:22,GEOPOLYGON:30,GEOPOLYGON_EXTENT:31,GEOPOLYGON_STORE:32,GEOPOLYGON_LABEL:33,RASTERATA:40,OVERLAYDATA:50}}}},LayerGroup:{fields:{gid:{type:"int32",id:1},gname:{type:"string",id:2},alias:{type:"string",id:3},height:{type:"float",id:4},desc:{type:"string",id:5},layers:{rule:"repeated",type:"Layer",id:6},floorId:{type:"string",id:7},naviType:{type:"int32",id:8}}},Floor:{fields:{gid:{type:"int32",id:1},x:{type:"float",id:2},y:{type:"float",id:3},offsetX:{type:"float",id:4},offsetY:{type:"float",id:5},angle:{type:"float",id:6},scale:{type:"float",id:7},fids:{rule:"repeated",type:"string",id:8},pgid:{type:"int32",id:9},baseLevel:{type:"bool",id:10},minlevel:{type:"int32",id:11},maxlevel:{type:"int32",id:12},floorId:{type:"string",id:13},idxs:{rule:"repeated",type:"IndexInfo",id:14},pts:{rule:"repeated",type:"double",id:15,options:{packed:!1}}},nested:{IndexInfo:{fields:{idxs:{rule:"repeated",type:"int32",id:1,options:{packed:!1}}}}}},Building:{fields:{bid:{type:"string",id:1},name:{type:"string",id:2},ename:{type:"string",id:3},alias:{type:"string",id:4},x:{type:"float",id:5},y:{type:"float",id:6},mid:{type:"string",id:7},version:{type:"int32",id:8},floors:{rule:"repeated",type:"Floor",id:9},bcode:{type:"int32",id:10}}}}},Gate:{fields:{mid:{rule:"required",type:"string",id:1},floors:{rule:"repeated",type:"NaviFloor",id:2}},nested:{NaviFloor:{fields:{gid:{type:"int32",id:1},floorId:{type:"string",id:2},bid:{type:"string",id:3},mid:{type:"string",id:4},navi:{rule:"repeated",type:"NaviRelationship",id:5},drive:{rule:"repeated",type:"NaviRelationship",id:6},accessible:{rule:"repeated",type:"NaviRelationship",id:7}}},NaviRelationship:{fields:{eid:{rule:"required",type:"int32",id:1},type:{type:"int32",id:2},accessible:{type:"int32",id:3},idxs:{rule:"repeated",type:"IndexInfo",id:4},pts:{rule:"repeated",type:"double",id:5,options:{packed:!1}},flag:{type:"int32",id:6},toBid:{rule:"repeated",type:"string",id:7},toGid:{rule:"repeated",type:"string",id:8}},nested:{IndexInfo:{fields:{idxs:{rule:"repeated",type:"int32",id:1,options:{packed:!1}}}}}}}},FloorGeo:{fields:{mid:{rule:"required",type:"string",id:1},gid:{rule:"required",type:"int32",id:2},height:{type:"float",id:3},extentLayer:{rule:"repeated",type:"GeneralGeoInfo",id:4},modelLayer:{rule:"repeated",type:"GeneralGeoInfo",id:5},labelLayer:{rule:"repeated",type:"GeneralGeoInfo",id:6},poiLayer:{rule:"repeated",type:"GeneralGeoInfo",id:7},polygonLayer:{rule:"repeated",type:"GeneralGeoInfo",id:8},polygonLabelLayer:{rule:"repeated",type:"GeneralGeoInfo",id:9},liftLayer:{rule:"repeated",type:"GeneralGeoInfo",id:10},stairLayer:{rule:"repeated",type:"GeneralGeoInfo",id:11},escalatorLayer:{rule:"repeated",type:"GeneralGeoInfo",id:12},externalModelLayer:{rule:"repeated",type:"GeneralGeoInfo",id:13}},nested:{GeneralGeoInfo:{fields:{eid:{rule:"required",type:"int32",id:1},geo:{type:"string",id:2},height:{type:"float",id:3},area:{type:"float",id:4},idxs:{rule:"repeated",type:"IndexInfo",id:5},pts:{rule:"repeated",type:"double",id:6,options:{packed:!1}},baseheight:{type:"float",id:7}},nested:{IndexInfo:{fields:{idxs:{rule:"repeated",type:"int32",id:1,options:{packed:!1}}}}}}}},FloorBiz:{fields:{mid:{rule:"required",type:"string",id:1},gid:{rule:"required",type:"int32",id:2},extentLayer:{rule:"repeated",type:"ExtentBizInfo",id:3},modelLayer:{rule:"repeated",type:"ModelBizInfo",id:4},labelLayer:{rule:"repeated",type:"LabelBizInfo",id:5},poiLayer:{rule:"repeated",type:"POIBizInfo",id:6},polygonLayer:{rule:"repeated",type:"PolygonBizInfo",id:7},liftLayer:{rule:"repeated",type:"LiftBizInfo",id:8},stairLayer:{rule:"repeated",type:"StairBizInfo",id:9},polygonLabelLayer:{rule:"repeated",type:"PolygonLabelBizInfo",id:10},externalModelLayer:{rule:"repeated",type:"ExternalModelBizInfo",id:11}},nested:{ExtentBizInfo:{fields:{eid:{rule:"required",type:"int32",id:1},fid:{type:"string",id:2},type:{type:"int32",id:3},name:{type:"string",id:4},ename:{type:"string",id:5},minlevel:{type:"int32",id:6},maxlevel:{type:"int32",id:7}}},ModelBizInfo:{fields:{eid:{rule:"required",type:"int32",id:1},fid:{type:"string",id:2},type:{type:"int32",id:3},name:{type:"string",id:4},ename:{type:"string",id:5},minlevel:{type:"int32",id:6},maxlevel:{type:"int32",id:7},pass:{type:"int32",id:8}}},LabelBizInfo:{fields:{eid:{rule:"required",type:"int32",id:1},fid:{type:"string",id:2},type:{type:"int32",id:3},name:{type:"string",id:4},ename:{type:"string",id:5},minlevel:{type:"int32",id:6},maxlevel:{type:"int32",id:7}}},PolygonBizInfo:{fields:{eid:{rule:"required",type:"int32",id:1},fid:{type:"string",id:2},type:{type:"int32",id:3},name:{type:"string",id:4},ename:{type:"string",id:5},minlevel:{type:"int32",id:6},maxlevel:{type:"int32",id:7}}},POIBizInfo:{fields:{eid:{rule:"required",type:"int32",id:1},fid:{type:"string",id:2},type:{type:"int32",id:3},name:{type:"string",id:4},ename:{type:"string",id:5},minlevel:{type:"int32",id:6},maxlevel:{type:"int32",id:7}}},LiftBizInfo:{fields:{eid:{rule:"required",type:"int32",id:1},fid:{type:"string",id:2},type:{type:"int32",id:3},flag:{type:"int32",id:4},floor:{type:"string",id:5},minlevel:{type:"int32",id:6},maxlevel:{type:"int32",id:7}}},StairBizInfo:{fields:{eid:{rule:"required",type:"int32",id:1},fid:{type:"string",id:2},type:{type:"int32",id:3},flag:{type:"int32",id:4},minlevel:{type:"int32",id:5},maxlevel:{type:"int32",id:6}}},PolygonLabelBizInfo:{fields:{eid:{rule:"required",type:"int32",id:1},fid:{type:"string",id:2},type:{type:"int32",id:3},width:{type:"float",id:4},name:{type:"string",id:5},ename:{type:"string",id:6},angle:{type:"float",id:7}}},ExternalModelBizInfo:{fields:{eid:{rule:"required",type:"int32",id:1},fid:{type:"string",id:2},type:{type:"int32",id:3},name:{type:"string",id:4},ename:{type:"string",id:5},minlevel:{type:"int32",id:6},maxlevel:{type:"int32",id:7}}}}},FloorNavi:{fields:{mid:{rule:"required",type:"string",id:1},gid:{rule:"required",type:"int32",id:2},naviNodes:{rule:"repeated",type:"NaviNode",id:3},naviSegments:{rule:"repeated",type:"NaviSegment",id:4},naviZones:{rule:"repeated",type:"NaviZone",id:5},naviModels:{rule:"repeated",type:"NaviModel",id:6},nextFloors:{rule:"repeated",type:"int32",id:7,options:{packed:!1}},naviExtents:{rule:"repeated",type:"NaviExtent",id:8}},nested:{NaviNode:{fields:{nodeId:{type:"int32",id:1},nodeType:{type:"int32",id:2},liftType:{type:"int32",id:3},liftFlag:{type:"int32",id:4},liftEntry:{type:"int32",id:5},liftFloor:{type:"string",id:6},linkSeg:{type:"string",id:7},geo:{type:"string",id:8},entranceType:{type:"int32",id:9},entranceFloor:{type:"string",id:10},doortype:{type:"int32",id:11},idxs:{rule:"repeated",type:"int32",id:12,options:{packed:!1}},pts:{rule:"repeated",type:"double",id:13,options:{packed:!1}},accessible:{type:"int32",id:14,options:{default:0}}}},NaviSegment:{fields:{segmentId:{type:"int32",id:1},snode:{type:"int32",id:2},enode:{type:"int32",id:3},length:{type:"double",id:4},rank:{type:"int32",id:5},name:{type:"string",id:6},entry:{type:"int32",id:7},desc:{type:"string",id:8},geo:{type:"string",id:9},through:{type:"int32",id:10},idxs:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},pts:{rule:"repeated",type:"double",id:12,options:{packed:!1}}}},NaviZone:{fields:{id:{rule:"required",type:"int32",id:1},type:{rule:"required",type:"int32",id:2,options:{default:0}},geo:{type:"string",id:3},rejects:{rule:"repeated",type:"string",id:4},idxs:{rule:"repeated",type:"int32",id:5,options:{packed:!1}},pts:{rule:"repeated",type:"double",id:6,options:{packed:!1}}}},NaviModel:{fields:{modelid:{rule:"required",type:"int32",id:1},doorids:{rule:"repeated",type:"int32",id:2,options:{packed:!1}},nodetypes:{rule:"repeated",type:"int32",id:3,options:{packed:!1}},entrytypes:{rule:"repeated",type:"int32",id:4,options:{packed:!1}}}},NaviExtent:{fields:{id:{rule:"required",type:"int32",id:1},pts:{rule:"repeated",type:"double",id:2,options:{packed:!1}},idxs:{rule:"repeated",type:"IndexInfo",id:3}},nested:{IndexInfo:{fields:{idxs:{rule:"repeated",type:"int32",id:1,options:{packed:!1}}}}}}}}}}}}});function Ef(t){return(Ef="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Sf(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Ef(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Ef(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Ef(t)?t:String(t)}(i.key),i)}}function Tf(t,n,e){return n&&Sf(t.prototype,n),e&&Sf(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var n=Tf(function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.hs=null}),xf=(Object.assign(n.prototype,{ls:function(){this.hs||(this.hs=pf.a.Root.fromJSON((new("undefined"!=typeof KjWzhWlSj&&KjWzhWlSj.ProtoDef?KjWzhWlSj.ProtoDef:_f)).id))},ds:function(t){return this.ls(),this.hs.lookup("Map").decode(t)},vs:function(t){for(var n=0;n<t.buffers.length;n++){var e=t.buffers[n];if(1==e.btype)return this.ps(e.data)}return null},ys:function(t){for(var n=0;n<t.buffers.length;n++){var e=t.buffers[n];if(7==e.btype)return this.bs(e.data)}return null},gs:function(t,n){for(var e=0;e<t.buffers.length;e++){var i=t.buffers[e];if(2==i.btype&&i.gid==n)return this.ws(i.data)}return null},_s:function(t,n){for(var e=0;e<t.buffers.length;e++){var i=t.buffers[e];if(3==i.btype&&i.gid==n)return this.Es(i.data)}return null},Ss:function(t,n){for(var e=0;e<t.buffers.length;e++){var i=t.buffers[e];if(4==i.btype&&i.gid==n)return this.Ts(i.data)}return null},xs:function(t,n){for(var e=0;e<t.buffers.length;e++){var i=t.buffers[e];if(5===i.btype&&i.gid===n)return this.Ts(i.data)}return null},As:function(t,n){for(var e=0;e<t.buffers.length;e++){var i=t.buffers[e];if(6===i.btype&&i.gid===n)return this.Ts(i.data)}return null},ps:function(t){this.ls();var n=this.hs.lookup("Scene").decode(t);return n.levels=[],n.layerGroups.forEach(function(t){n.levels.push(t.gid)}),n},bs:function(t){return this.ls(),this.hs.lookup("Gate").decode(t)},ws:function(t){return this.ls(),this.hs.lookup("FloorGeo").decode(t)},Es:function(t){return this.ls(),this.hs.lookup("FloorBiz").decode(t)},Ts:function(t){return this.ls(),this.hs.lookup("FloorNavi").decode(t)}}),n);function Af(t){return(Af="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Mf(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Af(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Af(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Af(t)?t:String(t)}(i.key),i)}}function Of(t,n,e){return n&&Mf(t.prototype,n),e&&Mf(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var Lf,Rf,Nf,Pf,jf,n=Of(function t(){var n;if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");st.a.environment===G.a.WX?this.Ms=new st.a.ProtoReaderStatic:void 0!==af.a.global().KjWzhWlSj&&af.a.global().KjWzhWlSj.ProtoReaderStatic?(n=af.a.global().KjWzhWlSj.ProtoReaderStatic,this.Ms=new n):this.Ms=new xf}),Ff=(Object.assign(n.prototype,{ds:function(t){return this.Ms.ds(t)},vs:function(t){return this.Ms.vs(t)},ys:function(t){return this.Ms.ys(t)},gs:function(t,n){return this.Ms.gs(t,n)},_s:function(t,n){return this.Ms._s(t,n)},Ss:function(t,n){return this.Ms.Ss(t,n)},xs:function(t,n){return this.Ms.xs(t,n)},As:function(t,n){return this.Ms.As(t,n)},ps:function(t){return this.Ms.ps(t)},bs:function(t){return this.Ms.bs(t)},ws:function(t){return this.Ms.ws(t)},Es:function(t){return this.Ms.Es(t)},Ts:function(t){return this.Ms.Ts(t)}}),n),n="https://console.fengmap.com/api-s/",If="https://console.fengmap.cool/api-s/",Cf={domain:n,online:n+"sdk/check",check:n+"sdk/auth/web",download:n+"sdk/auth/obtainMapRoute",downloadTile:n+"sdk/authLayered/obtainMapRoute",collect:n+"sdk/collect",themeUrl:n+"webtheme/",externalModelURL:n+"webmodel/"};function kf(t,n){for(var e,i=0,r=0,r=0;r<8;r++)1&n&&(i^=t),e=128&t,t<<=1,e&&(t^=27),n>>=1;return i}function Df(t,n,e){for(var i=0;i<4;i++)t[0+i]^=n[16*e+4*i],t[4+i]^=n[16*e+4*i+1],t[8+i]^=n[16*e+4*i+2],t[12+i]^=n[16*e+4*i+3]}function Uf(t){for(var n,e,i,r=1;r<4;r++)for(e=0;e<r;){for(i=t[4*r+4-1],n=3;0<n;n--)t[4*r+n]=t[4*r+n-1];t[4*r+0]=i,e++}}function Bf(t){for(var n,e,i,r=0;r<4;r++)for(n=0;n<4;n++)e=(240&t[4*r+n])>>4,i=15&t[4*r+n],t[4*r+n]=Rf[16*e+i]}function Gf(t){for(var n=0;n<4;n++)t[n]=Lf[16*((240&t[n])>>4)+(15&t[n])]}function Hf(t){return parseInt(t,16)}Lf=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],Rf=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],jf=[2,Pf=Nf=0,0,0];var Xf={decryption:function(t,n){for(var e=Array(16),i=0;i<16;i++)e[i]=16*Hf(n.substr(2*i,1))+Hf(n.substr(2*i+1,1));var r=Array(16);for(i=0;i<16;i++)r[i]=16*Hf(t.substr(2*i,1))+Hf(t.substr(2*i+1,1));var o=Array(16);switch(i=[],e.length){default:case 16:Nf=4,Pf=10;break;case 24:Nf=6,Pf=12;break;case 32:Nf=8,Pf=14}for(var s=i=Array(16*(Pf+1)),a=Array(4),u=4*(Pf+1),c=0;c<Nf;c++)s[4*c+0]=e[4*c+0],s[4*c+1]=e[4*c+1],s[4*c+2]=e[4*c+2],s[4*c+3]=e[4*c+3];for(c=Nf;c<u;c++){if(a[0]=s[4*(c-1)+0],a[1]=s[4*(c-1)+1],a[2]=s[4*(c-1)+2],a[3]=s[4*(c-1)+3],0==c%Nf){for(var f=void 0,h=void 0,f=(e=a)[0],h=0;h<3;h++)e[h]=e[h+1];if(e[3]=f,Gf(a),1==(e=c/Nf))jf[0]=1;else if(1<e)for(jf[0]=2,e--;0<e-1;)jf[0]=kf(jf[0],2),e--;(h=e=a)[0]=e[0]^(f=jf)[0],h[1]=e[1]^f[1],h[2]=e[2]^f[2],h[3]=e[3]^f[3]}else 6<Nf&&4==c%Nf&&Gf(a);s[4*c+0]=s[4*(c-Nf)+0]^a[0],s[4*c+1]=s[4*(c-Nf)+1]^a[1],s[4*c+2]=s[4*(c-Nf)+2]^a[2],s[4*c+3]=s[4*(c-Nf)+3]^a[3]}for(s=Array(16),a=0;a<4;a++)for(c=0;c<4;c++)s[4*a+c]=r[a+4*c];for(Df(s,i,Pf),r=Pf-1;1<=r;r--)for(Uf(s),Bf(s),Df(s,i,r),a=s,c=[14,9,13,11],u=h=void 0,e=Array(4),f=Array(4),u=0;u<4;u++){for(h=0;h<4;h++)e[h]=a[4*h+u];var h=c,l=e,d=f;for(d[0]=kf(h[0],l[0])^kf(h[3],l[1])^kf(h[2],l[2])^kf(h[1],l[3]),d[1]=kf(h[1],l[0])^kf(h[0],l[1])^kf(h[3],l[2])^kf(h[2],l[3]),d[2]=kf(h[2],l[0])^kf(h[1],l[1])^kf(h[0],l[2])^kf(h[3],l[3]),d[3]=kf(h[3],l[0])^kf(h[2],l[1])^kf(h[1],l[2])^kf(h[0],l[3]),h=0;h<4;h++)a[4*h+u]=f[h]}for(Uf(s),Bf(s),Df(s,i,0),a=0;a<4;a++)for(c=0;c<4;c++)o[a+4*c]=s[4*a+c];for(r="",i=0;i<16;++i)r+=s=(s=o[i].toString(16)).length<2?"0"+s:s;return r}};function zf(t,n){var e=(65535&t)+(65535&n);return(t>>16)+(n>>16)+(e>>16)<<16|65535&e}function Vf(t,n,e,i,r,o){return zf((n=zf(zf(n,t),zf(i,o)))<<r|n>>>32-r,e)}function Wf(t,n,e,i,r,o,s){return Vf(n&e|~n&i,t,n,r,o,s)}function Yf(t,n,e,i,r,o,s){return Vf(n&i|e&~i,t,n,r,o,s)}function Qf(t,n,e,i,r,o,s){return Vf(n^e^i,t,n,r,o,s)}function Zf(t,n,e,i,r,o,s){return Vf(e^(n|~i),t,n,r,o,s)}function qf(t,n){t[n>>5]|=128<<n%32,t[14+(n+64>>>9<<4)]=n;for(var e,i,r,o,s=1732584193,a=-271733879,u=-1732584194,c=271733878,f=0;f<t.length;f+=16)s=Wf(e=s,i=a,r=u,o=c,t[f],7,-680876936),c=Wf(c,s,a,u,t[f+1],12,-389564586),u=Wf(u,c,s,a,t[f+2],17,606105819),a=Wf(a,u,c,s,t[f+3],22,-1044525330),s=Wf(s,a,u,c,t[f+4],7,-176418897),c=Wf(c,s,a,u,t[f+5],12,1200080426),u=Wf(u,c,s,a,t[f+6],17,-1473231341),a=Wf(a,u,c,s,t[f+7],22,-45705983),s=Wf(s,a,u,c,t[f+8],7,1770035416),c=Wf(c,s,a,u,t[f+9],12,-1958414417),u=Wf(u,c,s,a,t[f+10],17,-42063),a=Wf(a,u,c,s,t[f+11],22,-1990404162),s=Wf(s,a,u,c,t[f+12],7,1804603682),c=Wf(c,s,a,u,t[f+13],12,-40341101),u=Wf(u,c,s,a,t[f+14],17,-1502002290),s=Yf(s,a=Wf(a,u,c,s,t[f+15],22,1236535329),u,c,t[f+1],5,-165796510),c=Yf(c,s,a,u,t[f+6],9,-1069501632),u=Yf(u,c,s,a,t[f+11],14,643717713),a=Yf(a,u,c,s,t[f],20,-373897302),s=Yf(s,a,u,c,t[f+5],5,-701558691),c=Yf(c,s,a,u,t[f+10],9,38016083),u=Yf(u,c,s,a,t[f+15],14,-660478335),a=Yf(a,u,c,s,t[f+4],20,-405537848),s=Yf(s,a,u,c,t[f+9],5,568446438),c=Yf(c,s,a,u,t[f+14],9,-1019803690),u=Yf(u,c,s,a,t[f+3],14,-187363961),a=Yf(a,u,c,s,t[f+8],20,1163531501),s=Yf(s,a,u,c,t[f+13],5,-1444681467),c=Yf(c,s,a,u,t[f+2],9,-51403784),u=Yf(u,c,s,a,t[f+7],14,1735328473),s=Qf(s,a=Yf(a,u,c,s,t[f+12],20,-1926607734),u,c,t[f+5],4,-378558),c=Qf(c,s,a,u,t[f+8],11,-2022574463),u=Qf(u,c,s,a,t[f+11],16,1839030562),a=Qf(a,u,c,s,t[f+14],23,-35309556),s=Qf(s,a,u,c,t[f+1],4,-1530992060),c=Qf(c,s,a,u,t[f+4],11,1272893353),u=Qf(u,c,s,a,t[f+7],16,-155497632),a=Qf(a,u,c,s,t[f+10],23,-1094730640),s=Qf(s,a,u,c,t[f+13],4,681279174),c=Qf(c,s,a,u,t[f],11,-358537222),u=Qf(u,c,s,a,t[f+3],16,-722521979),a=Qf(a,u,c,s,t[f+6],23,76029189),s=Qf(s,a,u,c,t[f+9],4,-640364487),c=Qf(c,s,a,u,t[f+12],11,-421815835),u=Qf(u,c,s,a,t[f+15],16,530742520),s=Zf(s,a=Qf(a,u,c,s,t[f+2],23,-995338651),u,c,t[f],6,-198630844),c=Zf(c,s,a,u,t[f+7],10,1126891415),u=Zf(u,c,s,a,t[f+14],15,-1416354905),a=Zf(a,u,c,s,t[f+5],21,-57434055),s=Zf(s,a,u,c,t[f+12],6,1700485571),c=Zf(c,s,a,u,t[f+3],10,-1894986606),u=Zf(u,c,s,a,t[f+10],15,-1051523),a=Zf(a,u,c,s,t[f+1],21,-2054922799),s=Zf(s,a,u,c,t[f+8],6,1873313359),c=Zf(c,s,a,u,t[f+15],10,-30611744),u=Zf(u,c,s,a,t[f+6],15,-1560198380),a=Zf(a,u,c,s,t[f+13],21,1309151649),s=Zf(s,a,u,c,t[f+4],6,-145523070),c=Zf(c,s,a,u,t[f+11],10,-1120210379),u=Zf(u,c,s,a,t[f+2],15,718787259),a=Zf(a,u,c,s,t[f+9],21,-343485551),s=zf(s,e),a=zf(a,i),u=zf(u,r),c=zf(c,o);return[s,a,u,c]}function Kf(t){for(var n="",e=32*t.length,i=0;i<e;i+=8)n+=String.fromCharCode(t[i>>5]>>>i%32&255);return n}function Jf(t){var n=[];for(n[(t.length>>2)-1]=void 0,i=0;i<n.length;i+=1)n[i]=0;for(var e=8*t.length,i=0;i<e;i+=8)n[i>>5]|=(255&t.charCodeAt(i/8))<<i%32;return n}function $f(t){for(var n,e="0123456789abcdef",i="",r=0;r<t.length;r+=1)n=t.charCodeAt(r),i+=e.charAt(n>>>4&15)+e.charAt(15&n);return i}function th(t){return unescape(encodeURIComponent(t))}function nh(t){return Kf(qf(Jf(t=th(t)),8*t.length))}function eh(t,n){var e,t=th(t),n=th(n),i=Jf(t),r=[],o=[];for(r[15]=o[15]=void 0,16<i.length&&(i=qf(i,8*t.length)),e=0;e<16;e+=1)r[e]=909522486^i[e],o[e]=1549556828^i[e];return t=qf(r.concat(Jf(n)),512+8*n.length),Kf(qf(o.concat(t),640))}function ih(t,n,e){return n?e?eh(n,t):$f(eh(n,t)):e?nh(t):$f(nh(t))}var rh={encryption:function(t){return ih(t)}};function oh(t){return(oh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function sh(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=oh(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=oh(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==oh(t)?t:String(t)}(i.key),i)}}function ah(t,n,e){return n&&sh(t.prototype,n),e&&sh(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var uh="0.0.0.0",n=ah(function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")});Object.assign(n.prototype,{Os:function(t,n,e,i,r){void 0===st.a.KjWzhWlSj||!st.a.KjWzhWlSj.license||!st.a.KjWzhWlSj.license||"string"==typeof n&&0!=n.length&&(n=Xf.decryption(n,"026685bf295f587b5dffc1f18d5dc27c"),e=rh.encryption(e),n=Xf.decryption(n,e),-1!==t.indexOf(n))?i&&i():r&&r()},Ls:function(t,n,e,i){var r;-1!==n.indexOf("")||-1!==n.indexOf("aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa")||void 0===t.mapURL||(r=rh.encryption("fengmap.localhost:"+t.appName),r=Xf.decryption(t.key,r),-1!==n.indexOf(r))?this.Os(n,t.license,t.buildingID,function(){e&&e()},function(){i&&i(Ri.LICENSE_ERROR)}):i&&i(Ri.NAME_KEY_ERROR)},Rs:function(t,n,e){var i=this;void 0!==t.mapURL?n&&n():(t.enableCollect&&this.Ns(t),this.Ps(function(){new vf({method:"POST",url:Cf.check,header:{"X-Requested-With":"XMLHttpRequest","Content-type":"application/json;charset=utf-8"},data:i.js(t)}).cs(function(){n&&n()},function(t){e&&e(t)},function(){n&&n()})},function(){n&&n()}))},Ps:function(t,n){new vf({method:"GET",url:Cf.online}).cs(function(){t&&t()},function(){n&&n()},function(){n&&n()})},js:function(t,n){st.a.environment===G.a.BROWSER&&-1!==(i=(e=af.a.global().location.host).indexOf(":"))&&(e=e.slice(0,i));var e,i={mapId:t.buildingID,appName:t.appName};return n?i.keyValue=t.key:i.appKey=t.key,n?i.webUrl=e||uh:i.webURL=e||uh,i},Ns:function(t){if("undefined"!=typeof navigator&&"undefined"!=typeof document){var n={};-1!==navigator.userAgent.indexOf("Opera")?n.userAgent="Opera":-1!==navigator.userAgent.indexOf("Firefox")?n.userAgent="FF":-1!==navigator.userAgent.indexOf("Chrome")?n.userAgent="Chrome":-1!==navigator.userAgent.indexOf("Safari")&&0===navigator.userAgent.indexOf("Chrome")?n.userAgent="Safari":-1!==navigator.userAgent.indexOf("compatible")&&-1!==navigator.userAgent.indexOf("MSIE")?n.userAgent="IE":-1!==navigator.userAgent.indexOf("Trident")&&(n.userAgent="Edge"),n.product="JS",n.sdkVersion=b+"."+T,n.appName=t.appName,n.appkey=t.key;for(var t=st.a.document.createElement("canvas").getContext("experimental-webgl"),e=t.getExtension("WEBGL_debug_renderer_info"),i=(n.gpu=e?t.getParameter(e.UNMASKED_RENDERER_WEBGL):null,n.os=navigator.platform,!0),r=navigator.userAgent,o=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],s=0;s<o.length;s++)if(0<r.indexOf(o[s])){i=!1;break}n.device=i?"pc":"mobile",new vf({method:"POST",url:Cf.collect,header:{"X-Requested-With":"XMLHttpRequest","Content-type":"application/json;charset=utf-8"},data:n}).cs()}}});var ch=new n;function fh(t){return(fh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function hh(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=fh(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=fh(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==fh(t)?t:String(t)}(i.key),i)}}function lh(t,n,e){return n&&hh(t.prototype,n),e&&hh(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var n=lh(function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=this,i=t;if(!(e instanceof i))throw new TypeError("Cannot call a class as a function");this.Fs=n.disposeCallback,this.Is=!1,this.Cs=!1,this.ks=void 0!==n.enable&&n.enable,this.name=void 0!==n.name?n.name:"",this.Ds=new Map,this.Us=n.mapCreateTime}),dh=(Object.assign(n.prototype,{Bs:function(){!this.ks||this.Cs||this.Is&&0===this.Ds.size&&(this.Fs({mapCreateTime:this.Us}),this.Cs=!0)},Gs:function(t){this.ks&&(this.Is=t,this.Bs())},Hs:function(t){this.ks&&(this.Ds.has(t),this.Ds.set(t,0))},Xs:function(t){this.ks&&this.Ds.has(t)&&(this.Ds.delete(t),this.Bs())}}),n);function vh(t){return(vh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ph(t){return function(t){if(Array.isArray(t))return mh(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){var e;if(t)return"string"==typeof t?mh(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?mh(t,n):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mh(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function yh(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=vh(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=vh(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==vh(t)?t:String(t)}(i.key),i)}}function bh(t,n,e){return n&&yh(t.prototype,n),e&&yh(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var n=bh(function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.Ms=new Ff,this.zs=[],this.Vs=new dh({enable:!0,name:"DataManager"})}),gh=(Object.assign(n.prototype,{nn:function(t){var n=this;this.Vs.Fs=t,this.zs.forEach(function(t){200!==t.us.status&&n.Vs.Xs(t.ss.url),t.nn()}),this.zs.length=0,this.Vs.Gs(!0)},Ws:function(t,n,e,i){var r;t.mapURL?(r=t.isPreview?t.isOutdoor?t.tile?t.mapURL+t.buildingID+"/separate/"+t.buildingID+n+".fmap":t.mapURL+t.buildingID+"/"+t.buildingID+n+".fmap":t.tile?t.mapURL+t.mapID+"/"+t.bid+"/"+t.buildingID+"/separate/"+t.buildingID+n+".fmap":t.mapURL+t.mapID+"/"+t.bid+"/"+t.buildingID+"/"+t.buildingID+n+".fmap":t.mapURLAbsolute?t.mapURL+t.buildingID+n+".fmap":t.isOutdoor?t.mapURL+t.buildingID+"/"+t.buildingID+n+".fmap":t.mapURL+t.mapID+"/"+t.bid+"/"+t.buildingID+"/"+t.buildingID+n+".fmap",e&&e(r)):(r={newFlag:"2",keyType:3,isSeparate:!1},t.isOutdoor||(r.bId=t.bid,r.rootMid=t.mapID),n=new vf({method:"POST",url:""===n?Cf.download:Cf.downloadTile+"/"+t.buildingID+n+".fmap",header:{"X-Requested-With":"XMLHttpRequest","Content-type":"application/json;charset=utf-8"},data:Object.assign(r,ch.js(t,!0))}),this.zs.push(n),n.cs(function(t){e&&e(t.replace('"',"").replace('"',""))},function(t){i&&i(t)},function(t){i&&i(t)}))},Ys:function(i,r,o){var s=this;i.enableCollect=!0,ch.Rs(i,function(){s.Ws(i,"",function(e){var t=new vf({method:"GET",responseType:"arraybuffer",url:e});s.zs.push(t),s.Vs.Hs(e),t.cs(function(t){s.Vs.Xs(e);var t=new Uint8Array(t),n=s.Ms.ds(t);!i.isOutdoor||(t=[],n.keys&&0!==n.keys.length?t.push.apply(t,ph(n.keys)):t.push(n.key),i.isPreview)?r&&r(n):ch.Ls(i,t,function(){r&&r(n)},function(t){o&&o(t)})},function(t){o&&o(t===Ri.PATH_ERROR?Ri.MAP_ID_URL_ERROR:t),s.Vs.Xs(e)},function(t){o&&o(t),s.Vs.Xs(e)})},function(t){o&&o(t)})},function(t){o&&o(t)})},Qs:function(i,r,o){var s=this;i.enableCollect=!0,ch.Rs(i,function(){s.Ws(i,".scene",function(e){s.Vs.Hs(e);var t=new vf({method:"GET",responseType:"arraybuffer",url:e});s.zs.push(t),t.cs(function(t){var t=new Uint8Array(t),n=s.Ms.ps(t);s.Vs.Xs(e),!i.isOutdoor||(t=[],n.keys&&0!==n.keys.length?t.push.apply(t,ph(n.keys)):t.push(n.key),i.isPreview)?r&&r(n):ch.Ls(i,t,function(){r&&r(n)},function(t){o&&o(t)})},function(t){o&&o(t),s.Vs.Xs(e)},function(t){o&&o(t),s.Vs.Xs(e)})},function(t){o&&o(t)})},function(t){o&&o(t)})},Zs:function(t,e,i){var r=this;this.Ws(t,".gate",function(n){r.Vs.Hs(n);var t=new vf({method:"GET",responseType:"arraybuffer",url:n});r.zs.push(t),t.cs(function(t){t=new Uint8Array(t),t=r.Ms.bs(t);e&&e(t),r.Vs.Xs(n)},function(t){i&&i(t),r.Vs.Xs(n)},function(t){i&&i(t),r.Vs.Xs(n)})},function(t){i&&i(t)})},qs:function(t,n,e,i){var r=this;this.Ws(t,".floor."+n+".geo",function(n){var t=new vf({method:"GET",responseType:"arraybuffer",url:n});r.Vs.Hs(n),r.zs.push(t),t.cs(function(t){t=new Uint8Array(t),t=r.Ms.ws(t);e&&e(t),r.Vs.Xs(n)},function(t){i&&i(t),r.Vs.Xs(n)},function(t){i&&i(t),r.Vs.Xs(n)})},function(t){i&&i(t)})},Ks:function(t,n,e,i){var r=this;this.Ws(t,".floor."+n+".biz",function(n){var t=new vf({method:"GET",responseType:"arraybuffer",url:n});r.Vs.Hs(n),r.zs.push(t),t.cs(function(t){t=new Uint8Array(t),t=r.Ms.Es(t);e&&e(t),r.Vs.Xs(n)},function(t){i&&i(t),r.Vs.Xs(n)},function(t){i&&i(t),r.Vs.Xs(n)})},function(t){i&&i(t)})},Js:function(t,n,e,i){var r=this;this.Ws(t,n,function(n){var t=new vf({method:"GET",responseType:"arraybuffer",url:n});r.Vs.Hs(n),r.zs.push(t),t.cs(function(t){t=new Uint8Array(t),t=r.Ms.Ts(t);e&&e(t),r.Vs.Xs(n)},function(t){i&&i(t),r.Vs.Xs(n)})},function(t){i&&i(t)},function(t){i&&i(t)})},$s:function(t,n,e,i){this.Js(t,".floor."+n+".navi",e,i)},ta:function(t,n,e,i){this.Js(t,".floor."+n+".drive.navi",e,i)},na:function(t,n,e,i){this.Js(t,".floor."+n+".accessible.navi",e,i)}}),n);function wh(t){for(var n=[],e=t.length,i=0;i<e;i++){for(var r=t[i],o={x:this.ea(r.x),y:this.ea(r.y)},s=n.length,a=!1,u=0;u<s;u++){var c=n[u];if(c.x==o.x&&c.y==o.y){a=!0;break}}a||n.push(o)}return n}function _h(t){return+t.toFixed(2)}function Eh(t){return(Eh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Sh(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Eh(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Eh(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Eh(t)?t:String(t)}(i.key),i)}}function Th(t,n,e){return n&&Sh(t.prototype,n),e&&Sh(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}n=Th(function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")});Object.assign(n.prototype,{ia:function(t,n){for(var e=[],i=0,r=0;r<t.length;r++){var o=t[r].idxs;if("number"==typeof(o=o||t[r]))for(;i<o;)e.push({x:n[i],y:n[i+1]}),i+=2;else for(var s=0;s<o.length;s++)for(var a=o[s];i<a;)e.push({x:n[i],y:n[i+1]}),i+=2}return e},ra:function(t,n){for(var e=[],i=0,r=0;r<t.length;r++){var o=t[r].idxs;if("number"==typeof(o=o||t[r])){for(var s=[];i<o;)s.push({x:n[i],y:n[i+1]}),i+=2;e.push(s)}else for(var a=0;a<o.length;a++){for(var u=o[a],c=[];i<u;)c.push({x:n[i],y:n[i+1]}),i+=2;e.push(c)}}return e},oa:function(t,n){for(var e=[],i=[],r=0,o=0;o<t.length;o++){var s=t[o].idxs;if("number"==typeof(s=s||t[o]))for(;r<s;)e.push({x:n[r],y:n[r+1]}),r+=2;else for(var a=0;a<s.length;a++)if(0===a)for(var u=s[a];r<u;)e.push({x:n[r],y:n[r+1]}),r+=2;else{for(var c=[],f=s[a];r<f;)c.push({x:n[r],y:n[r+1]}),r+=2;i.push(c)}}var h=[];return h.push(e),h.push.apply(h,i),h},sa:function(t){return wh(t)},ea:_h});var xh=new n;function Ah(t){return(Ah="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Mh(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Ah(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Ah(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Ah(t)?t:String(t)}(i.key),i)}}function Oh(t,n,e){return n&&Mh(t.prototype,n),e&&Mh(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var Lh={G1:"MULTIPOLYGON(((",G2:"POINT(",G3:"MULTILINESTRING(("},n=(Lh.GLEN1="MULTIPOLYGON(((".length,Lh.GLEN2="POINT(".length,Lh.GLEN3="MULTILINESTRING((".length,Oh(function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")}));Object.assign(n.prototype,{ia:function(t){var n=[];return 0!=t.indexOf(Lh.G2)?[]:(t=t.substring(Lh.GLEN2,t.length-1).split(" "),n.push({x:parseFloat(t[0]),y:parseFloat(t[1])}),n)},aa:function(t,n){for(var e=0;e<t.length;e++){var i=t[e].split(" ");n.push({x:parseFloat(i[0]),y:parseFloat(i[1])})}},ra:function(t){return 0!=t.indexOf(Lh.G3)?[]:(t=t.substring(Lh.GLEN3,t.length-2).split(","),this.aa(t,t=[]),[t])},oa:function(t){var n=[],e=[];if(0!=t.indexOf(Lh.G1))return[];for(var i=t.substring(Lh.GLEN1,t.length-3).split(/\),\(/),r=0;r<i.length;r++){var o=i[r].split(/,/);if(0==r)this.aa(o,n);else{for(var s=[],a=0;a<o.length;a++){var u=o[a].split(" ");s.push({x:parseFloat(u[0]),y:parseFloat(u[1])})}e.push(s)}}t=[];return t.push(n),t.push.apply(t,e),t},sa:function(t){return wh(t)},ea:_h});var Rh=new n;function Nh(t,n){var e,i,r,o,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return i=!(e=!0),{s:function(){s=s.call(t)},n:function(){var t=s.next();return e=t.done,t},e:function(t){i=!0,r=t},f:function(){try{e||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(t)||(s=function(t,n){var e;if(t)return"string"==typeof t?Ph(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Ph(t,n):void 0}(t))||n&&t&&"number"==typeof t.length)return s&&(t=s),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ph(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function jh(t){return(jh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fh(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=jh(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=jh(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==jh(t)?t:String(t)}(i.key),i)}}var n=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.Fe=ar.GROUP,this.It=new Map,this.je=-1,this.xe=null,Object.assign(this,t)}var t,e,i;return t=n,(e=[{key:"getType",value:function(){return this.Fe}},{key:"getBound",value:function(){return this.xe||this.Ce(),this.xe}},{key:"getChildren",value:function(){return this.It}}])&&Fh(t.prototype,e),i&&Fh(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}(),Ih=(Object.assign(n.prototype,{nn:function(){var t,n=Nh(this.It.values());try{for(n.s();!(t=n.n()).done;){var e=t.value;e.nn&&e.nn()}}catch(t){n.e(t)}finally{n.f()}this.It.clear()},ke:function(n){var t=n._support(this);t==no.PASS?this.It.forEach(function(t){t.ke(n)}):t==no.PUSH&&n._result.push(this)},Ce:function(){var n=this;this.xe=new Ur,0!=this.It.size&&this.It.forEach(function(t){n.xe.Ee(t.getBound())})}}),n);function Ch(t){return(Ch="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function kh(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Ch(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Ch(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Ch(t)?t:String(t)}(i.key),i)}}function Dh(t,n,e){n=Bh(n);var i=t,n=Uh()?Reflect.construct(n,e||[],Bh(t).constructor):n.apply(t,e);if(n&&("object"===Ch(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return Gh(i)}function Uh(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Uh=function(){return!!t})()}function Bh(t){return(Bh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Gh(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Hh(t,n){return(Hh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var n=function(){var t,n,e=r,i=ro;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(t){var n;if(this instanceof r)return(n=Dh(this,r)).je=t.eid,n.Fe=ar.POINT,Object.assign(Gh(n),t),n;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Hh(e,i),e=r,t&&kh(e.prototype,t),n&&kh(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(),Xh=(Object.assign(n.prototype,{Ce:function(){this.xe=new Ur,this.Ie&&this.xe.Se(this.Ie)},ke:function(t){t._support(this)==no.PUSH&&t._result.push(this)}}),n);function zh(t){return(zh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var Vh=["layerGroups"],Wh=["layers"];function Yh(t,n){if(null==t)return{};var e,i=function(t,n){if(null==t)return{};var e,i,r={},o=Object.keys(t);for(i=0;i<o.length;i++)e=o[i],0<=n.indexOf(e)||(r[e]=t[e]);return r}(t,n);if(Object.getOwnPropertySymbols)for(var r=Object.getOwnPropertySymbols(t),o=0;o<r.length;o++)e=r[o],0<=n.indexOf(e)||Object.prototype.propertyIsEnumerable.call(t,e)&&(i[e]=t[e]);return i}function Qh(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=zh(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=zh(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==zh(t)?t:String(t)}(i.key),i)}}function Zh(t,n,e){return n&&Qh(t.prototype,n),e&&Qh(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var n=Zh(function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.ua=[1,2,3,4],this.ca=[6,7,9],this.fa=[31,32],this.ha=new Map,this.ha.set(31,ar.EXTENTGROUP),this.ha.set(32,ar.MODELGROUP),this.ha.set(6,ar.FACILITYGROUP),this.ha.set(7,ar.LABELGROUP),this.ha.set(9,ar.EXTERNALMODELGROUP),this.la=new Map,this.la.set(31,["extentLayer",null]),this.la.set(32,["modelLayer","labelLayer"]),this.la.set(6,["poiLayer",null]),this.la.set(7,["labelLayer",null]),this.la.set(9,["externalModelLayer",null]),this.Ms=new Ff}),qh=(Object.assign(n.prototype,{da:function(t){var n;return t?(n=t.scene,this.va(n,t)):null},va:function(t,e){var i=this,n=t.layerGroups,r=Yh(t,Vh),o=t.fileVer,s=new Ih(r);return n.forEach(function(t){var n=i.pa(t,e,o);s.It.set(t.gid,n)}),s},pa:function(t,n,e){var i=this,r=t.layers,o=Yh(t,Wh),s=new Ih(o),a=n&&n.floors?n.floors.get(t.gid).geo[0]:null,u=n&&n.floors?n.floors.get(t.gid).biz[0]:null;return r.forEach(function(t){6===t.ltype&&-1!==t.lname.indexOf("storelabel")&&(t.ltype=7);var n=i.ma(t,a,u,e);null!==n&&s.It.set(i.ha.get(t.ltype),n)}),this.ya(s),s},ya:function(t){var n=Array.from(t.It);n.sort(function(t,n){return t[0]-n[0]}),t.It=new Map(n)},ma:function(t,n,e,i){var r;return-1===this.ua.indexOf(t.ltype)&&this.la.get(t.ltype)?(r=new Ih(t),this.ba(r,n,e,i),r&&(r.Fe=this.ha.get(t.ltype)),r):null},ba:function(t,n,e,i){if(t){var r=this.la.get(t.ltype);if(r){var o=n?n[r[0]]:[],s=e?e[r[0]]:[];switch(t.ltype){case 6:this.ga(t,o,s,i,ar.FACILITY);break;case 7:this.ga(t,o,s,i,ar.LABEL);break;case 9:this.ga(t,o,s,i,ar.EXTERNALMODEL);break;case 31:this.wa(t,o,s,i,ar.EXTENT,null);break;case 32:this.wa(t,o,s,i,ar.MODEL,n?n[r[1]]:null)}}}},ga:function(t,n,e,i,r){for(var o=0;o<n.length;o++){var s=this._a(n[o],e[o],i);s.Fe=r,t.It.set(n[o].eid,s)}},_a:function(t,n,e){n=Object.assign({},n,{area:t.area,eid:t.eid,height:t.height}),n=new Xh(n);return t.coordinates?n.Ie=t.coordinates:(n.Ie=1==e?Rh.ia(t.geo):xh.ia(t.idxs,t.pts),t.coordinates=n.Ie),n},wa:function(t,n,e,i,r,o){for(var s=0;s<n.length;s++){var a=this.Ea(n[s],e[s],i,o?o[s]:null);a.Fe=r,t.It.set(n[s].eid,a)}},Ea:function(t,n,e,i){n=Object.assign({},n,{area:t.area,eid:t.eid,height:t.height,baseheight:t.baseheight}),n=new lo(n);return n.Ie=1===e?Rh.oa(t.geo):xh.oa(t.idxs,t.pts),i&&(i.coordinates||(i.coordinates=1===e?Rh.ia(i.geo):xh.ia(i.idxs,i.pts)),n.Re=i.coordinates[0]),n}}),n),Kh={NONE_RODE_NETWORK:1,WALK_RODE_NETWORK:2,DRIVE_RODE_NETWORK:4,ACCESSIBLE_RODE_NETWORK:8};function Jh(t){return(Jh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $h(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Jh(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Jh(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Jh(t)?t:String(t)}(i.key),i)}}var n=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.lr=new Map,this.Sa=new Map,this.ss=new Map,this.Ta=new Map,this.xa=new Map,this.Aa=new Map,this.Ma=[2,3],this.Oa=!1,this.Ms=new Ff,this.La=new qh,this.Ra=new gh}var n,e,i;return n=t,(e=[{key:"load",value:function(t,n){this.Na(t,n)}},{key:"loadWhole",value:function(t,n){this.Pa(t,n)}},{key:"getDecode",value:function(t){t=void 0!==t.buildingID?t.buildingID:t.mapID;return this.ja({buildingID:t})}},{key:"getData",value:function(t){t=void 0!==t.buildingID?t.buildingID:t.mapID;return this.lr.get(t)}},{key:"setCache",value:function(t){this.lr=t[0],this.Sa=t[1]}},{key:"getCache",value:function(){return[this.lr,this.Sa]}}])&&$h(n.prototype,e),i&&$h(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}(),tl=(Object.assign(n.prototype,{nn:function(t){this.Ra.nn(t),this.Mo()},Mo:function(){this.lr.clear(),this.lr=null,this.Sa.clear(),this.Sa=null,this.ss.clear(),this.ss=null,this.Ta.clear(),this.Ta=null,this.xa.clear(),this.xa=null,this.Aa.clear(),this.Aa=null,this.Fa&&this.Fa({name:"DataManager"})},Ia:function(t){this.Ta.set(t.buildingID+t.uuid,null),this.xa.set(t.buildingID+t.uuid,null),this.Aa.set(t.buildingID+t.uuid,0)},Na:function(a,u){var c=this;this.Ia(a),this.Qs(a,function(n,t){u&&u(n,t);var s=c.Ca(a),t=a.loadNavi&&s.buildings&&0<s.buildings.length;c.Zs(a,t,function(t,n){u&&u(t,n);for(var e=void 0!==a.level?a.level:parseInt(s.defGid),i=(c.ka(a,e,u),a.visibleLevels||s.levels),r=0;r<i.length;r++)i[r]===e||s.levels.indexOf(i[r])<0||c.ka(a,i[r],u);if(a.preLoad)for(var o=0;o<s.levels.length;o++)s.levels[o]!==e&&-1===i.indexOf(s.levels[o])&&c.ka(a,s.levels[o],u)},function(t){u&&u(n,t)})},function(t,n){u&&u(t,n)})},Zs:function(e,t,i,r){var o=this;t?(t=this.Da(e))?i&&i("gate",t):this.Ra.Zs(e,function(t){o.Sa.get(e.buildingID).gate=t,i&&i("gate",t)},function(t){var n;e.navigationData?((n=o.Sa.get(e.buildingID)).gate=e.navigationData,i&&i("gate",n.gate)):r("error",t)}):i&&i("gate",null)},Qs:function(n,e,i){var r=this,t=this.Ca(n);t?(e&&e("scene",t),n.justDecode||(t=this.lr.get(n.buildingID),e&&e("building",t))):this.Ra.Qs(n,function(t){n.isOutdoor&&r.Ua(t),r.Sa.set(n.buildingID,{scene:t}),e&&e("scene",t),n.justDecode||(t=r.La.va(t),r.lr.set(n.buildingID,t),e&&e("building",t))},function(t){i&&i("error",t===Ri.PATH_ERROR?Ri.MAP_ID_URL_ERROR:t)})},Ua:function(t){var n=t.fileVer;t.buildings&&1<n&&t.buildings.forEach(function(n){n.floors&&(n.levelChart=[],n.fids=[],n.floors.forEach(function(t){t.Ie=xh.oa(t.idxs,t.pts),t.pgid&&n.levelChart.push(t.pgid,t.gid),t.baseLevel&&(n.minlevel=t.minlevel,n.maxlevel=t.maxlevel),t.fids&&n.fids.push.apply(n.fids,t.fids)}))})},ka:function(t,n,e,i){var r=this.Ta.get(t.buildingID+t.uuid);r||this.Ta.set(t.buildingID+t.uuid,r=[]),i?r.unshift(n):r.push(n),this.Oa&&1!==r.length||this.Ba(t,e)},Ba:function(i,r){var o,t,s,a=this,u=this.Ca(i);u&&(o=this.Ta.get(i.buildingID+i.uuid))&&0!==o.length&&((t=this.xa.get(i.buildingID+i.uuid))||this.xa.set(i.buildingID+i.uuid,t=[]),s=o[0],-1!==t.indexOf(s)?(o.splice(o.indexOf(s),1),this.Ba(i,r)):(t.push(s),this.Ga(i,s,function(t,n){var e=a.Aa.get(i.buildingID+i.uuid);"layerGroup"===t&&(r&&r(t,n),a.Aa.set(i.buildingID+i.uuid,++e),e===u.layerGroups.length&&r&&r("decode",a.ja(i)),o.splice(o.indexOf(s),1),a.Ba(i,r)),"layer"===t&&r&&r(t,n),"floor"===t&&(r&&r(t,n),e===u.layerGroups.length)&&r&&r("complete",a.Ha(i))},function(t,n){r&&r(t,n)})))},Ga:function(r,o,s,n){var t,a,u,c,f,e,i=this,h=this.Ca(r),l=this.Xa(h,o);l?(t=l.gname,l=l.naviType||0,a=this.Ma[0],u=0,c=new Map,f=r.merge,e=function(n){var e,i,t;a===++u&&(e=c.get("geo"),i=c.get("biz"),f&&f.merge(o,e,i,h.fileVer),s&&s("layerGroup",c),r.justDecode||((t=n.ci(r,o)).It.forEach(function(t){n.La.ba(t,e,i,h.fileVer),s&&s("layer",t)}),s&&s("floor",t)))},r.loadNavi&&((0!=(l&Kh.WALK_RODE_NETWORK)||h.fileVer<3)&&(a++,this.$s(r,o,t,function(t,n){c.set(t,n),s&&s(t,n),e(i)},function(t){n&&n(t)})),0!=(l&Kh.DRIVE_RODE_NETWORK)&&(a++,this.ta(r,o,t,function(t,n){c.set(t,n),s&&s(t,n),e(i)},function(t){n&&n(t)})),0!=(l&Kh.ACCESSIBLE_RODE_NETWORK))&&(a++,this.na(r,o,t,function(t,n){c.set(t,n),s&&s(t,n),e(i)},function(t){n&&n(t)})),this.qs(r,o,t,function(t,n){c.set(t,n),s&&s(t,n),e(i)},function(t){n&&n(t)}),this.Ks(r,o,t,function(t,n){c.set(t,n),s&&s(t,n),e(i)},function(t){n&&n(t)})):n&&n("error",Ri.DEFAULT_LEVEL_ERROR)},qs:function(n,e,t,i,r){var o=this,s=this.za(n,e,"geo");s?i&&i("geo",s):this.Ra.qs(n,t,function(t){o.Va(n,e,"geo",t),i&&i("geo",t)},function(t){r&&r("error",t)})},Ks:function(n,e,t,i,r){var o=this,s=this.za(n,e,"biz");s?i&&i("biz",s):this.Ra.Ks(n,t,function(t){o.Va(n,e,"biz",t),i&&i("biz",t)},function(t){r&&r("error",t)})},$s:function(n,e,t,i,r){var o=this,s=this.za(n,e,"navi");s?i&&i("navi",s):this.Ra.$s(n,t,function(t){o.Va(n,e,"navi",t),i&&i("navi",t)},function(t){r&&r("error",t)})},ta:function(n,e,t,i,r){var o=this,s=this.za(n,e,"drive_navi");s?i&&i("drive_navi",s):this.Ra.ta(n,t,function(t){o.Va(n,e,"drive_navi",t),i&&i("drive_navi",t)},function(t){r&&r("error",t)})},na:function(n,e,t,i,r){var o=this,s=this.za(n,e,"accessible_navi");s?i&&i("drive_navi",s):this.Ra.na(n,t,function(t){o.Va(n,e,"accessible_navi",t),i&&i("accessible_navi",t)},function(t){r&&r("error",t)})},Pa:function(t,e){this.Ys(t,function(t,n){e&&e(t,n)},function(t,n){e&&e(t,n)})},Ys:function(n,e,i){var r=this,o=this.ja(n);o?e&&e("decode",o):this.Ra.Ys(n,function(t){r.Wa(n,t),o=r.ja(n),e&&e("decode",o),n.justDecode||(t=r.La.da(o),r.lr.set(n.buildingID,t),e&&e("complete",t))},function(t){i&&i("error",t)})},Ha:function(t){if(this.lr)return this.lr.get(t.buildingID)||null},ci:function(t,n){t=this.lr.get(t.buildingID);return t?t.It.get(n):null},Wa:function(t,n){var e={scene:null,floors:new Map},i=this.Ms.vs(n);t.isOutdoor&&this.Ua(i),e.scene=i,e.gate=this.Ms.ys(n);for(var r=0;r<i.layerGroups.length;r++){var o=i.layerGroups[r],s=this.Ms.gs(n,o.gid),a=this.Ms._s(n,o.gid),u=this.Ms.Ss(n,o.gid),c=this.Ms.xs(n,o.gid),f=this.Ms.As(n,o.gid),h=(t.merge&&t.merge.merge(o.gid,s,a,i.fileVer),new Map);h.set("geo",s),h.set("biz",a),h.set("navi",u),h.set("drive_navi",c),h.set("accessible_navi",f),e.floors.set(o.gid,h)}this.Sa.set(t.buildingID,e)},ja:function(t){var n=this.Sa.get(t.buildingID);if(!n)return null;for(var e=n.scene,n=n.gate,i=new Map,n={scene:e,floors:i,gate:n},r=0;r<e.layerGroups.length;r++){var o=e.layerGroups[r],s=o.gid,a={gid:s,gname:o.gname,level:s,geo:[],biz:[],navi:[],naviDrive:[],naviAccessible:[]},u=(a.geo.push(this.za(t,s,"geo")),a.biz.push(this.za(t,s,"biz")),this.za(t,s,"navi")),u=(u&&a.navi.push(u),this.za(t,s,"drive_navi")),u=(u&&a.naviDrive.push(u),this.za(t,s,"accessible_navi"));u&&a.naviAccessible.push(u),i.set(o.gid,a)}return n},Ca:function(t){t=this.Sa.get(t.buildingID);return t?t.scene:null},Da:function(t){t=this.Sa.get(t.buildingID);return t?t.gate:null},Va:function(t,n,e,i){var r,t=this.Sa.get(t.buildingID);t&&((r=t.floors)||(r=new Map,t.floors=r),(t=r.get(n))||(t=new Map,r.set(n,t)),t.set(e,i))},za:function(t,n,e){var t=this.Sa.get(t.buildingID);return(t=t&&t.floors)&&(t=t.get(n))?t.get(e):null},Xa:function(t,n){if(null!=t)for(var e=t.layerGroups,i=0;i<e.length;i++)if(e[i].gid==n)return e[i];return null}}),n);function nl(t,n){return Hs.prototype.copy.call(t,n),t.fragmentShader=n.fragmentShader,t.vertexShader=n.vertexShader,t.uniforms=Us.clone(n.uniforms),t.lights=n.lights,t}function el(n){Object.defineProperties(n,{color:{enumerable:!0,get:function(){return n.uniforms.diffuse.value},set:function(t){n.uniforms.diffuse.value=t}},opacity:{enumerable:!0,get:function(){return n.uniforms.opacity.value},set:function(t){n.uniforms.opacity.value=t}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(t){this.uniforms.map.value=t}}})}function il(t){t.fmcommon={diffuse:{value:new lt(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Z}}}il(Lt),Lt.line={lineWidth:{value:1},resolution:{value:new Mt(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1},mmap:{value:null},offset:{value:new Mt(0,0)},repeat:{value:new Mt(1,1)},miny:{value:0},pcolor:{value:new lt(11447982)},usePassOpacity:{value:0},passOpacity:{value:1}},_a.line={uniforms:Us.merge([Lt.fmcommon,Lt.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\n\t\tuniform float lineWidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute float uvyStart;\n\t\tattribute float uvyEnd;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\t\tattribute vec2 uv2;\n\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec2 vUv2;\n\t\tvarying float uvScale;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\t#include <logdepthbuf_pars_vertex>\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\tfloat duvy = uvyEnd - uvyStart;\n\t\t\tfloat uvy = uvyStart + duvy * uv2.y;\n\t\t\t// vUv2 = vec2(uv2.x ,uvy);\n\t\t\tvUv2 = ( position.y < 0.5 ) ? vec2(uv2.x ,uvyStart) : vec2(uv2.x ,uvyEnd);\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tfloat scaleDir = length(dir);\n\t\t\tuvScale = 0.05/scaleDir;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for lineWidth\n\t\t\toffset *= lineWidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\t#include <logdepthbuf_vertex>\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\t\tuniform vec2 repeat;\n\t\tuniform vec2 offset;\n\t\tuniform float miny;\n\t\tuniform vec3 pcolor;\n\t\tuniform float usePassOpacity;\n\t\tuniform float passOpacity;\n\t  #include <line_gradient_defined>\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\t\tuniform sampler2D mmap;\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\n\t\tvarying float uvScale;\n\t\tvarying vec2 vUv;\n\t\tvarying vec2 vUv2;\n\n\t\t#include <logdepthbuf_pars_fragment>\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\t#ifdef USE_MMAP\n\n\t\t\t\tif(vUv2.y >= miny && miny != 1.0){\n\t\t\t\t    vec4 texColor = texture2D( mmap, vUv2 * repeat + offset );\n\t\t\t\t\tdiffuseColor = vec4(texColor.xyz,min(texColor.w, opacity));\n\t\t\t\t}else{\n\t\t\t\t\tfloat ret = opacity;\n\t\t\t\t\tif(usePassOpacity == 1.0) {\n\t\t\t\t\t\tret = passOpacity;\n\t\t\t\t\t}\n\t\t\t\t\tdiffuseColor = vec4(pcolor, ret);\n\n\t\t\t\t\tif(usePassOpacity == 1.0 && ret < 0.1) {\n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t#endif\n\n\t\t\t#include <line_gradient>\n\n\t\t\tgl_FragColor = diffuseColor;\n\t\t\t#include <encodings_fragment>\n\t\t}\n\t\t"};function rl(t){Hs.call(this,{type:"FMLineMaterial",uniforms:Us.clone(_a.line.uniforms),vertexShader:_a.line.vertexShader,fragmentShader:function(t){var n=_a.line.fragmentShader;if(!t.gradient)return n=(n=n.replace("#include <line_gradient_defined>","")).replace("#include <line_gradient>","");for(var e=(u=t.gradient).percent,i=u.color,r=e.length,o=new lt,s="\n\t\tfloat stops[".concat(r,"];\n\t\tvec3 gradients[").concat(r,"];\n\t\tfloat fromPercent = ").concat(Number(t.distancePercent[0]).toFixed(2),";\n\t\tfloat toPercent = ").concat(Number(t.distancePercent[1]).toFixed(2),";\n\t\t"),a=0;a<r;a++)s+="stops[".concat(a,"] = ").concat(Number(e[a]).toFixed(2),";\n\t\t"),o.setStyle(i[a]),s+="gradients[".concat(a,"] = vec3(").concat(Number(o.r).toFixed(2),",").concat(Number(o.g).toFixed(2),", ").concat(Number(o.b).toFixed(2),");\n\t\t");var u="\n\t\t#ifdef GRADIENT\n\t\t\tfloat remap(float a0,float a1,float b0,float b1,float a) {\n\t\t\t\treturn (a - a0) / (a1 - a0) * (b1 - b0) + b0;\n\t\t\t}\n\n\t\t\tvec3 getGradientColor(float gradientValue) {\n\t\t\t\t".concat(s,"\n\n\t\t\t\tgradientValue = remap(0., 1., fromPercent, toPercent, gradientValue);\n\t\t\t\tfloat t = 0.0;\n\t\t\t\tvec3 color = vec3(0.0);\n\t\t\t\tfor (int i = 0; i < ").concat(r,"; i++) {\n\t\t\t\t\t\tif (gradientValue <= stops[i + 1]) {\n\t\t\t\t\t\t\t\tt = (gradientValue - stops[i]) / (stops[i + 1] - stops[i]);\n\t\t\t\t\t\t\t\tcolor = mix(gradients[i], gradients[i + 1], t);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn color;\n\t\t\t}\n\t\t#endif\n\t\t"),c="",c=t.isNeedArrow?"\n\t\t#ifdef GRADIENT\n\t\t\tdiffuseColor.rgb += getGradientColor( vUv2.y);\n\t\t#endif":"\n\t\t\t#ifdef GRADIENT\n\t\t\t\tdiffuseColor.rgb = getGradientColor( vUv2.y);\n\t\t\t#endif\n\t\t";return n=(n=n.replace("#include <line_gradient_defined>",u)).replace("#include <line_gradient>",c)}(t)}),t.gradient&&(this.defines={GRADIENT:!0}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value.copy(t)}},lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(t){this.uniforms.lineWidth.value=t}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},pcolor:{enumerable:!0,get:function(){return this.uniforms.pcolor.value},set:function(t){this.uniforms.pcolor.value.copy(t)}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}}}),delete t.gradient,delete t.distancePercent,delete t.isNeedArrow,this.setValues(t)}((rl.prototype=Object.create(Hs.prototype)).constructor=rl).prototype.isFMLineMaterial=!0,rl.prototype.copy=function(t){return Hs.prototype.copy.call(this,t),this.color.copy(t.color),this.lineWidth=t.lineWidth,this.resolution=t.resolution,this};var ol=rl;function sl(t){h.call(this),this.type="SpriteMaterial",this.color=new lt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}function al(t){h.call(this),this.type="LineBasicMaterial",this.color=new lt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}function ul(t){Hs.call(this,t),this.type="RawShaderMaterial"}function cl(t){return(cl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fl(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=cl(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=cl(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==cl(t)?t:String(t)}(i.key),i)}}function hl(t,n,e){return n&&fl(t.prototype,n),e&&fl(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}((sl.prototype=Object.create(h.prototype)).constructor=sl).prototype.isSpriteMaterial=!0,sl.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this},((al.prototype=Object.create(h.prototype)).constructor=al).prototype.isLineBasicMaterial=!0,al.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this},((ul.prototype=Object.create(Hs.prototype)).constructor=ul).prototype.isRawShaderMaterial=!0;var n=hl(function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.Ya=!1,this.Qa=new Map,this.Za=new Map}),ll=(Object.assign(n.prototype,{qa:function(t,n){this.Za.has(t)||this.Za.set(t,new Set),this.Za.get(t).add(n)},Ka:function(){this.Qa.clear(),this.Qa=null,this.Za.clear(),this.Za=null}}),n);function dl(t){return(dl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vl(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=dl(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=dl(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==dl(t)?t:String(t)}(i.key),i)}}var pl=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")}var n,e,i;return n=t,i=[{key:"getBrowser",value:function(){if(void 0!==navigator){var t,n,e,i,r,o,s=navigator.userAgent;if(void 0!==s)return t=-1<s.indexOf("Opera"),o=-1<s.indexOf("compatible")&&-1<s.indexOf("MSIE")&&!t,n=-1<s.indexOf("Edge"),e=-1<s.indexOf("Firefox"),i=-1<s.indexOf("Safari")&&-1===s.indexOf("Chrome"),r=-1<s.indexOf("Chrome")&&-1<s.indexOf("Safari"),o?(new RegExp("MSIE (\\d+\\.\\d+);").test(s),7===(o=parseFloat(RegExp.$1))?"IE7":8===o?"IE8":9===o?"IE9":10===o?"IE10":11===o?"IE11":"IE"):t?"Opera":n?"Edge":e?"FF":i?"Safari":r?"Chrome":void 0}}}],(e=null)&&vl(n.prototype,e),i&&vl(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}().getBrowser();function ml(t){return(ml="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yl(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=ml(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=ml(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==ml(t)?t:String(t)}(i.key),i)}}function bl(t,n,e){n=wl(n);var i=t,n=gl()?Reflect.construct(n,e||[],wl(t).constructor):n.apply(t,e);if(n&&("object"===ml(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function gl(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(gl=function(){return!!t})()}function wl(t){return(wl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _l(t,n){return(_l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}n=function(){var t,n,e=r,i=ll;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(){var t;if(this instanceof r)return(t=bl(this,r)).Ja=0,t.$a=0,t.tu=new Map,t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&_l(e,i),e=r,t&&yl(e.prototype,t),n&&yl(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}();Object.assign(n.prototype,{nu:function(t,n,e){var i;return this.Qa.has(t)?(i=this.Qa.get(t),n&&(i.isComplete?i.isError?n(null):n(i):this.qa(t,n))):i=this.eu(t,n,e),i},eu:function(n,t,e){var i,r=this;return this.Ja++,(i=st.a.environment===G.a.WX?st.a.textureHelper.createImage(e):new Image).crossOrigin="Anonymous",i.onload="IE11"===pl?new function(){this.$a++,i.isComplete=!0,r.iu(n,i)}:function(){r.$a++,i.isComplete=!0,r.iu(n,i)},i.onerror=function(t){r.$a++,i.isComplete=!0,i.isError=!0,r.iu(n,null)},i.src=n,i.isComplete=!1,this.Qa.set(n,i),t&&this.qa(n,t),i},iu:function(t,i){this.Za.has(t)&&(this.Za.get(t).forEach(function(t,n,e){n(i),e.delete(t)}),this.Za.delete(t)),0<this.tu.size&&this.Ja===this.$a&&this.tu.forEach(function(t,n){t(n)})},Ka:function(){this.Qa.clear(),this.Za.clear()}});var El=new n,Sl={Left:0,Center:2,Right:4};function Tl(t){return(Tl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xl(t,n){var e,i,r,o,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return i=!(e=!0),{s:function(){s=s.call(t)},n:function(){var t=s.next();return e=t.done,t},e:function(t){i=!0,r=t},f:function(){try{e||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(t)||(s=function(t,n){var e;if(t)return"string"==typeof t?Al(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Al(t,n):void 0}(t))||n&&t&&"number"==typeof t.length)return s&&(t=s),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Al(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function Ml(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Tl(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Tl(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Tl(t)?t:String(t)}(i.key),i)}}function Ol(t,n,e){return n&&Ml(t.prototype,n),e&&Ml(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var n=Ol(function t(n){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.Br=n}),Ll=(Object.assign(n.prototype,{ru:function(t,n){var e=st.a.document.createElement("canvas"),i=e.getContext("2d");return e.width=t,e.height=n,e.style.width=t+"px",e.style.height=n+"px",{canvas:e,ctx:i}},ou:function(t,n,e,i,r){var o=r,s={x:r.x+n,y:r.y},a={x:r.x,y:r.y+e},n={x:r.x+n,y:r.y+e},r={x:o.x+i,y:o.y},e={x:s.x-i,y:s.y},u={x:s.x,y:s.y+i},c={x:n.x,y:n.y-i},f={x:n.x-i,y:n.y},h={x:a.x+i,y:a.y},l={x:a.x,y:a.y-i},d={x:o.x,y:o.y+i};t.beginPath(),t.moveTo(r.x,r.y),t.lineTo(e.x,e.y),t.arcTo(s.x,s.y,u.x,u.y,i),t.lineTo(c.x,c.y),t.arcTo(n.x,n.y,f.x,f.y,i),t.lineTo(h.x,h.y),t.arcTo(a.x,a.y,l.x,l.y,i),t.lineTo(d.x,d.y),t.arcTo(o.x,o.y,r.x,r.y,i),t.closePath()},su:function(t,r){var o,s=this;t?((o=new Image).crossOrigin="Anonymous",o.onload=function(){var t=o.width,n=o.height,e=s.ru(t,n),i=e.canvas,e=e.ctx,e=(i.width=t,i.height=n,e.drawImage(o,0,0,t,n),s.ru(n,t));e.ctx.translate(n/2,t/2),e.ctx.rotate(Math.PI/2),e.ctx.drawImage(i,-t/2,-n/2,t,n),r&&r(e.canvas)},o.src=t):r(null)},au:function(t,n,e,i){var r,o,s,a,u=null!=(u=i.scale)?u:2,c=1,f=void 0!==i.needSize&&i.needSize,h=e.fontsize*u*1.2,l=void 0!==e.fontWeight?e.fontWeight:400,d=this.uu(i.family,e.fontFamily),v=2*u,p=0,m=0,l="".concat(l," ").concat(h,"px ").concat(d),d=void 0!==e.space?e.space*u:2*u,y=0,b=(void 0!==e.plateSize&&(y=(e.plateSize-e.fontsize)/2*u),y=Math.max(y,3*u),h/3),g=0,w=[],_=0*u,E=0*u,S=st.a.document.createElement("canvas"),T=S.getContext("2d"),x=(T.font=l,T.textBaseline="Alphabetic",1.2*e.fontsize*u),A=(void 0!==e.imageSize&&(x=1.2*e.imageSize*u),n&&0!=x||(d=x=0),-1<t.indexOf("%rn%"));if(A){var M,O=xl(w=t.split("%rn%"));try{for(O.s();!(M=O.n()).done;){var L=M.value,p=Math.max(T.measureText(L).width+v,p);m+=h}}catch(t){O.e(t)}finally{O.f()}m+=w.length*v}else p=T.measureText(t).width+v,m=h+v;if(r=Math.ceil(m)+2*y,s=2*E+x+d+(o=Math.ceil(p)+2*y),a=2*_+Math.max(r,x),e.plateStrokeColor&&(s+=2*u,a+=2*u),!0===i.onlyNeedSize)return{width:s,height:a};g=A?m/w.length/2+b+_+y:a/2+b,A&&(c=a/(h+2*_+2*y)),S.width=s,S.height=a,S.style.width=s+"px",S.style.height=a+"px",S.spriteScale=c,T.font=l,st.a.environment===G.a.WX&&(T.shadowOffsetX=0,T.shadowOffsetY=0,T.shadowBlur=0,T.shadowColor="rgba(0,0,0,0.0)"),T.clearRect(0,0,S.width,S.height),(e.plateColor||e.plateStrokeColor)&&(e.plateColor&&(T.fillStyle=e.plateColor),T.lineWidth=u,this.ou(T,o,r,5*u,{x:x+E+d,y:a/2-r/2}),e.plateColor&&T.fill(),e.plateStrokeColor&&(T.strokeStyle=e.plateStrokeColor,T.stroke()),T.beginPath()),n&&T.drawImage(n,E,(a-x)/2,x,x);var R=x+E+d+y+v/2,b=(T.lineWidth=2*u*(void 0!==e.strokeWidth?e.strokeWidth:1),1);if(void 0!==e.strokeWidth&&(b=parseFloat(e.strokeWidth)),e.strokeColor&&0!==b)if(T.strokeStyle=e.strokeColor,A)for(var N=g,P=0;P<w.length;P++)P&&(N+=h+v),n?(T.textAlign="left",T.strokeText(w[P],R,N)):i.textAlign===Sl.Left?(T.textAlign="left",T.strokeText(w[P],0,N)):i.textAlign===Sl.Right?(T.textAlign="right",T.strokeText(w[P],s,N)):(T.textAlign="center",T.strokeText(w[P],s/2,N));else n?(T.textAlign="left",T.strokeText(t,R,g)):i.textAlign===Sl.Left?T.strokeText(t,0,g):i.textAlign===Sl.Right?(T.textAlign="right",T.strokeText(t,s,g)):(T.textAlign="center",T.strokeText(t,s/2,g));if(T.fillStyle=e.fillColor,A||!1===i.drawText){if(!1!==i.drawText)for(var j=g,F=0;F<w.length;F++)F&&(j+=h+v),n?(T.textAlign="left",T.fillText(w[F],R,j)):i.textAlign===Sl.Left?(T.textAlign="left",T.fillText(w[F],0,j)):i.textAlign===Sl.Right?(T.textAlign="right",T.fillText(w[F],s,j)):(T.textAlign="center",T.fillText(w[F],s/2,j))}else n?(T.textAlign="left",T.fillText(t,R,g)):i.textAlign===Sl.Left?(T.textAlign="left",T.fillText(t,0,g)):i.textAlign===Sl.Right?(T.textAlign="right",T.fillText(t,s,g)):(T.textAlign="center",T.fillText(t,s/2,g));c=0;return f&&(c=A?e.fontsize+(v*(w.length-1)+_+y)/w.length:e.fontsize+_+y,S.size=c),S.drawTextWidth=p,S.drawTextLeft=R,S},cu:function(t){var n=t.width,e=t.height,i=t.arrowWidth||10,r=this.ru(n,e),o=r.canvas,r=r.ctx,s=(r.fillStyle=t.godEdgeColor,r.fillRect(0,0,n,e),n*(1-t.godEdgePercent));r.fillStyle=t.godColor,r.fillRect((n-s)/2,0,s,e),r.fillStyle="#ffffff",r.shadowOffsetX=-2,r.shadowOffsetY=2,r.shadowBlur=4,r.shadowColor="rgba(0,0,0,0.5)";var a=n/2,u=e/2,c=e*t.godArrowPercent,s=s*t.godArrowWidthPercent,a=a-s/2,u=u+c/2,i=(r.beginPath(),r.moveTo(a,u),r.lineTo(a,u+i),r.lineTo(a+s/2,u-c+i),r.lineTo(a+s,u+i),r.lineTo(a+s,u),r.lineTo(a+s/2,u-c),r.closePath(),r.fillStyle=t.godArrowColor,r.fill(),this.ru(e,n));return i.ctx.translate(e/2,n/2),i.ctx.rotate(Math.PI/2),i.ctx.drawImage(o,-n/2,-e/2,n,e),i.canvas},fu:function(t){var n=t.width,e=t.height,i=this.ru(n,e),r=i.canvas,i=i.ctx,n=(this.hu(i,n,e),t.height*t.arrowHeightPercent),e=(1-t.arrowHeightPercent)*t.height/2,o=t.width*(t.arrowWidthPercent-t.arrowPercent);return i.beginPath(),i.moveTo(0,e),i.lineTo(o,e),i.lineTo(t.width*t.arrowWidthPercent,e+n/2),i.lineTo(o,e+n),i.lineTo(0,e+n),i.lineTo(t.width*t.arrowPercent,e+n/2),i.closePath(),i.fillStyle=t.color,i.fill(),r},hu:function(t,n,e){var i=new Z,r=(i.set(Math.cos(Math.PI/2),-Math.sin(Math.PI/2),+n/2,Math.sin(Math.PI/2),Math.cos(Math.PI/2),+e/2,0,0,1),new Z),n=(r.set(1,0,-n/2,0,1,-e/2,0,0,1),i.multiply(r),i.elements);t.transform(n[0],n[3],n[1],n[4],n[2],n[6])},lu:function(e){var t=e.width,n=e.height,i=e.dashArray,r=this.ru(t,n),o=r.canvas,s=r.ctx,a=(this.hu(s,t,n),i.reduce(function(t,n){return t+n})),u=0,r=(i.forEach(function(t,n){n%2==0&&(s.fillStyle=e.color,s.fillRect(u/a*e.width,0,t/a*e.width,e.height)),u+=t}),this.ru(n,t));return r.ctx.translate(n/2,t/2),r.ctx.rotate(Math.PI/2),r.ctx.drawImage(o,-t/2,-n/2,t,n),r.canvas},uu:function(t,n){var e=this.Br.fi.Ve.fontFamily;return void 0!==t?t+","+e:void 0!==n&&'"Microsoft Yahei","",Tahoma,Arial'===e?n:e},nn:function(){}}),n);function Rl(t){return(Rl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Nl(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Rl(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Rl(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Rl(t)?t:String(t)}(i.key),i)}}function Pl(t,n,e){n=Fl(n);var i=t,n=jl()?Reflect.construct(n,e||[],Fl(t).constructor):n.apply(t,e);if(n&&("object"===Rl(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function jl(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(jl=function(){return!!t})()}function Fl(t){return(Fl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Il(t,n){return(Il=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var n=function(){var t,n,e=r,i=ll;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(){if(this instanceof r)return Pl(this,r);throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Il(e,i),e=r,t&&Nl(e.prototype,t),n&&Nl(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(),Cl=(Object.assign(n.prototype,{du:function(t){var n,e=[];for(n in t)e.push(t[n]);return e.join()}}),n);function kl(t){return(kl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dl(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=kl(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=kl(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==kl(t)?t:String(t)}(i.key),i)}}function Ul(t,n,e){n=Gl(n);var i=t,n=Bl()?Reflect.construct(n,e||[],Gl(t).constructor):n.apply(t,e);if(n&&("object"===kl(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return Hl(i)}function Bl(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Bl=function(){return!!t})()}function Gl(t){return(Gl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Hl(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Xl(t,n){return(Xl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}function zl(t){Hs.call(this),this.type="FMMeshLambertMaterial",this.uniforms=Us.clone(_a.fmLambert.uniforms),this.vertexShader=_a.fmLambert.vertexShader,this.fragmentShader=_a.fmLambert.fragmentShader,this.lights=!0,this.fog=!0,el(this),Object.defineProperties(this,{emissive:{enumerable:!0,get:function(){return this.uniforms.emissive.value},set:function(t){this.uniforms.emissive.value=t}},mapMixColor:{enumerable:!0,get:function(){return this.uniforms.mapMixColor.value},set:function(t){this.uniforms.mapMixColor.value=t}}}),this.setValues(t)}var n=function(){var t,n,e=r,i=Cl;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(t){var n;if(this instanceof r)return(n=Ul(this,r)).Fa=null,n.Mo=n.Mo.bind(Hl(n)),n.Vs=new dh({disposeCallback:n.Mo,enable:!0,name:"TextureManager",mapCreateTime:t.mapCreateTime}),n;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Xl(e,i),e=r,t&&Dl(e.prototype,t),n&&Dl(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(),Vl=(Object.assign(n.prototype,{vu:function(n,e){if(st.a.environment==G.a.BROWSER)r=new Gc(n);else{var i=e.paramKey,r=new l;if(e.labelImageCatch[i].image)return r.image=e.labelImageCatch[i].image,r.minFilter=B,r.generateMipmaps=!1,r.needsUpdate=!0,t=e.labelImageCatch[i].texture,r.scaleRatio=t.scaleRatio,r.mspriteScale=t.mspriteScale,e.needSize&&(r.size=t.size),r.needsUpdate=!0,e&&e.callback&&e.callback(r),r.useCatch=!0,r;e.labelImageCatch[i].texture={scaleRatio:n.height/n.width,mspriteScale:n.spriteScale,size:n.size};var t=n.toDataURL("image/png");st.a.textureHelper.createImage({url:t,onload:function(t){r.image=t,r.needsUpdate=!0,e&&e.callback&&e.callback(r),e.labelImageCatch[i].canvas={size:n.size,spriteScale:n.spriteScale,width:n.width,height:n.height},e.labelImageCatch[i].image=t}})}return r.minFilter=B,r.generateMipmaps=!1,r.needsUpdate=!0,r},pu:function(t){var n=new l;return n.minFilter=B,n.generateMipmaps=!1,n.flipY=t.flipY,n},mu:function(t,n){var r,e,o=this,s=(void 0===t.flipY&&(t.flipY=!0),this.du(t));return this.Qa.has(s)?this.Za.has(s)?this.qa(s,n):n(r=this.Qa.get(s)):(r=this.pu(t),this.Qa.set(s,r),this.qa(s,n),e="_getTexture"+Tt.generateUUID(),this.Vs.Hs(e),El.nu(t.url,function(i){r.image=i,r.needsUpdate=!0,o.Za.get(s).forEach(function(t,n,e){i&&n(r),e.delete(t)}),o.Za.delete(s),o.Vs.Xs(e)},{needDraw:t.needDraw})),r},yu:function(t,n){var e=this.vu(t,n);return e.useCatch||(e.scaleRatio=t.height/t.width,e.mspriteScale=t.spriteScale,n.needSize&&(e.size=t.size)),e},nn:function(t){this.Fa=t,this.Vs.Gs(!0)},Mo:function(){this.Qa.forEach(function(t,n,e){t.dispose(),e.delete(n)}),this.Qa.clear(),this.Qa=null,this.Za.forEach(function(t,n,e){t.forEach(function(t,n,e){e.delete(n)}),e.delete(n)}),this.Za.clear(),this.Za=null,this.Fa&&this.Fa({name:"TextureManager"})}}),n),Wl=(il(Lt),_a.fmLambert={uniforms:Us.merge([Lt.fmcommon,Lt.lights,{emissive:{value:new lt(0)},mapMixColor:{value:!1},fogColor:{value:new lt(0)},fogDensity:{value:0},isMask:{value:!1},maskType:{value:0},maskTexture:{value:null},maskHeight:{value:0},maskExtrudeHeight:{value:-1}}]),vertexShader:"\n#define LAMBERT\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\nvarying vec2 vUvMask;\nvarying vec3 v_positionMask;\nvarying float v_positionHeight;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n \n#include <common>             \n#include <uv_pars_vertex>     \n#include <bsdfs>              \n#include <lights_pars_begin>  \n#include <logdepthbuf_pars_vertex>\n#include <fog_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>    \n\tvUvMask=uv;\n\tv_positionMask = vec3(modelMatrix * vec4( position, 1.0 ));\n\tv_positionHeight = vec3(modelMatrix*vec4(0.0,0.0,0.0,1.0)).y;\n\t#include <beginnormal_vertex>    \n\t#include <morphnormal_vertex>    \n\t#include <defaultnormal_vertex>  \n\n\t#include <begin_vertex>            \n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>   \n\t#include <clipping_planes_vertex>      \n\t\n\t#include <worldpos_vertex>        \n\t#include <lights_lambert_vertex>  \n\t#include <fog_vertex>\n\t\n}\n",fragmentShader:"\nuniform bool mapMixColor;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\nuniform bool isMask;\nuniform float maskType;\nuniform sampler2D maskTexture;\nuniform float maskHeight;\nuniform float maskExtrudeHeight;\nvarying vec2 vUvMask;\nvarying vec3 v_positionMask;\nvarying float v_positionHeight;\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n\n#include <common>                    \n#include <packing>                  \n#include <uv_pars_fragment>        \n#include <map_pars_fragment>         \n#include <bsdfs>                        \n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>       \n#include <fog_pars_fragment>   \n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif(isMask){\n\t\tvec4 maskColor=texture2D(maskTexture,vUvMask);\n\t\tif(maskType==0.0){\n\t\t\tif(maskColor.r==1.0&&maskColor.g==1.0&&maskColor.b==1.0){\n\t\t\t\tif(maskExtrudeHeight>0.0){\n\t\t\t\t\tif(v_positionMask.y >= v_positionHeight + maskHeight && v_positionMask.y <= v_positionHeight + maskHeight+maskExtrudeHeight){\n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdiscard;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t} else {\n\t\t\tif(maskColor.r==0.0&&maskColor.g==0.0&&maskColor.b==0.0){\n\t\t\t\tif(maskExtrudeHeight>0.0){\n\t\t\t\t\tif(v_positionMask.y >= v_positionHeight + maskHeight && v_positionMask.y <= v_positionHeight + maskHeight+maskExtrudeHeight){\n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdiscard;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n    #include <logdepthbuf_fragment>\n\t#include <map_fragment_1>     \n\t  \n\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\n\t#endif\n\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\n\t#else\n\n\t\treflectedLight.directDiffuse = vLightFront;\n\n\t#endif\n\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <fog_fragment>  \n}\n"},((zl.prototype=Object.create(Hs.prototype)).constructor=zl).prototype.isFMMeshLambertMaterial=!0,zl.prototype.copy=function(t){return nl(this,t)},zl);function Yl(t){Hs.call(this),this.type="FMMeshBasicMaterial",this.uniforms=Us.clone(_a.fmBasic.uniforms),this.vertexShader=_a.fmBasic.vertexShader,this.fragmentShader=_a.fmBasic.fragmentShader,el(this),this.setValues(t)}il(Lt),_a.fmBasic={uniforms:Us.merge([Lt.fmcommon,{isMask:{value:!1},maskType:{value:0},maskTexture:{value:null},maskHeight:{value:0},maskExtrudeHeight:{value:-1},boundCenter:{value:new Mt(0,0)},boundSize:{value:new Mt(0,0)}}]),vertexShader:"\n#include <common> \n#include <uv_pars_vertex> \n#include <logdepthbuf_pars_vertex>\n#include <fog_pars_vertex>\nvarying vec2 vUvMask;\nvarying vec3 v_positionMask;\nvarying float v_positionHeight;\n\nvoid main() {\n\n\t#include <uv_vertex> \n\n\tvUvMask=uv;\n\tv_positionMask = vec3(modelMatrix * vec4( position, 1.0 ));\n\tv_positionHeight = vec3(modelMatrix*vec4(0.0,0.0,0.0,1.0)).y;\n\n\t#include <begin_vertex>       \n\t#include <project_vertex>   \n\t#include <logdepthbuf_vertex>     \n\n\t#include <worldpos_vertex>    \n\t#include <fog_vertex>\n}\n",fragmentShader:"\nuniform vec3 diffuse;\nuniform float opacity;\n\nuniform bool isMask;\nuniform float maskType;\nuniform sampler2D maskTexture;\nuniform float maskHeight;\nuniform float maskExtrudeHeight;\nuniform vec2 boundCenter;\nuniform vec2 boundSize;\nvarying vec2 vUvMask;\nvarying vec3 v_positionMask;\nvarying float v_positionHeight;\n\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>                \n#include <uv_pars_fragment>       \n#include <map_pars_fragment>   \n#include <logdepthbuf_pars_fragment>       \n#include <fog_pars_fragment>     \n \n\nvoid main() {\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tif(isMask){\n\t\tvec2 uvMesk=vec2((v_positionMask.x -  (boundCenter.x - boundSize.x/2.0)) / boundSize.x , (v_positionMask.z - (boundCenter.y-boundSize.y/2.0)) / boundSize.y);\n\t\tvec4 maskColor=texture2D(maskTexture,uvMesk);\n\t\tif(maskType==0.0){\n\t\t\tif(maskColor.r==1.0&&maskColor.g==1.0&&maskColor.b==1.0){\n\t\t\t\tif(maskExtrudeHeight>0.0){\n\t\t\t\t\tif(v_positionMask.y >= v_positionHeight + maskHeight && v_positionMask.y <= v_positionHeight + maskHeight+maskExtrudeHeight){\n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdiscard;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t} else {\n\t\t\tif(maskColor.r==0.0&&maskColor.g==0.0&&maskColor.b==0.0){\n\t\t\t\tif(maskExtrudeHeight>0.0){\n\t\t\t\t\tif(v_positionMask.y >= v_positionHeight + maskHeight && v_positionMask.y <= v_positionHeight + maskHeight+maskExtrudeHeight){\n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tdiscard;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#include <map_fragment>    \n\t#include <logdepthbuf_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n\t#ifdef USE_LIGHTMAP\n\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\n\t#endif\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <fog_fragment>  \n \n}\n"},((Yl.prototype=Object.create(Hs.prototype)).constructor=Yl).prototype.isFMMeshBasicMaterial=!0,Yl.prototype.copy=function(t){return Hs.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Us.clone(t.uniforms),this};function Ql(t){return(Ql="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Zl(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Ql(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Ql(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Ql(t)?t:String(t)}(i.key),i)}}function ql(t,n,e){n=Jl(n);var i=t,n=Kl()?Reflect.construct(n,e||[],Jl(t).constructor):n.apply(t,e);if(n&&("object"===Ql(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function Kl(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Kl=function(){return!!t})()}function Jl(t){return(Jl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $l(t,n){return($l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var td=Us.merge([{sweepW:{value:0},sweepH:{value:0},se2N:{value:new Mt(0,0)},se2RN:{value:new Mt(0,0)},moveP:{value:new Mt(0,0)},color_r:{value:new lt(16711935)},color_a:{value:new lt(16776960)},isRect:{value:!1},isAnnulus:{value:!1},isEnable:{value:!1},circleC:{value:new Mt(0,0)},maxR:{value:0},minR:{value:0},isSweepTexture:{value:!1},sweepTexture:{value:null},sweepStrength:{value:1},isMask:{value:!1},maskType:{value:0},maskTexture:{value:null},maskHeight:{value:0},maskExtrudeHeight:{value:-1},boundCenter:{value:new Mt(0,0)},boundSize:{value:new Mt(0,0)}},_a.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Mt(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new lt(0)},transparency:{value:0}}]),n=function(){var t,n=i,e=Hs;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(){var t;if(this instanceof i)return(t=ql(this,i)).type="FMMeshStandardMaterial",t.uniforms=Us.clone(td),t.vertexShader="\n    #define STANDARD\n    \n    varying vec3 vViewPosition;\n    varying vec3 v_position;\n\n    varying float v_positionHeight;\n    \n    #ifndef FLAT_SHADED\n\n        varying vec3 vNormal;\n    \n        #ifdef USE_TANGENT\n    \n            varying vec3 vTangent;\n            varying vec3 vBitangent;\n    \n        #endif\n    \n    #endif\n    \n    #include <common>\n    #include <uv_pars_vertex>\n    #include <uv2_pars_vertex>\n    #include <displacementmap_pars_vertex>\n    #include <color_pars_vertex>\n    #include <fog_pars_vertex>\n    #include <morphtarget_pars_vertex>\n    #include <skinning_pars_vertex>\n    #include <shadowmap_pars_vertex>\n    #include <logdepthbuf_pars_vertex>\n    #include <clipping_planes_pars_vertex>\n\n    void main() {\n      \t#include <uv_vertex>\n        #include <uv2_vertex>\n        #include <color_vertex>\n    \n        #include <beginnormal_vertex>\n        #include <morphnormal_vertex>\n        #include <skinbase_vertex>\n        #include <skinnormal_vertex>\n        #include <defaultnormal_vertex>\n        \n        #ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n        \n            vNormal = normalize( transformedNormal );\n        \n            #ifdef USE_TANGENT\n        \n                vTangent = normalize( transformedTangent );\n                vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n        \n            #endif\n        \n        #endif\n        \n        #include <begin_vertex>\n        #include <morphtarget_vertex>\n        #include <skinning_vertex>\n        #include <displacementmap_vertex>\n        #include <project_vertex>\n        #include <logdepthbuf_vertex>\n        #include <clipping_planes_vertex>\n    \n        vViewPosition = - mvPosition.xyz;\n    \n        vec4 pos = vec4(position, 1.0);\n        v_position = vec3(modelMatrix * vec4( position, 1.0 ));\n\n        v_positionHeight = vec3(modelMatrix*vec4(0.0,0.0,0.0,1.0)).y;\n    \n        #include <worldpos_vertex>\n        #include <shadowmap_vertex>\n        #include <fog_vertex>\n    }\n ",t.fragmentShader="\n\n\n\t#define STANDARD\n\n\t#ifdef PHYSICAL\n\t\t#define REFLECTIVITY\n\t\t#define CLEARCOAT\n\t\t#define TRANSPARENCY\n\t#endif\n\n\tvarying vec3 v_position;\n\tvarying vec2 vUvMask;\n    varying float v_positionHeight;\n\n\tuniform bool isRect;\n\tuniform bool isAnnulus;\n\n\tuniform float sweepW;\n\tuniform float sweepH;\n\tuniform vec2 se2N;\n\tuniform vec2 se2RN;\n\tuniform vec2 moveP;\n\tuniform vec3 color_r;\n\n\tuniform vec2 circleC;\n\tuniform float maxR;\n\tuniform float minR;\n\tuniform vec3 color_a;\n\n\tuniform bool isSweepTexture;\n\tuniform sampler2D sweepTexture;\n\tuniform float sweepStrength;\n\n\tuniform bool isMask;\n\tuniform float maskType;\n\tuniform sampler2D maskTexture;\n\tuniform float maskHeight;\n\tuniform float maskExtrudeHeight;\n\tuniform vec2 boundCenter;\n\tuniform vec2 boundSize;\n\n\tbool isInRectW(vec2 v, vec2 a, float w){\n\t\tfloat a1 = abs(dot(v,a));\n\t\treturn a1 < w;\n\t}\n\tbool isInRectH(vec2 v, vec2 a, float h){\n\t\tfloat a1 = abs(dot(v,a));\n\t\treturn a1 < h;\n\t}\n\n\tbool isMaxCircle(vec3 a, vec2 b, float r){\n\t\tfloat c = pow((a.x-b.x),2.0)+pow((a.z-b.y),2.0);\n\t\treturn c <= pow(r,2.0);\n\t}\n\n\tbool isMinCircle(vec3 a, vec2 b, float r){\n\t\tfloat c = pow((a.x-b.x),2.0)+pow((a.z-b.y),2.0);\n\t\treturn c > pow(r,2.0);\n\t}\n\n\tuniform vec3 diffuse;\n\tuniform vec3 emissive;\n\tuniform float roughness;\n\tuniform float metalness;\n\tuniform float opacity;\n\tuniform bool isEnable;\n\n\t#ifdef TRANSPARENCY\n\t\tuniform float transparency;\n\t#endif\n\n\t#ifdef REFLECTIVITY\n\t\tuniform float reflectivity;\n\t#endif\n\n\t#ifdef CLEARCOAT\n\t\tuniform float clearcoat;\n\t\tuniform float clearcoatRoughness;\n\t#endif\n\n\t#ifdef USE_SHEEN\n\t\tuniform vec3 sheen;\n\t#endif\n\n\tvarying vec3 vViewPosition;\n\n\t#ifndef FLAT_SHADED\n\n\t\tvarying vec3 vNormal;\n\n\t\t#ifdef USE_TANGENT\n\n\t\t\tvarying vec3 vTangent;\n\t\t\tvarying vec3 vBitangent;\n\n\t\t#endif\n\n\t#endif\n\n\t#include <common>\n\t#include <packing>\n\t#include <dithering_pars_fragment>\n\t#include <color_pars_fragment>\n\t#include <uv_pars_fragment>\n\t#include <uv2_pars_fragment>\n\t#include <map_pars_fragment>\n\t#include <alphamap_pars_fragment>\n\t#include <aomap_pars_fragment>\n\t#include <lightmap_pars_fragment>\n\t#include <emissivemap_pars_fragment>\n\t#include <bsdfs>\n\t#include <cube_uv_reflection_fragment>\n\t#include <envmap_common_pars_fragment>\n\t#include <envmap_physical_pars_fragment>\n\t#include <fog_pars_fragment>\n\t#include <lights_pars_begin>\n\t#include <lights_physical_pars_fragment>\n\t#include <shadowmap_pars_fragment>\n\t#include <bumpmap_pars_fragment>\n\t#include <normalmap_pars_fragment>\n\t#include <clearcoat_pars_fragment>\n\t#include <roughnessmap_pars_fragment>\n\t#include <metalnessmap_pars_fragment>\n\t#include <logdepthbuf_pars_fragment>\n\t#include <clipping_planes_pars_fragment>\n\n\tvoid main() {\n\t\t#include <clipping_planes_fragment>\n\t\tif(isMask){\n\t\t\tvec2 uvMesk=vec2((v_position.x -  (boundCenter.x - boundSize.x/2.0)) / boundSize.x , (v_position.z - (boundCenter.y-boundSize.y/2.0)) / boundSize.y);\n\t\t\tvec4 maskColor=texture2D(maskTexture,uvMesk);\n\t\t\tif(maskType==0.0){\n\t\t\t\tif(maskColor.r==1.0&&maskColor.g==1.0&&maskColor.b==1.0){\n\t\t\t\t\tif(maskExtrudeHeight>0.0){\n\t\t\t\t\t\tif(v_position.y >= v_positionHeight + maskHeight && v_position.y <= v_positionHeight + maskHeight+maskExtrudeHeight){\n\t\t\t\t\t\t\tdiscard;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif(maskColor.r==0.0&&maskColor.g==0.0&&maskColor.b==0.0){\n\t\t\t\t\tif(maskExtrudeHeight>0.0){\n\t\t\t\t\t\tif(v_position.y >= v_positionHeight + maskHeight && v_position.y <= v_positionHeight + maskHeight+maskExtrudeHeight){\n\t\t\t\t\t\t\tdiscard;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdiscard;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t\tvec3 totalEmissiveRadiance = emissive;\n\n\t\t#include <logdepthbuf_fragment>\n\t\t#include <map_fragment>\n\t\t#include <color_fragment>\n\t\t#include <alphamap_fragment>\n\t\t#include <alphatest_fragment>\n\t\t#include <roughnessmap_fragment>\n\t\t#include <metalnessmap_fragment>\n\t\t#include <normal_fragment_begin>\n\t\t#include <normal_fragment_maps>\n\t\t#include <clearcoat_normal_fragment_begin>\n\t\t#include <clearcoat_normal_fragment_maps>\n\t\t#include <emissivemap_fragment>\n\n\t\t// accumulation\n\t\t#include <lights_physical_fragment>\n\t\t#include <lights_fragment_begin>\n\t\t#include <lights_fragment_maps>\n\t\t#include <lights_fragment_end>\n\n\t\t// modulation\n\t\t#include <aomap_fragment>\n\n\t\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t\t// this is a stub for the transparency model\n\t\t#ifdef TRANSPARENCY\n\t\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t\t#endif\n\n\t\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t\tif(isRect&&isEnable){\n\n\t\t\tvec2 v = vec2(v_position.x - moveP.x, v_position.z - moveP.y);\n\t\t\tif(isInRectW(v,se2N,sweepW) && isInRectH(v,se2RN,sweepH)){\n\t\t\t\tgl_FragColor = vec4(mix(gl_FragColor.rgb, sweepStrength*color_a.rgb, 0.5),gl_FragColor.a);\n\t\t\t}\n\t\t}\n\t\tif(isAnnulus&&isEnable){\n\t\t\tif(isMaxCircle(v_position.xyz,circleC,maxR) && isMinCircle(v_position.xyz,circleC,minR)){\n\t\t\t\tif(isSweepTexture){\n\t\t\t\t\tvec2 uv = vec2((v_position.x-(circleC.x-maxR))/(2.0*maxR),(v_position.z-(circleC.y-maxR))/(2.0*maxR));\n\t\t\t\t\tvec4 tex = texture2D( sweepTexture, uv );\n\t\t\t\t\ttex = mapTexelToLinear( tex );\n\t\t\t\t\tfloat d2 = pow(v_position.x-circleC.x,2.0) + pow(v_position.z-circleC.y,2.0);\n\t\t\t\t\tfloat a = smoothstep(0.0, pow(maxR,2.0), d2);\n\t\t\t\t\ta = 1.0 - a;\n\t\t\t\t\ttex.a = a;\n\t\t\t\t\tgl_FragColor = vec4(mix(gl_FragColor.rgb, sweepStrength*tex.rgb, 0.2),gl_FragColor.a);\n\t\t\t\t} else {\n\t\t\t\t\tgl_FragColor = vec4(mix(gl_FragColor.rgb, sweepStrength*color_a.rgb, 0.5),gl_FragColor.a);\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\t#include <tonemapping_fragment>\n\t\t#include <encodings_fragment>\n\t\t#include <fog_fragment>\n\t\t#include <premultiplied_alpha_fragment>\n\t\t#include <dithering_fragment>\n\t}\n",t.lights=!0,t.fog=!0,t;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&$l(n,e),n=i,(e=[{key:"copy",value:function(t){return nl(this,t)}}])&&Zl(n.prototype,e),t&&Zl(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),nd=(n.prototype.isFMMeshStandardMaterial=!0,n);function ed(t){return(ed="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function id(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=ed(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=ed(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==ed(t)?t:String(t)}(i.key),i)}}var rd=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")}var n,e,i;return n=t,i=[{key:"setPixel",value:function(t){var n=t.x,e=t.y,i=t.color,r=t.d,t=t.width;r[4*(e*t+n)+0]=i[0],r[4*(e*t+n)+1]=i[1],r[4*(e*t+n)+2]=i[2],r[4*(e*t+n)+3]=i[3]}},{key:"getPowerOfTwoSizeCanvas",value:function(t){var n=Tt.floorPowerOfTwo(t.width),e=Tt.floorPowerOfTwo(t.height),i=st.a.document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return i.width=n,i.height=e,i.getContext("2d").drawImage(t,0,0,n,e),i}},{key:"sizeCanvas",value:function(t,n,e){var i=st.a.document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=(i.width=n,i.height=e,i.getContext("2d")),e=i.width/2,r=i.height/2,o=Math.min(i.width/t.width,i.height/t.height),s=t.width*o,o=t.height*o,e=e-s/2,r=r-o/2;return n.clearRect(0,0,i.width,i.height),n.drawImage(t,0,0,t.width,t.height,e,r,s,o),i}}],(e=null)&&id(n.prototype,e),i&&id(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}();function od(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var i,r,o,s,a=[],u=!0,c=!1;try{if(o=(e=e.call(t)).next,0===n){if(Object(e)!==e)return;u=!1}else for(;!(u=(i=o.call(e)).done)&&(a.push(i.value),a.length!==n);u=!0);}catch(t){c=!0,r=t}finally{try{if(!u&&null!=e.return&&(s=e.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(t,n)||sd(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function sd(t,n){var e;if(t)return"string"==typeof t?ad(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?ad(t,n):void 0}function ad(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function ud(n,t){var e,i=Object.keys(n);return Object.getOwnPropertySymbols&&(e=Object.getOwnPropertySymbols(n),t&&(e=e.filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})),i.push.apply(i,e)),i}function cd(i){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ud(Object(r),!0).forEach(function(t){var n,e;n=i,e=r[t=t],(t=ld(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):ud(Object(r)).forEach(function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(r,t))})}return i}function fd(t){return(fd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function hd(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,ld(i.key),i)}}function ld(t){t=function(t,n){if("object"!=fd(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=fd(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==fd(t)?t:String(t)}var n=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.fi=t,this.bu=new Ll(this),this.gu=new Vl({mapCreateTime:this.fi.Lt.wu}),this._u={},this.Eu=new Map,this.Su=new Map,this.Tu=new Map,this.xu=new Map,this.Au=new Map,this.Mu=new Map,this.Ou={},this.Lu={},this.Fa=null,this.Mo=this.Mo.bind(this),this.Vs=new dh({disposeCallback:this.Mo,enable:!0,name:"MaterialManager",mapCreateTime:this.fi.Lt.wu}),this.Ru=null,this.Nu={},this.Pu()}var t,e,i;return t=n,(e=[{key:"lamberMaterials",get:function(){return this.Su}},{key:"getMaterialCacheKey",value:function(t){return this.ju(t)}},{key:"regHook",value:function(t,n){this.Nu[t]||(this.Nu[t]=[]),this.Nu[t].push(n)}},{key:"callHook",value:function(t){for(var n=arguments.length,e=new Array(1<n?n-1:0),i=1;i<n;i++)e[i-1]=arguments[i];t=this.Nu[t];t&&t.forEach(function(t){return t.apply(void 0,e)})}}])&&hd(t.prototype,e),i&&hd(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}(),dd=(Object.assign(n.prototype,{Fu:function(t,n){this.Ou[n.uuid]||(this.Ou[n.uuid]=[]),this.Ou[n.uuid].push(t.uuid)},Iu:function(t,e){var n=null==(n=this.Ou[e.uuid])?void 0:n.indexOf(t.uuid);if(void 0!==n&&(-1!==n&&this.Ou[e.uuid].splice(n,1),0===this.Ou[e.uuid].length)){var i=[];if(e instanceof nd){this.Au.forEach(function(t,n){t.uuid===e.uuid&&i.push(n)});for(var r=0;r<i.length;r++)this.Au.delete(i[r])}delete this.Ou[e.uuid]}},ju:function(t){var n,e=[];for(n in t)t[n]?t[n].constructor===l?e.push(t[n].uuid):t[n].constructor===Mt?(e.push(t[n].x),e.push(t[n].y)):e.push(t[n]):e.push(t[n]);return e.join()},Cu:function(t,n){var e=this.ju(t);return this.Eu.has(e)||(t=this.ku(t,n),this.Eu.set(e,t)),this.Eu.get(e)},ku:function(t,n){var e;return t.isline?new al({color:t.color,linewidth:1,transparent:!0,opacity:t.opacity}):(e=new Yl,void 0!==t.color&&(e.color=new lt(t.color)),void 0!==t.opacity&&(e.opacity=t.opacity),void 0!==t.url&&this.gu.mu({url:t.url,flipY:t.flipY},function(t){t.image&&(e.map=t,e.needsUpdate=!0),n&&n()}),t=void 0!==t.needDepth&&t.needDepth,e.transparent=!0,e.depthTest=t,e.depthWrite=t,e)},Du:function(t){var n=this.ju(t);return this.Su.has(n)||(t=this.Uu(t),this.Su.set(n,t)),this.Su.get(n)},Ur:function(t){var n=this.ju(t);return this.Au.has(n)||(t=this.Bu(t),this.Au.set(n,t)),this.Au.get(n)},Bu:function(t){var n=new nd;return n.defines.USE_UV=!0,n.uniforms.diffuse.value=new lt(t.color),n.uniforms.emissive.value=new lt(t.emissive),n.defines.USE_METALNESSMAP=t.USE_METALNESSMAP,n.defines.USE_ROUGHNESSMAP=t.USE_ROUGHNESSMAP,n.uniforms.metalness.value=t.metalness,n.uniforms.metalnessMap.value=t.metalnessMap,n.uniforms.roughness.value=t.roughness,n.uniforms.roughnessMap.value=t.roughnessMap,n.defines.USE_NORMALMAP=t.USE_NORMALMAP,n.defines.TANGENTSPACE_NORMALMAP=t.TANGENTSPACE_NORMALMAP,n.uniforms.normalScale.value=t.normalScale,n.uniforms.normalMap.value=t.normalMap,n.defines.USE_EMISSIVEMAP=t.USE_EMISSIVEMAP,n.uniforms.emissiveMap.value=t.emissiveMap,n.defines.USE_MAP=t.USE_MAP,n.uniforms.map.value=t.map,t.aoMap&&(n.defines.USE_AOMAP=!0,n.uniforms.aoMap.value=t.aoMap),n.alphaTest=t.alphaTest,n.transparent=t.transparent,n.uniforms.opacity.value=t.opacity,n.skinning=t.skinning,n.side=t.side,n.vertexColors=t.vertexColors,this.Ru&&(n.uniforms.envMap.value=this.Ru,n.envMap=this.Ru),n.needsUpdate=!0,n},Gr:function(t,n){(n=n||{}).uuid=t.uuid;var e=this.ju(n);return this.Mu.has(e)||(t=t.clone(),n.color&&(t.color=new lt(n.color)),n.opacity&&(t.opacity=n.opacity),n.transparent&&(t.transparent=n.transparent),this.Mu.set(e,t)),this.Mu.get(e)},Uu:function(n){var e=new Wl;return e.color=new lt(n.color),e.opacity=n.alpha,e.transparent=e.opacity<1,void 0!==n.url&&this.gu.mu({url:n.url},function(t){t.image&&(e.map=t,e.needsUpdate=!0),n.finish&&n.finish(e)}),e},Gu:function(t){var n=void 0===t.needDepth||t.needDepth,t=new ol({color:t.color,opacity:t.opacity,lineWidth:t.lineWidth,vertexColors:2,dashed:!1,transparent:!0,gradient:t.gradient}),n=(t.depthWrite=n,t.depthTest=n,this.fi.Lt);return st.a.environment===G.a.BROWSER?t.resolution.set(n.Dt.renderer.domElement.clientWidth,n.Dt.renderer.domElement.clientHeight):t.resolution.set(n.Dt.renderer.domElement.width,n.Dt.renderer.domElement.height),t},Hu:function(t){var n=this.ju(t);return this.Tu.has(n)||(t=this.Gu(t),this.Tu.set(n,t)),this.Tu.get(n)},Xu:function(t,n,e){var i=new sl,t=(i.sizeAttenuation=!1,i.depthTest=!1,i.depthWrite=!1,i.transparent=!0,i.opacity=e.opacity,i.side=an,this.zu(t,null,n,e));return i.map=t,e.needSize&&(i.size=t.size),i.userData.scaleRatio=t.scaleRatio,i.userData.mspriteScale=t.mspriteScale,i.needsUpdate=!0,i},Vu:function(n,e,i,r){var o,s,t,a=this,u=new sl;return u.sizeAttenuation=!1,u.depthTest=!1,u.depthWrite=!1,u.opacity=i.opacity,u.transparent=!0,i.imageUrl?(u.visible=!1,o="_createLabelMaterial"+Tt.generateUUID(),this.Vs.Hs(o),s=this,El.nu(i.imageUrl,function(t){t=a.zu(n,t,e,cd(cd({},i),{},{callback:function(t){u.map=t,u.visible=!0,u.userData.scaleRatio=t.scaleRatio,u.userData.mspriteScale=t.mspriteScale,r&&r(u),u.needsUpdate=!0}}));st.a.environment===G.a.BROWSER&&(u.map=t,u.visible=!0,u.needsUpdate=!0,u.userData.scaleRatio=t.scaleRatio,u.userData.mspriteScale=t.mspriteScale,r)&&r(u),s.Vs.Xs(o)},{needDraw:!0})):(t=this.zu(n,null,e,cd(cd({},i),{},{callback:function(t){u.map=t,u.needsUpdate=!0,u.userData.scaleRatio=t.scaleRatio,u.userData.mspriteScale=t.mspriteScale,r&&r(u),u.visible=!0}})),st.a.environment===G.a.BROWSER?(u.map=t,u.needsUpdate=!0,u.userData.scaleRatio=t.scaleRatio,u.userData.mspriteScale=t.mspriteScale,r&&r(u)):u.map||(u.visible=!1)),u},Wu:function(t,n,e){return this.Yu(t,e.imageUrl,n,e)},Qu:function(n,e,i,r){var o,s,t,a=this,u=new ta({transparent:!0});return i.imageUrl?(u.visible=!1,o="_createLabelTopMaterial"+Tt.generateUUID(),this.Vs.Hs(o),s=this,El.nu(i.imageUrl,function(t){t=a.zu(n,t,e,cd(cd({},i),{},{scale:i.scale,callback:function(t){u.map=t,u.visible=!0,r&&r(u),u.needsUpdate=!0}}));st.a.environment===G.a.BROWSER&&(u.map=t,u.visible=!0,u.needsUpdate=!0,r)&&r(u),s.Vs.Xs(o)},{needDraw:!0})):(t=this.zu(n,null,e,cd(cd({},i),{},{scale:i.scale,callback:function(t){t.magFilter=B,t.minFilter=qn,u.map=t,u.needsUpdate=!0,r&&r(u),u.visible=!0}})),st.a.environment===G.a.BROWSER?(u.map=t,u.needsUpdate=!0,r&&r(u)):u.map||(u.visible=!1)),u},zu:function(t,n,e,i){var r=this.Zu(t,e);return this.Lu[r]||(this.Lu[r]={}),t=this.Lu[r].canvas||this.bu.au(t,n,e,i),null==(n=this.gu)?void 0:n.yu(t,{paramKey:r,labelImageCatch:this.Lu,needSize:i.needSize,callback:i.callback})},Yu:function(t,n,e,i){return this.bu.au(t,n,e,i)},Zu:function(t,n){return[t,n.alpha,n.fontsize,n.fillColor,n.image].join()},qu:function(t,n){var e=this.ju(t);return this.xu.has(e)||(t=this.Ku(t,n),this.xu.set(e,t)),n&&n(this.xu.get(e)),this.xu.get(e)},Ku:function(t,n){var e=void 0!==t.opacity?t.opacity:1,i=new sl;return i.sizeAttenuation=!1,i.depthTest=t.needDepth,i.depthWrite=t.needDepth,i.transparent=!0,i.opacity=e,i.visible=!1,this.gu.mu({url:t.url},function(t){t.image&&(i.map=t,i.needsUpdate=!0,i.visible=!0,i.userData.scaleRatio=t.image.width/t.image.height),n&&n(i)}),i},createArrowWidthBackTexture:function(n){var e,t=this.bu.cu(n);return st.a.environment===G.a.BROWSER?new Gc(rd.getPowerOfTwoSizeCanvas(t)):(t=t.toDataURL("image/png"),e=new l,st.a.textureHelper.createImage({url:t,onload:function(t){e.image=t,e.needsUpdate=!0,n.callback&&n.callback()}}),e)},createNormalLineTexture:function(n){var e,t=this.bu.lu(n);return st.a.environment===G.a.BROWSER?new Gc(rd.getPowerOfTwoSizeCanvas(t)):(t=t.toDataURL("image/png"),e=new l,st.a.textureHelper.createImage({url:t,onload:function(t){e.image=t,e.needsUpdate=!0,n.callback&&n.callback()}}),e)},Ju:function(n){var e,t=this.bu.fu(n);return st.a.environment===G.a.BROWSER?new Gc(rd.getPowerOfTwoSizeCanvas(t)):(t=t.toDataURL("image/png"),e=new l,st.a.textureHelper.createImage({url:t,onload:function(t){e.image=t,e.needsUpdate=!0,n.callback&&n.callback()}}),e)},$u:function(t,n){var e;return this._u[t+n]||((e=new ul({uniforms:{color:{value:new lt(t)},alpha:{value:n}},vertexShader:"\nprecision mediump float;\nprecision mediump int;\n\nattribute vec3 position;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n ",fragmentShader:"\nprecision mediump float;\nprecision mediump int;\n\nuniform vec3 color;\nuniform float alpha;\n\nvoid main() {\n    gl_FragColor = vec4(color,alpha);\n}\n "})).transparent=!0,this._u[t+n]=e)},tc:function(t,n){t=new Hs({uniforms:{color:{value:new lt(t)},alpha:{value:n}},vertexShader:"\nattribute float gradientAlpha;\n\nvarying float v_gradientAlpha;\n\nvoid main() {\n  v_gradientAlpha = gradientAlpha;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n ",fragmentShader:"\n\nuniform vec3 color;\nuniform float alpha;\n\nvarying float v_gradientAlpha;\n\nvoid main() {\n  gl_FragColor = vec4(color, alpha * v_gradientAlpha);\n}\n "});return t.depthTest=!0,t.depthWrite=!1,t.transparent=!0,t},nc:function(t,n){var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=new l,r=(i.minFilter=e.generateMipmaps?qn:B,i.generateMipmaps=!!e.generateMipmaps,i.anisotropy=4,i.wrapS=Hn,i.wrapT=Hn,"_loadTexture"+Tt.generateUUID()),o=(this.Vs.Hs(r),this);return El.nu(t,function(t){t&&(i.image=t,i.needsUpdate=!0),n(i),o.Vs.Xs(r)}),i},nn:function(t){var n=this;this.Fa=t,this.gu.nn(function(){n.gu=null,n.Vs.Gs(!0)}),this.Lu={}},Mo:function(){El.Ka(),this.bu.nn(),this.bu=null,this.Eu.clear(),this.Su.clear(),this.Tu.clear(),this.xu.clear(),this.Fa&&this.Fa({name:"MaterialManager"})},Pu:function(){var o=this;this.fi.Lt.Ve.hdr&&this.fi.Lt.Ve.hdr.load(this.fi.Lt,function(t){o.Ru=t;var n,e=function(t,n){var e,i,r,o,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return i=!(e=!0),{s:function(){s=s.call(t)},n:function(){var t=s.next();return e=t.done,t},e:function(t){i=!0,r=t},f:function(){try{e||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(t)||(s=sd(t))||n&&t&&"number"==typeof t.length)return s&&(t=s),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(o.Au);try{for(e.s();!(n=e.n()).done;){var i=od(n.value,2),r=(i[0],i[1]);r.envMap||(r.uniforms.envMap.value=o.Ru,r.envMap=o.Ru)}}catch(t){e.e(t)}finally{e.f()}})}}),n);function vd(t,n){var e,i,r,o,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return i=!(e=!0),{s:function(){s=s.call(t)},n:function(){var t=s.next();return e=t.done,t},e:function(t){i=!0,r=t},f:function(){try{e||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(t)||(s=function(t,n){var e;if(t)return"string"==typeof t?pd(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?pd(t,n):void 0}(t))||n&&t&&"number"==typeof t.length)return s&&(t=s),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function pd(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function md(t){return(md="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yd(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=md(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=md(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==md(t)?t:String(t)}(i.key),i)}}var n=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.ec={clearColor:16777215,clearAlpha:1,alphaTest:null},this.ic=null,this.rc=new Map,this.oc=new Map,this.sc=new Map,this.ac=new Map,this.uc=new Map,this.cc=new Map,this.fc=new Map,this.hc=new Map,this.lc=new Map,this.dc=new Map,this.vc=new Map,this.mc=new Map,this.yc=new Map,this.bc=null}var n,e,i;return n=t,(e=[{key:"resize",value:function(){this.ec={clearColor:16777215,clearAlpha:1,alphaTest:null},this.rc.clear(),this.oc.clear(),this.sc.clear(),this.ac.clear(),this.uc.clear(),this.cc.clear(),this.fc.clear(),this.hc.clear(),this.lc.clear(),this.dc.clear(),this.vc.clear(),this.mc.clear(),this.yc.clear()}}])&&yd(n.prototype,e),i&&yd(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}(),bd=(Object.assign(n.prototype,{gc:function(t,n,e){for(var i in n)t[i]=n[i];if(e)for(var r in e){var o=t[r];if(o){if(e[r].type)switch(e[r].type){case"toColor":o=Xi.toColor(o);break;case"toFloat":o=parseFloat(o);break;case"toRgba":o=Xi.toRgba(o);break;case"toString":o+=""}e[r].name?(t[e[r].name]=o,delete t[r]):t[r]=o}}return t},wc:function(t){this.resize(),t&&(this.sysPath=t.sysPath,this.userPath=t.userPath,this.logoPath=t.logoPath,this.sysModelPath=t.sysModelPath,this.userModelPath=t.userModelPath,this._c(t),this.Ec(t.extenttheme,S.EXTENT),this.Ec(t.storetheme,S.MODEL),this.Sc(t.floorapply,S.MODEL),this.Tc(t.storeapply,S.MODEL),this.Ec(t.storelabeltheme,S.LABEL),this.Sc(t.floorstorelabelapply,S.LABEL),this.Tc(t.storelabelapply,S.LABEL),this.Ec(t.poiimagetheme,S.FACILITY),this.Sc(t.floorpoiimageapply,S.FACILITY),this.Tc(t.poiimageapply,S.FACILITY),this.Ec(t.externalmodeltheme,S.EXTERNAL_MODEL),this.Sc(t.floorexternalapply,S.EXTERNAL_MODEL),this.Tc(t.externalmodelapply,S.EXTERNAL_MODEL),this.xc())},_c:function(t){t.viewtheme&&((t=t.viewtheme).clearcolor&&(this.ec.clearColor=Xi.toColor(t.clearcolor)),t.clearalpha&&(this.ec.clearAlpha=parseFloat(t.clearalpha)),t.lighttheme&&(this.ic=t.lighttheme),void 0!==t.alphatest)&&null!==t.alphatest&&(this.ec.alphaTest=t.alphatest)},Ec:function(t,n){if(t){var e,i=vd(t);try{for(i.s();!(e=i.n()).done;){var r=e.value;if(r.id)switch(n){case S.EXTERNAL_MODEL:this.vc.set(r.id,this.gc({},r,{color:{type:"toColor"}}));break;case S.FACILITY:r.imagename&&this.hc.set(r.id,this.gc({},r,{imagename:{name:"imageName"}}));break;case S.LABEL:this.uc.set(r.id,this.gc({},r,{alpha:{type:"toFloat"},fillcolor:{name:"fillColor",type:"toRgba"},strokecolor:{name:"strokeColor",type:"toRgba"},platesize:{name:"plateSize"},platestrokecolor:{name:"plateStrokeColor",type:"toRgba"},platecolor:{name:"plateColor",type:"toRgba"},strokewidth:{name:"strokeWidth",type:"toFloat"},space:{type:"toFloat"},fontfamily:{name:"fontFamily"},fontweight:{name:"fontWeight",type:"toFloat"},imagesize:{name:"imageSize",type:"toFloat"}}));break;case S.MODEL:this.rc.set(r.id,this.gc({},r,{color:{type:"toColor"},alpha:{type:"toFloat"},strokecolor:{name:"strokeColor",type:"toColor"},strokewidth:{name:"strokeWidth",type:"toFloat"}}));break;case S.EXTENT:this.ac.set(r.id,this.gc({},r,{color:{type:"toColor"},alpha:{type:"toFloat"}}))}}}catch(t){i.e(t)}finally{i.f()}}},Sc:function(t,n){if(t){var e,i=vd(t);try{for(i.s();!(e=i.n()).done;){var r,o=vd(e.value.typeapply);try{for(o.s();!(r=o.n()).done;){var s,a=r.value,u=this.gc({},a,{normalid:{name:"normalID",type:"toString"},selectedid:{name:"selectID",type:"toString"}}),c=vd(a.type.split(","));try{for(c.s();!(s=c.n()).done;){var f=s.value;this.Ac(n).set(f,u)}}catch(t){c.e(t)}finally{c.f()}}}catch(t){o.e(t)}finally{o.f()}}}catch(t){i.e(t)}finally{i.f()}}},Tc:function(t,n){if(t){var e,i=vd(t);try{for(i.s();!(e=i.n()).done;){var r=e.value;if(r.fids){var o,s=this.gc({},r,{normalid:{name:"normalID",type:"toString"},selectedid:{name:"selectID",type:"toString"}}),a=vd(r.fids.split(","));try{for(a.s();!(o=a.n()).done;){var u=o.value;this.Mc(n).set(u,s)}}catch(t){a.e(t)}finally{a.f()}}}}catch(t){i.e(t)}finally{i.f()}}},xc:function(){this.oc.get("0")&&this.rc.get(this.oc.get("0").selectID)&&(this.bc=this.rc.get(this.oc.get("0").selectID).color)},Mc:function(t){switch(t){case S.LABEL:return this.fc;case S.FACILITY:return this.dc;case S.MODEL:return this.sc;case S.EXTERNAL_MODEL:return this.yc}},Ac:function(t){switch(t){case S.LABEL:return this.cc;case S.FACILITY:return this.lc;case S.MODEL:return this.oc;case S.EXTERNAL_MODEL:return this.mc}},Oc:function(t){switch(t){case S.LABEL:return this.uc;case S.FACILITY:return this.hc;case S.MODEL:return this.rc;case S.EXTERNAL_MODEL:return this.vc}},nn:function(){for(var t in this.resize(),this)this[""+t]=null,delete this[""+t]}}),n);function gd(t){return(gd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wd(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=gd(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=gd(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==gd(t)?t:String(t)}(i.key),i)}}function _d(t,n,e){return n&&wd(t.prototype,n),e&&wd(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var n=_d(function t(n){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.fi=n}),Ed=(Object.assign(n.prototype,{Lc:function(t){var t=this.fi.Rc.get(t),n=this.fi.Rc.get(this.fi.Ve.buildingID),e={};return(e=t?{theme:t.theme,themeExtension:t.themeExtension}:e).theme||(e.theme=n.theme),e.themeExtension||(e.themeExtension=n.themeExtension),e},Nc:function(t){t=this.Lc(t);return Object.assign({},t.theme.ec,t.themeExtension.ec)},Pc:function(t){t=this.Lc(t);return Object.assign({},t.theme.ac.get("0"),t.themeExtension.ac.get("0"))},jc:function(t){return this.Fc(S.MODEL,t)},Ic:function(t){return this.Fc(S.FACILITY,t)},Cc:function(t){return this.Fc(S.LABEL,t)},kc:function(t){return this.Fc(S.EXTERNAL_MODEL,t)},Fc:function(t,n){var e=this.Lc(n.bid),i={},r={},o=e.themeExtension.Mc(t).get(n.fid),s=e.theme.Mc(t).get(n.fid);if(o||s){var a=(o&&void 0!==o.normalID?o:s).normalID,u=e.themeExtension.Oc(t).get(a),a=e.theme.Oc(t).get(a);if(u||a)return r.themeUseDetail={content:n.fid,name:"fid",isExtension:!!o},Object.assign(r,a,u,s,o)}return o=e.themeExtension.Ac(t).get(n.typeID),s=e.theme.Ac(t).get(n.typeID),(o||s)&&(r.themeUseDetail={content:n.typeID,name:"typeId",isExtension:!!o},Object.assign(i,s,o)),i.normalID||(o=e.themeExtension.Ac(t).get("0"),s=e.theme.Ac(t).get("0"),Object.assign(i,o,s)),u=e.themeExtension.Oc(t).get(i.normalID),a=e.theme.Oc(t).get(i.normalID),Object.assign(r,a,u)},Dc:function(t){t=this.Lc(t);return t.themeExtension.bc||t.theme.bc},nn:function(){this.fi=null},Uc:function(f){var h=this,l=f.Ve.buildingOptions,d=l.buildings||l.theme,v=null;(function t(){var n=f.getBuildings(),e=n.map(function(t){return t.je});if(!1===f.Bc)v=setTimeout(t,1);else{null!==v&&clearTimeout(v);var i=[];if(d)for(var r=0;r<l.buildings.length;r++){var o,s=l.buildings[r],a=s.buildingID;e.includes(a)&&(o=h.fi.Ft.Xi(a),h.fi.Rc.set(a,{theme:new bd}),o.themeLoaded=!0,o.themeNeedLoad=!1,h.fi.Gc({bid:a,theme:s.theme||l.theme,themeExtension:s.themeExtension||l.themeExtension}),i.push(a))}if(i.length!==n.length)for(var u=0;u<n.length;u++){var c=n[u].buildingID;i.includes(c)||((c=h.fi.Ft.Xi(c)).themeLoaded=!0,c.themeNeedLoad=!1)}h.fi.Ft.Hc=h.fi.Xc()}})()}}),n);function Sd(t,n,e){var i=this,r=!1,o=0,s=0,a=void 0,u=[];this.onStart=void 0,this.onLoad=t,this.onProgress=n,this.onError=e,this.record=new Map,this.itemStart=function(t){this.record.has(t)||this.record.set(t,{}),s++,!1===r&&void 0!==i.onStart&&i.onStart(t,o,s),r=!0},this.itemEnd=function(t){this.record.delete(t),o++,void 0!==i.onProgress&&i.onProgress(t,o,s),o===s&&(r=!1,void 0!==i.onLoad)&&i.onLoad()},this.itemError=function(t){this.record.delete(t),void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return a?a(t):t},this.setURLModifier=function(t){return a=t,this},this.addHandler=function(t,n){return u.push(t,n),this},this.removeHandler=function(t){t=u.indexOf(t);return-1!==t&&u.splice(t,2),this},this.getHandler=function(t){for(var n=0,e=u.length;n<e;n+=2){var i=u[n],r=u[n+1];if(i.global&&(i.lastIndex=0),i.test(t))return r}return null},this.isLoaded=function(){return 0===this.record.size}}var Td=new Sd,xd=function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var n="",e=0,i=t.length;e<i;e++)n+=String.fromCharCode(t[e]);try{return decodeURIComponent(escape(n))}catch(t){return n}},Ad=function(t){var n=t.lastIndexOf("/");return-1===n?"./":t.substr(0,n+1)},Md={enabled:!1,files:{},add:function(t,n){!1!==this.enabled&&(this.files[t]=n)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function Od(t){Vd.call(this,t)}function Ld(t){Vd.call(this,t)}function Rd(t){h.call(this),this.type="ShadowMaterial",this.color=new lt(0),this.transparent=!0,this.setValues(t)}function Nd(t){h.call(this),this.type="PointsMaterial",this.color=new lt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}function Pd(t){h.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new lt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new lt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=pi,this.normalScale=new Mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function jd(t){Pd.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Mt(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transparency=0,this.setValues(t)}function Fd(t){h.call(this),this.type="MeshPhongMaterial",this.color=new lt(16777215),this.specular=new lt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new lt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=pi,this.normalScale=new Mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Dn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Id(t){h.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new lt(16777215),this.specular=new lt(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new lt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=pi,this.normalScale=new Mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Cd(t){h.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=pi,this.normalScale=new Mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function kd(t){h.call(this),this.type="MeshLambertMaterial",this.color=new lt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new lt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Dn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Dd(t){h.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new lt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=pi,this.normalScale=new Mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Ud(t){al.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}function Bd(t){Vd.call(this,t),this.textures={}}Od.prototype=Object.assign(Object.create(Vd.prototype),{constructor:Od,load:function(e,i,t,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r,o,s,a=this,u=Md.get(e);return void 0!==u?(a.manager.itemStart(e),setTimeout(function(){i&&i(u),a.manager.itemEnd(e)},0),u):st.a.environment===G.a.WX?(e.includes(wx.env.USER_DATA_PATH)?(o=wx.getFileSystemManager()).readFile({filePath:e,encoding:"base64",success:function(t){var t="data:image/png;base64,".concat(t.data),n=st.a.textureHelper.createImage({url:t,onload:function(){Md.add(e,n),i&&i(n),a.manager.itemEnd(e),o.unlink({filePath:e,fail:function(t){},success:function(){}})}})},fail:function(t){console.error(t),n&&n(t),a.manager.itemError(e),a.manager.itemEnd(e)}}):r=st.a.textureHelper.createImage({url:e,onload:function(){Md.add(e,r),i&&i(r),a.manager.itemEnd(e)},onerror:function(t){console.error(t),n&&n(t),a.manager.itemError(e),a.manager.itemEnd(e)}}),r):((s=st.a.document.createElementNS("http://www.w3.org/1999/xhtml","img")).addEventListener("load",c,!1),s.addEventListener("error",f,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),a.manager.itemStart(e),s.src=e,s);function c(){s.removeEventListener("load",c,!1),s.removeEventListener("error",f,!1),Md.add(e,this),i&&i(this),a.manager.itemEnd(e)}function f(t){s.removeEventListener("load",c,!1),s.removeEventListener("error",f,!1),n&&n(t),a.manager.itemError(e),a.manager.itemEnd(e)}}}),Ld.prototype=Object.assign(Object.create(Vd.prototype),{constructor:Ld,load:function(n,e,t,i){var r=new l,o=new Od(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(n,function(t){r.image=t;t=0<n.search(/\.jpe?g($|\?)/i)||0===n.search(/^data\:image\/jpeg/);r.format=t?fe:he,r.needsUpdate=!0,void 0!==e&&e(r)},t,i),r}}),((Rd.prototype=Object.create(h.prototype)).constructor=Rd).prototype.isShadowMaterial=!0,Rd.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.color.copy(t.color),this},((Nd.prototype=Object.create(h.prototype)).constructor=Nd).prototype.isPointsMaterial=!0,Nd.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this},((Pd.prototype=Object.create(h.prototype)).constructor=Pd).prototype.isMeshStandardMaterial=!0,Pd.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},((jd.prototype=Object.create(Pd.prototype)).constructor=jd).prototype.isMeshPhysicalMaterial=!0,jd.prototype.copy=function(t){return Pd.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new lt).copy(t.sheen):this.sheen=null,this.transparency=t.transparency,this},((Fd.prototype=Object.create(h.prototype)).constructor=Fd).prototype.isMeshPhongMaterial=!0,Fd.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},((Id.prototype=Object.create(h.prototype)).constructor=Id).prototype.isMeshToonMaterial=!0,Id.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},((Cd.prototype=Object.create(h.prototype)).constructor=Cd).prototype.isMeshNormalMaterial=!0,Cd.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},((kd.prototype=Object.create(h.prototype)).constructor=kd).prototype.isMeshLambertMaterial=!0,kd.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},((Dd.prototype=Object.create(h.prototype)).constructor=Dd).prototype.isMeshMatcapMaterial=!0,Dd.prototype.copy=function(t){return h.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},((Ud.prototype=Object.create(al.prototype)).constructor=Ud).prototype.isLineDashedMaterial=!0,Ud.prototype.copy=function(t){return al.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this},Bd.prototype=Object.assign(Object.create(Vd.prototype),{constructor:Bd,load:function(t,n,e,i){var r=this,o=new Yd(r.manager);o.setPath(r.path),o.load(t,function(t){n(r.parse(JSON.parse(t)))},e,i)},parse:function(t){var n=this.textures;function e(t){return void 0===n[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),n[t]}var i,r=new u[t.type];if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.sheen&&(r.sheen=(new lt).setHex(t.sheen)),void 0!==t.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&r.specular.setHex(t.specular),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearcoat&&(r.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(r.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.combine&&(r.combine=t.combine),void 0!==t.side&&(r.side=t.side),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(r.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(r.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(r.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(r.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(r.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(r.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(r.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(r.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),1!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(r.skinning=t.skinning),void 0!==t.morphTargets&&(r.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(r.morphNormals=t.morphNormals),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.vertexTangents&&(r.vertexTangents=t.vertexTangents),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?r.vertexColors=0<t.vertexColors:r.vertexColors=t.vertexColors),void 0!==t.uniforms)for(var o in t.uniforms){var s=t.uniforms[o];switch(r.uniforms[o]={},s.type){case"t":r.uniforms[o].value=e(s.value);break;case"c":r.uniforms[o].value=(new lt).setHex(s.value);break;case"v2":r.uniforms[o].value=(new Mt).fromArray(s.value);break;case"v3":r.uniforms[o].value=(new xt).fromArray(s.value);break;case"v4":r.uniforms[o].value=(new Ot).fromArray(s.value);break;case"m3":r.uniforms[o].value=(new Z).fromArray(s.value);case"m4":r.uniforms[o].value=(new At).fromArray(s.value);break;default:r.uniforms[o].value=s.value}}if(void 0!==t.defines&&(r.defines=t.defines),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var a in t.extensions)r.extensions[a]=t.extensions[a];return void 0!==t.shading&&(r.flatShading=1===t.shading),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=e(t.map)),void 0!==t.matcap&&(r.matcap=e(t.matcap)),void 0!==t.alphaMap&&(r.alphaMap=e(t.alphaMap)),void 0!==t.bumpMap&&(r.bumpMap=e(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=e(t.normalMap)),void 0!==t.normalMapType&&(r.normalMapType=t.normalMapType),void 0!==t.normalScale&&(i=t.normalScale,!1===Array.isArray(i)&&(i=[i,i]),r.normalScale=(new Mt).fromArray(i)),void 0!==t.displacementMap&&(r.displacementMap=e(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=e(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=e(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=e(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=e(t.specularMap)),void 0!==t.envMap&&(r.envMap=e(t.envMap)),void 0!==t.envMapIntensity&&(r.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(r.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(r.lightMap=e(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=e(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=e(t.gradientMap)),void 0!==t.clearcoatMap&&(r.clearcoatMap=e(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=e(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(r.clearcoatNormalMap=e(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Mt).fromArray(t.clearcoatNormalScale)),r},setTextures:function(t){return this.textures=t,this}});var Gd,Hd,Xd,zd;function Vd(t){this.manager=void 0!==t?t:Td,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(Vd.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this}}),Object.assign(Vd.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(t,n,e){for(var i=[],r=0;r<t.length;++r)i[r]=this.createMaterial(t[r],n,e);return i},createMaterial:(Gd={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},Hd=new lt,Xd=new Ld,zd=new Bd,function(t,s,a){var u={};function n(t,n,e,i,r){var t=s+t,o=(new Sd).getHandler(t),o=(null!==o?o:(Xd.setCrossOrigin(a),Xd)).load(t),t=(void 0!==n&&(o.repeat.fromArray(n),1!==n[0]&&(o.wrapS=1e3),1!==n[1])&&(o.wrapT=1e3),void 0!==e&&o.offset.fromArray(e),void 0!==i&&("repeat"===i[0]&&(o.wrapS=1e3),"mirror"===i[0]&&(o.wrapS=1002),"repeat"===i[1]&&(o.wrapT=1e3),"mirror"===i[1])&&(o.wrapT=1002),void 0!==r&&(o.anisotropy=r),Tt.generateUUID());return u[t]=o,t}var e,i={uuid:Tt.generateUUID(),type:"MeshLambertMaterial"};for(e in t){var r=t[e];switch(e){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":i.name=r;break;case"blending":i.blending=Gd[r];break;case"colorAmbient":case"mapAmbient":break;case"colorDiffuse":i.color=Hd.fromArray(r).getHex();break;case"colorSpecular":i.specular=Hd.fromArray(r).getHex();break;case"colorEmissive":i.emissive=Hd.fromArray(r).getHex();break;case"specularCoef":i.shininess=r;break;case"shading":"basic"===r.toLowerCase()&&(i.type="MeshBasicMaterial"),"phong"===r.toLowerCase()&&(i.type="MeshPhongMaterial"),"standard"===r.toLowerCase()&&(i.type="MeshStandardMaterial");break;case"mapDiffuse":i.map=n(r,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap,t.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":i.emissiveMap=n(r,t.mapEmissiveRepeat,t.mapEmissiveOffset,t.mapEmissiveWrap,t.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":i.lightMap=n(r,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap,t.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":i.aoMap=n(r,t.mapAORepeat,t.mapAOOffset,t.mapAOWrap,t.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":i.bumpMap=n(r,t.mapBumpRepeat,t.mapBumpOffset,t.mapBumpWrap,t.mapBumpAnisotropy);break;case"mapBumpScale":i.bumpScale=r;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":i.normalMap=n(r,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap,t.mapNormalAnisotropy);break;case"mapNormalFactor":i.normalScale=r;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":i.specularMap=n(r,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap,t.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":i.metalnessMap=n(r,t.mapMetalnessRepeat,t.mapMetalnessOffset,t.mapMetalnessWrap,t.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":i.roughnessMap=n(r,t.mapRoughnessRepeat,t.mapRoughnessOffset,t.mapRoughnessWrap,t.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":i.alphaMap=n(r,t.mapAlphaRepeat,t.mapAlphaOffset,t.mapAlphaWrap,t.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":i.side=1;break;case"doubleSided":i.side=2;break;case"transparency":i.opacity=r;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":i[e]=r;break;case"vertexColors":!0===r&&(i.vertexColors=2),"face"===r&&(i.vertexColors=1)}}return"MeshBasicMaterial"===i.type&&delete i.emissive,"MeshPhongMaterial"!==i.type&&delete i.specular,i.opacity<1&&(i.transparent=!0),zd.setTextures(u),zd.parse(i)})});var Wd={};function Yd(t){Vd.call(this,t)}Yd.prototype=Object.assign(Object.create(Vd.prototype),{constructor:Yd,load:function(s,t,n,e){void 0===s&&(s=""),void 0!==this.path&&(s=this.path+s),s=this.manager.resolveURL(s);var a=this,i=Md.get(s);if(void 0!==i)return setTimeout(function(){t&&t(i)},0),i;if(void 0===Wd[s]){var r=s.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){var o=r[1],u=!!r[2],c=r[3],c=decodeURIComponent(c);u&&(c=atob(c));try{var f=(this.responseType||"").toLowerCase();switch(f){case"arraybuffer":case"blob":for(var h=new Uint8Array(c.length),l=0;l<c.length;l++)h[l]=c.charCodeAt(l);d="blob"===f?new Blob([h.buffer],{type:o}):h.buffer;break;case"document":var d=(new DOMParser).parseFromString(c,o);break;case"json":d=JSON.parse(c);break;default:d=c}setTimeout(function(){t&&t(d),a.manager.itemEnd(s)},0)}catch(t){setTimeout(function(){e&&e(t),a.manager.itemError(s),a.manager.itemEnd(s)},0)}}else{Wd[s]=[],Wd[s].push({onLoad:t,onProgress:n,onError:e});var v,p=new st.a.XMLHttpRequest;for(v in p.open("GET",s,!0),p.addEventListener("load",function(t){var n=this.response,e=Wd[s];if(delete Wd[s],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Md.add(s,n);for(var i=0,r=e.length;i<r;i++)(o=e[i]).onLoad&&o.onLoad(n)}else{for(var o,i=0,r=e.length;i<r;i++)(o=e[i]).onError&&o.onError(t);a.manager.itemError(s)}a.manager.itemEnd(s)},!1),p.addEventListener("progress",function(t){for(var n=Wd[s],e=0,i=n.length;e<i;e++){var r=n[e];r.onProgress&&r.onProgress(t)}},!1),p.addEventListener("error",function(t){var n=Wd[s];delete Wd[s];for(var e=0,i=n.length;e<i;e++){var r=n[e];r.onError&&r.onError(t)}a.manager.itemError(s),a.manager.itemEnd(s)},!1),p.addEventListener("abort",function(t){var n=Wd[s];delete Wd[s];for(var e=0,i=n.length;e<i;e++){var r=n[e];r.onError&&r.onError(t)}a.manager.itemError(s),a.manager.itemEnd(s)},!1),void 0!==this.responseType&&(p.responseType=this.responseType),void 0!==this.withCredentials&&(p.withCredentials=this.withCredentials),p.overrideMimeType&&p.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)p.setRequestHeader(v,this.requestHeader[v]);p.send(null)}return a.manager.itemStart(s),p}Wd[s].push({onLoad:t,onProgress:n,onError:e})},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this},dispose:function(){Wd={}}});var Qd={arraySlice:function(t,n,e){return Qd.isTypedArray(t)?new t.constructor(t.subarray(n,void 0!==e?e:t.length)):t.slice(n,e)},convertArray:function(t,n,e){return!t||!e&&t.constructor===n?t:"number"==typeof n.BYTES_PER_ELEMENT?new n(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),i=0;i!==t;++i)n[i]=i;return n.sort(function(t,n){return e[t]-e[n]}),n},sortedArray:function(t,n,e){for(var i=t.length,r=new t.constructor(i),o=0,s=0;s!==i;++o)for(var a=e[o]*n,u=0;u!==n;++u)r[s++]=t[a+u];return r},flattenJSON:function(t,n,e,i){for(var r=1,o=t[0];void 0!==o&&void 0===o[i];)o=t[r++];if(void 0!==o){var s=o[i];if(void 0!==s)if(Array.isArray(s))for(;void 0!==(s=o[i])&&(n.push(o.time),e.push.apply(e,s)),void 0!==(o=t[r++]););else if(void 0!==s.toArray)for(;void 0!==(s=o[i])&&(n.push(o.time),s.toArray(e,e.length)),void 0!==(o=t[r++]););else for(;void 0!==(s=o[i])&&(n.push(o.time),e.push(s)),void 0!==(o=t[r++]););}},subclip:function(t,n,e,i,r){r=r||30;for(var o=t.clone(),s=(o.name=n,[]),a=0;a<o.tracks.length;++a){for(var u=o.tracks[a],c=u.getValueSize(),f=[],h=[],l=0;l<u.times.length;++l){var d=u.times[l]*r;if(!(d<e||i<=d)){f.push(u.times[l]);for(var v=0;v<c;++v)h.push(u.values[l*c+v])}}0!==f.length&&(u.times=Qd.convertArray(f,u.times.constructor),u.values=Qd.convertArray(h,u.values.constructor),s.push(u))}o.tracks=s;for(var p=1/0,a=0;a<o.tracks.length;++a)p>o.tracks[a].times[0]&&(p=o.tracks[a].times[0]);for(a=0;a<o.tracks.length;++a)o.tracks[a].shift(-1*p);return o.resetDuration(),o}};function Zd(t,n,e,i){this.parameterPositions=t,this.zc=0,this.resultBuffer=void 0!==i?i:new n.constructor(e),this.sampleValues=n,this.valueSize=e}function qd(t,n,e,i){Zd.call(this,t,n,e,i),this.Vc=-0,this.Wc=-0,this.Yc=-0,this.Qc=-0}function Kd(t,n,e,i){Zd.call(this,t,n,e,i)}function Jd(t,n,e,i){Zd.call(this,t,n,e,i)}function $d(t,n,e,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===n||0===n.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Qd.convertArray(n,this.TimeBufferType),this.values=Qd.convertArray(e,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function tv(t,n,e){$d.call(this,t,n,e)}function nv(t,n,e,i){$d.call(this,t,n,e,i)}function ev(t,n,e,i){$d.call(this,t,n,e,i)}function iv(t,n,e,i){Zd.call(this,t,n,e,i)}function rv(t,n,e,i){$d.call(this,t,n,e,i)}function ov(t,n,e,i){$d.call(this,t,n,e,i)}function sv(t,n,e,i){$d.call(this,t,n,e,i)}function av(t,n,e){this.name=t,this.tracks=e,this.duration=void 0!==n?n:-1,this.uuid=Tt.generateUUID(),this.duration<0&&this.resetDuration()}function uv(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var n,e,i=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ev;case"vector":case"vector2":case"vector3":case"vector4":return sv;case"color":return nv;case"quaternion":return rv;case"bool":case"boolean":return tv;case"string":return ov}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);return void 0===t.times&&(Qd.flattenJSON(t.keys,n=[],e=[],"value"),t.times=n,t.values=e),void 0!==i.parse?i.parse(t):new i(t.name,t.times,t.values,t.interpolation)}function cv(t){"boolean"==typeof t&&(console.warn("JSONLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:Td,this.withCredentials=!1}Object.assign(Zd.prototype,{evaluate:function(t){var n,e=this.parameterPositions,i=this.zc,r=e[i],o=e[i-1];t:{n:{e:{i:if(!(t<r)){for(var s=i+2;;){if(void 0===r){if(t<o)break i;return i=e.length,this.zc=i,this.afterEnd_(i-1,t,o)}if(i===s)break;if(o=r,t<(r=e[++i]))break n}n=e.length;break e}if(o<=t)break t;var a=e[1];t<a&&(i=2,o=a);for(s=i-2;;){if(void 0===o)return this.zc=0,this.beforeStart_(0,t,r);if(i===s)break;if(r=o,(o=e[--i-1])<=t)break n}n=i,i=0}for(;i<n;){var u=i+n>>>1;t<e[u]?n=u:i=1+u}if(r=e[i],void 0===(o=e[i-1]))return this.zc=0,this.beforeStart_(0,t,r);if(void 0===r)return i=e.length,this.zc=i,this.afterEnd_(i-1,o,t)}this.zc=i,this.intervalChanged_(i,o,r)}return this.interpolate_(i,o,t,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var n=this.resultBuffer,e=this.sampleValues,i=this.valueSize,r=t*i,o=0;o!==i;++o)n[o]=e[r+o];return n},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Zd.prototype,{beforeStart_:Zd.prototype.copySampleValue_,afterEnd_:Zd.prototype.copySampleValue_}),qd.prototype=Object.assign(Object.create(Zd.prototype),{constructor:qd,DefaultSettings_:{endingStart:fi,endingEnd:fi},intervalChanged_:function(t,n,e){var i=this.parameterPositions,r=t-2,o=t+1,s=i[r],a=i[o];if(void 0===s)switch(this.getSettings_().endingStart){case hi:r=t,s=2*n-e;break;case 2402:s=n+i[r=i.length-2]-i[r+1];break;default:r=t,s=e}if(void 0===a)switch(this.getSettings_().endingEnd){case hi:o=t,a=2*e-n;break;case 2402:a=e+i[o=1]-i[0];break;default:o=t-1,a=n}var u=.5*(e-n),c=this.valueSize;this.Vc=u/(n-s),this.Yc=u/(a-e),this.Wc=r*c,this.Qc=o*c},interpolate_:function(t,n,e,i){for(var r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,u=a-s,c=this.Wc,f=this.Qc,t=this.Vc,h=this.Yc,e=(e-n)/(i-n),i=e*e,n=i*e,l=-t*n+2*t*i-t*e,d=(1+t)*n+(-1.5-2*t)*i+(-.5+t)*e+1,v=(-1-h)*n+(1.5+h)*i+.5*e,p=h*n-h*i,m=0;m!==s;++m)r[m]=l*o[c+m]+d*o[u+m]+v*o[a+m]+p*o[f+m];return r}}),Kd.prototype=Object.assign(Object.create(Zd.prototype),{constructor:Kd,interpolate_:function(t,n,e,i){for(var r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,u=a-s,c=(e-n)/(i-n),f=1-c,h=0;h!==s;++h)r[h]=o[u+h]*f+o[a+h]*c;return r}}),Jd.prototype=Object.assign(Object.create(Zd.prototype),{constructor:Jd,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign($d.prototype,{constructor:$d,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:ci,InterpolantFactoryMethodDiscrete:function(t){return new Jd(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new Kd(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new qd(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var n;switch(t){case ui:n=this.InterpolantFactoryMethodDiscrete;break;case ci:n=this.InterpolantFactoryMethodLinear;break;case 2302:n=this.InterpolantFactoryMethodSmooth}if(void 0===n){var e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}console.warn("THREE.KeyframeTrack:",e)}else this.createInterpolant=n;return this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ui;case this.InterpolantFactoryMethodLinear:return ci;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var n=this.times,e=0,i=n.length;e!==i;++e)n[e]+=t;return this},scale:function(t){if(1!==t)for(var n=this.times,e=0,i=n.length;e!==i;++e)n[e]*=t;return this},trim:function(t,n){for(var e,i=this.times,r=i.length,o=0,s=r-1;o!==r&&i[o]<t;)++o;for(;-1!==s&&i[s]>n;)--s;return++s,0===o&&s===r||(s<=o&&(o=(s=Math.max(s,1))-1),e=this.getValueSize(),this.times=Qd.arraySlice(i,o,s),this.values=Qd.arraySlice(this.values,o*e,s*e)),this},validate:function(){for(var t=!0,n=this.getValueSize(),e=(n-Math.floor(n)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1),this.times),i=this.values,r=e.length,o=(0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1),null),s=0;s!==r;s++){var a=e[s];if("number"==typeof a&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,a),t=!1;break}if(null!==o&&a<o){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,a,o),t=!1;break}o=a}if(void 0!==i&&Qd.isTypedArray(i))for(var s=0,u=i.length;s!==u;++s){var c=i[s];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,c),t=!1;break}}return t},optimize:function(){for(var t=Qd.arraySlice(this.times),n=Qd.arraySlice(this.values),e=this.getValueSize(),i=2302===this.getInterpolation(),r=1,o=t.length-1,s=1;s<o;++s){var a=!1,u=t[s];if(u!==t[s+1]&&(1!==s||u!==u[0]))if(i)a=!0;else for(var c=s*e,f=c-e,h=c+e,l=0;l!==e;++l){var d=n[c+l];if(d!==n[f+l]||d!==n[h+l]){a=!0;break}}if(a){if(s!==r){t[r]=t[s];for(var v=s*e,p=r*e,l=0;l!==e;++l)n[p+l]=n[v+l]}++r}}if(0<o){t[r]=t[o];for(v=o*e,p=r*e,l=0;l!==e;++l)n[p+l]=n[v+l];++r}return r!==t.length?(this.times=Qd.arraySlice(t,0,r),this.values=Qd.arraySlice(n,0,r*e)):(this.times=t,this.values=n),this},clone:function(){var t=Qd.arraySlice(this.times,0),n=Qd.arraySlice(this.values,0),t=new this.constructor(this.name,t,n);return t.createInterpolant=this.createInterpolant,t}}),tv.prototype=Object.assign(Object.create($d.prototype),{constructor:tv,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:ui,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),nv.prototype=Object.assign(Object.create($d.prototype),{constructor:nv,ValueTypeName:"color"}),ev.prototype=Object.assign(Object.create($d.prototype),{constructor:ev,ValueTypeName:"number"}),iv.prototype=Object.assign(Object.create(Zd.prototype),{constructor:iv,interpolate_:function(t,n,e,i){for(var r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=t*s,u=(e-n)/(i-n),c=a+s;a!==c;a+=4)at.slerpFlat(r,0,o,a-s,o,a,u);return r}}),rv.prototype=Object.assign(Object.create($d.prototype),{constructor:rv,ValueTypeName:"quaternion",DefaultInterpolation:ci,InterpolantFactoryMethodLinear:function(t){return new iv(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),ov.prototype=Object.assign(Object.create($d.prototype),{constructor:ov,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:ui,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),sv.prototype=Object.assign(Object.create($d.prototype),{constructor:sv,ValueTypeName:"vector"}),Object.assign(av,{parse:function(t){for(var n=[],e=t.tracks,i=1/(t.fps||1),r=0,o=e.length;r!==o;++r)n.push(uv(e[r]).scale(i));return new av(t.name,t.duration,n)},CreateFromMorphTargetSequence:function(t,n,e,i){for(var r=n.length,o=[],s=0;s<r;s++){var a=[],u=((c=[]).push((s+r-1)%r,s,(s+1)%r),a.push(0,1,0),Qd.getKeyframeOrder(c)),c=Qd.sortedArray(c,1,u),a=Qd.sortedArray(a,1,u);i||0!==c[0]||(c.push(r),a.push(a[0])),o.push(new ev(".morphTargetInfluences["+n[s].name+"]",c,a).scale(1/e))}return new av(t,-1,o)},findByName:function(t,n){var e=t;Array.isArray(t)||(e=t.geometry&&t.geometry.animations||t.animations);for(var i=0;i<e.length;i++)if(e[i].name===n)return e[i];return null},CreateClipsFromMorphTargetSequences:function(t,n,e){for(var i={},r=/^([\w-]*?)([\d]+)$/,o=0,s=t.length;o<s;o++){var a=t[o],u=a.name.match(r);u&&1<u.length&&((u=i[c=u[1]])||(i[c]=u=[]),u.push(a))}var c,f=[];for(c in i)f.push(av.CreateFromMorphTargetSequence(c,i[c],n,e));return f},parseAnimation:function(t,n){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var e=function(t,n,e,i,r){var o;0!==e.length&&(Qd.flattenJSON(e,e=[],o=[],i),0!==e.length)&&r.push(new t(n,e,o))},i=[],r=t.name||"default",o=t.length||-1,s=t.fps||30,a=t.hierarchy||[],u=0;u<a.length;u++){var c=a[u].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var f,h={},l=0;l<c.length;l++)if(c[l].morphTargets)for(var d=0;d<c[l].morphTargets.length;d++)h[c[l].morphTargets[d]]=-1;for(f in h){for(var v=[],p=[],d=0;d!==c[l].morphTargets.length;++d){var m=c[l];v.push(m.time),p.push(m.morphTarget===f?1:0)}i.push(new ev(".morphTargetInfluence["+f+"]",v,p))}o=h.length*(s||1)}else{var y=".bones["+n[u].name+"]";e(sv,y+".position",c,"pos",i),e(rv,y+".quaternion",c,"rot",i),e(sv,y+".scale",c,"scl",i)}}return 0===i.length?null:new av(r,o,i)}}),Object.assign(av.prototype,{resetDuration:function(){for(var t=0,n=0,e=this.tracks.length;n!==e;++n)var i=this.tracks[n],t=Math.max(t,i.times[i.times.length-1]);return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,n=0;n<this.tracks.length;n++)t=t&&this.tracks[n].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],n=0;n<this.tracks.length;n++)t.push(this.tracks[n].clone());return new av(this.name,this.duration,t)}}),Object.assign(cv.prototype,{crossOrigin:"anonymous",load:function(e,i,t,n){var r=this,o=void 0===this.path?Ad(e):this.path,s=(this.resourcePath=o+"maps/",new Yd(this.manager));s.setPath(this.path),s.setWithCredentials(this.withCredentials),s.load(e,function(t){var t=JSON.parse(t),n=t.metadata;if(void 0!==n){n=n.type;if(void 0!==n&&"object"===n.toLowerCase())return void console.error("JSONLoader: "+e+" should be loaded with ObjectLoader instead.")}n=r.parse(t,o);i(n.geometry,n.materials)},t,n)},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setCrossOrigin:function(t){return this.crossOrigin=t,this},parse:function(t,C){void 0!==(t=void 0!==t.data?t.data:t).scale?t.scale=1/t.scale:t.scale=1;var n,e,i,r,o,s,a,u,c,f,k,D,U,B,G,H,h,l,d,v,p,m,y,b,g=new rs,w=t,_=g,E=w.faces,S=w.vertices,T=w.normals,X=w.colors,z=w.scale,V=0;if(void 0!==w.uvs){for(n=0;n<w.uvs.length;n++)w.uvs[n].length&&V++;for(n=0;n<V;n++)_.faceVertexUvs[n]=[]}for(r=0,o=S.length;r<o;)(h=new xt).x=S[r++]*z,h.y=S[r++]*z,h.z=S[r++]*z,_.vertices.push(h);for(r=0,o=E.length;r<o;)if(k=(f=E[r++])&2,D=f&8,U=f&16,B=f&32,G=f&64,H=f&128,f&1){if((d=new $o).a=E[r],d.b=E[r+1],d.c=E[r+3],(v=new $o).a=E[r+1],v.b=E[r+2],v.c=E[r+3],r+=4,k&&(c=E[r++],d.materialIndex=c,v.materialIndex=c),i=_.faces.length,D)for(n=0;n<V;n++)for(y=w.uvs[n],_.faceVertexUvs[n][i]=[],_.faceVertexUvs[n][i+1]=[],e=0;e<4;e++)b=new Mt(y[2*(u=E[r++])],y[2*u+1]),2!==e&&_.faceVertexUvs[n][i].push(b),0!==e&&_.faceVertexUvs[n][i+1].push(b);if(U&&(a=3*E[r++],d.normal.set(T[a++],T[a++],T[a]),v.normal.copy(d.normal)),B)for(n=0;n<4;n++)a=3*E[r++],m=new xt(T[a++],T[a++],T[a]),2!==n&&d.vertexNormals.push(m),0!==n&&v.vertexNormals.push(m);if(G&&(p=X[s=E[r++]],d.color.setHex(p),v.color.setHex(p)),H)for(n=0;n<4;n++)p=X[s=E[r++]],2!==n&&d.vertexColors.push(new lt(p)),0!==n&&v.vertexColors.push(new lt(p));_.faces.push(d),_.faces.push(v)}else{if((l=new $o).a=E[r++],l.b=E[r++],l.c=E[r++],k&&(c=E[r++],l.materialIndex=c),i=_.faces.length,D)for(n=0;n<V;n++)for(y=w.uvs[n],_.faceVertexUvs[n][i]=[],e=0;e<3;e++)b=new Mt(y[2*(u=E[r++])],y[2*u+1]),_.faceVertexUvs[n][i].push(b);if(U&&(a=3*E[r++],l.normal.set(T[a++],T[a++],T[a])),B)for(n=0;n<3;n++)a=3*E[r++],m=new xt(T[a++],T[a++],T[a]),l.vertexNormals.push(m);if(G&&(s=E[r++],l.color.setHex(X[s])),H)for(n=0;n<3;n++)s=E[r++],l.vertexColors.push(new lt(X[s]));_.faces.push(l)}var x=t,A=g,M=void 0!==x.influencesPerVertex?x.influencesPerVertex:2;if(x.skinWeights)for(var O=0,W=x.skinWeights.length;O<W;O+=M){var Y=x.skinWeights[O],Q=1<M?x.skinWeights[O+1]:0,Z=2<M?x.skinWeights[O+2]:0,q=3<M?x.skinWeights[O+3]:0;A.skinWeights.push(new Ot(Y,Q,Z,q))}if(x.skinIndices)for(O=0,W=x.skinIndices.length;O<W;O+=M){var K=x.skinIndices[O],J=1<M?x.skinIndices[O+1]:0,$=2<M?x.skinIndices[O+2]:0,tt=3<M?x.skinIndices[O+3]:0;A.skinIndices.push(new Ot(K,J,$,tt))}A.bones=x.bones,A.bones&&0<A.bones.length&&(A.skinWeights.length!==A.skinIndices.length||A.skinIndices.length!==A.vertices.length)&&console.warn("When skinning, number of vertices ("+A.vertices.length+"), skinIndices ("+A.skinIndices.length+"), and skinWeights ("+A.skinWeights.length+") should match.");var L=t,R=g,nt=L.scale;if(void 0!==L.morphTargets)for(var N=0,et=L.morphTargets.length;N<et;N++){R.morphTargets[N]={},R.morphTargets[N].name=L.morphTargets[N].name,R.morphTargets[N].vertices=[];for(var it=R.morphTargets[N].vertices,rt=L.morphTargets[N].vertices,P=0,ot=rt.length;P<ot;P+=3){var st=new xt;st.x=rt[P]*nt,st.y=rt[P+1]*nt,st.z=rt[P+2]*nt,it.push(st)}}if(void 0!==L.morphColors&&0<L.morphColors.length){console.warn('fm.JSONLoader: "morphColors" no longer supported. Using them as face colors.');for(var at=R.faces,ut=L.morphColors[0].colors,N=0,et=at.length;N<et;N++)at[N].color.fromArray(ut,3*N)}var j=t,ct=g,F=[],I=[];void 0!==j.animation&&I.push(j.animation),void 0!==j.animations&&(j.animations.length?I=I.concat(j.animations):I.push(j.animations));for(var ft=0;ft<I.length;ft++){var ht=av.parseAnimation(I[ft],ct.bones);ht&&F.push(ht)}return ct.morphTargets&&(j=av.CreateClipsFromMorphTargetSequences(ct.morphTargets,10),F=F.concat(j)),0<F.length&&(ct.animations=F),g.computeFaceNormals(),g.computeBoundingSphere(),void 0===t.materials||0===t.materials.length?{geometry:g}:{geometry:g,materials:Vd.prototype.initMaterials(t.materials,this.resourcePath||C,this.crossOrigin)}}});var fv=cv;function hv(t,n){a.call(this),this.type="Light",this.color=new lt(t),this.intensity=void 0!==n?n:1,this.receiveShadow=void 0}function lv(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new Mt(512,512),this.map=null,this.mapPass=null,this.matrix=new At,this.Zc=new zt,this.qc=new Mt(1,1),this.Kc=1,this.Jc=[new Ot(0,0,1,1)]}function dv(){lv.call(this,new vt(-5,5,5,-5,.5,500))}function vv(t,n){hv.call(this,t,n),this.type="DirectionalLight",this.position.copy(a.DefaultUp),this.updateMatrix(),this.target=new a,this.shadow=new dv}function pv(){lv.call(this,new dt(90,1,.5,500)),this.qc=new Mt(4,2),this.Kc=6,this.Jc=[new Ot(2,1,1,1),new Ot(0,1,1,1),new Ot(3,1,1,1),new Ot(1,1,1,1),new Ot(3,0,1,1),new Ot(1,0,1,1)],this.$c=[new xt(1,0,0),new xt(-1,0,0),new xt(0,0,1),new xt(0,0,-1),new xt(0,1,0),new xt(0,-1,0)],this.tf=[new xt(0,1,0),new xt(0,1,0),new xt(0,1,0),new xt(0,1,0),new xt(0,0,1),new xt(0,0,-1)]}function mv(t,n,e,i){hv.call(this,t,n),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==e?e:0,this.decay=void 0!==i?i:1,this.shadow=new pv}function yv(){lv.call(this,new dt(50,1,.5,500))}function bv(t,n,e,i,r,o){hv.call(this,t,n),this.type="SpotLight",this.position.copy(a.DefaultUp),this.updateMatrix(),this.target=new a,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==e?e:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==o?o:1,this.shadow=new yv}function gv(t,n){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),ba.call(this,t,n),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new At,this.bindMatrixInverse=new At}hv.prototype=Object.assign(Object.create(a.prototype),{constructor:hv,isLight:!0,copy:function(t){return a.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this}}),Object.assign(lv.prototype,{nf:new At,ef:new xt,if:new xt,getViewportCount:function(){return this.Kc},getFrustum:function(){return this.Zc},updateMatrices:function(t){var n=this.camera,e=this.matrix,i=this.nf,r=this.if,o=this.ef;o.setFromMatrixPosition(t.matrixWorld),n.position.copy(o),r.setFromMatrixPosition(t.target.matrixWorld),n.lookAt(r),n.updateMatrixWorld(),i.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this.Zc.setFromProjectionMatrix(i),e.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),e.multiply(n.projectionMatrix),e.multiply(n.matrixWorldInverse)},getViewport:function(t){return this.Jc[t]},getFrameExtents:function(){return this.qc},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)}}),dv.prototype=Object.assign(Object.create(lv.prototype),{constructor:dv,isDirectionalLightShadow:!0,updateMatrices:function(t){lv.prototype.updateMatrices.call(this,t)}}),vv.prototype=Object.assign(Object.create(hv.prototype),{constructor:vv,isDirectionalLight:!0,copy:function(t){return hv.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),pv.prototype=Object.assign(Object.create(lv.prototype),{constructor:pv,isPointLightShadow:!0,updateMatrices:function(t,n){void 0===n&&(n=0);var e=this.camera,i=this.matrix,r=this.ef,o=this.if,s=this.nf;r.setFromMatrixPosition(t.matrixWorld),e.position.copy(r),o.copy(e.position),o.add(this.$c[n]),e.up.copy(this.tf[n]),e.lookAt(o),e.updateMatrixWorld(),i.makeTranslation(-r.x,-r.y,-r.z),s.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.Zc.setFromProjectionMatrix(s)}}),mv.prototype=Object.assign(Object.create(hv.prototype),{constructor:mv,isPointLight:!0,copy:function(t){return hv.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),yv.prototype=Object.assign(Object.create(lv.prototype),{constructor:yv,isSpotLightShadow:!0,updateMatrices:function(t){var n=this.camera,e=2*Tt.RAD2DEG*t.angle,i=this.mapSize.width/this.mapSize.height,r=t.distance||n.far;e===n.fov&&i===n.aspect&&r===n.far||(n.fov=e,n.aspect=i,n.far=r,n.updateProjectionMatrix()),lv.prototype.updateMatrices.call(this,t)}}),bv.prototype=Object.assign(Object.create(hv.prototype),{constructor:bv,isSpotLight:!0,copy:function(t){return hv.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),gv.prototype=Object.assign(Object.create(ba.prototype),{constructor:gv,isSkinnedMesh:!0,bind:function(t,n){this.skeleton=t,void 0===n&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),n=this.matrixWorld),this.bindMatrix.copy(n),this.bindMatrixInverse.getInverse(n)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new Ot,n=this.geometry.attributes.skinWeight,e=0,i=n.count;e<i;e++){t.x=n.getX(e),t.y=n.getY(e),t.z=n.getZ(e),t.w=n.getW(e);var r=1/t.manhattanLength();r!=1/0?t.multiplyScalar(r):t.set(1,0,0,0),n.setXYZW(e,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){ba.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var wv=new xt,_v=new xt,Ev=new At,Sv=new Mo,Tv=new kt;function xv(t,n,e){1===e&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),a.call(this),this.type="Line",this.geometry=void 0!==t?t:new N,this.material=void 0!==n?n:new al}xv.prototype=Object.assign(Object.create(a.prototype),{constructor:xv,isLine:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var n=t.attributes.position,e=[0],i=1,r=n.count;i<r;i++)wv.fromBufferAttribute(n,i-1),_v.fromBufferAttribute(n,i),e[i]=e[i-1],e[i]+=wv.distanceTo(_v);t.setAttribute("lineDistance",new E(e,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var o=t.vertices;(e=t.lineDistances)[0]=0;for(i=1,r=o.length;i<r;i++)e[i]=e[i-1],e[i]+=o[i-1].distanceTo(o[i])}return this},raycast:function(t,n){var e=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold;if(null===e.boundingSphere&&e.computeBoundingSphere(),Tv.copy(e.boundingSphere),Tv.applyMatrix4(i),Tv.radius+=r,!1!==t.ray.intersectsSphere(Tv)){Ev.getInverse(i),Sv.copy(t.ray).applyMatrix4(Ev);var i=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=i*i,s=new xt,a=new xt,u=new xt,c=new xt,f=this&&this.isLineSegments?2:1;if(e.isBufferGeometry){var r=e.index,h=e.attributes.position.array;if(null!==r)for(var l=r.array,d=0,v=l.length-1;d<v;d+=f){var p=l[d],m=l[d+1];s.fromArray(h,3*p),a.fromArray(h,3*m),o<Sv.distanceSqToSegment(s,a,c,u)||(c.applyMatrix4(this.matrixWorld),(y=t.ray.origin.distanceTo(c))<t.near)||y>t.far||n.push({distance:y,point:u.clone().applyMatrix4(this.matrixWorld),index:d,face:null,faceIndex:null,object:this})}else for(d=0,v=h.length/3-1;d<v;d+=f)s.fromArray(h,3*d),a.fromArray(h,3*d+3),o<Sv.distanceSqToSegment(s,a,c,u)||(c.applyMatrix4(this.matrixWorld),(y=t.ray.origin.distanceTo(c))<t.near)||y>t.far||n.push({distance:y,point:u.clone().applyMatrix4(this.matrixWorld),index:d,face:null,faceIndex:null,object:this})}else if(e.isGeometry)for(var y,b=e.vertices,g=b.length,d=0;d<g-1;d+=f)o<Sv.distanceSqToSegment(b[d],b[d+1],c,u)||(c.applyMatrix4(this.matrixWorld),(y=t.ray.origin.distanceTo(c))<t.near)||y>t.far||n.push({distance:y,point:u.clone().applyMatrix4(this.matrixWorld),index:d,face:null,faceIndex:null,object:this})}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Av=new xt,Mv=new xt;function Ov(t,n){xv.call(this,t,n),this.type="LineSegments"}function Lv(t,n){xv.call(this,t,n),this.type="LineLoop"}Ov.prototype=Object.assign(Object.create(xv.prototype),{constructor:Ov,isLineSegments:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var n=t.attributes.position,e=[],i=0,r=n.count;i<r;i+=2)Av.fromBufferAttribute(n,i),Mv.fromBufferAttribute(n,i+1),e[i]=0===i?0:e[i-1],e[i+1]=e[i]+Av.distanceTo(Mv);t.setAttribute("lineDistance",new E(e,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry)for(var o=t.vertices,e=t.lineDistances,i=0,r=o.length;i<r;i+=2)Av.copy(o[i]),Mv.copy(o[i+1]),e[i]=0===i?0:e[i-1],e[i+1]=e[i]+Av.distanceTo(Mv);return this}}),Lv.prototype=Object.assign(Object.create(xv.prototype),{constructor:Lv,isLineLoop:!0});var Rv=new At,Nv=new Mo,Pv=new kt,jv=new xt;function Fv(t,n){a.call(this),this.type="Points",this.geometry=void 0!==t?t:new N,this.material=void 0!==n?n:new Nd,this.updateMorphTargets()}function Iv(t,n,e,i,r,o,s){var a=Nv.distanceSqToPoint(t);a<e&&(e=new xt,Nv.closestPointToPoint(t,e),e.applyMatrix4(i),(t=r.ray.origin.distanceTo(e))<r.near||t>r.far||o.push({distance:t,distanceToRay:Math.sqrt(a),point:e,index:n,face:null,object:s}))}function Cv(){a.call(this),this.type="Bone"}Fv.prototype=Object.assign(Object.create(a.prototype),{constructor:Fv,isPoints:!0,raycast:function(t,n){var e=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold;if(null===e.boundingSphere&&e.computeBoundingSphere(),Pv.copy(e.boundingSphere),Pv.applyMatrix4(i),Pv.radius+=r,!1!==t.ray.intersectsSphere(Pv)){Rv.getInverse(i),Nv.copy(t.ray).applyMatrix4(Rv);var r=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=r*r;if(e.isBufferGeometry){var r=e.index,s=e.attributes.position.array;if(null!==r)for(var a=r.array,u=0,c=a.length;u<c;u++){var f=a[u];jv.fromArray(s,3*f),Iv(jv,f,o,i,t,n,this)}else for(var u=0,h=s.length/3;u<h;u++)jv.fromArray(s,3*u),Iv(jv,u,o,i,t,n,this)}else for(var l=e.vertices,u=0,h=l.length;u<h;u++)Iv(l[u],u,o,i,t,n,this)}},updateMorphTargets:function(){var t,n,e,i=this.geometry;if(i.isBufferGeometry){var r=i.morphAttributes,o=Object.keys(r);if(0<o.length){var s=r[o[0]];if(void 0!==s)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,n=s.length;t<n;t++)e=s[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}else{r=i.morphTargets;void 0!==r&&0<r.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Cv.prototype=Object.assign(Object.create(a.prototype),{constructor:Cv,isBone:!0});var n="\\[\\]\\.:\\/",kv=new RegExp("["+n+"]","g"),Dv="[^"+n+"]",n="[^"+n.replace("\\.","")+"]",Uv=/((?:WC+[\/:])*)/.source.replace("WC",Dv),n=/(WCOD+)?/.source.replace("WCOD",n),Bv=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Dv),Dv=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Dv),Gv=new RegExp("^"+Uv+n+Bv+Dv+"$"),Hv=["material","materials","bones"];function Xv(t,n,e){e=e||zv.parseTrackName(n);this.rf=t,this.sf=t.subscribe_(n,e)}function zv(t,n,e){this.path=n,this.parsedPath=e||zv.parseTrackName(n),this.node=zv.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}Object.assign(Xv.prototype,{getValue:function(t,n){this.bind();var e=this.rf.nCachedObjects_,e=this.sf[e];void 0!==e&&e.getValue(t,n)},setValue:function(t,n){for(var e=this.sf,i=this.rf.nCachedObjects_,r=e.length;i!==r;++i)e[i].setValue(t,n)},bind:function(){for(var t=this.sf,n=this.rf.nCachedObjects_,e=t.length;n!==e;++n)t[n].bind()},unbind:function(){for(var t=this.sf,n=this.rf.nCachedObjects_,e=t.length;n!==e;++n)t[n].unbind()}}),Object.assign(zv,{Composite:Xv,create:function(t,n,e){return new(t&&t.isAnimationObjectGroup?zv.Composite:zv)(t,n,e)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(kv,"")},parseTrackName:function(t){var n=Gv.exec(t);if(!n)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var e,n={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i&&(e=n.nodeName.substring(i+1),-1!==Hv.indexOf(e))&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e),null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},findNode:function(t,r){if(!r||""===r||"."===r||-1===r||r===t.name||r===t.uuid)return t;if(t.skeleton){var n=t.skeleton.getBoneByName(r);if(void 0!==n)return n}if(t.children){n=function t(n){for(var e=0;e<n.length;e++){var i=n[e];if(i.name===r||i.uuid===r)return i;i=t(i.children);if(i)return i}return null}(t.children);if(n)return n}return null}}),Object.assign(zv.prototype,{af:function(){},uf:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,n){t[n]=this.node[this.propertyName]},function(t,n){for(var e=this.resolvedProperty,i=0,r=e.length;i!==r;++i)t[n++]=e[i]},function(t,n){t[n]=this.resolvedProperty[this.propertyIndex]},function(t,n){this.resolvedProperty.toArray(t,n)}],SetterByBindingTypeAndVersioning:[[function(t,n){this.targetObject[this.propertyName]=t[n]},function(t,n){this.targetObject[this.propertyName]=t[n],this.targetObject.needsUpdate=!0},function(t,n){this.targetObject[this.propertyName]=t[n],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,n){for(var e=this.resolvedProperty,i=0,r=e.length;i!==r;++i)e[i]=t[n++]},function(t,n){for(var e=this.resolvedProperty,i=0,r=e.length;i!==r;++i)e[i]=t[n++];this.targetObject.needsUpdate=!0},function(t,n){for(var e=this.resolvedProperty,i=0,r=e.length;i!==r;++i)e[i]=t[n++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,n){this.resolvedProperty[this.propertyIndex]=t[n]},function(t,n){this.resolvedProperty[this.propertyIndex]=t[n],this.targetObject.needsUpdate=!0},function(t,n){this.resolvedProperty[this.propertyIndex]=t[n],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,n){this.resolvedProperty.fromArray(t,n)},function(t,n){this.resolvedProperty.fromArray(t,n),this.targetObject.needsUpdate=!0},function(t,n){this.resolvedProperty.fromArray(t,n),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,n){this.bind(),this.getValue(t,n)},setValue:function(t,n){this.bind(),this.setValue(t,n)},bind:function(){var t=this.node,n=this.parsedPath,e=n.objectName,i=n.propertyName,r=n.propertyIndex;if(t||(t=zv.findNode(this.rootNode,n.nodeName)||this.rootNode,this.node=t),this.getValue=this.af,this.setValue=this.uf,t){if(e){var o=n.objectIndex;switch(e){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);for(var t=t.skeleton.bones,s=0;s<t.length;s++)if(t[s].name===o){o=s;break}break;default:if(void 0===t[e])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[e]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var a=t[i];if(void 0===a)n=n.nodeName,console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",t);else{var n=this.Versioning.None,u=(void 0!==(this.targetObject=t).needsUpdate?n=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(n=this.Versioning.MatrixWorldNeedsUpdate),this.BindingType.Direct);if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(s=0;s<this.node.geometry.morphAttributes.position.length;s++)if(t.geometry.morphAttributes.position[s].name===r){r=s;break}}else{if(!t.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(s=0;s<this.node.geometry.morphTargets.length;s++)if(t.geometry.morphTargets[s].name===r){r=s;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else void 0!==a.fromArray&&void 0!==a.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(u=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][n]}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this.cf,this.setValue=this.ff}}),Object.assign(zv.prototype,{cf:zv.prototype.getValue,ff:zv.prototype.setValue});var d,Vv,Wv,Yv,Qv,Zv,qv,Kv,Jv,$v,t0,n0,e0,i0,r0,o0,s0,a0,u0,c0,f0,h0,l0,d0=new At,v0=new At;function p0(t,n){if(this.bones=(t=t||[]).slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===n)this.calculateInverses();else if(this.bones.length===n.length)this.boneInverses=n.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var e=0,i=this.bones.length;e<i;e++)this.boneInverses.push(new At)}}function m0(t){return(m0="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function y0(t){Vd.call(this,t),this.dracoLoader=null,this.ddsLoader=null,this.fileLoaders=[]}function b0(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}function g0(t){if(!t)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=d.MSFT_TEXTURE_DDS,this.ddsLoader=t}function w0(t){this.name=d.KHR_LIGHTS_PUNCTUAL;t=t.extensions&&t.extensions[d.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function _0(){this.name=d.KHR_MATERIALS_UNLIT}function E0(){this.name=d.KHR_MATERIALS_CLEARCOAT}function S0(t){this.name=d.KHR_BINARY_GLTF,this.content=null,this.body=null;var n=new DataView(t,0,Wv);if(this.header={magic:xd(new Uint8Array(t.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==Vv)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var e=new DataView(t,Wv),i=0;i<e.byteLength;){var r,o=e.getUint32(i,!0),s=(i+=4,e.getUint32(i,!0));i+=4,s===Yv.JSON?(r=new Uint8Array(t,Wv+i,o),this.content=xd(r)):s===Yv.BIN&&(this.body=t.slice(r=Wv+i,r+o)),i+=o}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function T0(t,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=d.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=n,this.dracoLoader.preload()}function x0(){this.name=d.KHR_TEXTURE_TRANSFORM}function A0(t){Pd.call(this),this.isGLTFSpecularGlossinessMaterial=!0;["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n");var e=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),s={specular:{value:(new lt).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this.hf=s,this.onBeforeCompile=function(t){for(var n in s)t.uniforms[n]=s[n];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),t.fragmentShader=t.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),t.fragmentShader=t.fragmentShader.replace("#include <metalnessmap_pars_fragment>",e),t.fragmentShader=t.fragmentShader.replace("#include <roughnessmap_fragment>",i),t.fragmentShader=t.fragmentShader.replace("#include <metalnessmap_fragment>",r),t.fragmentShader=t.fragmentShader.replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(t){s.specular.value=t}},specularMap:{get:function(){return s.specularMap.value},set:function(t){s.specularMap.value=t}},glossiness:{get:function(){return s.glossiness.value},set:function(t){s.glossiness.value=t}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(t){(s.glossinessMap.value=t)?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}function M0(){return{name:d.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return A0},extendParams:function(t,n,e){var i,n=n.extensions[this.name],r=(t.color=new lt(1,1,1),t.opacity=1,[]);return Array.isArray(n.diffuseFactor)&&(i=n.diffuseFactor,t.color.fromArray(i),t.opacity=i[3]),void 0!==n.diffuseTexture&&r.push(e.assignTexture(t,"map",n.diffuseTexture)),t.emissive=new lt(0,0,0),t.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,t.specular=new lt(1,1,1),Array.isArray(n.specularFactor)&&t.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture&&(i=n.specularGlossinessTexture,r.push(e.assignTexture(t,"glossinessMap",i)),r.push(e.assignTexture(t,"specularMap",i))),Promise.all(r)},createMaterial:function(t){var n=new A0(t);return n.fog=!0,n.color=t.color,n.map=void 0===t.map?null:t.map,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=void 0===t.aoMap?null:t.aoMap,n.aoMapIntensity=1,n.emissive=t.emissive,n.emissiveIntensity=1,n.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,n.bumpMap=void 0===t.bumpMap?null:t.bumpMap,n.bumpScale=1,n.normalMap=void 0===t.normalMap?null:t.normalMap,n.normalMapType=pi,t.normalScale&&(n.normalScale=t.normalScale),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.specularMap=void 0===t.specularMap?null:t.specularMap,n.specular=t.specular,n.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,n.glossiness=t.glossiness,n.alphaMap=null,n.envMap=void 0===t.envMap?null:t.envMap,n.envMapIntensity=1,n.refractionRatio=.98,n}}}function O0(){this.name=d.KHR_MESH_QUANTIZATION}function L0(t,n,e,i){Zd.call(this,t,n,e,i)}function R0(t,n){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(n)&&/^\//.test(t)&&(n=n.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||st.a.environment==G.a.WX&&st.a.WX_USER_DATA_PATH.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:n+t)}function N0(t,n,e){for(var i in e.extensions)void 0===t[i]&&(n.userData.gltfExtensions=n.userData.gltfExtensions||{},n.userData.gltfExtensions[i]=e.extensions[i])}function P0(t,n){void 0!==n.extras&&("object"===m0(n.extras)?Object.assign(t.userData,n.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+n.extras))}function j0(t){for(var n="",e=Object.keys(t).sort(),i=0,r=e.length;i<r;i++)n+=e[i]+":"+t[e[i]]+";";return n}function F0(t,n,e){this.json=t||{},this.extensions=n||{},this.options=e||{},this.cache=new b0,this.primitiveCache={},this.textureLoader=new Ld(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new Yd(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function I0(h,l,d){var t,n=l.attributes,e=[];for(t in n){var i=o0[t]||t.toLowerCase();i in h.attributes||e.push(function(t,n){return d.getDependency("accessor",t).then(function(t){h.setAttribute(n,t)})}(n[t],i))}void 0===l.indices||h.index||(r=d.getDependency("accessor",l.indices).then(function(t){h.setIndex(t)}),e.push(r)),P0(h,l);var r=h,o=l,s=d,a=o.attributes,u=new Ft;if(void 0!==a.POSITION){var c=(g=s.json.accessors[a.POSITION]).min,f=g.max;if(void 0===c||void 0===f)console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");else{u.set(new xt(c[0],c[1],c[2]),new xt(f[0],f[1],f[2]));var v=o.targets;if(void 0!==v){for(var p=new xt,m=new xt,y=0,b=v.length;y<b;y++){var g,w=v[y];void 0!==w.POSITION&&(c=(g=s.json.accessors[w.POSITION]).min,f=g.max,void 0!==c&&void 0!==f?(m.setX(Math.max(Math.abs(c[0]),Math.abs(f[0]))),m.setY(Math.max(Math.abs(c[1]),Math.abs(f[1]))),m.setZ(Math.max(Math.abs(c[2]),Math.abs(f[2]))),p.max(m)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION."))}u.expandByVector(p)}r.boundingBox=u;a=new kt;u.getCenter(a.center),a.radius=u.min.distanceTo(u.max)/2,r.boundingSphere=a}}return Promise.all(e).then(function(){if(void 0===l.targets)return h;for(var e=h,t=l.targets,n=d,i=!1,r=!1,o=0,s=t.length;o<s&&(void 0!==(f=t[o]).POSITION&&(i=!0),void 0!==f.NORMAL&&(r=!0),!i||!r);o++);if(!i&&!r)return Promise.resolve(e);for(var a=[],u=[],o=0,s=t.length;o<s;o++){var c,f=t[o];i&&(c=void 0!==f.POSITION?n.getDependency("accessor",f.POSITION):e.attributes.position,a.push(c)),r&&(c=void 0!==f.NORMAL?n.getDependency("accessor",f.NORMAL):e.attributes.normal,u.push(c))}return Promise.all([Promise.all(a),Promise.all(u)]).then(function(t){var n=t[0],t=t[1];return i&&(e.morphAttributes.position=n),r&&(e.morphAttributes.normal=t),e.morphTargetsRelative=!0,e})})}function C0(t,n){var e=t.getIndex();if(null===e){var i=[],r=t.getAttribute("position");if(void 0===r)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var o=0;o<r.count;o++)i.push(o);t.setIndex(i),e=t.getIndex()}var s=e.count-2,a=[];if(2===n)for(o=1;o<=s;o++)a.push(e.getX(0)),a.push(e.getX(o)),a.push(e.getX(o+1));else for(o=0;o<s;o++)o%2==0?(a.push(e.getX(o)),a.push(e.getX(o+1)),a.push(e.getX(o+2))):(a.push(e.getX(o+2)),a.push(e.getX(o+1)),a.push(e.getX(o)));a.length/3!=s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");n=t.clone();return n.setIndex(a),n}Object.assign(p0.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,n=this.bones.length;t<n;t++){var e=new At;this.bones[t]&&e.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(e)}},pose:function(){for(var t,n=0,e=this.bones.length;n<e;n++)(t=this.bones[n])&&t.matrixWorld.getInverse(this.boneInverses[n]);for(n=0,e=this.bones.length;n<e;n++)(t=this.bones[n])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){for(var t=this.bones,n=this.boneInverses,e=this.boneMatrices,i=this.boneTexture,r=0,o=t.length;r<o;r++){var s=t[r]?t[r].matrixWorld:v0;d0.multiplyMatrices(s,n[r]),d0.toArray(e,16*r)}void 0!==i&&(i.needsUpdate=!0)},clone:function(){return new p0(this.bones,this.boneInverses)},getBoneByName:function(t){for(var n=0,e=this.bones.length;n<e;n++){var i=this.bones[n];if(i.name===t)return i}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),y0.prototype=Object.assign(Object.create(Vd.prototype),{constructor:y0,load:function(t,e,n,i){function r(t){i?i(t):console.error(t)}var o=this,s=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:Ad(t),a=(o.manager.itemStart(t),new Yd(o.manager));return this.fileLoaders.push(a),a.setPath(this.path),a.setResponseType("arraybuffer"),"use-credentials"===o.crossOrigin&&a.setWithCredentials(!0),a.load(t,function(n){try{o.parse(n,s,function(t){e(t,n)},r)}catch(t){r(t)}},n,r)},setDRACOLoader:function(t){return this.dracoLoader=t,this},setDDSLoader:function(t){return this.ddsLoader=t,this},parse:function(t,n,e,i){var r,o={};if("string"==typeof t)r=t;else if(xd(new Uint8Array(t,0,4))===Vv){try{o[d.KHR_BINARY_GLTF]=new S0(t)}catch(t){return void(i&&i(t))}r=o[d.KHR_BINARY_GLTF].content}else r=xd(new Uint8Array(t));var s=JSON.parse(r);if(void 0===s.asset||s.asset.version[0]<2)i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{if(s.extensionsUsed)for(var a=0;a<s.extensionsUsed.length;++a){var u=s.extensionsUsed[a],c=s.extensionsRequired||[];switch(u){case d.KHR_LIGHTS_PUNCTUAL:o[u]=new w0(s);break;case d.KHR_MATERIALS_CLEARCOAT:o[u]=new E0;break;case d.KHR_MATERIALS_UNLIT:o[u]=new _0;break;case d.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[u]=new M0;break;case d.KHR_DRACO_MESH_COMPRESSION:o[u]=new T0(s,this.dracoLoader);break;case d.MSFT_TEXTURE_DDS:o[u]=new g0(this.ddsLoader);break;case d.KHR_TEXTURE_TRANSFORM:o[u]=new x0;break;case d.KHR_MESH_QUANTIZATION:o[u]=new O0;break;default:0<=c.indexOf(u)&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}new F0(s,o,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(e,i)}}}),d={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"},w0.prototype.loadLight=function(t){var n,e=this.lightDefs[t],i=new lt(16777215),r=(void 0!==e.color&&i.fromArray(e.color),void 0!==e.range?e.range:0);switch(e.type){case"directional":(n=new vv(i)).target.position.set(0,0,-1),n.add(n.target);break;case"point":(n=new mv(i)).distance=r;break;case"spot":(n=new bv(i)).distance=r,e.spot=e.spot||{},e.spot.innerConeAngle=void 0!==e.spot.innerConeAngle?e.spot.innerConeAngle:0,e.spot.outerConeAngle=void 0!==e.spot.outerConeAngle?e.spot.outerConeAngle:Math.PI/4,n.angle=e.spot.outerConeAngle,n.penumbra=1-e.spot.innerConeAngle/e.spot.outerConeAngle,n.target.position.set(0,0,-1),n.add(n.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+e.type+'".')}return n.position.set(0,0,0),n.decay=2,void 0!==e.intensity&&(n.intensity=e.intensity),n.name=e.name||"light_"+t,Promise.resolve(n)},_0.prototype.getMaterialType=function(){return ta},_0.prototype.extendParams=function(t,n,e){var i,r=[],n=(t.color=new lt(1,1,1),t.opacity=1,n.pbrMetallicRoughness);return n&&(Array.isArray(n.baseColorFactor)&&(i=n.baseColorFactor,t.color.fromArray(i),t.opacity=i[3]),void 0!==n.baseColorTexture)&&r.push(e.assignTexture(t,"map",n.baseColorTexture)),Promise.all(r)},E0.prototype.getMaterialType=function(){return jd},E0.prototype.extendParams=function(t,n,e){var i=[],n=n.extensions[this.name];return void 0!==n.clearcoatFactor&&(t.clearcoat=n.clearcoatFactor),void 0!==n.clearcoatTexture&&i.push(e.assignTexture(t,"clearcoatMap",n.clearcoatTexture)),void 0!==n.clearcoatRoughnessFactor&&(t.clearcoatRoughness=n.clearcoatRoughnessFactor),void 0!==n.clearcoatRoughnessTexture&&i.push(e.assignTexture(t,"clearcoatRoughnessMap",n.clearcoatRoughnessTexture)),void 0!==n.clearcoatNormalTexture&&(i.push(e.assignTexture(t,"clearcoatNormalMap",n.clearcoatNormalTexture)),void 0!==n.clearcoatNormalTexture.scale)&&(e=n.clearcoatNormalTexture.scale,t.clearcoatNormalScale=new Mt(e,e)),Promise.all(i)},Vv="glTF",Wv=12,Yv={JSON:1313821514,BIN:5130562},T0.prototype.decodePrimitive=function(t,n){var e,i=this.json,r=this.dracoLoader,o=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,a={},u={},c={};for(e in s){var f=o0[e]||e.toLowerCase();a[f]=s[e]}for(e in t.attributes){var h,l,f=o0[e]||e.toLowerCase();void 0!==s[e]&&(h=i.accessors[t.attributes[e]],l=n0[h.componentType],c[f]=l,u[f]=!0===h.normalized)}return n.getDependency("bufferView",o).then(function(t){return new Promise(function(i){r.decodeDracoFile(t,function(t){for(var n in t.attributes){var e=t.attributes[n],n=u[n];void 0!==n&&(e.normalized=n)}i(t)},a,c)})})},x0.prototype.extendTexture=function(t,n){return t=t.clone(),void 0!==n.offset&&t.offset.fromArray(n.offset),void 0!==n.rotation&&(t.rotation=n.rotation),void 0!==n.scale&&t.repeat.fromArray(n.scale),void 0!==n.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.needsUpdate=!0,t},((A0.prototype=Object.create(Pd.prototype)).constructor=A0).prototype.copy=function(t){return Pd.prototype.copy.call(this,t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},((L0.prototype=Object.create(Zd.prototype)).constructor=L0).prototype.beforeStart_=L0.prototype.copySampleValue_=function(t){for(var n=this.resultBuffer,e=this.sampleValues,i=this.valueSize,r=t*i*3+i,o=0;o!==i;o++)n[o]=e[r+o];return n},L0.prototype.afterEnd_=L0.prototype.copySampleValue_,L0.prototype.interpolate_=function(t,n,e,i){for(var r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=2*s,u=3*s,c=i-n,i=(e-n)/c,e=i*i,n=e*i,f=t*u,h=f-u,l=-2*n+3*e,d=n-e,v=1-l,p=d-e+i,m=0;m!==s;m++){var y=o[h+m+s],b=o[h+m+a]*c,g=o[f+m+s],w=o[f+m]*c;r[m]=v*y+p*b+l*g+d*w}return r},Qv=0,Zv=1,qv=2,Kv=3,Jv=4,$v=5,t0=6,n0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},e0={9728:Vn,9729:B,9984:Wn,9985:Qn,9986:Yn,9987:Zn},i0={33071:Xn,33648:zn,10497:Hn},r0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},o0={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},s0={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},a0={CUBICSPLINE:void 0,LINEAR:ci,STEP:ui},u0="OPAQUE",c0="MASK",f0="BLEND",h0={"image/png":he,"image/jpeg":fe},F0.prototype.parse=function(n,t){var e=this,i=this.json,r=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(t){t={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:e,userData:{}};N0(r,t,i),P0(t,i),n(t)}).catch(t)},F0.prototype.markDefs=function(){for(var t=this.json.nodes||[],n=this.json.skins||[],e=this.json.meshes||[],i={},r={},o=0,s=n.length;o<s;o++)for(var a=n[o].joints,u=0,c=a.length;u<c;u++)t[a[u]].isBone=!0;for(var f=0,h=t.length;f<h;f++){var l=t[f];void 0!==l.mesh&&(void 0===i[l.mesh]&&(i[l.mesh]=r[l.mesh]=0),i[l.mesh]++,void 0!==l.skin)&&(e[l.mesh].isSkinnedMesh=!0)}this.json.meshReferences=i,this.json.meshUses=r},F0.prototype.getDependency=function(t,n){var e=t+":"+n,i=this.cache.get(e);if(!i){switch(t){case"scene":i=this.loadScene(n);break;case"node":i=this.loadNode(n);break;case"mesh":i=this.loadMesh(n);break;case"accessor":i=this.loadAccessor(n);break;case"bufferView":i=this.loadBufferView(n);break;case"buffer":i=this.loadBuffer(n);break;case"material":i=this.loadMaterial(n);break;case"texture":i=this.loadTexture(n);break;case"skin":i=this.loadSkin(n);break;case"animation":i=this.loadAnimation(n);break;case"camera":i=this.loadCamera(n);break;case"light":i=this.extensions[d.KHR_LIGHTS_PUNCTUAL].loadLight(n);break;default:throw new Error("Unknown type: "+t)}this.cache.add(e,i)}return i},F0.prototype.getDependencies=function(e){var i,t,n=this.cache.get(e);return n||(t=(i=this).json[e+("mesh"===e?"es":"s")]||[],n=Promise.all(t.map(function(t,n){return i.getDependency(e,n)})),this.cache.add(e,n)),n},F0.prototype.loadBuffer=function(t){var e,i=this.json.buffers[t],r=this.fileLoader;if(i.type&&"arraybuffer"!==i.type)throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");return void 0===i.uri&&0===t?Promise.resolve(this.extensions[d.KHR_BINARY_GLTF].body):(e=this.options,new Promise(function(t,n){r.load(R0(i.uri,e.path),t,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})}))},F0.prototype.loadBufferView=function(t){var i=this.json.bufferViews[t];return this.getDependency("buffer",i.buffer).then(function(t){var n=i.byteLength||0,e=i.byteOffset||0;return t.slice(e,e+n)})},F0.prototype.loadAccessor=function(t){var y=this,b=this.json,g=this.json.accessors[t];return void 0===g.bufferView&&void 0===g.sparse?Promise.resolve(null):(t=[],void 0!==g.bufferView?t.push(this.getDependency("bufferView",g.bufferView)):t.push(null),void 0!==g.sparse&&(t.push(this.getDependency("bufferView",g.sparse.indices.bufferView)),t.push(this.getDependency("bufferView",g.sparse.values.bufferView))),Promise.all(t).then(function(t){var n=t[0],e=r0[g.type],i=n0[g.componentType],r=i.BYTES_PER_ELEMENT,o=g.byteOffset||0,s=void 0!==g.bufferView?b.bufferViews[g.bufferView].byteStride:void 0,a=!0===g.normalized,u=s&&s!==r*e?(c=Math.floor(o/s),f="InterleavedBuffer:"+g.bufferView+":"+g.componentType+":"+c+":"+g.count,(h=y.cache.get(f))||(h=new Nc(new i(n,c*s,g.count*s/r),s/r),y.cache.add(f,h)),new jc(h,e,o%s/r,a)):new R(null===n?new i(g.count*e):new i(n,o,g.count*e),e,a);if(void 0!==g.sparse){var c=n0[g.sparse.indices.componentType],f=g.sparse.indices.byteOffset||0,h=g.sparse.values.byteOffset||0,l=new c(t[1],f,g.sparse.count*r0.SCALAR),d=new i(t[2],h,g.sparse.count*e);null!==n&&(u=new R(u.array.slice(),u.itemSize,u.normalized));for(var v=0,p=l.length;v<p;v++){var m=l[v];if(u.setX(m,d[v*e]),2<=e&&u.setY(m,d[v*e+1]),3<=e&&u.setZ(m,d[v*e+2]),4<=e&&u.setW(m,d[v*e+3]),5<=e)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return u}))},l0=0,F0.prototype.loadTexture=function(t){var e,n=this,i=this.json,r=this.options,o=this.textureLoader,s=(st.a.environment===G.a.BROWSER&&(e=self.URL||self.webkitURL),i.textures[t]),a=s.extensions||{},u=a[d.MSFT_TEXTURE_DDS]?i.images[a[d.MSFT_TEXTURE_DDS].source]:i.images[s.source],c=u.uri,f=!1;return void 0!==u.bufferView&&(c=n.getDependency("bufferView",u.bufferView).then(function(t){var n,r;return st.a.environment===G.a.BROWSER?(f=!0,n=new Blob([t],{type:u.mimeType}),c=e.createObjectURL(n)):(r=wx.getFileSystemManager(),new Promise(function(n,e){var i=wx.env.USER_DATA_PATH+"/"+l0+".png";l0++,r.writeFile({filePath:i,data:t,encoding:"binary",success:function(t){n(i)},fail:function(t){console.error("******",i,t),e(i)}})}))})),Promise.resolve(c).then(function(e){var i=(i=r.manager.getHandler(e))||(a[d.MSFT_TEXTURE_DDS]?n.extensions[d.MSFT_TEXTURE_DDS].ddsLoader:o);return new Promise(function(t,n){i.load(R0(e,r.path),t,void 0,n)})}).then(function(t){!0===f&&e.revokeObjectURL(c),t.flipY=!1,s.name&&(t.name=s.name),u.mimeType in h0&&(t.format=h0[u.mimeType]);var n=(i.samplers||{})[s.sampler]||{};return t.magFilter=e0[n.magFilter]||B,t.minFilter=e0[n.minFilter]||Zn,t.wrapS=i0[n.wrapS]||Hn,t.wrapT=i0[n.wrapT]||Hn,t})},F0.prototype.assignTexture=function(e,i,r){var o=this;return this.getDependency("texture",r.index).then(function(t){if(!t.isCompressedTexture)switch(i){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":t.format=fe}var n;void 0===r.texCoord||0==r.texCoord||"aoMap"===i&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+i+" not yet supported."),o.extensions[d.KHR_TEXTURE_TRANSFORM]&&(n=void 0!==r.extensions?r.extensions[d.KHR_TEXTURE_TRANSFORM]:void 0)&&(t=o.extensions[d.KHR_TEXTURE_TRANSFORM].extendTexture(t,n)),e[i]=t})},F0.prototype.assignFinalMaterial=function(t){var n,e,i=t.geometry,r=t.material,o=void 0!==i.attributes.tangent,s=void 0!==i.attributes.color,a=void 0===i.attributes.normal,u=!0===t.isSkinnedMesh,c=0<Object.keys(i.morphAttributes).length,f=c&&void 0!==i.morphAttributes.normal;t.isPoints?(n="PointsMaterial:"+r.uuid,(e=this.cache.get(n))||(e=new Nd,h.prototype.copy.call(e,r),e.color.copy(r.color),e.map=r.map,e.sizeAttenuation=!1,this.cache.add(n,e)),r=e):t.isLine&&(n="LineBasicMaterial:"+r.uuid,(e=this.cache.get(n))||(e=new al,h.prototype.copy.call(e,r),e.color.copy(r.color),this.cache.add(n,e)),r=e),(o||s||a||u||c)&&(n="ClonedMaterial:"+r.uuid+":",r.isGLTFSpecularGlossinessMaterial&&(n+="specular-glossiness:"),u&&(n+="skinning:"),o&&(n+="vertex-tangents:"),s&&(n+="vertex-colors:"),a&&(n+="flat-shading:"),c&&(n+="morph-targets:"),f&&(n+="morph-normals:"),(e=this.cache.get(n))||(e=r.clone(),u&&(e.skinning=!0),o&&(e.vertexTangents=!0),s&&(e.vertexColors=!0),a&&(e.flatShading=!0),c&&(e.morphTargets=!0),f&&(e.morphNormals=!0),this.cache.add(n,e)),r=e),r.aoMap&&void 0===i.attributes.uv2&&void 0!==i.attributes.uv&&i.setAttribute("uv2",new R(i.attributes.uv.array,2)),r.normalScale&&!o&&(r.normalScale.y=-r.normalScale.y),r.clearcoatNormalScale&&!o&&(r.clearcoatNormalScale.y=-r.clearcoatNormalScale.y),t.material=r},F0.prototype.loadMaterial=function(t){var n,e,i=this.json,r=this.extensions,o=i.materials[t],s={},i=o.extensions||{},t=[],a=(i[d.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]?(e=r[d.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS],n=e.getMaterialType(),t.push(e.extendParams(s,o,this))):i[d.KHR_MATERIALS_UNLIT]?(e=r[d.KHR_MATERIALS_UNLIT],n=e.getMaterialType(),t.push(e.extendParams(s,o,this))):(n=Pd,e=o.pbrMetallicRoughness||{},s.color=new lt(1,1,1),s.opacity=1,Array.isArray(e.baseColorFactor)&&(a=e.baseColorFactor,s.color.fromArray(a),s.opacity=a[3]),void 0!==e.baseColorTexture&&t.push(this.assignTexture(s,"map",e.baseColorTexture)),s.metalness=void 0!==e.metallicFactor?e.metallicFactor:1,s.roughness=void 0!==e.roughnessFactor?e.roughnessFactor:1,void 0!==e.metallicRoughnessTexture&&(t.push(this.assignTexture(s,"metalnessMap",e.metallicRoughnessTexture)),t.push(this.assignTexture(s,"roughnessMap",e.metallicRoughnessTexture)))),!0===o.doubleSided&&(s.side=an),o.alphaMode||u0);return a===f0?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,a===c0&&(s.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&n!==ta&&(t.push(this.assignTexture(s,"normalMap",o.normalTexture)),s.normalScale=new Mt(1,1),void 0!==o.normalTexture.scale)&&s.normalScale.set(o.normalTexture.scale,o.normalTexture.scale),void 0!==o.occlusionTexture&&n!==ta&&(t.push(this.assignTexture(s,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength)&&(s.aoMapIntensity=o.occlusionTexture.strength),void 0!==o.emissiveFactor&&n!==ta&&(s.emissive=(new lt).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&n!==ta&&t.push(this.assignTexture(s,"emissiveMap",o.emissiveTexture)),i[d.KHR_MATERIALS_CLEARCOAT]&&(e=r[d.KHR_MATERIALS_CLEARCOAT],n=e.getMaterialType(),t.push(e.extendParams(s,{extensions:i},this))),Promise.all(t).then(function(){var t=n===A0?r[d.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new n(s);return o.name&&(t.name=o.name),t.map&&(t.map.encoding=3001),t.emissiveMap&&(t.emissiveMap.encoding=3001),P0(t,o),o.extensions&&N0(r,t,o),t})},F0.prototype.loadGeometries=function(t){var e=this,i=this.extensions,n=this.primitiveCache;for(var r=[],o=0,s=t.length;o<s;o++){var a=t[o],u=(c=void 0,c=(c=(u=a).extensions&&u.extensions[d.KHR_DRACO_MESH_COMPRESSION])?"draco:"+c.bufferView+":"+c.indices+":"+j0(c.attributes):u.indices+":"+j0(u.attributes)+":"+u.mode),c=n[u];c?r.push(c.promise):(c=a.extensions&&a.extensions[d.KHR_DRACO_MESH_COMPRESSION]?function(n){return i[d.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(n,e).then(function(t){return I0(t,n,e)})}(a):I0(new N,a,e),n[u]={primitive:a,promise:c},r.push(c))}return Promise.all(r)},F0.prototype.loadMesh=function(m){for(var y=this,b=this.json.meshes[m],g=b.primitives,t=[],n=0,e=g.length;n<e;n++){var i=void 0===g[n].material?(void 0===(i=this.cache).DefaultMaterial&&(i.DefaultMaterial=new Pd({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:on})),i.DefaultMaterial):this.getDependency("material",g[n].material);t.push(i)}return t.push(y.loadGeometries(g)),Promise.all(t).then(function(t){for(var n=t.slice(0,t.length-1),e=t[t.length-1],i=[],r=0,o=e.length;r<o;r++){var s,a=e[r],u=g[r],c=n[r];if(u.mode===Jv||u.mode===$v||u.mode===t0||void 0===u.mode)!0!==(s=new(!0===b.isSkinnedMesh?gv:ba)(a,c)).isSkinnedMesh||s.geometry.attributes.skinWeight.normalized||s.normalizeSkinWeights(),u.mode===$v?s.geometry=C0(s.geometry,1):u.mode===t0&&(s.geometry=C0(s.geometry,2));else if(u.mode===Zv)s=new Ov(a,c);else if(u.mode===Kv)s=new xv(a,c);else if(u.mode===qv)s=new Lv(a,c);else{if(u.mode!==Qv)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);s=new Fv(a,c)}if(0<Object.keys(s.geometry.morphAttributes).length){v=d=l=h=f=void 0;var f=s,h=b;if(f.updateMorphTargets(),void 0!==h.weights)for(var l=0,d=h.weights.length;l<d;l++)f.morphTargetInfluences[l]=h.weights[l];if(h.extras&&Array.isArray(h.extras.targetNames)){var v=h.extras.targetNames;if(f.morphTargetInfluences.length===v.length){f.morphTargetDictionary={};for(l=0,d=v.length;l<d;l++)f.morphTargetDictionary[v[l]]=l}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}s.name=b.name||"mesh_"+m,1<e.length&&(s.name+="_"+r),P0(s,b),y.assignFinalMaterial(s),i.push(s)}if(1===i.length)return i[0];for(var p=new wc,r=0,o=i.length;r<o;r++)p.add(i[r]);return p})},F0.prototype.loadCamera=function(t){var n,t=this.json.cameras[t],e=t[t.type];if(e)return"perspective"===t.type?n=new dt(Tt.radToDeg(e.yfov),e.aspectRatio||1,e.znear||1,e.zfar||2e6):"orthographic"===t.type&&(n=new vt(e.xmag/-2,e.xmag/2,e.ymag/2,e.ymag/-2,e.znear,e.zfar)),t.name&&(n.name=t.name),P0(n,t),Promise.resolve(n);console.warn("THREE.GLTFLoader: Missing camera parameters.")},F0.prototype.loadSkin=function(t){var t=this.json.skins[t],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(t){return n.inverseBindMatrices=t,n})},F0.prototype.loadAnimation=function(T){for(var x=this.json.animations[T],t=[],n=[],e=[],i=[],r=[],o=0,s=x.channels.length;o<s;o++){var a=x.channels[o],u=x.samplers[a.sampler],a=a.target,c=void 0!==a.node?a.node:a.id,f=void 0!==x.parameters?x.parameters[u.input]:u.input,h=void 0!==x.parameters?x.parameters[u.output]:u.output;t.push(this.getDependency("node",c)),n.push(this.getDependency("accessor",f)),e.push(this.getDependency("accessor",h)),i.push(u),r.push(a)}return Promise.all([Promise.all(t),Promise.all(n),Promise.all(e),Promise.all(i),Promise.all(r)]).then(function(t){for(var n=t[0],e=t[1],i=t[2],r=t[3],o=t[4],s=[],a=0,u=n.length;a<u;a++){var c,f=n[a],h=e[a],l=i[a],d=r[a],v=o[a];if(void 0!==f){switch(f.updateMatrix(),f.matrixAutoUpdate=!0,s0[v.path]){case s0.weights:c=ev;break;case s0.rotation:c=rv;break;default:c=sv}var p,m=f.name||f.uuid,y=void 0!==d.interpolation?a0[d.interpolation]:ci,b=[],g=(s0[v.path]===s0.weights?f.traverse(function(t){!0===t.isMesh&&t.morphTargetInfluences&&b.push(t.name||t.uuid)}):b.push(m),l.array);if(l.normalized){if(g.constructor===Int8Array)p=1/127;else if(g.constructor===Uint8Array)p=1/255;else if(g.constructor==Int16Array)p=1/32767;else{if(g.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");p=1/65535}for(var w=new Float32Array(g.length),_=0,E=g.length;_<E;_++)w[_]=g[_]*p;g=w}for(_=0,E=b.length;_<E;_++){var S=new c(b[_]+"."+s0[v.path],h.array,g,y);"CUBICSPLINE"===d.interpolation&&(S.createInterpolant=function(t){return new L0(this.times,this.values,this.getValueSize()/3,t)},S.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),s.push(S)}}}return new av(x.name||"animation_"+T,void 0,s)})},F0.prototype.loadNode=function(t){var n=this.json,o=this.extensions,e=this,i=n.meshReferences,r=n.meshUses,s=n.nodes[t];return n=[],void 0!==s.mesh&&n.push(e.getDependency("mesh",s.mesh).then(function(t){var n,e;return 1<i[s.mesh]?(n=r[s.mesh]++,(e=t.clone()).name+="_instance_"+n):e=t,void 0!==s.weights&&e.traverse(function(t){if(t.isMesh)for(var n=0,e=s.weights.length;n<e;n++)t.morphTargetInfluences[n]=s.weights[n]}),e})),void 0!==s.camera&&n.push(e.getDependency("camera",s.camera)),s.extensions&&s.extensions[d.KHR_LIGHTS_PUNCTUAL]&&void 0!==s.extensions[d.KHR_LIGHTS_PUNCTUAL].light&&n.push(e.getDependency("light",s.extensions[d.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(n).then(function(t){var n,e=!0===s.isBone?new Cv:1<t.length?new wc:1===t.length?t[0]:new a;if(e!==t[0])for(var i=0,r=t.length;i<r;i++)e.add(t[i]);return s.name&&(e.userData.name=s.name,e.name=zv.sanitizeNodeName(s.name)),P0(e,s),s.extensions&&N0(o,e,s),void 0!==s.matrix?((n=new At).fromArray(s.matrix),e.applyMatrix4(n)):(void 0!==s.translation&&e.position.fromArray(s.translation),void 0!==s.rotation&&e.quaternion.fromArray(s.rotation),void 0!==s.scale&&e.scale.fromArray(s.scale)),e})},F0.prototype.loadScene=function(t){for(var n=this.json,e=this.extensions,t=this.json.scenes[t],i=new qo,r=(t.name&&(i.name=t.name),P0(i,t),t.extensions&&N0(e,i,t),t.nodes||[]),o=[],s=0,a=r.length;s<a;s++)o.push(function s(t,a,u,c){var f=u.nodes[t];return c.getDependency("node",t).then(function(t){var a;return void 0===f.skin?t:c.getDependency("skin",f.skin).then(function(t){for(var n=[],e=0,i=(a=t).joints.length;e<i;e++)n.push(c.getDependency("node",a.joints[e]));return Promise.all(n)}).then(function(s){return t.traverse(function(t){if(t.isMesh){for(var n=[],e=[],i=0,r=s.length;i<r;i++){var o=s[i];o?(n.push(o),o=new At,void 0!==a.inverseBindMatrices&&o.fromArray(a.inverseBindMatrices.array,16*i),e.push(o)):console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',a.joints[i])}t.bind(new p0(n,e),t.matrixWorld)}}),t})}).then(function(t){a.add(t);var n=[];if(f.children)for(var e=f.children,i=0,r=e.length;i<r;i++){var o=e[i];n.push(s(o,t,u,c))}return Promise.all(n)})}(r[s],i,n,this));return Promise.all(o).then(function(){return i})};var k0=y0;function D0(t){return(D0="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function U0(t){Vd.call(this,t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}function B0(t){return(B0="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function G0(t,n){var e,i,r,o,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return i=!(e=!0),{s:function(){s=s.call(t)},n:function(){var t=s.next();return e=t.done,t},e:function(t){i=!0,r=t},f:function(){try{e||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(t)||(s=function(t,n){var e;if(t)return"string"==typeof t?H0(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?H0(t,n):void 0}(t))||n&&t&&"number"==typeof t.length)return s&&(t=s),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function H0(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function X0(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=B0(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=B0(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==B0(t)?t:String(t)}(i.key),i)}}function z0(t,n,e){n=W0(n);var i=t,n=V0()?Reflect.construct(n,e||[],W0(t).constructor):n.apply(t,e);if(n&&("object"===B0(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function V0(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(V0=function(){return!!t})()}function W0(t){return(W0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Y0(t,n){return(Y0=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}U0.prototype=Object.assign(Object.create(Vd.prototype),{constructor:U0,setDecoderPath:function(t){return this.decoderPath=t,this},setDecoderConfig:function(t){return this.decoderConfig=t,this},setWorkerLimit:function(t){return this.workerLimit=t,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(t,e,n,i){var r=this,o=new Yd(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),"use-credentials"===this.crossOrigin&&o.setWithCredentials(!0),o.load(t,function(t){var n={attributeIDs:r.defaultAttributeIDs,attributeTypes:r.defaultAttributeTypes,useUniqueIDs:!1};r.decodeGeometry(t,n).then(e).catch(i)},n,i)},decodeDracoFile:function(t,n,e,i){i={attributeIDs:e||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!e};this.decodeGeometry(t,i).then(n)},decodeGeometry:function(e,i){var t,n=this;for(t in i.attributeTypes){var r=i.attributeTypes[t];void 0!==r.BYTES_PER_ELEMENT&&(i.attributeTypes[t]=r.name)}var o,s=JSON.stringify(i);if(U0.taskCache.has(e)){var a=U0.taskCache.get(e);if(a.key===s)return a.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var u=this.workerNextTaskID++,a=e.byteLength,a=this.lf(u,a).then(function(t){return o=t,new Promise(function(t,n){o.df[u]={resolve:t,reject:n},o.postMessage({type:"decode",id:u,taskConfig:i,buffer:e},[e])})}).then(function(t){return n.vf(t.geometry)});return a.finally(function(){o&&u&&n.pf(o,u)}),U0.taskCache.set(e,{key:s,promise:a}),a},vf:function(t){var n=new N;t.index&&n.setIndex(new R(t.index.array,1));for(var e=0;e<t.attributes.length;e++){var i=t.attributes[e],r=i.name,o=i.array,i=i.itemSize;n.setAttribute(r,new R(o,i))}return n},mf:function(e,t){var i=new Yd(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),new Promise(function(t,n){i.load(e,t,void 0,n)})},preload:function(){return this.yf(),this},yf:function(){var e,t,i=this;return this.decoderPending||(t=[],(e="object"!==("undefined"==typeof WebAssembly?"undefined":D0(WebAssembly))||"js"===this.decoderConfig.type)?t.push(this.mf("draco_decoder.js","text")):(t.push(this.mf("draco_wasm_wrapper.js","text")),t.push(this.mf("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(function(t){var n=t[0],t=(e||(i.decoderConfig.wasmBinary=t[1]),U0.DRACOWorker.toString()),n=["/* draco decoder */",n,"","/* worker */",t.substring(t.indexOf("{")+1,t.lastIndexOf("}"))].join("\n");i.workerSourceURL=URL.createObjectURL(new Blob([n]))})),this.decoderPending},lf:function(t,n){var i=this;return this.yf().then(function(){i.workerPool.length<i.workerLimit?((e=new Worker(i.workerSourceURL)).df={},e.bf={},e.gf=0,e.postMessage({type:"init",decoderConfig:i.decoderConfig}),e.onmessage=function(t){var n=t.data;switch(n.type){case"decode":e.df[n.id].resolve(n);break;case"error":e.df[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},i.workerPool.push(e)):i.workerPool.sort(function(t,n){return t.gf>n.gf?-1:1});var e=i.workerPool[i.workerPool.length-1];return e.bf[t]=n,e.gf+=n,e})},pf:function(t,n){t.gf-=t.bf[n],delete t.df[n],delete t.bf[n]},debug:function(){this.workerPool.map(function(t){return t.gf})},dispose:function(){for(var t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}),U0.DRACOWorker=function(){var e,n;onmessage=function(t){var o=t.data;switch(o.type){case"init":e=o.decoderConfig,n=new Promise(function(n){e.onModuleLoaded=function(t){n({draco:t})},DracoDecoderModule(e)});break;case"decode":var s=o.buffer,a=o.taskConfig;n.then(function(t){var t=t.draco,n=new t.Decoder,e=new t.DecoderBuffer;e.Init(new Int8Array(s),s.byteLength);try{var i=function(t,n,e,i){var r,o,s=i.attributeIDs,a=i.attributeTypes,u=n.GetEncodedGeometryType(e);if(u===t.TRIANGULAR_MESH)r=new t.Mesh,o=n.DecodeBufferToMesh(e,r);else{if(u!==t.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");r=new t.PointCloud,o=n.DecodeBufferToPointCloud(e,r)}if(!o.ok()||0===r.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+o.error_msg());var c,f,h,l={index:null,attributes:[]};for(c in s){var d=self[a[c]];if(i.useUniqueIDs)h=s[c],f=n.GetAttributeByUniqueId(r,h);else{if(-1===(h=n.GetAttributeId(r,t[s[c]])))continue;f=n.GetAttribute(r,h)}l.attributes.push(function(t,n,e,i,r,o){var s,a,u=o.num_components(),c=e.num_points()*u;switch(r){case Float32Array:s=new t.DracoFloat32Array,n.GetAttributeFloatForAllPoints(e,o,s),a=new Float32Array(c);break;case Int8Array:s=new t.DracoInt8Array,n.GetAttributeInt8ForAllPoints(e,o,s),a=new Int8Array(c);break;case Int16Array:s=new t.DracoInt16Array,n.GetAttributeInt16ForAllPoints(e,o,s),a=new Int16Array(c);break;case Int32Array:s=new t.DracoInt32Array,n.GetAttributeInt32ForAllPoints(e,o,s),a=new Int32Array(c);break;case Uint8Array:s=new t.DracoUInt8Array,n.GetAttributeUInt8ForAllPoints(e,o,s),a=new Uint8Array(c);break;case Uint16Array:s=new t.DracoUInt16Array,n.GetAttributeUInt16ForAllPoints(e,o,s),a=new Uint16Array(c);break;case Uint32Array:s=new t.DracoUInt32Array,n.GetAttributeUInt32ForAllPoints(e,o,s),a=new Uint32Array(c);break;default:throw new Error("THREE.DRACOLoader: Unexpected attribute type.")}for(var f=0;f<c;f++)a[f]=s.GetValue(f);return t.destroy(s),{name:i,array:a,itemSize:u}}(t,n,r,c,d,f))}if(u===t.TRIANGULAR_MESH){for(var v=r.num_faces(),p=new Uint32Array(3*v),m=new t.DracoInt32Array,y=0;y<v;++y){n.GetFaceFromMesh(r,y,m);for(var b=0;b<3;++b)p[3*y+b]=m.GetValue(b)}l.index={array:p,itemSize:1},t.destroy(m)}return t.destroy(r),l}(t,n,e,a),r=i.attributes.map(function(t){return t.array.buffer});i.index&&r.push(i.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:i},r)}catch(t){console.error(t),self.postMessage({type:"error",id:o.id,error:t.message})}finally{t.destroy(e),t.destroy(n)}})}}},U0.taskCache=new WeakMap,U0.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},U0.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},U0.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},U0.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")};var Uv=function(){var t,n,e=r,i=ll;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(t){var n;if(this instanceof r)return(n=z0(this,r)).Lt=t,n.wf=new fv,n._f=new k0,n.Ef=!1,n.Sf=!1,n.Lt.Ve.decoderURL&&((t=new U0).setDecoderPath(n.Lt.Ve.decoderURL),n._f.setDRACOLoader(t)),n;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Y0(e,i),e=r,t&&X0(e.prototype,t),n&&X0(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(),Q0=(Object.assign(Uv.prototype,{Na:function(o,s,n){var a,t,u=this;if(!this.Qa.has(o))return this.Qa.set(o,{loadComplete:!1}),a=-1===o.indexOf(".js"),t=this._f,(t=a?t:this.wf).load(o,function(t,n){if(!0!==u.Sf){if(a)u.Qa.set(o,{gltf:t,data:n,isAnimate:0<t.animations.length,isGltf:!0,loadComplete:!0}),s&&s(a,t);else{if(Array.isArray(n)){var e,i=G0(n);try{for(i.s();!(e=i.n()).done;){var r=e.value;r.map&&u.Ef&&r.color.setScalar(1)}}catch(t){i.e(t)}finally{i.f()}}else n.map&&u.Ef&&n.color.setScalar(1);u.Qa.set(o,{geometry:t,material:n,isGltf:!1,loadComplete:!0}),s&&s(a,t,n)}u.Lt.fi.Tf(),u.xf(o,!1)}},function(t){},function(t){!0!==u.Sf&&(u.Qa.delete(o),n&&n(t),u.xf(o,t))});this.qa(o,{success:s,fail:n}),!0===this.Qa.get(o).loadComplete&&this.xf(o)},xf:function(r,o){var s,a=this;this.Za.has(r)&&(s=this.Qa.get(r))&&(this.Za.get(r).forEach(function(t,n,e){var i;o?n.fail&&n.fail(o):s.isGltf?s.isAnimate?a._f.parse(s.data,Ad(r),function(t){n.success&&n.success(!0,t)},function(t){n.fail&&n.fail(t)}):((i={animations:[]}).scene=s.gltf.scene.clone(),i.scene.traverse(function(t){"Mesh"===t.type&&delete t.userData.sourceMaterial}),n.success&&n.success(!0,i)):n.success&&n.success(!1,s.geometry,s.material),e.delete(t)}),this.Za.delete(r))},nn:function(){this.Sf=!0,this.Qa.clear(),this.Za.clear(),this.wf=null,this._f.fileLoaders.forEach(function(t){t.dispose()}),this._f.fileLoaders.length=0,this._f=null}}),Uv);function Z0(t){return(Z0="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function q0(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Z0(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Z0(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Z0(t)?t:String(t)}(i.key),i)}}function K0(t,n,e){n=$0(n);var i=t,n=J0()?Reflect.construct(n,e||[],$0(t).constructor):n.apply(t,e);if(n&&("object"===Z0(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function J0(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(J0=function(){return!!t})()}function $0(t){return($0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function tp(t,n){return(tp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var n=function(){var t,n,e=r,i=ll;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(t){var n,e;if(this instanceof r)return(n=K0(this,r))._f=new k0,t.Ve.decoderURL&&((e=new U0).setDecoderPath(t.Ve.decoderURL),n._f.setDRACOLoader(e)),n;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&tp(e,i),e=r,t&&q0(e.prototype,t),n&&q0(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(),np=(Object.assign(n.prototype,{Na:function(e,i,r){var o=this;this.Qa.has(e)?(this.qa(e,{success:i,fail:r}),!0===this.Qa.get(e).loadComplete&&this.xf(e)):(this.Qa.set(e,{loadComplete:!1}),this._f.load(e,function(t,n){t.scene.userData.sourceScale=t.scene.scale.clone(),o.Qa.set(e,{gltf:t,isAnimate:0<t.animations.length,data:0<t.animations.length?n:null,loadComplete:!0}),o.qa(e,{success:i,fail:r}),o.xf(e)},function(t){},function(t){o.Qa.delete(e),r&&r(t),o.xf(e,t)}))},xf:function(r,o){var s,a=this;this.Za.has(r)&&(s=this.Qa.get(r))&&(this.Za.get(r).forEach(function(t,n,e){var i;o?n.fail&&n.fail(o):s.isAnimate?a._f.parse(s.data,Ad(r),function(t){t.scene.userData.sourceScale=t.scene.scale.clone(),n.success&&n.success(t)},function(t){n.fail&&n.fail(t)}):((i={animations:[]}).scene=s.gltf.scene.clone(!0),n.success&&n.success(i)),e.delete(t)}),this.Za.delete(r))},nn:function(){this._f=null,this.Qa.clear(),this.Qa=null,this.Za.clear(),this.Za=null}}),n);function ep(){this.type="Curve",this.arcLengthDivisions=200}function ip(t,n,e,i,r,o,s,a){ep.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=n||0,this.xRadius=e||1,this.yRadius=i||1,this.aStartAngle=r||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=s||!1,this.aRotation=a||0}function rp(t,n,e,i,r,o){ip.call(this,t,n,e,e,i,r,o),this.type="ArcCurve"}function op(){var r=0,o=0,s=0,a=0;function u(t,n,e,i){s=-3*(r=t)+3*n-2*(o=e)-i,a=2*t-2*n+e+i}return{initCatmullRom:function(t,n,e,i,r){u(n,e,r*(e-t),r*(i-n))},initNonuniformCatmullRom:function(t,n,e,i,r,o,s){t=(n-t)/r-(e-t)/(r+o)+(e-n)/o,r=(e-n)/o-(i-n)/(o+s)+(i-e)/s;u(n,e,t*=o,r*=o)},calc:function(t){var n=t*t;return r+o*t+s*n+a*(n*t)}}}Object.assign(ep.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,n){t=this.getUtoTmapping(t);return this.getPoint(t,n)},getPoints:function(t){void 0===t&&(t=5);for(var n=[],e=0;e<=t;e++)n.push(this.getPoint(e/t));return n},getSpacedPoints:function(t){void 0===t&&(t=5);for(var n=[],e=0;e<=t;e++)n.push(this.getPointAt(e/t));return n},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var n,e,i=[],r=this.getPoint(0),o=0;for(i.push(0),e=1;e<=t;e++)o+=(n=this.getPoint(e/t)).distanceTo(r),i.push(o),r=n;return this.cacheArcLengths=i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,n){for(var e,i=this.getLengths(),r=0,o=i.length,s=n||t*i[o-1],a=0,u=o-1;a<=u;)if((e=i[r=Math.floor(a+(u-a)/2)]-s)<0)a=r+1;else{if(!(0<e)){u=r;break}u=r-1}return i[r=u]===s?r/(o-1):(r+(s-(n=i[r]))/(i[r+1]-n))/(o-1)},getTangent:function(t){var n=t-1e-4,t=t+1e-4,n=(1<t&&(t=1),this.getPoint(n=n<0?0:n));return this.getPoint(t).clone().sub(n).normalize()},getTangentAt:function(t){t=this.getUtoTmapping(t);return this.getTangent(t)},computeFrenetFrames:function(t,n){for(var e,i=new xt,r=[],o=[],s=[],a=new xt,u=new At,c=0;c<=t;c++)r[c]=this.getTangentAt(c/t),r[c].normalize();o[0]=new xt,s[0]=new xt;var f=Number.MAX_VALUE,h=Math.abs(r[0].x),l=Math.abs(r[0].y),d=Math.abs(r[0].z);for(h<=f&&(f=h,i.set(1,0,0)),l<=f&&(f=l,i.set(0,1,0)),d<=f&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),o[0].crossVectors(r[0],a),s[0].crossVectors(r[0],o[0]),c=1;c<=t;c++)o[c]=o[c-1].clone(),s[c]=s[c-1].clone(),a.crossVectors(r[c-1],r[c]),a.length()>Number.EPSILON&&(a.normalize(),e=Math.acos(Tt.clamp(r[c-1].dot(r[c]),-1,1)),o[c].applyMatrix4(u.makeRotationAxis(a,e))),s[c].crossVectors(r[c],o[c]);if(!0===n)for(e=Math.acos(Tt.clamp(o[0].dot(o[t]),-1,1)),e/=t,0<r[0].dot(a.crossVectors(o[0],o[t]))&&(e=-e),c=1;c<=t;c++)o[c].applyMatrix4(u.makeRotationAxis(r[c],e*c)),s[c].crossVectors(r[c],o[c]);return{tangents:r,normals:o,binormals:s}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),((ip.prototype=Object.create(ep.prototype)).constructor=ip).prototype.isEllipseCurve=!0,ip.prototype.getPoint=function(t,n){for(var n=n||new Mt,e=2*Math.PI,i=this.aEndAngle-this.aStartAngle,r=Math.abs(i)<Number.EPSILON;i<0;)i+=e;for(;e<i;)i-=e;i<Number.EPSILON&&(i=r?0:e),!0!==this.aClockwise||r||(i===e?i=-e:i-=e);var o,s,a,u,r=this.aStartAngle+t*i,t=this.aX+this.xRadius*Math.cos(r),r=this.aY+this.yRadius*Math.sin(r);return 0!==this.aRotation&&(o=Math.cos(this.aRotation),s=Math.sin(this.aRotation),t=(a=t-this.aX)*o-(u=r-this.aY)*s+this.aX,r=a*s+u*o+this.aY),n.set(t,r)},ip.prototype.copy=function(t){return ep.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},((rp.prototype=Object.create(ip.prototype)).constructor=rp).prototype.isArcCurve=!0;var sp=new xt,ap=new op,up=new op,cp=new op;function fp(t,n,e,i){ep.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=n||!1,this.curveType=e||"centripetal",this.tension=i||.5}function hp(t,n,e,i,r){var n=.5*(i-n),r=.5*(r-e),o=t*t;return(2*e-2*i+n+r)*(t*o)+(-3*e+3*i-2*n-r)*o+n*t+e}function lp(t,n,e,i){return(r=1-(r=t))*r*n+2*(1-t)*t*e+t*t*i;var r}function dp(t,n,e,i,r){return(o=1-(o=t))*o*o*n+3*(o=1-t)*o*t*e+3*(1-t)*t*t*i+t*t*t*r;var o}function vp(t,n,e,i){ep.call(this),this.type="CubicBezierCurve",this.v0=t||new Mt,this.v1=n||new Mt,this.v2=e||new Mt,this.v3=i||new Mt}function pp(t,n,e,i){ep.call(this),this.type="CubicBezierCurve3",this.v0=t||new xt,this.v1=n||new xt,this.v2=e||new xt,this.v3=i||new xt}function mp(t,n){ep.call(this),this.type="LineCurve",this.v1=t||new Mt,this.v2=n||new Mt}function yp(t,n){ep.call(this),this.type="LineCurve3",this.v1=t||new xt,this.v2=n||new xt}function bp(t,n,e){ep.call(this),this.type="QuadraticBezierCurve",this.v0=t||new Mt,this.v1=n||new Mt,this.v2=e||new Mt}function gp(t,n,e){ep.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new xt,this.v1=n||new xt,this.v2=e||new xt}function wp(t){ep.call(this),this.type="SplineCurve",this.points=t||[]}function _p(){ep.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Ep(t){_p.call(this),this.type="Path",this.currentPoint=new Mt,t&&this.setFromPoints(t)}function Sp(t){Ep.call(this,t),this.uuid=Tt.generateUUID(),this.type="Shape",this.holes=[]}((fp.prototype=Object.create(ep.prototype)).constructor=fp).prototype.isCatmullRomCurve3=!0,fp.prototype.getPoint=function(t,n){var e,i,r,o,n=n||new xt,s=this.points,a=s.length,t=(a-(this.closed?0:1))*t,u=Math.floor(t),t=t-u;return this.closed?u+=0<u?0:(Math.floor(Math.abs(u)/a)+1)*a:0===t&&u===a-1&&(u=a-2,t=1),e=this.closed||0<u?s[(u-1)%a]:(sp.subVectors(s[0],s[1]).add(s[0]),sp),i=s[u%a],r=s[(u+1)%a],u=this.closed||u+2<a?s[(u+2)%a]:(sp.subVectors(s[a-1],s[a-2]).add(s[a-1]),sp),"centripetal"===this.curveType||"chordal"===this.curveType?(s="chordal"===this.curveType?.5:.25,a=Math.pow(e.distanceToSquared(i),s),(o=Math.pow(i.distanceToSquared(r),s))<1e-4&&(o=1),a<1e-4&&(a=o),(s=Math.pow(r.distanceToSquared(u),s))<1e-4&&(s=o),ap.initNonuniformCatmullRom(e.x,i.x,r.x,u.x,a,o,s),up.initNonuniformCatmullRom(e.y,i.y,r.y,u.y,a,o,s),cp.initNonuniformCatmullRom(e.z,i.z,r.z,u.z,a,o,s)):"catmullrom"===this.curveType&&(ap.initCatmullRom(e.x,i.x,r.x,u.x,this.tension),up.initCatmullRom(e.y,i.y,r.y,u.y,this.tension),cp.initCatmullRom(e.z,i.z,r.z,u.z,this.tension)),n.set(ap.calc(t),up.calc(t),cp.calc(t)),n},fp.prototype.copy=function(t){ep.prototype.copy.call(this,t),this.points=[];for(var n=0,e=t.points.length;n<e;n++){var i=t.points[n];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},((vp.prototype=Object.create(ep.prototype)).constructor=vp).prototype.isCubicBezierCurve=!0,vp.prototype.getPoint=function(t,n){var n=n||new Mt,e=this.v0,i=this.v1,r=this.v2,o=this.v3;return n.set(dp(t,e.x,i.x,r.x,o.x),dp(t,e.y,i.y,r.y,o.y)),n},vp.prototype.copy=function(t){return ep.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},((pp.prototype=Object.create(ep.prototype)).constructor=pp).prototype.isCubicBezierCurve3=!0,pp.prototype.getPoint=function(t,n){var n=n||new xt,e=this.v0,i=this.v1,r=this.v2,o=this.v3;return n.set(dp(t,e.x,i.x,r.x,o.x),dp(t,e.y,i.y,r.y,o.y),dp(t,e.z,i.z,r.z,o.z)),n},pp.prototype.copy=function(t){return ep.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},((mp.prototype=Object.create(ep.prototype)).constructor=mp).prototype.isLineCurve=!0,mp.prototype.getPoint=function(t,n){n=n||new Mt;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},mp.prototype.getPointAt=function(t,n){return this.getPoint(t,n)},mp.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},mp.prototype.copy=function(t){return ep.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},((yp.prototype=Object.create(ep.prototype)).constructor=yp).prototype.isLineCurve3=!0,yp.prototype.getPoint=function(t,n){n=n||new xt;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},yp.prototype.getPointAt=function(t,n){return this.getPoint(t,n)},yp.prototype.copy=function(t){return ep.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},((bp.prototype=Object.create(ep.prototype)).constructor=bp).prototype.isQuadraticBezierCurve=!0,bp.prototype.getPoint=function(t,n){var n=n||new Mt,e=this.v0,i=this.v1,r=this.v2;return n.set(lp(t,e.x,i.x,r.x),lp(t,e.y,i.y,r.y)),n},bp.prototype.copy=function(t){return ep.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},gp.prototype.getPoint=function(t,n){var n=n||new xt,e=this.v0,i=this.v1,r=this.v2;return n.set(lp(t,e.x,i.x,r.x),lp(t,e.y,i.y,r.y),lp(t,e.z,i.z,r.z)),n},((wp.prototype=Object.create(ep.prototype)).constructor=wp).prototype.isSplineCurve=!0,wp.prototype.getPoint=function(t,n){var n=n||new Mt,e=this.points,t=(e.length-1)*t,i=Math.floor(t),t=t-i,r=e[0===i?i:i-1],o=e[i],s=e[i>e.length-2?e.length-1:i+1],e=e[i>e.length-3?e.length-1:i+2];return n.set(hp(t,r.x,o.x,s.x,e.x),hp(t,r.y,o.y,s.y,e.y)),n},wp.prototype.copy=function(t){ep.prototype.copy.call(this,t),this.points=[];for(var n=0,e=t.points.length;n<e;n++){var i=t.points[n];this.points.push(i.clone())}return this},_p.prototype=Object.assign(Object.create(ep.prototype),{constructor:_p,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),n=this.curves[this.curves.length-1].getPoint(1);t.equals(n)||this.curves.push(new mp(n,t))},getPoint:function(t){for(var n,e,i,r=t*this.getLength(),o=this.getCurveLengths(),s=0;s<o.length;){if(o[s]>=r)return n=o[s]-r,i=(e=this.curves[s]).getLength(),e.getPointAt(0===i?0:1-n/i);s++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],n=0,e=0,i=this.curves.length;e<i;e++)n+=this.curves[e].getLength(),t.push(n);return this.cacheLengths=t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var n=[],e=0;e<=t;e++)n.push(this.getPoint(e/t));return this.autoClose&&n.push(n[0]),n},getPoints:function(t){t=t||12;for(var n,e=[],i=0,r=this.curves;i<r.length;i++)for(var o=r[i],s=o&&o.isEllipseCurve?2*t:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?t*o.points.length:t,a=o.getPoints(s),u=0;u<a.length;u++){var c=a[u];n&&n.equals(c)||(e.push(c),n=c)}return this.autoClose&&1<e.length&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e},copy:function(t){ep.prototype.copy.call(this,t),this.curves=[];for(var n=0,e=t.curves.length;n<e;n++){var i=t.curves[n];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}}),Ep.prototype=Object.assign(Object.create(_p.prototype),{constructor:Ep,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var n=1,e=t.length;n<e;n++)this.lineTo(t[n].x,t[n].y);return this},moveTo:function(t,n){return this.currentPoint.set(t,n),this},lineTo:function(t,n){var e=new mp(this.currentPoint.clone(),new Mt(t,n));return this.curves.push(e),this.currentPoint.set(t,n),this},quadraticCurveTo:function(t,n,e,i){t=new bp(this.currentPoint.clone(),new Mt(t,n),new Mt(e,i));return this.curves.push(t),this.currentPoint.set(e,i),this},bezierCurveTo:function(t,n,e,i,r,o){t=new vp(this.currentPoint.clone(),new Mt(t,n),new Mt(e,i),new Mt(r,o));return this.curves.push(t),this.currentPoint.set(r,o),this},splineThru:function(t){var n=new wp([this.currentPoint.clone()].concat(t));return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,n,e,i,r,o){var s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+s,n+a,e,i,r,o),this},absarc:function(t,n,e,i,r,o){return this.absellipse(t,n,e,e,i,r,o),this},ellipse:function(t,n,e,i,r,o,s,a){var u=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+u,n+c,e,i,r,o,s,a),this},absellipse:function(t,n,e,i,r,o,s,a){t=new ip(t,n,e,i,r,o,s,a),0<this.curves.length&&((n=t.getPoint(0)).equals(this.currentPoint)||this.lineTo(n.x,n.y)),this.curves.push(t),e=t.getPoint(1);return this.currentPoint.copy(e),this},copy:function(t){return _p.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this}}),Sp.prototype=Object.assign(Object.create(Ep.prototype),{constructor:Sp,getPointsHoles:function(t){for(var n=[],e=0,i=this.holes.length;e<i;e++)n[e]=this.holes[e].getPoints(t);return n},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){Ep.prototype.copy.call(this,t),this.holes=[];for(var n=0,e=t.holes.length;n<e;n++){var i=t.holes[n];this.holes.push(i.clone())}return this}});var Tp=function(t,n,e){e=e||2;var i,r,o,s,a,u=n&&n.length,c=u?n[0]*e:t.length,f=xp(t,0,c,e,!0),h=[];if(f&&f.next!==f.prev){if(u&&(f=function(t,n,e,i){var r,o,s,a,u=[];for(r=0,o=n.length;r<o;r++)a=n[r]*i,s=r<o-1?n[r+1]*i:t.length,(a=xp(t,a,s,i,!1))===a.next&&(a.steiner=!0),u.push(function(t){var n=t,e=t;for(;(n.x<e.x||n.x===e.x&&n.y<e.y)&&(e=n),n=n.next,n!==t;);return e}(a));for(u.sort(Op),r=0;r<u.length;r++)!function(t,n){(n=function(t,n){var e,i=n,r=t.x,o=t.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&s<a){if((s=a)===r){if(o===i.y)return i;if(o===i.next.y)return i.next}e=i.x<i.next.x?i:i.next}}}while(i=i.next,i!==n);if(!e)return null;if(r===s)return e.prev;var u,c=e,f=e.x,h=e.y,l=1/0;i=e.next;for(;i!==c;)r>=i.x&&i.x>=f&&r!==i.x&&Rp(o<h?r:s,o,f,h,o<h?s:r,o,i.x,i.y)&&((u=Math.abs(o-i.y)/(r-i.x))<l||u===l&&i.x>e.x)&&Fp(i,t)&&(e=i,l=u),i=i.next;return e}(t,n))&&Ap(n=Ip(n,t),n.next)}(u[r],e),e=Ap(e,e.next);return e}(t,n,f,e)),t.length>80*e){for(var l=i=t[0],d=r=t[1],v=e;v<c;v+=e)(o=t[v])<l&&(l=o),(s=t[v+1])<d&&(d=s),i<o&&(i=o),r<s&&(r=s);a=0!==(a=Math.max(i-l,r-d))?1/a:0}Mp(f,h,e,l,d,a)}return h};function xp(t,n,e,i,r){var o,s;if(r===0<function(t,n,e,i){for(var r=0,o=n,s=e-i;o<e;o+=i)r+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return r}(t,n,e,i))for(o=n;o<e;o+=i)s=Cp(o,t[o],t[o+1],s);else for(o=e-i;n<=o;o-=i)s=Cp(o,t[o],t[o+1],s);return s&&Pp(s,s.next)&&(kp(s),s=s.next),s}function Ap(t,n){if(!t)return t;n=n||t;var e,i=t;do{if(e=!1,i.steiner||!Pp(i,i.next)&&0!==Np(i.prev,i,i.next))i=i.next;else{if(kp(i),(i=n=i.prev)===i.next)break;e=!0}}while(e||i!==n);return n}function Mp(t,n,e,i,r,o,s){if(t){if(!s&&o){for(var a=t,u=i,c=r,f=o,h=a;null===h.z&&(h.z=Lp(h.x,h.y,u,c,f)),h.prevZ=h.prev,h.nextZ=h.next,(h=h.next)!==a;);h.prevZ.nextZ=null,h.prevZ=null;var l,d,v,p,m,y,b,g,w=h,_=1;do{for(d=w,m=w=null,y=0;d;){for(y++,v=d,l=b=0;l<_&&(b++,v=v.nextZ);l++);for(g=_;0<b||0<g&&v;)0!==b&&(0===g||!v||d.z<=v.z)?(d=(p=d).nextZ,b--):(v=(p=v).nextZ,g--),m?m.nextZ=p:w=p,p.prevZ=m,m=p;d=v}}while(m.nextZ=null,_*=2,1<y)}for(var E,S,T=t;t.prev!==t.next;)if(E=t.prev,S=t.next,o?function(t,n,e,i){var r=t.prev,o=t,s=t.next;if(0<=Np(r,o,s))return;var a=(r.x<o.x?r.x<s.x?r:s:o.x<s.x?o:s).x,u=(r.y<o.y?r.y<s.y?r:s:o.y<s.y?o:s).y,c=(r.x>o.x?r.x>s.x?r:s:o.x>s.x?o:s).x,f=(r.y>o.y?r.y>s.y?r:s:o.y>s.y?o:s).y,h=Lp(a,u,n,e,i),l=Lp(c,f,n,e,i),d=t.prevZ,v=t.nextZ;for(;d&&d.z>=h&&v&&v.z<=l;){if(d!==t.prev&&d!==t.next&&Rp(r.x,r.y,o.x,o.y,s.x,s.y,d.x,d.y)&&0<=Np(d.prev,d,d.next))return;if(d=d.prevZ,v!==t.prev&&v!==t.next&&Rp(r.x,r.y,o.x,o.y,s.x,s.y,v.x,v.y)&&0<=Np(v.prev,v,v.next))return;v=v.nextZ}for(;d&&d.z>=h;){if(d!==t.prev&&d!==t.next&&Rp(r.x,r.y,o.x,o.y,s.x,s.y,d.x,d.y)&&0<=Np(d.prev,d,d.next))return;d=d.prevZ}for(;v&&v.z<=l;){if(v!==t.prev&&v!==t.next&&Rp(r.x,r.y,o.x,o.y,s.x,s.y,v.x,v.y)&&0<=Np(v.prev,v,v.next))return;v=v.nextZ}return 1}(t,i,r,o):function(t){var n=t.prev,e=t,i=t.next;if(0<=Np(n,e,i))return;var r=t.next.next;for(;r!==t.prev;){if(Rp(n.x,n.y,e.x,e.y,i.x,i.y,r.x,r.y)&&0<=Np(r.prev,r,r.next))return;r=r.next}return 1}(t))n.push(E.i/e),n.push(t.i/e),n.push(S.i/e),kp(t),t=S.next,T=S.next;else if((t=S)===T){s?1===s?Mp(t=function(t,n,e){var i=t;do{var r=i.prev,o=i.next.next}while(!Pp(r,o)&&jp(r,i,i.next,o)&&Fp(r,o)&&Fp(o,r)&&(n.push(r.i/e),n.push(i.i/e),n.push(o.i/e),kp(i),kp(i.next),i=t=o),i=i.next,i!==t);return i}(t,n,e),n,e,i,r,o,2):2===s&&function(t,n,e,i,r,o){var s=t;do{for(var a,u=s.next.next;u!==s.prev;){if(s.i!==u.i&&function(t,n){return t.next.i!==n.i&&t.prev.i!==n.i&&!function(t,n){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==n.i&&e.next.i!==n.i&&jp(e,e.next,t,n))return 1}while(e=e.next,e!==t);return}(t,n)&&Fp(t,n)&&Fp(n,t)&&function(t,n){var e=t,i=!1,r=(t.x+n.x)/2,o=(t.y+n.y)/2;for(;e.y>o!=e.next.y>o&&e.next.y!==e.y&&r<(e.next.x-e.x)*(o-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next,e!==t;);return i}(t,n)}(s,u))return a=Ip(s,u),s=Ap(s,s.next),a=Ap(a,a.next),Mp(s,n,e,i,r,o),Mp(a,n,e,i,r,o);u=u.next}}while(s=s.next,s!==t)}(t,n,e,i,r,o):Mp(Ap(t),n,e,i,r,o,1);break}}}function Op(t,n){return t.x-n.x}function Lp(t,n,e,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-e)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-i)*r)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function Rp(t,n,e,i,r,o,s,a){return 0<=(r-s)*(n-a)-(t-s)*(o-a)&&0<=(t-s)*(i-a)-(e-s)*(n-a)&&0<=(e-s)*(o-a)-(r-s)*(i-a)}function Np(t,n,e){return(n.y-t.y)*(e.x-n.x)-(n.x-t.x)*(e.y-n.y)}function Pp(t,n){return t.x===n.x&&t.y===n.y}function jp(t,n,e,i){return Pp(t,e)&&Pp(n,i)||Pp(t,i)&&Pp(e,n)||0<Np(t,n,e)!=0<Np(t,n,i)&&0<Np(e,i,t)!=0<Np(e,i,n)}function Fp(t,n){return Np(t.prev,t,t.next)<0?0<=Np(t,n,t.next)&&0<=Np(t,t.prev,n):Np(t,n,t.prev)<0||Np(t,t.next,n)<0}function Ip(t,n){var e=new Dp(t.i,t.x,t.y),i=new Dp(n.i,n.x,n.y),r=t.next,o=n.prev;return(t.next=n).prev=t,(e.next=r).prev=e,(i.next=e).prev=i,(o.next=i).prev=o,i}function Cp(t,n,e,i){t=new Dp(t,n,e);return i?(t.next=i.next,(t.prev=i).next.prev=t,i.next=t):(t.prev=t).next=t,t}function kp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Dp(t,n,e){this.i=t,this.x=n,this.y=e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Up={area:function(t){for(var n=t.length,e=0,i=n-1,r=0;r<n;i=r++)e+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*e},isClockWise:function(t){return Up.area(t)<0},triangulateShape:function(t,n){var e=[],i=[],r=[],o=(Bp(t),Gp(e,t),t.length);n.forEach(Bp);for(var s=0;s<n.length;s++)i.push(o),o+=n[s].length,Gp(e,n[s]);for(var a=Tp(e,i),s=0;s<a.length;s+=3)r.push(a.slice(s,s+3));return r}};function Bp(t){var n=t.length;2<n&&t[n-1].equals(t[0])&&t.pop()}function Gp(t,n){for(var e=0;e<n.length;e++)t.push(n[e].x),t.push(n[e].y)}function Hp(t){return(Hp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xp(t,n){rs.call(this),this.type="ShapeGeometry","object"===Hp(n)&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),n=n.curveSegments),this.parameters={shapes:t,curveSegments:n},this.fromBufferGeometry(new zp(t,n)),this.mergeVertices()}function zp(t,l){N.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:l},l=l||12;var d=[],v=[],p=[],m=[],n=0,y=0;if(!1===Array.isArray(t))i(t);else for(var e=0;e<t.length;e++)i(t[e]),this.addGroup(n,y,e),n+=y,y=0;function i(t){var n,e=v.length/3,t=t.extractPoints(l),i=t.shape,r=t.holes;for(!1===Up.isClockWise(i)&&(i=i.reverse()),s=0,a=r.length;s<a;s++)n=r[s],!0===Up.isClockWise(n)&&(r[s]=n.reverse());for(var o=Up.triangulateShape(i,r),s=0,a=r.length;s<a;s++)n=r[s],i=i.concat(n);for(s=0,a=i.length;s<a;s++){var u=i[s];v.push(u.x,u.y,0),p.push(0,0,1),m.push(u.x,u.y)}for(s=0,a=o.length;s<a;s++){var c=o[s],f=c[0]+e,h=c[1]+e,c=c[2]+e;d.push(f,h,c),y+=3}}this.setIndex(d),this.setAttribute("position",new E(v,3)),this.setAttribute("normal",new E(p,3)),this.setAttribute("uv",new E(m,2))}function Vp(t,n){rs.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:n},this.fromBufferGeometry(new Wp(t,n)),this.mergeVertices()}function Wp(t,Z){N.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:Z},t=Array.isArray(t)?t:[t];for(var q=this,K=[],J=[],n=0,e=t.length;n<e;n++)!function(C){var i=[],k=void 0!==Z.curveSegments?Z.curveSegments:12,l=void 0!==Z.steps?Z.steps:1,t=void 0!==Z.depth?Z.depth:100,e=void 0===Z.bevelEnabled||Z.bevelEnabled,n=void 0!==Z.bevelThickness?Z.bevelThickness:6,D=void 0!==Z.bevelSize?Z.bevelSize:n-2,U=void 0!==Z.bevelOffset?Z.bevelOffset:0,d=void 0!==Z.bevelSegments?Z.bevelSegments:3,r=Z.extrudePath,B=void 0!==Z.UVGenerator?Z.UVGenerator:Yp;void 0!==Z.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),t=Z.amount);var o,s,a,u,c,f,h,v,G=!1;r&&(o=r.getSpacedPoints(l),e=!(G=!0),s=r.computeFrenetFrames(l,!1),a=new xt,u=new xt,c=new xt);e||(U=D=n=d=0);var r=C.extractPoints(k),p=r.shape,m=r.holes;if(!Up.isClockWise(p))for(p=p.reverse(),h=0,v=m.length;h<v;h++)f=m[h],Up.isClockWise(f)&&(m[h]=f.reverse());var y=Up.triangulateShape(p,m),b=p;for(h=0,v=m.length;h<v;h++)f=m[h],p=p.concat(f);function g(t,n,e){return n||console.error("THREE.ExtrudeGeometry: vec does not exist"),n.clone().multiplyScalar(e).add(t)}var w,_,E,S,T,x,A=p.length,H=y.length;function X(t,n,e){var i=t.x-n.x,r=t.y-n.y,o=e.x-t.x,s=e.y-t.y,a=i*i+r*r;if(Math.abs(i*s-r*o)>Number.EPSILON){var u=Math.sqrt(a),c=Math.sqrt(o*o+s*s),f=n.x-r/u,n=n.y+i/u,u=((e.x-s/c-f)*s-(e.y+o/c-n)*o)/(i*s-r*o),e=(c=f+i*u-t.x)*c+(f=n+r*u-t.y)*f;if(e<=2)return new Mt(c,f);u=Math.sqrt(e/2)}else{n=!1;i>Number.EPSILON?o>Number.EPSILON&&(n=!0):i<-Number.EPSILON?o<-Number.EPSILON&&(n=!0):Math.sign(r)===Math.sign(s)&&(n=!0),u=n?(c=-r,f=i,Math.sqrt(a)):(c=i,f=r,Math.sqrt(a/2))}return new Mt(c/u,f/u)}for(var z=[],M=0,O=b.length,L=O-1,R=M+1;M<O;M++,L++,R++)L===O&&(L=0),R===O&&(R=0),z[M]=X(b[M],b[L],b[R]);var N,P,V=[],W=z.concat();for(h=0,v=m.length;h<v;h++){for(f=m[h],N=[],M=0,O=f.length,L=O-1,R=M+1;M<O;M++,L++,R++)L===O&&(L=0),R===O&&(R=0),N[M]=X(f[M],f[L],f[R]);V.push(N),W=W.concat(N)}for(w=0;w<d;w++){for(E=w/d,S=n*Math.cos(E*Math.PI/2),_=D*Math.sin(E*Math.PI/2)+U,M=0,O=b.length;M<O;M++)j((T=g(b[M],z[M],_)).x,T.y,-S);for(h=0,v=m.length;h<v;h++)for(f=m[h],N=V[h],M=0,O=f.length;M<O;M++)j((T=g(f[M],N[M],_)).x,T.y,-S)}for(_=D+U,M=0;M<A;M++)T=e?g(p[M],W[M],_):p[M],G?(u.copy(s.normals[0]).multiplyScalar(T.x),a.copy(s.binormals[0]).multiplyScalar(T.y),c.copy(o[0]).add(u).add(a),j(c.x,c.y,c.z)):j(T.x,T.y,0);for(P=1;P<=l;P++)for(M=0;M<A;M++)T=e?g(p[M],W[M],_):p[M],G?(u.copy(s.normals[P]).multiplyScalar(T.x),a.copy(s.binormals[P]).multiplyScalar(T.y),c.copy(o[P]).add(u).add(a),j(c.x,c.y,c.z)):j(T.x,T.y,t/l*P);for(w=d-1;0<=w;w--){for(E=w/d,S=n*Math.cos(E*Math.PI/2),_=D*Math.sin(E*Math.PI/2)+U,M=0,O=b.length;M<O;M++)j((T=g(b[M],z[M],_)).x,T.y,t+S);for(h=0,v=m.length;h<v;h++)for(f=m[h],N=V[h],M=0,O=f.length;M<O;M++)T=g(f[M],N[M],_),G?j(T.x,T.y+o[l-1].y,o[l-1].x+S):j(T.x,T.y,t+S)}function Y(t,n){var e,i;for(M=t.length;0<=--M;){(i=(e=M)-1)<0&&(i=t.length-1);for(var r=0,o=l+2*d,r=0;r<o;r++){var s=A*r,a=A*(r+1),u=(h=f=c=u=void 0,n+e+s),c=n+i+s,f=n+i+a,h=n+e+a;F(u),F(c),F(h),F(c),F(f),F(h),u=K.length/3,I((c=B.generateSideWallUV(q,K,u-6,u-3,u-2,u-1))[0]),I(c[1]),I(c[3]),I(c[1]),I(c[2]),I(c[3])}}}function j(t,n,e){i.push(t),i.push(n),i.push(e)}function Q(t,n,e){F(t),F(n),F(e);t=K.length/3,n=B.generateTopUV(q,K,t-3,t-2,t-1);I(n[0]),I(n[1]),I(n[2])}function F(t){K.push(i[3*t+0]),K.push(i[3*t+1]),K.push(i[3*t+2])}function I(t){J.push(t.x),J.push(t.y)}(function(){var t=K.length/3;if(e){var n=0*A;for(M=0;M<H;M++)Q((x=y[M])[2]+n,x[1]+n,x[0]+n);for(n=A*(l+2*d),M=0;M<H;M++)Q((x=y[M])[0]+n,x[1]+n,x[2]+n)}else{for(M=0;M<H;M++)Q((x=y[M])[2],x[1],x[0]);for(M=0;M<H;M++)Q((x=y[M])[0]+A*l,x[1]+A*l,x[2]+A*l)}q.addGroup(t,K.length/3-t,0)})(),function(){var t=K.length/3,n=0;for(Y(b,n),n+=b.length,h=0,v=m.length;h<v;h++)Y(f=m[h],n),n+=f.length;q.addGroup(t,K.length/3-t,1)}()}(t[n]);this.setAttribute("position",new E(K,3)),this.setAttribute("uv",new E(J,2)),this.computeVertexNormals()}(Xp.prototype=Object.create(rs.prototype)).constructor=Xp,(zp.prototype=Object.create(N.prototype)).constructor=zp,(Vp.prototype=Object.create(rs.prototype)).constructor=Vp,(Wp.prototype=Object.create(N.prototype)).constructor=Wp;var Yp={generateTopUV:function(t,n,e,i,r){var o=n[3*e],e=n[3*e+1],s=n[3*i],i=n[3*i+1],a=n[3*r],n=n[3*r+1];return[new Mt(o,e),new Mt(s,i),new Mt(a,n)]},generateSideWallUV:function(t,n,e,i,r,o){var s=n[3*e],a=n[3*e+1],e=n[3*e+2],u=n[3*i],c=n[3*i+1],i=n[3*i+2],f=n[3*r],h=n[3*r+1],r=n[3*r+2],l=n[3*o],d=n[3*o+1],n=n[3*o+2];return Math.abs(a-c)<.01?[new Mt(s,1-e),new Mt(u,1-i),new Mt(f,1-r),new Mt(l,1-n)]:[new Mt(a,1-e),new Mt(c,1-i),new Mt(h,1-r),new Mt(d,1-n)]}},Qp=new Mt;function Zp(t,n){this.min=void 0!==t?t:new Mt(1/0,1/0),this.max=void 0!==n?n:new Mt(-1/0,-1/0)}function qp(t){return(qp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Kp(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=qp(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=qp(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==qp(t)?t:String(t)}(i.key),i)}}Object.assign(Zp.prototype,{set:function(t,n){return this.min.copy(t),this.max.copy(n),this},setFromPoints:function(t){this.makeEmpty();for(var n=0,e=t.length;n<e;n++)this.expandByPoint(t[n]);return this},setFromCenterAndSize:function(t,n){n=Qp.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Mt),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Mt),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,n){return void 0===n&&(console.warn("THREE.Box2: .getParameter() target is now required"),n=new Mt),n.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,n){return void 0===n&&(console.warn("THREE.Box2: .clampPoint() target is now required"),n=new Mt),n.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return Qp.copy(t).clamp(this.min,this.max).sub(t).length()},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var Jp=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")}var n,e,i;return n=t,i=[{key:"findNearNthPowerOfTwo",value:function(t){t-=1;return(t=(t=(t=(t=(t|=t>>1)|t>>2)|t>>4)|t>>8)|t>>16)<0?1:1+t}},{key:"polygonArea",value:function(t){if(t.length<3)return 0;var n=t.length;if(t[0].x===t[n-1].x&&t[0].y===t[n-1].y&&--n,n<3)return 0;t[0].y,t[n-1].x,t[1].x;for(var e=1;e<n-1;++e)t[e].y,t[e-1].x,t[e+1].x;return.5*(t[n-1].y*(t[n-2].x-t[0].x))}},{key:"closedPoints",value:function(t){var n=t.length;return!(n<3||(t[0].x===t[n-1].x&&t[0].y===t[n-1].y||(t[n]={x:t[n-1].x,y:t[n-1].y}),0))}},{key:"IsRectCross",value:function(t,n,e,i){return Math.min(t.x,n.x)<=Math.max(e.x,i.x)&&Math.min(e.x,i.x)<=Math.max(t.x,n.x)&&Math.min(t.y,n.y)<=Math.max(e.y,i.y)&&Math.min(e.y,i.y)<=Math.max(t.y,n.y)}},{key:"IsLineSegmentCross",value:function(t,n,e,i){var r=t.x*(e.y-n.y)+n.x*(t.y-e.y)+e.x*(n.y-t.y),o=t.x*(i.y-n.y)+n.x*(t.y-i.y)+i.x*(n.y-t.y);return!(0<=(r^o)&&(0!=r||0!=o)||0<=((r=e.x*(t.y-i.y)+i.x*(e.y-t.y)+t.x*(i.y-e.y))^(o=e.x*(n.y-i.y)+i.x*(e.y-n.y)+n.x*(i.y-e.y)))&&(0!=r||0!=o))}},{key:"computerFocus",value:function(t,n,e,i){var r,o=(i.x-e.x)*(t.y-n.y)-(n.x-t.x)*(e.y-i.y),s=(t.y-e.y)*(n.x-t.x)*(i.x-e.x)+e.x*(i.y-e.y)*(n.x-t.x)-t.x*(n.y-t.y)*(i.x-e.x);return 0==o||(r=s/o,o=(t.x-n.x)*(i.y-e.y)-(n.y-t.y)*(e.x-i.x),s=n.y*(t.x-n.x)*(i.y-e.y)+(i.x-n.x)*(i.y-e.y)*(t.y-n.y)-i.y*(e.x-i.x)*(n.y-t.y),0==o)?null:{x:r,y:s/o}}},{key:"GetLineSegmentCrossPoint",value:function(t,n,e,i){return this.IsRectCross(t,n,e,i)?this.computerFocus(t,n,e,i):null}},{key:"IsPointInPolygon",value:function(t,n){for(var e=!1,i=0,r=t.length-1;i<t.length;r=i++)(t[i].y<=n.y&&n.y<t[r].y||t[r].y<=n.y&&n.y<t[i].y)&&n.x<(t[r].x-t[i].x)*(n.y-t[i].y)/(t[r].y-t[i].y)+t[i].x&&(e=!e);return e}},{key:"PointCmp",value:function(t,n,e){var i;return 0<=t.x&&n.x<0||(0===t.x&&0===n.x?t.y>n.y:(i=(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y))<0||!(0<i)&&(i=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y),(n.x-e.x)*(n.x-e.y)+(n.y-e.y)*(n.y-e.y)<i))}},{key:"ClockwiseSortPoints",value:function(t){for(var n={x:0,y:0},e=0,i=0,r=0;r<t.length;r++)e+=t[r].x,i+=t[r].y;n.x=e/t.length,n.y=i/t.length;for(var o=0;o<t.length-1;o++)for(var s,a=0;a<t.length-o-1;a++)this.PointCmp(t[a],t[a+1],n)&&(s=t[a],t[a]=t[a+1],t[a+1]=s)}},{key:"PolygonClip",value:function(t,n,e){if(t.length<3||n.length<3)return!1;for(var i=0;i<t.length;i++)for(var r=(i+1)%t.length,o=0;o<n.length;o++){var s=(o+1)%n.length,s=this.GetLineSegmentCrossPoint(t[i],t[r],n[o],n[s]);s&&e.push(s)}for(var a=0;a<t.length;a++)this.IsPointInPolygon(n,t[a])&&e.push(t[a]);for(var u=0;u<n.length;u++)this.IsPointInPolygon(t,n[u])&&e.push(n[u]);return!(e.length<=0||(this.ClockwiseSortPoints(e),0))}}],(e=null)&&Kp(n.prototype,e),i&&Kp(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}();function $p(t){return($p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tm(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=$p(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=$p(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==$p(t)?t:String(t)}(i.key),i)}}function nm(t,n,e){n=rm(n);var i=t,n=em()?Reflect.construct(n,e||[],rm(t).constructor):n.apply(t,e);if(n&&("object"===$p(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function em(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(em=function(){return!!t})()}function im(){return(im="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=rm(t)););return t}(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function rm(t){return(rm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function om(t,n){return(om=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var sm=function(){var t,n=i,e=bd;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(){var t;if(this instanceof i)return(t=nm(this,i)).ec={},t;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&om(n,e),n=i,(e=[{key:"resize",value:function(){im(rm(i.prototype),"resize",this).call(this),this.ec={}}}])&&tm(n.prototype,e),t&&tm(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}();function am(t){return(am="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function um(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=am(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=am(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==am(t)?t:String(t)}(i.key),i)}}function cm(t,n,e){return n&&um(t.prototype,n),e&&um(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}Bv=cm(function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")});Object.assign(Bv.prototype,{cs:function(t,n,e,i,r){r=void 0!==r?"?contentVersion=".concat(r):"";t=new vf({method:"GET",url:t+n+"/"+n+".theme"+r});return t.cs(function(t){e&&e(t)},function(t){i&&i(t===Ri.PATH_ERROR?Ri.THEME_ID_URL_ERROR:t)}),t}});var fm,hm=new Bv,Dv={NORMAL:1,INDOOR:2,OUTDOOR:4},lm=(Object.freeze(Dv),Dv),dm=new xt,vm=new xt,pm=new xt,mm=new Mt,ym=new Mt,bm=new At,gm=new xt,wm=new xt,_m=new xt,Em=new Mt,Sm=new Mt,Tm=new Mt;function xm(t){var n;a.call(this),this.type="Sprite",void 0===fm&&(fm=new N,n=new Nc(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5),fm.setIndex([0,1,2,0,2,3]),fm.setAttribute("position",new jc(n,3,0,!1)),fm.setAttribute("uv",new jc(n,2,3,!1))),this.geometry=fm,this.material=void 0!==t?t:new sl,this.center=new Mt(.5,.5)}function Am(t,n,e,i,r,o){mm.subVectors(t,e).addScalar(.5).multiply(i),void 0!==r?(ym.x=o*mm.x-r*mm.y,ym.y=r*mm.x+o*mm.y):ym.copy(mm),t.copy(n),t.x+=ym.x,t.y+=ym.y,t.applyMatrix4(bm)}function Mm(t){return(Mm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Om(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Mm(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Mm(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Mm(t)?t:String(t)}(i.key),i)}}xm.prototype=Object.assign(Object.create(a.prototype),{constructor:xm,isSprite:!0,raycast:function(t,n){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),vm.setFromMatrixScale(this.matrixWorld),bm.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),pm.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&vm.multiplyScalar(-pm.z);var e,i,r=this.material.rotation,r=(0!==r&&(i=Math.cos(r),e=Math.sin(r)),this.center);Am(gm.set(-.5,-.5,0),pm,r,vm,e,i),Am(wm.set(.5,-.5,0),pm,r,vm,e,i),Am(_m.set(.5,.5,0),pm,r,vm,e,i),Em.set(0,0),Sm.set(1,0),Tm.set(1,1),null===t.ray.intersectTriangle(gm,wm,_m,!1,dm)&&(Am(wm.set(-.5,.5,0),pm,r,vm,e,i),Sm.set(0,1),null===t.ray.intersectTriangle(gm,_m,wm,!1,dm))||(r=t.ray.origin.distanceTo(dm))<t.near||r>t.far||n.push({distance:r,point:dm.clone(),uv:$s.getUV(dm,gm,wm,_m,Em,Sm,Tm,new Mt),face:null,object:this})},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return a.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}});var Uv=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.Af=t,this.Qi=!0,this.Mf=new Map,this.Of={x:1,y:1,z:1},this.Lf=!0,this.Ue=null}var t,e,i;return t=n,(e=[{key:"visible",get:function(){return this.Qi},set:function(t){this.Qi=t,this.Mf.forEach(function(t){t.Rf()})}},{key:"show",get:function(){return this.Lf},set:function(t){t!==this.Lf&&(this.Lf=t,this.Nf({opacity:t?1:0,duration:1,finish:function(){}}))}},{key:"setFacadeNode",value:function(t){var n=t.FID;t.type===S.LABEL&&(n="label"+t.FID),this.Mf.set(n,t)}}])&&Om(t.prototype,e),i&&Om(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}(),Lm=(Object.assign(Uv.prototype,{wc:function(t){var n;this.Lf=!this.Af.parent.fi.qo(this.Af),this.Af.Pf===lm.NORMAL&&(this.Af.jf(),n=this.Af.parent.Ft.Xi(this.Af.je),this.Of.z=n.isZoomLimit?.2:1),t.xi&&(t.Fe===S.EXTERNAL_MODEL?(t.xi.scale.x=this.Of.x,t.xi.scale.y=this.Of.z,t.xi.scale.z=this.Of.y):t.Fe===S.MODEL&&(t.xi.scale.x=this.Of.x,t.xi.scale.y=this.Of.y,t.xi.scale.z=this.Of.z)),this.Nf({opacity:this.Lf?1:0,duration:1,finish:function(){}})},Ff:function(a,t){var u;t.scale.z===this.Of.z&&t.scale.y===this.Of.y||(u=void 0!==t.duration?t.duration:.5,this.Of=t.scale,this.Mf.forEach(function(n){var e,i,r,o,s;n.Fe!==S.MODEL&&n.Fe!==S.EXTERNAL_MODEL||n.xi&&(e=n.xi.scale.x,i=n.xi.scale.y,r=n.xi.scale.z,o={x:t.scale.x-e,y:t.scale.z-i,z:t.scale.y-r},n.Fe===S.MODEL&&(o={x:t.scale.x-e,y:t.scale.y-i,z:t.scale.z-r}),(s=new Wi({src:[0],dest:[1]})).sn(u).un(function(t){t=t.destination[0];n.xi?(n.xi.scale.x=o.x*t+e,n.xi.scale.y=o.y*t+i,n.xi.scale.z=o.z*t+r,a.enableUpdateRender()):a.Oi.ji(s)}).cn(function(){a.Oi.ji(s),t.finish&&t.finish()}),a.Oi.Ti(s.tn()))}))},Nf:function(i){var n=this,r=(this.Ue?this.Ue.finish():this.Ue=new Wi,this.visible=!0,this.Af.parent),o=[];if(this.Mf.forEach(function(e){e.xi&&e.xi.traverse(function(t){var n;t.constructor===ba&&(e.Fe===S.MODEL&&(n=t.material.clone(),t.material.dispose(),t.material=n),n=t.material,Array.isArray(n)||(n=[n]),e.If&&n.push(e.If.material),n.forEach(function(t){"FMMeshStandardMaterial"===t.type?o.push({material:t,offset:i.opacity-t.uniforms.opacity.value,opacity:t.uniforms.opacity.value}):o.push({material:t,offset:i.opacity-t.opacity,opacity:t.opacity})}))})}),this.Ue.en([0]).rn([1]).sn(i.duration).un(function(t){for(var n=t.destination[0],e=0;e<o.length;e++)"FMMeshStandardMaterial"===o[e].material.type?o[e].material.uniforms.opacity.value=o[e].offset*n+o[e].opacity:o[e].material.opacity=o[e].offset*n+o[e].opacity,o[e].material.transparent=!0,o[e].needsUpdate=!0;r.enableUpdateRender()}).cn(function(){n.visible=n.Lf;for(var t=0;t<o.length;t++)"FMMeshStandardMaterial"===o[t].material.type?o[t].material.uniforms.opacity.value=o[t].opacity:o[t].material.opacity=o[t].opacity,o[t].needsUpdate=!0;r.Oi.ji(n.Ue),i.finish&&i.finish(),r.enableUpdateRender()}).play(),r.Oi.Ti(this.Ue),0===i.duration){this.Ue.finish();for(var t=0;t<o.length;t++)"FMMeshStandardMaterial"===o[t].material.type?o[t].material.uniforms.opacity.value=i.opacity:o[t].material.opacity=i.opacity,o[t].needsUpdate=!0,r.enableUpdateRender()}}}),Uv);function Rm(t){return(Rm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Nm(t,n){var e,i,r,o,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return i=!(e=!0),{s:function(){s=s.call(t)},n:function(){var t=s.next();return e=t.done,t},e:function(t){i=!0,r=t},f:function(){try{e||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(t)||(s=function(t,n){var e;if(t)return"string"==typeof t?Pm(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Pm(t,n):void 0}(t))||n&&t&&"number"==typeof t.length)return s&&(t=s),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Pm(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function jm(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Rm(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Rm(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Rm(t)?t:String(t)}(i.key),i)}}function Fm(t,n,e){n=Dm(n);var i=t,n=Im()?Reflect.construct(n,e||[],Dm(t).constructor):n.apply(t,e);if(n&&("object"===Rm(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return Cm(i)}function Im(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Im=function(){return!!t})()}function Cm(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function km(){return(km="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=Dm(t)););return t}(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function Dm(t){return(Dm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Um(t,n){return(Um=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var n=function(){var t,n=i,e=Go;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(this instanceof i)return(n=Fm(this,i,[t])).Cf=t.minlevel,n.kf=t.maxlevel,n.Df=t.levelChart,n.Uf=t.fids,n.Pf=lm.NORMAL,n.Bf=new Lm(Cm(n)),n.Gf=!1,n.Hf=new Map,n.Xf=!0,n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Um(n,e),n=i,(e=[{key:"zoomRange",get:function(){return{minLevel:this.Cf,maxLevel:this.kf}}},{key:"alignHeight",get:function(){return this.Xf&&(this.zf(),this.Xf=!1),this.Hf}},{key:"overviewMode",get:function(){return this.Pf}},{key:"visible",get:function(){return this.Qi},set:function(t){this.Qi=t,this.Ht.fi.Vf(this),this.Ht.enableUpdateNode()}},{key:"levelChart",get:function(){return this.Df}},{key:"setTheme",value:function(t){this.Ht.fi.Wf({themeID:t,bid:this.je})}},{key:"setThemeExtension",value:function(t){this.Ht.fi.Yf({data:t,bid:this.je})}},{key:"clearThemeExtension",value:function(){this.Ht.fi.Yf({bid:this.je})}},{key:"getFadeFeatures",value:function(){var t,n=[],e=Nm(this.Bf.Mf.values());try{for(e.s();!(t=e.n()).done;){var i=t.value;n.push(i)}}catch(t){e.e(t)}finally{e.f()}return n}},{key:"dispose",value:function(){km(Dm(i.prototype),"dispose",this).call(this)}}])&&jm(n.prototype,e),t&&jm(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),Bm=(Object.assign(n.prototype,{Ti:function(t){(t.Ht=this).It.push(t)},jf:function(){var t,n=this.parent.Ft.Xi(this.je);this.Pf===lm.OUTDOOR?n.isZoomLimit=!1:(t=this.parent.getZoom(),n.isZoomLimit=!(t<this.Cf||t>=this.kf))},Qf:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=(this.jf(),this.parent.Ft.Xi(this.je));this.Bf.Ff(this.parent,{scale:{x:1,y:1,z:n.isZoomLimit?.2:1},duration:void 0!==t.duration?t.duration:1,finish:function(){}})},zf:function(){if(this.Ht)for(var t=this.Ht.kt,n=0;n<this.Df.length;n+=2){var e=t.floorSpace*this.Df[n];this.Hf.set(this.Df[n+1],e)}},Zf:function(t){if(void 0===this.level||null===this.level)for(var n,e=0;e<this.Df.length;e+=2)this.Df[e]===t&&((n=this.parent.Ft.Xi(this.je)).level=this.Df[e+1],n.visibleLevels=[this.Df[e+1]])}}),n);function Gm(t,n){return Object.assign({},n.Ve,{buildingID:t.Ji,level:t.level,visibleLevels:t.visibleLevels,bid:t.je})}var Bv={NAME:2,ENAME:4,FID:8},Hm=(Object.freeze(Bv),Bv);function Xm(t){return(Xm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zm(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Qm(i.key),i)}}function Vm(t,n,e){n=Km(n);var i=t,n=Wm()?Reflect.construct(n,e||[],Km(t).constructor):n.apply(t,e);if(n&&("object"===Xm(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function Wm(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Wm=function(){return!!t})()}function Ym(t,n,e,i){return(Ym="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,n,e,i){var r,t=qm(t,n);if(t){if((r=Object.getOwnPropertyDescriptor(t,n)).set)return r.set.call(i,e),!0;if(!r.writable)return!1}if(r=Object.getOwnPropertyDescriptor(i,n)){if(!r.writable)return!1;r.value=e,Object.defineProperty(i,n,r)}else t=i,r=e,!((i=Qm(i=n))in t?Object.defineProperty(t,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[i]=r);return!0})(t,n,e,i)}function Qm(t){t=function(t,n){if("object"!=Xm(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Xm(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Xm(t)?t:String(t)}function Zm(){return(Zm="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=qm(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function qm(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=Km(t)););return t}function Km(t){return(Km=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Jm(t,n){return(Jm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Dv=function(){var t,n=r,e=Go;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function r(t){var n;if(this instanceof r)return(n=Vm(this,r,[t])).nt=t.height,n.rr=t.bounds,n.qf=t.zoom,n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Jm(n,e),n=r,(e=[{key:"height",get:function(){return this.nt}},{key:"floorSpace",get:function(){return Zm(Km(r.prototype),"floorSpace",this)},set:function(t){var n=this,e=Km(r.prototype),i=!0;if(!Ym(e,"floorSpace",t,this||e)&&i)throw new TypeError("failed to set property");this.Ht.traverse(function(t){t!==n&&(t.Xf=!0,t.traverse(function(t){t.sr({animate:!1})}))}),this.Ht.Nt.Yi(this,{level:this.level,animate:!1,finish:function(){n.parent.Dt.Ei(),n.parent.Dt.zi(),n.parent.Dt.render()}})}},{key:"getFloors",value:function(){return this.It}}])&&zm(n.prototype,e),t&&zm(n,t),Object.defineProperty(n,"prototype",{writable:!1}),r}(),$m=(Object.assign(Dv.prototype,{Ti:function(t){(t.Ht=this).It.push(t)}}),Dv);function ty(t){return(ty="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ny(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=ty(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=ty(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==ty(t)?t:String(t)}(i.key),i)}}var ey=function(){function o(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=this,r=o;if(!(i instanceof r))throw new TypeError("Cannot call a class as a function");Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=n,this.z=e}var t,n,e;return t=o,(n=[{key:"set",value:function(t,n,e){return void 0===e&&(e=this.z),this.x=t,this.y=n,this.z=e,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"sub",value:function(t,n){return void 0!==n?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,n)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}},{key:"subVectors",value:function(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this.z=t.z-n.z,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"cross",value:function(t,n){return void 0!==n?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,n)):this.crossVectors(this,t)}},{key:"crossVectors",value:function(t,n){var e=t.x,i=t.y,t=t.z,r=n.x,o=n.y,n=n.z;return this.x=i*n-t*o,this.y=t*r-e*n,this.z=e*o-i*r,this}},{key:"angleTo",value:function(t){var n=Math.sqrt(this.lengthSq()*t.lengthSq());return 0===n?Math.PI/2:(t=this.dot(t)/n,n=Math.max(-1,Math.min(1,t)),Math.acos(n))}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}}])&&ny(t.prototype,n),e&&ny(t,e),Object.defineProperty(t,"prototype",{writable:!1}),o}();function iy(t){return(iy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ry(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=iy(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=iy(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==iy(t)?t:String(t)}(i.key),i)}}var oy=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.Fo=t.size,this.Re=t.center,this.Kf=t.points}var t,e,i;return t=n,(e=[{key:"size",get:function(){return this.Fo}},{key:"min",get:function(){return{x:this.Re.x-this.Fo.x/2,y:this.Re.y-this.Fo.y/2}}},{key:"max",get:function(){return{x:this.Re.x+this.Fo.x/2,y:this.Re.y+this.Fo.y/2}}},{key:"center",get:function(){return{x:this.Re.x,y:this.Re.y}}},{key:"points",get:function(){return this.Kf}}])&&ry(t.prototype,e),i&&ry(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}();function sy(t){return(sy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ay(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=sy(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=sy(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==sy(t)?t:String(t)}(i.key),i)}}var uy=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")}var n,e,i;return n=t,i=[{key:"distance",value:function(t,n){return W.distance(t,n)}},{key:"isContain",value:function(t,n){return W.isPolygonContainPoint(t,n)}},{key:"bound",value:function(t){for(var n=-Number.MAX_VALUE,e=-Number.MAX_VALUE,i=Number.MAX_VALUE,r=Number.MAX_VALUE,o=0;o<t.length;o++)t[o].x>n&&(n=t[o].x),t[o].y>e&&(e=t[o].y),t[o].x<i&&(i=t[o].x),t[o].y<r&&(r=t[o].y);return{max:{x:n,y:e},min:{x:i,y:r},size:{x:n-i,y:e-r},center:{x:(n+i)/2,y:(e+r)/2}}}},{key:"orientedBound",value:function(t){var n={center:{x:0,y:0},size:{x:0,y:0},rotation:{x:0,y:0},corners:[]};if(t&&0!=t.length){for(var e=Xi.cov(t),i=Xi.eig(e).eigVect,r=[],o=Number.MAX_VALUE,s=Number.MAX_VALUE,a=-Number.MAX_VALUE,u=-Number.MAX_VALUE,c=0;c<t.length;c++){var f=t[c].x*i[0][0]+t[c].y*i[0][1],h=t[c].x*i[1][0]+t[c].y*i[1][1];f<o&&(o=f),h<s&&(s=h),a<f&&(a=f),u<h&&(u=h),r.push([f,h])}var e=[(a+o)/2,(u+s)/2],l=i[0][0]*i[1][1]-i[1][0]*i[0][1],l=[[i[1][1]/l,-i[0][1]/l],[-i[1][0]/l,i[0][0]/l]],e=[l[0][0]*e[0]+l[0][1]*e[1],l[1][0]*e[0]+l[1][1]*e[1]],e=(n.center.x=e[0],n.center.y=e[1],n.size.x=a-o,n.size.y=u-s,[[o,s],[o,u],[a,u],[a,s]]),d=[[],[],[],[]],l=(d[0]=[l[0][0]*e[0][0]+l[0][1]*e[0][1],l[1][0]*e[0][0]+l[1][1]*e[0][1]],d[1]=[l[0][0]*e[1][0]+l[0][1]*e[1][1],l[1][0]*e[1][0]+l[1][1]*e[1][1]],d[2]=[l[0][0]*e[2][0]+l[0][1]*e[2][1],l[1][0]*e[2][0]+l[1][1]*e[2][1]],d[3]=[l[0][0]*e[3][0]+l[0][1]*e[3][1],l[1][0]*e[3][0]+l[1][1]*e[3][1]],new ey(1,0,0)),e=new ey(d[0][0],0,d[0][1]),e=new ey(d[3][0],0,d[3][1]).clone().sub(e).normalize(),v=e.angleTo(l)*W.An(),e=0<e.clone().cross(l).y?v:360-v,v=new ey(d[0][0],0,d[0][1]),v=new ey(d[1][0],0,d[1][1]).clone().sub(v).normalize(),p=v.angleTo(l)*W.An(),v=0<v.clone().cross(l).y;return n.rotation={x:e,y:v?p:360-p},n.corners=[{x:d[0][0],y:d[0][1]},{x:d[1][0],y:d[1][1]},{x:d[2][0],y:d[2][1]},{x:d[3][0],y:d[3][1]}],n}}},{key:"scaleBound",value:function(t,n){var e=t.max,t=t.min,e=new Mt(e.x,e.y),t=new Mt(t.x,t.y),i=e.clone().add(t).multiplyScalar(.5),e=e.clone().sub(t),t=e.clone().normalize(),e=e.clone().length()*n,n=i.clone().add(t.clone().multiplyScalar(e/2)),i=i.clone().add(t.clone().multiplyScalar(-e/2)),t=n.x,e=n.y,n=i.x,i=i.y;return{max:{x:t,y:e},min:{x:n,y:i},size:{x:Math.abs(t-n),y:Math.abs(e-i)},center:{x:(t+n)/2,y:(e+i)/2}}}},{key:"rectangleBuilder",value:function(t,n,e){var i=[];return i.push({x:e.x-t/2,y:e.y+n/2}),i.push({x:e.x+t/2,y:e.y+n/2}),i.push({x:e.x+t/2,y:e.y-n/2}),i.push({x:e.x-t/2,y:e.y-n/2}),i}},{key:"circleBuilder",value:function(t,n,e){for(var i=[],r=0;r<=e;r++){var o=r/e*Math.PI*2;i.push({x:n.x+t*Math.cos(o),y:n.y+t*Math.sin(o)})}return i}},{key:"fanBuilder",value:function(t,n,e,i){for(var r=[],o=(r.push(n),[i[0]/180*Math.PI,i[1]/180*Math.PI]),s=(o[1]-o[0])/e,a=0;a<=e;a++){var u=o[0]+a*s;r.push({x:n.x+t*Math.sin(u),y:n.y+t*Math.cos(u)})}return r}},{key:"area",value:function(t){return W.Yn(t,t.length)}},{key:"TriangleCentroid",value:function(t,n,e,i){var r=n.x-t.x,o=n.y-t.y,s=e.x-t.x,a=e.y-t.y;return i.area=(r*a-s*o)/2,i.centroid={},i.centroid.x=(t.x+n.x+e.x)/3,i.centroid.y=(t.y+n.y+e.y)/3,!0}},{key:"calculatorInsideCentroid",value:function(t,n){var e=t.length;if(e<3)return!1;for(var i=[],r=1;r<e-1;r++){var o={};this.TriangleCentroid(t[0],t[r],t[r+1],o),i.push(o)}var s=[],a=(i.forEach(function(t,n,e){s.push(t)}),!1);s.sort(function(t,n){return(0<t.area?t.area:-t.area)-(0<n.area?n.area:-n.area)});for(;0<s.length&&!(a=this.calculatorCentroid(t,s,n));)s.shift();if(!a){var u=[];i.forEach(function(t,n,e){u.push(t)});for(;0<u.length&&!(a=this.calculatorCentroid(t,u,n));)u.shift()}return a}},{key:"calculatorCentroid",value:function(t,n,e){for(var i=0,r={x:0,y:0},o=0;o<n.length;o++)r.x+=n[o].centroid.x*n[o].area,r.y+=n[o].centroid.y*n[o].area,i+=n[o].area;return e.x=r.x/i,e.y=r.y/i,this.isContain(t,e)}},{key:"latlngToMapCoordinate",value:function(t){return{x:20037508.34*parseFloat(t.x)/180,y:Math.log(Math.tan((90+parseFloat(t.y))*Math.PI/360))/(Math.PI/180)*20037508.34/180}}},{key:"mapCoordinateToLatlng",value:function(t){var n=parseFloat(t.y)/20037508.34*180;return{x:parseFloat(t.x)/20037508.34*180,y:180/Math.PI*(2*Math.atan(Math.exp(n*Math.PI/180))-Math.PI/2)}}},{key:"maxInnerRect",value:function(t,C){if(t&&0!=t.length){for(var n=new ey(0,0,1),e={center:{x:0,y:0},size:{x:0,y:0},rotation:{x:0,y:0},corners:[]},i=Number.MAX_VALUE,r=Number.MAX_VALUE,o=-Number.MAX_VALUE,s=-Number.MAX_VALUE,a=[],u=0;u<t.length;u++){var c=t[u].x,f=t[u].y;c<i&&(i=c),f<r&&(r=f),o<c&&(o=c),s<f&&(s=f),a.push({x:c,y:f})}for(var h=(o-i<s-r?o-i:s-r)/100,l=Math.ceil((o-i)/h),d=Math.ceil((s-r)/h),v=[],p=0;p<d-1;p++){for(var m=new Array(l-1).fill(0),y=0;y<l-1;y++){var b=i+h*y,g=i+h*(y+1),w=r+h*p,_=r+h*(p+1);W.isPolygonInPolygon([{x:b,y:w},{x:b,y:_},{x:g,y:_},{x:g,y:w}],a)&&(m[y]=1)}v.push(m)}for(var E=new Array(l).fill(0),k=0,D=0,U=0,B=0,G=0,S=0;S<d-1;S++)for(var T=[],x=0;x<l;x++){for(E[l-1]=0,x<l-1&&(E[x]=1==v[S][x]?E[x]+1:0);0<T.length&&E[T[T.length-1]]>=E[x];){var H=T[T.length-1],X=(T.pop(),E[H]*(0==T.length?x:x-T[T.length-1]-1));k<X&&(k=X,D=0==T.length?0:T[T.length-1]+1,U=x,G=(B=S)-E[H]+1)}T.push(x)}for(var A=i+D*h,M=r+(B+1)*h,O=i+(U+1)*h,L=r+G*h,R=[[A,L],[A,M],[O,M],[O,L]],N=0,P=2,z=Number.MAX_VALUE,V=-Number.MAX_VALUE,j=0;j<R.length;j++)R[j][0]*R[j][0]+R[j][1]*R[j][1]<z&&(z=R[N=j][0]*R[j][0]+R[j][1]*R[j][1]),R[j][0]*R[j][0]+R[j][1]*R[j][1]>V&&(V=R[P=j][0]*R[j][0]+R[j][1]*R[j][1]);e.corners=[{x:R[0][0],y:R[0][1]},{x:R[1][0],y:R[1][1]},{x:R[2][0],y:R[2][1]},{x:R[3][0],y:R[3][1]}],e.center.x=(R[P][0]+R[N][0])/2,e.center.y=(R[P][1]+R[N][1])/2;var A=new ey(R[N][0],0,R[N][1]),M=new ey(R[(N+P)/2][0],0,R[(N+P)/2][1]),O=M.clone().sub(A).normalize(),L=(O.angleTo(n),W.An(),O.clone().cross(n).y,new ey(R[(N+P)/2][0],0,R[(N+P)/2][1])),F=new ey(R[P][0],0,R[P][1]),I=F.clone().sub(L).normalize();I.angleTo(n),W.An();I.clone().cross(n).y;return O.clone().cross(I).y<0?(e.size.x=M.clone().sub(A).length(),e.size.y=F.clone().sub(L).length()):(e.size.x=F.clone().sub(L).length(),e.size.y=M.clone().sub(A).length()),new oy({center:e.center,size:e.size,points:e.corners})}}}],(e=null)&&ay(n.prototype,e),i&&ay(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}();function cy(t){return(cy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fy(){fy=function(){return s};var u,s={},t=Object.prototype,c=t.hasOwnProperty,f=Object.defineProperty||function(t,n,e){t[n]=e.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",e=n.asyncIterator||"@@asyncIterator",r=n.toStringTag||"@@toStringTag";function o(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{o({},"")}catch(u){o=function(t,n,e){return t[n]=e}}function a(t,n,e,i){var r,o,s,a,n=n&&n.prototype instanceof y?n:y,n=Object.create(n.prototype),i=new A(i||[]);return f(n,"_invoke",{value:(r=t,o=e,s=i,a=l,function(t,n){if(a===v)throw new Error("Generator is already running");if(a===p){if("throw"===t)throw n;return{value:u,done:!0}}for(s.method=t,s.arg=n;;){var e=s.delegate;if(e){e=function t(n,e){var i=e.method,r=n.iterator[i];if(r===u)return e.delegate=null,"throw"===i&&n.iterator.return&&(e.method="return",e.arg=u,t(n,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),m;i=h(r,n.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,m;r=i.arg;return r?r.done?(e[n.resultName]=r.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=u),e.delegate=null,m):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}(e,s);if(e){if(e===m)continue;return e}}if("next"===s.method)s.sent=s.Mt=s.arg;else if("throw"===s.method){if(a===l)throw a=p,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);a=v;e=h(r,o,s);if("normal"===e.type){if(a=s.done?p:d,e.arg===m)continue;return{value:e.arg,done:s.done}}"throw"===e.type&&(a=p,s.method="throw",s.arg=e.arg)}})}),n}function h(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}s.wrap=a;var l="suspendedStart",d="suspendedYield",v="executing",p="completed",m={};function y(){}function b(){}function g(){}var n={},w=(o(n,i,function(){return this}),Object.getPrototypeOf),w=w&&w(w(M([]))),_=(w&&w!==t&&c.call(w,i)&&(n=w),g.prototype=y.prototype=Object.create(n));function E(t){["next","throw","return"].forEach(function(n){o(t,n,function(t){return this._invoke(n,t)})})}function S(s,a){var n;f(this,"_invoke",{value:function(e,i){function t(){return new a(function(t,n){!function n(t,e,i,r){var o,t=h(s[t],s,e);if("throw"!==t.type)return(e=(o=t.arg).value)&&"object"==cy(e)&&c.call(e,"__await")?a.resolve(e.Ot).then(function(t){n("next",t,i,r)},function(t){n("throw",t,i,r)}):a.resolve(e).then(function(t){o.value=t,i(o)},function(t){return n("throw",t,i,r)});r(t.arg)}(e,i,t,n)})}return n=n?n.then(t,t):t()}})}function T(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function x(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function M(n){if(n||""===n){var e,t=n[i];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return e=-1,(t=function t(){for(;++e<n.length;)if(c.call(n,e))return t.value=n[e],t.done=!1,t;return t.value=u,t.done=!0,t}).next=t}throw new TypeError(cy(n)+" is not iterable")}return f(_,"constructor",{value:b.prototype=g,configurable:!0}),f(g,"constructor",{value:b,configurable:!0}),b.displayName=o(g,r,"GeneratorFunction"),s.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},s.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,o(t,r,"GeneratorFunction")),t.prototype=Object.create(_),t},s.awrap=function(t){return{Ot:t}},E(S.prototype),o(S.prototype,e,function(){return this}),s.AsyncIterator=S,s.async=function(t,n,e,i,r){void 0===r&&(r=Promise);var o=new S(a(t,n,e,i),r);return s.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},E(_),o(_,r,"Generator"),o(_,i,function(){return this}),o(_,"toString",function(){return"[object Generator]"}),s.keys=function(t){var n,e=Object(t),i=[];for(n in e)i.push(n);return i.reverse(),function t(){for(;i.length;){var n=i.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},s.values=M,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this.Mt=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(x),!t)for(var n in this)"t"===n.charAt(0)&&c.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=u)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function t(t,n){return o.type="throw",o.arg=e,i.next=t,n&&(i.method="next",i.arg=u),!!n}for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var s=c.call(r,"catchLoc"),a=c.call(r,"finallyLoc");if(s&&a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var o=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=n&&n<=r.finallyLoc?null:r)?r.completion:{};return o.type=t,o.arg=n,r?(this.method="next",this.next=r.finallyLoc,m):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),m},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),x(e),m}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e,i,r=this.tryEntries[n];if(r.tryLoc===t)return"throw"===(e=r.completion).type&&(i=e.arg,x(r)),i}throw new Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:M(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=u),m}},s}function hy(t,n,e,i,r,o,s){try{var a=t[o](s),u=a.value}catch(t){return void e(t)}a.done?n(u):Promise.resolve(u).then(i,r)}function ly(n,t){var e,i=void 0!==(t=t||{}).duration?t.duration:1,r=void 0!==t.size?t.size:8,o=t.times||void 0,s=void 0!==t.delay?t.delay:0,a=1,u=n.qi(g);if(u)return n.Ue.has("boost")?((e=n.Ue.get("boost")).stop(),u.Oi.ji(e)):(e=new Wi({src:[n.Fo],dest:[r]}),n.Ue.set("boost",e)),e.sn(i).tn().un(function(t){n.xi&&u.Dt.jo(n.xi,t.destination[0]),u.enableUpdateRender()}).cn(function(){var t;o<a||(t=0<a%1?0:s,e.vn().an(t).tn(),u.enableUpdateRender(),a+=.5)}),u.Oi.Ti(e),e}function dy(t){var n=t.qi(g),e=t.Ue.get("boost");e&&n&&(n.Oi.ji(e),t.Ue.delete("boost"),t.xi&&n.Dt.jo(t.xi,t.Fo),n.enableUpdateRender())}function vy(n,t){var e,i,r,o,s,a=n.qi(g);if(a)return e=void 0!==t.duration?t.duration:1,i=void 0!==t.times?t.times:1/0,r=void 0!==t.delay?t.delay:0,0===i&&(i=1/0),o=0,n.Ue.has("jump")?((s=n.Ue.get("jump")).en([n.nt]),s.rn([n.nt+t.height])):(s=new Wi({src:[n.nt],dest:[n.nt+t.height]}),n.Ue.set("jump",s),a.Oi.Ti(s)),s.sn(e).an(0).un(function(t){n.xi&&(n.xi.position.y=t.destination[0]),a.enableUpdateRender()}).cn(function(){var t;(o+=.5)<i&&(t=o%1==0?0:r,s.vn().an(t),s.tn())}),s.tn(),s}function py(t){var n,e;t.xi&&(n=t.qi(g))&&((e=t.Ue.get("jump"))&&(n.Oi.ji(e),t.Ue.delete("jump")),t.xi.position.y=t.nt,n.enableUpdateRender())}function my(t,n){var e;n.xi&&(t=t.Jf(n.size||n.Fo),e=1,n.xi.material.userData.scaleRatio&&(e=n.xi.material.userData.scaleRatio),n.xi.scale.set(t,t/e,t))}function yy(n){return!0===n.needUpdateBound&&(n.xe.reset(),n.It.forEach(function(t){n.xe.expand(t.bound)}),n.needUpdateBound=!1),n.xe.clone()}function by(t){return(by="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gy(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Sy(i.key),i)}}function wy(t,n,e){n=Ay(n);var i=t,n=_y()?Reflect.construct(n,e||[],Ay(t).constructor):n.apply(t,e);if(n&&("object"===by(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _y(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_y=function(){return!!t})()}function Ey(t,n,e,i){return(Ey="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,n,e,i){var r,t=xy(t,n);if(t){if((r=Object.getOwnPropertyDescriptor(t,n)).set)return r.set.call(i,e),!0;if(!r.writable)return!1}if(r=Object.getOwnPropertyDescriptor(i,n)){if(!r.writable)return!1;r.value=e,Object.defineProperty(i,n,r)}else t=i,r=e,!((i=Sy(i=n))in t?Object.defineProperty(t,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[i]=r);return!0})(t,n,e,i)}function Sy(t){t=function(t,n){if("object"!=by(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=by(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==by(t)?t:String(t)}function Ty(){return(Ty="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=xy(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function xy(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=Ay(t)););return t}function Ay(t){return(Ay=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function My(t,n){return(My=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Oy=function(){var t,n=r,e=Fo;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function r(){var t;if(this instanceof r)return(t=wy(this,r)).xo=new qo,t;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&My(n,e),n=r,(e=[{key:"scene",get:function(){return this.xo}},{key:"bound",get:function(){return yy(this)}},{key:"isLayer",get:function(){return!0}},{key:"visible",get:function(){return Ty(Ay(r.prototype),"visible",this)},set:function(t){var n=Ay(r.prototype),e=t,i=!0;if(!Ey(n,"visible",e,this||n)&&i)throw new TypeError("failed to set property");t?this.xo.parent||this.parent.effectScene.add(this.xo):this.xo.parent&&this.parent.effectScene.remove(this.xo)}},{key:"init",value:function(){this.xo.position.y=this.parent.nt}}])&&gy(n.prototype,e),t&&gy(n,t),Object.defineProperty(n,"prototype",{writable:!1}),r}();function Ly(t){return(Ly="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ry(t,n){var e,i,r,o,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return i=!(e=!0),{s:function(){s=s.call(t)},n:function(){var t=s.next();return e=t.done,t},e:function(t){i=!0,r=t},f:function(){try{e||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(t)||(s=function(t,n){var e;if(t)return"string"==typeof t?Ny(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Ny(t,n):void 0}(t))||n&&t&&"number"==typeof t.length)return s&&(t=s),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ny(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function Py(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Ly(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Ly(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Ly(t)?t:String(t)}(i.key),i)}}function jy(t,n,e){n=Iy(n);var i=t,n=Fy()?Reflect.construct(n,e||[],Iy(t).constructor):n.apply(t,e);if(n&&("object"===Ly(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function Fy(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Fy=function(){return!!t})()}function Iy(t){return(Iy=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Cy(t,n){return(Cy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Uv=function(){var t,n=i,e=Oy;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(this instanceof i)return(n=jy(this,i)).$f=[],void 0!==t&&void 0!==t.type&&(n.Fe=t.type),n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Cy(n,e),n=i,(e=[{key:"getMarkers",value:function(){return this.It}},{key:"add",value:function(t){t.Ht=this,t.th||t.wc()?this.R(t):this.$f.push(t),this.needUpdateBound=!0}},{key:"remove",value:function(t){this.nh(t),t.dispose();var n=this.It.indexOf(t),n=(-1<n&&this.It.splice(n,1),this.$f.indexOf(t));-1<n&&this.$f.splice(n,1),this.needUpdateBound=!0}},{key:"clear",value:function(){var t,n=Ry(this.It);try{for(n.s();!(t=n.n()).done;){var e=t.value;this.nh(e),e.dispose()}}catch(t){n.e(t)}finally{n.f()}this.It.length=0}},{key:"traverse",value:function(t){var n,e=Ry(this.It);try{for(e.s();!(n=e.n()).done;){var i=n.value;t&&t(i)}}catch(t){e.e(t)}finally{e.f()}}},{key:"dispose",value:function(){var t,n=Ry(this.It);try{for(n.s();!(t=n.n()).done;){var e=t.value;this.nh(e),e.dispose()}}catch(t){n.e(t)}finally{n.f()}this.It.length=0,this.xo=void 0}}])&&Py(n.prototype,e),t&&Py(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),ky=(Object.assign(Uv.prototype,{eh:function(){var t,n=Ry(this.$f);try{for(n.s();!(t=n.n()).done;){var e,i=t.value;i.wc()&&(-1<(e=this.$f.indexOf(i))&&this.$f.splice(e,1),this.R(i))}}catch(t){n.e(t)}finally{n.f()}},R:function(t){this.It.push(t),t.xi&&this.xo.add(t.xi)},nh:function(t){t.Ht=void 0,this.xo.remove(t.xi)}}),Uv);function Dy(t){return(Dy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Uy(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Dy(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Dy(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Dy(t)?t:String(t)}(i.key),i)}}function By(t,n,e){n=Hy(n);var i=t,n=Gy()?Reflect.construct(n,e||[],Hy(t).constructor):n.apply(t,e);if(n&&("object"===Dy(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function Gy(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Gy=function(){return!!t})()}function Hy(t){return(Hy=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Xy(t,n){return(Xy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}n=function(){var t,n=i,e=ky;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(){var t;if(this instanceof i)return(t=By(this,i)).Fe=S.IMAGE_MARKER,t.Yo=!0,t;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Xy(n,e),n=i,(e=[{key:"collision",get:function(){return this.Yo}}])&&Uy(n.prototype,e),t&&Uy(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}();function zy(t){return(zy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Vy(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=zy(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=zy(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==zy(t)?t:String(t)}(i.key),i)}}function Wy(t,n,e){n=Qy(n);var i=t,n=Yy()?Reflect.construct(n,e||[],Qy(t).constructor):n.apply(t,e);if(n&&("object"===zy(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function Yy(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Yy=function(){return!!t})()}function Qy(t){return(Qy=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Zy(t,n){return(Zy=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}Bv=function(){var t,n=i,e=ky;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(){var t;if(this instanceof i)return(t=Wy(this,i)).Fe=S.TEXT_MARKER,t.isHasText=!0,t.Yo=!0,t;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Zy(n,e),n=i,(e=[{key:"collision",get:function(){return this.Yo}}])&&Vy(n.prototype,e),t&&Vy(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}();function qy(t){return(qy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ky(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=qy(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=qy(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==qy(t)?t:String(t)}(i.key),i)}}function Jy(t,n,e){n=t1(n);var i=t,n=$y()?Reflect.construct(n,e||[],t1(t).constructor):n.apply(t,e);if(n&&("object"===qy(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function $y(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return($y=function(){return!!t})()}function t1(t){return(t1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function n1(t,n){return(n1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}Dv=function(){var t,n,e=r,i=ky;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(){var t;if(this instanceof r)return(t=Jy(this,r)).Fe=S.POLYGON_MARKER,t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&n1(e,i),e=r,t&&Ky(e.prototype,t),n&&Ky(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}();function e1(t){return(e1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i1(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=e1(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=e1(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==e1(t)?t:String(t)}(i.key),i)}}function r1(t,n,e){n=s1(n);var i=t,n=o1()?Reflect.construct(n,e||[],s1(t).constructor):n.apply(t,e);if(n&&("object"===e1(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function o1(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(o1=function(){return!!t})()}function s1(t){return(s1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a1(t,n){return(a1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}Uv=function(){var t,n,e=r,i=ky;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(){var t;if(this instanceof r)return(t=r1(this,r)).Fe=S.EXTRUDE_MARKER,t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&a1(e,i),e=r,t&&i1(e.prototype,t),n&&i1(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}();function u1(t){return(u1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c1(t,n){var e,i,r,o,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return i=!(e=!0),{s:function(){s=s.call(t)},n:function(){var t=s.next();return e=t.done,t},e:function(t){i=!0,r=t},f:function(){try{e||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(t)||(s=function(t,n){var e;if(t)return"string"==typeof t?f1(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?f1(t,n):void 0}(t))||n&&t&&"number"==typeof t.length)return s&&(t=s),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f1(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function h1(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=u1(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=u1(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==u1(t)?t:String(t)}(i.key),i)}}function l1(t,n,e){n=m1(n);var i=t,n=d1()?Reflect.construct(n,e||[],m1(t).constructor):n.apply(t,e);if(n&&("object"===u1(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return v1(i)}function d1(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(d1=function(){return!!t})()}function v1(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p1(){return(p1="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=m1(t)););return t}(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function m1(t){return(m1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function y1(t,n){return(y1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var b1=function(){var t,n=i,e=ky;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(){var t;if(this instanceof i)return(t=l1(this,i)).Fe=S.HEAT_MAP_MARKER,t.ih=!1,t.rh=t.rh.bind(v1(t)),t;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&y1(n,e),n=i,(e=[{key:"add",value:function(t){p1(m1(i.prototype),"add",this).call(this,t),t.th&&!t.oh&&this.sh(t.ah),0<this.$f.length&&this.qi(g).on("update",this.rh)}},{key:"remove",value:function(t){p1(m1(i.prototype),"remove",this).call(this,t),this.ih&&this.sh(null)}}])&&h1(n.prototype,e),t&&h1(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}();Object.assign(b1.prototype,{eh:function(){var t,n=c1(this.$f);try{for(n.s();!(t=n.n()).done;){var e,i=t.value;i.wc()&&(-1<(e=this.$f.indexOf(i))&&this.$f.splice(e,1),this.R(i),i.oh||this.sh(i.ah),i.needUpdateBound=!0)}}catch(t){n.e(t)}finally{n.f()}},sh:function(i){var t=this.qi(v),n=t.getExtendMesh(),e=n.material.map;(n.material.map=i)?(n.material.mapMixColor=!0,n.material.map.needsUpdate=!0):n.material.mapMixColor=!1,n.material.needsUpdate=!0,t.getModelMeshs().forEach(function(t){if(t)if("MultiMaterial"===t.material.type)for(var n=t.material.materials.length,e=0;e<n;)(t.material.materials[e].map=i)?(t.material.materials[e].map.needsUpdate=!0,t.material.materials[e].mapMixColor=!0):(t.material.materials[e].mapMixColor=!1,t.material.materials[e].transparent=!0),t.material.materials[e].needsUpdate=!0,e+=0===e?3:2;else(t.material.map=i)?(t.material.mapMixColor=!0,t.material.map.needsUpdate=!0,1===t.material.opacity&&(t.material.transparent=!1)):(t.material.mapMixColor=!1,t.material.transparent=!0),t.material.needsUpdate=!0}),e&&(e.dispose(),e=null),this.ih=!0},rh:function(){this.eh(),0===this.$f.length&&this.qi(g).off("update",this.rh)}});function g1(t,n){hv.call(this,t,n),this.type="AmbientLight",this.castShadow=void 0}function w1(t){return(w1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _1(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=w1(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=w1(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==w1(t)?t:String(t)}(i.key),i)}}g1.prototype=Object.assign(Object.create(hv.prototype),{constructor:g1,isAmbientLight:!0});var E1=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.Lt=t,this.uh=null,this.fh=null,this.hh=null,this.lh=null,this.createLight=this.createLight.bind(this)}var t,e,i;return t=n,(e=[{key:"createLight",value:function(t,n){var e=this.Lt.getMapOptions(),i=e.lockedLight,e=e.lightConfig[n];return t.dh=new g1(e[1].color,e[1].intensity),t.ph=new a,t.mh=new vv(e[0].color,e[0].intensity),t.mh.position.set(e[0].position.x,e[0].position.y,e[0].position.z),t.mh.target=t.ph,t.yh=new vv(e[2].color,e[2].intensity),t.yh.position.set(e[2].position.x,e[2].position.y,e[2].position.z),t.yh.target=t.ph,this.uh=t,this.fh=n,i&&(this.bh=this.bh.bind(this),this.Lt.on("viewChanged",this.bh)),this}},{key:"createLightByTheme",value:function(t,n,e){return t.dh=new g1(new lt("rgb("+e[1].color+")"),e[1].intensity),t.mh=new vv(new lt("rgb("+e[0].color+")"),e[0].intensity),t.mh.position.set(e[0].position.x,e[0].position.y,e[0].position.z),t.ph=new a,t.ph.position.set(e[0].target.x,e[0].target.y,e[0].target.z),t.mh.target=t.ph,t.yh=new vv(new lt("rgb("+e[2].color+")"),e[2].intensity),t.yh.position.set(e[2].position.x,e[2].position.y,e[2].position.z),t.gh=new a,t.gh.position.set(e[2].target.x,e[2].target.y,e[2].target.z),t.yh.target=t.gh,this.uh=t,this.fh=n,this}}])&&_1(t.prototype,e),i&&_1(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}();function S1(t,n,e){e.xi=new ba(t,n),(e.xi.mapNode=e).xi.rotation.set(-Math.PI/2,0,0,"XYZ")}function T1(n){var e=n.qi(g);e.Ve.hdr&&e.Ve.hdr.load(e,function(t){n.xo.environment=t,e.enableUpdateRender()})}function x1(t){return(x1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function A1(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=x1(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=x1(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==x1(t)?t:String(t)}(i.key),i)}}function M1(t,n,e){n=R1(n);var i=t,n=O1()?Reflect.construct(n,e||[],R1(t).constructor):n.apply(t,e);if(n&&("object"===x1(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function O1(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(O1=function(){return!!t})()}function L1(){return(L1="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=R1(t)););return t}(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function R1(t){return(R1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function N1(t,n){return(N1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}Object.assign(E1.prototype,{wh:function(t){var n=new _i;return n.setFromVector3(t),n.theta},_h:function(t,n){var e=new _i,n=(e.setFromVector3(t),e.theta=n,new xt);n.setFromSpherical(e),t.copy(n)},bh:function(){var t,n,e;this.uh&&(t=this.wh(this.Lt.camera.position),null===this.hh&&(n=this.wh(this.uh.mh.position),e=this.wh(this.uh.yh.position),this.hh=n-t,this.lh=e-t),n=t+this.hh,this._h(this.uh.mh.position,n),e=t+this.lh,this._h(this.uh.yh.position,e))},nn:function(){this.Lt.getMapOptions().lockedLight&&this.Lt.off("viewChanged",this.bh)}});var P1=function(){var t,n=i,e=ky;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(){var t;if(this instanceof i)return(t=M1(this,i)).scene.name="dynamicModel",t.Fe=S.DYNAMIC_MODEL_MARKER,t;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&N1(n,e),n=i,(e=[{key:"init",value:function(){L1(R1(i.prototype),"init",this).call(this),this.Eh(),this.Sh(),T1(this)}},{key:"remove",value:function(n){var t,e=this;n.Th?n.xh({src:[1],dest:[0],duration:1,callback:function(){var t=null==(t=n.xi)?void 0:t.parent;t&&t.remove(n.xi),L1(R1(i.prototype),"remove",e).call(e,n)}}):((t=null==(t=n.xi)?void 0:t.parent)&&t.remove(n.xi),L1(R1(i.prototype),"remove",this).call(this,n))}}])&&A1(n.prototype,e),t&&A1(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}();Object.assign(P1.prototype,{Eh:function(){var t=this.qi(g);this.Ah=new E1(t).createLight(this,"FMDynamicModelLayer")},Sh:function(){var t=this;this.xo.add(this.mh),this.xo.add(this.dh),this.xo.add(this.yh),this.xo.add(this.ph),this.xo.removeLight=function(){t.Mh()}},Mh:function(){this.xo.remove(this.mh),this.xo.remove(this.dh),this.xo.remove(this.yh),this.Ah.nn()}});function j1(t){return(j1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function F1(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=j1(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=j1(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==j1(t)?t:String(t)}(i.key),i)}}function I1(t,n,e){n=D1(n);var i=t,n=C1()?Reflect.construct(n,e||[],D1(t).constructor):n.apply(t,e);if(n&&("object"===j1(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function C1(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(C1=function(){return!!t})()}function k1(){return(k1="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=D1(t)););return t}(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function D1(t){return(D1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function U1(t,n){return(U1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var B1=function(){var t,n=i,e=ky;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(){var t;if(this instanceof i)return(t=I1(this,i)).Fe=S.LINE_MARKER,t;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&U1(n,e),n=i,(e=[{key:"init",value:function(){k1(D1(i.prototype),"init",this).call(this),this.xo.position.y=0}}])&&F1(n.prototype,e),t&&F1(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}();function G1(t){return(G1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function H1(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=G1(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=G1(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==G1(t)?t:String(t)}(i.key),i)}}function X1(t,n,e){n=W1(n);var i=t,n=z1()?Reflect.construct(n,e||[],W1(t).constructor):n.apply(t,e);if(n&&("object"===G1(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function z1(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(z1=function(){return!!t})()}function V1(){return(V1="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=W1(t)););return t}(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function W1(t){return(W1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Y1(t,n){return(Y1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Q1=function(){var t,n=i,e=ky;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(){var t;if(this instanceof i)return(t=X1(this,i)).Fe=S.LOCATION_MARKER,t;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Y1(n,e),n=i,(e=[{key:"init",value:function(){V1(W1(i.prototype),"init",this).call(this),this.xo.position.y=0}}])&&H1(n.prototype,e),t&&H1(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}();function Z1(t){return(Z1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function q1(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Z1(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Z1(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Z1(t)?t:String(t)}(i.key),i)}}function K1(t,n,e){n=$1(n);var i=t,n=J1()?Reflect.construct(n,e||[],$1(t).constructor):n.apply(t,e);if(n&&("object"===Z1(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function J1(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(J1=function(){return!!t})()}function $1(t){return($1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function tb(t,n){return(tb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var nb=function(){var t,n=i,e=ky;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(){var t;if(this instanceof i)return(t=K1(this,i)).Fe=S.DOM_MARKER,t;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&tb(n,e),n=i,(e=[{key:"init",value:function(){}},{key:"add",value:function(t){this.It.push(t),this.needUpdateBound=!0}},{key:"remove",value:function(t){t=this.It.indexOf(t);-1<t&&this.It.splice(t,1),this.needUpdateBound=!0}},{key:"clear",value:function(){for(;0<this.It.length;)this.It[0].dispose();this.It.length=0,this.needUpdateBound=!0}},{key:"dispose",value:function(){this.It.length=0,this.xo=void 0}},{key:"visible",get:function(){return this.Qi},set:function(t){for(var n=0;n<this.It.length;n++)this.It[n].visible=t}}])&&q1(n.prototype,e),t&&q1(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}();function eb(t){return(eb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ib(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=eb(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=eb(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==eb(t)?t:String(t)}(i.key),i)}}function rb(t,n,e){n=ab(n);var i=t,n=ob()?Reflect.construct(n,e||[],ab(t).constructor):n.apply(t,e);if(n&&("object"===eb(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function ob(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ob=function(){return!!t})()}function sb(){return(sb="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=ab(t)););return t}(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function ab(t){return(ab=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ub(t,n){return(ub=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var e=function(){var t,n=i,e=Fo;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){if(this instanceof i)return(t=rb(this,i,[t])).Oh=void 0,t.Rr=!1,t.Lh=null,t.Pr=0,t.Fr=void 0,t.Ir=void 0,t.Cr=null,t.kr=null,t;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&ub(n,e),n=i,(e=[{key:"isbloom",get:function(){return this.Oh},set:function(t){this.Oh=t}},{key:"ID",get:function(){return this.G.je}},{key:"level",get:function(){return this.Ht.Ht.ar}},{key:"x",get:function(){return this.bound.center.x}},{key:"y",get:function(){return this.bound.center.y}},{key:"height",get:function(){return this.G.height}},{key:"bound",get:function(){return!0===this.Zi&&(this.G.xe=null,this.xe=this.G.getBound(),this.Zi=!1),this.xe.clone()}},{key:"boundNoClone",get:function(){return 1==this.Zi&&(this.G.xe=null,this.xe=this.G.getBound(),this.Zi=!1),this.xe}},{key:"zoomRange",get:function(){return{maxLevel:this.G.maxlevel,minLevel:this.G.minlevel}}},{key:"visible",get:function(){return this.Qi},set:function(t){this.Qi=t,this.Rf()}},{key:"getData",value:function(){var t=this.G;return{ID:t.je,typeID:t.type,FID:t.fid,height:t.height,name:t.name,eName:t.ename,minLevel:t.minlevel,maxLevel:t.maxlevel}}},{key:"getBound",value:function(){var t=this.bound;return{maxY:t.max.y,maxX:t.max.x,minX:t.min.x,minY:t.min.y}}},{key:"getRenderNode",value:function(){return this.xi}},{key:"dispose",value:function(){this.Rh(),this.Lt=null,sb(ab(i.prototype),"dispose",this).call(this)}}])&&ib(n.prototype,e),t&&ib(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),cb=(Object.assign(e.prototype,{Rf:function(){var t,n,e;this.Fe===S.LABEL||this.Fe===S.FACILITY?(e=(n=this).qi(g))&&(n.xi&&e.fi.$o(),e.enableUpdateNode(),e.enableUpdateRender()):(e=(n=this).qi(g))&&(n.xi&&(t=e.getZoom(),e.fi.Nh(n,t)),e.enableUpdateNode(),e.enableUpdateRender())},Rh:function(){var t;(t=this).Ph&&t.Ph(),t.xi&&(t.xi.parent&&t.xi.parent.remove(t.xi),t.xi instanceof wc?t.xi.children.forEach(function(t){t.geometry&&t.geometry.dispose(),t.geometry=void 0,t.material=void 0,t.mapNode=void 0}):(t.xi.geometry.dispose(),t.xi.geometry=void 0,t.xi.material=void 0,t.xi.mapNode=void 0),t.xi=void 0)}}),e);function fb(t){return(fb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function hb(){hb=function(){return s};var u,s={},t=Object.prototype,c=t.hasOwnProperty,f=Object.defineProperty||function(t,n,e){t[n]=e.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",e=n.asyncIterator||"@@asyncIterator",r=n.toStringTag||"@@toStringTag";function o(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{o({},"")}catch(u){o=function(t,n,e){return t[n]=e}}function a(t,n,e,i){var r,o,s,a,n=n&&n.prototype instanceof y?n:y,n=Object.create(n.prototype),i=new A(i||[]);return f(n,"_invoke",{value:(r=t,o=e,s=i,a=l,function(t,n){if(a===v)throw new Error("Generator is already running");if(a===p){if("throw"===t)throw n;return{value:u,done:!0}}for(s.method=t,s.arg=n;;){var e=s.delegate;if(e){e=function t(n,e){var i=e.method,r=n.iterator[i];if(r===u)return e.delegate=null,"throw"===i&&n.iterator.return&&(e.method="return",e.arg=u,t(n,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),m;i=h(r,n.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,m;r=i.arg;return r?r.done?(e[n.resultName]=r.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=u),e.delegate=null,m):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}(e,s);if(e){if(e===m)continue;return e}}if("next"===s.method)s.sent=s.Mt=s.arg;else if("throw"===s.method){if(a===l)throw a=p,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);a=v;e=h(r,o,s);if("normal"===e.type){if(a=s.done?p:d,e.arg===m)continue;return{value:e.arg,done:s.done}}"throw"===e.type&&(a=p,s.method="throw",s.arg=e.arg)}})}),n}function h(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}s.wrap=a;var l="suspendedStart",d="suspendedYield",v="executing",p="completed",m={};function y(){}function b(){}function g(){}var n={},w=(o(n,i,function(){return this}),Object.getPrototypeOf),w=w&&w(w(M([]))),_=(w&&w!==t&&c.call(w,i)&&(n=w),g.prototype=y.prototype=Object.create(n));function E(t){["next","throw","return"].forEach(function(n){o(t,n,function(t){return this._invoke(n,t)})})}function S(s,a){var n;f(this,"_invoke",{value:function(e,i){function t(){return new a(function(t,n){!function n(t,e,i,r){var o,t=h(s[t],s,e);if("throw"!==t.type)return(e=(o=t.arg).value)&&"object"==fb(e)&&c.call(e,"__await")?a.resolve(e.Ot).then(function(t){n("next",t,i,r)},function(t){n("throw",t,i,r)}):a.resolve(e).then(function(t){o.value=t,i(o)},function(t){return n("throw",t,i,r)});r(t.arg)}(e,i,t,n)})}return n=n?n.then(t,t):t()}})}function T(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function x(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function M(n){if(n||""===n){var e,t=n[i];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return e=-1,(t=function t(){for(;++e<n.length;)if(c.call(n,e))return t.value=n[e],t.done=!1,t;return t.value=u,t.done=!0,t}).next=t}throw new TypeError(fb(n)+" is not iterable")}return f(_,"constructor",{value:b.prototype=g,configurable:!0}),f(g,"constructor",{value:b,configurable:!0}),b.displayName=o(g,r,"GeneratorFunction"),s.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},s.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,o(t,r,"GeneratorFunction")),t.prototype=Object.create(_),t},s.awrap=function(t){return{Ot:t}},E(S.prototype),o(S.prototype,e,function(){return this}),s.AsyncIterator=S,s.async=function(t,n,e,i,r){void 0===r&&(r=Promise);var o=new S(a(t,n,e,i),r);return s.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},E(_),o(_,r,"Generator"),o(_,i,function(){return this}),o(_,"toString",function(){return"[object Generator]"}),s.keys=function(t){var n,e=Object(t),i=[];for(n in e)i.push(n);return i.reverse(),function t(){for(;i.length;){var n=i.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},s.values=M,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this.Mt=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(x),!t)for(var n in this)"t"===n.charAt(0)&&c.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=u)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function t(t,n){return o.type="throw",o.arg=e,i.next=t,n&&(i.method="next",i.arg=u),!!n}for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var s=c.call(r,"catchLoc"),a=c.call(r,"finallyLoc");if(s&&a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var o=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=n&&n<=r.finallyLoc?null:r)?r.completion:{};return o.type=t,o.arg=n,r?(this.method="next",this.next=r.finallyLoc,m):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),m},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),x(e),m}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e,i,r=this.tryEntries[n];if(r.tryLoc===t)return"throw"===(e=r.completion).type&&(i=e.arg,x(r)),i}throw new Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:M(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=u),m}},s}function lb(t,n,e,i,r,o,s){try{var a=t[o](s),u=a.value}catch(t){return void e(t)}a.done?n(u):Promise.resolve(u).then(i,r)}function db(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=fb(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=fb(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==fb(t)?t:String(t)}(i.key),i)}}function vb(t,n,e){n=mb(n);var i=t,n=pb()?Reflect.construct(n,e||[],mb(t).constructor):n.apply(t,e);if(n&&("object"===fb(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function pb(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(pb=function(){return!!t})()}function mb(t){return(mb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function yb(t,n){return(yb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var e=function(){var t,n=i,e=cb;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(this instanceof i)return(n=vb(this,i)).G=t,n.nt=t.height,n.Fe=S.EXTENT,n.jh=null,n.Fh=null,n.xi=null,n.Ih=0,n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&yb(n,e),n=i,(e=[{key:"zoomRange",get:function(){}},{key:"getData",value:function(){var t=this.G;return{ID:t.je,height:t.height,area:t.area}}},{key:"getArea",value:function(){return uy.area(this.G.Ie[0])}},{key:"coordinates",get:function(){return this.G.Ie}}])&&db(n.prototype,e),t&&db(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),bb=(Object.assign(e.prototype,{wc:function(){var a,s=this;return a=hb().mark(function t(){var n,e,i,r,o;return hb().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(s.xi)return t.abrupt("return");t.next=2;break;case 2:if(1===s.Ih)return t.abrupt("return");t.next=4;break;case 4:if(n=s.qi(g)){t.next=7;break}return t.abrupt("return");case 7:return e=s.qi(Go),r=n.fi,i=n.Ft.Jo?r.Ch:r.kh,s.Ih=1,t.next=13,i.bind(r)({type:s.type,data:s.G,amount:s.nt});case 13:i=t.sent,s.Ih=2,s.jh=n.fi.Dh.Pc(e.je),r=s.Lr(n,e.je),e!==n.kt&&(r.polygonOffset=!0,r.polygonOffsetFactor=1,r.polygonOffsetUnits=1),e===n.kt&&1!==n.children.length&&1===n.kt.It.length&&(r.stencilWrite=!0,r.stencilRef=1,r.stencilFunc=516,r.stencilFail=bi,r.stencilZFail=bi,r.stencilZPass=bi),o=s.G.getBound(),s.xi=new ba(i.geometry,r),s.xi.rotation.set(-Math.PI/2,0,0,"XYZ"),s.xi.position.set(o.center.x-n._t,-s.nt,n.Et-o.center.y),s.xi.receiveShadow=!0,s.xi.visible=s.Qi,(s.xi.mapNode=s).Ht.xo.add(s.xi);case 27:case"end":return t.stop()}},t)}),function(){var t=this,s=arguments;return new Promise(function(n,e){var i=a.apply(t,s);function r(t){lb(i,n,e,r,o,"next",t)}function o(t){lb(i,n,e,r,o,"throw",t)}r(void 0)})}()},Uh:function(t,n){var e;this.xi&&(e=this.qi(Go),this.jh=n.Pc(e.je),this.Bh())},Gh:function(t){t!==this.Fh&&(this.Fh=t,this.Bh())},Bh:function(){var t,n;this.xi&&(t=this.qi(g))&&(n=this.qi(Go),this.xi.material=this.Lr(t,n.je),t.enableUpdateRender())},Lr:function(t,n){var e=this.qi(v),e={color:this.jh.color,alpha:this.jh.alpha*e.ht,buildingID:n},n=(this.Fh&&(e.url=this.Fh,e.finish=function(){t.enableUpdateRender()}),t.fi.Br.Du(e));return n.polygonOffset=!0,n.polygonOffsetFactor=1,n.polygonOffsetUnits=4,n.userData.opacity=n.opacity,this.Rr?((e=n.clone()).userData.opacity=e.opacity,e.uniforms.isMask.value=!0,e.uniforms.maskType.value=this.Pr,e.uniforms.maskTexture.value=this.Lh,void 0!==this.Fr&&void 0!==this.Ir&&(e.uniforms.maskHeight.value=this.Fr,e.uniforms.maskExtrudeHeight.value=this.Ir),e.uniformsNeedUpdate=!0,e):n},Rf:function(){var t=this.qi(g);t&&(this.xi&&(this.xi.visible=this.Qi),t.enableUpdateNode(),t.enableUpdateRender())},updateMaterialByThemeTool:function(t){this.jh=t,this.Bh()}}),e),gb=new Ft;function wb(t,n){this.object=t,void 0===n&&(n=16776960);var t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),e=new Float32Array(24),i=new N;i.setIndex(new R(t,1)),i.setAttribute("position",new R(e,3)),Ov.call(this,i,new al({color:n,toneMapped:!1})),this.matrixAutoUpdate=!1,this.update()}function _b(t,n,e){this.Hh=t,this.Xh=n,this.zh=e||null;for(var i=n.tracks,r=i.length,o=new Array(r),s={endingStart:fi,endingEnd:fi},a=0;a!==r;++a){var u=i[a].createInterpolant(null);(o[a]=u).settings=s}this.Vh=s,this.Wh=o,this.Yh=new Array(r),this.Qh=null,this.Zh=null,this.qh=null,this.Kh=null,this.loop=2201,this.Jh=-1,this.$h=null,this.time=0,this.timeScale=1,this.tl=1,this.weight=1,this.nl=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Eb(t,n,e){this.binding=t,this.valueSize=e;var i,r=Float64Array;switch(n){case"quaternion":i=this.el;break;case"string":case"bool":r=Array,i=this.il;break;default:i=this.rl}this.buffer=new r(4*e),this.ol=i,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function Sb(t){this.hs=t,this.sl(),this.al=0,this.time=0,this.timeScale=1}((wb.prototype=Object.create(Ov.prototype)).constructor=wb).prototype.update=function(t){var n,e,i;void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&gb.setFromObject(this.object),gb.isEmpty()||(t=gb.min,n=gb.max,(i=(e=this.geometry.attributes.position).array)[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=t.x,i[4]=n.y,i[5]=n.z,i[6]=t.x,i[7]=t.y,i[8]=n.z,i[9]=n.x,i[10]=t.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=t.z,i[15]=t.x,i[16]=n.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=n.x,i[22]=t.y,i[23]=t.z,e.needsUpdate=!0,this.geometry.computeBoundingSphere())},wb.prototype.setFromObject=function(t){return this.object=t,this.update(),this},wb.prototype.copy=function(t){return Ov.prototype.copy.call(this,t),this.object=t.object,this},wb.prototype.clone=function(){return(new this.constructor).copy(this)},Object.assign(_b.prototype,{play:function(){return this.Hh.ul(this),this},stop:function(){return this.Hh.cl(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this.Jh=-1,this.$h=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this.$h&&this.Hh.fl(this)},isScheduled:function(){return this.Hh.fl(this)},startAt:function(t){return this.$h=t,this},setLoop:function(t,n){return this.loop=t,this.repetitions=n,this},setEffectiveWeight:function(t){return this.weight=t,this.nl=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this.nl},fadeIn:function(t){return this.hl(t,0,1)},fadeOut:function(t){return this.hl(t,1,0)},crossFadeFrom:function(t,n,e){var i,r;return t.fadeOut(n),this.fadeIn(n),e&&(r=(e=this.Xh.duration)/(i=t.Xh.duration),t.warp(1,i/e,n),this.warp(r,1,n)),this},crossFadeTo:function(t,n,e){return t.crossFadeFrom(this,n,e)},stopFading:function(){var t=this.Kh;return null!==t&&(this.Kh=null,this.Hh.ll(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this.tl=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this.tl},setDuration:function(t){return this.timeScale=this.Xh.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this.tl,0,t)},warp:function(t,n,e){var i=this.Hh,r=i.time,o=this.qh,s=this.timeScale,i=(null===o&&(o=i.dl(),this.qh=o),o.parameterPositions),o=o.sampleValues;return i[0]=r,i[1]=r+e,o[0]=t/s,o[1]=n/s,this},stopWarping:function(){var t=this.qh;return null!==t&&(this.qh=null,this.Hh.ll(t)),this},getMixer:function(){return this.Hh},getClip:function(){return this.Xh},getRoot:function(){return this.zh||this.Hh.hs},Kt:function(t,n,e,i){if(this.enabled){var r=this.$h;if(null!==r){r=(t-r)*e;if(r<0||0===e)return;this.$h=null,n=e*r}n*=this.vl(t);var o=this.pl(n),s=this.ml(t);if(0<s)for(var a=this.Wh,u=this.Yh,c=0,f=a.length;c!==f;++c)a[c].evaluate(o),u[c].accumulate(i,s)}else this.ml(t)},ml:function(t){var n,e,i=0;return this.enabled&&(i=this.weight,null!==(n=this.Kh))&&(i*=e=n.evaluate(t)[0],t>n.parameterPositions[1])&&(this.stopFading(),0===e)&&(this.enabled=!1),this.nl=i},vl:function(t){var n,e=0;return this.paused||(e=this.timeScale,null!==(n=this.qh)&&(e*=n.evaluate(t)[0],t>n.parameterPositions[1])&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)),this.tl=e},pl:function(t){var n,e=this.time+t,i=this.Xh.duration,r=this.loop,o=this.Jh,s=2202===r;if(0===t)return-1!==o&&s&&1==(1&o)?i-e:e;if(2200===r){-1===o&&(this.Jh=0,this.yl(!0,!0,!1));t:{if(i<=e)e=i;else{if(!(e<0)){this.time=e;break t}e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e,this.Hh.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else if(-1===o&&(0<=t?this.yl(!(o=0),0===this.repetitions,s):this.yl(0===this.repetitions,!0,s)),i<=e||e<0?(e-=i*(r=Math.floor(e/i)),o+=Math.abs(r),(n=this.repetitions-o)<=0?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e=0<t?i:0,this.Hh.dispatchEvent({type:"finished",action:this,direction:0<t?1:-1})):(1==n?this.yl(n=t<0,!n,s):this.yl(!1,!1,s),this.Jh=o,this.time=e,this.Hh.dispatchEvent({type:"loop",action:this,loopDelta:r}))):this.time=e,s&&1==(1&o))return i-e;return e},yl:function(t,n,e){var i=this.Vh;e?(i.endingStart=hi,i.endingEnd=hi):(i.endingStart=t?this.zeroSlopeAtStart?hi:fi:2402,i.endingEnd=n?this.zeroSlopeAtEnd?hi:fi:2402)},hl:function(t,n,e){var i=this.Hh,r=i.time,o=this.Kh,i=(null===o&&(o=i.dl(),this.Kh=o),o.parameterPositions),o=o.sampleValues;return i[0]=r,o[0]=n,i[1]=r+t,o[1]=e,this}}),Object.assign(Eb.prototype,{accumulate:function(t,n){var e=this.buffer,i=this.valueSize,r=t*i+i,t=this.cumulativeWeight;if(0===t){for(var o=0;o!==i;++o)e[r+o]=e[o];t=n}else this.ol(e,r,0,n/(t+=n),i);this.cumulativeWeight=t},apply:function(t){var n=this.valueSize,e=this.buffer,i=t*n+n,t=this.cumulativeWeight,r=this.binding;this.cumulativeWeight=0,t<1&&this.ol(e,i,3*n,1-t,n);for(var o=n,s=n+n;o!==s;++o)if(e[o]!==e[o+n]){r.setValue(e,i);break}},saveOriginalState:function(){var t=this.binding,n=this.buffer,e=this.valueSize,i=3*e;t.getValue(n,i);for(var r=e,o=i;r!==o;++r)n[r]=n[i+r%e];this.cumulativeWeight=0},restoreOriginalState:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},il:function(t,n,e,i,r){if(.5<=i)for(var o=0;o!==r;++o)t[n+o]=t[e+o]},el:function(t,n,e,i){at.slerpFlat(t,n,t,n,t,e,i)},rl:function(t,n,e,i,r){for(var o=1-i,s=0;s!==r;++s){var a=n+s;t[a]=t[a]*o+t[e+s]*i}}}),Sb.prototype=Object.assign(Object.create(D.prototype),{constructor:Sb,bl:function(t,n){var e=t.zh||this.hs,i=t.Xh.tracks,r=i.length,o=t.Yh,s=t.Wh,a=e.uuid,t=this.gl,u=t[a];void 0===u&&(t[a]=u={});for(var c=0;c!==r;++c){var f=i[c],h=f.name,l=u[h];if(void 0===l){if(void 0!==(l=o[c])){null===l.Qh&&(++l.referenceCount,this.wl(l,a,h));continue}var d=n&&n.Yh[c].binding.parsedPath;++(l=new Eb(zv.create(e,h,d),f.ValueTypeName,f.getValueSize())).referenceCount,this.wl(l,a,h)}o[c]=l,s[c].resultBuffer=l.buffer}},ul:function(t){if(!this.fl(t)){null===t.Qh&&(n=(t.zh||this.hs).uuid,e=t.Xh.uuid,i=this._l[e],this.bl(t,i&&i.knownActions[0]),this.El(t,e,n));for(var n,e,i,r=t.Yh,o=0,s=r.length;o!==s;++o){var a=r[o];0==a.useCount++&&(this.Sl(a),a.saveOriginalState())}this.Tl(t)}},cl:function(t){if(this.fl(t)){for(var n=t.Yh,e=0,i=n.length;e!==i;++e){var r=n[e];0==--r.useCount&&(r.restoreOriginalState(),this.xl(r))}this.Al(t)}},sl:function(){this.Ml=[],this.Ol=0,this._l={},this.sf=[],this.Ll=0,this.gl={},this.Rl=[],this.Nl=0;var t=this;this.stats={actions:{get total(){return t.Ml.length},get inUse(){return t.Ol}},bindings:{get total(){return t.sf.length},get inUse(){return t.Ll}},controlInterpolants:{get total(){return t.Rl.length},get inUse(){return t.Nl}}}},fl:function(t){t=t.Qh;return null!==t&&t<this.Ol},El:function(t,n,e){var i=this.Ml,r=this._l,o=r[n];void 0===o?(o={knownActions:[t],actionByRoot:{}},t.Zh=0,r[n]=o):(r=o.knownActions,t.Zh=r.length,r.push(t)),t.Qh=i.length,i.push(t),o.actionByRoot[e]=t},Pl:function(t){var n=this.Ml,e=n[n.length-1],i=t.Qh,i=(n[e.Qh=i]=e,n.pop(),t.Qh=null,t.Xh.uuid),e=this._l,n=e[i],r=n.knownActions,o=r[r.length-1],s=t.Zh;r[o.Zh=s]=o,r.pop(),t.Zh=null,delete n.actionByRoot[(t.zh||this.hs).uuid],0===r.length&&delete e[i],this.jl(t)},jl:function(t){for(var n=t.Yh,e=0,i=n.length;e!==i;++e){var r=n[e];0==--r.referenceCount&&this.Fl(r)}},Tl:function(t){var n=this.Ml,e=t.Qh,i=this.Ol++,r=n[i];n[t.Qh=i]=t,n[r.Qh=e]=r},Al:function(t){var n=this.Ml,e=t.Qh,i=--this.Ol,r=n[i];n[t.Qh=i]=t,n[r.Qh=e]=r},wl:function(t,n,e){var i=this.gl,r=i[n],o=this.sf;void 0===r&&(i[n]=r={}),(r[e]=t).Qh=o.length,o.push(t)},Fl:function(t){var n=this.sf,e=t.binding,i=e.rootNode.uuid,e=e.path,r=this.gl,o=r[i],s=n[n.length-1],t=t.Qh;n[s.Qh=t]=s,n.pop(),delete o[e],0===Object.keys(o).length&&delete r[i]},Sl:function(t){var n=this.sf,e=t.Qh,i=this.Ll++,r=n[i];n[t.Qh=i]=t,n[r.Qh=e]=r},xl:function(t){var n=this.sf,e=t.Qh,i=--this.Ll,r=n[i];n[t.Qh=i]=t,n[r.Qh=e]=r},dl:function(){var t=this.Rl,n=this.Nl++,e=t[n];return void 0===e&&(t[(e=new Kd(new Float32Array(2),new Float32Array(2),1,this.Cl)).Il=n]=e),e},ll:function(t){var n=this.Rl,e=t.Il,i=--this.Nl,r=n[i];n[t.Il=i]=t,n[r.Il=e]=r},Cl:new Float32Array(1),clipAction:function(t,n){var e=n||this.hs,i=e.uuid,e="string"==typeof t?av.findByName(e,t):t,t=null!==e?e.uuid:t,r=this._l[t],o=null;if(void 0!==r){var s=r.actionByRoot[i];if(void 0!==s)return s;o=r.knownActions[0],null===e&&(e=o.Xh)}return null===e?null:(s=new _b(this,e,n),this.bl(s,o),this.El(s,t,i),s)},existingAction:function(t,n){var n=n||this.hs,e=n.uuid,n="string"==typeof t?av.findByName(n,t):t,n=n?n.uuid:t,t=this._l[n];return void 0!==t&&t.actionByRoot[e]||null},stopAllAction:function(){var t=this.Ml,n=this.Ol,e=this.sf,i=this.Ll;this.Ol=0;for(var r=this.Ll=0;r!==n;++r)t[r].reset();for(r=0;r!==i;++r)e[r].useCount=0;return this},update:function(t){t*=this.timeScale;for(var n=this.Ml,e=this.Ol,i=this.time+=t,r=Math.sign(t),o=this.al^=1,s=0;s!==e;++s)n[s].Kt(i,t,r,o);for(var a=this.sf,u=this.Ll,s=0;s!==u;++s)a[s].apply(o);return this},setTime:function(t){for(var n=this.time=0;n<this.Ml.length;n++)this.Ml[n].time=0;return this.update(t)},getRoot:function(){return this.hs},uncacheClip:function(t){var n=this.Ml,t=t.uuid,e=this._l,i=e[t];if(void 0!==i){for(var r=i.knownActions,o=0,s=r.length;o!==s;++o){var a=r[o],u=(this.cl(a),a.Qh),c=n[n.length-1];a.Qh=null,a.Zh=null,n[c.Qh=u]=c,n.pop(),this.jl(a)}delete e[t]}},uncacheRoot:function(t){var n,e=t.uuid,i=this._l;for(n in i){var r=i[n].actionByRoot[e];void 0!==r&&(this.cl(r),this.Pl(r))}var o=this.gl[e];if(void 0!==o)for(var s in o){s=o[s];s.restoreOriginalState(),this.Fl(s)}},uncacheAction:function(t,n){t=this.existingAction(t,n);null!==t&&(this.cl(t),this.Pl(t))}});var e=t(11),Tb=t.n(e);function xb(t){return(xb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ab(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=xb(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=xb(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==xb(t)?t:String(t)}(i.key),i)}}var e=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.ss=t,this.Lt=this.ss.map,this.kl={},this.Fh=null,this.Dl={},this.Ul=0,this.nt=512,this.tt=512,this.Bl=!1,this.zt=null,this.Kt=this.Kt.bind(this)}var t,e,i;return t=n,(e=[{key:"isAdded",get:function(){return this.Bl}},{key:"add",value:function(t){var n=this;null===this.Fh&&(this.Fh=t),this.Gl(function(t){n.Hl(t)})}},{key:"dispose",value:function(t){this.Lt.off("update",this.Kt),t&&t()}},{key:"stop",value:function(){this.Lt.off("update",this.Kt)}}])&&Ab(t.prototype,e),i&&Ab(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}(),Mb=(Object.assign(e.prototype,{Gl:function(n){var t=this.ss.externalModel.getRenderNode();t.renderOrder=1,this.ss.externalModel.Xl?t.traverse(function(t){"Mesh"===t.type&&(t.renderOrder=1,n(t))}):n(t)},Hl:function(i){var e=this,r=this,o=0,s=null;Array.isArray(i.material)?(this.kl[i.name]=[],function e(){o<i.material.length?r.Bh(i.material[o],function(t,n){r.kl[i.name].push(i.material[o].clone()),n&&(i.material[o].dispose(),i.material[o]=t),o++,s=setTimeout(e,0)}):(null!==s&&clearTimeout(s),r.zt=(new Date).getTime(),r.Lt.on("update",r.Kt))}()):this.Bh(i.material,function(t,n){e.kl[i.name]=i.material.clone(),n&&(i.material.dispose(),i.material=t),e.zt=(new Date).getTime(),e.Lt.on("update",r.Kt)})},Bh:function(t,n){var e,i=null;t&&(this.ss.externalModel.Xl?t.uniforms&&t.uniforms.map&&t.uniforms.map.value?i=t.uniforms.map.value.name:t.map&&(i=""+t.map.name):t.map&&(i=""+t.map.name).indexOf(".gif")<0&&(i=t.name)),(null===i||!this.ss.parent.zl||!this.ss.parent.zl[i])&&null!==i&&0<=i.indexOf(".gif")?(t=(t=i.split("."))[0]+"."+t[1],(e=this.Dl[t])?e.canvasArray&&0<e.canvasArray.length&&(e=new Gc(e.canvasArray[e.canvascount]),this.ss.externalModel.Xl&&(e.flipY=!1),e.repeat.set(1,1),e.name=i,e.magFilter=B,e.minFilter=qn,(i=new ta({map:e})).isBasic=!0,i.gifname=t,i.transparent=!0,n(i,!0)):this.Vl(this.Fh+t,t,function(t){n(t,!0)})):n(null,!1)},Vl:function(t,e,i){var r=this,o=document.createElement("div"),s=(o.style.display="none",document.body.appendChild(o),new Image);s.crossOrigin="Anonymous",s.onload=function(){i&&((t=document.createElement("canvas")).width=r.tt,t.height=r.nt,t.getContext("2d").drawImage(s,0,0,r.tt,r.nt),t=new Gc(t),r.ss.externalModel.Xl&&(t.flipY=!1),t.repeat.set(1,1),t.magFilter=B,t.minFilter=qn,(t=new ta({map:t})).transparent=!0,t.isBasic=!0,t.gifname=e,i(t)),r.Dl[e]={canvascount:0,canvasArray:[]},o.appendChild(s);var t,n=new Tb.a({gif:s});n.load(function(){r.Wl(n,e,o)})},s.src=t},Wl:function(e,i,r){var o=this,s=null,a=e.get_length(),u=1;this.Dl[i].canvascount=0,function t(){{var n;a<u?(document.body.removeChild(r),null!==s&&clearTimeout(s)):(e.move_to(u),(n=document.createElement("canvas")).width=o.tt,n.height=o.nt,n.getContext("2d").drawImage(e.get_canvas(),0,0,o.tt,o.nt),o.Dl[i].canvasArray.push(n),u++,s=setTimeout(t,0))}}()},Yl:function(t,n){t=t.split("."),t=t[0]+"."+t[1];this.Dl[t]&&(this.Dl[t].canvasArray.length=0,this.Dl[t].canvascount=0),this.Vl(n,t),this.Kt(),this.Bl||(this.Bl=!0,this.Lt.on("update",this.Kt))},Ia:function(t){var n=t.split("."),n=n[0]+"."+n[1];this.Yl(t,this.Fh+n)},Kt:function(){function r(t){50<=n&&t&&(t.canvascount<t.canvasArray.length-1?t.canvascount++:t.canvascount=0)}var o=this,t=(new Date).getTime(),n=t-this.zt;50<=n&&(this.zt=t);this.ss.externalModel.getRenderNode()&&(this.Gl(function(i){var t;if(Array.isArray(i.material))for(var n=i.material,e=0;e<n.length;e++)!function(e){var t;!n[e].isBasic||i.material[e].isupdate?o.Bh(o.kl[i.name][e],function(t,n){n&&(i.material[e].dispose(),i.material[e]=t)}):((t=o.Dl[n[e].gifname])&&t.canvasArray[t.canvascount]&&(i.material.isupdate?o.Bh(o.kl[i.name][e],function(t,n){n&&(i.material[e].dispose(),i.material[e]=t)}):(i.material[e].map.image=t.canvasArray[t.canvascount],i.material[e].map.needsUpdate=!0)),r(t))}(e);else i.material.isBasic&&!i.material.isupdate?((t=o.Dl[i.material.gifname])&&t.canvasArray[t.canvascount]&&(i.material.isupdate?o.Bh(o.kl[i.name],function(t,n){n&&(i.material.dispose(),i.material=t)}):(i.material.map.image=t.canvasArray[t.canvascount],i.material.map.needsUpdate=!0)),r(t)):o.Bh(o.kl[i.name],function(t,n){n&&(i.material.dispose(),i.material=t)})}),this.Lt.enableUpdateRender())}}),e);function Ob(t,n,e,i,r,o,s,a,u){l.call(this,t,n,e,i,r,o,s,a,u),this.format=void 0!==s?s:fe,this.minFilter=void 0!==o?o:B,this.magFilter=void 0!==r?r:B,this.generateMipmaps=!1}function Lb(t){return(Lb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Rb(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Lb(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Lb(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Lb(t)?t:String(t)}(i.key),i)}}Ob.prototype=Object.assign(Object.create(l.prototype),{constructor:Ob,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});var e=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.ss=t,this.Ql=t.externalModel,this.Lt=this.ss.map,this.Zl=[],this.ql=null,this.Kl={},this.Jl=null,this.Bl=!1,this.oldmaterial={},this.Fh=null,this.$l={},this.Kt=this.Kt.bind(this)}var t,e,i;return t=n,(e=[{key:"isAdded",get:function(){return this.Bl}},{key:"add",value:function(t){var n=this;null===this.Fh&&(this.Fh=t),this.Gl(function(t){n.Hl(t)}),this.Lt.on("update",this.Kt)}},{key:"dispose",value:function(){for(var t=0;t<this.Zl.length;t++){var n=this.Zl[t];null!==document.getElementById(n)&&document.getElementById(n).parentNode.removeChild(document.getElementById(n))}this.Lt.off("update",this.Kt)}},{key:"stop",value:function(){this.Lt.off("update",this.Kt)}}])&&Rb(t.prototype,e),i&&Rb(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}(),Nb=(Object.assign(e.prototype,{Gl:function(n){var t=this.ss.externalModel.getRenderNode();this.Ql.Xl?t.traverse(function(t){"Mesh"===t.type&&n(t)}):n(t)},Hl:function(i){var e=this,r=this,o=i.material,s=0,a=null;Array.isArray(o)?(this.oldmaterial[i.name]=[],function e(){s<o.length?r.Bh(o[s],function(t,n){r.oldmaterial[i.name].push(o[s].clone()),n&&(i.material[s].dispose(),i.material[s]=t),s++,a=setTimeout(e,0)}):null!==a&&clearTimeout(a)}()):this.Bh(o,function(t,n){e.oldmaterial[i.name]=o.clone(),n&&(i.material.dispose(),i.material=t)})},Bh:function(t,n){var e,i=this,r=null;t&&(this.Ql.Xl?t.uniforms&&t.uniforms.map&&t.uniforms.map.value?r=t.uniforms.map.value.name:t.map&&(r=""+t.map.name):t.map&&(r=""+t.map.name).indexOf(".mp4")<0&&r.indexOf(".webm")<0&&r.indexOf(".ogg")<0&&(r=t.name)),(null===r||!this.ss.parent.zl||!this.ss.parent.zl[r])&&null!==r&&(0<=r.indexOf(".mp4")||0<=r.indexOf(".webm")||0<=r.indexOf(".ogg"))?(e=r.split("."),(t=(t=this.$l[r])||this.Kl[e[0]+"."+e[1]])?((t=new ta({map:t.clone()})).isBasic=!0,n&&n(t,!0)):this.td(this.Fh+e[0]+"."+e[1],function(t){t.name=r;t=new ta({map:(i.Kl[e[0]+"."+e[1]]=t).clone()});t.isBasic=!0,n(t,!0)})):n(null,!1)},td:function(t,e){var i=this,r=(this.Jl=t,null),n=document.createElement("div"),o=(n.style.display="none","xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=16*Math.random()|0;return("x"==t?n:3&n|8).toString(16)}));this.ql=o+"_div",this.Zl.push(this.ql),n.setAttribute("id",this.ql),n.innerHTML='<video id="'+o+'" loop crossOrigin="anonymous" muted><source src="'+t+'"></video>',document.body.appendChild(n),function t(){var n=document.getElementById(o);n?(null!==r&&clearTimeout(r),n.addEventListener("loadeddata",function(){var t=new Ob(n);t.video_id=o+"_div",i.Ql.Xl&&(t.flipY=!1),e&&e(t),n.play()})):r=setTimeout(t,0)}()},nd:function(i){var r=this;this.ss.externalModel.getRenderNode()&&this.Gl(function(e){var t=e.material;if(Array.isArray(t))for(var n=0;n<t.length;n++)!function(n){r.Bh(r.oldmaterial[e.name][n],function(t){t&&t.map&&t.map.name===i&&(e.material[n].dispose(),e.material[n]=t)})}(n);else r.Bh(r.oldmaterial[e.name],function(t){t&&t.map&&t.map.name===i&&(e.material.dispose(),e.material=t)})})},Ia:function(t){var n;this.$l[t]&&(n=this.$l[t].video_id,null!==document.getElementById(n)&&document.getElementById(n).parentNode.removeChild(document.getElementById(n)),this.$l[t].dispose(),this.$l[t]=void 0,this.nd(t))},Yl:function(n,t){var e=this;this.td(t,function(t){e.$l[n]&&e.Ia(n),t.name=n,e.$l[n]=t,e.nd(n)}),this.Bl||(this.Bl=!0,this.Lt.on("update",this.Kt))},Kt:function(){var i=this;this.ss.externalModel.getRenderNode()&&(this.Gl(function(e){var t=e.material;if(Array.isArray(t))for(var n=0;n<t.length;n++)!function(n){t[n].isBasic&&!t[n].isupdate||i.Bh(i.oldmaterial[e.name][n],function(t){t&&(e.material[n].dispose(),e.material[n]=t)})}(n);else t.isBasic?t.isupdate&&i.Bh(i.oldmaterial[e.name],function(t){t&&(e.material.dispose(),e.material=t)}):i.Bh(i.oldmaterial[e.name],function(t){t&&(e.material.dispose(),e.material=t)})}),this.Lt.enableUpdateRender())}}),e);function Pb(t){return(Pb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function jb(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Pb(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Pb(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Pb(t)?t:String(t)}(i.key),i)}}var e=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.Lt=t.parent.parent.parent.parent,this.Ql=t,this.Kt=this.Kt.bind(this),this.Fe="no",this.ed=new Mb({map:this.Lt,externalModel:t,parent:this}),this.rd=new Nb({map:this.Lt,externalModel:t,parent:this}),this.zl=null,this.od=[],this.sd={},this.Lt.on("update",this.Kt)}var t,e,i;return t=n,(e=[{key:"gifTool",get:function(){return this.ed}},{key:"videoTool",get:function(){return this.rd}},{key:"isGltf",get:function(){return this.Ql.Xl}},{key:"textureNames",get:function(){return this.od}},{key:"oldMaterial",get:function(){return this.sd}},{key:"replace",value:function(t,n){null===this.zl&&(this.zl={}),this.zl[t]=!0}},{key:"reset",value:function(t){this.zl[t]=!1}},{key:"dispose",value:function(){this.ed.Bl&&this.ed.dispose(),this.rd.Bl&&this.rd.dispose()}}])&&jb(t.prototype,e),i&&jb(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}(),Fb=(Object.assign(e.prototype,{Kt:function(){function n(t,n){(t=i.ad(t)).needgif&&!i.ed.Bl&&(i.ed.add(n),i.ed.Bl=!0),t.needvideo&&!i.rd.Bl&&(i.rd.add(n),i.rd.Bl=!0)}var e,i=this,t=this.Ql.getRenderNode();t&&(this.Lt.off("update",this.Kt),e=this.Ql.ud,this.Ql.Xl?t.traverse(function(t){"Mesh"===t.type&&n(t,e)}):n(t,e))},ad:function(t){function n(t){0<=t.indexOf(".gif")?(s=!0,r.od.push(t)):(0<=t.indexOf(".mp4")||0<=t.indexOf(".webm")||0<=t.indexOf(".ogg"))&&(a=!0,r.od.push(t))}function e(t,n){0<=t.indexOf(".gif")||0<=n.indexOf(".gif")?(s=!0,0<=t.indexOf(".gif")?r.od.push(t):r.od.push(n)):(0<=t.indexOf(".mp4")||0<=t.indexOf(".webm")||0<=t.indexOf(".ogg")||0<=n.indexOf(".mp4")||0<=n.indexOf(".webm")||0<=n.indexOf(".ogg"))&&(a=!0,0<=t.indexOf(".mp4")||0<=t.indexOf(".webm")||0<=t.indexOf(".ogg")?r.od.push(t):r.od.push(n))}var i,r=this,o={needgif:!1,needvideo:!1},s=!1,a=!1,u=t.material;if(Array.isArray(u)){this.sd[t.name]=[];for(var c,f=0;f<u.length;f++)this.sd[t.name].push(u[f].clone()),this.Ql.Xl?u[f].uniforms&&u[f].uniforms.map&&u[f].uniforms.map.value?u[f].uniforms.map.value.name:u[f].map&&n(u[f].map.name):(c="",e(c=u[f].map?""+u[f].map.name:c,""+u[f].name))}else this.sd[t.name]=u.clone(),this.Ql.Xl?(i="",u.uniforms&&u.uniforms.map&&u.uniforms.map.value?i=u.uniforms.map.value.name:u.map&&(i=u.map.name),n(i)):(i="",e(i=u.map?""+u.map.name:i,""+u.name));return o.needgif=s,o.needvideo=a,o}}),e);function Ib(t){return(Ib="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Cb(){Cb=function(){return s};var u,s={},t=Object.prototype,c=t.hasOwnProperty,f=Object.defineProperty||function(t,n,e){t[n]=e.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",e=n.asyncIterator||"@@asyncIterator",r=n.toStringTag||"@@toStringTag";function o(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{o({},"")}catch(u){o=function(t,n,e){return t[n]=e}}function a(t,n,e,i){var r,o,s,a,n=n&&n.prototype instanceof y?n:y,n=Object.create(n.prototype),i=new A(i||[]);return f(n,"_invoke",{value:(r=t,o=e,s=i,a=l,function(t,n){if(a===v)throw new Error("Generator is already running");if(a===p){if("throw"===t)throw n;return{value:u,done:!0}}for(s.method=t,s.arg=n;;){var e=s.delegate;if(e){e=function t(n,e){var i=e.method,r=n.iterator[i];if(r===u)return e.delegate=null,"throw"===i&&n.iterator.return&&(e.method="return",e.arg=u,t(n,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),m;i=h(r,n.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,m;r=i.arg;return r?r.done?(e[n.resultName]=r.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=u),e.delegate=null,m):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}(e,s);if(e){if(e===m)continue;return e}}if("next"===s.method)s.sent=s.Mt=s.arg;else if("throw"===s.method){if(a===l)throw a=p,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);a=v;e=h(r,o,s);if("normal"===e.type){if(a=s.done?p:d,e.arg===m)continue;return{value:e.arg,done:s.done}}"throw"===e.type&&(a=p,s.method="throw",s.arg=e.arg)}})}),n}function h(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}s.wrap=a;var l="suspendedStart",d="suspendedYield",v="executing",p="completed",m={};function y(){}function b(){}function g(){}var n={},w=(o(n,i,function(){return this}),Object.getPrototypeOf),w=w&&w(w(M([]))),_=(w&&w!==t&&c.call(w,i)&&(n=w),g.prototype=y.prototype=Object.create(n));function E(t){["next","throw","return"].forEach(function(n){o(t,n,function(t){return this._invoke(n,t)})})}function S(s,a){var n;f(this,"_invoke",{value:function(e,i){function t(){return new a(function(t,n){!function n(t,e,i,r){var o,t=h(s[t],s,e);if("throw"!==t.type)return(e=(o=t.arg).value)&&"object"==Ib(e)&&c.call(e,"__await")?a.resolve(e.Ot).then(function(t){n("next",t,i,r)},function(t){n("throw",t,i,r)}):a.resolve(e).then(function(t){o.value=t,i(o)},function(t){return n("throw",t,i,r)});r(t.arg)}(e,i,t,n)})}return n=n?n.then(t,t):t()}})}function T(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function x(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function M(n){if(n||""===n){var e,t=n[i];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return e=-1,(t=function t(){for(;++e<n.length;)if(c.call(n,e))return t.value=n[e],t.done=!1,t;return t.value=u,t.done=!0,t}).next=t}throw new TypeError(Ib(n)+" is not iterable")}return f(_,"constructor",{value:b.prototype=g,configurable:!0}),f(g,"constructor",{value:b,configurable:!0}),b.displayName=o(g,r,"GeneratorFunction"),s.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},s.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,o(t,r,"GeneratorFunction")),t.prototype=Object.create(_),t},s.awrap=function(t){return{Ot:t}},E(S.prototype),o(S.prototype,e,function(){return this}),s.AsyncIterator=S,s.async=function(t,n,e,i,r){void 0===r&&(r=Promise);var o=new S(a(t,n,e,i),r);return s.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},E(_),o(_,r,"Generator"),o(_,i,function(){return this}),o(_,"toString",function(){return"[object Generator]"}),s.keys=function(t){var n,e=Object(t),i=[];for(n in e)i.push(n);return i.reverse(),function t(){for(;i.length;){var n=i.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},s.values=M,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this.Mt=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(x),!t)for(var n in this)"t"===n.charAt(0)&&c.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=u)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function t(t,n){return o.type="throw",o.arg=e,i.next=t,n&&(i.method="next",i.arg=u),!!n}for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var s=c.call(r,"catchLoc"),a=c.call(r,"finallyLoc");if(s&&a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var o=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=n&&n<=r.finallyLoc?null:r)?r.completion:{};return o.type=t,o.arg=n,r?(this.method="next",this.next=r.finallyLoc,m):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),m},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),x(e),m}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e,i,r=this.tryEntries[n];if(r.tryLoc===t)return"throw"===(e=r.completion).type&&(i=e.arg,x(r)),i}throw new Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:M(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=u),m}},s}function kb(t,n,e,i,r,o,s){try{var a=t[o](s),u=a.value}catch(t){return void e(t)}a.done?n(u):Promise.resolve(u).then(i,r)}function Db(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Ib(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Ib(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Ib(t)?t:String(t)}(i.key),i)}}function Ub(t,n,e){return n&&Db(t.prototype,n),e&&Db(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var Bb=Ub(function t(n,e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.Lt=n,this.Ql=e,this.fd=null,this.hd=null,this.ld=null,this.dd=null,this.vd=null,this.pd=new Yd(Td),this.pd.setResponseType("json"),this.md=this.md.bind(this),this.Lt.on("zoom",this.md)});function Gb(t){return(Gb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Hb(t,n){var e,i,r,o,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return i=!(e=!0),{s:function(){s=s.call(t)},n:function(){var t=s.next();return e=t.done,t},e:function(t){i=!0,r=t},f:function(){try{e||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(t)||(s=function(t,n){var e;if(t)return"string"==typeof t?Xb(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Xb(t,n):void 0}(t))||n&&t&&"number"==typeof t.length)return s&&(t=s),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Xb(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function zb(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Gb(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Gb(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Gb(t)?t:String(t)}(i.key),i)}}function Vb(t,n,e){n=Zb(n);var i=t,n=Wb()?Reflect.construct(n,e||[],Zb(t).constructor):n.apply(t,e);if(n&&("object"===Gb(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return Yb(i)}function Wb(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Wb=function(){return!!t})()}function Yb(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Qb(){return(Qb="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=Zb(t)););return t}(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function Zb(t){return(Zb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function qb(t,n){return(qb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}Object.assign(Bb.prototype,{yd:function(){var n=this;this.Ql.bd({needFadeIn:!1,needFadeOut:!1,initLODMesh:!1,lodName:this.hd,callback:function(t){t!==n.hd&&n.yd()}})},md:function(){var a,e=this;return a=Cb().mark(function t(){var n;return Cb().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=e.gd(e.fd,e.Lt.getZoom()),e.hd!==n&&null!==n&&(e.hd=n,null!==e.vd&&clearTimeout(e.vd),e.yd(),e.vd=setTimeout(function(){},50));case 2:case"end":return t.stop()}},t)}),function(){var t=this,s=arguments;return new Promise(function(n,e){var i=a.apply(t,s);function r(t){kb(i,n,e,r,o,"next",t)}function o(t){kb(i,n,e,r,o,"throw",t)}r(void 0)})}()},gd:function(t,n){if(!t)return null;var e=this.Ql.G,i=e.maxlevel;if(n<e.minlevel||i<n)return null;for(var r=null,o=0;o<t.length;o++){var s=t[o],a=s.maxlevel;if(s.minlevel<=n&&n<=a){r=s.name;break}}return r},wd:function(o){var s=this;return this.dd!==o&&(this.dd=o,this.ld=null),new Promise(function(i,r){s._d(o).then(function(t){t.lod&&Array.isArray(t.lod)||r("lod format error");var n=s.gd(t.lod,s.Lt.getZoom()),e=(null===n&&r(null),Ad(o));s.fd=t.lod,i("".concat(e).concat(n))}).catch(r)})},_d:function(e){var i=this;return new Promise(function(n,t){i.ld?n(i.ld):i.pd.load(e,function(t){i.ld=t,n(i.ld)},null,t)})},nn:function(){this.Lt.off("zoom",this.md),this.pd=null}});var e=function(){var t,n=i,e=cb;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(this instanceof i)return(n=Vb(this,i)).G=t,n.Fe=S.EXTERNAL_MODEL,n.jh=null,n.xi=null,n.Ed=null,n.Sd=null,n.ht=null,n.Td=!1,n.Or=null,n.Xl=null,n.Hh=null,n.Ml=[],n.Bf=null,n.xd=n.xd.bind(Yb(n)),n.Ad=new Wi,n.Md=!0,n.Od=null,n.ud=null,n.Ld=!1,n.Rd=null,n.Nd=null,n.Pd=!1,n.jd=null,n.od=[],n.Fd=!1,n.jr=null,n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&qb(n,e),n=i,(e=[{key:"multiMediaTool",get:function(){return this.Od}},{key:"fading",get:function(){return!this.Ad.qt}},{key:"FID",get:function(){return this.G.fid}},{key:"typeID",get:function(){return this.G.type}},{key:"name",get:function(){return this.G.name}},{key:"eName",get:function(){return this.G.ename}},{key:"color",get:function(){return this.Sd},set:function(t){this.Sd=t,this.Bh()}},{key:"opacity",get:function(){return this.ht},set:function(t){this.ht=t,this.Bh()}},{key:"canDispose",get:function(){return this._canDispose}},{key:"show",get:function(){return this.Lf},set:function(t){t?this.Bf&&!this.Bf.show||this.Id():this.Cd()}},{key:"isGltf",get:function(){return this.Xl}},{key:"boundNoClone",get:function(){var t=this.getBound();return t?{min:{x:t.minX,y:t.minY},max:{x:t.maxX,y:t.maxY}}:null}},{key:"resetColor",value:function(){this.Td=!0,this.Bh()}},{key:"setColor",value:function(t,n){this.Sd=t,this.ht=n,this.Bh()}},{key:"beforRemove",value:function(){var t=null==(t=this.parent)||null==(t=t.parent)?void 0:t.parent;this.Ld=!t||!t.visibleLevels.includes(this.level)}},{key:"getBound",value:function(){if(this.Ed)return this.Ed;var t={};if(this.xi){for(var n=new wb(this.xi,16776960),e=n.geometry.attributes.position.array,i=n.geometry.attributes.position.count,r=0;r<i;r++){var o=e[3*r],s=e[3*r+2],a=e[3*r+1];(!t.minX||o<t.minX)&&(t.minX=o),(!t.maxX||t.maxX<o)&&(t.maxX=o),(!t.minY||s<t.minY)&&(t.minY=s),(!t.maxY||t.maxY<s)&&(t.maxY=s),(!t.minH||a<t.minH)&&(t.minH=a),(!t.maxH||t.maxH<a)&&(t.maxH=a)}n.material.dispose(),n.geometry.dispose(),n.material=void 0,n.geometry=void 0;var n=this.qi(g);return t.minX=t.minX+n.x,t.maxX=t.maxX+n.x,t.minY=n.y-t.minY,t.maxY=n.y-t.maxY,t.maxY<t.minY&&(n=t.minY,t.minY=t.maxY,t.maxY=n),this.Ed=t,this.Ed}}},{key:"startAction",value:function(t,n,e){var i=this.Ml[t];if(i){if(n){for(var r=this.getActionNames(),o=0;o<r.length;o++)r[o]!==t&&!0===this.Ml[r[o]].clampWhenFinished&&!0===this.Ml[r[o]].paused&&this.Ml[r[o]].stop();i.loop=2200,i.clampWhenFinished=!0}else i.clampWhenFinished=!1,i.loop=2201;this.Rd&&this.Rd===t?this.Rd===t&&(n=!1,i.time=this.Nd,e?this.Pd?n=!0:(n=!1,this.Rd=null,this.Nd=null):(this.Rd=null,this.Nd=null,this.Pd=!1),i.paused=n,i.play()):i.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).play()}e=this.qi(g);e&&e.on("beforeRender",this.xd)}},{key:"getActionNames",value:function(){return Object.keys(this.Ml)}},{key:"stopAction",value:function(t,n){var e=this.qi(g),e=(e&&e.off("beforeRender",this.xd),this.Ml[t]);e&&(e.paused=!0,this.Rd=t,this.Nd=e.time,this.jd=e.loop,n||(this.Pd=!0))}},{key:"dispose",value:function(){null!==this.Od&&this.Od.dispose(),this.Rh(),Qb(Zb(i.prototype),"dispose",this).call(this)}},{key:"getTextureNames",value:function(){return this.od}}])&&zb(n.prototype,e),t&&zb(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),Kb=(Object.assign(e.prototype,{wc:function(t){var n=this;this.Ld=!1,!this.xi&&this.G&&this.kd(function(){n.Bf&&n.Bf.wc(n),t&&t()},{initLODMesh:!0})},yd:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{needFadeIn:!0,needFadeOut:!0,initLODMesh:!0};this.xi&&this.Ht.xo.remove(this.xi),this.xi=null,this.kd(null,t)},bd:function(){var n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{needFadeIn:!0,needFadeOut:!0,initLODMesh:!1};this.kd(function(t){e.onLoaded=function(){n.xi&&n.Ht.xo.remove(n.xi),n.xi=null},n.Dd(t,function(){e.callback&&e.callback(e.lodName)},e)},e)},Uh:function(){this.yd()},Dd:function(t,i){var r=this,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},s=this.qi(g),n=s.fi.Ud.Na(t,function(t,n,e){r.Xl=t,o.onLoaded&&o.onLoaded(),r.Xl?r.Bd(n,o):r.Gd(n,e,r.jh),st.a.environment===G.a.BROWSER&&null===r.Od&&(r.Od=new Fb(r)),s.enableUpdateRender(),i&&i()});n&&s.Hd.add(t,n)},kd:function(n,e){var t,i=this,r=(e=e||{},this.qi(g)),o=this.qi(Go);this.jh=r.fi.Dh.kc({fid:this.G.fid,typeID:this.G.type+"",bid:o.je}),this.jh&&this.jh.normalID&&(t=r.fi.Xd(this.jh,"model",o.buildingID)+this.jh.model+"?keyValue="+r.Ve.key,null===this.ud&&(this.ud=r.fi.Xd(this.jh,"model",o.buildingID)),t.includes(".json")?(this.zd||(this.zd=new Bb(r,this)),this.zd.wd(t).then(function(t){!1!==e.initLODMesh?i.Dd(t,n,e):n&&n(t)})):this.Dd(t,n))},Vd:function(t,n){this.Td&&void 0!==t.userData.originColor&&(this.Sd=t.userData.originColor,t.color=t.userData.originColor,void 0!==t.userData.originOpacity)&&(t.opacity=t.userData.originOpacity*n.ht,this.ht=t.userData.originOpacity)},Gd:function(t,n,e){if(!this.xi){var i=this.qi(v);if(i){var r=i.qi(g);if(Array.isArray(n)){var o,s=Hb(n);try{for(s.s();!(o=s.n()).done;){var a=o.value;a.map&&(a.map.wrapS=Hn,a.map.wrapT=Hn),a.userData.sourceTransparent=a.transparent,a.userData.sourceOpacity=a.opacity,void 0===a.userData.originColor&&(a.userData.originColor=a.color),void 0===a.userData.originOpacity&&(a.userData.originOpacity=a.opacity),a.opacity=a.userData.sourceOpacity*i.ht,a.opacity<1&&(a.transparent=!0)}}catch(t){s.e(t)}finally{s.f()}}else n.map&&(n.map.wrapS=Hn,n.map.wrapT=Hn),n.userData.sourceOpacity=n.opacity,n.userData.sourceTransparent=n.transparent,void 0===n.userData.originColor&&(n.userData.originColor=n.color),void 0===n.userData.originOpacity&&(n.userData.originOpacity=n.opacity),n.opacity=n.userData.sourceOpacity*i.ht,n.opacity<1&&(n.transparent=!0);var u=[];if(void 0!==n.length)for(var c=0;c<n.length;c++){var f=n[c].clone();this.Sd&&(f.color=new lt(this.Sd)),null!==this.ht&&(f.opacity=this.ht),this.Vd(f,i),u.push(f)}else{var h=n.clone();this.Sd&&(h.color=new lt(this.Sd)),null!==this.ht&&(h.opacity=this.ht),this.Vd(h,i),u.push(h)}if(this.Td=!1,!this.Fd){for(var l=0;l<u.length;l++)u[l].map&&this.od.push(u[l].name);this.Fd=!0}this.xi=new ba(t,u),this.Or&&this.Bh(),this.Bf||this.Id();var h=e.scale.split(","),t=(this.xi.scale.set(parseFloat(h[0]),parseFloat(h[2]),parseFloat(h[1])),e.rotate.split(",")),h=new xt,d=Math.PI/180,t=(h.set(parseFloat(t[0])*d,parseFloat(t[2])*d,parseFloat(t[1])*d),this.xi.rotation.setFromVector3(h,"YXZ"),e.translate.split(",")),d=new xt(this.G.Ie[0].x-r._t,this.G.Ie[0].y-r.Et,0).applyEuler(new Y(-Math.PI/2,0,0,"XYZ")).add(new xt(0,-1===this.G.height?2.2:this.G.height,0));d.add(new xt(parseFloat(t[0]),parseFloat(t[2]),parseFloat(t[1]))),this.xi.position.set(d.x,d.y,d.z),(this.xi.mapNode=this).Ht.xo.add(this.xi)}}},Bd:function(t,n){var e=this,r=this;if(n=n||{},!this.xi){var i=this.qi(g);if(i){var o=t.scene,s=this.jh.rotate.split(","),a=new xt,u=Math.PI/180,s=(a.set(parseFloat(s[0])*u,parseFloat(s[2])*u,parseFloat(s[1])*u),o.rotation.setFromVector3(a,"YXZ"),this.jh.scale.split(",")),u=(o.scale.set(parseFloat(s[0]),parseFloat(s[2]),parseFloat(s[1])),this.jh.translate.split(",")),a=new xt(this.G.Ie[0].x-i._t,this.G.Ie[0].y-i.Et,0).applyEuler(new Y(-Math.PI/2,0,0,"XYZ")).add(new xt(0,-1===this.G.height?2.2:this.G.height,0));if(a.add(new xt(parseFloat(u[0]),parseFloat(u[2]),parseFloat(u[1]))),o.position.set(a.x,a.y,a.z),this.xi=o,(this.xi.mapNode=this).Fd||(!function t(n){"Mesh"===n.type&&n.material.map&&r.od.push(n.material.map.name);var e=n.children;for(var i=0;i<e.length;i++)t(e[i])}(this.xi),this.Fd=!0),this.Bh(),this.Wd(function(){e.Ht.xo.add(e.xi),e.Qi&&(e.xi.visible=!0),e.Bf||e.Rr||e.Id({duration:!1===n.needFadeIn?0:void 0})}),0<t.animations.length){this.Hh=new Sb(this.xi);var c,f=Hb(t.animations);try{for(f.s();!(c=f.n()).done;){var h=c.value;this.Ml[h.name]=this.Hh.clipAction(h)}}catch(t){f.e(t)}finally{f.f()}s=this.qi(g);s.Oi.Yd(this.Hh),s.Ve.autoPlay&&(i=!1,null!==this.jd&&2200===this.jd&&(i=!0),this.startAction(this.getActionNames()[0],i,!0))}}}},Wd:function(i){var r=[],o=null;this.Rr?(function t(n){"Mesh"===n.type&&r.push(n);var e=n.children;for(var i=0;i<e.length;i++)t(e[i])}(this.xi),function t(){var n=!0;for(var e=0;e<r.length;e++)if(!r[e].isUpdateComplete){n=!1;break}n?(i&&i(),null!==o&&clearTimeout(o)):o=setTimeout(t,10)}()):i&&i()},Nr:function(t){var n=this.qi(g),e=this.qi(v);return(n=n.getMapOptions().materialMode===No.REAL?(e=this.Dr(t,e),n.fi.Br.Bu(e)):t.clone()).userData=t.userData,n},Qd:function(){var o=this,s=[],t=this.xi;if(this.Xl)this.xi.traverse(function(t){if("Mesh"===t.type)if(t.userData.sourceMaterial||(t.userData.sourceMaterial=t.material),Array.isArray(t.material)){for(var n=[],e=0;e<t.material.length;e++){var i=o.Nr(t.material[e]);i.transparent=!0,n.push(i)}t.material=n,s=s.concat(n)}else{var r=o.Nr(t.material);r.transparent=!0,t.material=r,s.push(r)}});else if(t.userData.sourceMaterial||(t.userData.sourceMaterial=t.material),Array.isArray(this.xi.material)){for(var n=[],e=0;e<this.xi.material.length;e++){var i=this.xi.material[e];i.transparent=!0,n.push(i.clone())}this.xi.material=n,s=s.concat(n)}else{t=this.xi.material.clone();t.transparent=!0,s.push(t),this.xi.material=t}return s},Zd:function(){function n(t){var n;t&&t.userData.sourceMaterial&&(n=t.material,t.material=t.userData.sourceMaterial,delete t.userData.sourceMaterial,Array.isArray(n)?n.forEach(function(t){t.dispose()}):n.dispose())}var t=this.xi;this.Xl&&t?this.xi.traverse(function(t){"Mesh"===t.type&&n(t)}):n(t),this.Bh()},Id:function(t){var o=this,t=void 0!==(t=t||{}).duration?t.duration:.5,s=this.qi(v),a=s.qi(g);if(this.Ad&&!1===this.Ad.qt){if(this.Md)return;this.Ad.stop()}this.Md=!0;var u=this.Qd();this.Ad.en([0]).rn([1]).sn(t).un(function(t){for(var n=t.destination[0],e=0;e<u.length;e++){var i=u[e],r=void 0!==o.ht?o.ht:i.userData.sourceOpacity;o.Xl&&a.getMapOptions().materialMode===No.REAL?i.uniforms.opacity.value=n*r*s.ht:i.opacity=n*r*s.ht}a.enableUpdateRender()}).cn(function(){a.Oi.ji(o.Ad),o.Zd()}),a.Oi.Ti(this.Ad.play())},Cd:function(t){var r=this,n=void 0!==(t=t||{}).duration?t.duration:.5,o=this.qi(v),s=o.qi(g);if(this.Ad&&!1===this.Ad.qt){if(!this.Md)return;this.Ad.stop()}this.Md=!1;var a=this.Qd();this.Ad.en([1]).rn([0]).sn(n).un(function(t){for(var n=t.destination[0],e=0;e<a.length;e++){var i=void 0!==r.ht?r.ht:a[e].userData.sourceOpacity;r.Xl&&s.getMapOptions().materialMode===No.REAL?a[e].uniforms.opacity.value=n*i*o.ht:a[e].opacity=n*i*o.ht}s.enableUpdateRender()}).cn(function(){s.Oi.ji(r.Ad),r.Rh(),s.enableUpdateNode(),t.finish&&t.finish()}),s.Oi.Ti(this.Ad.play())},qd:function(t,n){n=this.Dr(t,n);t.color=new lt(n.color),t.opacity=n.opacity,t.transparent=n.transparent},Bh:function(){var r=this;if(this.xi){var o=this.qi(g),s=this.qi(v);if(o){if(this.Xl)this.xi.traverse(function(t){if("Mesh"===t.type){var n=r.Dr(t.material,s);if(o.Ve.materialMode===No.REAL){var e=null;r.Rr?(e=o.fi.Br.Bu(n),r.Kd(e)):e=o.fi.Br.Ur(n),e.userData=t.material.userData,t.material=e,r.Or&&(n.color=r.Or,(e=o.fi.Br.Ur(n)).userData=t.material.userData,r.Rr&&r.Kd(e),t.userData.sourceMaterial=t.material,t.material=e)}else if(Array.isArray(t.material.length))for(var i=0;i<t.material.length;i++)t.material[i].depthWrite=!0,t.material[i]=o.fi.Br.Gr(t.material[i],n),r.Or&&(n.color=r.Or,t.userData.sourceMaterial=t.material,t.material[i]=o.fi.Br.Gr(t.material[i],n));else t.material.depthWrite=!0,t.material=o.fi.Br.Gr(t.material,n),r.Or&&(n.color=r.Or,t.userData.sourceMaterial=t.material,t.material=o.fi.Br.Gr(t.material,n));r.Rr&&(t.isUpdateComplete=!0)}});else{var t=this.xi.material;if(Array.isArray(t)){var n,e=[],i=Hb(t);try{for(i.s();!(n=i.n()).done;){var a,u=n.value;this.qd(u,s),this.Or&&((a=u.clone()).color=new lt(this.Or),e.push(a))}}catch(t){i.e(t)}finally{i.f()}this.Or&&(this.xi.userData.sourceMaterial=this.xi.material,this.xi.material=e)}else this.qd(t,s),this.Or&&((t=t.clone()).color=new lt(this.Or),this.xi.userData.sourceMaterial=this.xi.material,this.xi.material=t)}this.Td&&(this.Td=!1),o.enableUpdateRender()}}},Kd:function(t){t.uniforms.isMask.value=!0,t.uniforms.maskType.value=this.Pr,t.uniforms.maskTexture.value=this.jr,void 0!==this.Fr&&void 0!==this.Ir&&(t.uniforms.maskHeight.value=this.Fr,t.uniforms.maskExtrudeHeight.value=this.Ir),t.uniforms.boundCenter.value=this.Cr,t.uniforms.boundSize.value=this.kr,t.uniformsNeedUpdate=!0},Dr:function(t,n){var e={},i=(this.qi(g).Ve.materialMode===No.REAL?(t.constructor===Pd?(t.userData.sourceOpacity=t.opacity,t.userData.sourceTransparent=t.transparent,void 0===t.userData.originColor&&(t.userData.originColor=t.color),void 0===t.userData.originOpacity&&(t.userData.originOpacity=t.opacity),null===this.ht&&(this.ht=t.opacity),e={alphaTest:t.alphaTest,color:t.color.getHex(),USE_EMISSIVEMAP:!!t.emissiveMap,USE_METALNESSMAP:!!t.metalnessMap,USE_NORMALMAP:!!t.normalMap,TANGENTSPACE_NORMALMAP:!!t.normalMap,USE_ROUGHNESSMAP:!!t.roughnessMap,USE_MAP:!!t.map,USE_AOMAP:!!t.aoMap,map:r(t.map,null),aoMap:r(t.aoMap,null),emissive:t.emissive.getHex(),emissiveMap:r(t.emissiveMap,null),metalness:r(t.metalness,0),metalnessMap:r(t.metalnessMap,null),roughness:r(t.roughness,1),roughnessMap:r(t.roughnessMap,null),normalScale:r(t.normalScale,new Mt(1,1)),normalMap:r(t.normalMap,null),vertexColors:t.vertexColors,side:t.side,skinning:t.skinning}):t.constructor===nd&&(e={alphaTest:t.alphaTest,USE_EMISSIVEMAP:t.defines.USE_EMISSIVEMAP,USE_MAP:t.defines.USE_MAP,USE_AOMAP:t.defines.USE_AOMAP,USE_METALNESSMAP:t.defines.USE_METALNESSMAP,USE_NORMALMAP:t.defines.USE_NORMALMAP,TANGENTSPACE_NORMALMAP:t.defines.TANGENTSPACE_NORMALMAP,USE_ROUGHNESSMAP:t.defines.USE_ROUGHNESSMAP,aoMap:r(t.uniforms.aoMap.value,null),map:r(t.uniforms.map.value,null),color:t.uniforms.diffuse.value.getHex(),emissive:t.uniforms.emissive.value.getHex(),emissiveMap:r(t.uniforms.emissiveMap.value,null),metalness:r(t.uniforms.metalness.value,0),metalnessMap:r(t.uniforms.metalnessMap.value,null),roughness:r(t.uniforms.roughness.value,1),roughnessMap:r(t.uniforms.roughnessMap.value,null),normalScale:r(t.uniforms.normalScale.value,new Mt(1,1)),normalMap:r(t.uniforms.normalMap.value,null),vertexColors:t.vertexColors,side:t.side,skinning:t.skinning},void 0===t.userData.originColor&&(t.userData.originColor=t.uniforms.diffuse.value),void 0===t.userData.originOpacity&&(t.userData.originOpacity=t.uniforms.opacity.value),null===this.ht)&&(this.ht=t.userData.originOpacity),null===this.Sd&&(this.Sd=e.color)):(void 0===t.userData.sourceOpacity&&(t.userData.sourceOpacity=t.opacity),void 0===t.userData.sourceTransparent&&(t.userData.sourceTransparent=t.transparent),void 0===t.userData.originColor&&(t.userData.originColor=t.color),void 0===t.userData.originOpacity&&(t.userData.originOpacity=t.opacity),null===this.Sd&&(this.Sd=t.color),null===this.ht&&(this.ht=t.opacity)),this.Sd&&(e.color=this.Sd),void 0!==t.userData.sourceOpacity?t.userData.sourceOpacity:t.opacity);return null!==this.ht&&(i=this.ht),this.Vd(t,n),e.opacity=i*n.ht,e.transparent=t.userData.sourceTransparent||e.opacity<1,e;function r(t,n){return void 0!==t?t:n}},Rh:function(){var t;if(this.Hh&&(this.stopAction(this.getActionNames()[0],!0),(t=this.qi(g))&&t.Oi.Jd(this.Hh),this.Hh=null),this.Ad&&!1===this.Ad.qt&&this.Ad.finish(),this.xi&&"Mesh"===this.xi.type){if(this.xi.parent&&this.xi.parent.remove(this.xi),Array.isArray(this.xi.material)){var n,e=Hb(this.xi.material);try{for(e.s();!(n=e.n()).done;){var i=n.value;i.map&&this.Ld&&i.map.dispose(),i.dispose()}}catch(t){e.e(t)}finally{e.f()}}else this.xi.material.map&&this.Ld&&this.xi.material.map.dispose(),this.xi.material.dispose();this.xi.geometry.dispose(),this.xi.geometry=void 0,this.xi.material=void 0,this.xi.mapNode=void 0,this.xi=void 0}else this.xi&&"Scene"===this.xi.type&&(this.xi.parent&&this.xi.parent.remove(this.xi),this.xi.mapNode=void 0,this.xi=void 0)},xd:function(){var t=this.qi(g);t&&t.enableUpdateRender()}}),e);function Jb(t){return(Jb="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $b(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Jb(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Jb(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Jb(t)?t:String(t)}(i.key),i)}}function tg(t,n,e){n=eg(n);var i=t,n=ng()?Reflect.construct(n,e||[],eg(t).constructor):n.apply(t,e);if(n&&("object"===Jb(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function ng(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ng=function(){return!!t})()}function eg(t){return(eg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ig(t,n){return(ig=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var e=function(){var t,n=i,e=cb;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(this instanceof i)return(n=tg(this,i)).G=t,n.nt=t.height,n.Fe=S.FACILITY,n.Fo=0,n.$d=null,n.Ue=new Map,n.jh=null,n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&ig(n,e),n=i,(e=[{key:"FID",get:function(){return this.G.fid}},{key:"typeID",get:function(){return this.G.type}},{key:"eName",get:function(){return this.G.ename}},{key:"name",get:function(){return this.G.name}},{key:"size",get:function(){return this.$d||this.jh.height},set:function(t){var n;this.$d=t,this.$d?this.Fo=this.$d:(t=this.qi(g),n=this.qi(Go),this.jh=t.fi.Dh.Ic({fid:this.G.fid,typeID:""+this.G.type,bid:n.je}),this.Fo=this.jh.height),this.Bh()}},{key:"scaleSize",get:function(){return this.size/this.Fo||1}},{key:"jump",value:function(t){return vy(this,t)}},{key:"stopJump",value:function(){return py(this)}},{key:"boost",value:function(t){return ly(this,t)}},{key:"stopBoost",value:function(){return dy(this)}},{key:"getPosition",value:function(){return{x:this.G.Ie[0].x,y:this.G.Ie[0].y,z:this.nt}}},{key:"updateMaterialByThemeTool",value:function(t){this.jh=t,this.Fo=parseInt(this.jh.height),this.$d&&(this.Fo=this.$d),this.Bh(),this.xi.userData.size=this.Fo}}])&&$b(n.prototype,e),t&&$b(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),rg=(Object.assign(e.prototype,{wc:function(){var t,n;if(!this.xi)return t=this.qi(g),n=this.qi(Go),this.jh=t.fi.Dh.Ic({fid:this.G.fid,typeID:""+this.G.type,bid:n.je}),this.Fo=parseInt(this.jh.height),(n=this.Lr(t)).userData.opacity=n.opacity,this.xi=new xm(n),n=new xt((n=this.G.Ie[0]).x-t._t,-n.y+t.Et,0).applyEuler(new Y(Math.PI/2,0,0,"XYZ")).add(new xt(0,this.nt,0)),this.xi.position.copy(n),this.Io(t.fi),this.xi.userData.size=this.Fo,(this.xi.mapNode=this).Ht.xo.add(this.xi),!0},Uh:function(t,n){var e;this.xi&&(e=this.qi(Go),this.jh=n.Ic({fid:this.G.fid,typeID:""+this.G.type,bid:e.je}),this.Fo=parseInt(this.jh.height),this.Bh(),this.xi.userData.size=this.Fo)},Bh:function(){var t;this.xi&&(t=this.qi(g))&&(this.xi.material=this.Lr(t))},Lr:function(t){var n=this,e=this.qi(v),i=e.parent;return t.fi.Br.qu({opacity:e.ht,needDepth:!1,url:t.fi.Xd(this.jh,"path",i.buildingID)+this.jh.imageName},function(){n.Io(t.fi),t.fi.$o(),t.enableUpdateRender()})},Io:function(t){my(t,this)}}),e);function og(t){return(og="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function sg(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=og(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=og(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==og(t)?t:String(t)}(i.key),i)}}var e=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.tv=t,this.nv=0,this.ev="";t=this.tv.parent.parent.iv(this.tv.FID);this.Ie=t.G.Ie[0],this.rv=t.getArea()}var t,e,i;return t=n,(e=[{key:"renderNode",get:function(){return this.ov}}])&&sg(t.prototype,e),i&&sg(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}(),ag=(Object.assign(e.prototype,{sv:function(r){var o=this;return new Promise(function(n,t){var e,i;o.av?n():r?(e=[],o.Ie.forEach(function(t){e.push(t.x,t.y)}),i=new ArrayBuffer(8*e.length),new Float64Array(i).set(e),r.Ho({type:"maxInnerRect",coords:i},[i]).then(function(t){o.av=t.result.rect,n()})):(o.av=uy.maxInnerRect(o.Ie),n())})},nn:function(){this.ov&&(this.ov=null,this.Ie=null)},cv:function(t){var n=this.av,e=n.size.x,i=n.size.y;return e<=0||i<=0?{x:1,y:1}:(e/i<(t=t.width/t.height)?i=e/t:e=i*t,{x:e/n.size.x,y:i/n.size.y})},wc:function(t){var n;"MeshBasicMaterial"===t.type&&0<this.tv.fv.length&&(n=new Fs(this.av.size.x,this.av.size.y,1,1),this.ov=new ba(n,t),this.ov.renderOrder=10,this.nv=0,this.hv=this.tv.G.xe.center,this.ov.rotation.set(-Math.PI/2,0,0,"XYZ"),this.lv(t))},lv:function(t){var n,e;this.ov&&t&&"MeshBasicMaterial"===t.type&&t.map&&(this.ov.material=t,n=this.tv.jh,t=this.cv(t.map.image),n.sizes&&(e=n.sizes.split(","),t={x:t.x*parseFloat(e[0]),y:t.y*parseFloat(e[1])}),e=void 0!==n.angle?n.angle:0,this.ov.scale.set(t.x,t.y,1),this.ov.rotation.z=-e*Math.PI/180,t=this.tv.Lt,e=[this.av.center.x-t.x,t.y-this.av.center.y],n.coords&&(n=n.coords.split(","),e=[parseFloat(n[0])-t.x,t.y-parseFloat(n[1])]),null!=(t=this.tv))&&null!=(t=t.xi)&&t.position.set(e[0],this.tv.G.height+.01,e[1])}}),e),ug=Object.freeze({Cubic:Object.freeze({In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}})});function cg(t){return(cg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fg(){fg=function(){return s};var u,s={},t=Object.prototype,c=t.hasOwnProperty,f=Object.defineProperty||function(t,n,e){t[n]=e.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",e=n.asyncIterator||"@@asyncIterator",r=n.toStringTag||"@@toStringTag";function o(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{o({},"")}catch(u){o=function(t,n,e){return t[n]=e}}function a(t,n,e,i){var r,o,s,a,n=n&&n.prototype instanceof y?n:y,n=Object.create(n.prototype),i=new A(i||[]);return f(n,"_invoke",{value:(r=t,o=e,s=i,a=l,function(t,n){if(a===v)throw new Error("Generator is already running");if(a===p){if("throw"===t)throw n;return{value:u,done:!0}}for(s.method=t,s.arg=n;;){var e=s.delegate;if(e){e=function t(n,e){var i=e.method,r=n.iterator[i];if(r===u)return e.delegate=null,"throw"===i&&n.iterator.return&&(e.method="return",e.arg=u,t(n,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),m;i=h(r,n.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,m;r=i.arg;return r?r.done?(e[n.resultName]=r.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=u),e.delegate=null,m):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}(e,s);if(e){if(e===m)continue;return e}}if("next"===s.method)s.sent=s.Mt=s.arg;else if("throw"===s.method){if(a===l)throw a=p,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);a=v;e=h(r,o,s);if("normal"===e.type){if(a=s.done?p:d,e.arg===m)continue;return{value:e.arg,done:s.done}}"throw"===e.type&&(a=p,s.method="throw",s.arg=e.arg)}})}),n}function h(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}s.wrap=a;var l="suspendedStart",d="suspendedYield",v="executing",p="completed",m={};function y(){}function b(){}function g(){}var n={},w=(o(n,i,function(){return this}),Object.getPrototypeOf),w=w&&w(w(M([]))),_=(w&&w!==t&&c.call(w,i)&&(n=w),g.prototype=y.prototype=Object.create(n));function E(t){["next","throw","return"].forEach(function(n){o(t,n,function(t){return this._invoke(n,t)})})}function S(s,a){var n;f(this,"_invoke",{value:function(e,i){function t(){return new a(function(t,n){!function n(t,e,i,r){var o,t=h(s[t],s,e);if("throw"!==t.type)return(e=(o=t.arg).value)&&"object"==cg(e)&&c.call(e,"__await")?a.resolve(e.Ot).then(function(t){n("next",t,i,r)},function(t){n("throw",t,i,r)}):a.resolve(e).then(function(t){o.value=t,i(o)},function(t){return n("throw",t,i,r)});r(t.arg)}(e,i,t,n)})}return n=n?n.then(t,t):t()}})}function T(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function x(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function M(n){if(n||""===n){var e,t=n[i];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return e=-1,(t=function t(){for(;++e<n.length;)if(c.call(n,e))return t.value=n[e],t.done=!1,t;return t.value=u,t.done=!0,t}).next=t}throw new TypeError(cg(n)+" is not iterable")}return f(_,"constructor",{value:b.prototype=g,configurable:!0}),f(g,"constructor",{value:b,configurable:!0}),b.displayName=o(g,r,"GeneratorFunction"),s.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},s.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,o(t,r,"GeneratorFunction")),t.prototype=Object.create(_),t},s.awrap=function(t){return{Ot:t}},E(S.prototype),o(S.prototype,e,function(){return this}),s.AsyncIterator=S,s.async=function(t,n,e,i,r){void 0===r&&(r=Promise);var o=new S(a(t,n,e,i),r);return s.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},E(_),o(_,r,"Generator"),o(_,i,function(){return this}),o(_,"toString",function(){return"[object Generator]"}),s.keys=function(t){var n,e=Object(t),i=[];for(n in e)i.push(n);return i.reverse(),function t(){for(;i.length;){var n=i.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},s.values=M,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this.Mt=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(x),!t)for(var n in this)"t"===n.charAt(0)&&c.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=u)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function t(t,n){return o.type="throw",o.arg=e,i.next=t,n&&(i.method="next",i.arg=u),!!n}for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var s=c.call(r,"catchLoc"),a=c.call(r,"finallyLoc");if(s&&a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var o=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=n&&n<=r.finallyLoc?null:r)?r.completion:{};return o.type=t,o.arg=n,r?(this.method="next",this.next=r.finallyLoc,m):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),m},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),x(e),m}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e,i,r=this.tryEntries[n];if(r.tryLoc===t)return"throw"===(e=r.completion).type&&(i=e.arg,x(r)),i}throw new Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:M(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=u),m}},s}function hg(t,n,e,i,r,o,s){try{var a=t[o](s),u=a.value}catch(t){return void e(t)}a.done?n(u):Promise.resolve(u).then(i,r)}function lg(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=cg(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=cg(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==cg(t)?t:String(t)}(i.key),i)}}function dg(t,n,e){n=pg(n);var i=t,n=vg()?Reflect.construct(n,e||[],pg(t).constructor):n.apply(t,e);if(n&&("object"===cg(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return mg(i)}function vg(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(vg=function(){return!!t})()}function pg(t){return(pg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function mg(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function yg(t,n){return(yg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var e=function(){var t,n=i,e=cb;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t,n){var e;if(this instanceof i)return(e=dg(this,i)).G=t,e.Lt=n,e.Fe=S.LABEL,e.jh=null,e.dv=null,e.Wo=!1,e.Bf=null,n.Ft.vv===Hm.ENAME?e.fv=t.ename:n.Ft.vv===Hm.FID?e.fv=t.fid:e.fv=t.name,e.fv||(e.fv="",e.Wo=!0),e.pv=n.Ve.HDText,!0===e.pv&&st.a.environment===G.a.BROWSER&&(e.mv=new st.a.LabelCollection,e.tv=null),e.yv=null,e.bv=!0,e.gv=!0,e.wv=!0,e._v=!0,e.Ev=!0,e.Sv=!0,e.Tv={show:!1},e.Vo=e.Lt.getMapOptions().labelFade,e.Rh=e.Rh.bind(mg(e)),e.xv=new Wi,e;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&yg(n,e),n=i,(e=[{key:"FID",get:function(){return this.G.fid}},{key:"typeID",get:function(){return this.G.type}},{key:"name",get:function(){return this.G.name}},{key:"eName",get:function(){return this.G.ename}},{key:"text",get:function(){return this.fv},set:function(t){t?(this.fv=t,this.Wo=!1):(this.fv="",this.Wo=!0),this.xi&&(this.Bh(),this.Rf()),this.Ev=!0,this.Sv=!0}},{key:"fontSize",get:function(){return this.yv||this.jh.fontsize},set:function(t){this.yv=t,this.yv?this.jh.fontsize=this.yv:this.Av(this.Lt.fi,this.Lt.fi.Dh),this.xi&&this.Bh(),this.Ev=!0,this.Sv=!0}},{key:"setText",value:function(t){this.text=t}},{key:"fading",get:function(){return!this.xv.qt}},{key:"initTargetShow",get:function(){return this.gv},set:function(t){t!==this.gv&&(this.gv=t,this.Sv=!0)}},{key:"collisionTargetShow",get:function(){return this._v},set:function(t){t!==this._v&&(this._v=t,this.Ev=!0)}}])&&lg(n.prototype,e),t&&lg(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),bg=(Object.assign(e.prototype,{Ph:function(){this.Lt.Oi.ji(this.xv)},Qo:function(){var t;!this.Vo||!1===this.Sv&&0==this.Ev||(this.gv&&this._v&&!this.Tv.show&&this.Mv(0,1),(this.gv&&this._v&&this.Tv.show?this.Mv(1,1):this.gv&&this._v||!this.Tv.show?(t=this.Sv?this.Rh:null,this.Mv(0,0,t)):(t=this.Sv?this.Rh:null,this.Mv(1,0,t)))&&(this.Sv&&(this.Sv=!1,this.bv=this.gv),this.Ev)&&(this.Ev=!1,this.wv=this._v),"1"!==(null==(t=this.jh)?void 0:t.mode))||this.gv||this.Rh()},Ov:function(t){var n=this;return this.fontSize=t,new Promise(function(t){!1===n.pv&&t(),n.readyCallback=t})},Lv:function(){var n=this;return new Promise(function(t){!1===n.pv||n.pv&&n.xi&&1<n.xi.children.length?t():n.readyCallback=t})},Rv:function(n,t){var e,i,r,o,s=this;n&&t&&(this.mv||(this.mv=new st.a.LabelCollection,this.tv=null),e=t.width,i=t.drawTextWidth,r=t.drawTextLeft,t=this.fontSize,this.mv.map=n,this.tv?(o=this.tv).labelMeshInstance&&(this.xi.remove(o.labelMeshInstance.mesh),this.xi.remove(o.labelOutlineMeshInstance.mesh)):(o=this.mv.add(),this.tv=o),o.Nv=!0,o.Pv=[],o.jv=!0,o.rootNode=this.xi,o.text=this.fv,o.font="".concat(t,"px ").concat(this.jh.fontFamily||'"Microsoft Yahei","",Tahoma,Arial'),o.Fv=Xi.rgbToArray(this.jh.fillColor),o.outlineWidth=void 0!==this.jh.strokeWidth?2*this.jh.strokeWidth:4,o.outlineColor=Xi.rgbToArray(this.jh.strokeColor),o.pixelRatio=n.Dt.renderer.getPixelRatio(),this.Iv=t=function t(){s.mv.update(),!1===o.Nv&&(o.pixelOffset=[(r+i/2-e/2)/2/1.2,0],n.enableUpdateRender(),n.off("update",t),s.readyCallback)&&s.readyCallback()},n.on("update",t),n.on("pixelRatioChanged",function(){o.pixelRatio=n.Dt.renderer.getPixelRatio()}))},Cv:function(){var t=this.Lr(),t=(t.userData.opacity=t.opacity,this.kv&&this.kv.nn(),new xm(t));t.scale.set(0,0,0),this.xi.add(t);var t=(t.mapNode=this).qi(v).Ht.Ht,n=this.G.Ie[0],n=new xt(n.x-t._t,-n.y+t.Et,0).applyEuler(new Y(Math.PI/2,0,0,"XYZ")).add(new xt(0,this.G.height,0));this.xi.position.copy(n)},initTopMesh:function(){var a,i=this;return a=fg().mark(function t(){var n,e;return fg().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i.kv||(i.kv=new ag(i,i.Lt)),t.next=3,i.kv.sv(i.Lt.fi.Dv);case 3:if(i.xi){t.next=5;break}return t.abrupt("return");case 5:if("1"!==(null==(e=i.jh)?void 0:e.mode))return t.abrupt("return");t.next=7;break;case 7:(e=i.Lr()).opacity=1,e.userData.opacity=e.opacity,i.xi.visible=!0,null!=(n=i.kv)&&n.wc(e),null!=(n=i.kv)&&n.renderNode&&((i.kv.renderNode.mapNode=i).xi.add(i.kv.renderNode),i.Lt.enableUpdateNode());case 13:case"end":return t.stop()}},t)}),function(){var t=this,s=arguments;return new Promise(function(n,e){var i=a.apply(t,s);function r(t){hg(i,n,e,r,o,"next",t)}function o(t){hg(i,n,e,r,o,"throw",t)}r(void 0)})}()},wc:function(){var t;this.xi||(t=this.qi(v).Ht.Ht,this.Av(this.Lt.fi,t.fi.Dh),this.xi=new wc,"1"===(this.xi.mapNode=this).jh.mode?(this.pv=!1,this.tv&&(this.tv.labelMeshInstance&&(this.xi.remove(this.tv.labelMeshInstance.mesh),this.xi.remove(this.tv.labelOutlineMeshInstance.mesh)),this.tv=null,t.off("update",this.Iv)),0<this.fv.length&&this.initTopMesh()):(this.pv=t.Ve.HDText,this.Cv()),this.Io(this.Lt.fi),this.Ht.xo.add(this.xi),this.Bf&&this.Bf.wc(this))},Uh:function(t,n){this.xi&&(this.Sv=!0,this.Ev=!0,this.Av(t,n),this.Bh())},Bh:function(){var t,n,e=this;this.xi&&(this.xi.children[0]?this.qi(g)&&(t="1"===this.jh.mode?"Mesh":"Sprite","Mesh"===(n=this.xi.children[0].type)&&"Mesh"!=t||"Sprite"===n&&"Sprite"!=t?(this.Rh(),this.wc()):this.Lr(function(t){var n;e.xi&&(n=e.xi.children[0].material,e.xi.children[0].material=t,n.map&&(n.map.dispose(),n.map=null),n.dispose())})):this.kv&&(this.Rh(),this.Lt.enableUpdateNode()))},Mv:function(){var e=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,t=2<arguments.length?arguments[2]:void 0;if(!this.xi||this.xi.children.length<1)return null;if(this.fv.length<1)return this.xi.visible=!1,null;this.xv.stop();var n=this.qi(v),o=this.jh.alpha*n.ht,n=(this.Tv.show=1==r,"1"!==(null==(n=this.jh)?void 0:n.mode));return n||(r=1),this.Lt.Nt.controls.activeing&&n?(1===r&&(this.xi.visible=!0),0===i&&0===r?(this.xi.children.forEach(function(t){t.material.opacity=0}),this.tv&&(this.tv.opacity=0),this.Lt.enableUpdateRender()):(1===i?i=o:1===r&&(r=o),this.xv.en([i]).rn([r]).sn(.2).un(function(t){var n=t.destination[0],t=(e.xi.children.forEach(function(t){t.material.opacity=n,e.Lt.enableUpdateRender()}),ug.Cubic.In(n/Math.max(i,r)));e.tv&&(e.tv.opacity=t)}).cn(function(){t&&t(e),e.Lt.Oi.ji(e.xv)}).tn(),this.Lt.Oi.Ti(this.xv))):(this.xi.visible=1==r,this.xi.children.forEach(function(t){t.material.opacity=o}),this.tv&&(this.tv.opacity=o),this.Lt.enableUpdateRender()),1},Lr:function(e){var i=this,t=this.qi(v),r={scale:2,needSize:!0,opacity:this.jh.alpha*t.ht,drawText:!this.pv},t=(this.jh.image&&(r.imageUrl=this.dv+this.jh.image),this.Lt.fi.Br);return("1"===this.jh.mode?t.Qu:t.Vu).bind(t)(this.fv,this.jh,r,function(t){var n;e&&e(t),i.Vo&&(t.opacity=0,i.Sv=!0,i.Ev=!0,i.Qo()),i.xi&&i.Io(i.Lt.fi),void 0!==r.imageUrl&&i.Lt.fi.$o(),st.a.environment===G.a.WX&&i.Lt.fi.$o(),i.kv&&i.kv.lv(t),!0===i.pv?(t.map&&(t.map.minFilter=Vn,t.map.magFilter=Vn),i.Rv(i.Lt,null==(n=t.map)?void 0:n.image),i.tv.opacity=t.opacity):i.readyCallback&&i.readyCallback(),i.Qo(1),i.Lt.enableUpdateRender()})},Io:function(t){var n,e,i=this.xi.children[0];i&&i.material.map&&i.material.map.image&&(n=i.material).userData.mspriteScale&&(t=t.Jf(this.fontSize),e=2*this.fontSize*1.2,e=n.map.image.height/e,n.userData.mspriteScale=Math.max(e,n.userData.mspriteScale),i.scale.set(t,t,t),i.scale.multiplyScalar(n.userData.mspriteScale),i.scale.setX(i.scale.x/n.userData.scaleRatio))},Av:function(t,n){var e=this.qi(Go),n=(this.jh=n.Cc({fid:this.G.fid,typeID:this.G.type+"",bid:e.je}),this.yv&&(this.jh.fontsize=this.yv),this.dv=t.Xd(this.jh,"path",e.buildingID),parseInt(this.fontSize));isNaN(n)},updateMaterialByThemeTool:function(t){this.jh=t;var t=this.qi(v).Ht,n=t.Ht.fi;this.dv=n.Xd(this.jh,"path",t.buildingID),this.Bh()}}),e);function gg(t){return(gg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wg(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=gg(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=gg(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==gg(t)?t:String(t)}(i.key),i)}}function _g(t,n,e){n=Sg(n);var i=t,n=Eg()?Reflect.construct(n,e||[],Sg(t).constructor):n.apply(t,e);if(n&&("object"===gg(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function Eg(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Eg=function(){return!!t})()}function Sg(t){return(Sg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Tg(t,n){return(Tg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var e=function(){var t,n=i,e=Fo;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(this instanceof i)return(n=_g(this,i)).nt=void 0!==(t=t||{}).height?t.height:1,n._t=t.x,n.Et=t.y,n.xi=null,n.th=!1,n.Oh=void 0,n.Uv=t.userID,void 0===n.Uv&&(n.Uv=""+Xi.generateUUID()),n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Tg(n,e),n=i,(e=[{key:"userID",get:function(){return this.Uv},set:function(t){this.Uv=t}},{key:"isInit",get:function(){return this.th},set:function(t){this.th=t}},{key:"isbloom",get:function(){return this.Oh},set:function(t){this.Oh=t}},{key:"x",get:function(){return this._t}},{key:"y",get:function(){return this.Et}},{key:"height",get:function(){return this.nt},set:function(t){this.nt=t,this.Bv()}},{key:"level",get:function(){var t=this.qi(v);return t?t.level:null}},{key:"visible",get:function(){return this.Qi},set:function(t){this.Qi=t,this.xi&&(this.xi.visible=this.Qi,t=this.qi(g))&&t.enableUpdateRender()}},{key:"opacity",get:function(){return this.ht},set:function(t){this.ht=t,this.xi&&(this.xi.material.opacity=this.ht)}},{key:"isMarker",get:function(){return!0}},{key:"bound",get:function(){var n=this;return[S.IMAGE_MARKER,S.DOM_MARKER,S.DYNAMIC_MODEL_MARKER,S.LOCATION_MARKER,S.TEXT_MARKER].find(function(t){return t===n.Fe})?!0===this.needUpdateBound&&(this.xe.reset(),void 0!==this._t)&&void 0!==this.Et&&(this.xe.expandByCoords([{x:this._t,y:this.Et}]),this.needUpdateBound=!1):!0===this.needUpdateBound&&(this.xe.reset(),this.xe.expandByCoords(this.Kf),this.needUpdateBound=!1),this.xe.clone()}},{key:"addTo",value:function(t){t.getOrCreateLayer(this.Fe).add(this),this.xi&&(null!=(t=this.xi)&&t.updateMatrixWorld(!0),null!=(t=this.xi))&&null!=(t=t.parent)&&t.updateMatrixWorld(!0)}},{key:"remove",value:function(){var t=this.qi(g);this.Ht&&this.Ht.remove(this),t&&t.enableUpdateRender()}},{key:"dispose",value:function(){var n=this;this.remove(),this.xi&&(this.xi.traverse(function(t){t instanceof ba&&(t.geometry.dispose(),t.geometry=void 0,Array.isArray(t.material)?t.material.forEach(function(t){n.Gv(t)}):n.Gv(t.material)),"SkinnedMesh"===t.type&&(t.skeleton.boneTexture&&t.skeleton.boneTexture.dispose(),t.skeleton.dispose())}),this.xi.mapNode=void 0,this.xi=void 0),this.th=!1}}])&&wg(n.prototype,e),t&&wg(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),xg=(Object.assign(e.prototype,{Gv:function(t){if(t){if(t instanceof nd){var n,e=t.uniforms;for(n in e)e[n]&&e[n].value instanceof l&&e[n].value.dispose();t.dispose()}else for(var i in t)t[i]&&t[i]instanceof l&&t[i].dispose();t.dispose()}},Hv:function(){var t;void 0!==this._t&&void 0!==this.Et||(t=this.qi(v),this._t=t.center.x,this.Et=t.center.y)},wc:function(){return!1},Bv:function(){}}),e);function Ag(t){return(Ag="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Mg(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Ag(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Ag(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Ag(t)?t:String(t)}(i.key),i)}}function Og(t,n,e){return n&&Mg(t.prototype,n),e&&Mg(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Lg(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function Rg(t,n,e){n=Pg(n);var i=t,n=Ng()?Reflect.construct(n,e||[],Pg(t).constructor):n.apply(t,e);if(n&&("object"===Ag(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return jg(i)}function Ng(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ng=function(){return!!t})()}function Pg(t){return(Pg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function jg(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Fg(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),n&&Ig(t,n)}function Ig(t,n){return(Ig=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Cg=function(){function n(){var t;return Lg(this,n),(t=Rg(this,n)).isMeshLine=!0,t.type="MeshLine",t.positions=[],t.previous=[],t.next=[],t.side=[],t.width=[],t.indices_array=[],t.uvs=[],t.counters=[],t.Kf=[],t.Xv=null,t.widthCallback=null,t.matrixWorld=new At,Object.defineProperties(jg(t),{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this.Xv},set:function(t){this.setGeometry(t,this.widthCallback)}},points:{enumerable:!0,get:function(){return this.Kf},set:function(t){this.setPoints(t,this.widthCallback)}}}),t}return Fg(n,N),Og(n)}();function kg(t,n){var e=new At,i=new Mo,r=new kt,o=new xt,s=this.geometry;if(s.boundingSphere||s.computeBoundingSphere(),r.copy(s.boundingSphere),r.applyMatrix4(this.matrixWorld),!1!==t.ray.intersectSphere(r,o)){e.copy(this.matrixWorld).invert(),i.copy(t.ray).applyMatrix4(e);var a=new xt,u=new xt,c=new xt,f=this instanceof Ov?2:1,r=s.index,e=s.attributes;if(null!==r)for(var h=r.array,l=e.position.array,d=e.width.array,v=0,p=h.length-1;v<p;v+=f){var m=h[v],y=h[v+1],m=(a.fromArray(l,3*m),u.fromArray(l,3*y),void 0!==d[Math.floor(v/3)]?d[Math.floor(v/3)]:1),y=t.params.Line.threshold+this.material.lineWidth*m/2;y*y<i.distanceSqToSegment(a,u,o,c)||(o.applyMatrix4(this.matrixWorld),(m=t.ray.origin.distanceTo(o))<t.near)||m>t.far||(n.push({distance:m,point:c.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this}),v=p)}}}function Dg(t,n,e,i,r){var o;if(t=t.subarray||t.slice?t:t.buffer,e=e.subarray||e.slice?e:e.buffer,t=n?t.subarray?t.subarray(n,r&&n+r):t.slice(n,r&&n+r):t,e.set)e.set(t,i);else for(o=0;o<t.length;o++)e[o+i]=t[o]}Cg.prototype.setMatrixWorld=function(t){this.matrixWorld=t},Cg.prototype.setGeometry=function(t,n){this.zv=t,this.setPoints(t.getAttribute("position").array,n)},Cg.prototype.setPoints=function(t,n){if(t instanceof Float32Array||t instanceof Array){this.Kf=t,this.widthCallback=n,this.positions=[],this.counters=[];var e=!0;if(0!==t.length){if(t.length&&t[0]instanceof xt)for(var i=0;i<t.length;i++){var r=t[i];if(isNaN(""+r.x)||isNaN(""+r.y)||isNaN(""+r.z)){e=!1;break}var o=i/t.length;this.positions.push(r.x,r.y,r.z),this.positions.push(r.x,r.y,r.z),this.counters.push(o),this.counters.push(o)}else for(i=0;i<t.length;i+=3){o=i/t.length;if(isNaN(""+t[i])||isNaN(""+t[i+1])||isNaN(""+t[i+2])){e=!1;break}this.positions.push(t[i],t[i+1],t[i+2]),this.positions.push(t[i],t[i+1],t[i+2]),this.counters.push(o),this.counters.push(o)}e&&this.process()}}else console.error("ERROR: The BufferArray of points is not instancied correctly.")},Cg.prototype.raycast=kg,Cg.prototype.compareV3=function(t,n){t*=6,n*=6;return this.positions[t]===this.positions[n]&&this.positions[1+t]===this.positions[1+n]&&this.positions[2+t]===this.positions[2+n]},Cg.prototype.copyV3=function(t){t*=6;return[this.positions[t],this.positions[1+t],this.positions[2+t]]},Cg.prototype.process=function(){var t,n=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],t=this.compareV3(0,n-1)?this.copyV3(n-2):this.copyV3(0),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);for(var e,i=0;i<n;i++)this.side.push(1),this.side.push(-1),e=this.widthCallback?this.widthCallback(i/(n-1)):1,this.width.push(e),this.width.push(e),this.uvs.push(i/(n-1),0),this.uvs.push(i/(n-1),1),i<n-1&&(t=this.copyV3(i),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]),this.indices_array.push(e=2*i,1+e,2+e),this.indices_array.push(2+e,1+e,3+e)),0<i&&(t=this.copyV3(i),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]));t=this.compareV3(n-1,0)?this.copyV3(1):this.copyV3(n-1),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]),this.Vv&&this.Vv.position.count===this.positions.length?(this.Vv.position.copyArray(new Float32Array(this.positions)),this.Vv.position.needsUpdate=!0,this.Vv.previous.copyArray(new Float32Array(this.previous)),this.Vv.previous.needsUpdate=!0,this.Vv.next.copyArray(new Float32Array(this.next)),this.Vv.next.needsUpdate=!0,this.Vv.side.copyArray(new Float32Array(this.side)),this.Vv.side.needsUpdate=!0,this.Vv.width.copyArray(new Float32Array(this.width)),this.Vv.width.needsUpdate=!0,this.Vv.uv.copyArray(new Float32Array(this.uvs)),this.Vv.uv.needsUpdate=!0,this.Vv.index.copyArray(new Uint16Array(this.indices_array)),this.Vv.index.needsUpdate=!0):this.Vv={position:new R(new Float32Array(this.positions),3),previous:new R(new Float32Array(this.previous),3),next:new R(new Float32Array(this.next),3),side:new R(new Float32Array(this.side),1),width:new R(new Float32Array(this.width),1),uv:new R(new Float32Array(this.uvs),2),index:new R(new Uint16Array(this.indices_array),1),counters:new R(new Float32Array(this.counters),1)},this.setAttribute("position",this.Vv.position),this.setAttribute("previous",this.Vv.previous),this.setAttribute("next",this.Vv.next),this.setAttribute("side",this.Vv.side),this.setAttribute("width",this.Vv.width),this.setAttribute("uv",this.Vv.uv),this.setAttribute("counters",this.Vv.counters),this.setIndex(this.Vv.index),this.computeBoundingSphere(),this.computeBoundingBox()},Cg.prototype.advance=function(t){var n=this.Vv.position.array,e=this.Vv.previous.array,i=this.Vv.next.array,r=n.length;Dg(n,0,e,0,r),Dg(n,6,n,0,r-6),n[r-6]=t.x,n[r-5]=t.y,n[r-4]=t.z,n[r-3]=t.x,n[r-2]=t.y,n[r-1]=t.z,Dg(n,6,i,0,r-6),i[r-6]=t.x,i[r-5]=t.y,i[r-4]=t.z,i[r-3]=t.x,i[r-2]=t.y,i[r-1]=t.z,this.Vv.position.needsUpdate=!0,this.Vv.previous.needsUpdate=!0,this.Vv.next.needsUpdate=!0},_.meshline_vert=["",_.logdepthbuf_pars_vertex,_.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float sizeAttenuation;","uniform vec2 offset;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","varying vec2 vUvPass;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","","    vColor = vec4( color, opacity );","    vUV = uv + offset;","\t vUvPass=uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float w = lineWidth * width;","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );","    normal.xy *= .5 * w;","    normal *= projectionMatrix;","    if( sizeAttenuation == 0. ) {","        normal.xy *= finalPosition.w;","        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;","    }","","    finalPosition.xy += normal.xy * side;","","    gl_Position = finalPosition;","",_.logdepthbuf_vertex,_.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",_.fog_vertex,"}"].join("\n"),_.meshline_frag=["",_.fog_pars_fragment,_.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","uniform bool ispassed;","uniform vec3 passColor;","uniform float currentPercent;","uniform float beginPercent;","uniform float endPercent;","uniform bool isGradient;","uniform float gradientPercent[{num}];","uniform vec4 gradientColor[{num}];","uniform float gradientBegin;","uniform float gradientEnd;","uniform bool isArrow;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","varying vec2 vUvPass;","","void main() {","",_.logdepthbuf_fragment,"","    vec4 c = vColor;","\t vec4 gColor=vec4(0.0,0.0,0.0,0.0);","    if(isGradient){","\t\tfloat value = gradientBegin + vUvPass.x * (gradientEnd - gradientBegin);","\t\tvec4 colorBegin=gradientColor[0];","\t\tvec4 colorEnd=gradientColor[0];","\t\tfloat bPercent=gradientPercent[0];","       float ePercent=gradientPercent[0];","\t\tfor(int i=0;i<{num};i++){","\t\t\tif(value>=gradientPercent[i]){","\t\t\t\tcolorBegin=gradientColor[i];","\t\t\t\tcolorEnd=gradientColor[i];","\t\t\t\tbPercent=gradientPercent[i];","\t\t\t\tePercent=gradientPercent[i];","\t\t\t\tif(i+1<={num}-1){","\t\t\t\t\tcolorEnd=gradientColor[i+1];","\t\t\t\t\tePercent=gradientPercent[i+1];","\t\t\t\t}","\t\t\t}","\t\t}","\t\tfloat perCent=(value-bPercent)/(ePercent-bPercent);","\t\tgColor=mix(colorBegin,colorEnd,perCent);","\t }","    if( useMap == 1. ) {","\t \tc = texture2D( map, vUV * repeat );","\t\tif(isArrow){","    \t\tc=c+gColor;","\t\t} else {","\t\t\tif(isGradient){","\t\t\t\tc.rgb=gColor.rgb;","\t\t\t}","\t\t}","\t } else {","       c = vColor;","\t\tif(isGradient){","\t\t\tc=gColor;","\t\t\tc.a=vColor.a;","\t\t}","\t }","\t if(ispassed) {","\t\tif(currentPercent>=endPercent){","\t\t\tc=vec4(passColor,vColor.a);","\t\t} else {","\t\t\tif((endPercent-currentPercent)<(1.0-vUvPass.x)*(endPercent-beginPercent)){","\t\t\t\tc=vec4(passColor,vColor.a);","\t\t\t}","\t\t}","\t }","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",_.fog_fragment,"}"].join("\n");var Ug=function(){function e(t,n){return Lg(this,e),(n=Rg(this,e,[{uniforms:Object.assign({},Lt.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new lt(16777215)},opacity:{value:1},resolution:{value:new Mt(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new Mt(1,1)},offset:{value:new Mt(1,1)},ispassed:{value:!1},passColor:{value:new lt(16777215)},currentPercent:{value:0},beginPercent:{value:0},endPercent:{value:0},isGradient:{value:!1},gradientPercent:{value:[]},gradientColor:{value:[]},gradientBegin:{value:0},gradientEnd:{value:0},isArrow:{value:!1}}),vertexShader:_.meshline_vert,fragmentShader:_.meshline_frag.replace(/{num}/g,""+n)}])).isMeshLineMaterial=!0,n.type="MeshLineMaterial",Object.defineProperties(jg(n),{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(t){this.uniforms.lineWidth.value=t}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(t){this.uniforms.map.value=t}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(t){this.uniforms.useMap.value=t}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(t){this.uniforms.alphaMap.value=t}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(t){this.uniforms.useAlphaMap.value=t}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(t){this.uniforms.color.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(t){this.uniforms.sizeAttenuation.value=t}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(t){this.uniforms.dashArray.value=t,this.useDash=0!==t?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(t){this.uniforms.dashRatio.value=t}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(t){this.uniforms.useDash.value=t}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(t){this.uniforms.visibility.value=t}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(t){this.uniforms.alphaTest.value=t}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(t){this.uniforms.repeat.value.copy(t)}},offset:{enumerable:!0,get:function(){return this.uniforms.offset.value},set:function(t){this.uniforms.offset.value.copy(t)}},ispassed:{enumerable:!0,get:function(){return this.uniforms.ispassed.value},set:function(t){this.uniforms.ispassed.value=t}},beginPercent:{enumerable:!0,get:function(){return this.uniforms.beginPercent.value},set:function(t){this.uniforms.beginPercent.value=t}},endPercent:{enumerable:!0,get:function(){return this.uniforms.endPercent.value},set:function(t){this.uniforms.endPercent.value=t}},currentPercent:{enumerable:!0,get:function(){return this.uniforms.currentPercent.value},set:function(t){this.uniforms.currentPercent.value=t}},passColor:{enumerable:!0,get:function(){return this.uniforms.passColor.value},set:function(t){this.uniforms.passColor.value=t}},gradientPercent:{enumerable:!0,get:function(){return this.uniforms.gradientPercent.value},set:function(t){this.uniforms.gradientPercent.value=t}},gradientColor:{enumerable:!0,get:function(){return this.uniforms.gradientColor.value},set:function(t){this.uniforms.gradientColor.value=t}},isGradient:{enumerable:!0,get:function(){return this.uniforms.isGradient.value},set:function(t){this.uniforms.isGradient.value=t}},gradientBegin:{enumerable:!0,get:function(){return this.uniforms.gradientBegin.value},set:function(t){this.uniforms.gradientBegin.value=t}},gradientEnd:{enumerable:!0,get:function(){return this.uniforms.gradientEnd.value},set:function(t){this.uniforms.gradientEnd.value=t}},isArrow:{enumerable:!0,get:function(){return this.uniforms.isArrow.value},set:function(t){this.uniforms.isArrow.value=t}}}),n.setValues(t),n}return Fg(e,Hs),Og(e)}();function Bg(){N.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function Gg(t,n,e){Nc.call(this,t,n),this.meshPerAttribute=e||1}function Hg(t){N.call(this),this.type="WireframeGeometry";var n,e,i,r,o,s,a=[],u=[0,0],c={},f=["a","b","c"];if(t&&t.isGeometry){for(var h=t.faces,l=0,d=h.length;l<d;l++)for(var v=h[l],p=0;p<3;p++)r=v[f[p]],o=v[f[(p+1)%3]],u[0]=Math.min(r,o),u[1]=Math.max(r,o),void 0===c[s=u[0]+","+u[1]]&&(c[s]={index1:u[0],index2:u[1]});for(s in c)w=t.vertices[(i=c[s]).index1],a.push(w.x,w.y,w.z),w=t.vertices[i.index2],a.push(w.x,w.y,w.z)}else if(t&&t.isBufferGeometry){var m,y,b,g,w=new xt;if(null!==t.index){for(m=t.attributes.position,y=t.index,e=(b=(n=0)===(b=t.groups).length?[{start:0,count:y.count,materialIndex:0}]:b).length;n<e;++n)for(d=(l=(g=b[n]).start)+g.count;l<d;l+=3)for(p=0;p<3;p++)r=y.getX(l+p),o=y.getX(l+(p+1)%3),u[0]=Math.min(r,o),u[1]=Math.max(r,o),void 0===c[s=u[0]+","+u[1]]&&(c[s]={index1:u[0],index2:u[1]});for(s in c)w.fromBufferAttribute(m,(i=c[s]).index1),a.push(w.x,w.y,w.z),w.fromBufferAttribute(m,i.index2),a.push(w.x,w.y,w.z)}else for(l=0,d=(m=t.attributes.position).count/3;l<d;l++)for(p=0;p<3;p++)w.fromBufferAttribute(m,3*l+p),a.push(w.x,w.y,w.z),w.fromBufferAttribute(m,3*l+(p+1)%3),a.push(w.x,w.y,w.z)}this.setAttribute("position",new E(a,3))}function Xg(t){return(Xg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zg(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Xg(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Xg(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Xg(t)?t:String(t)}(i.key),i)}}function Vg(t,n,e){n=Yg(n);var i=t,n=Wg()?Reflect.construct(n,e||[],Yg(t).constructor):n.apply(t,e);if(n&&("object"===Xg(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function Wg(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Wg=function(){return!!t})()}function Yg(t){return(Yg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Qg(t,n){return(Qg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}Ug.prototype.copy=function(t){return Hs.prototype.copy.call(this,t),this.lineWidth=t.lineWidth,this.map=t.map,this.useMap=t.useMap,this.alphaMap=t.alphaMap,this.useAlphaMap=t.useAlphaMap,this.color.copy(t.color),this.opacity=t.opacity,this.resolution.copy(t.resolution),this.sizeAttenuation=t.sizeAttenuation,this.dashArray.copy(t.dashArray),this.dashOffset.copy(t.dashOffset),this.dashRatio.copy(t.dashRatio),this.useDash=t.useDash,this.visibility=t.visibility,this.alphaTest=t.alphaTest,this.repeat.copy(t.repeat),this},Bg.prototype=Object.assign(Object.create(N.prototype),{constructor:Bg,isInstancedBufferGeometry:!0,copy:function(t){return N.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),Gg.prototype=Object.assign(Object.create(Nc.prototype),{constructor:Gg,isInstancedInterleavedBuffer:!0,copy:function(t){return Nc.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),(Hg.prototype=Object.create(N.prototype)).constructor=Hg;var Zg=function(){var t,n=i,e=Bg;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(){var t;if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");(t=Vg(this,i)).type="LineSegmentsGeometry";return t.isLineSegmentsGeometry=!0,t.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),t.setAttribute("position",new E([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),t.setAttribute("uv",new E([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2)),t.setAttribute("uv2",new E([0,0,1,0,0,1/3,1,1/3,0,2/3,1,2/3,0,1,1,1],2)),t}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Qg(n,e),n=i,(e=[{key:"applyMatrix",value:function(t){var n=this.attributes.instanceStart,e=this.attributes.instanceEnd;return void 0!==n&&(t.applyToBufferAttribute(n),t.applyToBufferAttribute(e),n.data.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"setPositions",value:function(t){t instanceof Float32Array?n=t:Array.isArray(t)&&(n=new Float32Array(t));var n,t=new Gg(n,6,1);return this.setAttribute("instanceStart",new jc(t,3,0)),this.setAttribute("instanceEnd",new jc(t,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}},{key:"setColors",value:function(t){t instanceof Float32Array?n=t:Array.isArray(t)&&(n=new Float32Array(t));var n,t=new Gg(n,6,1);return this.addAttribute("instanceColorStart",new jc(t,3,0)),this.addAttribute("instanceColorEnd",new jc(t,3,3)),this}},{key:"setUvys",value:function(t){t instanceof Float32Array?n=t:Array.isArray(t)&&(n=new Float32Array(t));var n,t=new Gg(n,2,1);return this.setAttribute("uvyStart",new jc(t,1,0)),this.setAttribute("uvyEnd",new jc(t,1,1)),this}},{key:"fromWireframeGeometry",value:function(t){return this.setPositions(t.attributes.position.array),this}},{key:"fromEdgesGeometry",value:function(t){return this.setPositions(t.attributes.position.array),this}},{key:"fromMesh",value:function(t){return this.fromWireframeGeometry(new Hg(t.geometry)),this}},{key:"fromLineSegements",value:function(t){t=t.geometry;return t.isGeometry?this.setPositions(t.vertices):t.isBufferGeometry&&this.setPositions(t.position.array),this}},{key:"computeBoundingBox",value:function(){var t=new Ft,n=(null===this.boundingBox&&(this.boundingBox=new Ft),this.attributes.instanceStart),e=this.attributes.instanceEnd;void 0!==n&&void 0!==e&&(this.boundingBox.setFromBufferAttribute(n),t.setFromBufferAttribute(e),this.boundingBox.union(t))}},{key:"computeBoundingSphere",value:function(){var t=new xt,n=(null===this.boundingSphere&&(this.boundingSphere=new kt),null===this.boundingBox&&this.computeBoundingBox(),this.attributes.instanceStart),e=this.attributes.instanceEnd;if(void 0!==n&&void 0!==e){for(var i=this.boundingSphere.center,r=(this.boundingBox.getCenter(i),0),o=0,s=n.count;o<s;o++)t.fromBufferAttribute(n,o),r=Math.max(r,i.distanceToSquared(t)),t.fromBufferAttribute(e,o),r=Math.max(r,i.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("fm.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}},{key:"toJSON",value:function(){}},{key:"clone",value:function(){}},{key:"copy",value:function(t){return this}}])&&zg(n.prototype,e),t&&zg(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}();function qg(t){return(qg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Kg(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=qg(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=qg(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==qg(t)?t:String(t)}(i.key),i)}}function Jg(t,n,e){n=tw(n);var i=t,n=$g()?Reflect.construct(n,e||[],tw(t).constructor):n.apply(t,e);if(n&&("object"===qg(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function $g(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return($g=function(){return!!t})()}function tw(t){return(tw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function nw(t,n){return(nw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var ew=function(){var t,n=i,e=Zg;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(){var t;if(this instanceof i)return(t=Jg(this,i)).type="LineGeometry",t.isLineGeometry=!0,t;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&nw(n,e),n=i,(e=[{key:"setPositions",value:function(t){for(var n=t.length-3,e=new Float32Array(2*n),i=0;i<n;i+=3)e[2*i]=t[i],e[2*i+1]=t[i+1],e[2*i+2]=t[i+2],e[2*i+3]=t[i+3],e[2*i+4]=t[i+4],e[2*i+5]=t[i+5];return this.test="ddd",(new Zg).setPositions.call(this,e),this}},{key:"setColors",value:function(t){for(var n=t.length-3,e=new Float32Array(2*n),i=0;i<n;i+=3)e[2*i]=t[i],e[2*i+1]=t[i+1],e[2*i+2]=t[i+2],e[2*i+3]=t[i+3],e[2*i+4]=t[i+4],e[2*i+5]=t[i+5];return(new Zg).setColors.call(this,e),this}},{key:"fromLine",value:function(t){t=t.geometry;return t.isGeometry?this.setPositions(t.vertices):t.isBufferGeometry&&this.setPositions(t.position.array),this}},{key:"copy",value:function(t){return this}}])&&Kg(n.prototype,e),t&&Kg(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),iw=new xt,rw=new xt;function ow(t,n){this.start=void 0!==t?t:new xt,this.end=void 0!==n?n:new xt}function sw(t){return(sw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function aw(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=sw(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=sw(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==sw(t)?t:String(t)}(i.key),i)}}function uw(t,n,e){n=fw(n);var i=t,n=cw()?Reflect.construct(n,e||[],fw(t).constructor):n.apply(t,e);if(n&&("object"===sw(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function cw(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(cw=function(){return!!t})()}function fw(t){return(fw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function hw(t,n){return(hw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}function lw(t,n,e){t=0<arguments.length&&void 0!==t?t:{x:0,y:0,z:0},n=1<arguments.length&&void 0!==n?n:{x:0,y:0,z:0},e=2<arguments.length?e:void 0,t=new Ot(t.x,t.y,t.z,1),n=new Ot(n.x,n.y,n.z,1);return t.applyMatrix4(e.projectionMatrix),n.multiplyScalar(t.w),n.applyMatrix4(e.projectionMatrixInverse),{x:n.x,y:n.y,z:n.z}}Object.assign(ow.prototype,{set:function(t,n){return this.start.copy(t),this.end.copy(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new xt),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new xt),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,n){return void 0===n&&(console.warn("THREE.Line3: .at() target is now required"),n=new xt),this.delta(n).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(t,n){iw.subVectors(t,this.start),rw.subVectors(this.end,this.start);t=rw.dot(rw),t=rw.dot(iw)/t;return t=n?Tt.clamp(t,0,1):t},closestPointToPoint:function(t,n,e){t=this.closestPointToPointParameter(t,n);return void 0===e&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),e=new xt),this.delta(e).multiplyScalar(t).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}});var dw=function(){var t,n=i,e=ba;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t,n){if(this instanceof i)return(t=uw(this,i,[t,n])).type="LineSegments2",t.isLineSegments2=!0,t;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&hw(n,e),n=i,(e=[{key:"computeLineDistances",value:function(){for(var t=new xt,n=new xt,e=this.geometry,i=e.attributes.instanceStart,r=e.attributes.instanceEnd,o=new Float32Array(2*i.data.count),s=0,a=0,u=i.data.count;s<u;s++,a+=2)t.fromBufferAttribute(i,s),n.fromBufferAttribute(r,s),o[a]=0===a?0:o[a-1],o[a+1]=o[a]+t.distanceTo(n);var c=new Gg(o,2,1);return e.setAttribute("instanceDistanceStart",new jc(c,1,0)),e.setAttribute("instanceDistanceEnd",new jc(c,1,1)),this}},{key:"copy",value:function(t){return this}},{key:"raycast",value:function(t,n){null===t.camera&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');var e=new Ot,i=new Ot,r=new Ot,o=new xt,s=new At,a=new ow,u=new xt,c=new Ft,f=new kt,h=void 0!==t.params.Line2&&t.params.Line2.threshold||0,l=t.ray,d=t.camera,v=d.projectionMatrix,p=this.matrixWorld,m=this.geometry,y=this.material,b=y.resolution,g=y.uniforms.lineWidth.value+h,w=m.attributes.instanceStart,_=m.attributes.instanceEnd,E=-d.near,y=2*Math.max(g/b.width,g/b.height);null===m.boundingSphere&&m.computeBoundingSphere(),f.copy(m.boundingSphere).applyMatrix4(p);h=lw({x:0,y:0,z:-Math.max(d.near,f.distanceToPoint(l.origin))},{x:y,y:0,z:0},d);if(d.isPerspectiveCamera?h.x/=2:h.x=g/d.zoom,f.radius+=h.x,!1!==t.ray.intersectsSphere(f)){null===m.boundingBox&&m.computeBoundingBox(),c.copy(m.boundingBox).applyMatrix4(p);h=lw({x:0,y:0,z:-Math.max(d.near,c.distanceToPoint(l.origin))},{x:y,y:0,z:0},d);if(d.isPerspectiveCamera?h.x/=2:h.x=g/d.zoom,c.max.x+=h.x,c.max.y+=h.x,c.max.z+=h.x,c.min.x-=h.x,c.min.y-=h.x,c.min.z-=h.x,!1!==t.ray.intersectsBox(c)){l.at(1,r),r.w=1,r.applyMatrix4(d.matrixWorldInverse),r.applyMatrix4(v),r.multiplyScalar(1/r.w),r.x*=b.x/2,r.y*=b.y/2,r.z=0,o.copy(r),s.multiplyMatrices(d.matrixWorldInverse,p);for(var S=0,T=w.count;S<T;S++){e.fromBufferAttribute(w,S),i.fromBufferAttribute(_,S),e.w=1,i.w=1,e.applyMatrix4(s),i.applyMatrix4(s);var x=e.z>E&&i.z>E;if(!x){e.z>E?(x=e.z-i.z,x=(e.z-E)/x,e.lerp(i,x)):i.z>E&&(x=i.z-e.z,x=(i.z-E)/x,i.lerp(e,x)),e.applyMatrix4(v),i.applyMatrix4(v),e.multiplyScalar(1/e.w),i.multiplyScalar(1/i.w),e.x*=b.x/2,e.y*=b.y/2,i.x*=b.x/2,i.y*=b.y/2,a.start.copy(e),a.start.z=0,a.end.copy(i),a.end.z=0;var x=a.closestPointToPointParameter(o,!0),x=(a.at(x,u),Tt.lerp(e.z,i.z,x)),x=-1<=x&&x<=1,A=u.distanceTo(i)<1||u.distanceTo(e)<1?.5*g*Math.sqrt(2):.5*g,A=o.distanceTo(u)<A;if(x&&A){a.start.fromBufferAttribute(w,S),a.end.fromBufferAttribute(_,S),a.start.applyMatrix4(p),a.end.applyMatrix4(p);x=new xt,A=new xt;l.distanceSqToSegment(a.start,a.end,A,x),n.push({point:A,pointOnLine:x,distance:l.origin.distanceTo(A),object:this,face:null,faceIndex:S,uv:null,uv2:null});break}}}}}}}])&&aw(n.prototype,e),t&&aw(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}();function vw(t){return(vw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pw(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=vw(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=vw(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==vw(t)?t:String(t)}(i.key),i)}}function mw(t,n,e){n=bw(n);var i=t,n=yw()?Reflect.construct(n,e||[],bw(t).constructor):n.apply(t,e);if(n&&("object"===vw(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function yw(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(yw=function(){return!!t})()}function bw(t){return(bw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function gw(t,n){return(gw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var ww=function(){var t,n,e=r,i=dw;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(t,n){if(this instanceof r)return(t=mw(this,r,[t,n])).type="Line2",t.isLine2=!0,t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&gw(e,i),e=r,t&&pw(e.prototype,t),n&&pw(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}();function _w(t){return(_w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ew(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=_w(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=_w(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==_w(t)?t:String(t)}(i.key),i)}}var Sw=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")}var n,e,i;return n=t,(e=[{key:"calculatePoint",value:function(t,n,e){return(new xt).copy(e).add((new xt).copy(t).sub(e).normalize().multiplyScalar(n))}},{key:"computerArcLineByPoints",value:function(t,n,e,i,r){var o=[],t=this.calculatePoint(t,i,n),e=this.calculatePoint(e,i,n),s=new gp(t,n,e);o.push(t);for(var a=0;a<r-1;a++){var u=s.getPoint((a+1)/r);o.push(u)}return o.push(e),o}}])&&Ew(n.prototype,e),i&&Ew(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}();function Tw(t){return function(t){if(Array.isArray(t))return xw(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){var e;if(t)return"string"==typeof t?xw(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?xw(t,n):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xw(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function Aw(t){return(Aw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Mw(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Aw(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Aw(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Aw(t)?t:String(t)}(i.key),i)}}var e=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.Kf=null,this.ar=0,this.Wv=void 0,this.Yv=!0,this.Qv=1,this.Zv=[],this.qv=!1,this.Kv=null,this.Jv=null,this.$v=[],this.n0=[],this.e0=[],this.i0=null,this.r0=null,this.o0=!1}var n,e,i;return n=t,(e=[{key:"points",get:function(){return this.Kf},set:function(t){this.o0=!1,this.Kf=t}},{key:"level",get:function(){return this.ar},set:function(t){this.ar=t}},{key:"buildingID",get:function(){return this.Wv},set:function(t){this.Wv=t}},{key:"length",get:function(){return this.s0(this.$v.length)}},{key:"linePoints",get:function(){return this.Kv}},{key:"uvys",get:function(){return this.Jv}},{key:"resize",value:function(){this.$v=[],this.qv=!1}}])&&Mw(n.prototype,e),i&&Mw(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}(),Ow=(Object.assign(e.prototype,{a0:function(t,n){this.o0||("number"!=typeof n&&(n=this.Qv),this.Kv=this.u0(t,n),this.Jv=this.c0(),this.o0=!0)},u0:function(t,n){this.Yv?this.qv||this.f0(n):((n=[]).push.apply(n,Tw(this.Kf)),this.Zv=n);for(var e=[],i=0;i<this.Zv.length;i++){var r=this.Zv[i].x-t.x,o=this.Zv[i].z,s=-this.Zv[i].y+t.y;e.push(r,o,s),0!==i&&(r=new xt(this.Zv[i].x,this.Zv[i].y,this.Zv[i].z),o=new xt(this.Zv[i-1].x,this.Zv[i-1].y,this.Zv[i-1].z),this.$v.push(r.distanceTo(o)))}return e},f0:function(t){for(var n,e,i=[],r=new Sw,o=0;o<this.Kf.length;o++)0===o&&this.r0?(n=this.h0(t,this.r0,this.Kf[o],this.Kf[o+1]),this.isCross?i.push.apply(i,Tw(r.computerArcLineByPoints(this.r0,this.Kf[o],this.Kf[o+1],n,12))):i.push(r.calculatePoint(this.Kf[o+1],n,this.Kf[o]))):o===this.Kf.length-1&&this.i0?(n=this.h0(t,i[i.length-1],this.Kf[o],this.i0),this.isCross?i.push.apply(i,Tw(r.computerArcLineByPoints(i[i.length-1],this.Kf[o],this.i0,n,12))):i.push(r.calculatePoint(i[i.length-1],n,this.Kf[o]))):0<o&&o<this.Kf.length-1?(e=this.h0(t,i[i.length-1],this.Kf[o],this.Kf[o+1]),i.push.apply(i,Tw(r.computerArcLineByPoints(i[i.length-1],this.Kf[o],this.Kf[o+1],e,12)))):i.push(this.Kf[o]);this.Zv=i,this.qv=!0},h0:function(t,n,e,i){return Math.min(.5*W.distanceOfTwoPoints(n,e),.5*W.distanceOfTwoPoints(e,i),t)},c0:function(){for(var t,n=[],e=this.s0(this.$v.length),i=0;i<this.Zv.length;i++)0===i?n.push(0):i===this.Zv.length-1?n.push(1):(t=this.s0(i)/e,n.push(t),n.push(t));return n},s0:function(t){for(var n=0,e=0;e<this.$v.length;e++)e<t&&(n+=this.$v[e]);return n}}),e),Lw={FULL:0,DOTTED:2,DOT_DASH:4,CENTER:8,DASH:16,DOUBLE_DOT_DASH:32,TRI_DOT_DASH:64,FMARROW:128,ARROW:256};function Rw(t){return(Rw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Nw(t,n){var e,i,r,o,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return i=!(e=!0),{s:function(){s=s.call(t)},n:function(){var t=s.next();return e=t.done,t},e:function(t){i=!0,r=t},f:function(){try{e||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(t)||(s=function(t,n){var e;if(t)return"string"==typeof t?Pw(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Pw(t,n):void 0}(t))||n&&t&&"number"==typeof t.length)return s&&(t=s),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Pw(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function jw(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Rw(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Rw(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Rw(t)?t:String(t)}(i.key),i)}}function Fw(t,n,e){n=Dw(n);var i=t,n=Iw()?Reflect.construct(n,e||[],Dw(t).constructor):n.apply(t,e);if(n&&("object"===Rw(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return Cw(i)}function Iw(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Iw=function(){return!!t})()}function Cw(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function kw(){return(kw="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=Dw(t)););return t}(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function Dw(t){return(Dw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Uw(t,n){return(Uw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var e=function(){var t,n=u,e=xg;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function u(t){var n;if(!(this instanceof u))throw new TypeError("Cannot call a class as a function");if(n=Fw(this,u,[t]),t=t||{},n.Fe=S.LINE_MARKER,n.Fh=t.url,n.l0=void 0!==t.width?t.width:6,n.Sd=void 0!==t.color?t.color:"#33cc61",n.Yv=void 0===t.smooth||t.smooth,n.d0=void 0!==t.radius?t.radius:1,n.Eo=void 0===t.animate||t.animate,n.ht=void 0!==t.opacity?t.opacity:1,n.p0=void 0===t.depth||t.depth,n.m0=void 0!==t.type?t.type:Lw.FMARROW,n.y0=void 0!==t.borderColor?t.borderColor:"#4a82d2",n.b0=void 0!==t.segments?t.segments:[],n.To=[],n.g0=60,n.w0=10,n._0="#aeaeae",n.E0=void 0,n.S0=n.S0.bind(Cw(n)),n.T0=n.T0.bind(Cw(n)),n.x0=n.x0.bind(Cw(n)),n.A0=n.A0.bind(Cw(n)),n.Bv=n.Bv.bind(Cw(n)),n.M0=void 0!==t.zFighting?t.zFighting:void 0,n.O0=void 0===t.ignoreFloorSpace||t.ignoreFloorSpace,n.L0=null,n.M0&&(n.R0=new u(Object.assign(t,{zFighting:!1})),n.N0=1,n.P0=0),t.gradient){for(var e=Object.keys(t.gradient).map(parseFloat),i=(e.sort(function(t,n){return t-n}),[]),r=0;r<e.length;r++){var o=t.gradient[e[r]],o=o.substring(o.indexOf("(")+1,o.indexOf(")")).split(","),s=parseFloat(o[0])/255,a=parseFloat(o[1])/255,o=parseFloat(o[2])/255;i.push(new Ot(s,a,o,0))}n.j0={percent:e,color:i}}return n}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Uw(n,e),n=u,(e=[{key:"bound",get:function(){if(!0===this.needUpdateBound){this.xe.reset();for(var t=this.b0,n=0;n<t.length;n++){var e=t[n];this.xe.expandByCoords(e.Kf)}this.needUpdateBound=!1}return this.xe.clone()}},{key:"level",get:function(){return null}},{key:"width",get:function(){return this.l0},set:function(t){0!==t&&t!==this.l0&&(this.l0=t,this.Bh(),this.M0&&(this.R0.width=t),this.T0())}},{key:"color",get:function(){return this.Sd},set:function(t){this.Sd!==t&&(this.Sd=t,this.Bh())}},{key:"opacity",get:function(){return this.ht},set:function(t){this.ht!==t&&(this.ht=t,this.Bh(),this.M0)&&(this.R0.opacity=t)}},{key:"passedColor",get:function(){return this._0},set:function(t){this._0!==t&&(this._0=t,this.Bh())}},{key:"segments",get:function(){return this.b0},set:function(t){this.b0=t;var n=this.qi(g);n&&(this.F0(n),this.wc(),this.A0(),this.M0&&(this.R0.segments=t,this.R0.moveProportion(1)),this.needUpdateBound=!1)}},{key:"visible",get:function(){return this.Qi},set:function(t){this.Qi=t;for(var n=0;n<this.To.length;n++)this.To[n].line.visible=t;var e=this.qi(g);e&&(e.enableUpdateRender(),this.M0)&&(this.R0.visible=t)}},{key:"updatePosition",value:function(t){this.Bv(t)}},{key:"update",value:function(){var t,n;this.xi&&this.xi.material&&(t=this.qi(g))&&(n=this.qi(v),this.xi.material=t.fi.Br.Hu({color:this.Sd,lineWidth:this.l0,opacity:this.ht*n.ht,needDepth:!1,gradient:this.j0}),this.M0)&&this.R0.update()}},{key:"moveProportion",value:function(t,n){for(var e=0,i=[],r=this.To.length-1;-1<r;r--)this.To[r].isCross&&!n||(i.push(this.To[r]),e+=this.To[r].seg.length);for(var o=0;o<i.length;o++){var s=0,s=0===o?0:i[o-1].line.material.endPercent;i[o].line.material.beginPercent=s,i[o].line.material.endPercent=s+i[o].seg.length/e,i[o].line.material.currentPercent=t,i[o].line.material.ispassed=!0}this.E0=t;var a=this.qi(g);a&&a.enableUpdateRender()}},{key:"getLineNodes",value:function(){return this.To}},{key:"addTo",value:function(n){var e=this;n.fi.Br.bu.su(this.Fh,function(t){null!==t&&(e.L0=new Gc(rd.getPowerOfTwoSizeCanvas(t)),e.L0.minFilter=B,e.L0.wrapS=Hn,e.L0.wrapT=Hn,e.L0.generateMipmaps=!1,e.L0.anisotropy=4),n.So.add(e),e.I0(),n.on("visibleLevelsLoaded",e.A0),n.on("levelChanged",e.T0),n.on("zoom",e.T0),e.C0(n),e.Eo&&!1!==e.M0&&n.Oi.Ri(e.S0),e.M0&&(e.R0.addTo(n),e.R0.moveProportion(1))})}},{key:"remove",value:function(){var t=this.qi(g);t&&(t.off("visibleLevelsLoaded",this.A0),t.off("levelChanged",this.T0),t.off("zoom",this.T0),this.k0(t),this.F0(t),this.Eo&&t.Oi.Mi(this.S0),t.So.remove(this),t.enableUpdateRender(),this.M0)&&this.R0.remove(t)}},{key:"dispose",value:function(){kw(Dw(u.prototype),"dispose",this).call(this);for(var t=0;t<this.b0.length;t++)this.b0[t].resize();this.M0&&this.R0.dispose()}},{key:"getRenderNode",value:function(){return this.To}}])&&jw(n.prototype,e),t&&jw(n,t),Object.defineProperty(n,"prototype",{writable:!1}),u}(),Bw=(Object.assign(e.prototype,{C0:function(t){t.on("resize",this.x0)},k0:function(t){t.off("resize",this.x0)},F0:function(t){for(var n=0;n<this.To.length;n++){var e=this.To[n].buildingID&&""+this.To[n].buildingID,i=this.To[n].isCross?Math.min(this.To[n].gid,this.To[n].gidAn):this.To[n].gid,e=this.ci(e,i,t);e&&e.getOrCreateLayer(this.Fe).xo.remove(this.To[n].line)}this.To=[]},D0:function(t,n,e){var i=null;e?((i=new ew).setPositions(t),e=this.qi(v),e=n.fi.Br.Hu({color:this.Sd,lineWidth:this.l0,opacity:this.opacity*e.ht,needDepth:!1,gradient:this.j0}),this.xi=new ww(i,e),this.xi.computeLineDistances(),i.dispose()):((i=new Cg).setPoints(t),e=new Ug({useMap:0,color:new lt(this.Sd),opacity:this.ht,resolution:new Mt(n.Dt.renderer.domElement.clientWidth,n.Dt.renderer.domElement.clientHeight),lineWidth:2*this.l0,sizeAttenuation:0,transparent:!0,depthTest:!1,passColor:new lt(this._0),isGradient:!1,gradientPercent:[0],gradientColor:[new Ot(0,0,0,0)]},1),this.xi=new ba(i.geometry,e))},U0:function(t){var n=new Cg;n.setPoints(t),this.xi.geometry=n.geometry,n.dispose()},wc:function(){var t=this.qi(g);if(t){for(var n=null,n=this.Fh?{useMap:!0,texture:this.L0}:this.B0(),e=[],i=new Mt(t.x,t.y),r=this.b0.length-1;-1<r;r--){var o=this.ci(this.b0[r].buildingID,this.b0[r].ar,t);if(!o)return;var s,a=void 0,u=void 0;if(0<r&&this.b0[r].Wv===this.b0[r-1].Wv&&this.b0[r].ar!==this.b0[r-1].ar){if(!(a=this.ci(this.b0[r-1].buildingID,this.b0[r-1].ar,t)))return;u=this.b0[r-1].points,this.b0[r].r0=Object.assign({},u[u.length-1]),this.b0[r].r0.z+=a.nt-o.nt}if(r<this.b0.length-1&&this.b0[r].Wv===this.b0[r+1].Wv&&this.b0[r].ar!==this.b0[r+1].ar){var c=this.ci(this.b0[r+1].buildingID,this.b0[r+1].ar,t);if(!c)return;this.b0[r].i0=Object.assign({},this.b0[r+1].points[0]),this.b0[r].i0.z+=c.nt-o.nt}this.b0[r].Yv=this.Yv,this.b0[r].a0(i,this.d0),e.push({seg:this.b0[r],buildingID:this.b0[r].Wv,gid:this.b0[r].ar,isCross:!1,floor:o}),0<r&&this.b0[r].Wv===this.b0[r-1].Wv&&this.b0[r].ar!==this.b0[r-1].ar&&((c=new Ow).ar=this.b0[r].ar,c.Wv=this.b0[r].Wv,c.isCross=!0,s=this.b0[r].points,this.G0(c,u,s,a,o),c.Yv=this.Yv,c.a0(i,this.d0),e.push({floor:a.level<o.level?a:o,seg:c,buildingID:c.Wv,gid:this.b0[r-1].ar,isCross:!0,gidAn:c.ar,levelRange:[this.b0[r-1].ar,this.b0[r].ar]}))}for(var e=e.reverse(),f=0;f<e.length;f++){var h=e[f],l=h.seg,d=h.buildingID,v=h.gid,p=h.isCross,m=h.gidAn,y=h.levelRange,h=h.floor,b=this.H0(l,n);this.To.push({line:b,buildingID:d,gid:v,seg:l,isCross:p,gidAn:m,levelRange:y}),h.getOrCreateLayer(this.Fe).xo.add(b)}return this.th=!0,this.To=this.To.reverse(),this.X0(),void 0!==this.E0&&this.moveProportion(this.E0),this.T0(),t.enableUpdateRender(),this.th}},X0:function(){if(void 0!==this.j0){for(var t=0,n=[],e=this.To.length-1;-1<e;e--)this.To[e].isCross&&this.O0||(t+=this.To[e].seg.length),n.push(this.To[e]);for(var i=0;i<n.length;i++){var r=0,r=0===i?0:n[i-1].line.material.gradientEnd;n[i].line.material.gradientBegin=r,n[i].isCross&&this.O0?n[i].line.material.gradientEnd=r:n[i].line.material.gradientEnd=r+n[i].seg.length/t}}},G0:function(t,n,e,i,r){var o=Object.assign({},n[n.length-1]),s=Object.assign({},e[0]);o.z+=i.nt-r.nt,t.points=[o,s],t.r0=Object.assign({},n[n.length-2]),t.r0.z+=i.nt-r.nt,t.i0=Object.assign({},e[1])},H0:function(t,n){var e=this.qi(g);if(e){var i=new Mt(e.x,e.y),i=(t.Yv=this.Yv,t.a0(i,this.d0),this.ci(t.Wv,t.ar,e));if(i){for(var r=new _p,o=t.Zv,s=0;s<o.length-1;s++){var a=new yp(new xt(o[s].x-e.x,o[s].z,-o[s].y+e.y),new xt(o[s+1].x-e.x,o[s+1].z,-o[s+1].y+e.y));r.curves.push(a)}var t=1,u=(n.useMap||(t=0),!1),c=[0],f=[new Ot(0,0,0,0)],h=(void 0!==this.j0&&(u=!0,c=this.j0.percent,f=this.j0.color),!1),t=(this.m0!==Lw.FMARROW&&this.m0!==Lw.ARROW||(h=!0),new Ug({useMap:t,map:n.texture,color:new lt(this.Sd),opacity:this.ht,resolution:new Mt(e.Dt.renderer.domElement.clientWidth,e.Dt.renderer.domElement.clientHeight),lineWidth:2*this.l0,sizeAttenuation:0,transparent:!0,depthTest:this.p0,passColor:new lt(this._0),isGradient:u,gradientPercent:c,gradientColor:f,isArrow:h},c.length)),n=new Cg,u=Math.floor(r.getLength()),f=10*(u=0===u?2:u),h=(8e3<f&&(f=8e3),n.setPoints(r.getSpacedPoints(f=2===u?2:f)),new ba(n.geometry,t));return h.raycast=kg,this.M0?h.renderOrder=0:!1===this.M0&&(h.renderOrder=1),!this.M0&&!1!==this.M0||(t.stencilWrite=!0,t.stencilRef=i.nt%255,t.stencilFunc=516,t.stencilFail=bi,t.stencilZFail=bi,t.stencilZPass=bi),h.position.set(0,i.nt,0),h.mapNode=this,h}}},S0:function(t){for(var n=0;n<this.To.length;n++)this.To[n].line.material.uniforms.offset.value.x-=.001*t/this.To[n].line.material.uniforms.repeat.value.x;this.qi(g).enableUpdateRender()},T0:function(){for(var t=0;t<this.To.length;t++)this.z0(this.To[t].line.material,this.To[t].seg,5*this.l0)},z0:function(t,n,e){var i,r=this.qi(g);r&&(i=n.length,n=this.ci(n.Wv,n.ar,r))&&(i=i*r.fi.V0(n.nt),n=Math.floor(i*st.a.window.devicePixelRatio/e),t.uniforms.repeat.value=new Mt(n=0===n?1:n,1),r.enableUpdateRender())},x0:function(){var t=this.qi(g);if(t){for(var n=0;n<this.To.length;n++)this.To[n].line.material.resolution=new Mt(t.Dt.renderer.domElement.clientWidth,t.Dt.renderer.domElement.clientHeight);t.enableUpdateRender()}},I0:function(){var t,n=this.qi(g),e=Nw(this.To);try{for(e.s();!(t=e.n()).done;){var i,r=t.value;r.isCross?(i=this.Ha(r.buildingID,n).visibleLevels).indexOf(r.gid)<0||i.indexOf(r.gidAn)<0?r.line.visible=!1:(r.line.visible=!0,r.line.visible=this.Qi):-1<this.Ha(r.buildingID,n).visibleLevels.indexOf(r.gid)?(r.line.visible=!0,r.line.visible=this.Qi):r.line.visible=!1}}catch(t){e.e(t)}finally{e.f()}n.enableUpdateRender()},A0:function(){this.qi(g)&&this.I0()},W0:function(){this.g0=this.l0*this.w0;var t={type:"normal",width:128,height:128,color:this.Sd,arrowHeightPercent:.6,arrowWidthPercent:1,arrowPercent:.1,lineType:null,dashArray:[2,1],textureCommand:"createNormalLineTexture",godHeightPercent:1,godEdgePercent:.2,godArrowPercent:.15,arrowWidth:20,godColor:this.Sd,godEdgeColor:this.y0,godArrowColor:"#F4FEFB",godArrowXScale:4,godArrowWidthPercent:.9,useMap:!0,gradient:this.j0};switch(this.j0&&(t.color="#fff",t.godEdgeColor="rgba(0,0,0,1)",t.godColor="rgba(0,0,0,1)"),this.m0){case Lw.FULL:t.useMap=!1;break;case Lw.DOTTED:t.dashArray=[.5,.5,.5,.5,.5,.5,.5,.5];break;case Lw.DOT_DASH:t.dashArray=[2.5,1,.5,1];break;case Lw.CENTER:t.dashArray=[3,1,1.5,1];break;case Lw.DASH:t.dashArray=[2,1];break;case Lw.DOUBLE_DOT_DASH:t.dashArray=[2.5,.5,.5,.5,.5,.5];break;case Lw.TRI_DOT_DASH:t.dashArray=[2.5,.5,.5,.5,.5,.5,.5,.5];break;case Lw.FMARROW:case Lw.ARROW:st.a.environment===G.a.BROWSER&&(t.width=5*this.l0,t.height=5*this.g0),t.arrowWidth=t.height/12,t.dashArray=[7,0],t.textureCommand="createArrowWidthBackTexture";break;default:t.useMap=!1}return t},B0:function(){var t,n,e=this.qi(g);if(e)return t=this.W0(),n=null,this.Fh?{useMap:!0,texture:e.fi.Br.nc(this.Fh,function(t){t.needsUpdate=!0})}:(t.useMap&&((n=e.fi.Br[t.textureCommand](t)).minFilter=B,n.wrapS=Hn,n.wrapT=Hn,n.generateMipmaps=!1,n.anisotropy=4),{useMap:t.useMap,texture:n})},Bh:function(){if(0<this.To.length)for(var t=this.B0(),n=0;n<this.To.length;n++)this.To[n].line.material.lineWidth=2*this.l0,this.To[n].line.material.color=new lt(this.Sd),this.To[n].line.material.passColor=new lt(this._0),this.To[n].line.material.opacity=this.ht,t.useMap&&(this.To[n].line.material.map=t.texture);var e=this.qi(g);e&&e.enableUpdateRender()},ci:function(t,n,e){return(t?this.Ha(t,e):e).getFloor(n)},Ha:function(t,n){return t=t||n.getMapOptions().buildingID,n.getBuilding(t)},Bv:function(){var t;0<this.To.length&&(t=this.qi(g))&&(this.F0(t),this.wc(),void 0!==this.E0&&this.moveProportion(this.E0),this.A0(),t.enableUpdateRender())}}),e);function Gw(t){return(Gw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Hw(){Hw=function(){return s};var u,s={},t=Object.prototype,c=t.hasOwnProperty,f=Object.defineProperty||function(t,n,e){t[n]=e.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",e=n.asyncIterator||"@@asyncIterator",r=n.toStringTag||"@@toStringTag";function o(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{o({},"")}catch(u){o=function(t,n,e){return t[n]=e}}function a(t,n,e,i){var r,o,s,a,n=n&&n.prototype instanceof y?n:y,n=Object.create(n.prototype),i=new A(i||[]);return f(n,"_invoke",{value:(r=t,o=e,s=i,a=l,function(t,n){if(a===v)throw new Error("Generator is already running");if(a===p){if("throw"===t)throw n;return{value:u,done:!0}}for(s.method=t,s.arg=n;;){var e=s.delegate;if(e){e=function t(n,e){var i=e.method,r=n.iterator[i];if(r===u)return e.delegate=null,"throw"===i&&n.iterator.return&&(e.method="return",e.arg=u,t(n,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),m;i=h(r,n.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,m;r=i.arg;return r?r.done?(e[n.resultName]=r.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=u),e.delegate=null,m):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}(e,s);if(e){if(e===m)continue;return e}}if("next"===s.method)s.sent=s.Mt=s.arg;else if("throw"===s.method){if(a===l)throw a=p,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);a=v;e=h(r,o,s);if("normal"===e.type){if(a=s.done?p:d,e.arg===m)continue;return{value:e.arg,done:s.done}}"throw"===e.type&&(a=p,s.method="throw",s.arg=e.arg)}})}),n}function h(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}s.wrap=a;var l="suspendedStart",d="suspendedYield",v="executing",p="completed",m={};function y(){}function b(){}function g(){}var n={},w=(o(n,i,function(){return this}),Object.getPrototypeOf),w=w&&w(w(M([]))),_=(w&&w!==t&&c.call(w,i)&&(n=w),g.prototype=y.prototype=Object.create(n));function E(t){["next","throw","return"].forEach(function(n){o(t,n,function(t){return this._invoke(n,t)})})}function S(s,a){var n;f(this,"_invoke",{value:function(e,i){function t(){return new a(function(t,n){!function n(t,e,i,r){var o,t=h(s[t],s,e);if("throw"!==t.type)return(e=(o=t.arg).value)&&"object"==Gw(e)&&c.call(e,"__await")?a.resolve(e.Ot).then(function(t){n("next",t,i,r)},function(t){n("throw",t,i,r)}):a.resolve(e).then(function(t){o.value=t,i(o)},function(t){return n("throw",t,i,r)});r(t.arg)}(e,i,t,n)})}return n=n?n.then(t,t):t()}})}function T(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function x(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function M(n){if(n||""===n){var e,t=n[i];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return e=-1,(t=function t(){for(;++e<n.length;)if(c.call(n,e))return t.value=n[e],t.done=!1,t;return t.value=u,t.done=!0,t}).next=t}throw new TypeError(Gw(n)+" is not iterable")}return f(_,"constructor",{value:b.prototype=g,configurable:!0}),f(g,"constructor",{value:b,configurable:!0}),b.displayName=o(g,r,"GeneratorFunction"),s.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},s.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,o(t,r,"GeneratorFunction")),t.prototype=Object.create(_),t},s.awrap=function(t){return{Ot:t}},E(S.prototype),o(S.prototype,e,function(){return this}),s.AsyncIterator=S,s.async=function(t,n,e,i,r){void 0===r&&(r=Promise);var o=new S(a(t,n,e,i),r);return s.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},E(_),o(_,r,"Generator"),o(_,i,function(){return this}),o(_,"toString",function(){return"[object Generator]"}),s.keys=function(t){var n,e=Object(t),i=[];for(n in e)i.push(n);return i.reverse(),function t(){for(;i.length;){var n=i.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},s.values=M,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this.Mt=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(x),!t)for(var n in this)"t"===n.charAt(0)&&c.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=u)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function t(t,n){return o.type="throw",o.arg=e,i.next=t,n&&(i.method="next",i.arg=u),!!n}for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var s=c.call(r,"catchLoc"),a=c.call(r,"finallyLoc");if(s&&a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var o=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=n&&n<=r.finallyLoc?null:r)?r.completion:{};return o.type=t,o.arg=n,r?(this.method="next",this.next=r.finallyLoc,m):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),m},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),x(e),m}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e,i,r=this.tryEntries[n];if(r.tryLoc===t)return"throw"===(e=r.completion).type&&(i=e.arg,x(r)),i}throw new Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:M(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=u),m}},s}function Xw(t,n,e,i,r,o,s){try{var a=t[o](s),u=a.value}catch(t){return void e(t)}a.done?n(u):Promise.resolve(u).then(i,r)}function zw(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Gw(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Gw(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Gw(t)?t:String(t)}(i.key),i)}}function Vw(t,n,e){n=Qw(n);var i=t,n=Ww()?Reflect.construct(n,e||[],Qw(t).constructor):n.apply(t,e);if(n&&("object"===Gw(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function Ww(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ww=function(){return!!t})()}function Yw(){return(Yw="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=Qw(t)););return t}(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function Qw(t){return(Qw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Zw(t,n){return(Zw=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var e=function(){var t,n=i,e=cb;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(this instanceof i)return(n=Vw(this,i)).G=t,void 0===n.G.baseheight&&(n.G.baseheight=0),n.nt=Math.abs(n.G.height-n.G.baseheight),n.Y0=n.G.baseheight,n.G.height<n.Y0&&(n.Y0=n.G.height),n.Fe=S.MODEL,n.xi=null,n.If=null,n.Ue=null,n.xe=null,n.Q0="#FF0000",n.vd=null,n.Hr={top:null,left:null,right:null,front:null,back:null},n.Z0=!1,n.jh=null,n.Sd=null,n.ht=null,n.q0=null,n.K0=null,n.J0=.01*n.$0(n.x+n.y),n.ev=null,n.tp=null,n.np=[0,0],n.hv=null,n.nv=0,n.Bf=null,n.ep=0,n.ip=null,n.Ih=0,n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Zw(n,e),n=i,(e=[{key:"FID",get:function(){return this.G.fid}},{key:"typeID",get:function(){return this.G.type}},{key:"name",get:function(){return this.G.name}},{key:"eName",get:function(){return this.G.ename}},{key:"pass",get:function(){return this.G.pass}},{key:"coordinates",get:function(){return this.G.Ie}},{key:"x",get:function(){var t;return null==(t=this.G.Re)?void 0:t.x}},{key:"y",get:function(){var t;return null==(t=this.G.Re)?void 0:t.y}},{key:"height",get:function(){return this.G.height>=this.G.baseheight?this.G.height:this.G.baseheight}},{key:"baseHeight",get:function(){return this.G.baseheight<=this.G.height?this.G.baseheight:this.G.height}},{key:"extrudeHeight",get:function(){return this.nt}},{key:"getData",value:function(){var t=Object.assign(Yw(Qw(i.prototype),"getData",this).call(this),{pass:this.G.pass});return t.height=this.height,t.baseHeight=this.baseHeight,t.extrudeHeight=this.extrudeHeight,t}},{key:"getArea",value:function(){return uy.area(this.G.Ie[0])}},{key:"setColor",value:function(t,n){this.Z0=!0,void 0!==t&&(this.Sd=t),void 0!==n&&(this.ht=n),this.Bh()}},{key:"resetColor",value:function(){this.jh&&!this.rp()||this.Av(),this.setColor(this.jh.color,this.jh.alpha),this.Z0=!1}},{key:"setBorderColor",value:function(t,n){t&&(this.q0=t),null!=n&&(this.K0=n);t=this.qi(g);this.op(t)}},{key:"resetBorderColor",value:function(){this.jh&&(this.rp()&&this.Av(),this.setBorderColor(this.jh.strokeColor,this.jh.alpha))}},{key:"setTopImage",value:function(t){this.ep=1,this.ev=t.image,this.hv=void 0!==t.coords?t.coords:this.G.Re,this.tp=void 0!==t.size?t.size:[5,5],this.np=void 0!==t.offset?t.offset:[0,0],this.nv=void 0!==t.angle?t.angle:0,this.xi&&this.sp()}},{key:"clearTopImage",value:function(){this.ep=0,this.ap()}},{key:"flash",value:function(t){this.cp(t);var n=this,e=this.qi(g),i=0;function r(){i%2==0?n.xi&&(n.xi.material.color=new lt(n.Q0)):n.xi&&(n.xi.material.color=new lt(n.Sd)),i++,e.enableUpdateRender()}n.vd&&clearTimeout(n.vd),function t(){n.xi&&(n.xi.userData.sourceMaterial||(n.xi.userData.sourceMaterial=n.xi.material,n.xi.material=n.xi.material.clone()),n.xi.userData.sourceMaterial.canDispose=!1,r());n.vd=setTimeout(t,100)}()}},{key:"stopFlash",value:function(){var t;this.vd&&(clearTimeout(this.vd),this.vd=null,t=this.xi.material,this.xi.material=this.xi.userData.sourceMaterial,delete this.xi.userData.sourceMaterial.canDispose,delete this.xi.userData.sourceMaterial,t.dispose(),t=null,this.qi(g).enableUpdateRender())}},{key:"getOtherNode",value:function(){return{top:this.Hr.top,line:this.If}}}])&&zw(n.prototype,e),t&&zw(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),qw=(Object.assign(e.prototype,{wc:function(){var a,s=this;return a=Hw().mark(function t(){var n,e,i,r,o;return Hw().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(s.xi)return t.abrupt("return");t.next=2;break;case 2:if(1===s.Ih)return t.abrupt("return");t.next=4;break;case 4:return r=s.qi(v),e=r.Ht,n=e.Ht,e=e.Ht.fi,s.Av(),s.Sd&&s.Z0||(s.Sd=s.jh.color),null!==s.ht&&s.Z0||(s.ht=s.jh.alpha),s.q0&&s.Z0||(s.q0=s.jh.strokeColor),s.l0&&s.Z0||(s.l0=s.jh.strokeWidth),null!==s.K0&&s.Z0||(s.K0=s.jh.alpha),r=r.getLayers(S.EXTENT_LAYER)[0].bound,i=n.Ft.Jo?e.Ch:e.kh,s.Ih=1,t.next=19,i.bind(e)({type:s.type,data:s.G,amount:s.nt,referenceBound:r,isUseReferenceBound:!0,createLineType:1<s.l0?"onlyData":"geometry",lineHeight:s.nt+s.J0});case 19:i=t.sent,s.Ih=2,(r=s.Lr(e.Br)).userData.opacity=r.opacity,o=s.G.getBound(),s.xi=new ba(i.geometry,r),o=new xt(o.center.x-n._t,s.Y0,n.Et-o.center.y),s.xi.position.copy(o),s.xi.rotation.set(-Math.PI/2,0,0,"XYZ"),(s.xi.mapNode=s).Ht.xo.add(s.xi),s.fp=i.shape,s.hp(i.lineData),s.lp(),s.Bf&&s.Bf.wc(s),n.enableUpdateRender();case 35:case"end":return t.stop()}},t)}),function(){var t=this,s=arguments;return new Promise(function(n,e){var i=a.apply(t,s);function r(t){Xw(i,n,e,r,o,"next",t)}function o(t){Xw(i,n,e,r,o,"throw",t)}r(void 0)})}()},dp:function(t){var n=this,e=[],t=(t?e=t:this.fp.getPoints().forEach(function(t){e.push(t.x,t.y,n.nt+n.J0)}),new Bw({color:this.q0,width:this.l0,smooth:!1,animate:!1,depth:!0})),i=(t.Ht=this).qi(g),r=(t.D0(e,i,!0),t.xi.material.depthWrite=!0,t.xi.material.depthTest=!0,t.xi.material.polygonOffset=!0,t.xi.material.polygonOffsetFactor=-3*this.l0,t.xi.material.polygonOffsetUnits=1,this.xi.add(t.xi),this.nt&&-1!==this.nt?this.nt:2);t.xi.position.setZ(.005*r),t.xi.renderOrder=-1,t.xi.isNoPick=!0,this.If=t.xi,this.vp=t,this.vp.To.push({line:t.xi}),this.vp.C0(i)},pp:function(t){var n=this.qi(v),e=!0,t=(this.Rr&&(e=!1),t.ku({isline:e,color:this.q0,opacity:this.K0*n.ht,needDepth:!0}));return this.Rr&&((t=t.clone()).uniforms.isMask.value=!0,t.uniforms.maskType.value=this.Pr,t.uniforms.maskTexture.value=this.ip,void 0!==this.Fr&&void 0!==this.Ir&&(t.uniforms.maskHeight.value=this.Fr,t.uniforms.maskExtrudeHeight.value=this.Ir),t.uniforms.boundCenter.value=this.Cr,t.uniforms.boundSize.value=this.kr,t.uniformsNeedUpdate=!0),t},initGLLine:function(t){var n=this.qi(Go).Ht.fi,e=this.pp(n.Br),i=this.nt&&-1!==this.nt?this.nt:2;if(!t){for(var r=(new rs).setFromPoints(this.fp.getPoints()),o=(r&&0<r.vertices.length&&r.vertices.push(r.vertices[0]),[]),s=r.vertices.length,a=0;a<s;a++)r.vertices[a].z=this.nt+this.J0,0===a||a===s-1?o.push(r.vertices[a]):o.push(r.vertices[a],r.vertices[a]);r.vertices=o,t=r}var u=new Ov(t,e);if(u.position.setZ(.005*i),u.castShadow=!1,u.geometry.computeBoundingSphere(),this.If=u,this.If.matrixAutoUpdate=!1,this.xi.add(u),0===this.l0&&(this.If.visible=!1),null!=(n=this.fp)&&n.holes)for(var c=0;c<this.fp.holes.length;c++){d=l=h=f=void 0;for(var f=u,h=this.fp.holes[c].curves,l=0;l<h.length;l++){var d=[];d.push(new xt(h[l].v1.x,h[l].v1.y,i)),d.push(new xt(h[l].v2.x,h[l].v2.y,i));d=new Ov((new N).setFromPoints(d),e);f.add(d)}}},hp:function(t){1<Math.floor(this.l0)?this.dp(t):this.initGLLine(t)},lp:function(){var t,n;this.ev&&this.tp&&(n=this.qi(g),t=new Fs(1,1,1,1),n=this.mp(n,this.ev),this.Hr.top=new ba(t,n),this.Hr.top.renderOrder=10,this.yp(),this.xi.add(this.Hr.top))},sp:function(){this.ev&&this.tp?this.Hr.top?(this.bp(),this.yp()):this.lp():this.ap()},ap:function(){var t;this.Hr.top&&this.Hr.top.parent&&(this.Hr.top.parent.remove(this.Hr.top),this.Hr.top.geometry.dispose(),this.Hr.top.material.map&&this.Hr.top.material.map.dispose(),this.Hr.top.material.dispose(),this.Hr.top=null,t=this.qi(g))&&t.enableUpdateRender()},cp:function(t){this.Q0=t},Uh:function(){this.Av(),this.Sd=this.jh.color,this.ht=this.jh.alpha,this.q0=this.jh.strokeColor,this.K0=this.jh.alpha,this.l0=this.jh.strokeWidth,this.If&&(this.If.visible=0!==this.l0),this.Bh(),this.xi&&this.sp()},gp:function(t){var n=this.qi(v);return t.Cu({isline:!0,color:this.q0,opacity:this.K0*n.ht,needDepth:!0})},rp:function(){return!!this.xi&&this.xi.material.userData.dirtyTheme},Lr:function(t){var n=this.qi(v),e=this.qi(Go).Ht.fi,i={themeUseDetail:this.jh.themeUseDetail,level:n.level,buildingId:n.parent.buildingId},n={color:this.Sd,alpha:this.ht*n.ht,type:this.Fe},r=(e.Br.callHook("getMaterialBefor",{material:null==(r=this.xi)?void 0:r.material,additionalInfo:i}),t.Du(n,i));return e.Br.callHook("getMaterialAfter",{createInfo:n,material:r,additionalInfo:i}),this.Rr?((t=r.clone()).uniforms.isMask.value=!0,t.uniforms.maskType.value=this.Pr,t.uniforms.maskTexture.value=this.Lh,void 0!==this.Fr&&void 0!==this.Ir&&(t.uniforms.maskHeight.value=this.Fr,t.uniforms.maskExtrudeHeight.value=this.Ir),t.uniformsNeedUpdate=!0,t):r},mp:function(n,t){var e=this.qi(v),i=null;return this.Rr?((i=n.fi.Br.ku({})).depthTest=!0,i.depthWrite=!1,i.visible=!1,i.uniforms.isMask.value=!0,i.uniforms.maskType.value=this.Pr,i.uniforms.maskTexture.value=this.ip,void 0!==this.Fr&&void 0!==this.Ir&&(i.uniforms.maskHeight.value=this.Fr,i.uniforms.maskExtrudeHeight.value=this.Ir),i.uniforms.boundCenter.value=this.Cr,i.uniforms.boundSize.value=this.kr,i.uniformsNeedUpdate=!0):i=new kd({transparent:!0,opacity:e.ht,depthWrite:!1,visible:!1}),n.fi.Br.nc(t,function(t){i.map=t,i.map.wrapS=Xn,i.map.wrapT=Xn,i.needsUpdate=!0,i.visible=!0,i.polygonOffset=!0,i.polygonOffsetFactor=-1,i.polygonOffsetUnits=-4,n.enableUpdateRender()},{generateMipmaps:!0}),i},bp:function(){var t,n=this.Hr.top;n&&(n.material.map&&n.material.map.dispose(),n.material.map=null,n.material.dispose(),t=this.qi(g),n.material=this.mp(t,this.ev))},Bh:function(){var t,n;this.xi&&(t=this.qi(g))&&(this.xi.userData.sourceMaterial?this.xi.userData.sourceMaterial=this.Lr(t.fi.Br):(n=this.xi.material.userData,this.xi.material=this.Lr(t.fi.Br),this.xi.material.userData=n),this.op(t),this.bp(),t.enableUpdateRender())},op:function(t){if(this.If&&Math.floor(this.l0)<2){var n=this.pp(t.fi.Br);this.If.material=n;for(var e=0;e<this.If.children.length;e++)this.If.children[e].material=n}else this.If&&(this.xi.remove(this.If),this.If.mapNode instanceof Bw?(this.If.mapNode.width=this.l0,this.If.mapNode.color=this.q0):this.dp());t.enableUpdateRender()},yp:function(){var t=this.Hr.top,n=(t.scale.set(this.tp[0],this.tp[1],1),this.G.getBound());t.position.set(this.np[0]+this.hv.x-n.center.x,this.np[1]+this.hv.y-n.center.y,this.nt+.1),t.rotation.z=-this.nv*Math.PI/180},Av:function(){var t=this.qi(Go),n=t.Ht.fi;this.jh=n.Dh.jc({fid:this.G.fid,typeID:this.G.type+"",bid:t.je}),0===this.ep&&(this.jh.image?this.ev=n.Xd(this.jh,"logoPath",t.buildingID)+this.jh.image:this.ev=null,this.jh.coords&&(n=this.jh.coords.split(","),this.hv=new Mt(parseFloat(n[0]),parseFloat(n[1]))),this.jh.angle&&(this.nv=this.jh.angle),this.jh.sizes)&&(t=this.jh.sizes.split(","),this.tp=[parseFloat(t[0]),parseFloat(t[1])]),this.xi&&delete this.xi.material.userData.dirtyTheme},Rh:function(){var t,n;this.xi&&((n=this.qi(g))&&n.fi.Br.callHook("removeMaterial",{material:null==(t=this.xi)?void 0:t.material,additionalInfo:{themeUseDetail:this.jh.themeUseDetail}}),this.If&&(this.xi.remove(this.If),this.If.material.dispose(),this.If.geometry.dispose(),this.If=void 0,n&&this.vp&&this.vp.k0(n),this.vp=null),this.ap(),this.xi.parent&&this.xi.parent.remove(this.xi),this.xi.geometry.dispose(),this.xi.geometry=void 0,this.xi.material=void 0,this.xi.mapNode=void 0,this.xi=void 0)},$0:function(t){return(t=(9301*t+49297)%233280)/233280}}),e);function Kw(t){return(Kw="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Jw(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var i,r,o,s,a=[],u=!0,c=!1;try{if(o=(e=e.call(t)).next,0===n){if(Object(e)!==e)return;u=!1}else for(;!(u=(i=o.call(e)).done)&&(a.push(i.value),a.length!==n);u=!0);}catch(t){c=!0,r=t}finally{try{if(!u&&null!=e.return&&(s=e.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(t,n)||$w(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $w(t,n){var e;if(t)return"string"==typeof t?t_(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?t_(t,n):void 0}function t_(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function n_(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,a_(i.key),i)}}function e_(t,n,e){n=c_(n);var i=t,n=i_()?Reflect.construct(n,e||[],c_(t).constructor):n.apply(t,e);if(n&&("object"===Kw(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function i_(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(i_=function(){return!!t})()}function r_(){return(r_="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=u_(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function o_(t,n,e,i){return(o_="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,n,e,i){var r,t=u_(t,n);if(t){if((r=Object.getOwnPropertyDescriptor(t,n)).set)return r.set.call(i,e),!0;if(!r.writable)return!1}if(r=Object.getOwnPropertyDescriptor(i,n)){if(!r.writable)return!1;r.value=e,Object.defineProperty(i,n,r)}else s_(i,n,e);return!0})(t,n,e,i)}function s_(t,n,e){return(n=a_(n))in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function a_(t){t=function(t,n){if("object"!=Kw(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Kw(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Kw(t)?t:String(t)}function u_(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=c_(t)););return t}function c_(t){return(c_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f_(t,n){return(f_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var e=function(){var t,n=r,e=Oy;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function r(){if(this instanceof r)return e_(this,r);throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&f_(n,e),n=r,(e=[{key:"level",get:function(){return this.Ht.ar}},{key:"visible",get:function(){return this.Qi},set:function(t){var n=c_(r.prototype),e=t,i=!0;if(!o_(n,"visible",e,this||n)&&i)throw new TypeError("failed to set property");this.Qi=t,this.xo.visible=!(!this.Ht.visible||!this.Qi);e=this.qi(g);e&&e.fi.$o()}},{key:"getFeatures",value:function(){return this.It}},{key:"dispose",value:function(){this.Mh&&this.Mh(),r_(c_(r.prototype),"dispose",this).call(this)}},{key:"init",value:function(){r_(c_(r.prototype),"init",this).call(this);var t=this.qi(g);this.visible=t.fi.wp(this.Fe)}},{key:"getBound",value:function(){var t=this.bound;return{maxY:t.max.y,maxX:t.max.x,minX:t.min.x,minY:t.min.y}}},{key:"remove",value:function(t){this.xo.remove(t.xi),r_(c_(r.prototype),"remove",this).call(this,t)}}])&&n_(n.prototype,e),t&&n_(n,t),Object.defineProperty(n,"prototype",{writable:!1}),r}(),h_=(Object.assign(e.prototype,{Ti:function(t){(t.Ht=this).It.push(t)},_p:function(t,n){var e,i=s_(s_(s_(s_(s_({},S.EXTERNAL_MODEL_LAYER,Kb),S.MODEL_LAYER,qw),S.EXTENT_LAYER,bb),S.FACILITY_LAYER,rg),S.LABEL_LAYER,bg),r=function(t,n){var e,i,r,o,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return i=!(e=!0),{s:function(){s=s.call(t)},n:function(){var t=s.next();return e=t.done,t},e:function(t){i=!0,r=t},f:function(){try{e||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(t)||(s=$w(t))||n&&t&&"number"==typeof t.length)return s&&(t=s),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(t.It);try{for(r.s();!(e=r.n()).done;){var o=Jw(e.value,2),s=(o[0],o[1]),a=new i[this.Fe](s,n.map);this.Ti(a),this.type===S.MODEL_LAYER&&this.Ep.set(a.FID,a),a.visible=n.map.fi.Sp(this.Fe,{typeID:a.typeID,FID:a.FID})}}catch(t){r.e(t)}finally{r.f()}}}),e);function l_(t){return(l_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d_(t,n,e){return(n=p_(n))in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function v_(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,p_(i.key),i)}}function p_(t){t=function(t,n){if("object"!=l_(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=l_(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==l_(t)?t:String(t)}function m_(t,n,e){n=g_(n);var i=t,n=y_()?Reflect.construct(n,e||[],g_(t).constructor):n.apply(t,e);if(n&&("object"===l_(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function y_(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(y_=function(){return!!t})()}function b_(){return(b_="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=g_(t)););return t}(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function g_(t){return(g_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function w_(t,n){return(w_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var e=function(){var t,n=i,e=h_;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(){if(this instanceof i)return m_(this,i);throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&w_(n,e),n=i,(e=[{key:"init",value:function(){b_(g_(i.prototype),"init",this).call(this),this.Eh(),this.Sh(),this.type===S.EXTERNAL_MODEL_LAYER&&T1(this)}}])&&v_(n.prototype,e),t&&v_(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),__=(Object.assign(e.prototype,{Eh:function(){var t=d_(d_(d_({},S.EXTERNAL_MODEL_LAYER,"FMExternalModelLayer"),S.MODEL_LAYER,"FMModelLayer"),S.EXTENT_LAYER,"FMExtentLayer"),n=this.qi(g),t=t[this.Fe],e=n.fi.Rc.get(n.getMapOptions().mapID).theme;n.getMapOptions().isuserLight||!e.ic?this.Ah=new E1(n).createLight(this,t):(e=n.fi.Rc.get(n.getMapOptions().mapID).theme.ic,this.Ah=new E1(n).createLightByTheme(this,t,e.extent))},Sh:function(){this.xo.add(this.mh),this.xo.add(this.dh),this.xo.add(this.yh),this.xo.add(this.ph),this.gh&&this.xo.add(this.gh)},Mh:function(){this.xo.remove(this.mh),this.xo.remove(this.dh),this.xo.remove(this.yh),this.Ah.nn()}}),e);function E_(t){return(E_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function S_(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=E_(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=E_(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==E_(t)?t:String(t)}(i.key),i)}}function T_(t,n,e){n=A_(n);var i=t,n=x_()?Reflect.construct(n,e||[],A_(t).constructor):n.apply(t,e);if(n&&("object"===E_(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function x_(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(x_=function(){return!!t})()}function A_(t){return(A_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function M_(t,n){return(M_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}e=function(){var t,n,e=r,i=__;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(t,n){var e;if(this instanceof r)return(e=T_(this,r)).nr=t.alias,e.Tp=t.desc,e.nt=t.height,e.Fe=S.EXTENT_LAYER,e.xo.name="extent",e.xo.userData.type="extent",e.xp={},e._p(t,n),e;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&M_(e,i),e=r,t&&S_(e.prototype,t),n&&S_(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}();function O_(t){return(O_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function L_(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=O_(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=O_(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==O_(t)?t:String(t)}(i.key),i)}}function R_(t,n,e){n=P_(n);var i=t,n=N_()?Reflect.construct(n,e||[],P_(t).constructor):n.apply(t,e);if(n&&("object"===O_(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function N_(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(N_=function(){return!!t})()}function P_(t){return(P_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function j_(t,n){return(j_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var F_=function(){var t,n=i,e=__;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t,n){var e;if(this instanceof i)return(e=R_(this,i)).Fe=S.MODEL_LAYER,e.xo.name="model",e.xo.userData.type="model",e.nr="model",e.Ap={},e.Ep=new Map,e._p(t,n),e;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&j_(n,e),n=i,(e=[{key:"height",get:function(){return this.Ht.nt}}])&&L_(n.prototype,e),t&&L_(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}();function I_(t){return(I_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function C_(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=I_(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=I_(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==I_(t)?t:String(t)}(i.key),i)}}function k_(t,n,e){n=U_(n);var i=t,n=D_()?Reflect.construct(n,e||[],U_(t).constructor):n.apply(t,e);if(n&&("object"===I_(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function D_(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(D_=function(){return!!t})()}function U_(t){return(U_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function B_(t,n){return(B_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var G_=function(){var t,n=i,e=h_;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(){if(this instanceof i)return k_(this,i);throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&B_(n,e),n=i,(e=[{key:"collision",get:function(){return this.Yo},set:function(t){this.Yo!==t&&(this.Yo=t,t=this.qi(g))&&t.fi.$o()}}])&&C_(n.prototype,e),t&&C_(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}();function H_(t){return(H_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function X_(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=H_(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=H_(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==H_(t)?t:String(t)}(i.key),i)}}function z_(t,n,e){n=W_(n);var i=t,n=V_()?Reflect.construct(n,e||[],W_(t).constructor):n.apply(t,e);if(n&&("object"===H_(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return Y_(i)}function V_(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(V_=function(){return!!t})()}function W_(t){return(W_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Y_(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Q_(t,n){return(Q_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Z_=function(){var t,n=i,e=G_;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t,n){var e;if(this instanceof i)return(e=z_(this,i)).Fe=S.LABEL_LAYER,e.xo.userData.type="label",e.xo.name="label",e.xo.mapNode=Y_(e),e.nr="label",e.Mp={},e._p(t,n),e.Yo=!0,e;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Q_(n,e),n=i,(e=[{key:"type",get:function(){return this.Fe}}])&&X_(n.prototype,e),t&&X_(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}();function q_(t){return(q_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function K_(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=q_(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=q_(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==q_(t)?t:String(t)}(i.key),i)}}function J_(t,n,e){n=t2(n);var i=t,n=$_()?Reflect.construct(n,e||[],t2(t).constructor):n.apply(t,e);if(n&&("object"===q_(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return n2(i)}function $_(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return($_=function(){return!!t})()}function t2(t){return(t2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function n2(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function e2(t,n){return(e2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var i2=function(){var t,n,e=r,i=G_;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(t,n){var e;if(this instanceof r)return(e=J_(this,r)).Fe=S.FACILITY_LAYER,e.xo.userData.type="facility",e.xo.name="facility",e.nr="facility",e.Op={},e.Yo=!0,e.xo.mapNode=n2(e),e._p(t,n),e;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&e2(e,i),e=r,t&&K_(e.prototype,t),n&&K_(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}();function r2(t){return(r2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o2(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=r2(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=r2(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==r2(t)?t:String(t)}(i.key),i)}}function s2(t,n,e){n=u2(n);var i=t,n=a2()?Reflect.construct(n,e||[],u2(t).constructor):n.apply(t,e);if(n&&("object"===r2(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function a2(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(a2=function(){return!!t})()}function u2(t){return(u2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c2(t,n){return(c2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var f2=function(){var t,n=i,e=__;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t,n){var e;if(this instanceof i)return(e=s2(this,i)).Fe=S.EXTERNAL_MODEL_LAYER,e.xo.name="externalModel",e.xo.userData.type="externalModel",e.nr="externalModel",e.Ap={},e._p(t,n),e;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&c2(n,e),n=i,(e=[{key:"height",get:function(){return this.Ht.nt}},{key:"beforRemove",value:function(){this.traverse(function(t){t.beforRemove&&t.beforRemove()})}}])&&o2(n.prototype,e),t&&o2(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}();function h2(t){return(h2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l2(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=h2(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=h2(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==h2(t)?t:String(t)}(i.key),i)}}function d2(t,n,e){n=p2(n);var i=t,n=v2()?Reflect.construct(n,e||[],p2(t).constructor):n.apply(t,e);if(n&&("object"===h2(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function v2(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(v2=function(){return!!t})()}function p2(t){return(p2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function m2(t,n){return(m2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var y2=function(){var t,n,e=r,i=ky;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(){var t;if(this instanceof r)return(t=d2(this,r)).Fe=S.WALL_MARKER,t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&m2(e,i),e=r,t&&l2(e.prototype,t),n&&l2(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}();function b2(t){return(b2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g2(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=b2(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=b2(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==b2(t)?t:String(t)}(i.key),i)}}function w2(t,n,e){n=E2(n);var i=t,n=_2()?Reflect.construct(n,e||[],E2(t).constructor):n.apply(t,e);if(n&&("object"===b2(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _2(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_2=function(){return!!t})()}function E2(t){return(E2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function S2(t,n){return(S2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var T2=function(){var t,n,e=r,i=ky;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(){var t;if(this instanceof r)return(t=w2(this,r)).Fe=S.TUBE_MARKER,t.Eh(),t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&S2(e,i),e=r,t&&g2(e.prototype,t),n&&g2(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}();Object.assign(T2.prototype,{Eh:function(){this.dh=new g1(7631988),this.ph=new a,this.mh=new vv(8947848,1.2),this.mh.position.set(-1,1,1).normalize(),this.mh.castShadow=!1,this.mh.target=this.ph,this.yh=new vv(3355443),this.yh.position.set(-.5,1,-1).normalize(),this.yh.target=this.ph,this.xo.add(this.mh),this.xo.add(this.yh),this.xo.add(this.dh),this.xo.add(this.ph)}});function x2(t){return(x2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function A2(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=x2(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=x2(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==x2(t)?t:String(t)}(i.key),i)}}function M2(t,n,e){n=L2(n);var i=t,n=O2()?Reflect.construct(n,e||[],L2(t).constructor):n.apply(t,e);if(n&&("object"===x2(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function O2(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(O2=function(){return!!t})()}function L2(t){return(L2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function R2(t,n){return(R2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var N2=function(){var t,n,e=r,i=ky;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(){var t;if(this instanceof r)return(t=M2(this,r)).Fe=S.LINE3D_MARKER,t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&R2(e,i),e=r,t&&A2(e.prototype,t),n&&A2(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}();function P2(t){return(P2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function j2(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=P2(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=P2(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==P2(t)?t:String(t)}(i.key),i)}}function F2(t,n,e){n=C2(n);var i=t,n=I2()?Reflect.construct(n,e||[],C2(t).constructor):n.apply(t,e);if(n&&("object"===P2(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function I2(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(I2=function(){return!!t})()}function C2(t){return(C2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function k2(t,n){return(k2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var D2=function(){var t,n,e=r,i=ky;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(){var t;if(this instanceof r)return(t=F2(this,r)).Fe=S.SPHERE_MARKER,t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&k2(e,i),e=r,t&&j2(e.prototype,t),n&&j2(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(),U2={},B2=(U2.LAYER_CLASS=new Map,U2.LAYER_CLASS.set(S.EXTENT_LAYER,e),U2.LAYER_CLASS.set(S.MODEL_LAYER,F_),U2.LAYER_CLASS.set(S.LABEL_LAYER,Z_),U2.LAYER_CLASS.set(S.FACILITY_LAYER,i2),U2.LAYER_CLASS.set(S.EXTERNAL_MODEL_LAYER,f2),U2.LAYER_CLASS.set(S.IMAGE_MARKER,n),U2.LAYER_CLASS.set(S.TEXT_MARKER,Bv),U2.LAYER_CLASS.set(S.POLYGON_MARKER,Dv),U2.LAYER_CLASS.set(S.EXTRUDE_MARKER,Uv),U2.LAYER_CLASS.set(S.HEAT_MAP_MARKER,b1),U2.LAYER_CLASS.set(S.DYNAMIC_MODEL_MARKER,P1),U2.LAYER_CLASS.set(S.LINE_MARKER,B1),U2.LAYER_CLASS.set(S.LOCATION_MARKER,Q1),U2.LAYER_CLASS.set(S.DOM_MARKER,nb),U2.LAYER_CLASS.set(S.WALL_MARKER,y2),U2.LAYER_CLASS.set(S.TUBE_MARKER,T2),U2.LAYER_CLASS.set(S.LINE3D_MARKER,N2),U2.LAYER_CLASS.set(S.SPHERE_MARKER,D2),U2);function G2(t){return(G2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function H2(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var i,r,o,s,a=[],u=!0,c=!1;try{if(o=(e=e.call(t)).next,0===n){if(Object(e)!==e)return;u=!1}else for(;!(u=(i=o.call(e)).done)&&(a.push(i.value),a.length!==n);u=!0);}catch(t){c=!0,r=t}finally{try{if(!u&&null!=e.return&&(s=e.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(t,n)||X2(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X2(t,n){var e;if(t)return"string"==typeof t?z2(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?z2(t,n):void 0}function z2(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function V2(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=G2(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=G2(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==G2(t)?t:String(t)}(i.key),i)}}function W2(t,n,e){n=Z2(n);var i=t,n=Y2()?Reflect.construct(n,e||[],Z2(t).constructor):n.apply(t,e);if(n&&("object"===G2(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function Y2(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Y2=function(){return!!t})()}function Q2(){return(Q2="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=Z2(t)););return t}(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function Z2(t){return(Z2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function q2(t,n){return(q2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var e=function(){var t,n=i,e=Fo;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(this instanceof i)return(n=W2(this,i)).Ve=t.mapOptions,n.Ft=t.states,n.G=t.data,n.ar=n.G.gid,n.Lp=n.G.gname,n.Rp=n.G.alias,n.Np=n.G.desc,n.nt=0,n.Pp=null,n.jp=[S.EXTENT_LAYER,S.EXTERNAL_MODEL_LAYER,S.MODEL_LAYER,S.LABEL_LAYER,S.FACILITY_LAYER],n.ht=1,n.Fp=!0,n.Ip=new qo,n.Ip.isEffect=!0,n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&q2(n,e),n=i,(e=[{key:"bound",get:function(){return yy(this)}},{key:"height",get:function(){return this.nt}},{key:"type",get:function(){return this.G.Fe}},{key:"center",get:function(){var t=this.Pp;return{x:(t.minX+t.maxX)/2,y:(t.minY+t.maxY)/2}}},{key:"x",get:function(){return this.center.x}},{key:"y",get:function(){return this.center.y}},{key:"visible",get:function(){return this.Qi},set:function(t){var n=this,t=(this.Qi=t,this.traverse(function(t){t.xo.visible=!(!t.visible||!n.Qi)}),this.qi(g));t&&t.fi.$o()}},{key:"level",get:function(){return this.ar}},{key:"name",get:function(){return this.Lp}},{key:"ID",get:function(){return this.je}},{key:"alias",get:function(){return this.Rp}},{key:"floorID",get:function(){return this.G.floorId}},{key:"effectScene",get:function(){return this.Ip}},{key:"getLayers",value:function(t,n){if(void 0===t)return this.It;for(var e=[],i=0;i<this.It.length;i++)0==(this.It[i].type&t)==!!n&&e.push(this.It[i]);return e}},{key:"getExtendMesh",value:function(){var t=this.getLayers(S.EXTENT_LAYER)[0];return t?t.It[0].xi:null}},{key:"getExtendByCoords",value:function(t){for(var n=null,e=this.getLayers(S.EXTENT_LAYER)[0],i=0;i<e.It.length;i++){var r=e.It[i],o=r.G.Ie[0];if(W.Un(t,o,o.length)){n=r;break}}return n}},{key:"getModelMeshs",value:function(){for(var t=this.getLayers(S.MODEL_LAYER)[0],n=[],e=0;e<t.It.length;e++)n.push(t.It[e].xi);return n}},{key:"getBound",value:function(){return this.G.getBound().toObject()}},{key:"setExtentImage",value:function(t){for(var n=this.getLayers(S.EXTENT_LAYER)[0],e=0;e<n.It.length;e++)n.It[e].Gh(t)}},{key:"clearExtentImage",value:function(){this.setExtentImage("")}},{key:"getOrCreateLayer",value:function(t){var n=this.getLayers(t)[0];return void 0!==n||(n=new(B2.LAYER_CLASS.get(t)),this.Ti(n),this.qi(g).Dt.zi()),n}},{key:"getMapCoordsRange",value:function(){return this.Pp}},{key:"opacity",value:function(){return this.ht}},{key:"remove",value:function(t){t.beforRemove&&t.beforRemove(),Q2(Z2(i.prototype),"remove",this).call(this,t);t=this.qi(g);t&&t.Dt&&t.Dt.zi()}}])&&V2(n.prototype,e),t&&V2(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),v=(Object.assign(e.prototype,{Cp:function(){var t=this.Ft.Xi(this.Ht.je);t.nonFocusAlphaMode&&(this.Ht.level===this.ar?1!==this.ht&&(this.ht=1,this.Fp=!0):this.ht!==t.nonFocusAlpha&&(this.ht=t.nonFocusAlpha,this.Fp=!0))},Ti:function(t){(t.Ht=this).It.push(t),this.needUpdateBound=!0,t.init(),this.kp(t)},kp:function(t){this.Ip.add(t.xo)},Dp:function(){var i,r,t,o=this,n=this.Ht;this.Ht.constructor===$m?this.nt=n.floorSpace*this.ar:1===n.visibleLevels.length&&this.Ft.jt!=n.buildingID?(t=n.parent.kt,this.nt=t.getFloor(t.level).height):(i=1/0,r=0,(t=n.alignHeight).forEach(function(t,n,e){Math.abs(o.ar-n)<i&&(i=Math.abs(o.ar-n),r=n)}),this.nt=t.get(r)+n.floorSpace*(this.ar-r))},Up:function(t){t.Fe===S.LOCATION_MARKER&&t.It.forEach(function(t){t.Bv()})},sr:function(t){function e(){o.So.It.forEach(function(t){t.Fe===S.LINE_MARKER&&t.Bv({needUpdateCrossLine:1<i.parent.visibleLevels.length})}),o.enableUpdateNode()}var i=this,n=void 0===(t=t||{}).animate||t.animate,r=void 0!==t.duration?t.duration:.5,o=this.qi(g),s=this.nt;this.Dp();n?(this.Bp||(this.Bp=new Wi),this.Bp.en([s]).rn([this.nt]).sn(r).un(function(n){i.traverse(function(t){t.Fe!==S.LINE_MARKER&&t.Fe!==S.LOCATION_MARKER&&(t.xo.position.y=n.destination[0]),i.Up(t)}),e()}).cn(function(){t.finish&&t.finish(),o.Oi.ji(i.Bp)}),o.Oi.Ti(this.Bp.tn())):(this.Bp&&this.Bp.stop(),this.traverse(function(t){t.Fe!==S.LINE_MARKER&&t.Fe!==S.LOCATION_MARKER&&(t.xo.position.y=i.nt),i.Up(t)}),e())},Gp:function(e){for(var t=0;t<this.It.length;t++)if("externalModel"===this.It[t].nr)this.It[t].xo.traverse(function(t){if("Mesh"===t.type&&t.material.length)for(var n=0;n<t.material.length;n++)t.material[n].userData.oldAlpha||(t.material[n].userData.oldAlpha=t.material[n].opacity),t.material[n].opacity=e});else for(var n=this.It[t].xo.children,i=0;i<n.length;i++)n[i].material&&(n[i].material.userData.oldAlpha||(n[i].material=n[i].material.clone(),n[i].material.userData.oldAlpha=n[i].material.opacity),n[i].material.opacity=e)},Hp:function(){for(var t=0;t<this.It.length;t++)if("externalModel"===this.It[t].nr)this.It[t].xo.traverse(function(t){if("Mesh"===t.type)if(t.material.length)for(var n=0;n<t.material.length;n++)t.material[n].userData.oldAlpha&&(t.material[n].opacity=t.material[n].userData.oldAlpha);else t.material.userData.oldAlpha&&(t.material.opacity=t.material.userData.oldAlpha)});else for(var n=this.It[t].xo.children,e=0;e<n.length;e++)n[e].material&&n[e].material.userData.oldAlpha&&(n[e].material.opacity=n[e].material.userData.oldAlpha)},Xp:function(){var n=this;this.Ht.Ht.dr.lr.get(this.Ht.Ji).It.forEach(function(t){t.gid===n.ar&&(t=t.It.get(S.EXTENT_LAYER).getBound(),n.Pp={minX:t.X.x,minY:t.X.y,maxX:t.H.x,maxY:t.H.y})})},zp:function(){var i,r=this,t=this.G,o=null,s=this.qi(g),n=function(t,n){var e,i,r,o,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return i=!(e=!0),{s:function(){s=s.call(t)},n:function(){var t=s.next();return e=t.done,t},e:function(t){i=!0,r=t},f:function(){try{e||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(t)||(s=X2(t))||n&&t&&"number"==typeof t.length)return s&&(t=s),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(t.It);try{for(n.s();!(i=n.n()).done;)!function(){var t=H2(i.value,2),n=t[0],t=t[1];if(r.It.some(function(t){return t.type===n}))return;var e=B2.LAYER_CLASS.get(n);o=new e(t,{map:s}),r.Ti(o)}()}catch(t){n.e(t)}finally{n.f()}},Vp:function(t,n){for(var e=null,i=0;i<t.length;i++)if(""+t[i].Fe==""+n){e=t[i];break}return e},iv:function(t){return this.It[2].Ep.get(t)}}),e);var K2={isDestory:!1,textureCanvas:null,dispose:function(){}};function J2(t){return(J2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $2(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=J2(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=J2(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==J2(t)?t:String(t)}(i.key),i)}}function tE(t,n,e){return n&&$2(t.prototype,n),e&&$2(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var F_=tE(function t(n,e,i,r){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.Lt=n,this.Ve=e,this.Ft=i,this.Jt=r,this.Br=new dd(this),this.Ve.themeTool&&this.Ve.themeTool.setMaterialManager(this.Br),this.G=null,this.Ud=new Q0(n),this.Ud.Ef=this.Ve.ClassicMaterial,this.Wp=new np(n),this.Dh=new Ed(this),this.Rc=new Map,this.Do=[],this.Yp=[],this.Qp=0,this.Zp=!1,this.Kt=this.Kt.bind(this),this.qp=null,this.Kp=this.Kp.bind(this),this.Jp=new Gt(new xt(0,1,0),0),this.yr=new Oo,this.$p=!0,n.on("visibleLevelsLoaded",this.Kp),n.on("loaded",this.Kp),n.on("viewChanged",this.Kp),n.on("viewModeChanged",this.Kp),n.on("buildingEntered",this.Kp),n.on("buildingExited",this.Kp),n.on("zoom",this.Kp),n.on("move",this.Kp),n.on("mapLoaded",this.Kp),n.on("levelChanged",this.Kp),n.on("sceneLoaded",this.Kp),n.on("firstViewLoaded",this.Kp),n.on("beforeRender",this.Kt),this.Fa=null,this.Mo=this.Mo.bind(this),this.Vs=new dh({disposeCallback:this.Mo,enable:!0,name:"NodeManager",mapCreateTime:this.Lt.wu}),null!=(i=e.webWorker)&&i.useWebWorker&&(this.Xo=new st.a.TaskProcessor("workerCore.js",e.webWorker),this.Dv=new st.a.TaskProcessor("workerCalculate.js",e.webWorker))}),nE=(Object.assign(F_.prototype,{Kp:function(n){var t,e=this;if("visibleLevelsLoaded"!==n.type&&"loaded"!==n.type&&"viewChanged"!==n.type||(this.Ft.tm=!0,this.$o()),"viewModeChanged"===n.type&&this.Lt.Nt.Ut.updateCheck(),"mapLoaded"===n.type&&this.Lt.nm(function(t){e.im({bid:t.je})}),"move"===n.type&&this.Lt.rm(),"buildingEntered"!==n.type&&"buildingExited"!==n.type||this.im({bid:n.buildingID}),"zoom"===n.type){if(this.Lt.rm(),this.Lt.traverse(function(t){t!==e.Lt.kt&&(e.im({bid:t.je}),t.Qf())}),st.a.environment===G.a.WX){if(void 0===K2.lastHandleZoomTime&&(K2.lastHandleZoomTime=Date.now()),Date.now()-K2.lastHandleZoomTime<50)return void(K2.lastHandleZoomTime=Date.now());K2.lastHandleZoomTime=Date.now()}this.Lt.traverse(function(t){t.visible&&t.traverse(function(t){t.visible&&t.traverse(function(t){t.visible&&t.traverse(function(t){t.type===S.EXTERNAL_MODEL&&t.xi&&(!(t.G&&(t.G.maxlevel<=n.zoom||t.G.minlevel>n.zoom))?t.fading&&t.Id():t.Cd())})})})})}"levelChanged"!==n.type&&"visibleLevelsLoaded"!==n.type||(n.buildingID&&n.buildingID!==this.Lt.Ve.buildingID?(t=this.Lt.getBuilding(n.buildingID))&&t.traverse(function(t){t.sr()}):this.Lt.traverse(function(t){"levelChanged"===n.type&&t.je!==e.Lt.Ve.buildingID&&t.Zf(n.level),t.traverse(function(t){t.sr({animate:!1})})})),"sceneLoaded"!==n.type||n.buildingID||this.om(n.type),"visibleLevelsLoaded"===n.type&&void 0===n.buildingID&&this.om(n.type),"loaded"===n.type&&this.om(n.type),"firstViewLoaded"===n.type&&this.om(n.type)},V0:function(t){var n=(new xt).copy(this.Lt.Nt.Ut.target),e=new Mt(0,0);return n.y=t+e.y,10/("PerspectiveCamera"===this.Lt.ze.type?(t=this.Lt.ze.near,e=this.Lt.ze.fov,n=this.Lt.Nt.Ut.object.position.distanceTo(n),10*t*Math.tan(e/2*f.DEG2RAD)*2/this.Lt.Dt.renderer.domElement.clientHeight*n/t):(e=this.Lt.ze.top,n=this.Lt.ze.bottom,10*Math.abs(e-n)/this.Lt.Dt.renderer.domElement.clientHeight/this.Lt.ze.zoom))},Kt:function(){this.Ft.Hc&&(this.sm(),this.am(),this.ko(),this.Uo(),this.Lt.Dt.es(),this.Lt.Dt.Zo())},$o:function(){this.Lt.Dt.$o()},zi:function(){this.Lt.Dt.zi()},um:function(t,n){var e,i,r;return!t.getBound||!n||!(t=t.boundNoClone)||(e=!0,i=t.max,t=t.min,r=n.max,n=n.min,!(i.x<n.x||t.x>r.x||i.y<n.y||t.y>r.y)&&e)},fm:function(t,n){for(var e=[],i=[],r=this.Ve.container.clientWidth,o=this.Ve.container.clientHeight,s=(e.push(Oi.coordsScreenToMap(this.Lt,{x:0,y:0,level:n,buildingID:t.je})),e.push(Oi.coordsScreenToMap(this.Lt,{x:r,y:0,level:n,buildingID:t.je})),e.push(Oi.coordsScreenToMap(this.Lt,{x:r,y:o,level:n,buildingID:t.je})),e.push(Oi.coordsScreenToMap(this.Lt,{x:0,y:o,level:n,buildingID:t.je})),t.visibleLevels),a=new Ur,u=0;u<s.length;u++){var c=t.getFloor(s[u]).getBound();a.Se([c.max,c.min])}i.push({x:a.min.x,y:a.min.y}),i.push({x:a.min.x,y:a.max.y}),i.push({x:a.max.x,y:a.max.y}),i.push({x:a.max.x,y:a.min.y});r=[],Jp.PolygonClip(e,i,r),o=new Zp;return o.setFromPoints(r),o},hm:function(t,n){var e=new Sp,i=t[0];if(0<i.length){e.moveTo(i[0].x-n.center.x,i[0].y-n.center.y);for(var r=1;r<i.length;r++)e.lineTo(i[r].x-n.center.x,i[r].y-n.center.y)}if(1<t.length)for(var o=1;o<t.length;o++){var s=t[o],a=new Ep;if(0<s.length){a.moveTo(s[0].x-n.center.x,s[0].y-n.center.y);for(var u=1;u<s.length;u++)a.lineTo(s[u].x-n.center.x,s[u].y-n.center.y)}e.holes.push(a)}return e},vf:function(t,n,e,i){for(var r,o,s,a=t.Ie,u=t.getBound(),t=this.hm(a,u),c=null,c=0===n?new Xp(t):new Vp(t,{depth:n,bevelEnabled:!1}),f=i?(r=e.min.x,o=e.min.y,s=e.max.x-r,e.max.y-o):(r=u.min.x,o=u.min.y,s=u.max.x-r,u.max.y-o),h=c.faces,l=h.length,d=0;d<l;d++){var v=c.vertices[h[d].a],p=c.vertices[h[d].b],m=c.vertices[h[d].c];c.faceVertexUvs[0][d][0].x=(v.x+u.center.x-r)/s,c.faceVertexUvs[0][d][0].y=(v.y+u.center.y-o)/f,c.faceVertexUvs[0][d][1].x=(p.x+u.center.x-r)/s,c.faceVertexUvs[0][d][1].y=(p.y+u.center.y-o)/f,c.faceVertexUvs[0][d][2].x=(m.x+u.center.x-r)/s,c.faceVertexUvs[0][d][2].y=(m.y+u.center.y-o)/f}return c.computeBoundingSphere(),{geometry:c,shape:t}},kh:function(t){var e=this,i=t.type,r=t.data,o=t.amount,s=t.referenceBound;return new Promise(function(t,n){t(e.vf(r,o,s,i==S.MODEL))})},lm:function(t){var i=new N;return t.forEach(function(t){var n=t.itemSize,e=t.array,t=t.key,e=new Float32Array(e);i.setAttribute(t,new R(e,n))}),i},Ch:function(t){var c=this,f=t.data,h=t.amount,l=t.referenceBound,d=t.type,v=t.createLineType,p=t.lineHeight;return new Promise(function(i,t){for(var e=[],n=(f.Ie.forEach(function(t,n){e[n]=[],t.forEach(function(t){e[n].push(t.x,t.y)})}),[]),r=0;r<e.length;r++){var o=e[r],s=new ArrayBuffer(8*o.length);new Float64Array(s).set(o),n.push(s)}var a=f.getBound(),u=null;l&&(u={max:{x:l.max.x,y:l.max.y},min:{x:l.min.x,y:l.min.y}}),c.Xo.Ho({type:d,coordGroup:n,bound:{max:{x:a.max.x,y:a.max.y},min:{x:a.min.x,y:a.min.y}},referenceBound:u,amount:h,lineHeight:p,createLineType:v},n).then(function(t){var n,t=t.result,e=t.attributesInfo,t=t.lineAttributeInfo,e=c.lm(e);e.computeBoundingBox(),e.computeBoundingSphere(),"geometry"===v?n=c.lm(t):"onlyData"===v&&(n=new Float32Array(t)),i({shape:1<f.Ie.length?c.hm(f.Ie,a):null,lineData:n,geometry:e})})})},Wf:function(e){var i=this,r=this.Ft.Xi(e.bid);r.themeNeedLoad=!0,r.themeLoaded=!1,this.dm({themeID:e.themeID},function(t){r.themeID=e.themeID;var n=i.Rc.get(e.bid);n||(i.Rc.set(e.bid,{theme:new bd}),n=i.Rc.get(e.bid)),n.theme.wc(t),r.themeLoaded=!0,e.bid===i.Ve.buildingID&&(i.Ft.Av(i.Dh),i.Lt.setBackgroundColor(i.Ft.backgroundColor,i.Ft.backgroundAlpha)),i.vm()})},Yf:function(t){var n=this.Rc.get(t.bid);t.data?(n||(this.Rc.set(t.bid,{themeExtension:new sm}),n=this.Rc.get(t.bid)),n.themeExtension||(n.themeExtension=new sm),n.themeExtension.wc(t.data)):n&&n.themeExtension&&(this.Ve.buildingID===t.bid?n.themeExtension.resize():(n.themeExtension.nn(),n.themeExtension=null)),this.Ft.Av(this.Dh),this.Lt.setBackgroundColor(this.Ft.backgroundColor,this.Ft.backgroundAlpha),!1!==t.needUpdataNode&&this.pm(t)},nn:function(t){var n=this;this.Lt.off("visibleLevelsLoaded",this.Kp),this.Lt.off("loaded",this.Kp),this.Lt.off("viewChanged",this.Kp),this.Lt.off("viewModeChanged",this.Kp),this.Lt.off("buildingEntered",this.Kp),this.Lt.off("zoom",this.Kp),this.Lt.off("move",this.Kp),this.Lt.off("buildingLoaded",this.Kp),this.Lt.off("beforeRender",this.Kt),this.Fa=t,this.Br.nn(function(){n.Br=null,n.Vs.Gs(!0)})},Mo:function(){for(var t in this.Do=[],this.Ud.nn(),this.Ud=null,this.Rc.clear(),this.Xo&&this.Xo.ym(),this.Dv&&this.Dv.ym(),this.Lt=null,this)this[""+t]&&this[""+t].nn&&this[""+t].nn();for(var n in this.Fa&&this.Fa({name:"NodeManager"}),this)this[""+n]=null,delete this[""+n]}}),Object.assign(F_.prototype,{Xd:function(t,n,e){var i=this.Ft.Xi(this.Lt.kt.je).themeID,r=this.Ve,o=this.Rc.get(this.Ve.buildingID).theme,s="";if(s=e===this.Ve.buildingID?r.userThemeURL?r.userThemeURL+i:r.themeURL+i:(e=(e=this.Rc.get(e))&&e.theme?e.theme.themeID:i,r.userThemeURL?r.userThemeURL+e:r.themeURL+e),r.isPreview)return i=r.themeURL,"path"===n?("1"===t.isuser?i+=o.userPath+"/":i+=o.sysPath+"/",i):"logoPath"===n?i+(o.logoPath+"/"):"model"===n?("1"===t.isuser?i+=o.userModelPath+"/":i+=o.sysModelPath+"/",i):void 0;if("model"===n){if(r.externalModelURL)return r.externalModelURL+"models/";if(r.userThemeURL)return s+"/models/"}return s+"/"},om:function(t){if(this.bm||(this.bm=[0,0,0,0,0]),!this.bm.every(function(t){return 1==t})){var n=!0;switch(t){case"sceneLoaded":n=(this.bm[0]=1)===this.bm[0],this.Qp=5;break;case"loaded":n=(this.bm[1]=1)===this.bm[1],this.Qp=85;break;case"externalFirstLoaded":this.bm[2]=1,this.bm[4]?this.Qp=100:n=!1;break;case"visibleLevelsLoaded":n=(this.bm[3]=1)===this.bm[3],this.Qp=55;break;case"firstViewLoaded":this.bm[4]=1,this.bm[2]?this.Qp=100:n=!1}n&&this.Lt.Qe.Ye({type:"progress",progressBar:this.Qp})}},Tf:function(){var n;this.Ft.gm||this.Ft.ns&&0===this.Do.length&&(n=!0,this.Ud.Qa.forEach(function(t){t.loadComplete||(n=!1)}),n)&&(this.Ft.gm=!0,this.Lt.Qe.Ye({type:"externalFirstLoaded"}),this.om("externalFirstLoaded"))},wm:function(t,o){var s=this;if(this.Ve.tile&&!this.Ve.preLoad){for(var a=[],u=t.building,n=0;n<u.visibleLevels.length;n++){var e=u.getFloor(u.visibleLevels[n]);e&&0===this._m(e)&&(this.Em(e)?(e.zp(),this.Sm(e)):a.push(u.visibleLevels[n]))}0<a.length?((t=Gm(u,this)).buildings=null,this.Lt.dr.Na(t,function(t,n){if("floor"===t){var e=s.Ft.Tm(u.je);if(e.set(n.gid,!0),-1<a.indexOf(n.gid)){for(var t=u.getFloor(n.gid),i=(s.xm(t),!0),r=0;r<a.length;r++)if(!e.get(a[r])){i=!1;break}i&&o&&o()}}})):o&&o()}else o&&o()},Am:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=this.Ft.Xi(t),i=e.themeExtension||n.themeExtension,r=e.themeID||n.themeID;r&&t?(this.Rc.set(t,{theme:new bd}),e.themeLoaded=!1,e.themeNeedLoad=!0,this.Gc({bid:t,themeID:r,themeExtension:i,contentVersion:n.contentVersion})):(e.themeLoaded=!0,e.themeNeedLoad=!1)},Mm:function(c){var f=this,t=(c=c||[],this.Lt.Ve.buildingOptions),h=t.buildings||t.themeID,l=null;(function t(){var n=f.Lt.getBuildings();if(!1===f.Lt.Bc)l=setTimeout(t,1);else{null!==l&&clearTimeout(l);var e=[];if(0<c.length)for(var i=0;i<c.length;i++){var r=c[i].bcode,r=f.Om(r);f.Am(r,c[i]),e.push(r)}if(h)for(var o=0;o<n.length;o++){var s=n[o].buildingID;e.includes(s)||f.Am(s)}if(e.length!==n.length)for(var a=0;a<n.length;a++){var u=n[a].buildingID;e.includes(u)||((u=f.Ft.Xi(u)).themeLoaded=!0,u.themeNeedLoad=!1)}}})()},Gc:function(i){var r=this;return new Promise(function(e,t){r.dm(i,function(t){var n=r.Rc.get(i.bid);n.theme.wc(t),n.theme.themeID=i.themeID,i.themeExtension&&(n.themeExtension=new sm,n.themeExtension.wc(i.themeExtension)),r.Ft.Xi(i.bid).themeLoaded=!0,i.bid===r.Ve.buildingID&&(r.Ft.Av(r.Dh),r.Lt.setBackgroundColor(r.Ft.backgroundColor,r.Ft.backgroundAlpha),r.Ve.isPreview?r.Dh.Uc(r.Lt):r.Mm(t.buildings)),r.Ft.Hc=r.Xc(),(r.Ft.Lm||r.Ft.Rm)&&(r.Jt(null,null,r.Ft.Lm,!1,r.Ft.Rm,r.Ft.Hc),r.Ft.Lm)&&(r.Ft.Lm=!1),e()})})},dm:function(t,n){var e,i=this;t.theme?n(t.theme):(e="_loadTheme"+Tt.generateUUID(),this.Vs.Hs(e),hm.cs(this.Ve.themeURL,t.themeID,function(t){n&&n(t),i.Vs.Xs(e)},function(t){i.Lt.Qe.Ye({type:"info",InfoMode:t}),i.Vs.Xs(e)},t.contentVersion))},Nm:function(t){var n,e=this.Ft.Xi(t.je);e.buildingLoaded||(this.Ve.tile?this.qo(t)?((n=Gm(t,this)).buildings=null,n.isOutdoor=!1,this.Pm(n)):e.sceneLoaded||this.Ve.tile&&((n=Gm(t,this)).buildings=null,n.isOutdoor=!1,this.jm(n)):((e=Object.assign({},this.Ve)).isOutdoor=!1,e.buildingID=t.Ji,e.bid=t.je,e.buildings=null,this.Fm(e)))},Im:function(t,n){var e=null,t=this.Lt.getBuilding(t.bid),n={type:"info",InfoMode:n,buildingID:e=t?t.je:e};this.Lt.yi.error.push(n),this.Lt.Qe.Ye(n)},Cm:function(t,n){var e=null;t.buildingID!==t.mapID&&(e=t.bid),this.km({bid:t.bid,levels:n.levels}),this.Lt.Qe.Ye({type:"sceneLoaded",buildingID:e}),this.Lt.Qe.Ye({type:"info",InfoMode:Ri.INFO,mapID:n.mid,buildingID:e})},Fm:function(c){var f=this;this.Lt.dr.Pa(c,function(t,s){var n;if(!(0<f.Lt.yi.error.length))if("complete"===t)if(c.isOutdoor){var e=f.Dm(s);if(!(0<f.Lt.yi.error.length)){var i=f.Ft.Xi(e.je);if(i.buildingLoaded=!0,!(i.sceneLoaded=!0)!==f.Um(s,!0))for(var r=f.Ft.Tm(e.je),o=0;o<e.er.length;o++){var a=s.It.get(e.er[o]),u=(r.set(a.gid,!0),f.pa(e,a,e.er[o]));f.xm(u),f.Bm(e,a.gid)}}}else f.Lt.It.forEach(function(t){if(t.Ji===s.mid){t.er=s.levels,t.rr=new Ft(new xt(s.minX,s.minY),new xt(s.maxX,s.maxY));for(var n=f.Ft.Xi(t.je),e=(n.buildingLoaded=!0,n.sceneLoaded=!0,f.Ft.Tm(t.je)),i=0;i<s.levels.length;i++){var r=s.It.get(s.levels[i]),o=(e.set(r.gid,!0),f.pa(t,r,s.levels[i]));f.xm(o),f.Bm(t,r.gid)}}});else"decode"===t?(i=null,(n=f.Lt.getBuilding(c.bid))&&(i=n.je),f.km({bid:void 0!==c.bid?c.bid:c.buildingID,levels:s.scene.levels}),f.Lt.Qe.Ye({type:"sceneLoaded",buildingID:i}),f.Lt.Qe.Ye({type:"info",InfoMode:Ri.INFO,mapID:s.scene.mid,buildingID:i})):"error"===t&&f.Im(c,s)})},Um:function(t,n){if(t.buildings)for(var e=0;e<t.buildings.length;e++){var i=this.Gm(t.buildings[e]);if(0<this.Lt.yi.error.length&&n)return!1;this.Nm(i)}return t.buildings&&0!==t.buildings.length&&t.buildings.length!==this.Lt.It.length-1||(this.Lt.Bc=!0),!0},Hm:function(t,n){for(var e=0;e<t.er.length;e++){var i=n.It.get(t.er[e]);this.pa(t,i,t.er[e])}},Pm:function(o){var s=this;this.Lt.dr.Na(o,function(t,n){var e,i,r;0<s.Lt.yi.error.length||("building"===t&&(e=null,r=(i=s.Ft.Xi(o.bid)).sceneLoaded,i.buildingLoaded=!0,i.sceneLoaded=!0,o.buildingID===o.mapID?(e=s.Dm(n),s.Um(n,!1)):(e=s.Lt.getBuilding(o.bid),r||(e.er=n.levels,e.rr=new Ft(new xt(n.minX,n.minY),new xt(n.maxX,n.maxY)))),r||s.Hm(e,n)),"scene"===t&&s.Cm(o,n),"floor"===t&&(i=s.Lt.getBuilding(o.bid),s.Ft.Tm(i.je).set(n.gid,!0),(r=i.getFloor(n.gid)).G=n,s.xm(r),s.Bm(i,n.gid)),"error"===t&&s.Im(o,n))})},jm:function(r){var o=this,e=null;this.Lt.dr.Qs(r,function(t,n){"building"===t?((e=o.Lt.getBuilding(r.bid)).er=n.levels,e.rr=new Ft(new xt(n.minX,n.minY),new xt(n.maxX,n.maxY)),o.Ft.Xi(e.je).sceneLoaded=!0,o.Hm(e,n),o.Bm(e,void 0)):"scene"===t&&o.Cm(r,n)},function(t,n){var e=null,i=o.Lt.getBuilding(r.bid);i&&(e=i.je),o.Lt.Qe.Ye({type:"info",InfoMode:n,buildingID:e})})},Vf:function(t){this.Nm(t)},Bm:function(t,n){var e=this.Ft.Xi(t.je),i=e.loaded,r=e.visibleLevelsLoaded;this.Xm(t),!r&&e.visibleLevelsLoaded&&(this.Ft.Lm&&this.Ft.Hc?(this.Jt(null,n,!0,!0,!1,this.Ft.Hc),this.Ft.Lm=!1):this.Jt(null,n,!1,!0,!1,this.Ft.Hc),r={type:"visibleLevelsLoaded"},t!==this.Lt.kt&&(r.buildingID=t.je),this.Lt.Qe.Ye(r)),!i&&e.loaded&&(t!==this.Lt.kt?this.Lt.Qe.Ye({type:"buildingLoaded",buildingID:t.je}):this.Lt.Qe.Ye({type:"mapLoaded"})),this.Ft.Rm&&this.Ft.Hc&&this.Jt(null,n,!1,!1,!0,this.Ft.Hc)},Xc:function(){for(var t=!0,n=0;n<this.Lt.It.length;n++){var e=this.Lt.It[n];if(e.constructor===Bm){if(this.qo(e)&&!this.Ft.Xc(e.je)){t=!1;break}}else if(!this.Ft.Xc(e.je)){t=!1;break}}return t}}),Z_=F_,Object.assign(Z_.prototype,{zm:function(t){var t=this.map.getBuilding(t);return null===t?-1:(t=t.bounds,Math.sqrt((t.maxX-t.minX)*(t.maxX-t.minX)+(t.maxY-t.minY)*(t.maxY-t.minY)))},im:function(t){var t=this.Lt.getBuilding(t.bid),n=!0;this.qo(t)&&(this.Vf(t),n=!1),t.Bf&&(t.Bf.show=n),this.zi(),this.Lt.enableUpdateNode()},Vm:function(t){var n,e=this;return!(this.qo(t)||(t=t.getFloor(t.level))&&null!=(t=t.getLayers(S.EXTENT_LAYER)[0])&&(n=!1,t&&t.traverse(function(t){n=!uy.isContain(t.coordinates[0],e.Lt.Wm())}),!n))},qo:function(t){return!1!==t.visible&&(t.overviewMode===lm.INDOOR||(t.overviewMode!==lm.OUTDOOR||this.Ft.jt===t.buildingID)&&(this.Ft.jt!==this.Lt.Ve.buildingID?this.Ft.jt===t.je:t===this.Lt.kt||!!this.Lt.Ym(t)&&!!this.Lt.Qm()))},Dm:function(t){var n=new $m({bid:this.Ve.buildingID,mid:this.Ve.mapID,height:t.height,scaleLevel:t.scaleLevel,name:t.mname,levels:t.levels,x:t.x,y:t.y,bounds:new Ft(new xt(t.minX,t.minY),new xt(t.maxX,t.maxY))});return this.Lt.Ti(n),this.Lt.kt=n,this.Lt._t=t.x,this.Lt.Et=t.y,n},Gm:function(t){var n=this.Ft.Xi(t.bid);if(!n.visibleLevels||0===n.visibleLevels.length){for(var e=[],i=0;i<t.levelChart.length;i+=2)for(var r=0;r<this.Lt.kt.visibleLevels.length;r++)t.levelChart[i]===this.Lt.kt.visibleLevels[r]&&e.push(t.levelChart[i+1]);n.visibleLevels=e}if(void 0===n.level)for(var o=0;o<t.levelChart.length;o+=2)t.levelChart[o]===this.Lt.kt.level&&(n.level=t.levelChart[o+1]);var s=new Map;if(t.floors)for(var a=0;a<t.floors.length;a++){var u=t.floors[a].Ie,c=t.floors[a].gid;s.set(c,u)}var f=new Bm(t);return n.minLevel&&(f.Cf=n.minLevel),n.maxLevel&&(f.kf=n.maxLevel),f.Pf=n.overviewMode,f.Zm=s,this.Lt.Ti(f),f},Om:function(t){for(var n=null,e=this.Lt.getBuildings(),i=0;i<e.length;i++)if(""+e[i].bcode==""+t){n=e[i].buildingID;break}return n}}),Object.assign(Z_.prototype,{qm:function(){var n=this;this.Lt.traverse(function(t){t.traverse(function(t){t=t.getLayers(S.LABEL_LAYER)[0];t&&t.traverse(function(t){n.Ft.vv===Hm.FID?t.text=t.G.fid:n.Ft.vv===Hm.ENAME?t.text=t.G.ename:t.text=t.G.name})})})},Jf:function(t){var n=0,n=this.Lt.ze.isPerspectiveCamera?t/(this.Lt.Dt.renderer.domElement.clientHeight/(2*Math.tan(this.Lt.ze.fov*f.DEG2RAD/2))):t*Math.abs(this.Lt.ze.top-this.Lt.ze.bottom)/this.Lt.ze.zoom/this.Lt.Dt.renderer.domElement.clientHeight;return n=isNaN(n)?1:n},Km:function(t,n){var e;return this.Lt.ze.isPerspectiveCamera?(e=new At,t.updateMatrixWorld(),this.Lt.Ke.updateMatrixWorld(),e.multiplyMatrices(this.Lt.Ke.matrixWorldInverse,t.matrixWorld),t=(new xt).applyMatrix4(e),this.Jf(n)*Math.abs(t.z)):this.Jf(n)}}),Object.assign(Z_.prototype,{pm:function(t){var n=this;null!==this.qp&&(clearTimeout(this.qp),this.qp=null),this.qp=setTimeout(function(){n.vm({changeScopeTypes:t.changeScopeTypes,fids:t.fids})},t.time||0)},vm:function(){function e(){if(o.length<=0)i.Lt.off("update",e);else{for(var t=0,n=0;n<o.length&&!(20<++t);n++)o[n].Uh(i,i.Dh),o.splice(n,1),n--;i.Lt.enableUpdateRender()}}var i=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.changeScopeTypes,r=t.fids,n=n||[S.EXTENT,S.MODEL,S.LABEL,S.FACILITY,S.EXTERNAL_MODEL],r=r||[],o=[];this.Lt.off("update",e),this.Lt.traverse(function(t){t.traverse(function(t){t.parent.visibleLevels.includes(t.level)&&t.traverse(function(t){t.traverse(function(t){(!(0<r.length)||r.includes(t.FID))&&n.includes(t.type)&&t.visible&&t.Uh&&t.xi&&o.push(t)})})})}),this.Lt.on("update",e)},Nh:function(t,n){t.xi&&((!t.Bf||t.Bf.visible)&&t.Qi?t.xi.visible=t.G.maxlevel&&n>=t.G.minlevel&&n<t.G.maxlevel:t.xi.visible=!1)},Jm:function(){var a,i=this;return a=fy().mark(function t(){var n,e;return fy().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i.Rc.set(i.Ve.buildingID,{theme:new bd}),(n=i.Ft.Xi(i.Ve.buildingID)).themeNeedLoad=!0,n.themeLoaded=!1,t.next=6,i.Gc({bid:i.Ve.buildingID,themeID:i.Ve.themeID,theme:i.Ve.jh,themeExtension:i.Ve.themeExtension});case 6:i.Ve.tile?((e=Object.assign({},i.Ve,{level:n.level,visibleLevels:n.visibleLevels})).bid=e.buildingID,i.Pm(e)):i.Fm(i.Ve);case 7:case"end":return t.stop()}},t)}),function(){var t=this,s=arguments;return new Promise(function(n,e){var i=a.apply(t,s);function r(t){hy(i,n,e,r,o,"next",t)}function o(t){hy(i,n,e,r,o,"throw",t)}r(void 0)})}()},ko:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=1<arguments.length?arguments[1]:void 0;if(this.Ft.tm&&this.$p&&(st.a.environment!==G.a.WX||1!=this.Lt.Dt.Ze||this.Lt.Dt.uo%2==0)){this.Do=[];for(var e=n||this.Lt.getZoom(),i=this.Ve.tile&&!this.Ve.preLoad,r=0;r<this.Lt.It.length;r++)for(var o=this.Lt.It[r],s=this.Vm(o),a=0;a<o.It.length;a++){for(var u=o.It[a],c=null,f=-1<o.visibleLevels.indexOf(u.level),h=(f&&!s&&(c=this.fm(o,u.level),0===this._m(u))&&this.Em(u)&&(u.zp(),this.Sm(u),this.zi()),[]),l=0;l<u.It.length;l++){var d=u.It[l];if(!f||s&&i)this.$m(d)&&i&&h.push(d);else for(var v=0;v<d.It.length;v++){var p=d.It[v],m=!0;s||!p.visible||p.Bf&&!p.Bf.visible?m=!1:p.G&&p.G.maxlevel&&(e>=p.G.maxlevel||e<p.G.minlevel)?(m=!1)===p.canDispose&&(m=!0):this.um(p,c)||!0===t||(m=!1),!p.xi&&m&&this.Do.push([r,p]),p.initTargetShow=m,!p.xi||m||p.fading||p.Vo||p.Rh&&p.Rh(),p.Vo&&p.Qo(1)}}for(var y=0;y<h.length;y++)u.remove(h[y]),h[y].dispose()}this.Ft.tm=!1,this.Lt.enableUpdateRender()}},$m:function(t){var n=S.EXTENT_LAYER|S.FACILITY_LAYER|S.LABEL_LAYER|S.MODEL_LAYER|S.EXTERNAL_MODEL_LAYER;return 0!=(t.Fe&n)},Uo:function(){if(0<this.Do.length){for(var t=!1,n=0,e=0;e<this.Do.length&&!(20<++n);e++){var i=this.Do[e][1];i.Fe!==S.FACILITY&&i.Fe!==S.LABEL||(t=!0),i.wc(),this.Do.splice(e,1),e--}t&&this.$o(),this.Tf(),this.Lt.enableUpdateRender(),this.Ft.ts&&0===this.Do.length&&!this.Zp&&(this.Lt.Qe.Ye({type:"firstViewLoaded"}),this.Zp=!0)}!this.Zp&&this.ts&&0===this.Do.length&&(this.Lt.Qe.Ye({type:"firstViewLoaded"}),this.Zp=!0)},Sp:function(t,n){var e=this.Lt.getMapOptions().hideList,i=n.typeID,n=n.FID,e=e[t];return void 0===e||(t=e.typeIDs,void 0===(e=e.FIDs)&&(e=[]),!(t=void 0===t?[]:t).includes(i)&&!e.includes(n))},Sm:function(t){var i=this;t.Ht.je===this.Ve.buildingID&&t.traverse(function(t){t.type!==S.MODEL_LAYER&&t.type!==S.EXTERNAL_MODEL_LAYER&&t.type!==S.LABEL_LAYER||t.traverse(function(e){i.Lt.traverse(function(t){if(t!==i.Lt.kt)for(var n=0;n<t.Uf.length;n++)t.Uf[n]===e.FID&&(t.Bf.setFacadeNode(e),e.Bf=t.Bf)})})})}}),Object.assign(F_.prototype,{wp:function(t){t=this.Lt.getMapOptions().hideList[t];return void 0===t||0!==Object.keys(t).length},km:function(n){var t=this.Ft.Xi(n.bid),e=[];t.visibleLevels.forEach(function(t){-1<n.levels.indexOf(t)&&e.push(t)}),t.visibleLevels=e},ty:function(t,n){function e(){i.Lt.Dt.zi(),n.finish&&n.finish()}var i=this,r=(n=n||{},this.Ft.Xi(t.je));"animate"in n&&!n.animate?(t.traverse(function(t){t.sr({animate:!1})}),e()):t.traverse(function(t){t.ar===r.level?t.sr({finish:function(){e()}}):t.sr({})})},ci:function(t,n){t=this.Lt.getBuilding(t);return t?t.getFloor(n):null},ny:function(t){t=this.Lt.getBuilding(t);return null!==t?t.It:[]},hr:function(n,e){var i=this;n.levels.sort(),this.Ft.Xi(n.building.je).visibleLevels=n.levels,this.km({bid:n.building.je,levels:n.building.er}),this.wm(n,function(){i.zi(),i.Lt.Dt.Ei();var t={type:"visibleLevelsLoaded"};n.building!==i.Lt.kt&&(t.buildingID=n.building.je),i.Lt.Qe.Ye(t),e&&e()})},cr:function(n,e){var i=this,r=(this.Lt.rm(),this.Ft.Xi(n.je));r.targetLevel=e.level,-1<r.visibleLevels.indexOf(e.level)?this.Lt.Nt.Hi(n,e):(r.visibleLevels.length<=1?r.visibleLevels=[e.level]:r.visibleLevels.push(e.level),n.setVisibleLevels(r.visibleLevels,function(){var t;r.targetLevel===e.level?i.Lt.Nt.Hi(n,e):(t={type:"levelChanged",level:e.level},n!==i.Lt.kt&&(t.buildingID=n.je),i.Lt.Qe.Ye(t),e.finish&&e.finish())}))},Em:function(t){var n=!1;return t.G.It.forEach(function(t){0<t.It.size&&(n=!0)}),n},_m:function(t){var n=this,e=0;return t.traverse(function(t){n.$m(t)&&e++}),e},Xm:function(t){var n=this.Ft.Xi(t.je),e=this.Ft.Tm(t.je);if(!n.visibleLevelsLoaded){for(var i=!0,r=t.visibleLevels,o=0;o<r.length;o++)e.get(r[o])||(i=!1);n.visibleLevelsLoaded=i}this.Ve.tile&&!this.Ve.preLoad?n.loaded=n.visibleLevelsLoaded:e.size===t.er.length&&(n.loaded=!0),this.ey()},ey:function(){var e,i,r=this,o=!0;this.Lt.traverse(function(t){var n=r.Ft.Xi(t.je);n.visibleLevelsLoaded||(t.constructor===Bm?r.qo(t)&&!n.visibleLevelsLoaded&&(o=!1):n.visibleLevelsLoaded||(o=!1))}),!this.Ft.ns&&o&&(this.Ft.Lm=!0),this.Ft.ns=o,this.Ft.ts||(i=e=!0,this.Lt.traverse(function(t){var n=r.Ft.Xi(t.je);n.sceneLoaded||(e=!1),(!r.qo(t)||n.loaded)&&e||(i=!1)}),!this.Ft.ts&&i&&(this.Ft.Rm=!0),this.Ft.ts=i)},Vi:function(){this.Ft.iy=!0},sm:function(){var i=this;this.Ft.iy&&(this.Yp=[],this.Lt.traverse(function(e){for(var t=0;t<e.It.length;t++)!function(n){var t=e.It[n];t.Cp(),t.Fp&&t.traverse(function(t){t.traverse(function(t){t.type!==S.EXTENT&&t.type!==S.FACILITY&&t.type!==S.LABEL&&t.type!==S.MODEL&&t.type!==S.EXTERNAL_MODEL&&t.type!==S.TEXT_MARKER&&t.type!==S.DOM_MARKER&&t.type!==S.EXTRUDE_MARKER&&t.type!==S.IMAGE_MARKER&&t.type!==S.POLYGON_MARKER&&t.type!==S.DYNAMIC_MODEL_MARKER||t.xi&&i.Yp.push([n,t])})}),t.Fp=!1}(t)}),this.Ft.iy=!1)},am:function(){if(0<this.Yp.length){for(var t=0,n=0;n<this.Yp.length&&!(++t>this.Ve.maxMaterialCount);n++){var e=this.Yp[n][1];e.update?e.update():e.Bh(),this.Yp.splice(n,1),n--}this.Lt.enableUpdateRender()}},pa:function(t,n,e){n=new v({mapOptions:this.Ve,states:this.Ft,data:n,key:e});return t.Ti(n),n.Cp(),n.Dp(),n},xm:function(t){t.zp(),t.Xp(),this.Sm(t)},oy:function(t,n){for(var e=!0,i=0;i<t.length;i++)if(t[i]===n){e=!1;break}return e},sy:function(t,n,e){var i=[];i.push(t);for(var r=0;r<n.length;r++)n[r]!==t&&i.push(n[r]);if(e)for(var o=0;o<e.length;o++)this.oy(i,e[o])&&i.push(e[o]);return i}}),F_);function eE(t){return(eE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function iE(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=eE(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=eE(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==eE(t)?t:String(t)}(i.key),i)}}function rE(t,n,e){return n&&iE(t.prototype,n),e&&iE(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var i2=rE(function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.It=new Map,this.uy=[],this.ln=(new Date).getTime(),this.hy=new Map,this.Fa=null,this.Mo=this.Mo.bind(this),this.Oo=0,this.Eo()}),oE=(Object.assign(i2.prototype,{Ti:function(t){if(Array.isArray(t)){this.It.set(t[0].$t,t[0]),t[0].Ht=this;for(var n=1;n<t.length;n++)t[n].zt=t[n-1].zt+t[n-1].Yt,t[n].Vt=t[n-1].Vt+t[n-1].Yt,this.It.set(t[n].$t,t[n]),t[n].Ht=this}else this.It.has(t.$t)||(this.It.set(t.$t,t),t.Ht=this,t.zt=this.ln)},ji:function(t){if(Array.isArray(t))for(var n=0;n<t.length;n++)this.It.delete(t[n].$t);else this.It.delete(t.$t)},Yd:function(t){this.uy.push(t)},Jd:function(t){t=this.uy.indexOf(t);-1<t&&this.uy.splice(t,1)},Ri:function(t){this.hy.set(t.$t=Xi.generateUUID(),t)},Mi:function(t){this.hy.delete(t.$t)},Kt:function(t,n,e){for(var i=[],r=[],o=0;o<t.Bt.length;o++)void 0===t.Xt[o]&&(t.Xt[o]=0),1<=n?(i.push(t.Gt[o]),r.push(t.Gt[o]-t.Bt[o]-t.Xt[o])):(i.push((t.Gt[o]-t.Bt[o])*n+t.Bt[o]),r.push((t.Gt[o]-t.Bt[o])*e),t.Xt[o]+=(t.Gt[o]-t.Bt[o])*e);t.Kt({destination:i,delta:r}),r.length=i.length=0},Eo:function(){var i=this,r=(this.Oo=st.a.window.requestAnimationFrame(this.Eo.bind(this)),(new Date).getTime()),o=r-this.ln;this.hy.forEach(function(t){return t(o)});for(var t=0;t<this.uy.length;t++)this.uy[t].update(o/1e3);this.It.forEach(function(t){var n,e;t.qt||(t.Zt?t.Wt+=o:(n=(r-t.zt)/t.Yt,e=o/t.Yt,i.Kt(t,n,e),n=r-t.zt-t.Vt,t.Yt<=n&&(t.Xt=[],t.Qt?(t.zt=r,t.Jt&&t.Jt()):(e=t.qt,t.qt=!0,!e&&t.Jt&&t.Jt()))))}),this.ln=r},nn:function(t){this.Fa=t,this.Mo()},Mo:function(){this.Oo&&(st.a.window.cancelAnimationFrame(this.Oo),this.Oo=0),this.It.forEach(function(t){t.nn()}),this.It.clear(),this.uy=[],this.hy.clear(),this.Fa&&this.Fa({name:"Animator"})}}),i2);function sE(t){return(sE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function aE(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=sE(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=sE(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==sE(t)?t:String(t)}(i.key),i)}}function uE(t,n,e){return n&&aE(t.prototype,n),e&&aE(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var f2=uE(function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.wt={}}),cE=(Object.assign(f2.prototype,{ly:function(t,n){this.vy(t,n)||(void 0===this.wt[t]&&(this.wt[t]=[]),this.wt[t].push(n))},vy:function(t,n){return n?void 0!==this.wt[t]&&-1!==this.wt[t].indexOf(n):void 0!==this.wt[t]&&0<this.wt[t].length},py:function(t,n){void 0!==this.wt[t]&&-1!==(n=this.wt[t].indexOf(n))&&this.wt[t].splice(n,1)},Ye:function(t){if(void 0!==this.wt[t.type])for(var n=this.wt[t.type].slice(0),e=0,i=n.length;e<i;e++)n[e].call(this,t)}}),f2),n={Entire:2,Individual:4},fE=(Object.freeze(n),n),hE={RUNTIME:0,DIRTY:1};function lE(t){return(lE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dE(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=lE(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=lE(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==lE(t)?t:String(t)}(i.key),i)}}function vE(t,n,e){return n&&dE(t.prototype,n),e&&dE(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var pE=vE(function t(n){var e;if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");if(this.container=n.container,this.appName=n.appName,this.key=n.key,this.license=n.license,this.mapID=n.mapID,this.buildingID=n.mapID,this.mapURL=n.mapURL,this.mapURLAbsolute=void 0!==n.mapURLAbsolute&&n.mapURLAbsolute,this.themeTool=void 0!==n.themeTool?n.themeTool:null,this.merge=void 0!==n.merge?n.merge:null,this.userThemeURL=n.themeURL,this.themeURL=n.themeURL||Cf.themeUrl,this.themeID=n.themeID||"2001",this.externalModelURL=n.externalModelURL,this.jh=n.theme,this.themeExtension=void 0!==n.themeExtension?n.themeExtension:{},this.isPreview=void 0!==st.a.KjWzhWlSj&&!!st.a.KjWzhWlSj.ProtoDef,this.nonFocusAlpha=void 0!==n.nonFocusAlpha?n.nonFocusAlpha:.1,this.nonFocusAlphaMode=void 0!==n.nonFocusAlphaMode&&n.nonFocusAlphaMode,this.state=n.state||{},this.center=(void 0!==this.state.center?this.state:n).center,this.zoomRange=void 0!==this.state.zoomRange?this.state.zoomRange:void 0!==n.zoomRange?n.zoomRange:[16,23],this.mapZoom=void 0!==this.state.zoom?this.state.zoom:void 0!==n.mapZoom?n.mapZoom:20,this.rotation=void 0!==this.state.rotation?this.state.rotation:void 0!==n.rotation?n.rotation:0,this.maxTiltAngle=void 0!==n.maxTiltAngle?n.maxTiltAngle:90,this.minTiltAngle=void 0!==n.minTiltAngle?n.minTiltAngle:30,this.tiltAngle=void 0!==this.state.tiltAngle?this.state.tiltAngle:void 0!==n.tiltAngle?n.tiltAngle:30,this.viewMode=void 0!==this.state.viewMode?this.state.viewMode:void 0!==n.viewMode?n.viewMode:Li.MODE_3D,this.floorSpace=void 0!==this.state.floorSpace?this.state.floorSpace:void 0!==n.floorSpace?n.floorSpace:50,this.level=void 0!==this.state.level?this.state.level:void 0!==n.level?n.level:1,this.visibleLevels=void 0!==this.state.visibleLevels?this.state.visibleLevels:void 0!==n.visibleLevels?n.visibleLevels:[1],this.buildingOptions=n.buildingOptions||{},this.navigationData=n.navigationData,this.buildings=n.buildings,this.backgroundColor=n.backgroundColor,this.backgroundAlpha=n.backgroundAlpha,this.bc=n.highlightColor,this.Ar=void 0!==n.highlightPicker?n.highlightPicker:["click"],this.logarithmicDepthBuffer=n.logarithmicDepthBuffer||!1,this.tile=!1!==n.tile||n.tile,this.preLoad=!1!==n.preLoad||n.preLoad,this.loadLayerWaitingTime=n.loadLayerWaitingTime||.002,this.renderOrder=n.renderOrder||[S.EXTENT,S.CAD_LAYER,S.EXTERNAL_MODEL,S.MODEL,S.DYNAMIC_MODEL_MARKER,S.EXTRUDE_MARKER,S.TUBE_MARKER,S.WALL_MARKER,S.SPHERE_MARKER,S.POLYGON_MARKER,S.HEAT_MAP_MARKER,S.LINE3D_MARKER,S.LINE_MARKER,S.FACILITY,S.LABEL,S.IMAGE_MARKER,S.TEXT_MARKER,S.LOCATION_MARKER],this.collisionOrder=n.collisionOrder?Fi.uniqWithArrayTwo(n.collisionOrder):[[S.TEXT_MARKER,S.IMAGE_MARKER]],this.fontFamily=n.fontFamily||'"Microsoft Yahei","",Tahoma,Arial',this.hdr=n.hdr,this.shadingMode=void 0!==n.shadingMode?n.shadingMode:No.REAL,this.materialMode=this.shadingMode,this.maxMaterialCount=void 0!==n.maxMaterialCount?n.maxMaterialCount:1/0,this.lock=void 0!==n.lock&&n.lock,this.labelField=void 0!==n.labelField?n.labelField:Hm.NAME,this.enabledPanRange=void 0!==n.enabledPanRange&&n.enabledPanRange,this.panRangeValue=void 0!==n.panRangeValue?n.panRangeValue:null,this.screenLockCoords=n.screenLockCoords,this.lightConfig={FMExtentLayer:[{name:"DirectionalLight",color:11579568,intensity:.95,position:{x:58,y:65,z:40},id:0},{name:"AmbientLight",color:11579568,intensity:.85,id:1},{name:"DirectionalLight",color:6447714,intensity:.65,position:{x:-100,y:0,z:45},id:2}],FMDynamicModelLayer:[{name:"DirectionalLight",color:11579568,intensity:.95,position:{x:58,y:65,z:45},id:0},{name:"AmbientLight",color:11579568,intensity:.85,id:1},{name:"DirectionalLight",color:6447714,position:{x:-100,y:0,z:45},intensity:.45,id:2}],FMModelLayer:[{name:"DirectionalLight",color:11645361,intensity:.95,position:{x:58,y:65,z:40},id:0},{name:"AmbientLight",color:11645361,intensity:.85,id:1},{name:"DirectionalLight",color:6513507,position:{x:-100,y:0,z:45},intensity:.65,id:2}],FMExternalModelLayer:[{name:"DirectionalLight",color:11579568,intensity:.95,position:{x:58,y:65,z:45},id:0},{name:"AmbientLight",color:11579568,intensity:.85,id:1},{name:"DirectionalLight",color:6447714,position:{x:-100,y:0,z:45},intensity:.45,id:2}]},this.isuserLight=!1,void 0!==n.light&&(this.lightConfig=n.light.getConfig(),this.isuserLight=!0),this.lockedLight=void 0!==n.lockedLight&&n.lockedLight,this.hideList=void 0!==n.hideList?n.hideList:{},this.ClassicMaterial=void 0===n.ClassicMaterial||n.ClassicMaterial,this.isOutdoor=!0,this.enableDamping=void 0!==n.enableDamping&&n.enableDamping,this.enterTriggerMode=void 0!==n.enterTriggerMode?n.enterTriggerMode:fE.Entire,this.autoPlay=void 0===n.autoPlay||n.autoPlay,this.decoderURL=void 0!==n.decoderURL?n.decoderURL:null,this.HDText=void 0!==n.HDText&&n.HDText,this.depthPeeling=void 0!==n.depthPeeling?n.depthPeeling:null,this.depthPeeling&&(this.depthPeeling.mode=(null==(e=n.depthPeeling)?void 0:e.mode)||hE.RUNTIME,this.depthPeeling.layers=(null==(e=n.depthPeeling)?void 0:e.layers)||4,this.depthPeeling.types=(null==(e=n.depthPeeling)?void 0:e.types)||[S.MODEL_LAYER,S.EXTERNAL_MODEL_LAYER,S.DYNAMIC_MODEL_MARKER]),this.mouseMode=void 0!==n.mouseMode?n.mouseMode:vo.NORMAL,this.labelFade=void 0!==n.labelFade?n.labelFade:st.a.environment===G.a.BROWSER,this.preserveDrawingBuffer=!1,void 0!==n.preserveDrawingBuffer&&(this.preserveDrawingBuffer=n.preserveDrawingBuffer),this.webWorker=void 0!==n.webWorker?n.webWorker:{useWebWorker:!1},this.webWorker.useWebWorker)try{var i=new Error,r=i.stack||i.sourceURL||i.stacktrace||"",o=r.match(/(https?:\/\/[^\s]+\/)/);if(!o&&!(o=r.match(/(file?:\/\/[^\s]+\/)/)))return void console.error("worker path failed.");this.webWorker.baseURL=o[0]+"workers/"}catch(i){}st.a.environment===G.a.WX&&(this.webWorker.useWebWorker=!1)});function mE(t){return(mE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yE(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=mE(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=mE(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==mE(t)?t:String(t)}(i.key),i)}}function bE(t){a.call(this),this.element=t,this.element.style.position="absolute",this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)})})}function gE(){function a(t,n,e){var i,r;t instanceof bE&&(t.onBeforeRender(f,n,e),h.setFromMatrixPosition(t.matrixWorld),h.applyMatrix4(l),i=t.element,r="translate(-50%,-50%) translate("+(h.x*u+u)+"px,"+(-h.y*c+c)+"px)",i.style.WebkitTransform=r,i.style.MozTransform=r,i.style.oTransform=r,i.style.transform=r,i.style.display=t.visible&&-1<=h.z&&h.z<=1?"":"none",r={distanceToCameraSquared:p(e,t)},d.objects.set(t,r),i.parentNode!==v&&v.appendChild(i),t.onAfterRender(f,n,e));for(var o=0,s=t.children.length;o<s;o++)a(t.children[o],n,e)}var e,i,u,c,r,o,f=this,h=new xt,s=new At,l=new At,d={objects:new WeakMap},v=document.createElement("div"),p=(v.style.overflow="hidden",this.domElement=v,this.getSize=function(){return{width:e,height:i}},this.setSize=function(t,n){u=(e=t)/2,c=(i=n)/2,v.style.width=t+"px",v.style.height=n+"px"},r=new xt,o=new xt,function(t,n){return r.setFromMatrixPosition(t.matrixWorld),o.setFromMatrixPosition(n.matrixWorld),r.distanceToSquared(o)});this.render=function(t,n){!0===t.autoUpdate&&t.updateMatrixWorld(),null===n.parent&&n.updateMatrixWorld(),s.copy(n.matrixWorldInverse),l.multiplyMatrices(n.projectionMatrix,s),a(t,t,n)}}var Bv=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.Ve=t,this.zoomRange=this.Ve.zoomRange,this.zoom=this.Ve.mapZoom,this.mi=this.Ve.rotation,this.my=this.Ve.maxTiltAngle,this.yy=this.Ve.minTiltAngle,this.tiltAngle=this.Ve.tiltAngle,this.He=this.Ve.viewMode,this.by=new Map,this.gy(),this.Hc=!1,this.ns=!1,this.ts=!1,this.Rm=!1,this.Lm=!1,this.vv=this.Ve.labelField,this.Re=new xt,this.wy=this.qf,this._r=!1,this._y=!0,this.Ey=!1,this.bc=void 0!==this.Ve.bc?this.Ve.bc:null,this.Sy=null,this.Ty=void 0!==this.Ve.backgroundColor?this.Ve.backgroundColor:null,this.xy=null,this.Ay=void 0!==this.Ve.backgroundAlpha?this.Ve.backgroundAlpha:null,this.My=null,this.Oy=null,this.gm=!1,this.rs=!1,this.tm=!1,this.iy=!0,this.Ko=this.Ve.collisionOrder,this.jt=this.Ve.buildingID,this.Jo=this.Ve.webWorker.useWebWorker}var t,e,i;return t=n,(e=[{key:"zoom",get:function(){return this.qf},set:function(t){this.qf=Math.min(Math.max(t,this.Pi[0]),this.Pi[1])}},{key:"zoomRange",get:function(){return this.Pi},set:function(t){t[0]=Math.min(Math.max(t[0],1),29),t[1]=Math.min(Math.max(t[1],1),29),this.Pi=t}},{key:"tiltAngle",get:function(){return this.di},set:function(t){t=Math.min(Math.max(t,this.yy),this.my),this.di=t}},{key:"highlightColor",get:function(){return null!==this.bc?this.bc:this.Sy},set:function(t){this.bc=t}},{key:"backgroundColor",get:function(){return null!==this.Ty?this.Ty:this.xy}},{key:"backgroundAlpha",get:function(){return null!==this.Ay?this.Ay:this.My}}])&&yE(t.prototype,e),i&&yE(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}(),wE=(Object.assign(Bv.prototype,{gy:function(){this.Ly(this.Ve.buildingID);var t=this.Ve.buildingOptions.buildings;if(t)for(var n=0;n<t.length;n++)t[n].buildingID&&this.Ly(t[n].buildingID)},Av:function(t){this.Sy=t.Dc(this.Ve.buildingID);t=t.Nc(this.Ve.buildingID);this.xy=t.clearColor,this.My=t.clearAlpha,this.Oy=t.alphaTest,null!==this.Oy&&(Is.alphaTest=this.Oy)},Ry:function(t,n){switch(t){case"click":this._y=n;break;case"move":this.Ey=n;break;case"hover":this._r=n}},Ny:function(t){this.Ve.center&&(this.Re.x=this.Ve.center.x-t.x,this.Re.z=-this.Ve.center.y+t.y)},Xi:function(t){return this.by.has(t)||this.Ly(t),this.by.get(t)},Ly:function(t){var n={};if(this.Ve.buildingID===t)n={themeID:this.Ve.themeID,visibleLevels:this.Ve.visibleLevels,level:this.Ve.level,targetLevel:this.Ve.level,floorSpace:this.Ve.floorSpace,nonFocusAlphaMode:this.Ve.nonFocusAlphaMode,nonFocusAlpha:this.Ve.nonFocusAlpha};else{var e=this.Ve.buildingOptions,i=e.buildings,n={themeID:e.themeID,themeExtension:e.themeExtension,visibleLevels:void 0!==e.visibleLevels?e.visibleLevels:[],level:e.level,targetLevel:e.level,floorSpace:(void 0!==e.floorSpace?e:this.Ve).floorSpace,overviewMode:void 0!==e.overviewMode?e.overviewMode:lm.NORMAL,nonFocusAlphaMode:(void 0!==e.nonFocusAlphaMode?e:this.Ve).nonFocusAlphaMode,nonFocusAlpha:(void 0!==e.nonFocusAlpha?e:this.Ve).nonFocusAlpha,minLevel:e.minLevel,maxLevel:e.maxLevel,themeLoaded:!1,themeNeedLoad:!0};if(i)for(var r=0;r<i.length;r++)i[r].buildingID===t&&(void 0!==i[r].themeID&&(n.themeID=i[r].themeID),void 0!==i[r].themeExtension&&(n.themeExtension=i[r].themeExtension),void 0!==i[r].visibleLevels&&(n.visibleLevels=i[r].visibleLevels),void 0!==i[r].level&&(n.level=i[r].level),void 0!==i[r].targetLevel&&(n.targetLevel=i[r].targetLevel),void 0!==i[r].floorSpace&&(n.floorSpace=i[r].floorSpace),void 0!==i[r].overviewMode&&(n.overviewMode=i[r].overviewMode),void 0!==i[r].nonFocusAlphaMode&&(n.nonFocusAlphaMode=i[r].nonFocusAlphaMode),void 0!==i[r].nonFocusAlpha&&(n.nonFocusAlpha=i[r].nonFocusAlpha),void 0!==i[r].minLevel&&(n.minLevel=i[r].minLevel),void 0!==i[r].maxLevel)&&(n.maxLevel=i[r].maxLevel)}n.level&&-1===n.visibleLevels.indexOf(n.level)&&(1<n.visibleLevels.length?n.visibleLevels.push(n.level):n.visibleLevels=[n.level]),this.by.set(t,n)},Tm:function(t){t=this.Xi(t);return t.levelsLoaded||(t.levelsLoaded=new Map),t.levelsLoaded},Xc:function(t){t=this.by.get(t);return!1===t.themeNeedLoad||!1!==t.themeLoaded}}),Bv);(bE.prototype=Object.create(a.prototype)).constructor=bE;function _E(t){return(_E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function EE(t,n){var e,i,r,o,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return i=!(e=!0),{s:function(){s=s.call(t)},n:function(){var t=s.next();return e=t.done,t},e:function(t){i=!0,r=t},f:function(){try{e||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(t)||(s=function(t,n){var e;if(t)return"string"==typeof t?SE(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?SE(t,n):void 0}(t))||n&&t&&"number"==typeof t.length)return s&&(t=s),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function SE(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function TE(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=_E(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=_E(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==_E(t)?t:String(t)}(i.key),i)}}var Dv=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.Ht=t,this.gt=null,this.Py=this.Py.bind(this),this.jy=this.jy.bind(this),this.xo=new qo,this.It=[]}var t,e,i;return t=n,(e=[{key:"add",value:function(t){t.Ht=this,(t.th||t.wc())&&this.R(t),this.needUpdateBound=!0}},{key:"remove",value:function(t){t=this.It.indexOf(t);-1<t&&this.It.splice(t,1),this.needUpdateBound=!0}},{key:"clear",value:function(){var t,n=EE(this.It);try{for(n.s();!(t=n.n()).done;)t.value.dispose()}catch(t){n.e(t)}finally{n.f()}this.It.length=0}},{key:"dispose",value:function(){if(null!==this.gt){this.Ht.off("resize",this.Py),this.Ht.off("beforeRender",this.jy);for(var t=0;t<this.It.length;t++)this.It[t].dispose();this.It.length=0,this.xo=void 0,this.gt.domElement.parentNode&&this.gt.domElement.parentNode.removeChild(this.gt.domElement)}}}])&&TE(t.prototype,e),i&&TE(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}(),xE=(Object.assign(Dv.prototype,{wc:function(){this.gt=new gE,this.gt.setSize(this.Ht.getContainer().clientWidth,this.Ht.getContainer().clientHeight),this.gt.domElement.style.top="0px",this.gt.domElement.style.left="0px",this.gt.domElement.style.position="absolute",this.gt.domElement.style.pointerEvents="none",this.gt.domElement.style.zIndex=2,this.Ht.getContainer().appendChild(this.gt.domElement),this.Ht.on("resize",this.Py),this.Ht.on("beforeRender",this.jy)},jy:function(){for(var t=[],n=Array.from(this.Ht.getRenderManager().getRenderList().keys()),e=0;e<this.It.length;e++)this.It[e].xi.element.childNodes[0].style.display="none",this.It[e].Bv();for(var i=0;i<n.length;i++)for(var r=n[i].split("%A%B%C%D"),o=(-1===t.indexOf(r[0])&&t.push(r[0]),r[0]),s=r[1],a=this.Ht.getBuilding(""+o),u=0;u<this.It.length;u++)this.It[u].Wv===o&&""+this.It[u].level==""+s&&this.It[u].visible&&(this.It[u].xi.element.childNodes[0].style.display="block",this.It[u].level===a.level?this.It[u].xi.element.childNodes[0].style.opacity=this.It[u].opacity:this.It[u].xi.element.childNodes[0].style.opacity=a.getFloor(this.It[u].level).ht);this.zo(t),this.gt.render(this.xo,this.Ht.camera)},Py:function(){this.gt.setSize(this.Ht.getContainer().clientWidth,this.Ht.getContainer().clientHeight)},ad:function(t,n){for(var e=this.Ht.getBuilding(""+n).visibleLevels,i=!1,r=0;r<e.length;r++)if(e[r]===t){i=!0;break}return i},zo:function(t){for(var r=this,n=0;n<t.length;n++)for(var e=this.Ht.getBuilding(""+t[n]).visibleLevels,i=0;i<e.length;i++){var o=function(t,n){for(var e=[],i=0;i<r.It.length;i++)r.It[i].ar===n&&r.It[i].Wv===t&&e.push(r.It[i]);return e}(t[n],e[i]);if(1<o.length){l=h=f=c=u=a=s=void 0;for(var s=o,a=[],u=0;u<s.length;u++)if(s[u].Qi&&s[u].Yo){for(var c=!0,f=0;f<a.length;f++){var h=a[f].Fy(),l=s[u].Fy();if(!(c=!W.jn(l.leftTop,l.rightDown,h.leftTop,h.rightDown)))break}c?(s[u].xi.element.childNodes[0].style.display="block",s[u].Iy=!1,a.push(s[u])):(s[u].xi.element.childNodes[0].style.display="none",s[u].Iy=!0)}}}},R:function(t){this.It.push(t),t.xi&&this.xo.add(t.xi)}}),Dv);function AE(t){return(AE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ME(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=AE(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=AE(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==AE(t)?t:String(t)}(i.key),i)}}var OE=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.loadManager=t,this.requests=new Map}var t,e,i;return t=n,(e=[{key:"add",value:function(t,n){this.requests.set(t,n)}},{key:"abortAll",value:function(){var e=this;this.requests.forEach(function(t,n){t.abort(),e.loadManager.itemEnd(n)}),this.requests.clear(),this.loadManager=null}}])&&ME(t.prototype,e),i&&ME(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}();function LE(t){return(LE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function RE(n,t){var e,i=Object.keys(n);return Object.getOwnPropertySymbols&&(e=Object.getOwnPropertySymbols(n),t&&(e=e.filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})),i.push.apply(i,e)),i}function NE(i){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?RE(Object(r),!0).forEach(function(t){var n,e;n=i,e=r[t=t],(t=jE(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):RE(Object(r)).forEach(function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(r,t))})}return i}function PE(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,jE(i.key),i)}}function jE(t){t=function(t,n){if("object"!=LE(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=LE(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==LE(t)?t:String(t)}function FE(t,n,e){n=DE(n);var i=t,n=IE()?Reflect.construct(n,e||[],DE(t).constructor):n.apply(t,e);if(n&&("object"===LE(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return CE(i)}function IE(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(IE=function(){return!!t})()}function CE(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function kE(){return(kE="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=DE(t)););return t}(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function DE(t){return(DE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function UE(t,n){return(UE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Uv=function(){var t,n=i,e=Fo;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(this instanceof i)return n=FE(this,i),t.uatEnvironment&&(Cf={domain:If,online:If+"sdk/check",check:If+"sdk/auth/web",download:If+"sdk/auth/obtainMapRoute",downloadTile:If+"sdk/authLayered/obtainMapRoute",collect:If+"sdk/collect",themeUrl:If+"webtheme/",externalModelURL:If+"webmodel/"}),n.yi={error:[]},n.wu=(new Date).getTime(),n.Ve=new pE(t),n.Ft=new wE(n.Ve),n._t=null,n.Et=null,st.a.environment===G.a.WX&&(st.a.initCanvas(n.Ve,CE(n)),K2.isDestory=!1),n.kt=null,n.Bc=!1,n.Cy=new xt,n.Wi=null!=t.followFocus&&t.followFocus,n.ky=null,n.Dy=!1,n.ho=[S.IMAGE_MARKER,S.TEXT_MARKER],n.Qe=new cE,n.Oi=new oE,n.dr=null,n.fi=null,n.Ke=null,n.Je=null,st.a.environment==G.a.BROWSER?n.ze=n.Uy(n.Ve.container.clientWidth,n.Ve.container.clientHeight):n.ze=n.Uy(n.Ve.container.width,n.Ve.container.height),n.Dt=new sf(CE(n),n.Ve,n.Ft),n.So=new ky,n.So.Ht=CE(n),n.Nt=new go(CE(n),n.Ve.container,n.Ft),n.Nt.enableDragRange=n.Ve.enabledPanRange,n.Ve.panRangeValue&&(n.Ve.enabledPanRange=!0,n.Nt.enableDragRange=!0),n.yr=new Yo(CE(n),n.Ve,n.Ft),n.Mo=n.Mo.bind(CE(n)),n.By=!1,n.Ai=n.Ai.bind(CE(n)),n.Gy=n.Gy.bind(CE(n)),n.Hy=[],n.Xy=!1,n.zy=null,n.Vy=null,n.Wy=n.Wy.bind(CE(n)),n.Yy=new xE(CE(n)),n.Qy(),n.Hd=new OE(Td),Td.onLoad=function(){n.enableUpdateRender()},n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&UE(n,e),n=i,(e=[{key:"requestDispose",get:function(){return this.By}},{key:"focusBuilding",get:function(){return this.Zy}},{key:"x",get:function(){return this._t}},{key:"y",get:function(){return this.Et}},{key:"bound",get:function(){var n=this;return!0===this.needUpdateBound&&0<this.It.length&&(this.xe.reset(),this.It.forEach(function(t){n.xe.expand(t.bound)}),this.xe.expand(this.So.bound),this.needUpdateBound=!1),this.xe.clone()}},{key:"camera",get:function(){return this.ze},set:function(t){this.ze=t}},{key:"followFocus",get:function(){return this.Wi},set:function(t){this.Wi!==t&&(this.Wi=t,this.Wi||this.Nt.Yi(this.kt,{level:this.getLevel()}))}},{key:"getScaleBarInfo",value:function(){var t=st.a.environment===G.a.WX?{x:st.a.document.body.clientWidth/2,y:st.a.document.body.clientHeight/2}:{x:document.body.clientWidth/2,y:document.body.clientHeight/2},n={x:t.x+100,y:t.y},t=Oi.coordsScreenToMap(this,t),n=Oi.coordsScreenToMap(this,n),t=Math.sqrt((t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y))/100,n=[1e7,5e6,2e6,1e6,5e5,2e5,1e5,5e4,25e3,2e4,1e4,5e3,2e3,1e3,500,200,100,50,20,10,5,2,1,.5,.2,.1,.05,.02,.01][Math.floor(this.getZoom())-1],e="",e=n<1e3&&1<=n?"":n<1?(n*=1e3,""):(n/=1e3,"");return{screenDistance:n/t,actualDistance:n,unit:e}}},{key:"setDevicePixalRatio",value:function(t){this.getRenderManager().renderer.setPixelRatio(t),this.Qe.Ye({type:"pixelRatioChanged"}),this.enableUpdateRender()}},{key:"removeAnimator",value:function(t){this.Oi.ji(t)}},{key:"copyCamera",value:function(){var t=null;return(t=this.ze===this.Ke?new dt(f.FOV,1,f.CAMERA_NEAR,f.CAMERA_FAR):new vt(1,1,1,1,f.CAMERA_NEAR,f.CAMERA_FAR)).copy(this.ze),t}},{key:"enableUpdateRender",value:function(){this.Ft.rs=!0}},{key:"enableUpdateNode",value:function(){this.Ft.tm=!0}},{key:"getFloorInfos",value:function(){return this.getBuilding(this.Ve.buildingID).getFloorInfos()}},{key:"setHighlightColor",value:function(t){this.Ft.highlightColor=t}},{key:"setControlTarget",value:function(t){this.Nt.bi(t)}},{key:"resize",value:function(t,n){this.Dt.Ao(t,n)}},{key:"getMarkerGroup",value:function(){return this.So}},{key:"getVisibleLevels",value:function(){return this.kt.visibleLevels}},{key:"setTheme",value:function(t){this.fi.Wf({themeID:t,bid:this.Ve.buildingID})}},{key:"setThemeExtension",value:function(t,n){this.fi.Yf(NE({data:t,bid:this.Ve.buildingID},n))}},{key:"clearThemeExtension",value:function(){this.fi.Yf({bid:this.Ve.buildingID})}},{key:"getRenderOrder",value:function(){return this.Dt.ho}},{key:"setRenderOrder",value:function(t){this.Dt.Po(t)}},{key:"getCollisionOrder",value:function(){return this.Ft.Ko}},{key:"setCollisionOrder",value:function(t){this.Ft.Ko=Fi.uniqWithArrayTwo(t),this.fi.$o()}},{key:"adjustRenderOrder",value:function(t){this.Dt.No(t)}},{key:"setVisibleLevels",value:function(t,n){this.kt.setVisibleLevels(t,n)}},{key:"getRenderManager",value:function(){return this.Dt}},{key:"setRenderManager",value:function(t){for(var n in this.Dt.render=t.render,this.Dt.getLayerType=t.getLayerType,t)this.Dt[n]=t[n]}},{key:"getCenter",value:function(){return this.Nt.Bi()}},{key:"setCenter",value:function(t){this.Nt.Gi(t)}},{key:"zoomIn",value:function(){this.Nt.Ni(1.02)}},{key:"zoomOut",value:function(){this.Nt.Ni(.98)}},{key:"getZoomRange",value:function(){return this.Ft.Pi}},{key:"setZoomRange",value:function(t){this.Nt.ki(t)}},{key:"getZoom",value:function(){return this.Nt.Fi()}},{key:"setZoom",value:function(t){this.Nt.Ci(t)}},{key:"getRotation",value:function(){return this.Nt.Di()}},{key:"setRotation",value:function(t){this.Nt.Ui(t)}},{key:"autoRotate",value:function(t){return(t=t||{}).loop=!0,void 0===t.duration&&(t.duration=5),this.Nt.Ui(t)}},{key:"getTilt",value:function(){return Xi.round(90-this.Nt.Ut.getPolarAngle()*f.RAD2DEG)}},{key:"setTilt",value:function(t){t.tilt=Tt.clamp(t.tilt,this.Ve.minTiltAngle,this.Ve.maxTiltAngle),this.Ft.di=t.tilt,this.Nt.wi(t)}},{key:"getFloor",value:function(t){return null===this.kt?null:this.kt.getFloor(t)}},{key:"getLevel",value:function(){var t;return null==(t=this.kt)?void 0:t.level}},{key:"getLevels",value:function(){return null!==this.kt?this.kt.er:null}},{key:"setLevel",value:function(t){this.fi.cr(this.kt,t)}},{key:"getFloorSpace",value:function(){return null!==this.kt?this.kt.floorSpace:null}},{key:"setFloorSpace",value:function(t){this.kt.floorSpace=t,this.Qe.Ye({type:"floorSpaceChanged"});for(var n=this.So.It,e=0;e<n.length;e++)n[e].Bv()}},{key:"getViewMode",value:function(){return this.ze.isPerspectiveCamera?Li.MODE_3D:Li.MODE_2D}},{key:"setViewMode",value:function(t){this.Nt.gi(t)}},{key:"getInteractions",value:function(){return this.getInteracations()}},{key:"getInteracations",value:function(){return this.Nt}},{key:"getBound",value:function(){return this.kt.bound.clone()}},{key:"getState",value:function(){return{center:this.getCenter(),zoom:this.getZoom(),rotation:this.getRotation(),tiltAngle:this.getTilt(),viewMode:this.getViewMode(),level:this.kt.level,floorSpace:this.getFloorSpace(),visibleLevels:this.kt.visibleLevels,viewBuildingID:this.Ft.jt}}},{key:"setState",value:function(t,n){var e,i=this,r=(n=n||{},this.getState());for(e in r)void 0===t[e]&&(t[e]=r[e]);var o,s=!1!==n.animate,a=n.isParallel,u=(void 0===a&&(a=n.isParallel=!0),n.duration);void 0===u&&(u=n.duration=3),a&&s&&0!==u?this.Nt.Li(t,n):(o=u/5,this.Nt.pauseDamping(),this.setFloorSpace(t.floorSpace),this.setCenter({animate:s,x:t.center.x,y:t.center.y,duration:o,finish:function(){i.setRotation({animate:s,rotation:t.rotation,duration:o,finish:function(){i.setTilt({animate:s,tilt:t.tiltAngle,duration:o,finish:function(){i.setZoom({animate:s,zoom:t.zoom,duration:o,finish:function(){i.setViewMode({animate:s,mode:t.viewMode,finish:function(){i.setVisibleLevels(t.visibleLevels,function(){i.setLevel({animate:s,level:t.level,duration:o,finish:function(){i.Nt.resumeDamping(),n.finish&&n.finish()}})})}})}})}})}})}}))}},{key:"getNodes",value:function(t,n){var e,s=this,i=[],r=(this.kt,[S.LABEL_LAYER,S.FACILITY_LAYER,S.MODEL_LAYER,S.EXTENT_LAYER,S.EXTERNAL_MODEL_LAYER]),o={};if(n)for(var a=0;a<n.length;a++){var u=(u=n[a].buildingID)||this.kt.buildingID,c=function(t,n){var e=[],i=t.buildingID;i=i||s.kt.buildingID;for(var r=t.levels,o=0;o<n.length;o++)n[o].buildingID!==i||r&&-1===r.indexOf(n[o].level)||e.push(n[o]);return e}(n[a],t);o[""+u]=c}else for(var f=0;f<t.length;f++){var h=t[f].buildingID,l=o[""+(h=h||this.kt.buildingID)];l?l.push(t[f]):o[""+h]=[t[f]]}for(e in o)for(var d=o[e],v=function(t){for(var n=null,e=0;e<s.It.length;e++)if(s.It[e].buildingID===t){n=s.It[e];break}return n}(""+e),p=0;p<d.length;p++){var m=d[p].level,y=d[p].eid,b=d[p].type;t:for(var g=0;g<v.It.length;g++)if(v.It[g].ar===m)for(var w=(w=v.It[g].getLayers()).filter(function(t){return r.includes(t.type)}),_=0;_<w.length;_++)for(var E=0;E<w[_].It.length;E++)if(w[_].It[E].G.je===y&&w[_].It[E].Fe===b){i.push(w[_].It[E]);break t}}return i}},{key:"getDataManager",value:function(){return this.dr}},{key:"getMapOptions",value:function(){return this.Ve}},{key:"getContainer",value:function(){return this.Ve.container}},{key:"setFitView",value:function(t,n){var e=this,i=!1!==(n=n||{}).animate,r=this.getZoomRange(),o=this.copyCamera(),s=this.Nt.copyControls(o),a=this.Nt.Ut,u=this.ze;this.Nt.Ut=s,this.ze=o,this.setZoomRange([1,29]),s.enableDamping=!1,this.Nt.Yi(this.kt,{level:this.getLevel(),animate:!1}),this.setZoom({zoom:29,animate:!1,finish:function(){e.setCenter({animate:!1,x:t.center.x,y:t.center.y,finish:function(){e.qy(t,5,0,function(t){e.Nt.Ut=a,e.ze=u,e.setZoomRange(r),s.dispose(),s=null,e.enableUpdateRender(),e.setZoom({animate:i,zoom:t.zoom,duration:.5}),e.setCenter({animate:i,x:t.center.x,y:t.center.y,duration:.5,finish:function(){n.finish&&n.finish()}})})}})}})}},{key:"setBackgroundColor",value:function(t,n){this.Dt.renderer.setClearColor("string"===t?parseInt(t.slice(1),16):t,n),this.enableUpdateRender()}},{key:"setLabelField",value:function(t){this.Ft.vv=t,this.fi.qm(),this.fi.$o()}},{key:"getLabelField",value:function(){return this.Ft.vv}},{key:"getBuilding",value:function(t){return this.Ha({bid:t})}},{key:"getBuildings",value:function(){var n=this,e=[];return this.traverse(function(t){t!==n.kt&&e.push(t)}),e}},{key:"changeOverviewMode",value:function(t){for(var n=0;n<t.buildingIDs.length;n++){var e=this.getBuilding(t.buildingIDs[n]);e.Pf!==t.overviewMode&&(e.Pf=t.overviewMode,this.followFocus&&t.overviewMode!=lm.OUTDOOR&&e.parent.focusBuilding&&e.parent.focusBuilding.buildingID==e.buildingID&&e.setLevel({level:e.level}),e.Qf(t),this.fi.im({bid:t.buildingIDs[n]}),this.Qe.Ye({type:"buildingOverviewModeChanged",buildingID:t.buildingIDs[n]}))}t.overviewMode==lm.OUTDOOR&&this.followFocus&&this.kt.setLevel({level:this.kt.level})}},{key:"enterBuilding",value:function(t){var n=this,e=this.getBuilding(t.buildingID);this.Nt.Gi({x:e.x,y:e.y,animate:!0,duration:.5,finish:function(){n.getBuildings().forEach(function(t){n.Hy.push({buildingID:t.buildingID,visible:t.visible}),t.visible=!1}),e.visible=!0,n.Ft.jt=t.buildingID,n.fi.Vf(e),n.fi.zi(),n.fi.ty(e,{}),n.Qe.Ye({type:"ViewBuildingChange",buildingID:n.Ft.jt}),n.Qe.Ye({type:"buildingEntered",buildingID:n.Ft.jt}),t.finish&&t.finish({buildingID:t.buildingID})}})}},{key:"exitBuilding",value:function(t){var n=this,e=(this.Hy.forEach(function(t){n.getBuilding(t.buildingID).visible=t.visible}),this.Hy.length=0,this.getBuilding(this.Ft.jt));this.Nt.Gi({x:e.x,y:e.y,animate:!0,duration:.5,finish:function(){n.Ft.jt=n.Ve.buildingID,n.fi.zi(),n.fi.ty(e,{}),n.Qe.Ye({type:"ViewBuildingChange",buildingID:n.Ft.jt}),n.Qe.Ye({type:"buildingExited",buildingID:e.je}),t.finish&&t.finish({buildingID:e.je})}})}},{key:"on",value:function(t,n){this.Qe&&(this.Qe.ly(t,n),this.Ft.Ry(t,!0))}},{key:"off",value:function(t,n){this.Qe&&(this.Qe.py(t,n),this.Qe.vy(t)||this.Ft&&this.Ft.Ry(t,!1))}},{key:"pickFilterFunction",value:function(){return!0}},{key:"dispose",value:function(){var t,n=this;this.By||(this.By=!0,this.Yy.dispose(),this.Hd.abortAll(),this.setBackgroundColor(16777215,1),this.Dt.renderer.clear(),this.Dt.nn(),st.a.environment==G.a.BROWSER&&this.Ve.container.removeChild(this.Dt.renderer.domElement),st.a.environment===G.a.WX&&(K2.textureCanvas=null,K2.dispose(),K2.isDestory=!0),t=function(){n.dr.nn(function(){n.Oi.nn(function(){n.fi.nn(function(){n.Mo(),n.So.dispose(),kE(DE(i.prototype),"dispose",n).call(n),Td.onLoad=function(){},Td.record.clear()})})})},Td.isLoaded()?t():Td.onLoad=t)}},{key:"collisionCheck",value:function(){this.fi.$o()}}])&&PE(n.prototype,e),t&&PE(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),g=(Object.assign(Uv.prototype,{Mo:function(){for(var t,n=[this.yr,this.Nt],e=0;e<n.length;e++)n[e].nn();for(t in this.Dt.Mo(),this.Dt=null,this.dr=null,this.fi=null,this)-1<n.indexOf(this[""+t])&&delete this[""+t];this.kt=n=null},Uy:function(t,n){return this.Ke=new dt(f.FOV,t/n,f.CAMERA_NEAR,f.CAMERA_FAR),this.Je=new vt(-t/2,t/2,n/2,-n/2,f.CAMERA_NEAR,f.CAMERA_FAR),this.Ft.He===Li.MODE_3D?this.Ke:this.Je},Ti:function(t){(t.Ht=this).It.push(t),this.needUpdateBound=!0},fm:function(t){for(var n=[],e=(n.push({x:t.min.x,y:t.min.y}),n.push({x:t.min.x,y:t.max.y}),n.push({x:t.max.x,y:t.max.y}),n.push({x:t.max.x,y:t.min.y}),new Ur),i=0;i<n.length;i++){var r=Oi.coordsMapToScreen(this,{x:n[i].x,y:n[i].y,level:this.getLevel(),height:0});if(null===r)return null;e.Se([r])}return e},Ky:function(t){var n=this.Dt.renderer.domElement.clientHeight,e=this.Dt.renderer.domElement.clientWidth,i=this.getZoom(),i=this.Nt.ai(i),t=this.fm(t);return t?i*(e/n>(i=t.size).x/i.y?i.y/n:i.x/e):null},Jy:function(t){t=this.fm(t);return t?Oi.coordsScreenToMap(this,{x:(t.max.x+t.min.x)/2,y:(t.max.y+t.min.y)/2,level:this.getLevel()}):null},qy:function(n,e,i,r){var o=this,s=this.getZoom(),t=this.Ky(n);t?s=this.Nt.Ii(t):s-=1,this.setZoom({animate:!1,zoom:s,finish:function(){var t=o.Jy(n);t?o.setCenter({animate:!1,x:t.x,y:t.y,finish:function(){++i===e?r({zoom:s,center:t}):o.qy(n,e,i,r)}}):0<s?o.qy(n,e,i,r):r({zoom:s,center:n.center})}})},Ai:function(){var t=this.getZoom();Math.abs(t-this.Ft.wy)>f.EPS&&(this.Qe.Ye({type:"zoom",zoom:t}),this.ze.isOrthographicCamera&&this.Dt.Ei(),this.Ft.wy=t)},Gy:function(){var t;this.Ft.Ey&&(t=this.Nt.Ut.target).distanceToSquared(this.Cy)>f.EPS&&(this.Qe.Ye({type:"move",center:this.getCenter()}),this.Cy=t.clone())},Qy:function(){var t,n,e,i,s=this,a=!0;n=(t=this).Ve,e=this.Ft,i=function(t,n,e,i,r,o){a&&(s.Ft.Ny(s.kt),a=s.Nt.si()),s.Dt.zi(),s.ze.updateMatrixWorld(),e&&o&&s.Nt.Ti([s.Ai,s.Gy]),r&&o&&(s.Xy=!0,s.Qe.Ye({type:"loaded"}),s.rm(),s.Ft.Rm=!1)},t.dr=new tl({mapCreateTime:t.wu}),t.fi=new nE(t,n,e,i),t.fi.Jm()},Ha:function(n){var e=null;return this.traverse(function(t){t.je!==n.bid&&t.Ji!==n.mid||(e=t)}),e},Wm:function(){var t=this.Dt.renderer.domElement,t={x:t.clientWidth/2,y:t.clientHeight/2,z:this.Nt.controls.target.y};return Oi.coordsScreenToMap(this,t)},Ym:function(e){var i=this;if(e===this.kt)return!1;if(!this.Xy)return!1;var r=!1;if(this.Ve.enterTriggerMode===fE.Individual)e.Bf.Mf.forEach(function(t,n){t.type===S.MODEL&&t.level===i.kt.level&&uy.isContain(t.coordinates[0],i.Wm())&&(i.Zy=e,r=!0)});else for(var t,n=0;n<e.levelChart.length;n+=2)e.levelChart[n]===this.kt.level&&(t=e.levelChart[n+1],t=e.Zm.get(t),uy.isContain(t[0],this.Wm()))&&(this.Zy=e,r=!0);return r},nm:function(n){var e=this;this.traverse(function(t){e.Zy||(e.Ym(t),e.Zy&&n(t))})},rm:function(){var e=this;if(this.Dy&&this.Zy.je!=this.Ft.Ve.mapID){var t=this.$y(),n=this.Zy.je;if(t||this.zy===n||(n=this.zy,t=!0),t){if(this.getState().viewBuildingID&&this.getState().viewBuildingID!==this.Ft.Ve.mapID)return;var t={type:"buildingExited",buildingID:n},i=(this.Dy=!1,this.Zy=null,this.getBuilding(n));this.fi.Xc(n)&&i.Gf&&(i.Gf=!1,this.Qe.Ye(t))}}this.traverse(function(t){var n;e.Dy||e.Ym(t)&&(n=e.Qm(),e.zy=t.buildingID,!n||e.getState().viewBuildingID&&e.getState().viewBuildingID!==e.Ft.Ve.mapID||(e.Dy=!0,e.fi.Xc(t.je)&&0==t.Gf?(t.Gf=!0,e.Qe.Ye({type:"buildingEntered",buildingID:t.je})):(e.Vy=t.je,e.on("update",e.Wy))))})},Wy:function(){var t,n;this.fi.Xc(this.Vy)&&(this.Zy&&this.Zy.je===this.Vy&&(t=this.Ym(this.Zy),n=this.Qm(),t)&&n&&(this.Zy.Gf=!0,this.Qe.Ye({type:"buildingEntered",buildingID:this.Vy})),this.off("update",this.Wy),this.Vy=null)},$y:function(){var t,n=this.t1();return this.Zy.overviewMode==lm.NORMAL?(t=(t=this.getZoom())<this.Zy.Cf||t>=this.Zy.kf,!n||t):!n},Qm:function(){var t;return this.Zy.overviewMode!=lm.NORMAL||!((t=this.getZoom())<this.Zy.Cf||t>=this.Zy.kf)},t1:function(){var t,n,e=this;return null!=this.Zy&&(!!this.Ym(this.Zy)||null!=(t=this.Zy.getFloor(this.Zy.level).getLayers(S.EXTENT_LAYER)[0])&&(n=!1,t&&t.traverse(function(t){n=!uy.isContain(t.coordinates[0],e.Wm())}),!n))}}),Uv);function BE(t){return(BE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function GE(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=BE(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=BE(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==BE(t)?t:String(t)}(i.key),i)}}function HE(t,n,e){n=zE(n);var i=t,n=XE()?Reflect.construct(n,e||[],zE(t).constructor):n.apply(t,e);if(n&&("object"===BE(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function XE(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(XE=function(){return!!t})()}function zE(t){return(zE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function VE(t,n){return(VE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var b1=function(){var t,n=i,e=xg;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){if(this instanceof i)return(t=HE(this,i,[t])).Ue=new Map,t;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&VE(n,e),n=i,(e=[{key:"moveTo",value:function(n){var t,e=this,i=void 0!==n.animate&&n.animate,r=n.duration||.5,o=this.qi(g);if(o)return i?(this.Ue.has("moveTo")?t=this.Ue.get("moveTo"):(t=new Wi,this.Ue.set("moveTo",t)),t.en([this._t,this.Et]).rn([n.x,n.y]).sn(r).un(function(t){e._t=t.destination[0],e.Et=t.destination[1],e.Bv(),n.update&&n.update({x:e._t,y:e.Et,level:e.ar,height:e.nt,buildingID:e.Wv}),o.enableUpdateRender()}).cn(function(){e._t=n.x,e.Et=n.y,e.Bv(),n.finish&&n.finish(),o.enableUpdateRender()}),o.Oi.Ti(t.tn()),t):(this._t=n.x,this.Et=n.y,this.Bv(),n.finish&&n.finish(),void o.enableUpdateRender())}},{key:"stop",value:function(){var n=this.qi(g);n&&this.Ue&&(this.Ue.forEach(function(t){n.Oi.ji(t)}),this.Ue.clear())}}])&&GE(n.prototype,e),t&&GE(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),WE=(Object.assign(b1.prototype,{Bv:function(){if(this.xi){var t=this.qi(g);if(!t)return!1;var n=this.Fe===S.DOM_MARKER?this.n1.height+this.nt:this.nt;this.xi.position.set(this._t-t.x,n,-this.Et+t.y),this.needUpdateBound=!0,t.enableUpdateRender()}}}),b1);function YE(t){return(YE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function QE(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=YE(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=YE(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==YE(t)?t:String(t)}(i.key),i)}}function ZE(t,n,e){n=JE(n);var i=t,n=qE()?Reflect.construct(n,e||[],JE(t).constructor):n.apply(t,e);if(n&&("object"===YE(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function qE(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(qE=function(){return!!t})()}function KE(){return(KE="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=JE(t)););return t}(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function JE(t){return(JE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $E(t,n){return($E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var tS=function(){var t,n=i,e=WE;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){if(this instanceof i)return ZE(this,i,[t]);throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&$E(n,e),n=i,(e=[{key:"collision",get:function(){return this.Yo},set:function(t){this.Yo!==t&&(this.Yo=t,t=this.qi(g))&&t.fi.$o()}},{key:"addTo",value:function(t){KE(JE(i.prototype),"addTo",this).call(this,t);t=this.qi(g);t&&(t.on("viewModeChanged",this.Co),t.on("zoom",this.Co),t.on("resize",this.Co),t.fi.$o())}},{key:"remove",value:function(){this.stop();var t=this.qi(g);t&&(t.off("viewModeChanged",this.Co),t.off("zoom",this.Co),t.off("resize",this.Co),KE(JE(i.prototype),"remove",this).call(this),t.fi.$o(),t.enableUpdateRender())}}])&&QE(n.prototype,e),t&&QE(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}();function nS(t){return(nS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function eS(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=nS(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=nS(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==nS(t)?t:String(t)}(i.key),i)}}function iS(t,n,e){n=oS(n);var i=t,n=rS()?Reflect.construct(n,e||[],oS(t).constructor):n.apply(t,e);if(n&&("object"===nS(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return sS(i)}function rS(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(rS=function(){return!!t})()}function oS(t){return(oS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function sS(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function aS(t,n){return(aS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var P1=function(){var t,n=i,e=tS;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(this instanceof i)return(n=iS(this,i,[t])).Fe=S.IMAGE_MARKER,n.Fh=t.url,n.Fo=void 0!==t.size?t.size:32,n.p0=void 0!==t.depth&&t.depth,n.ht=void 0!==t.opacity?t.opacity:1,n.Yo=void 0===t.collision||t.collision,n.Re=Fi.getCenterByAnchor(t.anchor),n.Co=n.Co.bind(sS(n)),n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&aS(n,e),n=i,(e=[{key:"url",get:function(){return this.Fh},set:function(t){this.Fh=t,this.Bh()}},{key:"opacity",get:function(){return this.ht},set:function(t){this.ht=t,this.Bh()}},{key:"size",get:function(){return this.Fo},set:function(t){this.Fo=t,this.Co()}},{key:"jump",value:function(t){return vy(this,t)}},{key:"stopJump",value:function(){return py(this)}},{key:"boost",value:function(t){return ly(this,t)}},{key:"stopBoost",value:function(){return dy(this)}},{key:"getRenderNode",value:function(){return this.xi}}])&&eS(n.prototype,e),t&&eS(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),uS=(Object.assign(P1.prototype,{wc:function(){var t;return!!this.Fh&&!!(t=this.qi(g))&&(t=this.Lr(t),this.xi=new xm(t),this.xi.center.set(this.Re.x,this.Re.y),this.xi.visible=this.Qi,this.Bv(),this.Co(),(this.xi.mapNode=this).th=!0)},Co:function(){var t=this.qi(g);t&&(my(t.fi,this),t.fi.$o(),t.enableUpdateRender())},Bh:function(){var t=this.qi(g);t&&(this.xi.material=this.Lr(t),this.Co())},Lr:function(t){var n=this,e=this.qi(v);return t.fi.Br.qu({url:this.Fh,needDepth:this.p0,opacity:this.ht*e.ht},function(){n.xi&&n.Co(),t.enableUpdateRender()})}}),P1);function cS(t){return(cS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fS(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=cS(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=cS(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==cS(t)?t:String(t)}(i.key),i)}}function hS(t,n,e){n=dS(n);var i=t,n=lS()?Reflect.construct(n,e||[],dS(t).constructor):n.apply(t,e);if(n&&("object"===cS(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return vS(i)}function lS(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(lS=function(){return!!t})()}function dS(t){return(dS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function vS(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function pS(t,n){return(pS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}B1=function(){var t,n=i,e=tS;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(this instanceof i)return(n=hS(this,i,[t])).Fe=void 0!==t.type?t.type:S.TEXT_MARKER,n.fv=void 0!==t.text?t.text:"",n.e1=void 0!==t.fontsize?t.fontsize:20,void 0!==t.fontSize&&(n.e1=t.fontSize),n.i1=t.fontFamily,n.Fv=void 0!==t.fillColor?t.fillColor:"0,0,0",n.o1=void 0!==t.strokeColor?t.strokeColor:"255,225,255",n.s1=void 0!==t.strokeWidth?t.strokeWidth:1,n.a1=t.plateColor,n.u1=t.plateStrokeColor,n.p0=void 0!==t.depth&&t.depth,n.Yo=void 0===t.collision||t.collision,n.ht=void 0!==t.opacity?t.opacity:1,n.c1=void 0!==t.textAlign?t.textAlign:Sl.Center,n.f1=t.anchor,n.Re=Fi.getCenterByAnchor(t.anchor),n.Fo=0,n.Co=n.Co.bind(vS(n)),n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&pS(n,e),n=i,(e=[{key:"size",get:function(){return this.Fo},set:function(t){this.Fo=t}},{key:"text",get:function(){return this.fv},set:function(t){this.fv=t}},{key:"fillColor",get:function(){return this.Fv},set:function(t){this.Fv=t}},{key:"strokeColor",get:function(){return this.o1},set:function(t){this.o1=t}},{key:"strokeWidth",get:function(){return this.s1},set:function(t){this.s1=t}},{key:"fontsize",get:function(){return this.e1},set:function(t){this.e1=t}},{key:"fontSize",get:function(){return this.e1},set:function(t){this.e1=t}},{key:"plateColor",get:function(){return this.a1},set:function(t){this.a1=t}},{key:"plateStrokeColor",get:function(){return this.u1},set:function(t){this.u1=t}},{key:"update",value:function(){this.Bh()}},{key:"setInitWriteRenderNodeFunction",value:function(t){this.h1=t}},{key:"findParent",value:function(t){return this.qi(t)}},{key:"updateSize",value:function(){this.Co()}},{key:"getRenderNode",value:function(){return this.xi}},{key:"getScreenSize",value:function(){var t=null;return t=this.xi?{width:this.xi.children[0].material.map.image.width/2,height:this.xi.children[0].material.map.image.height/2}:t}}])&&fS(n.prototype,e),t&&fS(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),Object.assign(B1.prototype,{wc:function(){var t=this.qi(g);if(!t)return!1;this.pv=!1;t=t.fi,t=this.Lr(t.Br).material,this.xi=new wc,t=new xm(t);return t.center.set(this.Re.x,this.Re.y),this.xi.add(t),this.Co(),this.Bv(),this.xi.mapNode=this,(t.mapNode=this).th=!0,this.h1&&(this.xi=this.h1(this.xi)),!0},l1:function(t,n){if(t&&t.material){var e=this.qi(g);if(!e)return!1;e=e.fi.Jf(n);t.scale.set(e,e,e),t.scale.multiplyScalar(t.material.userData.mspriteScale||1),t.scale.setX(t.scale.x/t.material.userData.scaleRatio)}},Co:function(){var t=this.qi(g);if(!t)return!1;var n=this.xi.isGroup?this.xi.children[0]:this.xi;"Sprite"===n.type&&(this.l1(n,this.Fo),t.enableUpdateRender())},Gv:function(t){t&&t.material&&(t.material.map&&t.material.map.dispose(),t.material.dispose())},Bh:function(){var t,n=this.qi(g);n&&(t=this.xi.isGroup?this.xi.children[0]:this.xi,this.Gv(t),n=this.Lr(n.fi.Br).material,t.material=n,this.Co())},Lr:function(t){var n=this,e=this.qi(v),t=t.Xu(this.fv,{fontsize:this.pv?this.e1+2:this.e1,fillColor:Xi.toRgba(this.Fv),strokeColor:Xi.toRgba(this.o1),plateColor:Xi.toRgba(this.a1),plateStrokeColor:Xi.toRgba(this.u1),strokeWidth:this.s1},{family:this.i1,needSize:!0,opacity:this.ht*e.ht,textAlign:this.c1,drawText:!this.pv,callback:function(){var t=n.qi(g);t&&t.enableUpdateRender()}});return this.Fo=t.size,{material:t}}}),Q1=B1;function mS(t){return(mS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yS(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=mS(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=mS(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==mS(t)?t:String(t)}(i.key),i)}}var bS=function(){function i(){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function")}var t,n,e;return t=i,e=[{key:"createShape",value:function(t,n){var e=new Sp;if(Array.isArray(t[0])){var i=t[0];e.moveTo(i[0].x-n.x,i[0].y-n.y);for(var r=1;r<i.length;r++)e.lineTo(i[r].x-n.x,i[r].y-n.y);if(1<t.length)for(var o=1;o<t.length;o++){var s=t[o],a=new Ep;if(0<s.length){a.moveTo(s[0].x-n.x,s[0].y-n.y);for(var u=1;u<s.length;u++)a.lineTo(s[u].x-n.x,s[u].y-n.y)}e.holes.push(a)}}else{e.moveTo(t[0].x-n.x,t[0].y-n.y);for(var c=1;c<t.length;c++)e.lineTo(t[c].x-n.x,t[c].y-n.y)}return e}},{key:"createShapeBufferGeometryByCenter",value:function(t,n,e){t=new zp(this.createShape(t,n));if(e){for(var i=[Number.MAX_VALUE,Number.MAX_VALUE],r=[-Number.MAX_VALUE,-Number.MAX_VALUE],o=t.attributes.position.array,s=0;s<o.length/3;s++){var a=o[3*s],u=o[3*s+1];a<i[0]&&(i[0]=a),u<i[1]&&(i[1]=u),r[0]<a&&(r[0]=a),r[1]<u&&(r[1]=u)}for(var c=t.attributes.uv.array,f=[r[0]-i[0],r[1]-i[1]],h=0;h<o.length/3;h++){var l=o[3*h],d=o[3*h+1];c[2*h]=(l-i[0])/f[0],c[2*h+1]=(d-i[1])/f[1]}t.setAttribute("uv",new E(c,2))}return t}},{key:"createExtrudeBufferGeometry",value:function(t,n){return new Wp(t,{steps:1,depth:n.depth,bevelEnabled:!1,bevelThickness:0,bevelSize:0,bevelOffset:0,bevelSegments:1})}},{key:"closedPoints",value:function(t){return Jp.closedPoints(t)}},{key:"createReactShape",value:function(t,n){var e=new Sp,n=n/2,t=t/2;return e.moveTo(-t,-n),e.lineTo(-t,n),e.lineTo(t,n),e.lineTo(t,-n),e}},{key:"createCircleShape",value:function(t,n){var e=new Sp;return e.absarc(0,0,t,0,2*Math.PI,!1),e}},{key:"createReactExtrudeBufferGeometry",value:function(t,n,e){t=i.createReactShape(t,n);return this.createExtrudeBufferGeometry(t,e)}},{key:"createCircleExtrudeBufferGeometry",value:function(t,n,e){t=i.createCircleShape(t,n);return this.createExtrudeBufferGeometry(t,e)}},{key:"createCenterBufferGeometry",value:function(t,n){for(var e=[],i=0;i<t.length-1;i++)for(var r=2;r<10;r+=2)e.push({x:t[i].x+(t[i+1].x-t[i].x)*r*.1,y:t[i].y+(t[i+1].y-t[i].y)*r*.1,z:t[i].z+(t[i+1].z-t[i].z)*r*.1});e.push({x:e[0].x,y:e[0].y,z:e[0].z});for(var o=new N,s=[],a=[],u=0;u<e.length-1;u++)s.push(e[u].x),s.push(e[u].y),s.push(e[u].z),s.push(e[u+1].x),s.push(e[u+1].y),s.push(e[u+1].z),s.push(n.x),s.push(n.y),s.push(n.z),a.push(0,0,1);var c=new Float32Array(s);return o.setAttribute("position",new E(c,3)),o.setAttribute("gradientAlpha",new E(a,1)),o}},{key:"scalePoints",value:function(t,n,e){for(var i=[],r=0;r<t.length;r++){var o=t[r].x,s=t[r].y,a=t[r].z;i.push({x:o+(o-n.x)*(e-1),y:s+(s-n.y)*(e-1),z:a})}return i}},{key:"scaleValuePoints",value:function(t,n,e){for(var i=[],r=0;r<t.length;r++){var o={x:t[r].x,y:t[r].y,z:t[r].z};o.x-n.x<0?o.x-=e:o.x+=e,o.y-n.y<0?o.y-=e:o.y+=e,i.push(o)}return i}}],(n=null)&&yS(t.prototype,n),e&&yS(t,e),Object.defineProperty(t,"prototype",{writable:!1}),i}();function gS(t){return(gS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wS(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=gS(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=gS(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==gS(t)?t:String(t)}(i.key),i)}}function _S(t,n,e){n=SS(n);var i=t,n=ES()?Reflect.construct(n,e||[],SS(t).constructor):n.apply(t,e);if(n&&("object"===gS(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return TS(i)}function ES(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ES=function(){return!!t})()}function SS(t){return(SS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function TS(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function xS(t,n){return(xS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}nb=function(){var t,n=i,e=xg;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(this instanceof i)return(n=_S(this,i,[t])).Fe=S.POLYGON_MARKER,n.Fh=void 0!==t.url?t.url:void 0,n.Sd=void 0!==t.color?t.color:"#FF0000",n.ht=void 0!==t.opacity?t.opacity:1,n.q0=t.borderColor||t.borderColor||"#00ff00",n.l0="number"==typeof t.borderWidth?t.borderWidth:2,n.nt=void 0!==t.height?t.height:0,n.Kf=void 0!==t.points?t.points:[],n.If=null,n.x0=n.x0.bind(TS(n)),n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&xS(n,e),n=i,(e=[{key:"x",get:function(){return this._t}},{key:"y",get:function(){return this.Et}},{key:"points",get:function(){return this.Kf},set:function(t){var n,e;this.Kf=t,this.xi&&(t=this.qi(g))&&(n=new Mt(t.x,t.y),n=bS.createShapeBufferGeometryByCenter(this.Kf,n,!!this.Fh),e=this.xi.geometry,this.xi.geometry=n,e.dispose(),e=null,e=this.d1(n),this.If.U0(e),t.enableUpdateRender(),this.Zi=!0)}},{key:"color",get:function(){return this.Sd},set:function(t){this.Sd=t,this.m1()}},{key:"borderColor",get:function(){return this.q0},set:function(t){this.q0=t,this.If&&(this.If.color=t,this.If.update())}},{key:"borderWidth",get:function(){return this.l0},set:function(t){this.l0=t,this.If&&(this.If.width=t,this.If.update())}},{key:"opacity",get:function(){return this.ht},set:function(t){this.ht=t,this.m1()}},{key:"getBound",value:function(){return uy.bound(this.Kf)}},{key:"getInsideCenter",value:function(){var t={};return uy.calculatorInsideCentroid(this.Kf,t),t}},{key:"getRenderNode",value:function(){return this.xi}},{key:"remove",value:function(){var t=this.qi(g);this.Ht&&this.Ht.remove(this),t&&(t.off("resize",this.x0),t.enableUpdateRender())}}])&&wS(n.prototype,e),t&&wS(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),Object.assign(nb.prototype,{d1:function(t){for(var n=t.attributes.position.array.length,e=new Float32Array(n+3),i=0;i<n;i++)e[i]=t.attributes.position.array[i];e[n]=t.attributes.position.array[0],e[n+1]=t.attributes.position.array[1],e[n+2]=t.attributes.position.array[2],n+=3;for(var r=new _p,o=0;o<n/3-1;o++){var s=new yp(new xt(e[3*o],e[3*o+1],e[3*o+2]),new xt(e[3*(o+1)],e[3*(o+1)+1],e[3*(o+1)+2]));r.curves.push(s)}var a=10*Math.floor(r.getLength());return r.getSpacedPoints(a=8e3<a?8e3:a)},wc:function(){var t,n,e,i;return!!this.Kf&&!!(t=this.qi(g))&&(i=this.qi(v),n=t.fi.Br.Cu({url:this.Fh,color:this.Sd,opacity:this.ht*i.ht,visible:!this.Fh},function(){n.map.wrapS=Xn,n.map.wrapT=Xn,n.needsUpdate=!0,n.visible=!0}),i=new Mt(t.x,t.y),i=bS.createShapeBufferGeometryByCenter(this.Kf,i,!!this.Fh),e=this.d1(i),S1(i,n,this),this.xi.position.set(0,this.nt,0),(i=new Bw({color:this.q0,width:this.l0})).Ht=this,i.D0(e,t),this.Kv=e,(this.If=i).xi.renderOrder=1,this.xi.add(i.xi),t.enableUpdateRender(),t.on("resize",this.x0),!0)},x0:function(){var t=this.qi(g);t&&null!==this.If&&this.If.xi&&(this.If.xi.material.resolution=new Mt(t.Dt.renderer.domElement.clientWidth,t.Dt.renderer.domElement.clientHeight),t.enableUpdateRender())},Bv:function(){this.xi&&this.xi.position.set(0,this.nt,0),this.qi(g).enableUpdateRender()},m1:function(){var t=this,n=this.qi(g);if(!n)return!1;var e=n.fi,i=this.qi(v);this.xi.material=e.Br.Cu({url:this.Fh,color:this.Sd,opacity:this.ht*i.ht,visible:!this.Fh},function(){t.xi.material.map.wrapS=Xn,t.xi.material.map.wrapT=Xn,t.xi.material.needsUpdate=!0,t.xi.material.visible=!0}),n.enableUpdateRender()},Bh:function(){this.m1(),this.If.update()}}),y2=nb;function AS(t){return(AS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function MS(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=AS(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=AS(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==AS(t)?t:String(t)}(i.key),i)}}function OS(t,n,e){n=RS(n);var i=t,n=LS()?Reflect.construct(n,e||[],RS(t).constructor):n.apply(t,e);if(n&&("object"===AS(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function LS(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(LS=function(){return!!t})()}function RS(t){return(RS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function NS(t,n){return(NS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var PS=function(){var t,n,e=r,i=N;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(){var t,n;if(this instanceof r)return t=OS(this,r),n=new Nc(new Float32Array([-.5,0,-.5,0,0,.5,0,-.5,1,0,.5,0,.5,1,1,-.5,0,.5,0,1]),5),t.setIndex([0,1,2,0,2,3]),t.setAttribute("position",new jc(n,3,0,!1)),t.setAttribute("uv",new jc(n,2,3,!1)),t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&NS(e,i),e=r,t&&MS(e.prototype,t),n&&MS(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}();function jS(t){return(jS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function FS(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=jS(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=jS(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==jS(t)?t:String(t)}(i.key),i)}}function IS(t,n,e){n=US(n);var i=t,n=CS()?Reflect.construct(n,e||[],US(t).constructor):n.apply(t,e);if(n&&("object"===jS(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return kS(i)}function CS(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(CS=function(){return!!t})()}function kS(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function DS(){return(DS="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=US(t)););return t}(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function US(t){return(US=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function BS(t,n){return(BS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var T2=function(){var t,n=i,e=WE;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(this instanceof i)return(n=IS(this,i,[t])).Fe=S.LOCATION_MARKER,n.Fh=t.url,n.Fo=void 0!==t.size?t.size:20,n.ar=void 0!==t.level?t.level:1,n.ht=void 0!==t.opacity?t.opacity:1,n.Wv=t.buildingID,n.b1=0,n.Co=n.Co.bind(kS(n)),n.Bv=n.Bv.bind(kS(n)),n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&BS(n,e),n=i,(e=[{key:"buildingID",get:function(){return this.Wv}},{key:"level",get:function(){return this.ar},set:function(t){this.ar!==t&&(this.ar=t,t=this.qi(g),this.remove(),this.addTo(t))}},{key:"opacity",get:function(){return this.ht},set:function(t){this.ht=t,this.th&&this.Bh()}},{key:"url",get:function(){return this.Fh},set:function(t){this.Fh=t,this.Bh()}},{key:"size",get:function(){return this.Fo},set:function(t){this.Fo=t,this.Co()}},{key:"moveTo",value:function(t){if(this.Wv!==t.buildingID){this.Wv=t.buildingID,this.ar=t.level;var n=this.qi(g);if(!n)return!1;this.remove(),this.addTo(n)}else t.level&&(this.level=t.level);return DS(US(i.prototype),"moveTo",this).call(this,t)}},{key:"rotateTo",value:function(t){var n=this,e=this.qi(g);if(!e)return!1;var i,r=t.duration||.5,o=this.xi.rotation.y,s=t.heading%360*f.DEG2RAD,a=0,s=o+(a=s-o!=0?Math.sin(s-o)/Math.abs(Math.sin(s-o))*Math.acos(Math.cos(s-o)):a);t.animate?(this.Ue.has("rotation")?((i=this.Ue.get("rotation")).finish(),i.en([o]),i.rn([s])):(i=new Wi({src:[o],dest:[s]}),this.Ue.set("rotation",i)),i.sn(r).un(function(t){n.xi&&(n.xi.rotation.y=t.destination[0],n.b1=t.destination[0],e.enableUpdateRender())}).cn(function(){e.Oi.ji(i),e.enableUpdateRender(),t.finish&&t.finish()}),e.Oi.Ti(i.tn())):this.xi&&(this.xi.rotation.y=s,this.b1=s,e.enableUpdateRender())}},{key:"addTo",value:function(t){var n=this.ci(t);n&&(DS(US(i.prototype),"addTo",this).call(this,n),t.on("zoom",this.Co),t.on("resize",this.Co),t.on("viewChanged",this.Co))}},{key:"remove",value:function(){this.stop();var t=this.qi(g);if(!t)return!1;t.off("zoom",this.Co),t.off("resize",this.Co),t.off("viewChanged",this.Co),DS(US(i.prototype),"remove",this).call(this)}},{key:"getRenderNode",value:function(){return this.xi}}])&&FS(n.prototype,e),t&&FS(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),N2=(Object.assign(T2.prototype,{wc:function(){var t,n,e=this.qi(g);return!!e&&(n=new PS,t=this.Lr(e),this.xi=new ba(n,t),this.xi.renderOrder=1,(this.xi.mapNode=this).Bv(),this.xi.rotation.set(0,this.b1,-Math.PI,"XYZ"),this.xi.updateMatrixWorld(!0),n=e.fi.Km(this.xi,this.Fo),this.xi.scale.set(n,n,n),this.xi.visible=this.Qi,this.Ht.xo.add(this.xi),this.th=!0)},Co:function(){var t,n,e=this.qi(g);!e||(n=this.xi.position,t=!1,t=!!(isNaN(n.x)||isNaN(n.y)||isNaN(n.z)||"number"!=typeof n.x||"number"!=typeof n.y||"number"!=typeof n.z)||t)||(n=e.fi.Km(this.xi,this.Fo),this.xi.scale.set(n,n,n),e.enableUpdateRender())},Bv:function(){var t,n=this.qi(g);n&&(t=this.ci(n))&&(this.xi.position.set(this._t-n.x,t.nt+this.nt,-this.Et+n.y),this.needUpdateBound=!0,n.enableUpdateRender())},Lr:function(n){var e=this;return n.fi.Br.ku({url:this.Fh,flipY:!1,opacity:this.ht},function(){var t;e.xi&&(t=n.fi.Km(e.xi,e.Fo),e.xi.scale.set(t,t,t),n.enableUpdateRender())})},Bh:function(){var t=this.qi(g);if(!t)return!1;this.xi.material.map&&this.xi.material.map.dispose(),this.xi.material.dispose(),this.xi.material=this.Lr(t),this.xi.material.needsUpdate=!0,t.enableUpdateRender()},ci:function(t){return(this.Wv?t.getBuilding(this.Wv):t).getFloor(this.ar)}}),T2),D2={EDGES_LINES_TYPE:"EDGES_LINES_TYPE"},GS=(Object.freeze(D2),D2),HS={NONE:0,ALL:1,TOP:2};function XS(t,n){N.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:n},n=void 0!==n?n:1;for(var e,i,r,o,s=[],a=Math.cos(Tt.DEG2RAD*n),u=[0,0],c={},f=["a","b","c"],h=(t.isBufferGeometry?(o=new rs).fromBufferGeometry(t):o=t.clone(),o.mergeVertices(),o.computeFaceNormals(),o.vertices),l=o.faces,d=0,v=l.length;d<v;d++)for(var p=l[d],m=0;m<3;m++)e=p[f[m]],i=p[f[(m+1)%3]],u[0]=Math.min(e,i),u[1]=Math.max(e,i),void 0===c[r=u[0]+","+u[1]]?c[r]={index1:u[0],index2:u[1],face1:d,face2:void 0}:c[r].face2=d;for(r in c){var y,b=c[r];(void 0===b.face2||l[b.face1].normal.dot(l[b.face2].normal)<=a)&&(y=h[b.index1],s.push(y.x,y.y,y.z),y=h[b.index2],s.push(y.x,y.y,y.z))}this.setAttribute("position",new E(s,3))}function zS(t){return(zS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function VS(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=zS(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=zS(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==zS(t)?t:String(t)}(i.key),i)}}function WS(t,n,e){n=QS(n);var i=t,n=YS()?Reflect.construct(n,e||[],QS(t).constructor):n.apply(t,e);if(n&&("object"===zS(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function YS(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(YS=function(){return!!t})()}function QS(t){return(QS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ZS(t,n){return(ZS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}(XS.prototype=Object.create(N.prototype)).constructor=XS;var U2=function(){var t,n=i,e=xg;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(this instanceof i)return(n=WS(this,i,[t])).Fe=GS.EDGES_LINES_TYPE,n.m0=void 0!==t.lineType?t.lineType:HS.TOP,n.g1=void 0!==t.lineAlpha?t.lineAlpha:1,n.q0=void 0!==t.lineColor?t.lineColor:"#FF0000",n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&ZS(n,e),n=i,(e=[{key:"lineColor",get:function(){return this.q0},set:function(t){this.q0!==t&&(this.q0=t,this.Bh())}},{key:"lineAlpha",get:function(){return this.g1},set:function(t){this.g1!==t&&(this.g1=t,this.Bh())}}])&&VS(n.prototype,e),t&&VS(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),qS=(Object.assign(U2.prototype,{H0:function(t){var t=new XS(t),n=this.qi(g);if(!n)return!1;var n=n.fi,e=this.qi(v),n=n.Br.$u(this.q0,this.g1*e.ht);this.xi=new Ov(t,n),this.th=!0},Bh:function(){var t,n=this.qi(g);n&&(t=this.qi(v),this.xi.material=n.fi.Br.$u(this.q0,this.g1*t.ht))}}),U2);function KS(t){return(KS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function JS(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=KS(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=KS(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==KS(t)?t:String(t)}(i.key),i)}}function $S(t,n,e){n=iT(n);var i=t,n=tT()?Reflect.construct(n,e||[],iT(t).constructor):n.apply(t,e);if(n&&("object"===KS(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return nT(i)}function tT(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(tT=function(){return!!t})()}function nT(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function eT(){return(eT="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=iT(t)););return t}(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function iT(t){return(iT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function rT(t,n){return(rT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}e=function(){var t,n=i,e=xg;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");if((n=$S(this,i,[t])).Fe=S.EXTRUDE_MARKER,n.ht=void 0!==t.opacity?t.opacity:1,n.Sd=void 0!==t.color?t.color:"#FF0000",n.w1=void 0!==t.extrudeHeight?t.extrudeHeight:1,n.p0=n.w1,n.Kf=void 0!==t.points?Object.assign(t.points):[],Array.isArray(n.Kf[0]))for(var e=0;e<n.Kf.length;e++)n.Kf[e].constructor===Array&&(Jp.polygonArea(n.Kf[e])<0&&n.Kf[e].reverse(),Jp.closedPoints(n.Kf[e]));else n.Kf.constructor===Array&&(Jp.polygonArea(n.Kf)<0&&n.Kf.reverse(),Jp.closedPoints(n.Kf));return n._1=new qS({lineType:t.edgeMode,lineColor:void 0!==t.edgeColor?t.edgeColor:n.Sd,lineAlpha:void 0!==t.edgeOpacity?t.edgeOpacity:n.ht}),n._1.Ht=nT(n),n}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&rT(n,e),n=i,(e=[{key:"x",get:function(){return this._t}},{key:"y",get:function(){return this.Et}},{key:"color",get:function(){return this.Sd},set:function(t){this.Sd!==t&&(this.Sd=t,this.E1())}},{key:"opacity",get:function(){return this.ht},set:function(t){this.ht!==t&&(this.ht=t,this.E1())}},{key:"edgeColor",get:function(){return this._1.q0},set:function(t){this._1.lineColor=t}},{key:"edgeOpacity",get:function(){return this._1.g1},set:function(t){this._1.lineAlpha=t}},{key:"extrudeHeight",get:function(){return this.w1},set:function(t){this.w1!==t&&(this.w1=t,this.xi.scale.setZ(this.w1/this.p0))}},{key:"points",get:function(){return this.Kf},set:function(t){this.Kf=t,this.Kf.constructor===Array&&(Jp.polygonArea(this.Kf)<0&&this.Kf.reverse(),Jp.closedPoints(this.Kf)),this.xi&&(t=this.qi(g))&&(this.xi.parent.remove(this.xi),this.xi.traverse(function(t){t instanceof ba&&(t.geometry.dispose(),t.material=void 0,t.geometry=void 0)}),this.xi.mapNode=void 0,this.xi=void 0,this.wc(),this.parent.scene.add(this.xi),t.enableUpdateRender())}},{key:"dispose",value:function(){this._1&&this._1.dispose(),eT(iT(i.prototype),"dispose",this).call(this)}},{key:"getRenderNode",value:function(){return this.xi}},{key:"setType",value:function(t){this.Fe=t}}])&&JS(n.prototype,e),t&&JS(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),Object.assign(e.prototype,{wc:function(){var t,n,e,i,r,o=this.qi(g);return!!o&&(t=o.fi,n=this.qi(v),e=new Mt(o.x,o.y),r=bS.createShape(this.Kf,e),i={depth:this.p0},S1(r=bS.createExtrudeBufferGeometry(r,i),t.Br.$u(this.Sd,this.ht*n.ht),this),this.xi.position.set(0,this.nt,0),this._1.m0===HS.TOP?this.S1(e):this._1.m0===HS.ALL&&this.hp(r),this.th=!0,o.enableUpdateRender(),this.th)},S1:function(t){t=new zp(bS.createShape(this.Kf,t));this.hp(t),this._1.xi.position.setZ(this.p0),t.dispose()},hp:function(t){this._1.H0(t),this.xi.add(this._1.xi)},E1:function(){var t,n=this.qi(g);n&&(t=this.qi(v),this.xi.material=n.fi.Br.$u(this.Sd,this.ht*t.ht),n.enableUpdateRender())},Bh:function(){this.E1(),this._1.Bh()},Bv:function(){this.xi.position.set(0,this.nt,0),this.qi(g).enableUpdateRender()}}),Z_=e;function oT(t){return(oT="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function sT(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,hT(i.key),i)}}function aT(t,n,e){n=vT(n);var i=t,n=uT()?Reflect.construct(n,e||[],vT(t).constructor):n.apply(t,e);if(n&&("object"===oT(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return cT(i)}function uT(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(uT=function(){return!!t})()}function cT(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function fT(t,n,e,i){return(fT="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,n,e,i){var r,t=dT(t,n);if(t){if((r=Object.getOwnPropertyDescriptor(t,n)).set)return r.set.call(i,e),!0;if(!r.writable)return!1}if(r=Object.getOwnPropertyDescriptor(i,n)){if(!r.writable)return!1;r.value=e,Object.defineProperty(i,n,r)}else t=i,r=e,!((i=hT(i=n))in t?Object.defineProperty(t,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[i]=r);return!0})(t,n,e,i)}function hT(t){t=function(t,n){if("object"!=oT(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=oT(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==oT(t)?t:String(t)}function lT(){return(lT="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=dT(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function dT(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=vT(t)););return t}function vT(t){return(vT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pT(t,n){return(pT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}F_=function(){var t,n=s,e=xg;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function s(t,n){var e;if(this instanceof s)return(e=aT(this,s,[n=n||{}])).Fe=S.HEAT_MAP_MARKER,e.Lt=t,e.Ty=n.backgroundColor,e.ht=n.opacity,e.d0=void 0!==n.radius?n.radius:30,e.T1=void 0!==n.valueRange?void 0!==n.valueRange.max?void 0!==n.valueRange.min?n.valueRange:{max:n.valueRange.max,min:0}:void 0!==n.valueRange.min?{max:100,min:n.valueRange.min}:{max:100,min:0}:{max:100,min:0},e.T1.min>=e.T1.max&&(e.T1={max:100,min:0}),e.A1=void 0!==n.quality?n.quality:1024,e.oh=void 0===n.isPlane||n.isPlane,e.M1=e.oh,e.j0=void 0!==n.gradient?n.gradient:{.45:"rgb(0,0,255)",.55:"rgb(0,255,255)",.65:"rgb(0,255,0)",.95:"yellow",1:"rgb(255,0,0)"},e.lt=n.maxOpacity,void 0===e.lt&&(e.lt=1),void 0!==e.ht&&(e.lt=e.ht),e.dt=n.minOpacity,void 0===e.dt&&(e.dt=0),e.ft=n.blur,void 0===e.ft&&(e.ft=.85),e.O1=n.scaleRadius,void 0===e.O1&&(e.O1=!0),e.nt=n.height,void 0===e.nt&&(e.nt=1),e.oh||(e.O1=!0),e.Kf=[],e.L1=null,e.G=null,e.R1=null,e.N1=0,e.n1=null,e.ah=null,e.P1=void 0,e.j1=null,e.F1=null,e.I1=null,e.C1=null,e.D1=null,e.U1=null,e.B1=e.B1.bind(cT(e)),e.H1=11,e.X1=22,e.z1=null,e;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&pT(n,e),n=s,(e=[{key:"bound",get:function(){var t,n;return!0===this.needUpdateBound&&null!==this.n1&&(this.xe.reset(),t=this.n1.getLayers(S.MODEL_LAYER)[0],!1===this.oh?(n=this.n1.getLayers(S.EXTENT_LAYER)[0],t&&this.xe.expand(t.bound),n&&this.xe.expand(n.bound)):t&&this.xe.expand(t.bound),this.needUpdateBound=!1),this.xe.clone()}},{key:"x",get:function(){return this._t}},{key:"y",get:function(){return this.Et}},{key:"height",get:function(){return this.nt},set:function(t){this.M1&&(this.nt=t,this.Bv())}},{key:"opacity",get:function(){return this.ht},set:function(t){this.ht=t,this.lt=this.ht,this.j1&&this.j1.configure({radius:this.d0,valueRange:this.T1,maxOpacity:this.lt,minOpacity:this.dt,gradient:this.j0,blur:this.ft})}},{key:"valueRange",get:function(){return this.T1},set:function(t){void 0!==t.max&&(this.T1.max=t.max),void 0!==t.min&&(this.T1.min=t.min),this.T1.min>=this.T1.max&&(this.T1={max:100,min:0})}},{key:"level",get:function(){return this.n1.level}},{key:"visible",get:function(){return lT(vT(s.prototype),"visible",this)},set:function(t){if(this.Qi!==t){var n=vT(s.prototype),e=t,i=!0;if(!fT(n,"visible",e,this||n)&&i)throw new TypeError("failed to set property");this.oh?this.Qi&&this.V1()&&(this.Kf.length=0,this.W1(),this.update()):(t?this.Ht.sh(this.ah):this.Ht.sh(null),this.Lt.enableUpdateRender())}}},{key:"simulate",value:function(t){this.N1=t}},{key:"clearDataSource",value:function(){this.G=null,this.Kf=[]}},{key:"addPoint",value:function(t,n,e){var i;t&&n&&e&&(i=this.n1.getLayers(S.EXTENT_LAYER)[0].bound,t=this.Y1(t,n,i))&&(t.x=Math.round(t.x),t.y=Math.round(t.y),t.value=e,t.radius=this.d0,this.Kf.push(t))}},{key:"addDataSource",value:function(t){this.G=t,this.Kf=[]}},{key:"update",value:function(){var t;0===this.Kf.length&&null!=this.G&&(t=(t=this.n1.getExtendByCoords(this.G[0]))||this.n1.getLayers(S.EXTENT_LAYER)[0],this.O1?this.Q1(t.bound):this.W1()),st.a.environment===G.a.WX&&(this.R1.width=this.L1.width,this.R1.height=this.L1.height),this.j1.setData({max:this.T1.max,min:this.T1.min,data:this.Kf}),this.Z1(),this.oh?this.O1?(t=this.xi.material.map,this.xi.material.map=this.ah,this.xi.material.map.needsUpdate=!0,this.xi.material.needsUpdate=!0,t.dispose()):this.q1():this.Ht.sh(this.ah),this.Lt.enableUpdateRender()}},{key:"addTo",value:function(t){this.n1=t;var n=null;if(null===this.G)n=this.n1.getLayers(S.EXTENT_LAYER)[0].It[0];else{for(var e=[],i=(n=(n=this.n1.getExtendByCoords(this.G[0]))||this.n1.getLayers(S.EXTENT_LAYER)[0].It[0]).G.Ie[0],r=0;r<this.G.length;r++)W.Un(this.G[r],i,i.length)&&e.push(this.G[r]);this.G=e}var o=n.bound,o=(this.F1=n.bound,this.I1=n,st.a.environment===G.a.WX?this.R1=K2.textureCanvas[0]:this.R1=document.createElement("canvas"),0!=this.N1&&this.K1(this.N1),null!=this.G&&(this.O1?(this.L1=this.J1(o),this.R1.width=this.L1.width,this.R1.height=this.L1.height,this.Q1(o)):(n=this.tb(),this.nb(n),this.U1=this.J1(this.C1),st.a.environment===G.a.WX?this.D1=K2.textureCanvas[0]:this.D1=document.createElement("canvas"),this.D1.width=this.U1.width,this.D1.height=this.U1.height,this.Q1(this.C1,n))),{radius:this.d0,valueRange:this.T1,maxOpacity:this.lt,minOpacity:this.dt,gradient:this.j0,blur:this.ft});this.O1?o.canvas=this.R1:o.canvas=this.D1,this.j1=st.a.heatmap.create(o),null!==this.G&&this.j1.setData({max:this.T1.max,min:this.T1.min,data:this.Kf}),lT(vT(s.prototype),"addTo",this).call(this,t),this.needUpdateBound=!0}},{key:"remove",value:function(){this.O1||(this.Lt.off("zoom",this.B1),this.Lt.off("levelChanged",this.B1),this.Lt.off("visibleLevelsLoaded",this.B1),this.Lt.off("move",this.B1),this.Lt.off("viewChanged",this.B1),this.Lt.off("resize",this.B1)),lT(vT(s.prototype),"remove",this).call(this)}},{key:"dispose",value:function(){lT(vT(s.prototype),"dispose",this).call(this),this.n1=null,this.ah&&this.ah.dispose(),this.ah=null}}])&&sT(n.prototype,e),t&&sT(n,t),Object.defineProperty(n,"prototype",{writable:!1}),s}(),Object.assign(F_.prototype,{Z1:function(){var t,n,e=this;st.a.environment===G.a.WX?(this.O1||this.eb(),t=this.R1.toDataURL("image/png"),this.ah?this.image&&(this.image.crossOrigin="Anonymous",this.image.onload=function(){e.ah.image=e.image,e.xi.material.map=e.ah,e.xi.material.map.needsUpdate=!0,e.xi.material.needsUpdate=!0,e.Lt.enableUpdateRender()},this.image.src=t):(n=new l,(this.ah=n).minFilter=Vn,st.a.textureHelper.createImage({url:t,onload:function(t){e.ah.image=t,e.ah.needsUpdate=!0,e.image=t,e.xi.material.map=e.ah,e.xi.material.map.needsUpdate=!0,e.xi.material.needsUpdate=!0,e.Lt.enableUpdateRender()}}))):(this.O1||this.eb(),this.ah=new l(this.ib(this.R1)))},rb:function(){var t=new ta(16777215);return t.opacity=1,t.transparent=!0,t.map=this.ah,t.map&&(t.map.needsUpdate=!0),t.depthTest=!1,t.needsUpdate=!0,t},wc:function(){if(!this.th){var t,n,e=(null!==this.G&&this.n1.getExtendByCoords(this.G[0])||this.n1.getLayers(S.EXTENT_LAYER)[0].It[0]).xi;if(e)if(this.ah=null,this.Z1(),this.oh)this.O1?(t=e.userData,e.userData={},n=e.clone(),e.userData=t,n.name="heatMap",n.scale.z=.001,n.position.y+=this.nt,e=this.rb(),n.material=e,this.xi=n,this.xi.mapNode=this):this.q1(),this.th=!0;else{this.th=!0;for(var i=this.n1.getModelMeshs(),r=0;r<i.length;r++)if(i[r]){this.th=!0;break}}this.qi(g).enableUpdateRender(),this.O1||(this.Lt.on("zoom",this.B1),this.Lt.on("levelChanged",this.B1),this.Lt.on("visibleLevelsLoaded",this.B1),this.Lt.on("move",this.B1),this.Lt.on("viewChanged",this.B1),this.Lt.on("resize",this.B1))}return this.th},eb:function(){var t,n,e;this.oh?this.R1=this.D1:(this.L1=this.J1(this.F1),n=this.L1.width,e=this.L1.height,this.R1.width=n,this.R1.height=e,(t=this.R1.getContext("2d")).clearRect(0,0,n,e),n=(this.C1.min.x-this.F1.min.x)/(this.F1.max.x-this.F1.min.x)*n,e=(this.F1.max.y-this.C1.max.y)/(this.F1.max.y-this.F1.min.y)*e,t.drawImage(this.D1,n,e,+this.D1.width,+this.D1.height))},Bv:function(){this.xi.position.y=this.nt,this.qi(g).enableUpdateRender()},Y1:function(t,n,e){t={x:(t-e.min.x)/(e.max.x-e.min.x),y:(e.max.y-n)/(e.max.y-e.min.y)};return this.O1?(t.x=t.x*this.L1.width,t.y=t.y*this.L1.height):(t.x=t.x*this.U1.width,t.y=t.y*this.U1.height),t},ob:function(){var t,n;return st.a.environment===G.a.WX?[t=st.a.window.screenWidth/2.54,t]:(t=[],void 0!==window.screen.deviceXDPI?(t[0]=window.screen.deviceXDPI,t[1]=window.screen.deviceYDPI):((n=document.createElement("DIV")).style.cssText="width:1in;height:1in;position:absolute;left:0px;top:0px;z-index:99;visibility:hidden",document.body.appendChild(n),t[0]=parseInt(n.offsetWidth),t[1]=parseInt(n.offsetHeight),n.parentNode.removeChild(n)),t)},J1:function(t){var n,e=t.max.x-t.min.x,t=t.max.y-t.min.y,i=null;return this.O1?(i={width:Math.round(e),height:Math.round(t)},n=this.ob(),i.width=parseInt(i.width*n[0]/25.4),i.height=parseInt(i.height*n[1]/25.4),n=1,(i.width>=this.A1||i.height>=this.A1)&&(i.width>=i.height?(n=i.height/i.width,i.width=this.A1,i.height=parseInt(this.A1*n)):(n=i.width/i.height,i.height=this.A1,i.width=parseInt(this.A1*n)))):(n=this.sb(),i={width:Math.round(e/n),height:Math.round(t/n)}),i},ib:function(t){var n=Tt.floorPowerOfTwo(t.width),e=Tt.floorPowerOfTwo(t.height),i=(this.O1||(e<n?4096<n&&(i=n/4096,n=4096,e/=i):4096<e&&(i=e/4096,e=4096,n/=i)),void 0===this.P1&&(this.P1=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),this.P1.width=n,this.P1.height=e,this.P1.getContext("2d"));return void 0!==this.Ty&&(i.fillStyle=this.Ty,i.fillRect(0,0,n,e)),i.drawImage(t,0,0,n,e),this.P1},Q1:function(t,n){for(var e=null,e=n||this.G,i=0;i<e.length;i++){var r,o=this.Y1(e[i].x,e[i].y,t);if(!o)return!0;o.x=Math.round(o.x),o.y=Math.round(o.y),o.value=e[i].value,this.O1?(r=this.L1.width/this.F1.size.x,o.radius=this.d0*r):o.radius=this.d0,this.Kf.push(o)}},K1:function(t){this.G=[];for(var n=this.I1.G.Ie[0];this.G.length<t;){var e=Math.floor(this.F1.min.x+Math.random()*this.F1.size.x+1),i=Math.floor(this.F1.min.y+Math.random()*this.F1.size.y+1),r=this.T1.min+Math.floor(Math.random()*(this.T1.max-this.T1.min)+1);W.Un({x:e,y:i},n,n.length)&&this.G.push({x:e,y:i,value:r})}},B1:function(){this.th&&null!==this.G&&this.Qi&&this.V1()&&(this.Kf.length=0,this.W1(),this.update())},V1:function(){for(var t=!1,n=Array.from(this.Lt.getRenderManager().getRenderList().keys()),e=this.n1.parent,i=0;i<n.length;i++){var r=n[i].split("%A%B%C%D");if(""+r[0]==""+e.buildingID&&""+r[1]==""+this.n1.level){t=!0;break}}return t},W1:function(){var t=this.tb();this.nb(t),this.U1=this.J1(this.C1),this.Q1(this.C1,t),this.j1.gt.setDimensions(this.U1.width,this.U1.height)},nb:function(t){this.C1=new Ur;for(var n=null,e=null,i=null,r=null,o=this.sb()*this.d0,s=0;s<t.length;s++)(null===n||n>t[s].x)&&(n=t[s].x),(null===e||e>t[s].y)&&(e=t[s].y),(null===i||i<t[s].x)&&(i=t[s].x),(null===r||r<t[s].y)&&(r=t[s].y);this.C1.expandByCoords([{x:n-o,y:e-o},{x:n-o,y:r+o},{x:i+o,y:r+o},{x:i+o,y:e-o}])},tb:function(){for(var t=[],n=this.G,e=this.sb()*this.d0,i=0;i<n.length;i++)for(var r=uy.circleBuilder(e,n[i],32),o=0;o<r.length;o++)if(this.ab(r[o])){t.push(n[i]);break}return t},ab:function(t){var t=new xt(t.x-this.Lt.x,this.n1.height,this.Lt.y-t.y),n=this.Lt.camera,t=t.applyMatrix4(n.matrixWorldInverse).applyMatrix4(n.projectionMatrix);return!(1<Math.abs(t.x)||1<Math.abs(t.y)||1<Math.abs(t.z))},sb:function(){var t={x:st.a.document.body.clientWidth/2,y:st.a.document.body.clientHeight/2,z:this.n1.height+this.nt,buildingID:this.n1.parent.buildingID},n={x:t.x+1,y:t.y,z:this.n1.height+this.nt,buildingID:this.n1.parent.buildingID},t=Oi.coordsScreenToMap(this.Lt,t),n=Oi.coordsScreenToMap(this.Lt,n),t=Math.sqrt((t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y));return this.Lt.getZoom()<this.H1?76.43745851702988:t},q1:function(t){this.xi&&this.xi.parent&&(this.xi.parent.remove(this.xi),null!=(n=this.xi.material.map)&&n.dispose(),this.xi.geometry.dispose(),this.xi.geometry=void 0,this.xi.material.dispose(),this.xi.material=void 0,this.xi=void 0);var n=!1;t||(t=this.C1,n=!0);var e=new ba(new Fs(t.size.x,t.size.y,1,1),void 0),t=(e.name="heatMap",e.position.y=this.nt,e.position.x=t.center.x-this.Lt.x,e.position.z=-t.center.y+this.Lt.y,e.rotation.set(-Math.PI/2,0,0,"XYZ"),this.rb());null!==this.z1&&(t.clippingPlanes=this.z1,t.clipping=!0),e.material=t,this.xi=e,this.xi.mapNode=this,n&&this.Ht.scene.add(this.xi)},ub:function(t){for(var n=[],e=[],i=0;i<t.length;i++)n.push({x:t[i].x,y:t[i].y});W.isClockwise(n[0],n[1],n[2])||(n=n.reverse());for(var r=0;r<n.length-1;r++){var o=n[r],s=n[r+1],a=(o.x+s.x)/2-this.Lt.x,u=-(o.y+s.y)/2+this.Lt.y,o=W.getAngle({p1:o,p2:s}),s=(s=o,o={x:a,y:0,z:u},a=this,u=void 0,u=new ba(new Fs(200,200,1,1),new ta({color:"#38382f",side:2})),void 0!==s&&(u.rotation.y=s),u.position.set(o.x,o.y,o.z),a.parent.xo.add(u),u),o=new Gt,a=new xt,u=new xt;a.set(0,0,1).applyQuaternion(s.quaternion),u.copy(s.position),o.setFromNormalAndCoplanarPoint(a,u),e.push(o),s.parent.remove(s)}return e}}),i2=F_;function mT(t){return(mT="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yT(t,n){var e,i,r,o,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return i=!(e=!0),{s:function(){s=s.call(t)},n:function(){var t=s.next();return e=t.done,t},e:function(t){i=!0,r=t},f:function(){try{e||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(t)||(s=function(t,n){var e;if(t)return"string"==typeof t?bT(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?bT(t,n):void 0}(t))||n&&t&&"number"==typeof t.length)return s&&(t=s),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function bT(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function gT(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=mT(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=mT(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==mT(t)?t:String(t)}(i.key),i)}}function wT(t,n,e){n=TT(n);var i=t,n=_T()?Reflect.construct(n,e||[],TT(t).constructor):n.apply(t,e);if(n&&("object"===mT(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return ET(i)}function _T(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_T=function(){return!!t})()}function ET(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ST(){return(ST="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,n,e){var i=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=TT(t)););return t}(t,n);if(i)return(i=Object.getOwnPropertyDescriptor(i,n)).get?i.get.call(arguments.length<3?t:e):i.value}).apply(this,arguments)}function TT(t){return(TT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function xT(t,n){return(xT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}f2=function(){var t,n=i,e=WE;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(this instanceof i)return(n=wT(this,i,[t])).Fe=S.DYNAMIC_MODEL_MARKER,n.je=void 0!==t.id?t.id:Tt.generateUUID(),n.cb=Tt.generateUUID(),n.Md=void 0!==t.fadeIn&&t.fadeIn,n.Th=void 0!==t.fadeOut&&t.fadeOut,n.ht=void 0!==t.opacity?t.opacity:null,n.fb=void 0!==t.scale?t.scale:1,n.hb=t.tilt,n.Fh=t.url,n.nv=t.heading,n.Jt=t.callback,n.lb=new Map,n.lb.set(n.ROOT,t.color),n.Hh=null,n.Ml=[],n.Rd=null,n.Nd=null,n.Wv=null,n.ar=null,n.xd=n.xd.bind(ET(n)),n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&xT(n,e),n=i,(e=[{key:"FID",get:function(){return this.cb}},{key:"color",get:function(){return this.getModelColor()},set:function(t){this.modifyModelColor(t)}},{key:"scale",get:function(){return this.fb},set:function(t){this.fb=t,this.Io()}},{key:"tilt",get:function(){return this.hb}},{key:"heading",get:function(){return this.nv}},{key:"opacity",get:function(){return this.ht},set:function(t){this.ht=t,this.Bh()}},{key:"addTo",value:function(t){ST(TT(i.prototype),"addTo",this).call(this,t),this.ar=t.level,this.Wv=t.parent.buildingID,t.parent instanceof $m&&(this.Wv=null)}},{key:"moveTo",value:function(t){if(t.buildingID&&this.Wv!==t.buildingID){this.Wv=t.buildingID,this.ar=t.level;var n=this.qi(g);if(!n)return!1;if(!this.xi)return!1;this.remove();n=this.ci(n);this.addTo(n)}else t.level&&this.vb(t.level);return ST(TT(i.prototype),"moveTo",this).call(this,t)}},{key:"modifyModelColor",value:function(t,n){n=n||this.ROOT,this.lb.set(n,t),this.Bh()}},{key:"getModelColor",value:function(t){return t=t||this.ROOT,this.lb.get(t)}},{key:"rotateTo",value:function(t){var n,e,i,r,o,s=this,a=this.qi(g);return!!a&&(i=t.heading%360*f.DEG2RAD,this.pb=t.heading,this.xi?(n=this.xi.rotation.y,e=n+(o=i-n!=(o=0)?Math.sin(i-n)/Math.abs(Math.sin(i-n))*Math.acos(Math.cos(i-n)):o),t.animate?(i=t.duration||.5,this.Ue.has("rotation")?r=this.Ue.get("rotation"):(r=new Wi,this.Ue.set("rotation",r)),o=this.nv,r.en([n,o]).rn([e,t.heading]).sn(i).un(function(t){s.xi.rotation.y=t.destination[0],s.nv=t.destination[1],a.enableUpdateRender()}).cn(function(){s.xi.rotation.y=e,s.nv=t.heading,a.enableUpdateRender(),t.finish&&t.finish()}),a.Oi.Ti(r.tn())):(this.xi.rotation.y=e,this.nv=t.heading,a.enableUpdateRender(),t.finish&&t.finish()),this.Ue.get("rotation")):void 0)}},{key:"startAction",value:function(t,n){var e=this.Ml[t],n=(e&&(n&&(e.clampWhenFinished=!0,e.loop=2200),this.Rd&&this.Rd===t?(e.time=this.Nd,e.paused=!1,e.play(),this.Rd=null,this.Nd=null):(this.Rd!==t&&(this.Rd=null,this.Nd=null),e.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).play())),this.qi(g));n&&n.on("beforeRender",this.xd)}},{key:"getAction",value:function(){return this.Ml}},{key:"getClip",value:function(t){return this.Ml[t].Xh}},{key:"getMixer",value:function(){return this.Hh}},{key:"stopAction",value:function(t){var n=this.qi(g),n=(n&&n.off("beforeRender",this.xd),this.Ml[t]);n&&(n.paused=!0,this.Rd=t,this.Nd=n.time)}},{key:"getActionNames",value:function(){return Object.keys(this.Ml)}},{key:"remove",value:function(){this.stop(),this.xi&&this.xi.bloom&&this.xi.bloom.remove(this);var t,n=this.qi(g);n&&this.Hh&&n.Oi.Jd(this.Hh),n&&(t=this.lb.get(this.ROOT),this.mb(this.xi,t,function(t){n.fi.Br.Iu(t,t.material)})),ST(TT(i.prototype),"remove",this).call(this)}},{key:"dispose",value:function(){ST(TT(i.prototype),"dispose",this).call(this),this.remove(),this.xi&&(this.xi.mapNode=void 0,this.xi=void 0),this.th=!1,this.yb()}},{key:"getRenderNode",value:function(){return this.xi}}])&&gT(n.prototype,e),t&&gT(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),Object.assign(f2.prototype,{ROOT:"root",vb:function(t){this.ar!==t&&(this.ar=t,t=this.qi(g))&&(this.remove(),t=this.ci(t),this.addTo(t))},ci:function(t){return(this.Wv?t.getBuilding(this.Wv):t).getFloor(this.ar)},wc:function(){var r=this;if(!this.th){var o=this.qi(g);if(!o)return!1;this.th=!0;var t,s,n=this.Fh.split("."),a=n[n.length-1].toLocaleLowerCase(),n=(this.fileExtension=a,{gltf:{},glb:{},fbx:null==(n=st.a.window.fengmap)?void 0:n.FBXLoader});if(n[a])return n=("glb"===a||"gltf"===a?(t=o.fi.Wp).Na:(t=new n[a]).load).bind(t),(s={glb:function(t){return t.scene},fbx:function(t){return t}}).gltf=s.glb,n(this.Fh,function(t){if(r.th){if(r.xi=s[a](t),r.xi.visible=r.Qi,r.nv&&(r.xi.rotation.y=r.nv%360*f.DEG2RAD),r.hb&&(r.xi.rotation.x=r.hb%360*f.DEG2RAD),r.Io(),(r.xi.mapNode=r).Ht.xo.add(r.xi),0<t.animations.length){r.Hh=new Sb(r.xi);var n,e=yT(t.animations);try{for(e.s();!(n=e.n()).done;){var i=n.value;r.Ml[i.name]=r.Hh.clipAction(i)}}catch(t){e.e(t)}finally{e.f()}o.Oi.Yd(r.Hh)}r.Bh(),r.Bv(),r.Md&&r.xh({src:[0],dest:[1],duration:1}),o.enableUpdateRender(),r.Jt&&r.Jt(r)}},null,function(t){console.error(t)}),!0;console.error(" ".concat(a))}},xh:function(t){var n,i=this,r=this.qi(g);r&&(n=new Wi({src:t.src||[0],dest:t.dest||[1]}),this.Ue.set("faceIn",n),n.sn(t.duration||1).un(function(t){var e=t.destination[0];i.xi.traverse(function(t){var n;"Mesh"===t.type&&("glb"===i.fileExtension||"gltf"===i.fileExtension?(t.material.transparent=!0,n=t.material.userData.sourceOpacity,t.material.opacity=n*e,r.enableUpdateRender()):Array.isArray(t.material)?(t.material.forEach(function(t){var n=t.userData.sourceOpacity;t.transparent=!0,t.opacity=n*e}),r.enableUpdateRender()):(n=t.material.userData.sourceOpacity,t.material.transparent=!0,t.material.opacity=n*e))})}).cn(function(){t.callback&&t.callback(),r.Oi.ji(n),r.enableUpdateNode()}).tn(),r.Oi.Ti(n))},Io:function(){if(this.xi){var t=this.qi(g);if(!t)return!1;var n=null!=(n=this.xi)&&null!=(n=n.userData)&&n.sourceScale?null==(n=this.xi)||null==(n=n.userData)?void 0:n.sourceScale:new ey(1,1,1);this.xi.scale.copy(n).multiplyScalar(this.fb),t.enableUpdateRender()}},bb:function(t){void 0===t.userData.sourceOpacity&&(t.userData.sourceOpacity=t.opacity),void 0===t.userData.sourceTransparent&&(t.userData.sourceTransparent=t.transparent)},gb:function(t,n){n=null!==this.ht?this.ht*n.ht:void 0!==t.userData.sourceOpacity?t.userData.sourceOpacity*n.ht:t.opacity*n.ht;return{opacity:n,transparent:t.userData.sourceTransparent||n<1}},Bh:function(){var c,f,t,h=this;this.xi&&(c=this.qi(g),f=this.qi(v),t=this.lb.get(this.ROOT),this.mb(this.xi,t,function(t,n){var e={color:n},i=h.Dr(t.material,f,e);if("glb"===h.fileExtension||"gltf"===h.fileExtension)if(Array.isArray(t.material.length))for(var r=0;r<t.material.length;r++)t.material[r].depthWrite=!0,t.material[r]=c.fi.Br.Gr(t.material[r],i);else t.material.depthWrite=!0,t.material=c.fi.Br.Gr(t.material,i);else if(Array.isArray(t.material))for(var o=0;o<t.material.length;o++){h.bb(t.material[o]),t.material[o].depthWrite=!0;var s=h.gb(t.material[o],f),a=s.opacity,s=s.transparent;t.material[o].color=new lt(e.color||16777215),t.material[o].opacity=a,t.material[o].transparent=s}else{h.bb(t.material),t.material.depthWrite=!0;var n=h.gb(t.material,f),u=n.opacity,n=n.transparent;t.material.color=new lt(e.color||16777215),t.material.opacity=u,t.material.transparent=n}}),c.enableUpdateRender())},mb:function(t,n,e){var i=this.lb.get(t.name);if(i&&(n=i),"Mesh"===t.type||"SkinnedMesh"===t.type)e(t,n);else for(var r=0;r<t.children.length;r++)this.mb(t.children[r],n,e)},Dr:function(t,n,e){var i;if("glb"===this.fileExtension||"gltf"===this.fileExtension)return i={},void 0===t.userData.sourceOpacity&&(t.userData.sourceOpacity=t.opacity),void 0===t.userData.sourceTransparent&&(t.userData.sourceTransparent=t.transparent),e.color&&(i.color=e.color),i.opacity=null!==this.ht?this.ht*n.ht:void 0!==t.userData.sourceOpacity?t.userData.sourceOpacity*n.ht:t.opacity*n.ht,i.transparent=t.userData.sourceTransparent||i.opacity<1,i},xd:function(){var t=this.qi(g);t&&t.enableUpdateRender()},wb:function(t){if(t._interpolant&&(t._interpolant.length=0),t.Wh){for(var n=0;n<t.Wh.length;n++)t.Wh[n].parameterPositions=null,t.Wh[n].resultBuffer=null,t.Wh[n].sampleValues=null,t.Wh[n]=null;t.Wh=null}if(t.Yh){for(var e=0;e<t.Yh.length;e++)t.Yh[e].binding=null,t.Yh[e].buffer=null,t.Yh[e]=null;t.Yh=null}if(t.Xh&&t.Xh.tracks&&t.Xh.tracks){for(var i=0;i<t.Xh.tracks.length;i++)t.Xh.tracks[i].times=null,t.Xh.tracks[i].values=null,t.Xh.tracks[i]=null;t.Xh.tracks=null,t.Xh=null}},yb:function(){for(var t in this.Ml)this.wb(this.Ml[t]),this.Ml[t]=null;if(this.Ml=[],this.Hh){for(var n=0;n<this.Hh.sf.length;n++)this.Hh.sf[n].buffer=null;this.Hh.sf=null,this.Hh.gl=null,this.Hh.hs=null,this.Hh.stats=null,this.Hh._l=null,this.Hh.Ml=null,this.Hh=null}}}),n=f2;function AT(t){return(AT="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function MT(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=AT(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=AT(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==AT(t)?t:String(t)}(i.key),i)}}function OT(t,n,e){n=RT(n);var i=t,n=LT()?Reflect.construct(n,e||[],RT(t).constructor):n.apply(t,e);if(n&&("object"===AT(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return NT(i)}function LT(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(LT=function(){return!!t})()}function RT(t){return(RT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function NT(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function PT(t,n){return(PT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}var Bv=function(){var t,n=i,e=WE;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function i(t){var n;if(this instanceof i)return(n=OT(this,i,[t])).je=null,n.Fe=S.DOM_MARKER,n._b=void 0!==t.fontsize?t.fontsize:16,n.Eb=t.content,n.Sb=t.domWidth,n.Tb=t.domHeight,n.xb=t.domWidth,n.Ab=t.domHeight,n.f1=void 0!==t.anchor?t.anchor:Ni.CENTER,n.ht=void 0!==t.opacity?t.opacity:1,n.Yo=void 0!==t.collision&&t.collision,n.Iy=!1,n.xi=null,n.th=!1,n.ar=null,n.Wv=null,n.n1=null,n.Mb=null,n.Ob=n.Ob.bind(NT(n)),n.uh=null,n.wc(),n;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&PT(n,e),n=i,(e=[{key:"isInputElement",get:function(){for(var t=["input","textarea"],n=!1,e=0;e<t.length;e++)if(0<=this.xi.element.childNodes[0].innerHTML.toLocaleLowerCase().indexOf(t[e])){n=!0;break}return n}},{key:"content",get:function(){return this.Eb},set:function(t){this.Eb=t,"string"==typeof this.Eb?this.xi.element.childNodes[0].innerHTML=""+this.Eb:this.xi.element.childNodes[0].appendChild(this.Eb),void 0!==this.xb&&void 0!==this.Ab||this.Py()}},{key:"visible",get:function(){return this.Qi},set:function(t){this.Qi=t,this.xi&&(this.Qi?this.xi.element.childNodes[0].style.display="block":this.xi.element.childNodes[0].style.display="none")}},{key:"opacity",get:function(){return this.ht},set:function(t){this.ht=t,this.xi.element.childNodes[0].style.opacity=this.ht}},{key:"level",get:function(){return this.ar}},{key:"remove",value:function(){this.stop(),this.isInputElement&&(this.n1.Ht.Ht.getInteracations().controls.enabled=!0),this.uh.remove(this),this.Ht&&this.Ht.remove(this),this.xi.parent.remove(this.xi),this.Ht=void 0}},{key:"addTo",value:function(t){var n,e=t.Ht.Ht,i=(null===e.Yy.gt&&e.Yy.wc(),this.ar=t.level,this.n1=t,this.Wv=t.parent.buildingID,this.xi.position.set(this._t-e.x,t.height+this.nt,-this.Et+e.y),e.getBuilding(""+t.parent.buildingID));t.level!==i.level&&(e.Yy.ad(this.ar,""+t.parent.buildingID)?this.xi.element.childNodes[0].style.opacity=t.ht:this.xi.element.childNodes[0].style.display="none"),e.Yy.add(this),this.uh=t.getOrCreateLayer(this.Fe),this.uh.add(this),this.isInputElement&&(n=null,this.Lb=function(){n=e.getInteracations().controls.enabled,e.getInteracations().controls.enabled=!1,e.getInteracations().controls.resetState()},this.Rb=function(){null!==n&&(e.getInteracations().controls.enabled=n,e.getInteracations().controls.resetState(),n=null)},this.xi.element.childNodes[0].addEventListener("mouseenter",this.Lb),this.xi.element.childNodes[0].addEventListener("mouseleave",this.Rb))}},{key:"dispose",value:function(){this.remove(),this.xi&&(this.isInputElement&&(this.xi.element.childNodes[0].removeEventListener("mouseenter",this.Lb),this.xi.element.childNodes[0].removeEventListener("mouseleave",this.Rb)),this.xi.mapNode=void 0,this.xi=void 0),this.th=!1}},{key:"getRenderNode",value:function(){return this.xi}}])&&MT(n.prototype,e),t&&MT(n,t),Object.defineProperty(n,"prototype",{writable:!1}),i}(),jT=(Object.assign(Bv.prototype,{wc:function(){var t=document.createElement("div"),n=document.createElement("div"),e=(n.style.position="absolute",!(n.style.pointerEvents="all")),i=(void 0===this.Sb||void 0===this.Tb?e=!0:(n.style.width=this.Sb+"px",n.style.height=this.Tb+"px"),n.style.fontSize=this._b+"px",n.style.opacity=this.ht,e||(i=this.Nb(),n.style.top=i.top,n.style.left=i.left),"string"==typeof this.Eb?n.innerHTML=this.Eb:n.appendChild(this.Eb),t.appendChild(n),new bE(t));return this.xi=i,(this.xi.mapNode=this).th=!0,this.je=this.xi.uuid,e&&this.Py(),!0},Py:function(){var e=this,i=null,r=document.createElement("div"),o=this.xi.element.childNodes[0];r.style.position="absolute",void 0===this.xb?r.style.width="fit-content":r.style.width=this.xb+"px",void 0===this.Ab?r.style.height="fit-content":r.style.height=this.Ab+"px",r.style.fontSize=this._b+"px",r.innerHTML=o.innerHTML,document.body.appendChild(r),function t(){{var n;r.parentNode?(null!==i&&clearTimeout(i),n=r.getBoundingClientRect(),e.Sb=n.width,e.Tb=n.height,n=e.Nb(),o.style.width=e.Sb+"px",o.style.height=e.Tb+"px",o.style.top=n.top,o.style.left=n.left,r.parentNode.removeChild(r)):i=setTimeout(t(),1)}}()},Nb:function(){var t,n;switch(this.f1){case Ni.CENTER:t=-this.Sb/2,n=-this.Tb/2;break;case Ni.RIGHT_BOTTOM:t=-this.Sb,n=-this.Tb;break;case Ni.LEFT_BOTTOM:t=0,n=-this.Tb;break;case Ni.RIGHT_TOP:t=-this.Sb,n=0;break;case Ni.LEFT_TOP:n=t=0;break;case Ni.RIGHT:t=-this.Sb,n=-this.Tb/2;break;case Ni.LEFT:t=0,n=-this.Tb/2;break;case Ni.BOTTOM:t=-this.Sb/2,n=-this.Tb;break;case Ni.TOP:t=-this.Sb/2,n=0}return this.Mb={left:t,top:n},{left:t+"px",top:n+"px"}},Fy:function(){var t=this.Ht.Ht;if(!this.Mb)return null;var n=t.camera;this.xi.updateMatrixWorld(!0);var n=(new xt).setFromMatrixPosition(this.xi.matrixWorld).applyMatrix4(n.matrixWorldInverse).applyMatrix4(n.projectionMatrix),e=t.Dt.renderer.domElement.clientWidth,t=t.Dt.renderer.domElement.clientHeight,i=n.x,n=n.y;return{leftTop:new Mt(i-this.Sb/e,n+this.Tb/t),rightDown:new Mt(i+this.Sb/e,n-this.Tb/t)}},Ob:function(t){var n,e=this.Ht.Ht,i={};for(n in t)i[n]=t[n];i.offsetX=t.clientX,i.offsetY=t.clientY,e.yr.Jt(i)},Bh:function(){this.xi.element.childNodes[0].style.opacity=this.n1.ht}}),Bv);function FT(t){return(FT="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function IT(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=FT(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=FT(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==FT(t)?t:String(t)}(i.key),i)}}Dv=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.Pb=t.origon,this.ph=t.target,this.jb=null,this.Fb=null,this.Ib=null,this.Cb=null,this.kb=null,this.Db=null,this.Ub=null,this.Bb=null,this.wc()}var t,e,i;return t=n,(e=[{key:"transform",value:function(t){var n=t.x-this.jb.x,t=t.y-this.jb.y,e=this.Fb.x*n+this.Fb.y*t,n=this.Ib.x*n+this.Ib.y*t,t=e/this.Cb.x,e=n/this.Cb.y,n=t*this.Bb.x,t=e*this.Bb.y;return{x:this.kb.x+this.Db.x*n+this.Ub.x*t,y:this.kb.y+this.Db.y*n+this.Ub.y*t}}}])&&IT(t.prototype,e),i&&IT(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}(),Object.assign(Dv.prototype,{wc:function(){!Array.isArray(this.Pb)||!Array.isArray(this.ph)||this.Pb.length<3||this.ph.length<3||(this.jb=this.Pb[0],this.Fb={x:this.Pb[1].x-this.Pb[0].x,y:this.Pb[1].y-this.Pb[0].y},this.Ib={x:this.Pb[2].x-this.Pb[0].x,y:this.Pb[2].y-this.Pb[0].y},this.Cb={x:W.ie(this.Fb),y:W.ie(this.Ib)},this.kb=this.ph[0],this.Db={x:this.ph[1].x-this.ph[0].x,y:this.ph[1].y-this.ph[0].y},this.Ub={x:this.ph[2].x-this.ph[0].x,y:this.ph[2].y-this.ph[0].y},this.Bb={x:W.ie(this.Db),y:W.ie(this.Ub)},this.Fb.x/=this.Cb.x,this.Fb.y/=this.Cb.x,this.Ib.x/=this.Cb.y,this.Ib.y/=this.Cb.y,this.Db.x/=this.Bb.x,this.Db.y/=this.Bb.x,this.Ub.x/=this.Bb.y,this.Ub.y/=this.Bb.y)}}),Uv=Dv;function CT(t){return(CT="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function kT(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=CT(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=CT(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==CT(t)?t:String(t)}(i.key),i)}}b1=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.Fo=t.size,this.mi=t.rotation,this.Re=t.center}var t,e,i;return t=n,(e=[{key:"min",get:function(){return{x:this.Re.x-this.Fo.x/2,y:this.Re.y-this.Fo.y/2}}},{key:"max",get:function(){return{x:this.Re.x+this.Fo.x/2,y:this.Re.y+this.Fo.y/2}}},{key:"center",get:function(){return{x:this.Re.x,y:this.Re.y}}},{key:"rotation",get:function(){return this.mi}},{key:"size",get:function(){return{x:this.Fo.x,y:this.Fo.y}}},{key:"clone",value:function(){return new n({size:this.Fo,center:this.Re,rotation:this.mi})}},{key:"valid",value:function(){return!(this.min.x>this.max.x||this.min.y>this.max.y)}},{key:"expand",value:function(t){t&&t.valid()&&(t.min.x<this.min.x&&(this.min.x=t.min.x),t.min.y<this.min.y&&(this.min.y=t.min.y),t.max.x>this.max.x&&(this.max.x=t.max.x),t.max.y>this.max.y)&&(this.max.y=t.max.y)}}])&&kT(t.prototype,e),i&&kT(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}();function DT(t){return(DT="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function UT(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=DT(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=DT(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==DT(t)?t:String(t)}(i.key),i)}}var P1=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.Kf=t.points,this.Gb=t.polygons,this.Hb=[],this.Xb=[],this.w1=t.extrudeHeight,this.nt=t.height,this.zb=t.types,void 0===this.zb&&(this.zb=[S.EXTENT_LAYER,S.FACILITY_LAYER,S.LABEL_LAYER,S.MODEL_LAYER,S.EXTERNAL_MODEL_LAYER]),this.Vb=t.showRegion,void 0===this.Vb&&(this.Vb="inside"),this.n1=null,this.Lt=null,this.Wb=null,this.jr=null,this.xe=null,this.Yb=8192,this.Wv=null,this.Kt=this.Kt.bind(this)}var t,e,i;return t=n,(e=[{key:"points",get:function(){return this.Kf},set:function(t){this.Gb=void 0,this.Kf=t,this.remove(),this.addTo(this.n1)}},{key:"polygons",get:function(){return this.Gb},set:function(t){this.Gb=t,this.remove(),this.addTo(this.n1)}},{key:"types",get:function(){return this.zb}},{key:"showRegion",get:function(){return this.Vb},set:function(t){this.Vb=t,this.remove(),this.addTo(this.n1)}},{key:"addTo",value:function(t){if(this.n1=t,this.Wv=this.n1.parent.buildingID,this.Lt=t.parent.parent,void 0!==this.Gb)for(var n=0;n<this.Gb.length;n++){this.Hb.push(this.Gb[n].points);var e=this.Gb[n].holes;void 0===e&&(e=[]);for(var i=0;i<e.length;i++)this.Xb.push(e[i])}else this.Hb.push(this.Kf);this.Lt.fi.Ft.Xi(this.Wv).loaded?(t=this.n1.getLayers(S.EXTENT_LAYER)[0],this.xe=t.bound,this.wc()):this.Lt.on("update",this.Kt)}},{key:"remove",value:function(){var n=this;this.Hb.length=0,this.Xb.length=0,null!==this.Wb&&(this.Wb.dispose(),this.Wb=null,this.jr.dispose(),this.jr=null);for(var t=0;t<this.zb.length;t++)for(var e,i=this.n1.getLayers(this.zb[t])[0],r=0;r<i.children.length;r++)""+this.zb[t]==""+S.FACILITY_LAYER||""+this.zb[t]==""+S.LABEL_LAYER?i.children[r].visible=!0:""+this.zb[t]==""+S.EXTENT_LAYER||""+this.zb[t]==""+S.MODEL_LAYER?(i.children[r].Rr=!1,i.children[r].xi&&(i.children[r].xi.material.uniforms.isMask.value=!1,i.children[r].xi.material.uniformsNeedUpdate=!0,""+this.zb[t]==""+S.MODEL_LAYER)&&(i.children[r].xi.userData&&i.children[r].xi.userData.sourceMaterial&&((e=i.children[r].xi.userData.sourceMaterial.clone()).uniforms.isMask.value=!1,e.uniformsNeedUpdate=!0,i.children[r].xi.userData.sourceMaterial.dispose(),i.children[r].xi.userData.sourceMaterial=e),i.children[r].If&&(i.children[r].If.material.uniforms.isMask.value=!1,i.children[r].If.material.uniformsNeedUpdate=!0),i.children[r].Hr.top)&&(i.children[r].Hr.top.material.uniforms.isMask.value=!1,i.children[r].Hr.top.material.uniformsNeedUpdate=!0)):""+this.zb[t]==""+S.EXTERNAL_MODEL_LAYER&&(i.children[r].Rr=!1,i.children[r].xi)&&i.children[r].Xl&&i.children[r].xi.traverse(function(t){"Mesh"===t.type&&(t.material.uniforms.isMask.value=!1,t.material.uniformsNeedUpdate=!0,t.userData&&t.userData.sourceMaterial&&(t.userData.sourceMaterial.uniforms.isMask.value=!1,t.userData.sourceMaterial.uniformsNeedUpdate=!0),n.Lt.enableUpdateNode())});this.Lt.enableUpdateNode()}}])&&UT(t.prototype,e),i&&UT(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}(),B1=(Object.assign(P1.prototype,{wc:function(){var t=this.n1.getLayers();this.Qb();for(var n=0;n<t.length;n++)this.ad(t[n].type)&&this.Zb(t[n].children,t[n].type)},Qb:function(){null!==this.Wb&&(this.Wb.dispose(),this.Wb=null,this.jr.dispose(),this.jr=null);for(var t=this.n1.getLayers(S.EXTENT_LAYER)[0].bound,n=document.createElement("canvas"),e=(n.width=this.Yb,n.height=this.Yb,n.getContext("2d")),i=(e.clearRect(0,0,this.Yb,this.Yb),e.fillStyle="#FFFFFF",e.rect(0,0,this.Yb,this.Yb),e.fill(),e.fillStyle="#000000",this.Yb/t.size.x),r=this.Yb/t.size.y,o=0;o<this.Hb.length;o++){var s=this.Hb[o];e.beginPath(),e.moveTo((s[0].x-t.min.x)*i,(t.max.y-s[0].y)*r);for(var a=1;a<s.length;a++)e.lineTo((s[a].x-t.min.x)*i,(t.max.y-s[a].y)*r);e.lineTo((s[0].x-t.min.x)*i,(t.max.y-s[0].y)*r),e.fill(),e.closePath()}e.fillStyle="#FFFFFF";for(var u=0;u<this.Xb.length;u++){var c=this.Xb[u];e.beginPath(),e.moveTo((c[0].x-t.min.x)*i,(t.max.y-c[0].y)*r);for(var f=1;f<c.length;f++)e.lineTo((c[f].x-t.min.x)*i,(t.max.y-c[f].y)*r);e.lineTo((c[0].x-t.min.x)*i,(t.max.y-c[0].y)*r),e.fill(),e.closePath()}this.Wb=new Gc(n),this.Wb.minFilter=B,this.Wb.generateMipmaps=!1,this.jr=new Gc(n),this.jr.flipY=!1,this.jr.minFilter=B,this.jr.generateMipmaps=!1},ad:function(t){for(var n=!1,e=0;e<this.zb.length;e++)if(""+t==""+this.zb[e]){n=!0;break}return n},Un:function(t){for(var n=!1,e=0;e<this.Hb.length;e++)if(W.Un(t,this.Hb[e],this.Hb[e].length)){n=!0;break}if(n)for(var i=0;i<this.Xb.length;i++)if(W.Un(t,this.Xb[i],this.Xb[i].length)){n=!1;break}return n},Zb:function(t,n){if(n===S.FACILITY_LAYER||n===S.LABEL_LAYER)for(var e=0;e<t.length;e++)"inside"===this.Vb?this.Un({x:t[e].x,y:t[e].y})?t[e].visible=!0:t[e].visible=!1:this.Un({x:t[e].x,y:t[e].y})?t[e].visible=!1:t[e].visible=!0;else if(n===S.MODEL_LAYER||n===S.EXTENT_LAYER||n===S.EXTERNAL_MODEL_LAYER){for(var i,r=0;r<t.length;r++)t[r].Rr=!0,n===S.MODEL_LAYER||n===S.EXTENT_LAYER?(t[r].Lh=this.Wb,n===S.MODEL_LAYER&&(t[r].ip=this.jr)):t[r].jr=this.jr,t[r].Pr=0,t[r].Fr=this.nt,t[r].Ir=this.w1,t[r].Cr=new Mt(this.xe.center.x-this.Lt.x,this.Lt.y-this.xe.center.y),t[r].kr=new Mt(this.xe.size.x,this.xe.size.y),"outside"===this.Vb&&(t[r].Pr=1),t[r].xi&&(n===S.MODEL_LAYER||n===S.EXTENT_LAYER?((i=t[r].xi.material.clone()).uniforms.isMask.value=!0,i.uniforms.maskType.value=t[r].Pr,i.uniforms.maskTexture.value=this.Wb,void 0!==this.nt&&void 0!==this.w1&&(i.uniforms.maskHeight.value=this.nt,i.uniforms.maskExtrudeHeight.value=this.w1),i.uniformsNeedUpdate=!0,t[r].xi.material.dispose(),t[r].xi.material=i,n===S.MODEL_LAYER&&(this.qb(t[r]),this.Kb(t[r]),t[r].xi.userData)&&t[r].xi.userData.sourceMaterial&&((i=t[r].xi.userData.sourceMaterial.clone()).uniforms.isMask.value=!0,i.uniforms.maskType.value=t[r].Pr,i.uniforms.maskTexture.value=this.Wb,void 0!==this.nt&&void 0!==this.w1&&(i.uniforms.maskHeight.value=this.nt,i.uniforms.maskExtrudeHeight.value=this.w1),i.uniformsNeedUpdate=!0,t[r].xi.userData.sourceMaterial.dispose(),t[r].xi.userData.sourceMaterial=i)):this.Jb(t[r]));this.Lt.enableUpdateNode()}},Kb:function(t){var n,e=this;null!==t.Hr.top&&((n=this.Lt.fi.Br.ku({})).depthTest=!0,n.depthWrite=!1,n.visible=!1,this.Lt.fi.Br.nc(t.ev,function(t){n.map=t,n.map.wrapS=Xn,n.map.wrapT=Xn,n.needsUpdate=!0,n.visible=!0,n.polygonOffset=!0,n.polygonOffsetFactor=-1,n.polygonOffsetUnits=-4,n.visible=!0,e.Lt.enableUpdateRender()},{generateMipmaps:!0}),n.uniforms.isMask.value=!0,n.uniforms.maskType.value=t.Pr,n.uniforms.maskTexture.value=this.jr,void 0!==this.nt&&void 0!==this.w1&&(n.uniforms.maskHeight.value=this.nt,n.uniforms.maskExtrudeHeight.value=this.w1),n.uniforms.boundCenter.value=t.Cr,n.uniforms.boundSize.value=t.kr,n.uniformsNeedUpdate=!0,t.Hr.top.material.dispose(),t.Hr.top.material=n)},qb:function(t){if(null!==t.If){var n=this.Lt.fi.Br.ku({color:t.q0,opacity:t.K0*this.n1.ht,needDepth:!0});(n=n.clone()).uniforms.isMask.value=!0,n.uniforms.maskType.value=t.Pr,n.uniforms.maskTexture.value=this.jr,void 0!==this.nt&&void 0!==this.w1&&(n.uniforms.maskHeight.value=this.nt,n.uniforms.maskExtrudeHeight.value=this.w1),n.uniforms.boundCenter.value=t.Cr,n.uniforms.boundSize.value=t.kr,n.uniformsNeedUpdate=!0,t.If.material.dispose(),t.If.material=n;for(var e=0;e<t.If.children.length;e++)t.If.children[e].material.dispose(),t.If.children[e].material=n}},Jb:function(e){var i=this;e.xi.traverse(function(t){var n;"Mesh"===t.type&&(n=e.Nr(t.material),e.Or&&(n.uniforms.diffuse.value=new lt(e.Or)),n.uniforms.isMask.value=!0,n.uniforms.maskType.value=e.Pr,n.uniforms.maskTexture.value=i.jr,void 0!==i.nt&&void 0!==i.w1&&(n.uniforms.maskHeight.value=i.nt,n.uniforms.maskExtrudeHeight.value=i.w1),n.uniforms.boundCenter.value=e.Cr,n.uniforms.boundSize.value=e.kr,n.uniformsNeedUpdate=!0,t.material.dispose(),t.material=n,i.Lt.enableUpdateNode(),t.userData)&&t.userData.sourceMaterial&&((n=e.Nr(t.userData.sourceMaterial)).uniforms.isMask.value=!0,n.uniforms.maskType.value=e.Pr,n.uniforms.maskTexture.value=i.jr,void 0!==i.nt&&void 0!==i.w1&&(n.uniforms.maskHeight.value=i.nt,n.uniforms.maskExtrudeHeight.value=i.w1),n.uniforms.boundCenter.value=e.Cr,n.uniforms.boundSize.value=e.kr,n.uniformsNeedUpdate=!0,t.userData.sourceMaterial.dispose(),t.userData.sourceMaterial=n)})},Kt:function(){var t;this.Lt.fi.Ft.Xi(this.Wv).loaded&&(t=this.n1.getLayers(S.EXTENT_LAYER)[0],this.xe=t.bound,this.wc(),this.Lt.off("update",this.Kt))}}),P1),BT={Default:1,Legacy:2,Classic:4,Custom:8};function GT(t){return(GT="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function HT(t,n,e){return(n=zT(n))in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function XT(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,zT(i.key),i)}}function zT(t){t=function(t,n){if("object"!=GT(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=GT(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==GT(t)?t:String(t)}nb=function(){function e(t,n){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.$b=t,this.tg=n,this.ng=HT(HT(HT({},BT.Default,{FMExtentLayer:[{name:"DirectionalLight",color:11579568,intensity:.95,position:{x:58,y:65,z:40},id:0},{name:"AmbientLight",color:11579568,intensity:.85,id:1},{name:"DirectionalLight",color:6447714,intensity:.65,position:{x:-100,y:0,z:45},id:2}],FMDynamicModelLayer:[{name:"DirectionalLight",color:11579568,intensity:.95,position:{x:58,y:65,z:45},id:0},{name:"AmbientLight",color:11579568,intensity:.85,id:1},{name:"DirectionalLight",color:6447714,position:{x:-100,y:0,z:45},intensity:.45,id:2}],FMModelLayer:[{name:"DirectionalLight",color:11645361,intensity:.95,position:{x:58,y:65,z:40},id:0},{name:"AmbientLight",color:11645361,intensity:.85,id:1},{name:"DirectionalLight",color:6513507,position:{x:-100,y:0,z:45},intensity:.65,id:2}],FMExternalModelLayer:[{name:"DirectionalLight",color:11579568,intensity:.95,position:{x:58,y:65,z:45},id:0},{name:"AmbientLight",color:11579568,intensity:.85,id:1},{name:"DirectionalLight",color:6447714,position:{x:-100,y:0,z:45},intensity:.45,id:2}]}),BT.Legacy,{FMExtentLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,intensity:1,position:{x:-.5,y:1,z:-1},id:2}],FMExternalModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:16777215,intensity:.46,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}],FMModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}],FMDynamicModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}]}),BT.Classic,{FMExtentLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,intensity:1,position:{x:-.5,y:1,z:-1},id:2}],FMExternalModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:16777215,intensity:.46,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}],FMModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}],FMDynamicModelLayer:[{name:"DirectionalLight",color:8947848,intensity:.9,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:16777215,intensity:.33,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}]})}var t,n,i;return t=e,(n=[{key:"getConfig",value:function(){return this.$b==BT.Custom?this.tg:this.ng[this.$b]}}])&&XT(t.prototype,n),i&&XT(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function VT(t){return(VT="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function WT(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=VT(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=VT(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==VT(t)?t:String(t)}(i.key),i)}}T2=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.Lt=null,this.Xr={},this.zt=(new Date).getTime(),this.Kt=this.Kt.bind(this)}var n,e,i;return n=t,(e=[{key:"replace",value:function(t,n,e){this.getTextureNames(t).indexOf(n)<0?console.warn(n+"gif,"):(this.eg(t.FID,n),0<=e.indexOf(".mp4")||0<=e.indexOf(".webm")||0<=e.indexOf(".ogg")?this.td(e,t,n):0<=e.indexOf(".gif")?this.Vl(e,t,n):(0<=e.indexOf(".jpg")||0<=e.indexOf(".png"))&&this.ig(e,t,n),t.multiMediaTool.replace(n),null===this.Lt&&(this.Lt=t.parent.parent.parent.parent,this.Lt.on("update",this.Kt)))}},{key:"reset",value:function(t,n){this.eg(t.FID,n),t.multiMediaTool.reset(n)}},{key:"dispose",value:function(){for(var t in this.Xr){var n=t.split("_");this.reset(this.Xr[t].externalModel,n[1])}this.Lt.off("update",this.Kt)}},{key:"getTextureNames",value:function(t){return t.multiMediaTool.textureNames}}])&&WT(n.prototype,e),i&&WT(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}(),Object.assign(T2.prototype,{eg:function(t,n){var e=this.Xr[t+"_"+n];if(e&&"video"===e.type)document.getElementById(e.texture.video_id).parentNode.removeChild(document.getElementById(e.texture.video_id)),e.texture.dispose();else if(e&&"gif"===e.type)for(var i=0;i<e.canvasArray.length;i++)e.canvasArray[i].getContext("2d").clearRect(0,0,e.canvasArray[i].width,e.canvasArray[i].height);delete this.Xr[t+"_"+n]},ig:function(t,n,e){var i=this,r=new Image;r.crossOrigin="Anonymous",r.onload=function(){var t=document.createElement("canvas");t.width=512,t.height=512,t.getContext("2d").drawImage(r,0,0,512,512),i.Xr[n.FID+"_"+e]={type:"gif",canvascount:0,externalModel:n,canvasArray:[t],isnewupdate:!0}},r.src=t},td:function(t,i,r){var o=this,n=(this.Jl=t,null),e=document.createElement("div"),s=(e.style.display="none","xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=16*Math.random()|0;return("x"==t?n:3&n|8).toString(16)}));e.setAttribute("id",s+"_div"),e.innerHTML='<video id="'+s+'" loop crossOrigin="anonymous" muted><source src="'+t+'"></video>',document.body.appendChild(e),function t(){var e=document.getElementById(s);e?(null!==n&&clearTimeout(n),e.addEventListener("loadeddata",function(t){var n=new Ob(e);n.video_id=s+"_div",n.name=r,i.isGltf&&(n.flipY=!1),o.Xr[i.FID+"_"+r]={type:"video",externalModel:i,texture:n,isnewupdate:!0},e.play()})):n=setTimeout(t,0)}()},Vl:function(t,n,e){var i=this,r=document.createElement("div"),o=(r.style.display="none",document.body.appendChild(r),new Image);o.crossOrigin="Anonymous",o.onload=function(){i.Xr[n.FID+"_"+e]={type:"gif",canvascount:0,externalModel:n,canvasArray:[],isnewupdate:!0},r.appendChild(o);var t=new Tb.a({gif:o});t.load(function(){i.Wl(t,n.FID,e,r)})},o.src=t},Wl:function(e,i,r,o){var s=this,a=null,u=e.get_length(),c=1;this.Xr[i+"_"+r].canvascount=0,function t(){{var n;u<c?(document.body.removeChild(o),null!==a&&clearTimeout(a)):(e.move_to(c),(n=document.createElement("canvas")).width=512,n.height=512,n.getContext("2d").drawImage(e.get_canvas(),0,0,512,512),s.Xr[i+"_"+r].canvasArray.push(n),c++,a=setTimeout(t,0))}}()},rg:function(a){var r=this,t=a.getRenderNode();function n(t){var n=a.multiMediaTool.oldMaterial[t.name];if(Array.isArray(n))for(var e=0;e<n.length;e++){var i,r=u(t.material[e],n[e]);r&&(r.iscanvasinfo?(i=r.info,t.material[e].map.image=i.canvasArray[i.canvascount],t.material[e].map.needsUpdate=!0):(t.material[e].dispose(),t.material[e]=r))}else{var o,s=u(t.material,n);s&&(s.iscanvasinfo?(o=s.info,t.material.map.image=o.canvasArray[o.canvascount],t.material.map.needsUpdate=!0):(t.material.dispose(),t.material=s))}}function u(t,n){var e,i="",n=(n.uniforms&&n.uniforms.map&&n.uniforms.map.value?i=n.uniforms.map.value.name:n.map&&(i=""+n.map.name).indexOf(".gif")<0&&i.indexOf(".mp4")<0&&i.indexOf(".webm")<0&&i.indexOf(".ogg")<0&&(i=""+n.name),r.Xr[a.FID+"_"+i]);return n?"video"===n.type?!t.isupdate||n.isnewupdate?(n.isnewupdate=!1,(e=new ta({map:n.texture.clone()})).isBasic=!0,e.isupdate=!0,e.updatename=i,e):null:"gif"===n.type?n.canvasArray[n.canvascount]?!t.isupdate||n.isnewupdate?(n.isnewupdate=!1,e=new Gc(n.canvasArray[n.canvascount]),a.isGltf&&(e.flipY=!1),e.repeat.set(1,1),e.name=i,e.magFilter=B,e.minFilter=qn,(t=new ta({map:e})).updatename=i,t.isBasic=!0,t.isupdate=!0,t):{iscanvasinfo:!0,info:n}:null:void 0:null}t&&(a.isGltf?t.traverse(function(t){"Mesh"===t.type&&n(t)}):n(t))},Kt:function(){var t,n,e=(new Date).getTime(),i=e-this.zt,r=(50<=i&&(this.zt=e),[]);for(t in this.Xr)(function(t){for(var n=!0,e=0;e<r.length;e++)if(r[e].FID===t){n=!1;break}return n})(t.split("_")[0])&&this.Xr[t]&&r.push(this.Xr[t].externalModel),"gif"===this.Xr[t].type&&50<=i&&((n=this.Xr[t]).canvascount<n.canvasArray.length-1?n.canvascount++:n.canvascount=0);for(var o=0;o<r.length;o++)this.rg(r[o])}}),D2=T2;function YT(t){return(YT="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function QT(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=YT(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=YT(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==YT(t)?t:String(t)}(i.key),i)}}var ZT=function(){function r(t,n,e,i){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");this.x=t,this.y=n,this.width=e,this.height=i}var t,n,e;return t=r,(n=[{key:"contains",value:function(t){return t.x>=this.x&&t.y>=this.y&&t.x<this.x+this.width&&t.y<this.y+this.height}},{key:"intersects",value:function(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}}])&&QT(t.prototype,n),e&&QT(t,e),Object.defineProperty(t,"prototype",{writable:!1}),r}();function qT(t){return(qT="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function KT(t,n){var e,i,r,o,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return i=!(e=!0),{s:function(){s=s.call(t)},n:function(){var t=s.next();return e=t.done,t},e:function(t){i=!0,r=t},f:function(){try{e||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(t)||(s=function(t,n){var e;if(t)return"string"==typeof t?JT(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?JT(t,n):void 0}(t))||n&&t&&"number"==typeof t.length)return s&&(t=s),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function JT(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function $T(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=qT(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=qT(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==qT(t)?t:String(t)}(i.key),i)}}var tx=function(){function c(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:8,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=this,o=c;if(!(r instanceof o))throw new TypeError("Cannot call a class as a function");this.bound=t,this.maxPoints=n,this.maxDepth=e,this.depth=i,this.points=[],this.nodes=[]}var t,n,e;return t=c,(n=[{key:"insert",value:function(t){if(this.bound.contains(t)){if(this.points.length<this.maxPoints||this.depth>=this.maxDepth)return this.points.push(t),!0;0===this.nodes.length&&this.split();var n,e=KT(this.nodes);try{for(e.s();!(n=e.n()).done;)if(n.value.insert(t))return!0}catch(t){e.e(t)}finally{e.f()}}return!1}},{key:"split",value:function(){var t,n=this.bound.x,e=this.bound.y,i=this.bound.width/2,r=this.bound.height/2,o=(this.nodes.push(new c(new ZT(n,e,i,r),this.maxPoints,this.maxDepth,this.depth+1)),this.nodes.push(new c(new ZT(n+i,e,i,r),this.maxPoints,this.maxDepth,this.depth+1)),this.nodes.push(new c(new ZT(n,e+r,i,r),this.maxPoints,this.maxDepth,this.depth+1)),this.nodes.push(new c(new ZT(n+i,e+r,i,r),this.maxPoints,this.maxDepth,this.depth+1)),KT(this.points));try{for(o.s();!(t=o.n()).done;){var s,a=t.value,u=KT(this.nodes);try{for(u.s();!(s=u.n()).done;)s.value.insert(a)}catch(t){u.e(t)}finally{u.f()}}}catch(t){o.e(t)}finally{o.f()}this.points=[]}},{key:"query",value:function(t){var n=[];if(this.bound.intersects(t)){var e,i=KT(this.points);try{for(i.s();!(e=i.n()).done;){var r=e.value;t.contains(r)&&n.push(r)}}catch(t){i.e(t)}finally{i.f()}var o,s=KT(this.nodes);try{for(s.s();!(o=s.n()).done;)var a=o.value,n=n.concat(a.query(t))}catch(t){s.e(t)}finally{s.f()}}return n}}])&&$T(t.prototype,n),e&&$T(t,e),Object.defineProperty(t,"prototype",{writable:!1}),c}();function nx(t){return(nx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ex(t,n){var e,i,r,o,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return i=!(e=!0),{s:function(){s=s.call(t)},n:function(){var t=s.next();return e=t.done,t},e:function(t){i=!0,r=t},f:function(){try{e||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(t)||(s=function(t,n){var e;if(t)return"string"==typeof t?ix(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?ix(t,n):void 0}(t))||n&&t&&"number"==typeof t.length)return s&&(t=s),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ix(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function rx(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=nx(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=nx(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==nx(t)?t:String(t)}(i.key),i)}}var ox=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")}var n,e,i;return n=t,(e=[{key:"scatterPoints",value:function(t,n){for(var e=n.min.x,i=n.min.y,r=n.max.x-n.min.x,n=n.max.y-n.min.y,e=new ZT(e,i,r,n),o=new tx(e),s=0;s<t.length;s++)o.insert(t[s]);return o}},{key:"clusterPoints",value:function(t,n,e,i){var r=[];i&&t.sort(function(t,n){return n.weight-t.weight});for(var o=0;o<t.length;o++){var s=t[o];if(!s.clustered){s=(s=n.query(new ZT(s.x-e/2,s.y-e/2,e,e))).filter(function(t){return!0!==t.clustered});if(0!=s.length){var a,u=ex(s);try{for(u.s();!(a=u.n()).done;)a.value.clustered=!0}catch(t){u.e(t)}finally{u.f()}r.push(s)}}}return r}},{key:"getClusterCenter",value:function(t){for(var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],e=[],i=0;i<t.length;i++){var r,o,s=t[i].length,a={};s<=0||(r=t[i][0].level,o=t[i][0].buildingID,(a=n?this.get_centroid(t[i],n):this.get_centroid(t[i])).level=r,a.buildingID=o,a.num=s,e.push(a))}return e}},{key:"get_centroid",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],e={};if(0!=t.length){var i=0,r=0,o=0;if(n){for(var s=0;s<t.length;s++){var a=t[s];i+=a.x*a.weight,r+=a.y*a.weight,o+=a.weight}if(0==o)return e;i/=o,r/=o}else{for(var u=0;u<t.length;u++){var c=t[u];i+=c.x,r+=c.y}i/=t.length,r/=t.length}e={x:i,y:r}}return e}}])&&rx(n.prototype,e),i&&rx(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}();function sx(t){return(sx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ax(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=sx(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=sx(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==sx(t)?t:String(t)}(i.key),i)}}var ux=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.x=t.x,this.y=t.y}var t,e,i;return t=n,(e=[{key:"addTo",value:function(){}},{key:"remove",value:function(){}},{key:"dispose",value:function(){}},{key:"moveTo",value:function(t){this.x=t.x,this.y=t.y}},{key:"getRenderNode",value:function(){return{}}}])&&ax(t.prototype,e),i&&ax(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}();function cx(t){return(cx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fx(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var i,r,o,s,a=[],u=!0,c=!1;try{if(o=(e=e.call(t)).next,0===n){if(Object(e)!==e)return;u=!1}else for(;!(u=(i=o.call(e)).done)&&(a.push(i.value),a.length!==n);u=!0);}catch(t){c=!0,r=t}finally{try{if(!u&&null!=e.return&&(s=e.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(t,n)||lx(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function hx(t,n){var e,i,r,o,s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return i=!(e=!0),{s:function(){s=s.call(t)},n:function(){var t=s.next();return e=t.done,t},e:function(t){i=!0,r=t},f:function(){try{e||null==s.return||s.return()}finally{if(i)throw r}}};if(Array.isArray(t)||(s=lx(t))||n&&t&&"number"==typeof t.length)return s&&(t=s),o=0,{s:n=function(){},n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function lx(t,n){var e;if(t)return"string"==typeof t?dx(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?dx(t,n):void 0}function dx(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function vx(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=cx(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=cx(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==cx(t)?t:String(t)}(i.key),i)}}var U2=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.og=t.render,this.Lt=t.map,this.sg=t.gridSize,void 0===this.sg&&(this.sg=100),this.Kf=t.points,this.X1=t.maxZoom,void 0===this.X1&&(this.X1=20),this.ag=t.renderClusterMarker,this.ug=t.renderMarker,this.Eb=t.content,this.cg=t.clusterMarkerUserDefine,void 0===this.cg&&(this.cg=!1),this.fg=new Map,this.hg=null,this.lg=new ox,this.dg=null,this.Wv=t.buildingID,void 0===this.Wv&&(this.Wv=this.Lt.getMapOptions().buildingID),this.ar=t.level,this.xe=null,this.B1=this.B1.bind(this),this.Kt=this.Kt.bind(this),this.vg=this.vg.bind(this),this.pg=[],this.mg=[],this.zt=0,this.yg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAACDFJREFUeF7Fmw2MXFUVx3/nzczOdrtt3LZaSYFEDdBqMFKgIUESqhVaxS4xYIJBRVZaMKxktYvT7XZ3ust+0G3aKrVAaJvYBqM0JkitfIjWmDUW6xeU+AFVI2CBCrSpbdmZ2feOuW936n5137vvvdk9yWQ+3vmf8z//e+/7uPeOMFW2Rc9DWYLwMeCjwAeBuUDtMIVTwNvAP4DDwJ+A52iS1ytJUSoZnIc1wylWIHwJ+Dgw3zLfm0A/ym5qeZLVUrLEB7pXToBNeiMO3wKuCmQRzuEgHvezRh4P5x7OK3kBNutH8NiKsCwcBUsv5VmUJprlRUvkhO7JCtCnDQgbgTlJkJskxnGUZpplZ9w8yQnQpx0I6+MSssIrnTRLmxVmjHMyAvTpduCuOERiYB+kWb4WFR9fgE3ag0cuKoFEcA69rJG1UWLFE6BHb8ch9jiMQnwcRvkyOdltGyu6AN26EIfngSrbpBXyH8DjMlrkrzbxowvQqz8HPmGTbAp8D5ATK07RBOjVepREb0gSE0e4kZz8OGw8ewEe0xRH+CNwadgkAX7l29tMQvEOU2QxeRkME89egPu0Hond+r8G9iH04/GaT9ThfNR/XvgscHUY8uf0EeppkSfCxIgiwE+BFWGCT+DzEg7NgeS6dSUefcDFkfIIT7BO6sNg7QTo0vkoLwGzwwQf43OYNDeQk1dCYXv1Qgb5ScShdpJBLiIvx4Jy2QnQqZ8DfhQUdILj/yTFlbSIed4Pb906F5dDwAfCg4Y9hZW0yr4gnJ0AHdoJtAYFHXdcWMF6ecoaZwCduhzlSWuseU5oD35OsBNgg5pLX6ixdZaw8Axtcr11ASMBHfo0ynWWMfbRLiuDMLYCmMufmdKysa/SHvOxdYM2ADtskgLP0y6BXO0EyKu5ZC2wIPIuKS5nvfzFAjPetVMX4fJ7YIZFnKPkJZCrnQDtehx4jwWJNxD/bGwmPKNbXmtRXgbebxHkBBukLsjfToA2fWt4Jjcobvn4URw+RF4GwgIm9GvULHX83bL3vUOHmFnnSc1WgH8BFwYFHXH8BIN8mO6YU9steh5p/mzZ+16lQwK52gnQqr8FrrQQwNziLqdDnrbCjHVu1eVgfSn8HfdJIFdbAX6I8nnLYrbRJY2WmNHu6/QB4G7LGHvpkkCudgKs1VYEczNkY2+hLKTH8i6wnCGv8yhiriLzbJICbXRLIFc7AVr0UyjPWBIx7nvoEbM6ZG853YNwqzVQuI5u+VkQzk6AnNYh/uUo8Ow6LrHSQq/0BBEadTynaxG6rTBDzv8hy8Xk5UQQ1k4AE22tPoryhaDAEx5XNjODdYGXxbxW8y5dCN+IlAe+R6/cFgZrL0BOl6EEdq1Jkv8B+DZpDtAlr47yu1fPR/x5xnuAxWEKOIfPNdwv/WHw9gKYqPfqr4BrwiSYxMc8Gr/gd9che+/wsrn98Bqd5Ck2SugJm6gCfBJ4NqYAlYE7XEGvmOeGUBZNABN6je4FbgqVZeqctrHJ7p4jugBmvHr+Tg6bh6NKSvEyBa7gATlpkyS6AEO94DOoP2833ebisIQ+MSdYK4sngEn1Td3or9VPpymNbJFtUSjEF8BkvUf34/DpKARiY5QdbJU7osZJRoAmnYOHWexYGJVIRFw/dSwNuwo0UY5kBBjqBZcI/rTVzIjF2MJe1xKL2S5v2AJH+icngIn6dV0uYFaOko07vsKCOixlq/wmTvEGmzjRVKPerlR204QIt7jfkR/ELb4iApigzt26WaEpCYJjYwhs9LaJ2X+YiCXeA8qspFEfRy0XUYJKUvbpd4MXO4LCVO4cMDLyKq1xMpgxavYFJ2F/82ZwOZvkdBLBzjZUksHGxbpLL0kJBxO4XS44cFVpu5gN1IlaxYZAmWX6Tr1WHQ7EYu1xk/uQRFmVDkxbcQH8k+KdmhOwmw77fx99yH1QKrYJc0oEMLVkVuv3FW4JbJLRDs8NPixJ7TafMPWUCUCjzs4UeVHhgpAiuE6KS4vbYy6sBiSbOgGA9CpdqvCLMAKo0uw9IpvC+MbxmVIB/KFwhz6mcPNkpBWOuAtYFOchJ6woUy9Ag16mwqQTFyrc6j4ij4YtIo7flAtgyKYbdD+cc/7ghcGdZheKaJzCwmKnS4CrxfwZagJzlPrCrnCbHMMWOZnftAhgCGUbtN8bsyNUlEPFXbIkicLCxpg+Ab6iN6gwah+fwPWFXRJl8TVsveP8KitAXh3eJoNLhjOk8UhRQ6rMoqrAL4FFw98PFYssYxbV/vczmJlelxoGSVFiLiXy4kWu9BzABAVQ4YvUkKamOstMz/MLyaiSQnAw7x7if3bQlMcxz+U2XNrMtIymaUwJ+93ynysVz0cJLoon5h1KjsPAQIHTDHKGPZyJe7KML8DNmmIW86tS1KnHzHKBfrGmAEPf2MjP5muKk54yS4ocRDjqZLjWc6jVQbJnG8tIZ+IYK382ccxvRhSH00WX4/yXN9krRiBriy1AdrVe5LoswKMgUPILDWMeUkpzrKpAHod/Fx12ZBze55cXxjz/OpnBIZtSXivslCNhYGN9YgvAKp2XcbmAFFWmu8tQ+7h+y08mxtBwMOM8jUvRfw8ygzE9QUmp4PjDwqVYKvEKu6NtwYkvgCFthkEtc7IZZqtSrUIWjypD0gghRoiRYpSHxVAxBf/8MCTEUO8xv5fNtPRw4b64DkVRCiIMFEqc5BTvRO3+JkUyAoxqORWaqOY0VZSoQsiYV9Z0V9NyptjM8AkR8EUyRMpd3whVwvVbV3ALZliZX8wrQ5GZFNnCQNyTX5ny/wAFqGhfpVfGKAAAAABJRU5ErkJggg==",this.wc(),this.Qe=new cE}var t,e,i;return t=n,(e=[{key:"dispose",value:function(){for(var t,n=0;n<this.pg.length;n++)null!=(t=this.pg[n].marker)&&t.remove(),delete this.pg[n];if(0<this.fg.size){var e,i=hx(this.fg);try{for(i.s();!(e=i.n()).done;)for(var r=fx(e.value,2),o=(r[0],r[1]),s=0;s<o.length;s++)o[s].marker.parent&&o[s].marker.remove()}catch(t){i.e(t)}finally{i.f()}}this.fg.clear(),this.pg.length=0,this.mg.length=0,this.bg(),this.Kf.length=0,this.dg=void 0,this.Lt.off("zoom",this.B1),this.Lt.off("move",this.B1),this.Lt.off("viewChanged",this.B1),this.Lt.off("resize",this.B1),this.cg&&this.Lt.off("click",this.vg)}},{key:"on",value:function(t,n){this.Qe.ly(t,n)}}])&&vx(t.prototype,e),i&&vx(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}(),e=(Object.assign(U2.prototype,{wc:function(){this.ci().getLayers(S.EXTENT_LAYER)[0]?(this.xe=this.ci().getLayers(S.EXTENT_LAYER)[0].bound,this.gg(),this.wg(!0),this.Lt.on("zoom",this.B1),this.Lt.on("move",this.B1),this.Lt.on("viewChanged",this.B1),this.Lt.on("resize",this.B1),this.cg&&this.Lt.on("click",this.vg)):this.Lt.on("update",this.Kt)},gg:function(){this.dg=this.lg.scatterPoints(this.Kf,this.xe)},wg:function(t){var n,e,i=this,r=this;if(this.Lt.getZoom()<this.X1){if(t){for(var o=0;o<this.Kf.length;o++)this.Kf[o].clustered=null;var s=this._g();this.hg=this.Eg(this.Sg(this.Kf,this.dg,s))}null!==this.hg&&(!a()||this.og?(s=this.tb(this.hg),this.Tg(s)):this.xg(this.Lt.getZoom(),t))}else!a()||this.og?(s=this.tb(this.Kf),this.Tg(s)):this.xg("other",t);function a(){return r.cg&&r.ag}this.og&&(n=[],(e=this.Wv)===this.Lt.getMapOptions().buildingID&&(e=null),this.pg.forEach(function(t){n.push({x:t.marker.x,y:t.marker.y,level:i.ar,buildingID:e,isCluster:"multiple"===t.type,points:t.points||[]})}),Fi.compareArrays(this.mg,n)||(this.mg=n,this.og(n)))},xg:function(t){var n,e=hx(this.fg);try{for(e.s();!(n=e.n()).done;){var i=fx(n.value,2),r=i[0],o=i[1];if(""+t!=""+r)for(var s=0;s<o.length;s++)null!==o[s].marker&&(o[s].marker.visible=!1)}}catch(t){e.e(t)}finally{e.f()}if(!(a=this.fg.get(""+t))){var a=[],u=this.hg;""+t=="other"&&(u=this.Kf);for(var c=0;c<u.length;c++){var f=u[c].num;void 0===f&&(f=1),a.push({markers:u[c].markers,num:f,marker:null,x:u[c].x,y:u[c].y})}this.fg.set(""+t,a)}this.Ag(a)},tb:function(t){for(var n=[],e=0;e<t.length;e++)this.ab(t[e])&&n.push(t[e]);return n},Ag:function(t){for(var n,e,i,r=0;r<t.length;r++)this.ab(t[r])?null===t[r].marker?1<t[r].num?(e={marker:null,count:t[r].num,x:t[r].x,y:t[r].y},this.ag(e),null!==e.marker?(t[r].marker=e.marker,t[r].marker.clusterPoints=t[r].markers,t[r].marker.parent||(e=this.ci(t[r].marker.type),t[r].marker.addTo(e))):((e=this.Mg(t[r],this.Og(t[r].num))).getRenderNode().point=t[r],t[r].marker=e,n=this.ci(e.type),e.addTo(n))):(e=null,e=this.ug&&(n={x:t[r].x,y:t[r].y},this.ug(n),e=n.marker)||new uS({url:this.yg,collision:!1,x:t[r].x,y:t[r].y}),t[r].marker=e,i=this.ci(e.type),e.addTo(i)):t[r].marker.visible=!0:null!==t[r].marker&&(t[r].marker.visible=!1)},Tg:function(i){var r=this;if(0===this.pg.length)for(var t=0;t<i.length;t++)this.Lg(i[t]);else{for(var n=[],e=[],o=0;o<i.length;o++){var s,a=d(i[o]);null!==a&&((s=this.pg[a]).marker.moveTo({x:i[o].x,y:i[o].y}),s.marker.getRenderNode().point=i[o],s.points=i[o].markers,n.push(s),this.pg.splice(a,1),e.push(o),"multiple"===s.type)&&this.ag&&(a={marker:s.marker,count:i[o].num},this.ag(a))}i=v(e);for(var u=e.length=0;u<i.length&&0!==this.pg.length;u++){var c,f=d(i[u],!0);null!==f&&((f=this.pg.splice(f,1)[0]).marker.moveTo({x:i[u].x,y:i[u].y}),"multiple"===f.type&&(f.marker.getRenderNode().point=i[u],f.points=i[u].markers,f.num=i[u].num,this.ag?(f.marker.content="<div></div>",c={marker:f.marker,count:i[u].num},this.ag(c)):f.marker.content=this.Og(i[u].num)),e.push(u),n.push(f))}i=v(e);for(var h=e.length=0;h<i.length;h++)this.Lg(i[h],n);for(var l=0;l<this.pg.length;l++)this.pg[l].marker.remove();this.pg.length=0,this.pg=n}function d(t,n){for(var e=null,i=0;i<r.pg.length;i++)if(void 0===t.num||1===t.num){if("single"===r.pg[i].type){if(!r.ug){e=i;break}if(r.pg[i].marker.x===t.x&&r.pg[i].marker.y===t.y){e=i;break}}}else if(n){if("multiple"===r.pg[i].type){e=i;break}}else if(r.pg[i].num===t.num){e=i;break}return e}function v(t){for(var n=[],e=0;e<i.length;e++)!function(t,n){for(var e=!0,i=0;i<t.length;i++)if(t[i]===n){e=!1;break}return e}(t,e)||n.push(i[e]);return n}},Og:function(t){return void 0===this.Eb?'<div style="background: rgba(73,102,245,0.8);height: 50px;width: 50px;border: 2px solid #3F5BC0;border-radius: 25px;box-shadow: rgb(255, 204, 204) 0px 0px 5px;line-height: 50px;color: rgb(255, 255, 255);font-size: 14px;text-align: center;">'+t+"</div>":this.Eb.replace("${num}",""+t)},Lg:function(t,n){var e,i;1<t.num?this.ag?(i={marker:e=this.Mg(t,"<div></div>"),count:t.num},this.ag(i),(n||this.pg).push({points:t.markers,type:"multiple",num:t.num,marker:e})):(i=this.Mg(t,this.Og(t.num)),(n||this.pg).push({points:t.markers,type:"multiple",num:t.num,marker:i})):(e=null,e=this.ug&&(i={x:t.x,y:t.y},this.ug(i),e=i.marker)||new uS({url:this.yg,collision:!1,x:t.x,y:t.y}),i=this.ci(e.type),e.addTo(i),(n||this.pg).push({type:"single",num:t.num,marker:e}))},Mg:function(t,n){var i=this,r=new(st.a.environment==G.a.BROWSER?jT:ux)({map:this.Lt,x:t.x,y:t.y,collision:!1,anchor:Ni.BOTTOM,content:n}),n=this.ci(r.type);return r.addTo(n),r.getRenderNode().point=t,st.a.environment==G.a.BROWSER&&(r.getRenderNode().element.addEventListener("mousedown",function(t){i.zt=(new Date).getTime()}),r.getRenderNode().element.addEventListener("mouseup",function(t){var n,e;200<(new Date).getTime()-i.zt||((n=i.Wv)===i.Lt.getMapOptions().buildingID&&(n=null),e=r.getRenderNode().point,i.Qe.Ye({type:"click",buildingID:n,coords:{x:e.x,y:e.y},level:i.ar,target:r,markers:o(e.markers)}))}),r.getRenderNode().element.addEventListener("touchstart",function(t){i.zt=(new Date).getTime()}),r.getRenderNode().element.addEventListener("touchend",function(t){var n,e;200<(new Date).getTime()-i.zt||((n=i.Wv)===i.Lt.getMapOptions().buildingID&&(n=null),e=r.getRenderNode().point,i.Qe.Ye({type:"click",buildingID:n,coords:{x:e.x,y:e.y},level:i.ar,target:r,markers:o(e.markers)}))})),r;function o(t){for(var n=[],e=0;e<t.length;e++)n.push({x:t[e].x,y:t[e].y});return n}},_g:function(){var t={x:st.a.document.body.clientWidth/2,y:st.a.document.body.clientHeight/2},n={x:t.x+this.sg,y:t.y},t=Oi.coordsScreenToMap(this.Lt,t),n=Oi.coordsScreenToMap(this.Lt,n);return Math.sqrt((t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y))},Sg:function(t,n,e){for(var i=[],r=0;r<t.length;r++){var o=t[r];if(!o.clustered){o=(o=n.query(new ZT(o.x-e/2,o.y-e/2,e,e))).filter(function(t){return!0!==t.clustered});if(0!=o.length){var s,a=hx(o);try{for(a.s();!(s=a.n()).done;)s.value.clustered=!0}catch(t){a.e(t)}finally{a.f()}i.push(o)}}}return i},Eg:function(t){for(var n=[],e=0;e<t.length;e++){var i=0,r=0,o=t[e].length;if(!(o<=0)){for(var s=t[e][0].level,a=t[e][0].buildingID,u=0;u<o;u++)i+=t[e][u].x,r+=t[e][u].y;n.push({x:i/o,y:r/o,level:s,buildingID:a,num:o,markers:t[e]})}}return n},vg:function(t){for(var n=t.targets,e=null,i=0;i<n.length;i++)if(n[i].clusterPoints){e=n[i];break}null!==e&&((t=this.Wv)===this.Lt.getMapOptions().buildingID&&(t=null),this.Qe.Ye({type:"click",buildingID:t,coords:{x:e.x,y:e.y},level:this.ar,target:e,markers:function(t){for(var n=[],e=0;e<t.length;e++)n.push({x:t[e].x,y:t[e].y});return n}(e.clusterPoints)}))},B1:function(t){var n;this.V1()&&(n=!1,"zoom"===t.type&&(n=!0),this.wg(n))},V1:function(){for(var t=!1,n=Array.from(this.Lt.getRenderManager().getRenderList().keys()),e=0;e<n.length;e++){var i=n[e].split("%A%B%C%D");if(""+i[0]==""+this.Wv&&""+i[1]==""+this.ar){t=!0;break}}return t},ab:function(t){var n=this.ci(),n=new xt(t.x-this.Lt.x,n.height,this.Lt.y-t.y),t=this.Lt.camera,n=n.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix);return!(1<Math.abs(n.x)||1<Math.abs(n.y))},bg:function(){!function t(n){n.points.length=0;for(var e=0;e<n.nodes.length;e++)t(n.nodes[e]),delete n.nodes[e];n.nodes.length=0}(this.dg)},ci:function(t){return""+t==""+fengmap.FMType.LOCATION_MARKER?this.Lt:this.Lt.getBuilding(this.Wv).getFloor(this.ar)},Kt:function(){this.ci().getLayers(S.EXTENT_LAYER)[0]&&(this.wc(),this.Lt.off("update",this.Kt))}}),U2),px={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")};function mx(t){return(mx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yx(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=mx(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=mx(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==mx(t)?t:String(t)}(i.key),i)}}function bx(t,n,e){return n&&yx(t.prototype,n),e&&yx(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function gx(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var _x,Ex,Sx=bx(function t(){gx(this,t),this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1});function Tx(t){return(Tx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xx(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Tx(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Tx(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Tx(t)?t:String(t)}(i.key),i)}}function Ax(t,n,e){n=Ox(n);var i=t,n=Mx()?Reflect.construct(n,e||[],Ox(t).constructor):n.apply(t,e);if(n&&("object"===Tx(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function Mx(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Mx=function(){return!!t})()}function Ox(t){return(Ox=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Lx(t,n){return(Lx=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}Object.assign(Sx.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),Sx.FullScreenQuad=(_x=new vt(-1,1,1,-1,0,1),Ex=new Fs(2,2),F_=bx(function t(n){gx(this,t),this.Rg=new ba(Ex,n)}),Object.defineProperty(F_.prototype,"material",{get:function(){return this.Rg.material},set:function(t){this.Rg.material=t}}),Object.assign(F_.prototype,{render:function(t){t.render(this.Rg,_x)}}),F_);var Rx=function(){var t,n,e=r,i=Sx;if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");function r(t,n){var e;if(this instanceof r)return(e=Ax(this,r)).textureID=void 0!==n?n:"tDiffuse",t instanceof Hs?(e.uniforms=t.uniforms,e.material=t):t&&(e.uniforms=Us.clone(t.uniforms),e.material=new Hs({defines:Object.assign({},t.defines),uniforms:e.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),e.fsQuad=new Sx.FullScreenQuad(e.material),e;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),i&&Lx(e,i),e=r,t&&xx(e.prototype,t),n&&xx(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}();function Nx(t){return(Nx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Px(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Nx(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Nx(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Nx(t)?t:String(t)}(i.key),i)}}function jx(t,n,e){return n&&Px(t.prototype,n),e&&Px(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Fx(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function Ix(t,n,e){n=kx(n);var i=t,n=Cx()?Reflect.construct(n,e||[],kx(t).constructor):n.apply(t,e);if(n&&("object"===Nx(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function Cx(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Cx=function(){return!!t})()}function kx(t){return(kx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Dx(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),n&&Ux(t,n)}function Ux(t,n){return(Ux=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}Object.assign(Rx.prototype,{render:function(t,n,e){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=e.texture),this.fsQuad.material=this.material,this.renderToScreen?t.setRenderTarget(null):(t.setRenderTarget(n),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil)),this.fsQuad.render(t)}});var Bx=function(){function i(t,n){var e;return Fx(this,i),(e=Ix(this,i)).scene=t,e.camera=n,e.clear=!0,e.needsSwap=!1,e.inverse=!1,e}return Dx(i,Sx),jx(i)}(),Gx=(Object.assign(Bx.prototype,{render:function(t,n,e){var i,r,o=t.getContext(),s=t.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0),r=this.inverse?(i=0,1):(i=1,0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),s.buffers.stencil.setFunc(o.ALWAYS,i,4294967295),s.buffers.stencil.setClear(r),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(n),this.clear&&t.clear(),t.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setFunc(o.EQUAL,1,4294967295),s.buffers.stencil.setOp(o.KEEP,o.KEEP,o.KEEP)}}),function(){function n(){var t;return Fx(this,n),(t=Ix(this,n)).needsSwap=!1,t}return Dx(n,Sx),jx(n)}());function Hx(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Xx(t){return(Xx="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zx(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=Xx(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=Xx(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Xx(t)?t:String(t)}(i.key),i)}}function Vx(t,n,e){return n&&zx(t.prototype,n),e&&zx(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Wx(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}Object.assign(Gx.prototype,{render:function(t){t.state.buffers.stencil.setTest(!1)}}),Object.assign(Hx.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t,n=0;return this.autoStart&&!this.running?(this.start(),0):(this.running&&(n=((t=("undefined"==typeof performance?Date:performance).now())-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=n),n)}});var Yx,Qx,Zx=Vx(function t(n,e){var i,r;Wx(this,t),this.renderer=n,void 0===e?(i={minFilter:B,magFilter:B,format:he,stencilBuffer:!1},r=n.getSize(new Mt),this.Ng=n.getPixelRatio(),this.tt=r.width,this.nt=r.height,(e=new sc(this.tt*this.Ng,this.nt*this.Ng,i)).texture.name="EffectComposer.rt1"):(this.Ng=1,this.tt=e.width,this.nt=e.height),this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===Rx&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new Rx(px),this.clock=new Hx}),qx=(Object.assign(Zx.prototype,{swapBuffers:function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t},clearPass:function(){for(var t=0;t<this.passes.length;t++)this.passes[t].scene=null,this.passes[t].camera=null},addPass:function(t){this.passes.push(t),t.setSize(this.tt*this.Ng,this.nt*this.Ng)},insertPass:function(t,n){this.passes.splice(n,0,t)},isLastEnabledPass:function(t){for(var n=t+1;n<this.passes.length;n++)if(this.passes[n].enabled)return!1;return!0},render:function(t){void 0===t&&(t=this.clock.getDelta());for(var n,e,i,r=this.renderer.getRenderTarget(),o=!1,s=this.passes.length,a=0;a<s;a++)!1!==(i=this.passes[a]).enabled&&(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(a),i.render(this.renderer,this.writeBuffer,this.readBuffer,t,o),i.needsSwap&&(o&&(n=this.renderer.getContext(),(e=this.renderer.state.buffers.stencil).setFunc(n.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),e.setFunc(n.EQUAL,1,4294967295)),this.swapBuffers()),void 0!==Bx)&&(i instanceof Bx?o=!0:i instanceof Gx&&(o=!1));this.renderer.setRenderTarget(r)},reset:function(t){var n;void 0===t&&(n=this.renderer.getSize(new Mt),this.Ng=this.renderer.getPixelRatio(),this.tt=n.width,this.nt=n.height,(t=this.renderTarget1.clone()).setSize(this.tt*this.Ng,this.nt*this.Ng)),this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(t,n){this.tt=t,this.nt=n;var e=this.tt*this.Ng,i=this.nt*this.Ng;this.renderTarget1.setSize(e,i),this.renderTarget2.setSize(e,i);for(var r=0;r<this.passes.length;r++)this.passes[r].setSize(e,i)},setPixelRatio:function(t){this.Ng=t,this.setSize(this.tt,this.nt)}}),Vx(function t(){Wx(this,t),this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1})),Kx=(Object.assign(qx.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),qx.FullScreenQuad=(Yx=new vt(-1,1,1,-1,0,1),Qx=new Fs(2,2),f2=Vx(function t(n){Wx(this,t),this.Rg=new ba(Qx,n)}),Object.defineProperty(f2.prototype,"material",{get:function(){return this.Rg.material},set:function(t){this.Rg.material=t}}),Object.assign(f2.prototype,{dispose:function(){this.Rg.geometry.dispose()},render:function(t){t.render(this.Rg,Yx)}}),f2),{uLayer:{value:0},uPrevDepthTexture:{value:null},uScreenSize:{value:new Mt(1,1)},uDepthPeel:{value:1},uDepthOffset:{value:1e-5}}),Jx="\nvarying vec2 vUv;\nvoid main(){\n  vUv = uv;\n  gl_Position = vec4(position.xy, 0., 1.);\n}\n";function $x(t){t.fragmentShader=t.fragmentShader.replace("#include <packing>",""),t.fragmentShader="\n\t\t\t\t\t#include <packing>\n\n\t\t\t\t\t".concat(t.fragmentShader,"\n\t\t\t\t"),t3(t),t.fragmentShader=t.fragmentShader.replace(/}(\s*)$/g,"\n    if(uDepthPeel != 0) {\n      #ifdef STANDARD\n        gl_FragColor.a = diffuseColor.a;\n      #else\n        gl_FragColor.a = opacity;\n      #endif\n      gl_FragColor.rgb *= gl_FragColor.a;\n    }\n  }\n  ")}function t3(t){t.uniforms.uScreenSize=Kx.uScreenSize,t.uniforms.uPrevDepthTexture=Kx.uPrevDepthTexture,t.uniforms.uLayer=Kx.uLayer,t.uniforms.uDepthOffset=Kx.uDepthOffset,t.uniforms.uDepthPeel=Kx.uDepthPeel,t.vertexShader=t.vertexShader.replace("void main() {","\n    varying vec2 vFMHighPrecisionZW;\n    void main() {"),t.vertexShader=t.vertexShader.replace(/}$/gm,"\n    vFMHighPrecisionZW = gl_Position.zw;\n  }\n  "),t.fragmentShader="\n\t\t\t\t\tuniform vec2 uScreenSize;\n\t\t\t\t\tuniform sampler2D uPrevDepthTexture;\n\t\t\t\t\tuniform int uLayer;\n\t\t\t\t\tuniform int uDepthPeel;\n\t\t\t\t\tuniform float uDepthOffset;\n          varying vec2 vFMHighPrecisionZW;\n\t\t\t\t\t".concat(t.fragmentShader,"\n\t\t\t\t"),t.fragmentShader=t.fragmentShader.replace(/}(\s*)$/g,"\n  if(uDepthPeel == 0) return;\n\n  if(uLayer != 0 ){\n    vec2 screenPos = gl_FragCoord.xy * uScreenSize;\n    float prevDepth = unpackRGBAToDepth(texture2D(uPrevDepthTexture, screenPos));\n    float fragCoordZ = 0.5 * vFMHighPrecisionZW[0] / vFMHighPrecisionZW[1] + 0.5;\n    if(prevDepth + uDepthOffset - fragCoordZ >= 0. ){\n      discard;\n    }\n  }\n}")}function n3(t,n,e){sc.call(this,t,n,e),this.samples=4}function e3(t){return(e3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i3(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=e3(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=e3(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==e3(t)?t:String(t)}(i.key),i)}}function r3(t,n,e){n=s3(n);var i=t,n=o3()?Reflect.construct(n,e||[],s3(t).constructor):n.apply(t,e);if(n&&("object"===e3(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");t=i;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function o3(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(o3=function(){return!!t})()}function s3(t){return(s3=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a3(t,n){return(a3=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t})(t,n)}n3.prototype=Object.assign(Object.create(sc.prototype),{constructor:n3,isWebGLMultisampleRenderTarget:!0,copy:function(t){return sc.prototype.copy.call(this,t),this.samples=t.samples,this}});var u3=function(){var t,n=f,e=qx;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");function f(){var t,n,e,i,r,o,s,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},u=this,c=f;if(u instanceof c)return u=r3(this,f),c=a.scene,t=a.camera,n=a.renderer,e=a.samples,i=a.layers,r=a.mode,o=a.w,s=a.h,a=a.type,u.gt=n,u.xo=c,u.ze=t,u.Pg=null!=e?e:4,u.jg=r,u.Fe=a,u.Fg=[],u.Ig=null!=i?i:2,u.Cg=new Mt(o,s),u.kg=new Hs({uniforms:{uTextureA:{value:null},uTextureB:{value:null},uBlit:{value:0}},vertexShader:Jx,fragmentShader:"\n          varying vec2 vUv;\n          uniform sampler2D uTextureA;\n          uniform sampler2D uTextureB;\n\n          void main(){\n            vec4 src = texture2D(uTextureA, vUv);\n            vec4 dst = texture2D(uTextureB, vUv);\n\n            float a1 = 1.-src.a;\n            gl_FragColor.a = src.a + a1 * dst.a;\n            gl_FragColor.rgb = src.rgb + a1 * dst.rgb;\n            gl_FragColor.rgb /= gl_FragColor.a;\n          }\n        ",transparent:!0,depthTest:!1,depthWrite:!1}),u.Dg=new ac,u.Dg.depthPacking=vi,u.Dg.onBeforeCompile=t3,u.Ug=new qx.FullScreenQuad(u.kg),u.clearDepth=!1,u.needsSwap=!1,u.Bg=new Map,u.ks=!0,u.initTargets(),u;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&a3(n,e),n=f,(e=[{key:"enable",get:function(){return this.ks},set:function(t){(this.ks=t)?(Kx.uDepthPeel.value=1,this.Bg.forEach(function(t){t=t.mesh;t.material&&(t.material.userData.transparent=!1)})):(Kx.uDepthPeel.value=0,this.restoreState()),this.Bg.clear()}},{key:"restoreState",value:function(){this.Bg.forEach(function(t){t=t.mesh;t.material&&(delete t.userData.transparent,t.material.needsUpdate=!0)}),this.Bg.clear()}},{key:"initTargets",value:function(){for(var t=this.Cg,n=0;n<5;n++){var e=2<=n&&0<this.Pg?n3:sc,i=new e(t.x,t.y,{minFilter:Vn,magFilter:Vn,type:ie,format:he});e===n3&&(i.samples=this.Pg),this.Fg.push(i)}}},{key:"setSize",value:function(){var t=new Mt;this.gt.getDrawingBufferSize(t);for(var n=0;n<5;n++)this.Fg[n].setSize(t.x,t.y);this.Cg.x=t.x,this.Cg.y=t.y,Kx.uScreenSize.value.set(1/t.x,1/t.y)}},{key:"dispose",value:function(){for(var t=0;t<5;t++)this.Fg[t].dispose()}},{key:"clearTarget",value:function(t,n,e){t.setRenderTarget(n),t.setClearColor(e[0],e[1]),t.clear()}},{key:"clearAllTarget",value:function(t,n){var e=this.Fg,i=t.getClearColor().clone(),r=t.getClearAlpha();this.clearTarget(t,e[0],[16777215,1]),this.clearTarget(t,e[1],[16777215,1]),this.clearTarget(t,e[2],[0,0]),this.clearTarget(t,e[3],[0,0]),this.clearTarget(t,n,[i,r])}},{key:"_buildTransparentObjects",value:function(t){var i=this,n={model:S.MODEL_LAYER,extent:S.EXTENT_LAYER,externalModel:S.EXTERNAL_MODEL_LAYER,dynamicModel:S.DYNAMIC_MODEL_MARKER};t.children.forEach(function(t){var e=i.Fe.includes(n[t.name]);t.traverse(function(t){var n=null==(n=t.material)||null==(n=n.userData)?void 0:n.sourceTransparent;e&&t.visible&&"Mesh"===t.type&&0===t.renderOrder&&t.material.transparent&&!1!==n&&(t.userData.transparent=!1,t.visible&&t.material.transparent&&(i.Bg.has(t.uuid)||i.Bg.set(t.uuid,{mesh:t,onBeforeCompile:t.material.onBeforeCompile})),t.material.onBeforeCompile=$x,t.material.needsUpdate=!0)})})}},{key:"render",value:function(t,n,e){this.clearAllTarget(t,e);for(var i=t.getClearColor().getHex(),r=t.getClearAlpha(),o=this.xo,s=this.ze,a=this.Ig,u=this.Fg,c=this.Dg,f=this.kg,h=(this.restoreState(),t.setRenderTarget(e),t.setClearColor(i,r),t.clear(),t.render(o,s),this._buildTransparentObjects(this.xo),Kx.uLayer.value=0,o.overrideMaterial=c,t.setRenderTarget(u[0]),t.setClearColor(16777215,1),t.clear(),t.render(o,s),o.overrideMaterial=null,t.setRenderTarget(u[2]),t.setClearColor(0,0),t.clear(),t.render(o,s),{0:2,1:4,2:3}),l={0:3,1:2,2:4},d={0:4,1:3,2:2},v=0;v<a;v++){var p=(v+1)%2,m=h[v%3],y=l[v%3],b=d[v%3];Kx.uPrevDepthTexture.value=u[v%2].texture,Kx.uLayer.value=v+1,o.overrideMaterial=c,t.setRenderTarget(u[p]),t.setClearColor(16777215,1),t.clear(),t.render(o,s),o.overrideMaterial=null,t.setRenderTarget(u[y]),t.setClearColor(0,0),t.clear(),t.render(o,s),f.uniforms.uTextureA.value=u[m].texture,f.uniforms.uTextureB.value=u[y].texture,t.setRenderTarget(u[b]),t.setClearColor(0,0),t.clear(),this.Ug.render(t)}Kx.uPrevDepthTexture.value=null,t.setRenderTarget(this.renderToScreen?null:e),this.Ug.render(t),t.setClearColor(i,r)}},{key:"setPass",value:function(t,n){t&&(this.xo=t),n&&(this.ze=n)}}])&&i3(n.prototype,e),t&&i3(n,t),Object.defineProperty(n,"prototype",{writable:!1}),f}(),c3={uniforms:{tDiffuse:{value:null},resolution:{value:new Mt(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")};function f3(t){return(f3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h3(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=f3(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=f3(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==f3(t)?t:String(t)}(i.key),i)}}function l3(t,n){return n?(n.copy(t),n):t.clone()}function d3(t,n){return t.equals(n)}var Bv=function(){function s(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=this,e=s;if(!(n instanceof e))throw new TypeError("Cannot call a class as a function");this.Gg=new qo,this.ss=t;var n=this.ss,e=n.renderManager,n=n.map,i={minFilter:B,magFilter:B,format:he,stencilBuffer:!1},r=e.renderer.domElement.parentElement.clientWidth*e.renderer.getPixelRatio(),o=e.renderer.domElement.parentElement.clientHeight*e.renderer.getPixelRatio(),i=new sc(r,o,i);this.Hg=new Zx(e.renderer,i),this.Xg=new u3({w:r,h:o,scene:this.Gg,camera:n.camera,renderer:e.renderer,layers:t.layers,mode:t.mode,type:t.type}),this.zg=new Rx(c3),this.zg.uniforms.resolution.value.set(1/r,1/o),this.Hg.addPass(this.Xg),this.Hg.addPass(this.zg),this.handleResize=this.handleResize.bind(this),this.handleViewChange=this.handleViewChange.bind(this),this.handleViewModeChanged=this.handleViewModeChanged.bind(this),this.ks=!0,this.Vg=-1,n.on("resize",this.handleResize),n.on("viewChanged",this.handleViewChange),n.on("viewModeChanged",this.handleViewModeChanged)}var t,n,e;return t=s,(n=[{key:"enable",get:function(){return this.ks},set:function(t){this.ks=t,this.Xg.enable=t,this.Gg.children.length=0}},{key:"handleViewModeChanged",value:function(){this.Xg.setPass(void 0,this.ss.map.camera)}},{key:"handleViewChange",value:function(){var t=this;this.ss.mode!=hE.RUNTIME&&(this.enable=!1,clearTimeout(this.Vg),this.Vg=setTimeout(function(){t.enable=!0,t.ss.map.enableUpdateRender()},500))}},{key:"handleResize",value:function(){var t=this.ss.renderManager;this.Hg.setSize(t.renderer.domElement.parentElement.clientWidth,t.renderer.domElement.parentElement.clientHeight)}},{key:"render",value:function(){var n=this,e=this.ss.renderManager,i=!1,r=[];this.ks?(this.Gg.children.length=0,e.Xr.forEach(function(t){"model"===t.name||"extent"==t.name||"externalModel"==t.name||"dynamicModel"==t.name?(("externalModel"!==t.name||"externalModel"===t.name&&i)&&0<t.children.length&&("DirectionalLight"===t.children[0].type||"AmbientLight"===t.children[0].type)&&(t.children[0].visible=!1,t.children[1].visible=!1,t.children[2].visible=!1),"externalModel"!==t.name||i||(i=!0,t.traverse(function(t){"PointLight"===t.type&&r.push(t),"Mesh"===t.type&&(t.userData.resetLight=!0)})),"model"!==t.name&&"extent"!==t.name||t.traverse(function(t){"Mesh"===t.type&&(t.userData.resetLight=!0,t.onBeforeRender=function(){r.forEach(function(t){t.userData.intensity=t.intensity,t.intensity=0})},t.onAfterRender=function(){r.forEach(function(t){t.intensity=t.userData.intensity,delete t.userData.intensity})})})):0<t.children.length&&("DirectionalLight"===t.children[0].type||"AmbientLight"===t.children[0].type)&&(t.children[0].visible=!1,t.children[1].visible=!1,t.children[2].visible=!1),n.Gg.add(t)}),this.Xg.setPass(this.Gg),this.Hg.render(),e.renderer.setRenderTarget(null),e.Xr.forEach(function(t){"model"!==t.name&&"externalModel"!==t.name&&"extent"!==t.name&&"dynamicModel"!==t.name&&e.renderer.render(t,e.Lt.ze)})):e.Xr.forEach(function(t){"externalModel"!==t.name&&0<t.children.length&&("DirectionalLight"===t.children[0].type||"AmbientLight"===t.children[0].type)&&(t.children[0].visible=!0,t.children[1].visible=!0,t.children[2].visible=!0),e.renderer.render(t,e.Lt.ze)})}}])&&h3(t.prototype,n),e&&h3(t,e),Object.defineProperty(t,"prototype",{writable:!1}),s}(),v3={WHITE:new lt(16777215),BLACK:new lt(0),TRANSPARENT:new lt(0,0,0)},p3={clone:l3,equals:d3,ZERO:new Mt(0,0)},m3={clone:l3,equals:d3,ZERO:new xt(0,0)};function y3(t,n){return null!=t?t:n}y3.EMPTY_OBJECT=Object.freeze({});var y=y3,b3=Object.freeze({CENTER:0,BOTTOM:1,BASELINE:2,TOP:-1}),g3=Object.freeze({CENTER:0,LEFT:1,RIGHT:-1});function w3(t){return(w3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _3(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=w3(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=w3(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==w3(t)?t:String(t)}(i.key),i)}}var E3=function(){function e(t,n){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.Wg=n,this.Yg=new Mt(0,0),this.Qg=m3.clone(y(t.eyeOffset,m3.ZERO)),this.Zg=y(t.verticalOrigin,b3.CENTER),this.qg=y(t.horizontalOrigin,g3.CENTER),this.fb=y(t.scale,1)}var t,n,i;return t=e,(n=[{key:"horizontalOrigin",get:function(){return this.qg},set:function(t){this.qg=t}},{key:"verticalOrigin",get:function(){return this.Zg},set:function(t){this.Zg=t}},{key:"image",get:function(){return this.Kg},set:function(t){this.setImage(t,t)}},{key:"setImage",value:function(t,n){this.Jg=-1,this.$g=void 0,this.Kg=t,this.tw=n,I(this.Wg.nw)&&this._loadImage()}},{key:"_loadImage",value:function(){var t,e=this,i=this.Wg.nw,r=this.Kg,o=this.tw;I(o)&&(t=i.addImage(r,o)),I(this.ew=t)&&t.then(function(t){var n;e.Kg===r&&e.tw===o&&(n=i.textureCoordinates[t],e.iw=i.texture.width*n.width,e.rw=i.texture.height*n.height,e.Jg=t,e.ow=!0,e.tw=void 0,e.ew=void 0,I(t=(n=e).Wg))&&(t._updateBillboard(n),n.Nv=!0)}).catch(function(t){console.error("Error loading image for billboard: ".concat(t)),e.ew=void 0})}},{key:"_setTranslate",value:function(t){var n=this.Yg;p3.equals(n,t)||p3.clone(t,n)}}])&&_3(t.prototype,n),i&&_3(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function S3(t){var n;this.name="DeveloperError",this.message=t;try{throw new Error}catch(t){n=t.stack}this.stack=n}I(Object.create)&&((S3.prototype=Object.create(Error.prototype)).constructor=S3),S3.prototype.toString=function(){var t="".concat(this.name,": ").concat(this.message);return I(this.stack)&&(t+="\n".concat(this.stack.toString())),t},S3.throwInstantiationError=function(){throw new S3("This function defines an interface and should not be called directly.")};var m=S3;function T3(t){return(T3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var x3={};function A3(t,n,e){return"Expected ".concat(e," to be typeof ").concat(n,", actual typeof was ").concat(t)}x3.typeOf={},x3.defined=function(t,n){if(!I(n))throw new m("".concat(t," is required, actual value was undefined"))},x3.typeOf.func=function(t,n){if("function"!=typeof n)throw new m(A3(T3(n),"function",t))},x3.typeOf.string=function(t,n){if("string"!=typeof n)throw new m(A3(T3(n),"string",t))},x3.typeOf.number=function(t,n){if("number"!=typeof n)throw new m(A3(T3(n),"number",t))},x3.typeOf.number.lessThan=function(t,n,e){if(x3.typeOf.number(t,n),e<=n)throw new m("Expected ".concat(t," to be less than ").concat(e,", actual value was ").concat(n))},x3.typeOf.number.lessThanOrEquals=function(t,n,e){if(x3.typeOf.number(t,n),e<n)throw new m("Expected ".concat(t," to be less than or equal to ").concat(e,", actual value was ").concat(n))},x3.typeOf.number.greaterThan=function(t,n,e){if(x3.typeOf.number(t,n),n<=e)throw new m("Expected ".concat(t," to be greater than ").concat(e,", actual value was ").concat(n))},x3.typeOf.number.greaterThanOrEquals=function(t,n,e){if(x3.typeOf.number(t,n),n<e)throw new m("Expected ".concat(t," to be greater than or equal to ").concat(e,", actual value was ").concat(n))},x3.typeOf.object=function(t,n){if("object"!==T3(n))throw new m(A3(T3(n),"object",t))},x3.typeOf.bool=function(t,n){if("boolean"!=typeof n)throw new m(A3(T3(n),"boolean",t))},x3.typeOf.bigint=function(t,n){if("bigint"!=typeof n)throw new m(A3(T3(n),"bigint",t))},x3.typeOf.number.equals=function(t,n,e,i){if(x3.typeOf.number(t,e),x3.typeOf.number(n,i),e!==i)throw new m("".concat(t," must be equal to ").concat(n,", the actual values are ").concat(e," and ").concat(i))};var U=x3;function M3(t){return(M3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function O3(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=M3(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=M3(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==M3(t)?t:String(t)}(i.key),i)}}var L3=Math.PI/180,H=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")}var n,e,i;return n=t,i=[{key:"equalsEpsilon",value:function(t,n,e,i){if(!I(t))throw new m("left is required.");if(!I(n))throw new m("right is required.");e=y(e,0),i=y(i,e);var r=Math.abs(t-n);return r<=i||r<=e*Math.max(Math.abs(t),Math.abs(n))}},{key:"toRadians",value:function(t){if(I(t))return t*L3;throw new m("degrees is required.")}}],(e=null)&&O3(n.prototype,e),i&&O3(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}();function c(t,n,e){this.x=y(t,0),this.y=y(n,0),this.z=y(e,0)}c.fromSpherical=function(t,n){U.typeOf.object("spherical",t),I(n)||(n=new c);var e=t.clock,i=t.cone,t=y(t.magnitude,1),r=t*Math.sin(i);return n.x=r*Math.cos(e),n.y=r*Math.sin(e),n.z=t*Math.cos(i),n},c.fromElements=function(t,n,e,i){return I(i)?(i.x=t,i.y=n,i.z=e,i):new c(t,n,e)},c.fromCartesian4=c.clone=function(t,n){if(I(t))return I(n)?(n.x=t.x,n.y=t.y,n.z=t.z,n):new c(t.x,t.y,t.z)},c.packedLength=3,c.pack=function(t,n,e){return U.typeOf.object("value",t),U.defined("array",n),e=y(e,0),n[e++]=t.x,n[e++]=t.y,n[e]=t.z,n},c.unpack=function(t,n,e){return U.defined("array",t),n=y(n,0),(e=I(e)?e:new c).x=t[n++],e.y=t[n++],e.z=t[n],e},c.packArray=function(t,n){U.defined("array",t);var e=t.length,i=3*e;if(I(n)){if(!Array.isArray(n)&&n.length!==i)throw new m("If result is a typed array, it must have exactly array.length * 3 elements");n.length!==i&&(n.length=i)}else n=new Array(i);for(var r=0;r<e;++r)c.pack(t[r],n,3*r);return n},c.unpackArray=function(t,n){if(U.defined("array",t),U.typeOf.number.greaterThanOrEquals("array.length",t.length,3),t.length%3!=0)throw new m("array length must be a multiple of 3.");var e=t.length;I(n)?n.length=e/3:n=new Array(e/3);for(var i=0;i<e;i+=3){var r=i/3;n[r]=c.unpack(t,i,n[r])}return n},c.fromArray=c.unpack,c.maximumComponent=function(t){return U.typeOf.object("cartesian",t),Math.max(t.x,t.y,t.z)},c.minimumComponent=function(t){return U.typeOf.object("cartesian",t),Math.min(t.x,t.y,t.z)},c.minimumByComponent=function(t,n,e){return U.typeOf.object("first",t),U.typeOf.object("second",n),U.typeOf.object("result",e),e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e.z=Math.min(t.z,n.z),e},c.maximumByComponent=function(t,n,e){return U.typeOf.object("first",t),U.typeOf.object("second",n),U.typeOf.object("result",e),e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e.z=Math.max(t.z,n.z),e},c.clamp=function(t,n,e,i){U.typeOf.object("value",t),U.typeOf.object("min",n),U.typeOf.object("max",e),U.typeOf.object("result",i);var r=H.clamp(t.x,n.x,e.x),o=H.clamp(t.y,n.y,e.y),t=H.clamp(t.z,n.z,e.z);return i.x=r,i.y=o,i.z=t,i},c.magnitudeSquared=function(t){return U.typeOf.object("cartesian",t),t.x*t.x+t.y*t.y+t.z*t.z},c.magnitude=function(t){return Math.sqrt(c.magnitudeSquared(t))};var R3=new c,N3=(c.distance=function(t,n){return U.typeOf.object("left",t),U.typeOf.object("right",n),c.subtract(t,n,R3),c.magnitude(R3)},c.distanceSquared=function(t,n){return U.typeOf.object("left",t),U.typeOf.object("right",n),c.subtract(t,n,R3),c.magnitudeSquared(R3)},c.normalize=function(t,n){U.typeOf.object("cartesian",t),U.typeOf.object("result",n);var e=c.magnitude(t);if(n.x=t.x/e,n.y=t.y/e,n.z=t.z/e,isNaN(n.x)||isNaN(n.y)||isNaN(n.z))throw new m("normalized result is not a number");return n},c.dot=function(t,n){return U.typeOf.object("left",t),U.typeOf.object("right",n),t.x*n.x+t.y*n.y+t.z*n.z},c.multiplyComponents=function(t,n,e){return U.typeOf.object("left",t),U.typeOf.object("right",n),U.typeOf.object("result",e),e.x=t.x*n.x,e.y=t.y*n.y,e.z=t.z*n.z,e},c.divideComponents=function(t,n,e){return U.typeOf.object("left",t),U.typeOf.object("right",n),U.typeOf.object("result",e),e.x=t.x/n.x,e.y=t.y/n.y,e.z=t.z/n.z,e},c.add=function(t,n,e){return U.typeOf.object("left",t),U.typeOf.object("right",n),U.typeOf.object("result",e),e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e},c.subtract=function(t,n,e){return U.typeOf.object("left",t),U.typeOf.object("right",n),U.typeOf.object("result",e),e.x=t.x-n.x,e.y=t.y-n.y,e.z=t.z-n.z,e},c.multiplyByScalar=function(t,n,e){return U.typeOf.object("cartesian",t),U.typeOf.number("scalar",n),U.typeOf.object("result",e),e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e},c.divideByScalar=function(t,n,e){return U.typeOf.object("cartesian",t),U.typeOf.number("scalar",n),U.typeOf.object("result",e),e.x=t.x/n,e.y=t.y/n,e.z=t.z/n,e},c.negate=function(t,n){return U.typeOf.object("cartesian",t),U.typeOf.object("result",n),n.x=-t.x,n.y=-t.y,n.z=-t.z,n},c.abs=function(t,n){return U.typeOf.object("cartesian",t),U.typeOf.object("result",n),n.x=Math.abs(t.x),n.y=Math.abs(t.y),n.z=Math.abs(t.z),n},new c),P3=(c.lerp=function(t,n,e,i){return U.typeOf.object("start",t),U.typeOf.object("end",n),U.typeOf.number("t",e),U.typeOf.object("result",i),c.multiplyByScalar(n,e,N3),i=c.multiplyByScalar(t,1-e,i),c.add(N3,i,i)},new c),j3=new c,F3=(c.angleBetween=function(t,n){U.typeOf.object("left",t),U.typeOf.object("right",n),c.normalize(t,P3),c.normalize(n,j3);t=c.dot(P3,j3),n=c.magnitude(c.cross(P3,j3,P3));return Math.atan2(n,t)},new c),I3=(c.mostOrthogonalAxis=function(t,n){U.typeOf.object("cartesian",t),U.typeOf.object("result",n);t=c.normalize(t,F3);return c.abs(t,t),n=t.x<=t.y?t.x<=t.z?c.clone(c.UNIT_X,n):c.clone(c.UNIT_Z,n):t.y<=t.z?c.clone(c.UNIT_Y,n):c.clone(c.UNIT_Z,n)},c.projectVector=function(t,n,e){U.defined("a",t),U.defined("b",n),U.defined("result",e);t=c.dot(t,n)/c.dot(n,n);return c.multiplyByScalar(n,t,e)},c.equals=function(t,n){return t===n||I(t)&&I(n)&&t.x===n.x&&t.y===n.y&&t.z===n.z},c.equalsArray=function(t,n,e){return t.x===n[e]&&t.y===n[e+1]&&t.z===n[e+2]},c.equalsEpsilon=function(t,n,e,i){return t===n||I(t)&&I(n)&&H.equalsEpsilon(t.x,n.x,e,i)&&H.equalsEpsilon(t.y,n.y,e,i)&&H.equalsEpsilon(t.z,n.z,e,i)},c.cross=function(t,n,e){U.typeOf.object("left",t),U.typeOf.object("right",n),U.typeOf.object("result",e);var i=t.x,r=t.y,t=t.z,o=n.x,s=n.y,n=n.z,a=t*o-i*n,i=i*s-r*o;return e.x=r*n-t*s,e.y=a,e.z=i,e},c.midpoint=function(t,n,e){return U.typeOf.object("left",t),U.typeOf.object("right",n),U.typeOf.object("result",e),e.x=.5*(t.x+n.x),e.y=.5*(t.y+n.y),e.z=.5*(t.z+n.z),e},c.fromDegrees=function(t,n,e,i,r){return U.typeOf.number("longitude",t),U.typeOf.number("latitude",n),t=H.toRadians(t),n=H.toRadians(n),c.fromRadians(t,n,e,i,r)},new c),C3=new c,k3=new c(40680631590769,40680631590769,40408299984661.445),p=(c.fromRadians=function(t,n,e,i,r){U.typeOf.number("longitude",t),U.typeOf.number("latitude",n),e=y(e,0);var i=I(i)?i.radiiSquared:k3,o=Math.cos(n),o=(I3.x=o*Math.cos(t),I3.y=o*Math.sin(t),I3.z=Math.sin(n),I3=c.normalize(I3,I3),c.multiplyComponents(i,I3,C3),Math.sqrt(c.dot(I3,C3)));return C3=c.divideByScalar(C3,o,C3),I3=c.multiplyByScalar(I3,e,I3),I(r)||(r=new c),c.add(C3,I3,r)},c.fromDegreesArray=function(t,n,e){if(U.defined("coordinates",t),t.length<2||t.length%2!=0)throw new m("the number of coordinates must be a multiple of 2 and at least 2");var i=t.length;I(e)?e.length=i/2:e=new Array(i/2);for(var r=0;r<i;r+=2){var o=t[r],s=t[r+1],a=r/2;e[a]=c.fromDegrees(o,s,0,n,e[a])}return e},c.fromRadiansArray=function(t,n,e){if(U.defined("coordinates",t),t.length<2||t.length%2!=0)throw new m("the number of coordinates must be a multiple of 2 and at least 2");var i=t.length;I(e)?e.length=i/2:e=new Array(i/2);for(var r=0;r<i;r+=2){var o=t[r],s=t[r+1],a=r/2;e[a]=c.fromRadians(o,s,0,n,e[a])}return e},c.fromDegreesArrayHeights=function(t,n,e){if(U.defined("coordinates",t),t.length<3||t.length%3!=0)throw new m("the number of coordinates must be a multiple of 3 and at least 3");var i=t.length;I(e)?e.length=i/3:e=new Array(i/3);for(var r=0;r<i;r+=3){var o=t[r],s=t[r+1],a=t[r+2],u=r/3;e[u]=c.fromDegrees(o,s,a,n,e[u])}return e},c.fromRadiansArrayHeights=function(t,n,e){if(U.defined("coordinates",t),t.length<3||t.length%3!=0)throw new m("the number of coordinates must be a multiple of 3 and at least 3");var i=t.length;I(e)?e.length=i/3:e=new Array(i/3);for(var r=0;r<i;r+=3){var o=t[r],s=t[r+1],a=t[r+2],u=r/3;e[u]=c.fromRadians(o,s,a,n,e[u])}return e},c.ZERO=Object.freeze(new c(0,0,0)),c.ONE=Object.freeze(new c(1,1,1)),c.UNIT_X=Object.freeze(new c(1,0,0)),c.UNIT_Y=Object.freeze(new c(0,1,0)),c.UNIT_Z=Object.freeze(new c(0,0,1)),c.prototype.clone=function(t){return c.clone(this,t)},c.prototype.equals=function(t){return c.equals(this,t)},c.prototype.equalsEpsilon=function(t,n,e){return c.equalsEpsilon(this,t,n,e)},c.prototype.toString=function(){return"(".concat(this.x,", ").concat(this.y,", ").concat(this.z,")")},c);function o(t,n,e,i){this.x=y(t,0),this.y=y(n,0),this.z=y(e,0),this.w=y(i,0)}o.fromElements=function(t,n,e,i,r){return I(r)?(r.x=t,r.y=n,r.z=e,r.w=i,r):new o(t,n,e,i)},o.fromColor=function(t,n){return U.typeOf.object("color",t),I(n)?(n.x=t.red,n.y=t.green,n.z=t.blue,n.w=t.alpha,n):new o(t.red,t.green,t.blue,t.alpha)},o.clone=function(t,n){if(I(t))return I(n)?(n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w,n):new o(t.x,t.y,t.z,t.w)},o.packedLength=4,o.pack=function(t,n,e){return U.typeOf.object("value",t),U.defined("array",n),e=y(e,0),n[e++]=t.x,n[e++]=t.y,n[e++]=t.z,n[e]=t.w,n},o.unpack=function(t,n,e){return U.defined("array",t),n=y(n,0),(e=I(e)?e:new o).x=t[n++],e.y=t[n++],e.z=t[n++],e.w=t[n],e},o.packArray=function(t,n){U.defined("array",t);var e=t.length,i=4*e;if(I(n)){if(!Array.isArray(n)&&n.length!==i)throw new m("If result is a typed array, it must have exactly array.length * 4 elements");n.length!==i&&(n.length=i)}else n=new Array(i);for(var r=0;r<e;++r)o.pack(t[r],n,4*r);return n},o.unpackArray=function(t,n){if(U.defined("array",t),U.typeOf.number.greaterThanOrEquals("array.length",t.length,4),t.length%4!=0)throw new m("array length must be a multiple of 4.");var e=t.length;I(n)?n.length=e/4:n=new Array(e/4);for(var i=0;i<e;i+=4){var r=i/4;n[r]=o.unpack(t,i,n[r])}return n},o.fromArray=o.unpack,o.maximumComponent=function(t){return U.typeOf.object("cartesian",t),Math.max(t.x,t.y,t.z,t.w)},o.minimumComponent=function(t){return U.typeOf.object("cartesian",t),Math.min(t.x,t.y,t.z,t.w)},o.minimumByComponent=function(t,n,e){return U.typeOf.object("first",t),U.typeOf.object("second",n),U.typeOf.object("result",e),e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e.z=Math.min(t.z,n.z),e.w=Math.min(t.w,n.w),e},o.maximumByComponent=function(t,n,e){return U.typeOf.object("first",t),U.typeOf.object("second",n),U.typeOf.object("result",e),e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e.z=Math.max(t.z,n.z),e.w=Math.max(t.w,n.w),e},o.clamp=function(t,n,e,i){U.typeOf.object("value",t),U.typeOf.object("min",n),U.typeOf.object("max",e),U.typeOf.object("result",i);var r=H.clamp(t.x,n.x,e.x),o=H.clamp(t.y,n.y,e.y),s=H.clamp(t.z,n.z,e.z),t=H.clamp(t.w,n.w,e.w);return i.x=r,i.y=o,i.z=s,i.w=t,i},o.magnitudeSquared=function(t){return U.typeOf.object("cartesian",t),t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w},o.magnitude=function(t){return Math.sqrt(o.magnitudeSquared(t))};var D3=new o,U3=(o.distance=function(t,n){return U.typeOf.object("left",t),U.typeOf.object("right",n),o.subtract(t,n,D3),o.magnitude(D3)},o.distanceSquared=function(t,n){return U.typeOf.object("left",t),U.typeOf.object("right",n),o.subtract(t,n,D3),o.magnitudeSquared(D3)},o.normalize=function(t,n){U.typeOf.object("cartesian",t),U.typeOf.object("result",n);var e=o.magnitude(t);if(n.x=t.x/e,n.y=t.y/e,n.z=t.z/e,n.w=t.w/e,isNaN(n.x)||isNaN(n.y)||isNaN(n.z)||isNaN(n.w))throw new m("normalized result is not a number");return n},o.dot=function(t,n){return U.typeOf.object("left",t),U.typeOf.object("right",n),t.x*n.x+t.y*n.y+t.z*n.z+t.w*n.w},o.multiplyComponents=function(t,n,e){return U.typeOf.object("left",t),U.typeOf.object("right",n),U.typeOf.object("result",e),e.x=t.x*n.x,e.y=t.y*n.y,e.z=t.z*n.z,e.w=t.w*n.w,e},o.divideComponents=function(t,n,e){return U.typeOf.object("left",t),U.typeOf.object("right",n),U.typeOf.object("result",e),e.x=t.x/n.x,e.y=t.y/n.y,e.z=t.z/n.z,e.w=t.w/n.w,e},o.add=function(t,n,e){return U.typeOf.object("left",t),U.typeOf.object("right",n),U.typeOf.object("result",e),e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e.w=t.w+n.w,e},o.subtract=function(t,n,e){return U.typeOf.object("left",t),U.typeOf.object("right",n),U.typeOf.object("result",e),e.x=t.x-n.x,e.y=t.y-n.y,e.z=t.z-n.z,e.w=t.w-n.w,e},o.multiplyByScalar=function(t,n,e){return U.typeOf.object("cartesian",t),U.typeOf.number("scalar",n),U.typeOf.object("result",e),e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n,e},o.divideByScalar=function(t,n,e){return U.typeOf.object("cartesian",t),U.typeOf.number("scalar",n),U.typeOf.object("result",e),e.x=t.x/n,e.y=t.y/n,e.z=t.z/n,e.w=t.w/n,e},o.negate=function(t,n){return U.typeOf.object("cartesian",t),U.typeOf.object("result",n),n.x=-t.x,n.y=-t.y,n.z=-t.z,n.w=-t.w,n},o.abs=function(t,n){return U.typeOf.object("cartesian",t),U.typeOf.object("result",n),n.x=Math.abs(t.x),n.y=Math.abs(t.y),n.z=Math.abs(t.z),n.w=Math.abs(t.w),n},new o),B3=(o.lerp=function(t,n,e,i){return U.typeOf.object("start",t),U.typeOf.object("end",n),U.typeOf.number("t",e),U.typeOf.object("result",i),o.multiplyByScalar(n,e,U3),i=o.multiplyByScalar(t,1-e,i),o.add(U3,i,i)},new o),G3=(o.mostOrthogonalAxis=function(t,n){U.typeOf.object("cartesian",t),U.typeOf.object("result",n);t=o.normalize(t,B3);return o.abs(t,t),n=t.x<=t.y?t.x<=t.z?t.x<=t.w?o.clone(o.UNIT_X,n):o.clone(o.UNIT_W,n):t.z<=t.w?o.clone(o.UNIT_Z,n):o.clone(o.UNIT_W,n):t.y<=t.z?t.y<=t.w?o.clone(o.UNIT_Y,n):o.clone(o.UNIT_W,n):t.z<=t.w?o.clone(o.UNIT_Z,n):o.clone(o.UNIT_W,n)},o.equals=function(t,n){return t===n||I(t)&&I(n)&&t.x===n.x&&t.y===n.y&&t.z===n.z&&t.w===n.w},o.equalsArray=function(t,n,e){return t.x===n[e]&&t.y===n[e+1]&&t.z===n[e+2]&&t.w===n[e+3]},o.equalsEpsilon=function(t,n,e,i){return t===n||I(t)&&I(n)&&H.equalsEpsilon(t.x,n.x,e,i)&&H.equalsEpsilon(t.y,n.y,e,i)&&H.equalsEpsilon(t.z,n.z,e,i)&&H.equalsEpsilon(t.w,n.w,e,i)},o.ZERO=Object.freeze(new o(0,0,0,0)),o.ONE=Object.freeze(new o(1,1,1,1)),o.UNIT_X=Object.freeze(new o(1,0,0,0)),o.UNIT_Y=Object.freeze(new o(0,1,0,0)),o.UNIT_Z=Object.freeze(new o(0,0,1,0)),o.UNIT_W=Object.freeze(new o(0,0,0,1)),o.prototype.clone=function(t){return o.clone(this,t)},o.prototype.equals=function(t){return o.equals(this,t)},o.prototype.equalsEpsilon=function(t,n,e){return o.equalsEpsilon(this,t,n,e)},o.prototype.toString=function(){return"(".concat(this.x,", ").concat(this.y,", ").concat(this.z,", ").concat(this.w,")")},new Float32Array(1)),H3=new Uint8Array(G3.buffer),Dv=new Uint32Array([287454020]),X3=68===new Uint8Array(Dv.buffer)[0],z3=(o.packFloat=function(t,n){return U.typeOf.number("value",t),I(n)||(n=new o),G3[0]=t,X3?(n.x=H3[0],n.y=H3[1],n.z=H3[2],n.w=H3[3]):(n.x=H3[3],n.y=H3[2],n.z=H3[1],n.w=H3[0]),n},o.unpackFloat=function(t){return U.typeOf.object("packedFloat",t),X3?(H3[0]=t.x,H3[1]=t.y,H3[2]=t.z,H3[3]=t.w):(H3[0]=t.w,H3[1]=t.z,H3[2]=t.y,H3[3]=t.x),G3[0]},o);function w(t,n,e,i,r,o,s,a,u){this[0]=y(t,0),this[1]=y(i,0),this[2]=y(s,0),this[3]=y(n,0),this[4]=y(r,0),this[5]=y(a,0),this[6]=y(e,0),this[7]=y(o,0),this[8]=y(u,0)}w.packedLength=9,w.pack=function(t,n,e){return U.typeOf.object("value",t),U.defined("array",n),e=y(e,0),n[e++]=t[0],n[e++]=t[1],n[e++]=t[2],n[e++]=t[3],n[e++]=t[4],n[e++]=t[5],n[e++]=t[6],n[e++]=t[7],n[e++]=t[8],n},w.unpack=function(t,n,e){return U.defined("array",t),n=y(n,0),(e=I(e)?e:new w)[0]=t[n++],e[1]=t[n++],e[2]=t[n++],e[3]=t[n++],e[4]=t[n++],e[5]=t[n++],e[6]=t[n++],e[7]=t[n++],e[8]=t[n++],e},w.packArray=function(t,n){U.defined("array",t);var e=t.length,i=9*e;if(I(n)){if(!Array.isArray(n)&&n.length!==i)throw new m("If result is a typed array, it must have exactly array.length * 9 elements");n.length!==i&&(n.length=i)}else n=new Array(i);for(var r=0;r<e;++r)w.pack(t[r],n,9*r);return n},w.unpackArray=function(t,n){if(U.defined("array",t),U.typeOf.number.greaterThanOrEquals("array.length",t.length,9),t.length%9!=0)throw new m("array length must be a multiple of 9.");var e=t.length;I(n)?n.length=e/9:n=new Array(e/9);for(var i=0;i<e;i+=9){var r=i/9;n[r]=w.unpack(t,i,n[r])}return n},w.clone=function(t,n){if(I(t))return I(n)?(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n):new w(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])},w.fromArray=w.unpack,w.fromColumnMajorArray=function(t,n){return U.defined("values",t),w.clone(t,n)},w.fromRowMajorArray=function(t,n){return U.defined("values",t),I(n)?(n[0]=t[0],n[1]=t[3],n[2]=t[6],n[3]=t[1],n[4]=t[4],n[5]=t[7],n[6]=t[2],n[7]=t[5],n[8]=t[8],n):new w(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},w.fromQuaternion=function(t,n){U.typeOf.object("quaternion",t);var e=t.x*t.x,i=t.x*t.y,r=t.x*t.z,o=t.x*t.w,s=t.y*t.y,a=t.y*t.z,u=t.y*t.w,c=t.z*t.z,f=t.z*t.w,t=t.w*t.w,h=e-s-c+t,l=2*(i-f),d=2*(r+u),i=2*(i+f),f=s-e-c+t,v=2*(a-o),r=2*(r-u),u=2*(a+o),a=-e-s+c+t;return I(n)?(n[0]=h,n[1]=i,n[2]=r,n[3]=l,n[4]=f,n[5]=u,n[6]=d,n[7]=v,n[8]=a,n):new w(h,l,d,i,f,v,r,u,a)},w.fromHeadingPitchRoll=function(t,n){U.typeOf.object("headingPitchRoll",t);var e=Math.cos(-t.pitch),i=Math.cos(-t.heading),r=Math.cos(t.roll),o=Math.sin(-t.pitch),s=Math.sin(-t.heading),t=Math.sin(t.roll),a=e*i,u=-r*s+t*o*i,c=t*s+r*o*i,f=e*s,h=r*i+t*o*s,i=-t*i+r*o*s,s=-o,o=t*e,t=r*e;return I(n)?(n[0]=a,n[1]=f,n[2]=s,n[3]=u,n[4]=h,n[5]=o,n[6]=c,n[7]=i,n[8]=t,n):new w(a,u,c,f,h,i,s,o,t)},w.fromScale=function(t,n){return U.typeOf.object("scale",t),I(n)?(n[0]=t.x,n[1]=0,n[2]=0,n[3]=0,n[4]=t.y,n[5]=0,n[6]=0,n[7]=0,n[8]=t.z,n):new w(t.x,0,0,0,t.y,0,0,0,t.z)},w.fromUniformScale=function(t,n){return U.typeOf.number("scale",t),I(n)?(n[0]=t,n[1]=0,n[2]=0,n[3]=0,n[4]=t,n[5]=0,n[6]=0,n[7]=0,n[8]=t,n):new w(t,0,0,0,t,0,0,0,t)},w.fromCrossProduct=function(t,n){return U.typeOf.object("vector",t),I(n)?(n[0]=0,n[1]=t.z,n[2]=-t.y,n[3]=-t.z,n[4]=0,n[5]=t.x,n[6]=t.y,n[7]=-t.x,n[8]=0,n):new w(0,-t.z,t.y,t.z,0,-t.x,-t.y,t.x,0)},w.fromRotationX=function(t,n){U.typeOf.number("angle",t);var e=Math.cos(t),t=Math.sin(t);return I(n)?(n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=e,n[5]=t,n[6]=0,n[7]=-t,n[8]=e,n):new w(1,0,0,0,e,-t,0,t,e)},w.fromRotationY=function(t,n){U.typeOf.number("angle",t);var e=Math.cos(t),t=Math.sin(t);return I(n)?(n[0]=e,n[1]=0,n[2]=-t,n[3]=0,n[4]=1,n[5]=0,n[6]=t,n[7]=0,n[8]=e,n):new w(e,0,t,0,1,0,-t,0,e)},w.fromRotationZ=function(t,n){U.typeOf.number("angle",t);var e=Math.cos(t),t=Math.sin(t);return I(n)?(n[0]=e,n[1]=t,n[2]=0,n[3]=-t,n[4]=e,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n):new w(e,-t,0,t,e,0,0,0,1)},w.toArray=function(t,n){return U.typeOf.object("matrix",t),I(n)?(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n):[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]},w.getElementIndex=function(t,n){return U.typeOf.number.greaterThanOrEquals("row",n,0),U.typeOf.number.lessThanOrEquals("row",n,2),U.typeOf.number.greaterThanOrEquals("column",t,0),U.typeOf.number.lessThanOrEquals("column",t,2),3*t+n},w.getColumn=function(t,n,e){U.typeOf.object("matrix",t),U.typeOf.number.greaterThanOrEquals("index",n,0),U.typeOf.number.lessThanOrEquals("index",n,2),U.typeOf.object("result",e);var n=3*n,i=t[n],r=t[1+n],t=t[2+n];return e.x=i,e.y=r,e.z=t,e},w.setColumn=function(t,n,e,i){U.typeOf.object("matrix",t),U.typeOf.number.greaterThanOrEquals("index",n,0),U.typeOf.number.lessThanOrEquals("index",n,2),U.typeOf.object("cartesian",e),U.typeOf.object("result",i);n*=3;return(i=w.clone(t,i))[n]=e.x,i[1+n]=e.y,i[2+n]=e.z,i},w.getRow=function(t,n,e){U.typeOf.object("matrix",t),U.typeOf.number.greaterThanOrEquals("index",n,0),U.typeOf.number.lessThanOrEquals("index",n,2),U.typeOf.object("result",e);var i=t[n],r=t[n+3],t=t[n+6];return e.x=i,e.y=r,e.z=t,e},w.setRow=function(t,n,e,i){return U.typeOf.object("matrix",t),U.typeOf.number.greaterThanOrEquals("index",n,0),U.typeOf.number.lessThanOrEquals("index",n,2),U.typeOf.object("cartesian",e),U.typeOf.object("result",i),(i=w.clone(t,i))[n]=e.x,i[n+3]=e.y,i[n+6]=e.z,i};var V3=new p,W3=(w.setScale=function(t,n,e){U.typeOf.object("matrix",t),U.typeOf.object("scale",n),U.typeOf.object("result",e);var i=w.getScale(t,V3),r=n.x/i.x,o=n.y/i.y,n=n.z/i.z;return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*o,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},new p),Y3=(w.setUniformScale=function(t,n,e){U.typeOf.object("matrix",t),U.typeOf.number("scale",n),U.typeOf.object("result",e);var i=w.getScale(t,W3),r=n/i.x,o=n/i.y,n=n/i.z;return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*o,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},new p),Q3=(w.getScale=function(t,n){return U.typeOf.object("matrix",t),U.typeOf.object("result",n),n.x=p.magnitude(p.fromElements(t[0],t[1],t[2],Y3)),n.y=p.magnitude(p.fromElements(t[3],t[4],t[5],Y3)),n.z=p.magnitude(p.fromElements(t[6],t[7],t[8],Y3)),n},new p),Z3=(w.getMaximumScale=function(t){return w.getScale(t,Q3),p.maximumComponent(Q3)},new p),q3=(w.setRotation=function(t,n,e){U.typeOf.object("matrix",t),U.typeOf.object("result",e);t=w.getScale(t,Z3);return e[0]=n[0]*t.x,e[1]=n[1]*t.x,e[2]=n[2]*t.x,e[3]=n[3]*t.y,e[4]=n[4]*t.y,e[5]=n[5]*t.y,e[6]=n[6]*t.z,e[7]=n[7]*t.z,e[8]=n[8]*t.z,e},new p);w.getRotation=function(t,n){U.typeOf.object("matrix",t),U.typeOf.object("result",n);var e=w.getScale(t,q3);return n[0]=t[0]/e.x,n[1]=t[1]/e.x,n[2]=t[2]/e.x,n[3]=t[3]/e.y,n[4]=t[4]/e.y,n[5]=t[5]/e.y,n[6]=t[6]/e.z,n[7]=t[7]/e.z,n[8]=t[8]/e.z,n},w.multiply=function(t,n,e){U.typeOf.object("left",t),U.typeOf.object("right",n),U.typeOf.object("result",e);var i=t[0]*n[0]+t[3]*n[1]+t[6]*n[2],r=t[1]*n[0]+t[4]*n[1]+t[7]*n[2],o=t[2]*n[0]+t[5]*n[1]+t[8]*n[2],s=t[0]*n[3]+t[3]*n[4]+t[6]*n[5],a=t[1]*n[3]+t[4]*n[4]+t[7]*n[5],u=t[2]*n[3]+t[5]*n[4]+t[8]*n[5],c=t[0]*n[6]+t[3]*n[7]+t[6]*n[8],f=t[1]*n[6]+t[4]*n[7]+t[7]*n[8],t=t[2]*n[6]+t[5]*n[7]+t[8]*n[8];return e[0]=i,e[1]=r,e[2]=o,e[3]=s,e[4]=a,e[5]=u,e[6]=c,e[7]=f,e[8]=t,e},w.add=function(t,n,e){return U.typeOf.object("left",t),U.typeOf.object("right",n),U.typeOf.object("result",e),e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},w.subtract=function(t,n,e){return U.typeOf.object("left",t),U.typeOf.object("right",n),U.typeOf.object("result",e),e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e},w.multiplyByVector=function(t,n,e){U.typeOf.object("matrix",t),U.typeOf.object("cartesian",n),U.typeOf.object("result",e);var i=n.x,r=n.y,n=n.z,o=t[0]*i+t[3]*r+t[6]*n,s=t[1]*i+t[4]*r+t[7]*n,i=t[2]*i+t[5]*r+t[8]*n;return e.x=o,e.y=s,e.z=i,e},w.multiplyByScalar=function(t,n,e){return U.typeOf.object("matrix",t),U.typeOf.number("scalar",n),U.typeOf.object("result",e),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},w.multiplyByScale=function(t,n,e){return U.typeOf.object("matrix",t),U.typeOf.object("scale",n),U.typeOf.object("result",e),e[0]=t[0]*n.x,e[1]=t[1]*n.x,e[2]=t[2]*n.x,e[3]=t[3]*n.y,e[4]=t[4]*n.y,e[5]=t[5]*n.y,e[6]=t[6]*n.z,e[7]=t[7]*n.z,e[8]=t[8]*n.z,e},w.multiplyByUniformScale=function(t,n,e){return U.typeOf.object("matrix",t),U.typeOf.number("scale",n),U.typeOf.object("result",e),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},w.negate=function(t,n){return U.typeOf.object("matrix",t),U.typeOf.object("result",n),n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n[4]=-t[4],n[5]=-t[5],n[6]=-t[6],n[7]=-t[7],n[8]=-t[8],n},w.transpose=function(t,n){U.typeOf.object("matrix",t),U.typeOf.object("result",n);var e=t[0],i=t[3],r=t[6],o=t[1],s=t[4],a=t[7],u=t[2],c=t[5],t=t[8];return n[0]=e,n[1]=i,n[2]=r,n[3]=o,n[4]=s,n[5]=a,n[6]=u,n[7]=c,n[8]=t,n};var K3=[1,0,0],J3=[2,2,1];var $3=new w,tA=new w,nA=(w.computeEigenDecomposition=function(t,n){U.typeOf.object("matrix",t);for(var e=H.EPSILON20,i=0,r=0,o=(n=I(n)?n:{}).unitary=w.clone(w.IDENTITY,n.unitary),s=n.diagonal=w.clone(t,n.diagonal),a=e*function(t){for(var n=0,e=0;e<9;++e){var i=t[e];n+=i*i}return Math.sqrt(n)}(s);r<10&&function(t){for(var n=0,e=0;e<3;++e){var i=t[w.getElementIndex(J3[e],K3[e])];n+=2*i*i}return Math.sqrt(n)}(s)>a;){b=y=m=p=v=d=l=h=f=c=u=void 0;for(var u=s,c=$3,f=H.EPSILON15,h=0,l=1,d=0;d<3;++d){var v=Math.abs(u[w.getElementIndex(J3[d],K3[d])]);h<v&&(l=d,h=v)}var p=1,m=0,y=K3[l],b=J3[l];Math.abs(u[w.getElementIndex(b,y)])>f&&(m=(f=(f=(u[w.getElementIndex(b,b)]-u[w.getElementIndex(y,y)])/2/u[w.getElementIndex(b,y)])<0?-1/(-f+Math.sqrt(1+f*f)):1/(f+Math.sqrt(1+f*f)))*(p=1/Math.sqrt(1+f*f))),(c=w.clone(w.IDENTITY,c))[w.getElementIndex(y,y)]=c[w.getElementIndex(b,b)]=p,c[w.getElementIndex(b,y)]=m,c[w.getElementIndex(y,b)]=-m,w.transpose($3,tA),w.multiply(s,$3,s),w.multiply(tA,s,s),w.multiply(o,$3,o),2<++i&&(++r,i=0)}return n},w.abs=function(t,n){return U.typeOf.object("matrix",t),U.typeOf.object("result",n),n[0]=Math.abs(t[0]),n[1]=Math.abs(t[1]),n[2]=Math.abs(t[2]),n[3]=Math.abs(t[3]),n[4]=Math.abs(t[4]),n[5]=Math.abs(t[5]),n[6]=Math.abs(t[6]),n[7]=Math.abs(t[7]),n[8]=Math.abs(t[8]),n},w.determinant=function(t){U.typeOf.object("matrix",t);var n=t[0],e=t[3],i=t[6],r=t[1],o=t[4],s=t[7],a=t[2],u=t[5],t=t[8];return n*(o*t-u*s)+r*(u*i-e*t)+a*(e*s-o*i)},w.inverse=function(t,n){U.typeOf.object("matrix",t),U.typeOf.object("result",n);var e=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],u=t[6],c=t[7],f=t[8],t=w.determinant(t);if(Math.abs(t)<=H.EPSILON15)throw new m("matrix is not invertible");return n[0]=s*f-c*a,n[1]=c*r-i*f,n[2]=i*a-s*r,n[3]=u*a-o*f,n[4]=e*f-u*r,n[5]=o*r-e*a,n[6]=o*c-u*s,n[7]=u*i-e*c,n[8]=e*s-o*i,w.multiplyByScalar(n,1/t,n)},new w),eA=(w.inverseTranspose=function(t,n){return U.typeOf.object("matrix",t),U.typeOf.object("result",n),w.inverse(w.transpose(t,nA),n)},w.equals=function(t,n){return t===n||I(t)&&I(n)&&t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]},w.equalsEpsilon=function(t,n,e){return e=y(e,0),t===n||I(t)&&I(n)&&Math.abs(t[0]-n[0])<=e&&Math.abs(t[1]-n[1])<=e&&Math.abs(t[2]-n[2])<=e&&Math.abs(t[3]-n[3])<=e&&Math.abs(t[4]-n[4])<=e&&Math.abs(t[5]-n[5])<=e&&Math.abs(t[6]-n[6])<=e&&Math.abs(t[7]-n[7])<=e&&Math.abs(t[8]-n[8])<=e},w.IDENTITY=Object.freeze(new w(1,0,0,0,1,0,0,0,1)),w.ZERO=Object.freeze(new w(0,0,0,0,0,0,0,0,0)),w.COLUMN0ROW0=0,w.COLUMN0ROW1=1,w.COLUMN0ROW2=2,w.COLUMN1ROW0=3,w.COLUMN1ROW1=4,w.COLUMN1ROW2=5,w.COLUMN2ROW0=6,w.COLUMN2ROW1=7,w.COLUMN2ROW2=8,Object.defineProperties(w.prototype,{length:{get:function(){return w.packedLength}}}),w.prototype.clone=function(t){return w.clone(this,t)},w.prototype.equals=function(t){return w.equals(this,t)},w.equalsArray=function(t,n,e){return t[0]===n[e]&&t[1]===n[e+1]&&t[2]===n[e+2]&&t[3]===n[e+3]&&t[4]===n[e+4]&&t[5]===n[e+5]&&t[6]===n[e+6]&&t[7]===n[e+7]&&t[8]===n[e+8]},w.prototype.equalsEpsilon=function(t,n){return w.equalsEpsilon(this,t,n)},w.prototype.toString=function(){return"(".concat(this[0],", ").concat(this[3],", ").concat(this[6],")\n")+"(".concat(this[1],", ").concat(this[4],", ").concat(this[7],")\n")+"(".concat(this[2],", ").concat(this[5],", ").concat(this[8],")")},w);function iA(t){var n;this.name="RuntimeError",this.message=t;try{throw new Error}catch(t){n=t.stack}this.stack=n}I(Object.create)&&((iA.prototype=Object.create(Error.prototype)).constructor=iA),iA.prototype.toString=function(){var t="".concat(this.name,": ").concat(this.message);return I(this.stack)&&(t+="\n".concat(this.stack.toString())),t};var rA=iA;function X(t,n,e,i,r,o,s,a,u,c,f,h,l,d,v,p){this[0]=y(t,0),this[1]=y(r,0),this[2]=y(u,0),this[3]=y(l,0),this[4]=y(n,0),this[5]=y(o,0),this[6]=y(c,0),this[7]=y(d,0),this[8]=y(e,0),this[9]=y(s,0),this[10]=y(f,0),this[11]=y(v,0),this[12]=y(i,0),this[13]=y(a,0),this[14]=y(h,0),this[15]=y(p,0)}X.packedLength=16,X.pack=function(t,n,e){return U.typeOf.object("value",t),U.defined("array",n),e=y(e,0),n[e++]=t[0],n[e++]=t[1],n[e++]=t[2],n[e++]=t[3],n[e++]=t[4],n[e++]=t[5],n[e++]=t[6],n[e++]=t[7],n[e++]=t[8],n[e++]=t[9],n[e++]=t[10],n[e++]=t[11],n[e++]=t[12],n[e++]=t[13],n[e++]=t[14],n[e]=t[15],n},X.unpack=function(t,n,e){return U.defined("array",t),n=y(n,0),(e=I(e)?e:new X)[0]=t[n++],e[1]=t[n++],e[2]=t[n++],e[3]=t[n++],e[4]=t[n++],e[5]=t[n++],e[6]=t[n++],e[7]=t[n++],e[8]=t[n++],e[9]=t[n++],e[10]=t[n++],e[11]=t[n++],e[12]=t[n++],e[13]=t[n++],e[14]=t[n++],e[15]=t[n],e},X.packArray=function(t,n){U.defined("array",t);var e=t.length,i=16*e;if(I(n)){if(!Array.isArray(n)&&n.length!==i)throw new m("If result is a typed array, it must have exactly array.length * 16 elements");n.length!==i&&(n.length=i)}else n=new Array(i);for(var r=0;r<e;++r)X.pack(t[r],n,16*r);return n},X.unpackArray=function(t,n){if(U.defined("array",t),U.typeOf.number.greaterThanOrEquals("array.length",t.length,16),t.length%16!=0)throw new m("array length must be a multiple of 16.");var e=t.length;I(n)?n.length=e/16:n=new Array(e/16);for(var i=0;i<e;i+=16){var r=i/16;n[r]=X.unpack(t,i,n[r])}return n},X.clone=function(t,n){if(I(t))return I(n)?(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n):new X(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])},X.fromArray=X.unpack,X.fromColumnMajorArray=function(t,n){return U.defined("values",t),X.clone(t,n)},X.fromRowMajorArray=function(t,n){return U.defined("values",t),I(n)?(n[0]=t[0],n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=t[1],n[5]=t[5],n[6]=t[9],n[7]=t[13],n[8]=t[2],n[9]=t[6],n[10]=t[10],n[11]=t[14],n[12]=t[3],n[13]=t[7],n[14]=t[11],n[15]=t[15],n):new X(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},X.fromRotationTranslation=function(t,n,e){return U.typeOf.object("rotation",t),n=y(n,p.ZERO),I(e)?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=0,e[4]=t[3],e[5]=t[4],e[6]=t[5],e[7]=0,e[8]=t[6],e[9]=t[7],e[10]=t[8],e[11]=0,e[12]=n.x,e[13]=n.y,e[14]=n.z,e[15]=1,e):new X(t[0],t[3],t[6],n.x,t[1],t[4],t[7],n.y,t[2],t[5],t[8],n.z,0,0,0,1)},X.fromTranslationQuaternionRotationScale=function(t,n,e,i){U.typeOf.object("translation",t),U.typeOf.object("rotation",n),U.typeOf.object("scale",e),I(i)||(i=new X);var r=e.x,o=e.y,e=e.z,s=n.x*n.x,a=n.x*n.y,u=n.x*n.z,c=n.x*n.w,f=n.y*n.y,h=n.y*n.z,l=n.y*n.w,d=n.z*n.z,v=n.z*n.w,n=n.w*n.w,p=2*(a-v),m=2*(u+l),a=2*(a+v),v=f-s-d+n,y=2*(h-c),u=2*(u-l),l=2*(h+c),h=-s-f+d+n;return i[0]=(s-f-d+n)*r,i[1]=a*r,i[2]=u*r,i[3]=0,i[4]=p*o,i[5]=v*o,i[6]=l*o,i[7]=0,i[8]=m*e,i[9]=y*e,i[10]=h*e,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,i},X.fromTranslationRotationScale=function(t,n){return U.typeOf.object("translationRotationScale",t),X.fromTranslationQuaternionRotationScale(t.translation,t.rotation,t.scale,n)},X.fromTranslation=function(t,n){return U.typeOf.object("translation",t),X.fromRotationTranslation(eA.IDENTITY,t,n)},X.fromScale=function(t,n){return U.typeOf.object("scale",t),I(n)?(n[0]=t.x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t.y,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t.z,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n):new X(t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1)},X.fromUniformScale=function(t,n){return U.typeOf.number("scale",t),I(n)?(n[0]=t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n):new X(t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1)},X.fromRotation=function(t,n){return U.typeOf.object("rotation",t),(n=I(n)?n:new X)[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=0,n[4]=t[3],n[5]=t[4],n[6]=t[5],n[7]=0,n[8]=t[6],n[9]=t[7],n[10]=t[8],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n};var oA=new p,sA=new p,aA=new p,uA=(X.fromCamera=function(t,n){U.typeOf.object("camera",t);var e=t.position,i=t.direction,t=t.up,i=(U.typeOf.object("camera.position",e),U.typeOf.object("camera.direction",i),U.typeOf.object("camera.up",t),p.normalize(i,oA),p.normalize(p.cross(oA,t,sA),sA),p.normalize(p.cross(sA,oA,aA),aA),sA.x),t=sA.y,r=sA.z,o=oA.x,s=oA.y,a=oA.z,u=aA.x,c=aA.y,f=aA.z,h=e.x,l=e.y,e=e.z,d=i*-h+t*-l+r*-e,v=u*-h+c*-l+f*-e,h=o*h+s*l+a*e;return I(n)?(n[0]=i,n[1]=u,n[2]=-o,n[3]=0,n[4]=t,n[5]=c,n[6]=-s,n[7]=0,n[8]=r,n[9]=f,n[10]=-a,n[11]=0,n[12]=d,n[13]=v,n[14]=h,n[15]=1,n):new X(i,t,r,d,u,c,f,v,-o,-s,-a,h,0,0,0,1)},X.computePerspectiveFieldOfView=function(t,n,e,i,r){U.typeOf.number.greaterThan("fovY",t,0),U.typeOf.number.lessThan("fovY",t,Math.PI),U.typeOf.number.greaterThan("near",e,0),U.typeOf.number.greaterThan("far",i,0),U.typeOf.object("result",r);var t=1/Math.tan(.5*t),o=(i+e)/(e-i),e=2*i*e/(e-i);return r[0]=t/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=o,r[11]=-1,r[12]=0,r[13]=0,r[14]=e,r[15]=0,r},X.computeOrthographicOffCenter=function(t,n,e,i,r,o,s){U.typeOf.number("left",t),U.typeOf.number("right",n),U.typeOf.number("bottom",e),U.typeOf.number("top",i),U.typeOf.number("near",r),U.typeOf.number("far",o),U.typeOf.object("result",s);var a=1/(n-t),u=1/(i-e),c=1/(o-r),n=-(n+t)*a,t=-(i+e)*u,i=-(o+r)*c;return u*=2,c*=-2,s[0]=a*=2,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=u,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=c,s[11]=0,s[12]=n,s[13]=t,s[14]=i,s[15]=1,s},X.computePerspectiveOffCenter=function(t,n,e,i,r,o,s){U.typeOf.number("left",t),U.typeOf.number("right",n),U.typeOf.number("bottom",e),U.typeOf.number("top",i),U.typeOf.number("near",r),U.typeOf.number("far",o),U.typeOf.object("result",s);var a=2*r/(i-e),u=(n+t)/(n-t),i=(i+e)/(i-e),e=-(o+r)/(o-r),o=-2*o*r/(o-r);return s[0]=2*r/(n-t),s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=a,s[6]=0,s[7]=0,s[8]=u,s[9]=i,s[10]=e,s[11]=-1,s[12]=0,s[13]=0,s[14]=o,s[15]=0,s},X.computeInfinitePerspectiveOffCenter=function(t,n,e,i,r,o){U.typeOf.number("left",t),U.typeOf.number("right",n),U.typeOf.number("bottom",e),U.typeOf.number("top",i),U.typeOf.number("near",r),U.typeOf.object("result",o);var s=2*r/(i-e),a=(n+t)/(n-t),i=(i+e)/(i-e),e=-2*r;return o[0]=2*r/(n-t),o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=s,o[6]=0,o[7]=0,o[8]=a,o[9]=i,o[10]=-1,o[11]=-1,o[12]=0,o[13]=0,o[14]=e,o[15]=0,o},X.computeViewportTransformation=function(t,n,e,i){I(i)||(i=new X),t=y(t,y.EMPTY_OBJECT);var r=y(t.x,0),o=y(t.y,0),s=y(t.width,0),t=y(t.height,0),s=(n=y(n,0),.5*s),t=.5*t,e=.5*((e=y(e,1))-n),a=t,u=e,r=r+s,o=o+t,t=n+e;return i[0]=s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=a,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=u,i[11]=0,i[12]=r,i[13]=o,i[14]=t,i[15]=1,i},X.computeView=function(t,n,e,i,r){return U.typeOf.object("position",t),U.typeOf.object("direction",n),U.typeOf.object("up",e),U.typeOf.object("right",i),U.typeOf.object("result",r),r[0]=i.x,r[1]=e.x,r[2]=-n.x,r[3]=0,r[4]=i.y,r[5]=e.y,r[6]=-n.y,r[7]=0,r[8]=i.z,r[9]=e.z,r[10]=-n.z,r[11]=0,r[12]=-p.dot(i,t),r[13]=-p.dot(e,t),r[14]=p.dot(n,t),r[15]=1,r},X.toArray=function(t,n){return U.typeOf.object("matrix",t),I(n)?(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n):[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]},X.getElementIndex=function(t,n){return U.typeOf.number.greaterThanOrEquals("row",n,0),U.typeOf.number.lessThanOrEquals("row",n,3),U.typeOf.number.greaterThanOrEquals("column",t,0),U.typeOf.number.lessThanOrEquals("column",t,3),4*t+n},X.getColumn=function(t,n,e){U.typeOf.object("matrix",t),U.typeOf.number.greaterThanOrEquals("index",n,0),U.typeOf.number.lessThanOrEquals("index",n,3),U.typeOf.object("result",e);var n=4*n,i=t[n],r=t[1+n],o=t[2+n],t=t[3+n];return e.x=i,e.y=r,e.z=o,e.w=t,e},X.setColumn=function(t,n,e,i){U.typeOf.object("matrix",t),U.typeOf.number.greaterThanOrEquals("index",n,0),U.typeOf.number.lessThanOrEquals("index",n,3),U.typeOf.object("cartesian",e),U.typeOf.object("result",i);n*=4;return(i=X.clone(t,i))[n]=e.x,i[1+n]=e.y,i[2+n]=e.z,i[3+n]=e.w,i},X.getRow=function(t,n,e){U.typeOf.object("matrix",t),U.typeOf.number.greaterThanOrEquals("index",n,0),U.typeOf.number.lessThanOrEquals("index",n,3),U.typeOf.object("result",e);var i=t[n],r=t[n+4],o=t[n+8],t=t[n+12];return e.x=i,e.y=r,e.z=o,e.w=t,e},X.setRow=function(t,n,e,i){return U.typeOf.object("matrix",t),U.typeOf.number.greaterThanOrEquals("index",n,0),U.typeOf.number.lessThanOrEquals("index",n,3),U.typeOf.object("cartesian",e),U.typeOf.object("result",i),(i=X.clone(t,i))[n]=e.x,i[n+4]=e.y,i[n+8]=e.z,i[n+12]=e.w,i},X.setTranslation=function(t,n,e){return U.typeOf.object("matrix",t),U.typeOf.object("translation",n),U.typeOf.object("result",e),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=n.x,e[13]=n.y,e[14]=n.z,e[15]=t[15],e},new p),cA=(X.setScale=function(t,n,e){U.typeOf.object("matrix",t),U.typeOf.object("scale",n),U.typeOf.object("result",e);var i=X.getScale(t,uA),r=n.x/i.x,o=n.y/i.y,n=n.z/i.z;return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3],e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7],e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},new p),fA=(X.setUniformScale=function(t,n,e){U.typeOf.object("matrix",t),U.typeOf.number("scale",n),U.typeOf.object("result",e);var i=X.getScale(t,cA),r=n/i.x,o=n/i.y,n=n/i.z;return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3],e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7],e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},new p),hA=(X.getScale=function(t,n){return U.typeOf.object("matrix",t),U.typeOf.object("result",n),n.x=p.magnitude(p.fromElements(t[0],t[1],t[2],fA)),n.y=p.magnitude(p.fromElements(t[4],t[5],t[6],fA)),n.z=p.magnitude(p.fromElements(t[8],t[9],t[10],fA)),n},new p),lA=(X.getMaximumScale=function(t){return X.getScale(t,hA),p.maximumComponent(hA)},new p),dA=(X.setRotation=function(t,n,e){U.typeOf.object("matrix",t),U.typeOf.object("result",e);var i=X.getScale(t,lA);return e[0]=n[0]*i.x,e[1]=n[1]*i.x,e[2]=n[2]*i.x,e[3]=t[3],e[4]=n[3]*i.y,e[5]=n[4]*i.y,e[6]=n[5]*i.y,e[7]=t[7],e[8]=n[6]*i.z,e[9]=n[7]*i.z,e[10]=n[8]*i.z,e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},new p),vA=(X.getRotation=function(t,n){U.typeOf.object("matrix",t),U.typeOf.object("result",n);var e=X.getScale(t,dA);return n[0]=t[0]/e.x,n[1]=t[1]/e.x,n[2]=t[2]/e.x,n[3]=t[4]/e.y,n[4]=t[5]/e.y,n[5]=t[6]/e.y,n[6]=t[8]/e.z,n[7]=t[9]/e.z,n[8]=t[10]/e.z,n},X.multiply=function(t,n,e){U.typeOf.object("left",t),U.typeOf.object("right",n),U.typeOf.object("result",e);var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],u=t[5],c=t[6],f=t[7],h=t[8],l=t[9],d=t[10],v=t[11],p=t[12],m=t[13],y=t[14],t=t[15],b=n[0],g=n[1],w=n[2],_=n[3],E=n[4],S=n[5],T=n[6],x=n[7],A=n[8],M=n[9],O=n[10],L=n[11],R=n[12],N=n[13],P=n[14],n=n[15],j=r*b+u*g+l*w+m*_,F=o*b+c*g+d*w+y*_,I=s*b+f*g+v*w+t*_,C=i*E+a*S+h*T+p*x,k=r*E+u*S+l*T+m*x,D=o*E+c*S+d*T+y*x,E=s*E+f*S+v*T+t*x,S=i*A+a*M+h*O+p*L,T=r*A+u*M+l*O+m*L,x=o*A+c*M+d*O+y*L,A=s*A+f*M+v*O+t*L,M=i*R+a*N+h*P+p*n,O=r*R+u*N+l*P+m*n,L=o*R+c*N+d*P+y*n,r=s*R+f*N+v*P+t*n;return e[0]=i*b+a*g+h*w+p*_,e[1]=j,e[2]=F,e[3]=I,e[4]=C,e[5]=k,e[6]=D,e[7]=E,e[8]=S,e[9]=T,e[10]=x,e[11]=A,e[12]=M,e[13]=O,e[14]=L,e[15]=r,e},X.add=function(t,n,e){return U.typeOf.object("left",t),U.typeOf.object("right",n),U.typeOf.object("result",e),e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},X.subtract=function(t,n,e){return U.typeOf.object("left",t),U.typeOf.object("right",n),U.typeOf.object("result",e),e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e},X.multiplyTransformation=function(t,n,e){U.typeOf.object("left",t),U.typeOf.object("right",n),U.typeOf.object("result",e);var i=t[0],r=t[1],o=t[2],s=t[4],a=t[5],u=t[6],c=t[8],f=t[9],h=t[10],l=t[12],d=t[13],t=t[14],v=n[0],p=n[1],m=n[2],y=n[4],b=n[5],g=n[6],w=n[8],_=n[9],E=n[10],S=n[12],T=n[13],n=n[14],x=r*v+a*p+f*m,A=o*v+u*p+h*m,M=i*y+s*b+c*g,O=r*y+a*b+f*g,y=o*y+u*b+h*g,b=i*w+s*_+c*E,g=r*w+a*_+f*E,w=o*w+u*_+h*E,_=i*S+s*T+c*n+l,E=r*S+a*T+f*n+d,l=o*S+u*T+h*n+t;return e[0]=i*v+s*p+c*m,e[1]=x,e[2]=A,e[3]=0,e[4]=M,e[5]=O,e[6]=y,e[7]=0,e[8]=b,e[9]=g,e[10]=w,e[11]=0,e[12]=_,e[13]=E,e[14]=l,e[15]=1,e},X.multiplyByMatrix3=function(t,n,e){U.typeOf.object("matrix",t),U.typeOf.object("rotation",n),U.typeOf.object("result",e);var i=t[0],r=t[1],o=t[2],s=t[4],a=t[5],u=t[6],c=t[8],f=t[9],h=t[10],l=n[0],d=n[1],v=n[2],p=n[3],m=n[4],y=n[5],b=n[6],g=n[7],n=n[8],w=r*l+a*d+f*v,_=o*l+u*d+h*v,E=i*p+s*m+c*y,S=r*p+a*m+f*y,p=o*p+u*m+h*y,m=i*b+s*g+c*n,y=r*b+a*g+f*n,r=o*b+u*g+h*n;return e[0]=i*l+s*d+c*v,e[1]=w,e[2]=_,e[3]=0,e[4]=E,e[5]=S,e[6]=p,e[7]=0,e[8]=m,e[9]=y,e[10]=r,e[11]=0,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},X.multiplyByTranslation=function(t,n,e){U.typeOf.object("matrix",t),U.typeOf.object("translation",n),U.typeOf.object("result",e);var i=n.x,r=n.y,n=n.z,o=i*t[0]+r*t[4]+n*t[8]+t[12],s=i*t[1]+r*t[5]+n*t[9]+t[13],i=i*t[2]+r*t[6]+n*t[10]+t[14];return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=o,e[13]=s,e[14]=i,e[15]=t[15],e},X.multiplyByScale=function(t,n,e){U.typeOf.object("matrix",t),U.typeOf.object("scale",n),U.typeOf.object("result",e);var i=n.x,r=n.y,n=n.z;return 1===i&&1===r&&1===n?X.clone(t,e):(e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=r*t[6],e[7]=t[7],e[8]=n*t[8],e[9]=n*t[9],e[10]=n*t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e)},X.multiplyByUniformScale=function(t,n,e){return U.typeOf.object("matrix",t),U.typeOf.number("scale",n),U.typeOf.object("result",e),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3],e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7],e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},X.multiplyByVector=function(t,n,e){U.typeOf.object("matrix",t),U.typeOf.object("cartesian",n),U.typeOf.object("result",e);var i=n.x,r=n.y,o=n.z,n=n.w,s=t[0]*i+t[4]*r+t[8]*o+t[12]*n,a=t[1]*i+t[5]*r+t[9]*o+t[13]*n,u=t[2]*i+t[6]*r+t[10]*o+t[14]*n,i=t[3]*i+t[7]*r+t[11]*o+t[15]*n;return e.x=s,e.y=a,e.z=u,e.w=i,e},X.multiplyByPointAsVector=function(t,n,e){U.typeOf.object("matrix",t),U.typeOf.object("cartesian",n),U.typeOf.object("result",e);var i=n.x,r=n.y,n=n.z,o=t[0]*i+t[4]*r+t[8]*n,s=t[1]*i+t[5]*r+t[9]*n,i=t[2]*i+t[6]*r+t[10]*n;return e.x=o,e.y=s,e.z=i,e},X.multiplyByPoint=function(t,n,e){U.typeOf.object("matrix",t),U.typeOf.object("cartesian",n),U.typeOf.object("result",e);var i=n.x,r=n.y,n=n.z,o=t[0]*i+t[4]*r+t[8]*n+t[12],s=t[1]*i+t[5]*r+t[9]*n+t[13],i=t[2]*i+t[6]*r+t[10]*n+t[14];return e.x=o,e.y=s,e.z=i,e},X.multiplyByScalar=function(t,n,e){return U.typeOf.object("matrix",t),U.typeOf.number("scalar",n),U.typeOf.object("result",e),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},X.negate=function(t,n){return U.typeOf.object("matrix",t),U.typeOf.object("result",n),n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n[4]=-t[4],n[5]=-t[5],n[6]=-t[6],n[7]=-t[7],n[8]=-t[8],n[9]=-t[9],n[10]=-t[10],n[11]=-t[11],n[12]=-t[12],n[13]=-t[13],n[14]=-t[14],n[15]=-t[15],n},X.transpose=function(t,n){U.typeOf.object("matrix",t),U.typeOf.object("result",n);var e=t[1],i=t[2],r=t[3],o=t[6],s=t[7],a=t[11];return n[0]=t[0],n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=e,n[5]=t[5],n[6]=t[9],n[7]=t[13],n[8]=i,n[9]=o,n[10]=t[10],n[11]=t[14],n[12]=r,n[13]=s,n[14]=a,n[15]=t[15],n},X.abs=function(t,n){return U.typeOf.object("matrix",t),U.typeOf.object("result",n),n[0]=Math.abs(t[0]),n[1]=Math.abs(t[1]),n[2]=Math.abs(t[2]),n[3]=Math.abs(t[3]),n[4]=Math.abs(t[4]),n[5]=Math.abs(t[5]),n[6]=Math.abs(t[6]),n[7]=Math.abs(t[7]),n[8]=Math.abs(t[8]),n[9]=Math.abs(t[9]),n[10]=Math.abs(t[10]),n[11]=Math.abs(t[11]),n[12]=Math.abs(t[12]),n[13]=Math.abs(t[13]),n[14]=Math.abs(t[14]),n[15]=Math.abs(t[15]),n},X.equals=function(t,n){return t===n||I(t)&&I(n)&&t[12]===n[12]&&t[13]===n[13]&&t[14]===n[14]&&t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]&&t[3]===n[3]&&t[7]===n[7]&&t[11]===n[11]&&t[15]===n[15]},X.equalsEpsilon=function(t,n,e){return e=y(e,0),t===n||I(t)&&I(n)&&Math.abs(t[0]-n[0])<=e&&Math.abs(t[1]-n[1])<=e&&Math.abs(t[2]-n[2])<=e&&Math.abs(t[3]-n[3])<=e&&Math.abs(t[4]-n[4])<=e&&Math.abs(t[5]-n[5])<=e&&Math.abs(t[6]-n[6])<=e&&Math.abs(t[7]-n[7])<=e&&Math.abs(t[8]-n[8])<=e&&Math.abs(t[9]-n[9])<=e&&Math.abs(t[10]-n[10])<=e&&Math.abs(t[11]-n[11])<=e&&Math.abs(t[12]-n[12])<=e&&Math.abs(t[13]-n[13])<=e&&Math.abs(t[14]-n[14])<=e&&Math.abs(t[15]-n[15])<=e},X.getTranslation=function(t,n){return U.typeOf.object("matrix",t),U.typeOf.object("result",n),n.x=t[12],n.y=t[13],n.z=t[14],n},X.getMatrix3=function(t,n){return U.typeOf.object("matrix",t),U.typeOf.object("result",n),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[4],n[4]=t[5],n[5]=t[6],n[6]=t[8],n[7]=t[9],n[8]=t[10],n},new eA),pA=new eA,mA=new z3,yA=new z3(0,0,0,1),bA=(X.inverse=function(t,n){U.typeOf.object("matrix",t),U.typeOf.object("result",n);var e=t[0],i=t[4],r=t[8],o=t[12],s=t[1],a=t[5],u=t[9],c=t[13],f=t[2],h=t[6],l=t[10],d=t[14],v=t[3],p=t[7],m=t[11],y=t[15],b=l*y,g=d*m,w=h*y,_=d*p,E=h*m,S=l*p,T=f*y,x=d*v,A=f*m,M=l*v,O=f*p,L=h*v,R=b*a+_*u+E*c-(g*a+w*u+S*c),N=g*s+T*u+M*c-(b*s+x*u+A*c),P=w*s+x*a+O*c-(_*s+T*a+L*c),j=S*s+A*a+L*u-(E*s+M*a+O*u),F=g*i+w*r+S*o-(b*i+_*r+E*o),I=b*e+x*r+A*o-(g*e+T*r+M*o),C=_*e+T*i+L*o-(w*e+x*i+O*o),k=E*e+M*i+O*r-(S*e+A*i+L*r),D=(b=r*c)*p+(_=o*a)*m+(E=i*u)*y-((g=o*u)*p+(w=i*c)*m+(S=r*a)*y),c=g*v+(T=e*c)*m+(M=r*s)*y-(b*v+(x=o*s)*m+(A=e*u)*y),u=w*v+x*p+(O=e*a)*y-(_*v+T*p+(L=i*s)*y),a=S*v+A*p+L*m-(E*v+M*p+O*m),s=w*l+S*d+g*h-(E*d+b*h+_*l),y=A*d+b*f+x*l-(T*l+M*d+g*f),v=T*h+L*d+_*f-(O*d+w*f+x*h),p=O*l+E*f+M*h-(A*h+L*l+S*f),m=e*R+i*N+r*P+o*j;if(Math.abs(m)<H.EPSILON21){if(eA.equalsEpsilon(X.getMatrix3(t,vA),pA,H.EPSILON7)&&z3.equals(X.getRow(t,3,mA),yA))return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=0,n[11]=0,n[12]=-t[12],n[13]=-t[13],n[14]=-t[14],n[15]=1,n;throw new rA("matrix is not invertible because its determinate is zero.")}return n[0]=R*(m=1/m),n[1]=N*m,n[2]=P*m,n[3]=j*m,n[4]=F*m,n[5]=I*m,n[6]=C*m,n[7]=k*m,n[8]=D*m,n[9]=c*m,n[10]=u*m,n[11]=a*m,n[12]=s*m,n[13]=y*m,n[14]=v*m,n[15]=p*m,n},X.inverseTransformation=function(t,n){U.typeOf.object("matrix",t),U.typeOf.object("result",n);var e=t[0],i=t[1],r=t[2],o=t[4],s=t[5],a=t[6],u=t[8],c=t[9],f=t[10],h=t[12],l=t[13],t=t[14],d=-e*h-i*l-r*t,v=-o*h-s*l-a*t,h=-u*h-c*l-f*t;return n[0]=e,n[1]=o,n[2]=u,n[3]=0,n[4]=i,n[5]=s,n[6]=c,n[7]=0,n[8]=r,n[9]=a,n[10]=f,n[11]=0,n[12]=d,n[13]=v,n[14]=h,n[15]=1,n},new X),gA=(X.inverseTranspose=function(t,n){return U.typeOf.object("matrix",t),U.typeOf.object("result",n),X.inverse(X.transpose(t,bA),n)},X.IDENTITY=Object.freeze(new X(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),X.ZERO=Object.freeze(new X(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)),X.COLUMN0ROW0=0,X.COLUMN0ROW1=1,X.COLUMN0ROW2=2,X.COLUMN0ROW3=3,X.COLUMN1ROW0=4,X.COLUMN1ROW1=5,X.COLUMN1ROW2=6,X.COLUMN1ROW3=7,X.COLUMN2ROW0=8,X.COLUMN2ROW1=9,X.COLUMN2ROW2=10,X.COLUMN2ROW3=11,X.COLUMN3ROW0=12,X.COLUMN3ROW1=13,X.COLUMN3ROW2=14,X.COLUMN3ROW3=15,Object.defineProperties(X.prototype,{length:{get:function(){return X.packedLength}}}),X.prototype.clone=function(t){return X.clone(this,t)},X.prototype.equals=function(t){return X.equals(this,t)},X.equalsArray=function(t,n,e){return t[0]===n[e]&&t[1]===n[e+1]&&t[2]===n[e+2]&&t[3]===n[e+3]&&t[4]===n[e+4]&&t[5]===n[e+5]&&t[6]===n[e+6]&&t[7]===n[e+7]&&t[8]===n[e+8]&&t[9]===n[e+9]&&t[10]===n[e+10]&&t[11]===n[e+11]&&t[12]===n[e+12]&&t[13]===n[e+13]&&t[14]===n[e+14]&&t[15]===n[e+15]},X.prototype.equalsEpsilon=function(t,n){return X.equalsEpsilon(this,t,n)},X.prototype.toString=function(){return"(".concat(this[0],", ").concat(this[4],", ").concat(this[8],", ").concat(this[12],")\n")+"(".concat(this[1],", ").concat(this[5],", ").concat(this[9],", ").concat(this[13],")\n")+"(".concat(this[2],", ").concat(this[6],", ").concat(this[10],", ").concat(this[14],")\n")+"(".concat(this[3],", ").concat(this[7],", ").concat(this[11],", ").concat(this[15],")")},X);function wA(t){t=y(t,y.EMPTY_OBJECT),this.left=t.left,this.sw=void 0,this.right=t.right,this.aw=void 0,this.top=t.top,this.uw=void 0,this.bottom=t.bottom,this.cw=void 0,this.near=y(t.near,1),this.fw=this.near,this.far=y(t.far,5e8),this.hw=this.far,this.lw=new gA,this.dw=new gA}function _A(t){if(!(I(t.right)&&I(t.left)&&I(t.top)&&I(t.bottom)&&I(t.near)&&I(t.far)))throw new m("right, left, top, bottom, near, or far parameters are not set.");var n=t.top,e=t.bottom,i=t.right,r=t.left,o=t.near,s=t.far;if(n!==t.uw||e!==t.cw||r!==t.sw||i!==t.aw||o!==t.fw||s!==t.hw){if(t.near<=0||t.near>t.far)throw new m("near must be greater than zero and less than far.");t.sw=r,t.aw=i,t.uw=n,t.cw=e,t.fw=o,t.hw=s,t.lw=gA.computePerspectiveOffCenter(r,i,e,n,o,s,t.lw),t.dw=gA.computeInfinitePerspectiveOffCenter(r,i,e,n,o,t.dw)}}Object.defineProperties(wA.prototype,{projectionMatrix:{get:function(){return _A(this),this.lw}},infiniteProjectionMatrix:{get:function(){return _A(this),this.dw}}}),wA.prototype.getPixelDimensions=function(t,n,e,i,r){if(_A(this),!I(t)||!I(n))throw new m("Both drawingBufferWidth and drawingBufferHeight are required.");if(t<=0)throw new m("drawingBufferWidth must be greater than zero.");if(n<=0)throw new m("drawingBufferHeight must be greater than zero.");if(!I(e))throw new m("distance is required.");if(!I(i))throw new m("pixelRatio is required");if(i<=0)throw new m("pixelRatio must be greater than zero.");var o,s;if(I(r))return o=1/this.near,n=2*i*e*(s=this.top*o)/n,s=this.right*o,r.x=2*i*e*s/t,r.y=n,r;throw new m("A result object is required.")},wA.prototype.clone=function(t){return(t=I(t)?t:new wA).right=this.right,t.left=this.left,t.top=this.top,t.bottom=this.bottom,t.near=this.near,t.far=this.far,t.sw=void 0,t.aw=void 0,t.uw=void 0,t.cw=void 0,t.fw=void 0,t.hw=void 0,t},wA.prototype.equals=function(t){return I(t)&&t instanceof wA&&this.right===t.right&&this.left===t.left&&this.top===t.top&&this.bottom===t.bottom&&this.near===t.near&&this.far===t.far},wA.prototype.equalsEpsilon=function(t,n,e){return t===this||I(t)&&t instanceof wA&&H.equalsEpsilon(this.right,t.right,n,e)&&H.equalsEpsilon(this.left,t.left,n,e)&&H.equalsEpsilon(this.top,t.top,n,e)&&H.equalsEpsilon(this.bottom,t.bottom,n,e)&&H.equalsEpsilon(this.near,t.near,n,e)&&H.equalsEpsilon(this.far,t.far,n,e)};var EA=wA;function SA(t){t=y(t,y.EMPTY_OBJECT),this.pw=new EA,this.fov=t.fov,this.mw=void 0,this.yw=void 0,this.bw=void 0,this.aspectRatio=t.aspectRatio,this.gw=void 0,this.near=y(t.near,1),this.fw=this.near,this.far=y(t.far,5e8),this.hw=this.far,this.xOffset=y(t.xOffset,0),this.ww=this.xOffset,this.yOffset=y(t.yOffset,0),this._w=this.yOffset}function TA(t){if(!(I(t.fov)&&I(t.aspectRatio)&&I(t.near)&&I(t.far)))throw new m("fov, aspectRatio, near, or far parameters are not set.");var n=t.pw;if(t.fov!==t.mw||t.aspectRatio!==t.gw||t.near!==t.fw||t.far!==t.hw||t.xOffset!==t.ww||t.yOffset!==t._w){if(t.fov<0||t.fov>=Math.PI)throw new m("fov must be in the range [0, PI).");if(t.aspectRatio<0)throw new m("aspectRatio must be positive.");if(t.near<0||t.near>t.far)throw new m("near must be greater than zero and less than far.");t.gw=t.aspectRatio,t.mw=t.fov,t.yw=t.fov,t.fw=t.near,t.hw=t.far,t.bw=2*Math.tan(.5*t.yw),t.ww=t.xOffset,t._w=t.yOffset,n.top=t.near*Math.tan(.5*t.yw),n.bottom=-n.top,n.right=t.aspectRatio*n.top,n.left=-n.right,n.near=t.near,n.far=t.far,n.right+=t.xOffset,n.left+=t.xOffset,n.top+=t.yOffset,n.bottom+=t.yOffset}}SA.packedLength=6,SA.prototype.update=function(){TA(this)},SA.pack=function(t,n,e){return U.typeOf.object("value",t),U.defined("array",n),e=y(e,0),n[e++]=t.fov,n[e++]=t.aspectRatio,n[e++]=t.near,n[e++]=t.far,n[e++]=t.xOffset,n[e]=t.yOffset,n},SA.unpack=function(t,n,e){return U.defined("array",t),n=y(n,0),(e=I(e)?e:new SA).fov=t[n++],e.aspectRatio=t[n++],e.near=t[n++],e.far=t[n++],e.xOffset=t[n++],e.yOffset=t[n],e},Object.defineProperties(SA.prototype,{projectionMatrix:{get:function(){return TA(this),this.pw.projectionMatrix}},infiniteProjectionMatrix:{get:function(){return TA(this),this.pw.infiniteProjectionMatrix}},fovy:{get:function(){return TA(this),this.yw}},sseDenominator:{get:function(){return TA(this),this.bw}},offCenterFrustum:{get:function(){return TA(this),this.pw}}}),SA.prototype.computeCullingVolume=function(t,n,e){return TA(this),this.pw.computeCullingVolume(t,n,e)},SA.prototype.getPixelDimensions=function(t,n,e,i,r){return TA(this),this.pw.getPixelDimensions(t,n,e,i,r)},SA.prototype.clone=function(t){return(t=I(t)?t:new SA).aspectRatio=this.aspectRatio,t.fov=this.fov,t.near=this.near,t.far=this.far,t.gw=void 0,t.mw=void 0,t.fw=void 0,t.hw=void 0,this.pw.clone(t.pw),t},SA.prototype.equals=function(t){return!!(I(t)&&t instanceof SA)&&(TA(this),TA(t),this.fov===t.fov)&&this.aspectRatio===t.aspectRatio&&this.pw.equals(t.pw)},SA.prototype.equalsEpsilon=function(t,n,e){return!!(I(t)&&t instanceof SA)&&(TA(this),TA(t),H.equalsEpsilon(this.fov,t.fov,n,e))&&H.equalsEpsilon(this.aspectRatio,t.aspectRatio,n,e)&&this.pw.equalsEpsilon(t.pw,n,e)};var xA=SA;function AA(t){t=y(t,y.EMPTY_OBJECT),this.left=t.left,this.sw=void 0,this.right=t.right,this.aw=void 0,this.top=t.top,this.uw=void 0,this.bottom=t.bottom,this.cw=void 0,this.near=y(t.near,1),this.fw=this.near,this.far=y(t.far,5e8),this.hw=this.far,this.Ew=new gA}function MA(t){if(!(I(t.right)&&I(t.left)&&I(t.top)&&I(t.bottom)&&I(t.near)&&I(t.far)))throw new m("right, left, top, bottom, near, or far parameters are not set.");if(t.top!==t.uw||t.bottom!==t.cw||t.left!==t.sw||t.right!==t.aw||t.near!==t.fw||t.far!==t.hw){if(t.left>t.right)throw new m("right must be greater than left.");if(t.bottom>t.top)throw new m("top must be greater than bottom.");if(t.near<=0||t.near>t.far)throw new m("near must be greater than zero and less than far.");t.sw=t.left,t.aw=t.right,t.uw=t.top,t.cw=t.bottom,t.fw=t.near,t.hw=t.far,t.Ew=gA.computeOrthographicOffCenter(t.left,t.right,t.bottom,t.top,t.near,t.far,t.Ew)}}Object.defineProperties(AA.prototype,{projectionMatrix:{get:function(){return MA(this),this.Ew}}});var OA=new p,LA=new p,RA=new p,NA=new p,PA=(AA.prototype.computeCullingVolume=function(t,n,e){if(!I(t))throw new m("position is required.");if(!I(n))throw new m("direction is required.");var i,r,o,s,a,u,c,f,h;if(I(e))return i=this._cullingVolume.planes,r=this.top,o=this.bottom,s=this.right,f=this.left,c=this.near,a=this.far,u=p.cross(n,e,OA),p.normalize(u,u),p.multiplyByScalar(n,c,c=LA),p.add(t,c,c),p.multiplyByScalar(u,f,f=RA),p.add(c,f,f),(h=I(h=i[0])?h:i[0]=new z3).x=u.x,h.y=u.y,h.z=u.z,h.w=-p.dot(u,f),p.multiplyByScalar(u,s,f),p.add(c,f,f),(h=I(h=i[1])?h:i[1]=new z3).x=-u.x,h.y=-u.y,h.z=-u.z,h.w=-p.dot(p.negate(u,NA),f),p.multiplyByScalar(e,o,f),p.add(c,f,f),(h=I(h=i[2])?h:i[2]=new z3).x=e.x,h.y=e.y,h.z=e.z,h.w=-p.dot(e,f),p.multiplyByScalar(e,r,f),p.add(c,f,f),(h=I(h=i[3])?h:i[3]=new z3).x=-e.x,h.y=-e.y,h.z=-e.z,h.w=-p.dot(p.negate(e,NA),f),(h=I(h=i[4])?h:i[4]=new z3).x=n.x,h.y=n.y,h.z=n.z,h.w=-p.dot(n,c),p.multiplyByScalar(n,a,f),p.add(t,f,f),(h=I(h=i[5])?h:i[5]=new z3).x=-n.x,h.y=-n.y,h.z=-n.z,h.w=-p.dot(p.negate(n,NA),f),this._cullingVolume;throw new m("up is required.")},AA.prototype.getPixelDimensions=function(t,n,e,i,r){if(MA(this),!I(t)||!I(n))throw new m("Both drawingBufferWidth and drawingBufferHeight are required.");if(t<=0)throw new m("drawingBufferWidth must be greater than zero.");if(n<=0)throw new m("drawingBufferHeight must be greater than zero.");if(!I(e))throw new m("distance is required.");if(!I(i))throw new m("pixelRatio is required.");if(i<=0)throw new m("pixelRatio must be greater than zero.");if(I(r))return e=this.right-this.left,n=i*(this.top-this.bottom)/n,r.x=i*e/t,r.y=n,r;throw new m("A result object is required.")},AA.prototype.clone=function(t){return(t=I(t)?t:new AA).left=this.left,t.right=this.right,t.top=this.top,t.bottom=this.bottom,t.near=this.near,t.far=this.far,t.sw=void 0,t.aw=void 0,t.uw=void 0,t.cw=void 0,t.fw=void 0,t.hw=void 0,t},AA.prototype.equals=function(t){return I(t)&&t instanceof AA&&this.right===t.right&&this.left===t.left&&this.top===t.top&&this.bottom===t.bottom&&this.near===t.near&&this.far===t.far},AA.prototype.equalsEpsilon=function(t,n,e){return t===this||I(t)&&t instanceof AA&&H.equalsEpsilon(this.right,t.right,n,e)&&H.equalsEpsilon(this.left,t.left,n,e)&&H.equalsEpsilon(this.top,t.top,n,e)&&H.equalsEpsilon(this.bottom,t.bottom,n,e)&&H.equalsEpsilon(this.near,t.near,n,e)&&H.equalsEpsilon(this.far,t.far,n,e)},AA);function jA(t){t=y(t,y.EMPTY_OBJECT),this.pw=new PA,this.width=t.width,this.tt=void 0,this.aspectRatio=t.aspectRatio,this.gw=void 0,this.near=y(t.near,1),this.fw=this.near,this.far=y(t.far,5e8),this.hw=this.far,this.zoom=t.zoom||1,this.qf=this.zoom}function FA(t){if(!(I(t.width)&&I(t.aspectRatio)&&I(t.near)&&I(t.far)&&I(t.zoom)))throw new m("width, aspectRatio, near, or far parameters are not set.");var n=t.pw;if(t.width!==t.tt||t.aspectRatio!==t.gw||t.near!==t.fw||t.far!==t.hw||t.zoom!==t.qf){if(t.aspectRatio<0)throw new m("aspectRatio must be positive.");if(t.near<0||t.near>t.far)throw new m("near must be greater than zero and less than far.");t.gw=t.aspectRatio,t.tt=t.width,t.fw=t.near,t.hw=t.far;var e=1/t.aspectRatio,i=t.width/(2*t.zoom),e=e*t.width/(2*t.zoom),r=0-i,o=0+e,e=0-e;n.right=0+i,n.left=r,n.top=o,n.bottom=e,n.near=t.near,n.far=t.far}}jA.packedLength=4,jA.pack=function(t,n,e){return U.typeOf.object("value",t),U.defined("array",n),e=y(e,0),n[e++]=t.width,n[e++]=t.aspectRatio,n[e++]=t.near,n[e]=t.far,n},jA.unpack=function(t,n,e){return U.defined("array",t),n=y(n,0),(e=I(e)?e:new jA).width=t[n++],e.aspectRatio=t[n++],e.near=t[n++],e.far=t[n],e},Object.defineProperties(jA.prototype,{projectionMatrix:{get:function(){return FA(this),this.pw.projectionMatrix}},offCenterFrustum:{get:function(){return FA(this),this.pw}}}),jA.prototype.computeCullingVolume=function(t,n,e){return FA(this),this.pw.computeCullingVolume(t,n,e)},jA.prototype.getPixelDimensions=function(t,n,e,i,r){return FA(this),this.pw.getPixelDimensions(t,n,e,i,r)},jA.prototype.clone=function(t){return(t=I(t)?t:new jA).aspectRatio=this.aspectRatio,t.width=this.width,t.near=this.near,t.far=this.far,t.gw=void 0,t.tt=void 0,t.fw=void 0,t.hw=void 0,this.pw.clone(t.pw),t},jA.prototype.equals=function(t){return!!(I(t)&&t instanceof jA)&&(FA(this),FA(t),this.width===t.width)&&this.aspectRatio===t.aspectRatio&&this.pw.equals(t.pw)},jA.prototype.update=function(){FA(this)},jA.prototype.equalsEpsilon=function(t,n,e){return!!(I(t)&&t instanceof jA)&&(FA(this),FA(t),H.equalsEpsilon(this.width,t.width,n,e))&&H.equalsEpsilon(this.aspectRatio,t.aspectRatio,n,e)&&this.pw.equalsEpsilon(t.pw,n,e)};var IA=jA;function CA(t,n,e,i){"number"==typeof e&&(i=e,e=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),R.call(this,t,n,e),this.meshPerAttribute=i||1}function kA(t){return(kA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function DA(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=kA(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=kA(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==kA(t)?t:String(t)}(i.key),i)}}CA.prototype=Object.assign(Object.create(R.prototype),{constructor:CA,isInstancedBufferAttribute:!0,copy:function(t){return R.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}});var UA=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.label=t,this.viewportV2=new Mt}var t,e,i;return t=n,(e=[{key:"frustum",get:function(){return this.label.mv.map.camera.isOrthographicCamera?this.frustumO:this.frustumP}},{key:"getGeometry",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=new Bg,e=(n.instanceCount=t.length,[]),i=[],r=[],o=[],s=[],a=[],u=0;u<t.length;u++){var c=t[u],f=c.bottomLeft,h=c.eyeOffset,l=c.imageHeight,d=c.imageWidth,v=c.imageRectangleSize,p=c.scale,c=c.translate;e.push(f.x,f.y),i.push(h.x,h.y,h.z),r.push(d,l),o.push(v.width,v.height),a.push(c.x,c.y),s.push(p)}return n.setAttribute("bottomLeft",new CA(new Float32Array(e),2)),n.setAttribute("eyeOffset",new CA(new Float32Array(i),3)),n.setAttribute("imageSize",new CA(new Float32Array(r),2)),n.setAttribute("imageRectangle",new CA(new Float32Array(o),2)),n.setAttribute("scale",new CA(new Float32Array(s),1)),n.setAttribute("translate",new CA(new Float32Array(a),2)),n.setIndex([0,1,2,0,2,3]),n.setAttribute("direction",new R(new Float32Array([0,0,1,0,1,1,0,1]),2)),n}},{key:"_getUniform",value:function(t,n){var e=this.label.mv,i=e.map.camera,e=e.map.Dt.renderer,r=new Gc(t.canvas),e=(r.minFilter=B,r.magFilter=B,i.updateMatrix(),i.updateProjectionMatrix(),e.getDrawingBufferSize(this.viewportV2),this.frustumP=new xA({fov:H.toRadians(i.fov||60),aspectRatio:this.viewportV2.x/this.viewportV2.y,near:i.near,far:i.far}),this.frustumO=new IA({width:e.domElement.clientWidth,aspectRatio:e.domElement.clientWidth/e.domElement.clientHeight,near:i.near,far:i.far,zoom:i.zoom}),i.isOrthographicCamera?this.frustumO:this.frustumP),e=(e.update(),e.pw),o=t.fillColor,t=t.fontSize;return{isHalo:{value:n},outlineColor:{value:this.label.outlineColor},outlineWidth:{value:this.label.outlineWidth},halo_blur:{value:1},czm_orthographicIn3D:{value:i.isOrthographicCamera?1:0},czm_currentFrustum:{value:[i.near,i.far]},czm_viewport:{value:[0,0,this.viewportV2.x,this.viewportV2.y]},czm_frustumPlanes:{value:[e.top,e.bottom,e.left,e.right]},czm_projection:{value:i.projectionMatrix},czm_viewMatrix:{value:i.matrixWorldInverse},u_atlas:{value:r},u_device_pixel_ratio:{value:this.label.pixelRatio},fontSize:{value:+t},fillColor:{value:o},pixelOffset:{value:this.label.pixelOffset},origin:{value:[g3.LEFT,this.label.verticalOrigin]},opacity:{value:this.label.opacity}}}},{key:"init",value:function(t,n){var e,i=this;this.label.rootNode&&((e=new ba(this.getGeometry(t),new ul({uniforms:this._getUniform(t[0],n),fragmentShader:"\nprecision highp float;\nprecision highp int;\n\n#define SDF_EDGE 0.75\n#define SDF_PX 8.0\n\nuniform sampler2D u_atlas;\nuniform vec3 fillColor;\nuniform float fontSize;\nuniform float u_device_pixel_ratio;\nuniform float opacity;\n\nuniform float isHalo;\nuniform float halo_blur;\nuniform vec3 outlineColor;\nuniform float outlineWidth;\n\nvarying vec2 v_textureCoordinates;\n\nvoid main() {\n  float buff = (256.0 - 64.0) / 256.0;\n  float fontScale = fontSize / 24.0;\n  float EDGE_GAMMA = 0.105 / u_device_pixel_ratio;\n  float gamma = EDGE_GAMMA / (fontScale);\n\n  vec3 color = fillColor;\n\n  if (isHalo > 0. ) {\n    color = outlineColor;\n    gamma = (halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / fontScale ;\n    buff = (6.0 - outlineWidth / fontScale) / SDF_PX;\n  }\n\n  float dist = texture2D(u_atlas, v_textureCoordinates).a;\n  float alpha = smoothstep(buff - gamma, buff + gamma, dist);\n\n  gl_FragColor = vec4(color, alpha * opacity);\n\n  if(isHalo > 0. && gl_FragColor.a < 0.95) {\n    discard;\n  }\n}\n",vertexShader:"\nuniform float czm_orthographicIn3D;\nuniform float u_device_pixel_ratio;\nuniform vec4 czm_viewport;\nuniform vec4 czm_frustumPlanes;\nuniform vec2 czm_currentFrustum;\nuniform mat4 czm_projection;\nuniform mat4 modelViewMatrix;\nuniform vec2 pixelOffset;\n\nattribute vec2 direction;\nuniform vec2 origin;\nattribute vec2 imageSize;\nattribute vec2 translate;\nattribute float scale;\n\nattribute vec3 eyeOffset;\nattribute vec2 bottomLeft;\nattribute vec2 imageRectangle;\n\nvarying vec2 v_textureCoordinates;\n\n/**\n * \n * @param {vec4} positionEC \n * @param {float} pixelRatio \n */\nfloat czm_metersPerPixel(vec4 positionEC, float pixelRatio) {\n  float width = czm_viewport.z;\n    float height = czm_viewport.w;\n    float pixelWidth;\n    float pixelHeight;\n\n    float top = czm_frustumPlanes.x;\n    float bottom = czm_frustumPlanes.y;\n    float left = czm_frustumPlanes.z;\n    float right = czm_frustumPlanes.w;\n\n    if (czm_orthographicIn3D == 1.0)\n    {\n        float frustumWidth = right - left;\n        float frustumHeight = top - bottom;\n        pixelWidth = frustumWidth / width;\n        pixelHeight = frustumHeight / height;\n    }\n    else\n    {\n        float distanceToPixel = -positionEC.z;\n        float inverseNear = 1.0 / czm_currentFrustum.x;\n        float tanTheta = top * inverseNear;\n        pixelHeight = 2.0 * distanceToPixel * tanTheta / height;\n        tanTheta = right * inverseNear;\n        pixelWidth = 2.0 * distanceToPixel * tanTheta / width;\n    }\n\n    return max(pixelWidth, pixelHeight) * pixelRatio;\n}\n\nfloat czm_metersPerPixel(vec4 positionEC) {\n    return czm_metersPerPixel(positionEC, u_device_pixel_ratio);\n}\n\nfloat czm_branchFreeTernary(bool comparison, float a, float b) {\n    float useA = float(comparison);\n    return a * useA + b * (1.0 - useA);\n}\n\nvec4 addScreenSpaceOffset(\n  vec4 positionEC,\n  vec2 imageSize,\n  float scale,\n  vec2 direction,\n  vec2 origin,\n  vec2 translate,\n  vec2 pixelOffset,\n   vec3 alignedAxis,\n   bool validAlignedAxis,\n   float rotation,\n   bool sizeInMeters,\n   out mat2 rotationMatrix,\n   out float mpp\n  ) {\n    vec2 halfSize = imageSize * scale * 0.5;\n    halfSize *= ((direction * 2.0) - 1.0);\n    vec2 originTranslate = origin * abs(halfSize);\n\n    mpp = czm_metersPerPixel(positionEC);\n    positionEC.xy += (originTranslate + halfSize) * czm_branchFreeTernary(sizeInMeters, 1.0, mpp);\n    positionEC.xy += (translate + pixelOffset) * mpp;\n    return positionEC;\n}\n\nvoid main() {\n    vec4 positionEC = modelViewMatrix * vec4(0.,0.,0., 1.0);\n\n    float mpp;\n    mat2 rotationMatrix;\n    bool validAlignedAxis = false;\n    float rotation = 0.0;\n    bool sizeInMeters = false;\n\n    vec3 alignedAxis = vec3(0.0);\n    positionEC = addScreenSpaceOffset(\n        positionEC,\n        imageSize,\n        scale,\n        direction,\n        origin,\n        translate,\n        pixelOffset,\n        alignedAxis,\n        validAlignedAxis,\n        rotation,\n        sizeInMeters,\n        rotationMatrix,\n        mpp\n    );\n    gl_Position = czm_projection * positionEC;\n\n\n    vec2 textureCoordinatesBottomLeft = bottomLeft;\n    vec2 textureCoordinatesRange = imageRectangle;\n    vec2 textureCoordinates = textureCoordinatesBottomLeft + direction * textureCoordinatesRange;\n    v_textureCoordinates = textureCoordinates;\n}\n",transparent:!0,wireframe:!1,depthTest:!1}))).onBeforeRender=function(){var t=i.label.mv,n=t.map.camera,t=t.map.Dt.renderer,t=(t.getDrawingBufferSize(i.viewportV2),i.frustumP.fov=H.toRadians(n.fov||60),i.frustumP.aspectRatio=i.viewportV2.x/i.viewportV2.y,i.frustumP.near=n.near,i.frustumP.far=n.far,i.frustumO.aspectRatio=t.domElement.clientWidth/t.domElement.clientHeight,i.frustumO.near=n.near,i.frustumO.far=n.far,i.frustumO.width=t.domElement.clientWidth,i.frustumO.zoom=n.zoom,n.isOrthographicCamera?i.frustumO:i.frustumP),t=(t.update(),t.pw);e.material.uniforms.czm_currentFrustum.value=[n.near,n.far],e.material.uniforms.czm_viewport.value=[0,0,i.viewportV2.x,i.viewportV2.y],e.material.uniforms.czm_projection.value=n.projectionMatrix,e.material.uniforms.czm_frustumPlanes.value=[t.top,t.bottom,t.left,t.right],e.material.uniforms.czm_orthographicIn3D.value=n.isOrthographicCamera?1:0,e.material.uniforms.pixelOffset.value=i.label.pixelOffset,e.material.uniforms.origin.value=[g3.LEFT,i.label.verticalOrigin],e.material.uniforms.fillColor.value=i.label.Fv,e.material.uniforms.u_device_pixel_ratio.value=i.label.pixelRatio,e.material.uniforms.opacity.value=i.label.opacity},e.renderOrder=n?-1:1,t=n?"labelMeshInstance":"labelOutlineMeshInstance",this.label.rootNode.add(e),(this.label[t]=this).mesh=e)}}])&&DA(t.prototype,e),i&&DA(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}();function BA(t){return(BA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function GA(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=BA(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=BA(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==BA(t)?t:String(t)}(i.key),i)}}var HA,XA=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.Sw=[],this.Tw=[],this.label=null}var n,e,i;return n=t,(e=[{key:"add",value:function(){var t=new E3(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},this);return t.xw=this.Sw.length,this.Sw.push(t),t}},{key:"createMeshInstance",value:function(t){if(0!=t.length){this.label.Nv=!1;for(var n=[],e=0;e<t.length;e++){var i=t[e],r=i.scale,o=i.pixelOffset,s=i.pickPrimitive,a=i.Yg,u=i.Zg,c=i.qg,f=i.Qg,h=i.Jg;if(-1===h)break;var h=this.nw.textureCoordinates[h],l=h.width,d=h.height,v=h.x,h=h.y,p=this.nw.ah.width,m=this.nw.ah.height,p=Math.round(y(i.width,p*l)),m=Math.round(y(i.height,m*d));n.push({fontSize:s._b,Kg:i.Kg,bottomLeft:{x:v,y:h},imageRectangleSize:{width:l,height:d},fillColor:i.color,show:1,scale:r,pixelOffset:o,imageWidth:p,imageHeight:m,eyeOffset:f,translate:{x:a.x,y:a.y},verticalOrigin:u,horizontalOrigin:c,canvas:this.nw.texture.canvas})}0===n.length?this.label.Nv=!0:(new UA(this.label).init(n,!1),new UA(this.label).init(n,!0))}}},{key:"_updateBillboard",value:function(t){this.Tw.push(t)}},{key:"update",value:function(){var t=this.Tw.length,n=this.nw.textureCoordinates;if(0!==n.length){for(var e=0;e<t;++e)this.Tw[e].Nv=!1;this.createMeshInstance(this.Tw),this.Tw.length=0}}}])&&GA(n.prototype,e),i&&GA(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}(),zA=Object.freeze({FILL:0,OUTLINE:1,FILL_AND_OUTLINE:2}),VA=Object.freeze({FONT_SIZE:48,PADDING:10,RADIUS:12,CUTOFF:.25});function WA(t,n){if(!I(t))throw new m("text is required.");var e,i,r,o,s,a,u,c,f,h,l,d,v,p;if(""!==t)return n=y(n,y.EMPTY_OBJECT),e=y(n.font,"10px sans-serif"),i=y(n.stroke,!1),r=y(n.fill,!0),o=y(n.strokeWidth,1),s=y(n.backgroundColor,v3.TRANSPARENT),v=2*(a=y(n.padding,0)),(u=document.createElement("canvas")).width=1,u.height=1,u.style.font=e,c=u.getContext("2d",{willReadFrequently:!0}),I(HA)||(I(c.imageSmoothingEnabled)?HA="imageSmoothingEnabled":I(c.mozImageSmoothingEnabled)?HA="mozImageSmoothingEnabled":I(c.webkitImageSmoothingEnabled)?HA="webkitImageSmoothingEnabled":I(c.msImageSmoothingEnabled)&&(HA="msImageSmoothingEnabled")),c.font=e,c.lineJoin="round",c.lineWidth=o,c[HA]=!1,p=(function(t){if(null!==(t=t.match(/\b\d+(?=px\b)/)))return parseInt(t[0])}(e)||0)/(/[\u4e00-\u9fa5]/.test(t)?11:15),c.textBaseline="Alphabetic",u.style.visibility="hidden",document.body.appendChild(u),d=function(t,n,e,i,r){var o=t.measureText(n);if(!/\S/.test(n))return{width:o.width,height:0,ascent:0,descent:0,minx:0};for(var s,a,u,c=document.defaultView.getComputedStyle(t.canvas).getPropertyValue("font-size").replace("px","")||VA.FONT_SIZE,f=document.createElement("canvas"),h=o.width+100|0,l=3*c,c=l/2,d=(f.width=h,f.height=l,f.getContext("2d")),v=(d.font=e,d.fillStyle="white",d.fillRect(0,0,f.width+1,f.height+1),i&&(d.strokeStyle="black",d.lineWidth=t.lineWidth,d.strokeText(n,50,c)),r&&(d.fillStyle="black",d.fillText(n,50,c)),d.getImageData(0,0,h,l).data),p=v.length,m=4*h,y=0;y<p;++y)if(255!==v[y]){a=y/m|0;break}for(y=p-1;0<=y;--y)if(255!==v[y]){u=y/m|0;break}var b=-1;for(y=0;y<h&&-1===b;++y)for(s=0;s<l;++s){var g=4*y+s*m;if(255!==v[g]||255!==v[1+g]||255!==v[2+g]||255!==v[3+g]){b=y;break}}return{width:o.width,height:u-a,ascent:c-a,descent:u-c,minx:b-50}}(c,t,e,i,r),u.dimensions=d,document.body.removeChild(u),u.style.visibility="",f=-d.minx,h=Math.ceil(d.width)+f+v,d=(l=d.height+v)-(l-d.ascent+a)+v-p,u.width=h,u.height=l,c.font=e,c.lineJoin="round",c.lineWidth=o,c[HA]=!1,s!==v3.TRANSPARENT&&(c.fillStyle=s.getStyle(),c.fillRect(0,0,u.width,u.height)),i&&(v=y(n.strokeColor,v3.BLACK),c.strokeStyle=v.getStyle(),c.strokeText(t,f+a,d)),r&&(p=y(n.fillColor,v3.WHITE),c.fillStyle=p.getStyle(),c.fillText(t,f+a,d)),u}function YA(t){return(YA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function QA(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=YA(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=YA(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==YA(t)?t:String(t)}(i.key),i)}}function ZA(t,n,e){return n&&QA(t.prototype,n),e&&QA(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var qA=ZA(function t(n,e,i){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.labelCollection=n,this.index=e,this.dimensions=i}),KA=1e20;function JA(t,n,e,i,r,o,s){for(var a=0;a<n;a++){for(var u=0;u<e;u++)i[u]=t[u*n+a];for($A(i,r,o,s,e),u=0;u<e;u++)t[u*n+a]=r[u]}for(u=0;u<e;u++){for(a=0;a<n;a++)i[a]=t[u*n+a];for($A(i,r,o,s,n),a=0;a<n;a++)t[u*n+a]=Math.sqrt(r[a])}}function $A(t,n,e,i,r){i[e[0]=0]=-KA,i[1]=+KA;for(var o=1,s=0;o<r;o++){for(var a=(t[o]+o*o-(t[e[s]]+e[s]*e[s]))/(2*o-2*e[s]);a<=i[s];)s--,a=(t[o]+o*o-(t[e[s]]+e[s]*e[s]))/(2*o-2*e[s]);e[++s]=o,i[s]=a,i[s+1]=+KA}for(s=o=0;o<r;o++){for(;i[s+1]<o;)s++;n[o]=(o-e[s])*(o-e[s])+t[e[s]]}}function tM(t){return(tM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nM(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=tM(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=tM(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==tM(t)?t:String(t)}(i.key),i)}}function eM(t,n,e){return n&&nM(t.prototype,n),e&&nM(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var iM=eM(function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.textureInfo=null,this.dimensions=null});function rM(t){return(rM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function oM(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=rM(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=rM(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==rM(t)?t:String(t)}(i.key),i)}}function sM(t,n,e){return n&&oM(t.prototype,n),e&&oM(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var aM=sM(function t(n,e,i,r){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.x=y(n,0),this.y=y(e,0),this.width=y(i,0),this.height=y(r,0)}),uM={},cM=0,fM=256;function hM(t,n){return document.defaultView.getComputedStyle(t,null).getPropertyValue(n)}function lM(t,n){n.textureInfo=void 0,n.dimensions=void 0;var e=n.billboard;e&&(e.show=!1,e.image=void 0,e.Aw&&(e.Aw(),e.Aw=void 0),n.billboard=void 0)}var dM={};function vM(t){var n,e,i=uM[t.Mw];i||((n=document.createElement("div")).style.position="absolute",n.style.opacity=0,n.style.font=t.Mw,document.body.appendChild(n),e=parseFloat(hM(n,"line-height")),isNaN(e)&&(e=void 0),i={family:hM(n,"font-family"),size:hM(n,"font-size").replace("px",""),style:hM(n,"font-style"),weight:hM(n,"font-weight"),lineHeight:e},document.body.removeChild(n),cM<fM&&(uM[t.Mw]=i,cM++)),t.i1=i.family,t._b=i.size,t.Ow=i.style,t.Lw=i.weight,t.Rw=i.lineHeight}function pM(t,n,e,i){var r,o,n="".concat(n.Ow," ").concat(n.Lw," ").concat(VA.FONT_SIZE,"px ").concat(n.i1),n=(t=t,s=v3.WHITE,u=v3.WHITE,r=0,o=zA.FILL,i=i,dM.font=n,dM.fillColor=s,dM.strokeColor=u,dM.strokeWidth=r,dM.padding=VA.PADDING,i===b3.CENTER?dM.textBaseline="middle":i===b3.TOP?dM.textBaseline="top":dM.textBaseline="bottom",dM.fill=o===zA.FILL||o===zA.FILL_AND_OUTLINE,dM.stroke=o===zA.OUTLINE||o===zA.FILL_AND_OUTLINE,dM.backgroundColor=v3.BLACK,WA(t,dM)),s=new qA(e,-1,n.dimensions);if(0<n.width&&0<n.height){for(var a=function(t,n){var e,i,r,o,s,a=null==(n=n||{}).cutoff?.25:n.cutoff,u=null==n.radius?8:n.radius,c=n.channel||0;if(ArrayBuffer.isView(t)||Array.isArray(t)){if(!n.width||!n.height)throw Error("For raw data width and height should be provided by options");e=n.width,i=n.height,r=t,s=n.stride||Math.floor(t.length/e/i)}else window.HTMLCanvasElement&&t instanceof window.HTMLCanvasElement?(d=(l=t).getContext("2d"),e=l.width,i=l.height,r=(v=d.getImageData(0,0,e,i)).data,s=4):window.CanvasRenderingContext2D&&t instanceof window.CanvasRenderingContext2D?(e=(l=t.canvas).width,i=l.height,r=(v=(d=t).getImageData(0,0,e,i)).data,s=4):window.ImageData&&t instanceof window.ImageData&&(e=(v=t).width,i=t.height,r=v.data,s=4);if(n=Math.max(e,i),window.Uint8ClampedArray&&r instanceof window.Uint8ClampedArray||window.Uint8Array&&r instanceof window.Uint8Array)for(o=r,r=Array(e*i),p=0,m=Math.floor(o.length/s);p<m;p++)r[p]=o[p*s+c]/255;else if(1!==s)throw Error("Raw data can have only 1 value per pixel");for(var f=Array(e*i),h=Array(e*i),l=Array(n),d=Array(n),t=Array(n+1),v=Array(n),p=0,m=e*i;p<m;p++){var y=r[p];f[p]=1===y?0:0===y?KA:Math.pow(Math.max(0,.5-y),2),h[p]=1===y?KA:0===y?0:Math.pow(Math.max(0,y-.5),2)}JA(f,e,i,l,d,v,t),JA(h,e,i,l,d,v,t);var b=new(window.Float32Array?Float32Array:Array)(e*i);for(p=0,m=e*i;p<m;p++)b[p]=Math.min(Math.max(1-((f[p]-h[p])/u+a),0),1);return b}(n,{cutoff:VA.CUTOFF,radius:VA.RADIUS}),u=n.getContext("2d"),c=n.width,f=n.height,h=u.getImageData(0,0,c,f),l=0;l<c;l++)for(var d=0;d<f;d++){var v=d*c+l,p=255*a[v],v=4*v;h.data[0+v]=p,h.data[1+v]=p,h.data[2+v]=p,h.data[3+v]=p}u.putImageData(h,0,0)}return{glyphTextureInfo:s,canvas:n}}function mM(t,n,e){return n===g3.CENTER?-t/2:n===g3.RIGHT?-(t+e.x):e.x}var yM=new Mt,bM=new Mt,gM=new aM(1,1,1,1);function wM(t){var n=t.Nw,e=t.fv,i=0,r=0,o=[],s=Number.NEGATIVE_INFINITY,a=0,u=1,c=n.length,f=t.Pw,h=p3.clone(I(f)?t._backgroundPadding:p3.ZERO,bM);for(h.x/=t.jw,h.y/=t.jw,F=0;F<c;++F)"\n"===e.charAt(F)?(o.push(i),++u,i=0):(b=(y=n[F]).dimensions,a=Math.max(a,b.height-b.descent),s=Math.max(s,b.descent),i+=b.width-b.minx,F<c-1&&(i+=n[F+1].dimensions.minx),r=Math.max(r,i));o.push(i);for(var l,d,v,p,m,y,b,g=a+s,w=t.totalScale,_=t.qg,E=t.Zg,S=t.c1,T=0,x=o[T],A=mM(x,_,h),M=(l=r,d=x,S=S,v=h,p=0,p=(M=_)===g3.CENTER?-l/2:M===g3.RIGHT?-(l+v.x):v.x,S===Sl.Left?p+=0:S===Sl.Right?p+=l-d+v.x:p+=l/2-d/2,p),O=(x<r&&1<o.length&&(A=M),(I(t.Rw)?t.Rw:1.2*t._b)/t.jw),L=O*(u-1),R=r,N=g+L,P=(I(f)&&(R+=2*h.x,N+=2*h.y,f.Fw=_),yM.x=A*w,!(yM.y=0)),j=0,F=0;F<c;++F)"\n"===e.charAt(F)?(j+=O,A=mM(o[++T],_,h),yM.x=A*w,P=!0):(b=(y=n[F]).dimensions,E===b3.TOP?(yM.y=b.height-a-h.y,yM.y+=VA.PADDING):E===b3.CENTER?yM.y=(L+b.height-a)/2:(E===b3.BASELINE?yM.y=L:yM.y=L+s+h.y,yM.y-=VA.PADDING),yM.y=(yM.y-b.descent-j)*w,P&&(yM.x-=VA.PADDING*w,P=!1),I(y.billboard)&&(y.billboard._setTranslate(yM),y.billboard.Iw.x=R,y.billboard.Iw.y=N,y.billboard.Fw=_),F<c-1&&(m=n[F+1],yM.x+=(b.width-b.minx+m.dimensions.minx)*w));I(f)&&0<e.split("\n").join("").length&&(A=_===g3.CENTER?-r/2-h.x:_===g3.RIGHT?-(r+2*h.x):0,yM.x=A*w,E===b3.TOP?yM.y=g-a-s:E===b3.CENTER?yM.y=(g-a)/2-s:E===b3.BASELINE?yM.y=-h.y-s:yM.y=0,yM.y=yM.y*w,f.width=R,f.height=N,f._setTranslate(yM),f.Cw=p3.clone(yM,f.Cw))}function _M(t){return(_M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function EM(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=_M(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=_M(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==_M(t)?t:String(t)}(i.key),i)}}var SM=function(){function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0,e=this,i=r;if(!(e instanceof i))throw new TypeError("Cannot call a class as a function");this.opacity=1,this.mv=n,this.jv=!1,this.fv="",this.Mw='16px \'"Microsoft Yahei","",Tahoma,Arial\'',this.Fv=[0,0,0],this.Nw=[],this.style=zA.FILL,this.qg=g3.CENTER,this.Zg=b3.CENTER,this.fb=y(t.scale,1),this.kw=t.pixelOffset||[0,0],this.Qg=m3.clone(y(t.eyeOffset,m3.ZERO)),this.outlineColor=[0,0,0],this.outlineWidth=0,vM(this)}var t,n,e;return t=r,(n=[{key:"horizontalOrigin",get:function(){return this.qg}},{key:"verticalOrigin",get:function(){return this.Zg}},{key:"text",get:function(){return this.fv},set:function(t){if(this.fv!==t){if(this.fv="",-1<t.indexOf("%rn%")){for(var n=t.split("%rn%"),e=0;e<n.length;e++)this.fv+=n[e],this.fv+="\n";this.fv=this.fv.slice(0,this.fv.length-1)}else this.fv=t;this.jv=!0}}},{key:"font",get:function(){return this.Mw},set:function(t){this.Mw!==t&&(this.Mw=t,this.jv=!0,vM(this))}},{key:"pixelOffset",get:function(){return this.kw},set:function(n){this.kw=n,this.mv.Wg.Sw.forEach(function(t){t.pixelOffset=n})}},{key:"totalScale",get:function(){return this.fb*this.jw}},{key:"getScreenSpaceBoundingBox",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},n=1<arguments.length?arguments[1]:void 0,e=this,i=0,r=0,o=0,s=0,a=e.totalScale,u=e.Pw;if(I(u))i=t.x+u.Yg.x,r=t.y-u.Yg.y,o=u.width*a,s=u.height*a,e.verticalOrigin===b3.BOTTOM||e.verticalOrigin===b3.BASELINE?r-=s:e.verticalOrigin===b3.CENTER&&(r-=.5*s);else{for(var i=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,c=0,f=0,h=e.Nw,l=h.length,d=0;d<l;++d){var v,p,m=h[d],y=m.billboard;I(y)&&(v=t.x+y.Yg.x,y=t.y-y.Yg.y,p=m.dimensions.width*a,m=m.dimensions.height*a,e.verticalOrigin===b3.BOTTOM||e.verticalOrigin===b3.BASELINE?y-=m:e.verticalOrigin===b3.CENTER&&(y-=.5*m),e.Zg===b3.TOP?y+=VA.PADDING*a:e.Zg!==b3.BOTTOM&&e.Zg!==b3.BASELINE||(y-=VA.PADDING*a),i=Math.min(i,v),r=Math.min(r,y),c=Math.max(c,v+p),f=Math.max(f,y+m))}o=c-i,s=f-r}return(n=I(n)?n:new aM).x=i,n.y=r,n.width=o,n.height=s,n}}])&&EM(t.prototype,n),e&&EM(t,e),Object.defineProperty(t,"prototype",{writable:!1}),r}();var TM=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=16*Math.random()|0;return("x"===t?n:3&n|8).toString(16)})},P1=Object.freeze({DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_ASTC_4x4_WEBGL:37808,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_BPTC_UNORM:36492,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047}),T2={DEPTH_COMPONENT:P1.DEPTH_COMPONENT,DEPTH_STENCIL:P1.DEPTH_STENCIL,ALPHA:P1.ALPHA,RED:P1.RED,RG:P1.RG,RGB:P1.RGB,RGBA:P1.RGBA,LUMINANCE:P1.LUMINANCE,LUMINANCE_ALPHA:P1.LUMINANCE_ALPHA,RGB_DXT1:P1.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:P1.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:P1.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:P1.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:P1.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:P1.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,RGBA_PVRTC_4BPPV1:P1.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:P1.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGBA_ASTC:P1.COMPRESSED_RGBA_ASTC_4x4_WEBGL,RGB_ETC1:P1.COMPRESSED_RGB_ETC1_WEBGL,RGB8_ETC2:P1.COMPRESSED_RGB8_ETC2,RGBA8_ETC2_EAC:P1.COMPRESSED_RGBA8_ETC2_EAC,RGBA_BC7:P1.COMPRESSED_RGBA_BPTC_UNORM},xM=Object.freeze(T2);function AM(t){return(AM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function MM(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=AM(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=AM(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==AM(t)?t:String(t)}(i.key),i)}}var OM=function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=this,e=i;if(!(n instanceof e))throw new TypeError("Cannot call a class as a function");this.je=TM(),this.width=t.width,this.height=t.height,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.ctx=this.canvas.getContext("2d")}var t,n,e;return t=i,(n=[{key:"copyFrom",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=y(t.xOffset,0),e=y(t.yOffset,0),t=t.source,i=this.canvas.height,r=t.width,o=t.height,t=t.getContext("2d").getImageData(0,0,r,o);this.ctx.putImageData(t,n,i-o-e)}}])&&MM(t.prototype,n),e&&MM(t,e),Object.defineProperty(t,"prototype",{writable:!1}),i}();function LM(t){return(LM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function RM(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=LM(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=LM(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==LM(t)?t:String(t)}(i.key),i)}}function NM(t,n,e){return n&&RM(t.prototype,n),e&&RM(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var PM=NM(function t(n,e,i,r,o){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.bottomLeft=y(n,p3.ZERO),this.topRight=y(e,p3.ZERO),this.childNode1=i,this.childNode2=r,this.imageIndex=o});function jM(t,n,e){var i=function t(n,e,i){var r,o;if(I(e))return I(e.childNode1)||I(e.childNode2)?t(n,e.childNode1,i)||t(n,e.childNode2,i):I(e.imageIndex)||(o=e.topRight.x-e.bottomLeft.x,r=e.topRight.y-e.bottomLeft.y,o-=i.width,r-=i.height,o<0)||r<0?void 0:0==o&&0==r?e:(r<o?(e.childNode1=new PM(new Mt(e.bottomLeft.x,e.bottomLeft.y),new Mt(e.bottomLeft.x+i.width,e.topRight.y)),(r=e.bottomLeft.x+i.width+n.Dw)<e.topRight.x&&(e.childNode2=new PM(new Mt(r,e.bottomLeft.y),new Mt(e.topRight.x,e.topRight.y)))):(e.childNode1=new PM(new Mt(e.bottomLeft.x,e.bottomLeft.y),new Mt(e.topRight.x,e.bottomLeft.y+i.height)),(o=e.bottomLeft.y+i.height+n.Dw)<e.topRight.y&&(e.childNode2=new PM(new Mt(e.bottomLeft.x,o),new Mt(e.topRight.x,e.topRight.y)))),t(n,e.childNode1,i))}(t,t.hs,n);if(I(i)){i.imageIndex=e;var r=t.ah.width,o=t.ah.height,s=i.topRight.x-i.bottomLeft.x,a=i.topRight.y-i.bottomLeft.y,u=i.bottomLeft.x/r,c=i.bottomLeft.y/o;t.Uw[e]=new aM(u,c,s/r,a/o),t.ah.copyFrom({source:n,xOffset:i.bottomLeft.x,yOffset:i.bottomLeft.y})}else{var f=t,u=n,c=f.numberOfImages,s=f.Dw;if(0<c){for(var c=f.ah.width,r=f.ah.height,h=2*(c+u.width+s),l=2*(r+u.height+s),d=c/h,v=r/l,c=new PM(new Mt(c+s,s),new Mt(h,r)),c=new PM(new Mt,new Mt(h,r),f.hs,c),r=new PM(new Mt(s,r+s),new Mt(h,l)),c=new PM(new Mt,new Mt(h,l),c,r),p=0;p<f.Uw.length;p++){var m=f.Uw[p];I(m)&&(m.x*=d,m.y*=v,m.width*=d,m.height*=v)}r=new OM({context:f._context,width:h,height:l,pixelFormat:f.Bw});r.copyFrom({source:f.ah.canvas}),f.ah=r,f.hs=c}else{h=2*(u.width+2*s),l=2*(u.height+2*s);h<f.Gw.x&&(h=f.Gw.x),l<f.Gw.y&&(l=f.Gw.y),f.ah=f.ah&&f.ah.destroy(),f.ah=new OM({context:f._context,width:h,height:l,pixelFormat:f.Bw}),f.hs=new PM(new Mt(s,s),new Mt(h,l))}jM(t,n,e)}t.Hw=TM()}function FM(t){return(FM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function IM(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=FM(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=FM(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==FM(t)?t:String(t)}(i.key),i)}}var CM=new Mt(16,16),kM=function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=this,e=i;if(!(n instanceof e))throw new TypeError("Cannot call a class as a function");n=y(t.borderWidthInPixels,1),e=y(t.initialSize,CM);this.Bw=y(t.pixelFormat,xM.RGBA),this.Dw=n,this.Uw=[],this.Hw=TM(),this.Xw={},this.zw={},this.Gw=e,this.hs=void 0}var t,n,e;return t=i,(n=[{key:"numberOfImages",get:function(){return this.Uw.length}},{key:"textureCoordinates",get:function(){return this.Uw}},{key:"texture",get:function(){return this.ah}},{key:"addImageSync",value:function(t,n){if(!I(t))throw new m("id is required.");var e,i;if(I(n))return I(e=this.zw[t])||(n=n,e=!I(i=this)||i.isDestroyed()?-1:(jM(i,n,n=i.numberOfImages),n),this.Xw[t]=Promise.resolve(e),this.zw[t]=e),e;throw new m("image is required.")}},{key:"isDestroyed",value:function(){return!1}},{key:"addImage",value:function(t){var n=this.Xw[t];return I(n)||(this.Xw[t]=n),n}}])&&IM(t.prototype,n),e&&IM(t,e),Object.defineProperty(t,"prototype",{writable:!1}),i}();function DM(t){return(DM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function UM(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=DM(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=DM(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==DM(t)?t:String(t)}(i.key),i)}}U2=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.map=null,this.Pv={},this.Vw=[],this.Mp=[],this.nw=new kM,this.Wg=new XA,this.Wg.nw=this.nw}var n,e,i;return n=t,(e=[{key:"add",value:function(t){t=new SM(t,this);return this.Mp.push(t),this.Wg.label=t}},{key:"update",value:function(){for(var t=this.Mp.length,n=0;n<t;n++){var e=this.Mp[n];if(e.jv){b=y=m=p=d=l=h=v=i=c=u=a=s=f=o=r=void 0;var i,r=this,o=e,s=f=o.fv,a=f.length,u=o.Nw,c=u.length;if(o.jw=o._b/VA.FONT_SIZE,a<c)for(i=a;i<c;++i)lM(0,u[i]);u.length=a;for(var f=o._showBackground&&0<f.split("\n").join("").length,h=o.Pw,l=r._backgroundBillboardCollection,d=(f?(I(h)||(h=l.add({collection:r,image:"ID_WHITE_PIXEL",imageSubRegion:gM}),o.Pw=h),h.color=o.Ty,h.show=o.Lf,h.position=o._position,h.eyeOffset=o.Qg,h.pixelOffset=o.kw,h.horizontalOrigin=g3.LEFT,h.verticalOrigin=o.Zg,h.heightReference=o._heightReference,h.scale=o.totalScale,h.pickPrimitive=o,h.id=o.je,h.translucencyByDistance=o._translucencyByDistance,h.pixelOffsetScaleByDistance=o._pixelOffsetScaleByDistance,h.scaleByDistance=o._scaleByDistance,h.distanceDisplayCondition=o._distanceDisplayCondition,h.disableDepthTestDistance=o._disableDepthTestDistance):I(h)&&(l.remove(h),o.Pw=h=void 0),r.Pv),v=0;v<a;++v){var p=s[v],m=o.Zg,y=JSON.stringify([p,o.i1,o.Ow,o.Lw,+m]),b=d[y];I(b)||(b=(m=pM(p,o,r,m)).glyphTextureInfo,d[y]=b," "!==p&&(b.index=r.nw.addImageSync(y,m.canvas))),I(p=u[v])?-1===b.index?lM(0,p):I(p.textureInfo)&&(p.textureInfo=void 0):(p=new iM,u[v]=p),p.textureInfo=b,p.dimensions=b.dimensions,-1!==b.index&&(m=p.billboard,b=r.Vw,I(m)||(0<b.length?m=b.pop():((m=r.Wg.add({collection:r})).Iw=new Mt,m.Cw=new Mt),p.billboard=m),m.show=o.Lf,m.position=o._position,m.eyeOffset=o.Qg,m.pixelOffset=o.kw,m.horizontalOrigin=g3.LEFT,m.verticalOrigin=o.Zg,m.heightReference=o._heightReference,m.scale=o.totalScale,m.pickPrimitive=o,m.id=o.je,m.image=y,m.translucencyByDistance=o._translucencyByDistance,m.pixelOffsetScaleByDistance=o._pixelOffsetScaleByDistance,m.scaleByDistance=o._scaleByDistance,m.distanceDisplayCondition=o._distanceDisplayCondition,m.disableDepthTestDistance=o._disableDepthTestDistance,m.Ww=o.Ww,m.outlineColor=o.outlineColor,o.style===zA.FILL_AND_OUTLINE?(m.color=o.Fv,m.outlineWidth=o.outlineWidth):o.style===zA.FILL?(m.color=o.Fv,m.outlineWidth=0):o.style===zA.OUTLINE&&(m.color=v3.TRANSPARENT,m.outlineWidth=o.outlineWidth))}o.Yw=!0,e.jv=!1}e.Yw&&(wM(e),e.Yw=!1)}this.Wg.update()}}])&&UM(n.prototype,e),i&&UM(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}(),F_=t(32),f2=t.n(F_);function BM(t){return function(t){if(Array.isArray(t))return GM(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){var e;if(t)return"string"==typeof t?GM(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?GM(t,n):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function GM(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function HM(t){return(HM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function XM(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function zM(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=HM(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=HM(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==HM(t)?t:String(t)}(i.key),i)}}function VM(t,n,e){n&&zM(t.prototype,n),e&&zM(t,e),Object.defineProperty(t,"prototype",{writable:!1})}var WM=function(){function h(){XM(this,h)}return VM(h,null,[{key:"getPointFromBound",value:function(t){var n=t.min.x,e=t.min.y,i=t.max.x,t=t.max.y;return[{x:n,y:e},{x:n,y:t},{x:i,y:e},{x:i,y:t}]}},{key:"getBoundFromPoint",value:function(t){for(var n=t[0].x,e=t[0].y,i=t[0].x,r=t[0].y,o=0;o<t.length;o++){var s=t[o];n>s.x&&(n=s.x),e>s.y&&(e=s.y),i<s.x&&(i=s.x),r<s.y&&(r=s.y)}return{max:{x:i,y:r},min:{x:n,y:e},size:{x:i-n,y:r-e}}}},{key:"getRotationBound",value:function(t,n){for(var e=new xt(0,1,0),i=(new At).makeRotationAxis(e,n.getRotation()*Math.PI/180),r=h.getPointFromBound(t),o=[],s=0;s<r.length;s++){var a=(a=new xt(r[s].x-n.x,0,n.y-r[s].y)).applyMatrix4(i);o.push(a)}for(var u=[],c=0;c<r.length;c++){var f=o[c];u.push({x:f.x+n.x,y:n.y-f.z})}return h.getBoundFromPoint(u)}}]),h}(),YM=function(){function v(){XM(this,v)}return VM(v,null,[{key:"showFloorNode",value:function(t,n){for(var e=0;e<n.It.length;e++){var i=n.It[e];if(-1<t.getVisibleLevels().indexOf(n.level))for(var r=0;r<i.It.length;r++){var o=i.It[r];o.xi||1!=o.visible||t.fi.Do.push([e,o])}}}},{key:"showAllNode",value:function(n){for(n.getLevels().forEach(function(t){v.showFloorNode(n,n.getFloor(t))});0<n.fi.Do.length;)n.fi.Uo()}},{key:"recoveAllNode",value:function(t){t.enableUpdateNode(),t.fi.ko()}},{key:"setVisibleLevelsFrustumCulled",value:function(t,n){for(var e=t.Dt,i=t.getVisibleLevels(),r=0;r<i.length;r++){var o=i[r]+"_"+S.LABEL,s=i[r]+"_"+S.FACILITY,a=i[r]+"_"+S.TEXT_MARKER,u=i[r]+"_"+S.IMAGE_MARKER,o=e.Xr.get(o),s=e.Xr.get(s),a=e.Xr.get(a),u=e.Xr.get(u),c=[];o&&o.children&&c.push.apply(c,BM(o.children)),s&&s.children&&c.push.apply(c,BM(s.children)),a&&a.children&&c.push.apply(c,BM(a.children)),u&&u.children&&c.push.apply(c,BM(u.children)),c.forEach(function(t){t.frustumCulled=n})}}},{key:"setValue",value:function(t,n,e){e[t]=n}},{key:"getValue",value:function(t,n){return n[t]}},{key:"addLastFrame",value:function(n,e){var i=window.devicePixelRatio||1,t=n.Dt.renderer,r=t.domElement.parentElement,o=t.domElement.clientWidth,s=t.domElement.clientHeight,a=document.createElement("canvas"),u=(a.width=o*i,a.height=s*i,a.style.width=o+"px",a.style.height=s+"px",a.style.position="absolute",a.style.zIndex=1,a.className="exportImageLastFrame",a.getContext("2d")),c=new Image;c.onload=function(t){u.drawImage(t.path[0],0,0,o*i,s*i),r.append(a),n.Qe.Ye({type:"printBefor"}),e()},c.onerror=function(t){console.warn("fail...",t)},n.Dt.render(),c.src=t.domElement.toDataURL()}},{key:"removeLastFrame",value:function(t){var n=t.Dt.renderer,e=document.querySelector(".exportImageLastFrame"),n=n.domElement.parentElement;n&&e&&n.removeChild(e),t.Qe.Ye({type:"printAfter"})}},{key:"start",value:function(t){var n={callback:null,viewParam:{width:0,height:0},state:{col:0,row:0,loadCount:0},camera:null,backCamera:null,width:0,height:0,padding:0,canvas:null,renderTarget:null,cameraType:null,defaultLogoAspact:null},e=t.padding,i=t.map,r=t.imageWidth,o=t.imageHieght,s=t.callback,a=t.bound,t=t.cameraType,u=(a&&(v.setValue("originBound",{max:{x:a.max.x,y:a.max.y},min:{x:a.min.x,y:a.min.y}},n),a.size||(a.size.x=a.max.x-a.min.x,a.size.y=a.max.y-a.min.y),u=r/a.size.x,c=o/a.size.y,a=WM.getRotationBound(a,i),Math.abs(c-u)<.1)&&(r=a.size.x*u,o=a.size.y*c),v.setValue("mapZoom",i.getZoom(),n),v.setValue("cameraType",t||"2d",n),v.setValue("backCamera","2d"==n.cameraType?i.ze:{aspect:i.ze.aspect},n),r/o),c=(15e3<(o=15e3<r?+(r=15e3)/u:o)&&(r=(o=15e3)*u),e=e||0,e*=2,r=Math.ceil(r),o=Math.ceil(o),v.setValue("width",r,n),v.setValue("height",o,n),i.Dt.renderer.domElement.clientWidth),t=i.Dt.renderer.domElement.clientHeight,u=(v.setValue("defaultLogoAspact",c/t,n),v.setValue("domSize",{width:c,height:t},n),v.setValue("padding",e,n),v.setValue("callback",s,n),{width:r,height:o}),c=(4096<u.width&&(u.width=4096),4096<u.height&&(u.height=4096),v.setValue("viewParam",u,n),Math.ceil(r/n.viewParam.width)),t=Math.ceil(o/n.viewParam.height),s=(v.setValue("state",{col:c,row:t,loadCount:0},n),document.createElement("canvas"));s.width=r,s.height=o,s.style.width=r+"px",s.style.height=o+"px",v.setValue("canvas",s,n),"2d"==n.cameraType?(c=v.getCameraParame2d(i,r,o,a,e,void 0,n),v.setValue("camera",c,n),i.ze=c):"3d"==n.cameraType&&v.setCameraParame3d(i,r,o,null,e,n),i.Dt.renderer.setPixelRatio(1),i.Dt.renderer.setSize(u.width,u.height),i.Qe.Ye({type:"viewModeChanged"}),v.shot(i,s,n)}},{key:"print",value:function(t){v.addLastFrame(t.map,function(){v.start(t)})}},{key:"recoverParam",value:function(t,n){"2d"===n.cameraType?(t.ze=v.getValue("backCamera",n),t.Je=t.ze):"3d"===n.cameraType&&(e=v.getValue("backCamera",n),t.ze.aspect=e.aspect,t.ze.clearViewOffset());var e=v.getValue("domSize",n),i=window.devicePixelRatio||1;t.Dt.renderer.setPixelRatio(i),t.Dt.renderer.setSize(e.width,e.height),t.Qe.Ye({type:"viewModeChanged"}),v.recoveAllNode(t,n),v.setLogo(t,v.getValue("defaultLogoAspact",n)),t.Nt.Ut.object=t.ze,v.setVisibleLevelsFrustumCulled(t,!0),t.Dt.Ei(),t.Dt.bo=!0,t.Dt.renderer.clear(),t.Dt.render(),t.enableUpdateNode(),v.removeLastFrame(t)}},{key:"getCameraParame2d",value:function(t,n,e,i,r,o,s){var a,u,c,f,h=Math.min(n,e),o=o||(h-r)/h,r=t.getState(),h=i.min,i=i.max,l=Math.abs(i.x-h.x),i=Math.abs(i.y-h.y),h=n/e,n=(h<i/l?(c=-l/2,f=l/2,a=-l/h/2,u=l/h/2):(a=-i/2,u=i/2,c=-i*h/2,f=i*h/2),new vt(c,f,u,a,1,1e4));n.zoom=o,n.up=new xt(0,1,0),n.rotation.x=-Math.PI/2,n.rotation.y=0,n.rotation.z=-r.rotation*Math.PI/180;e=t.getBound().center,l=v.getValue("originBound",s),i=(l.max.x+l.min.x)/2-e.x,h=(l.max.y+l.min.y)/2-e.y;return n.position.x=i,n.position.y=t.ze.position.y,n.position.z=-h,n.updateProjectionMatrix(),n.updateMatrix(),n.updateMatrixWorld(),n.updateWorldMatrix(),n.matrixWorldNeedsUpdate=!0,n}},{key:"setCameraParame3d",value:function(t,n,e,i,r,o){t.ze.aspect=n/e,v.setValue("camera",t.ze,o)}},{key:"readPixcel",value:function(e,i,r,o){var t=v.getValue("state",o),s=t.row,a=t.col,t=e.Dt.renderer,u=v.getValue("canvas",o),n=v.getValue("viewParam",o),c=n.width,f=n.height,h=u.getContext("2d"),n=document.createElement("canvas"),l=(n.width=c,n.height=f,n.getContext("2d")),d=v.getValue("callback",o),n=new Image;n.onload=function(t){var n=v.getValue("state",o);n.loadCount++,v.setValue("state",n,o),l.drawImage(t.path[0],0,0,c,f),h.putImageData(l.getImageData(0,0,c,f),i,r),n.loadCount===s*a&&(u.toBlob(function(t){d&&d(t)}),v.recoverParam(e,o),o.callback=null,o.viewParam=null,o.state=null,o.camera=null,o.backCamera=null,o.canvas=null,o=null)},e.Dt.render(),n.src=t.domElement.toDataURL()}},{key:"setLogo",value:function(t,n){t.Dt.needLogo&&(n=Math.min(n,1),t.Dt.po.material.uniforms.offset.value.x=-1*(.5*.4/n-1))}},{key:"caleAvoid",value:function(t,n){var e,i;"2d"!=t.cameraType&&t.cameraType,"2d"==t.cameraType?(v.showAllNode(n,t),i=v.getValue("width",t),e=v.getValue("height",t),n.Dt.renderer.setSize(i,e),n.Dt.Ei(),n.Dt.Zo(),i=v.getValue("viewParam",t),n.Dt.renderer.setSize(i.width,i.height)):(n.Dt.Ei(),n.Dt.Zo())}},{key:"shot",value:function(t,n,e){v.setLogo(t,e.width/e.height);var i=v.getValue("camera",e),r=(t.Dt.bo=!0,v.setVisibleLevelsFrustumCulled(t,!1),v.getValue("state",e)),o=r.row,s=r.col,a=v.getValue("viewParam",e);v.caleAvoid(e,t);for(var u=0;u<o*s;u++){var c=Math.floor(u/s),f=Math.max(u-c*s,0),h=n.width,l=n.height,d=new Image,c=(d.indexI=c,d.indexJ=f,a.width*d.indexJ),f=a.height*d.indexI;i.setViewOffset(h,l,c,f,a.width,a.height),i.updateProjectionMatrix(),v.readPixcel(t,c,f,e)}}}]),v}();function QM(t){return(QM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ZM(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function qM(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=QM(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=QM(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==QM(t)?t:String(t)}(i.key),i)}}function KM(t,n,e){n&&qM(t.prototype,n),e&&qM(t,e),Object.defineProperty(t,"prototype",{writable:!1})}var JM=function(){function o(){ZM(this,o)}return KM(o,null,[{key:"getRenderNode",value:function(t){var n=null;if(t)return t.getRenderNode?(n=t.getRenderNode())&&"Group"===n.type&&(n=n.children[0]):t.xi&&(n=t.xi),n}},{key:"downLoad",value:function(t){var n,e=new FileReader;e.readAsDataURL(t),e.onload=function(t){(n=t.target.result).length<6||((t=document.createElement("a")).download=(new Date).getTime()+".jpg",t.href=n,document.body.appendChild(t),t.click(),t.remove())}}},{key:"setLogo",value:function(t,n){t.Dt.needLogo&&(n=Math.min(n,1),t.Dt.po.material.uniforms.offset.value.x=-1*(.5*.4/n-1))}},{key:"setVisibleLevelsFrustumCulled",value:function(t,n,e){this.forEachElement(t,n,function(t){var n=o.getRenderNode(t);n&&(n.frustumCulled=e),t.type===S.LABEL&&null!=(n=t.getRenderNode())&&n.children.forEach(function(t){t.frustumCulled=e})})}},{key:"addLastFrame",value:function(t,n){var e=st.a.window.devicePixelRatio||1,i=t.Dt.renderer,r=i.domElement.parentElement,o=i.domElement.clientWidth,s=i.domElement.clientHeight,a=document.createElement("canvas"),u=(a.width=o*e,a.height=s*e,a.style.width=o+"px",a.style.height=s+"px",a.style.position="absolute",a.style.zIndex=0,a.className="exportImageLastFrame",a.getContext("2d")),c=new Image,f=(c.crossOrigin="Anonymous",c.onload=function(){u.drawImage(c,0,0,o*e,s*e),r.append(a),t.Qe.Ye({type:"printBefor"}),n()},c.onerror=function(t){console.warn("fail...",t)},t.Dt.render(),"FF"===pl?"image/jpeg":"image/png");c.src=i.domElement.toDataURL(f,1)}},{key:"insideBound",value:function(t,n){var e=!1;return e=t.min.x>=n.min.x&&t.min.y>=n.min.y&&t.max.x<=n.max.x&&t.max.y<=n.max.y?!0:e}},{key:"forEachElement",value:function(t,n,e){for(var i=t.getFloor(n),r=0;r<i.It.length;r++)for(var o=i.It[r],s=0;s<o.It.length;s++)e(o.It[s])}},{key:"getInBoundSpriteElement",value:function(t,n,e,i){var r=this;this.forEachElement(t,n,function(t){var n=o.getRenderNode(t);n&&"Sprite"===n.type&&r.insideBound(t.bound,e)&&(t.type!==S.LABEL||0<t.text.length)&&i.push(t)})}},{key:"getElementBound",value:function(t){var n=new Ur;return t.forEach(function(t){n.expand(t.bound)}),n}}]),o}(),$M=function(){function f(){ZM(this,f)}return KM(f,null,[{key:"getSpriteWorldSize",value:function(t,n,e,i){var r;if(t.parent.isHasText){var o=t.getScreenSize();if(!o||isNaN(o.width)||isNaN(o.height))return null;r=o.width,o=o.height}else{t=null==(t=JM.getRenderNode(t))||null==(t=t.material)||null==(t=t.map)?void 0:t.image;if(!t)return null;o=t.height/2,r=t.width/2}return{x:r*Math.abs(n.left-n.right)/n.zoom/i,y:o*Math.abs(n.top-n.bottom)/n.zoom/e}}},{key:"getSpriteBound",value:function(t,n,e,i){var r={},o={},s=(t=Math.ceil(t),n=Math.ceil(n),new Ur);return r.x=e.x-i.x*t,o.x=e.x+(1-i.x)*t,o.y=e.y-i.y*n,r.y=e.y+(1-i.y)*n,s.expandByCoords([r,o]),s}},{key:"calcElements",value:function(t,n,e,i,r){for(var o=0;o<t.length;o++){var s,a,u=t[o],c=JM.getRenderNode(u);c&&"Sprite"===c.type&&(s=f.getSpriteWorldSize(u,e,i,r))&&(a=void 0,a=u.getAnchor?u.getAnchor():c.center,c=f.getSpriteBound(s.x,s.y,u.bound.center,a),isNaN(c.size.x)||isNaN(c.size.y)||c.size.x===1/0||c.size.y===1/0||n.expand(c))}}},{key:"getWidthSpriteBound",value:function(t,n,e,i,r){this.calcElements(t,r,n,e,i)}}]),f}(),tO=function(){function r(){ZM(this,r)}return KM(r,null,[{key:"createCamera",value:function(){var t=new vt(-1,1,1,-1,1,1e4);return t.up=new xt(0,1,0),t}},{key:"calcExportWidthHeight",value:function(t){var n=t[0].distanceTo(t[1]);return{exportWidth:t[1].distanceTo(t[2]),exportHeight:n}}},{key:"updateCamera",value:function(t,n,e,i,r){r.left=-n/2,r.right=n/2,r.top=e/2,r.bottom=-e/2;var o=1,s=i.center,a=i.size,i=null!=(i=i.rotation)?i:0,o=n/e>a.x/a.y?e/a.y:n/a.x;r.rotation.x=-Math.PI/2,r.rotation.y=0,r.rotation.z=-i*Math.PI/180;e=t.It[0].x,n=t.It[0].y,a=s.x-e,i=n-s.y;r.position.x=a,r.position.y=Math.max((t.getLevels().length+1)*t.getFloorSpace(),1e3),r.position.z=i,r.zoom=o,r.updateProjectionMatrix(),r.updateMatrixWorld()}},{key:"readOptions",value:function(t,n,e){e.buildings=void 0!==e.buildings?e.buildings:[],e.autoDownload=void 0===e.autoDownload||e.autoDownload,e.isExpandbound=void 0===e.isExpandbound||e.isExpandbound,e.padding=void 0!==e.padding?e.padding:5,e.color=void 0!==e.color?e.color:"rgba(255, 255, 255, 1.0)",e.imageWidth=void 0!==e.width?e.width:1e3,e.imageHeight=void 0!==e.height?e.height:1e3,delete e.width,delete e.height;15e3<e.imageWidth&&(e.imageWidth=15e3),15e3<e.imageHeight&&(e.imageHeight=15e3),e.imageWidth<200&&(e.imageWidth=200),e.imageHeight<200&&(e.imageHeight=200),e.imageWidth=Math.ceil(e.imageWidth),e.imageHeight=Math.ceil(e.imageHeight),e.level=void 0!==e.level?e.level:1,e.oldLevel=t.getLevel(),e.bound=n,e.map=t}},{key:"initOptions",value:function(t){(t=Object.assign(t,{renderSizeMap:{width:null,height:null},renderSizeExport:{width:0,height:0},camera:null,backCamera:null,imageRenderSize:{width:null,height:null}})).renderSizeMap={width:t.map.Dt.renderer.domElement.clientWidth,height:t.map.Dt.renderer.domElement.clientHeight},t.imageRenderSize={width:t.imageWidth-2*t.padding,height:t.imageHeight-2*t.padding},t.renderSizeExport={width:t.imageRenderSize.width,height:t.imageRenderSize.height};2048<t.renderSizeExport.width&&(t.renderSizeExport.width=2048),2048<t.renderSizeExport.height&&(t.renderSizeExport.height=2048),t.backCamera=t.map.camera,t.camera=this.createCamera()}},{key:"findSpriteElement",value:function(t,n,e){var i=[];return JM.getInBoundSpriteElement(t,n,e,i),i}},{key:"expandBoundBySprite",value:function(t,n){for(var e=n.bound.clone(),i=0;i<100&&(this.updateCamera(n.map,n.imageRenderSize.width,n.imageRenderSize.height,e,n.camera),$M.getWidthSpriteBound(t,n.camera,n.imageRenderSize.height,n.imageRenderSize.width,e),!(15e3<e.size.x||15e4<e.size.y));i++);var r=n.bound.clone();return r.expand(e),r}},{key:"addLastFrame",value:function(t,n){JM.addLastFrame(t,n)}},{key:"setStyle",value:function(t,n,e,i,r){JM.forEachElement(t,n,function(n){e.forEach(function(t){if(t.type===n.type)switch(t.type){case S.LABEL:"befor"===r?0<n.text.length&&i.push(n.Ov(t.fontSize)):n.fontSize=null;break;case S.TEXT_MARKER:"befor"===r?(n.xi.userData.originFontSize=n.fontSize,n.fontSize=t.fontSize):(n.fontSize=n.xi.userData.originFontSize,delete n.xi.userData.originFontSize),n.update();break;case S.FACILITY:n.size="befor"===r?t.size:null;break;case S.IMAGE_MARKER:"befor"===r?(n.xi.userData.originSize=n.size,n.size=t.size):(n.size=n.xi.userData.originSize,delete n.xi.userData.originSize)}})})}},{key:"befor",value:function(a){var u=this;return new Promise(function(t,n){var e=a.style,i=void 0===e?[]:e,r=a.map,e=a.level,o=a.buildings,s=(r.fi.$p=!1,[]);u.setStyle(r,e,i,s,"befor"),o.forEach(function(t){var n=r.getBuilding(t.buildingID);u.setStyle(n,t.level,i,s,"befor")}),Promise.all(s).then(t)})}},{key:"after",value:function(t){var e=this,n=t.style,i=void 0===n?[]:n,r=t.map,n=t.level,t=t.buildings,o=(r.fi.$p=!0,[]);this.setStyle(r,n,i,o),t.forEach(function(t){var n=r.getBuilding(t.buildingID);e.setStyle(n,t.level,i,o)})}},{key:"updateSize",value:function(t,n){JM.forEachElement(t,n,function(t){t.updateSize?t.updateSize():t.Co&&t.Co()})}},{key:"caleAvoid",value:function(n){var e=this;n.map.setDevicePixalRatio(1),n.map.Dt.renderer.setSize(n.imageRenderSize.width,n.imageRenderSize.height),n.map.Dt.Ei(),n.map.Dt.bo=!0,n.map.Dt.Zo(n.zoom),this.updateSize(n.map,n.level),n.buildings.forEach(function(t){t=n.map.getBuilding(t.buildingID);e.updateSize(t,t.level)}),n.map.Dt.renderer.setSize(n.renderSizeExport.width,n.renderSizeExport.height),n.map.Qe.Ye({type:"resize"})}},{key:"start",value:function(n,t){var e=n.map,i=n.imageRenderSize,r=n.renderSizeExport,o=n.camera,s=(JM.setLogo(e,i.width/i.height),JM.setVisibleLevelsFrustumCulled(e,n.level,!1),n.buildings.forEach(function(t){t=n.map.getBuilding(t.buildingID);JM.setVisibleLevelsFrustumCulled(t,t.level,!1)}),this.caleAvoid(n),document.createElement("canvas")),a=(s.width=n.imageWidth,s.height=n.imageHeight,s.style.width=n.imageWidth+"px",s.style.height=n.imageHeight+"px",s.getContext("2d")),u={col:0,row:0,loadCount:0};if(u.col=Math.ceil(n.imageRenderSize.width/n.renderSizeExport.width),u.row=Math.ceil(n.imageRenderSize.height/n.renderSizeExport.height),isNaN(u.col)||isNaN(u.row))t(null);else for(var c=0;c<u.row*u.col;c++){var f=Math.floor(c/u.col),h=Math.max(c-f*u.col,0),h=r.width*h,f=r.height*f;o.setViewOffset(i.width,i.height,h,f,r.width,r.height),o.updateProjectionMatrix(),this.renderImage(h,f,u,s,a,t,n)}}},{key:"renderDomMarker",value:function(a){if(a.dependent&&a.dependent.html2canvas){a.camera.view=null,this.updateCamera(a.map,a.width,a.height,a.bound,a.camera);for(var t=a.width/2,n=a.height/2,e=new xt,i=new At,r=new At,u=(i.copy(a.camera.matrixWorldInverse),r.multiplyMatrices(a.camera.projectionMatrix,i),[]),o=[],s=a.map.Yy,c=0;c<s.It.length;c++){var f=s.It[c];f.level===a.level&&(e.setFromMatrixPosition(f.xi.matrixWorld),e.applyMatrix4(r),u.push({x:e.x*t+t,y:-e.y*n+n}),f=a.dependent.html2canvas(f.xi.element.childNodes[0],{backgroundColor:null}),o.push(f))}0==o.length?a.callback(a.canvasAll):Promise.all(o).then(function(r){for(var o=0,s=0;s<r.length;s++)!function(){var t=r[s],n=u[s],e=new Image,i=(e.onload=function(){o+=1,a.ctxAll.drawImage(e,n.x-t.width/2,n.y-t.height/2),o===r.length&&a.callback(a.canvasAll)},e.onerror=function(t){(o+=1)===r.length&&a.callback(a.canvasAll)},"FF"===pl?"image/jpeg":"image/png");e.src=t.toDataURL(i,1)}()}).catch(function(t){console.error(t),a.callback(a.canvasAll)})}else a.callback(a.canvasAll)}},{key:"renderImage",value:function(t,n,e,i,r,o,s){var a=this,u=s.map,c=s.padding,f=s.renderSizeExport,h=document.createElement("canvas"),l=(h.width=f.width,h.height=f.height,h.getContext("2d")),d=new Image,h=(d.crossOrigin="Anonymous",d.onload=function(){e.loadCount++,l.drawImage(d,0,0,f.width,f.height),r.putImageData(l.getImageData(0,0,f.width,f.height),t+c,n+c),e.loadCount===e.row*e.col&&a.renderDomMarker({ctxAll:r,level:s.level,canvasAll:i,map:s.map,width:s.imageWidth,height:s.imageHeight,camera:s.camera,dependent:s.dependent,bound:s.bound,callback:function(t){r.fillStyle=s.color,r.fillRect(0,0,s.imageWidth,s.padding),r.fillRect(0,0,s.padding,s.imageHeight),r.fillRect(0,s.imageHeight-s.padding,s.imageWidth,s.imageHeight),r.fillRect(s.imageWidth-s.padding,0,s.imageWidth,s.imageHeight),t.toBlob(function(t){s.autoDownload&&JM.downLoad(t),o(t)})}})},u.Dt.render(),"FF"===pl?"image/jpeg":"image/png");d.src=u.Dt.renderer.domElement.toDataURL(h,1)}},{key:"recoverParamCore",value:function(t){var n=t.map,e=(n.ze=t.backCamera,t.renderSizeMap),i=window.devicePixelRatio||1;n.Dt.renderer.setSize(e.width,e.height),n.setDevicePixalRatio(i),JM.setLogo(n,e.width/e.height),n.Nt.Ut.object=n.ze,t.map.Qe.Ye({type:"resize"})}},{key:"findWattingLabelNodeByLevel",value:function(t,n,e){JM.forEachElement(t,n,function(t){t.type==S.LABEL&&t.visible&&e.push(t)})}},{key:"findAllWattingLabelNode",value:function(t,n){r.findWattingLabelNodeByLevel(t.map,t.level,n);for(var e=0;e<t.buildings.length;e++){var i=t.map.getBuilding(t.buildings[e].buildingID);r.findWattingLabelNodeByLevel(i,i.level,n)}}},{key:"recoverParam",value:function(n){var e=this,t=n.map;this.updateSize(n.map,n.level),n.buildings.forEach(function(t){t=n.map.getBuilding(t.buildingID);e.updateSize(t,t.level)}),JM.setVisibleLevelsFrustumCulled(t,n.level,!0),n.buildings.forEach(function(t){t=n.map.getBuilding(t.buildingID);JM.setVisibleLevelsFrustumCulled(t,t.level,!0)}),t.Dt.Ei(),t.Dt.bo=!0,t.enableUpdateNode()}},{key:"removeLastFrame",value:function(t){var n=t.Dt.renderer.domElement.parentElement;n&&n.childNodes.forEach(function(t){"exportImageLastFrame"===t.className&&n.removeChild(t)}),t.Qe.Ye({type:"printAfter"})}}]),r}();function nO(t){return(nO="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function eO(){eO=function(){return s};var u,s={},t=Object.prototype,c=t.hasOwnProperty,f=Object.defineProperty||function(t,n,e){t[n]=e.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",e=n.asyncIterator||"@@asyncIterator",r=n.toStringTag||"@@toStringTag";function o(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{o({},"")}catch(u){o=function(t,n,e){return t[n]=e}}function a(t,n,e,i){var r,o,s,a,n=n&&n.prototype instanceof y?n:y,n=Object.create(n.prototype),i=new A(i||[]);return f(n,"_invoke",{value:(r=t,o=e,s=i,a=l,function(t,n){if(a===v)throw new Error("Generator is already running");if(a===p){if("throw"===t)throw n;return{value:u,done:!0}}for(s.method=t,s.arg=n;;){var e=s.delegate;if(e){e=function t(n,e){var i=e.method,r=n.iterator[i];if(r===u)return e.delegate=null,"throw"===i&&n.iterator.return&&(e.method="return",e.arg=u,t(n,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),m;i=h(r,n.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,m;r=i.arg;return r?r.done?(e[n.resultName]=r.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=u),e.delegate=null,m):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}(e,s);if(e){if(e===m)continue;return e}}if("next"===s.method)s.sent=s.Mt=s.arg;else if("throw"===s.method){if(a===l)throw a=p,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);a=v;e=h(r,o,s);if("normal"===e.type){if(a=s.done?p:d,e.arg===m)continue;return{value:e.arg,done:s.done}}"throw"===e.type&&(a=p,s.method="throw",s.arg=e.arg)}})}),n}function h(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}s.wrap=a;var l="suspendedStart",d="suspendedYield",v="executing",p="completed",m={};function y(){}function b(){}function g(){}var n={},w=(o(n,i,function(){return this}),Object.getPrototypeOf),w=w&&w(w(M([]))),_=(w&&w!==t&&c.call(w,i)&&(n=w),g.prototype=y.prototype=Object.create(n));function E(t){["next","throw","return"].forEach(function(n){o(t,n,function(t){return this._invoke(n,t)})})}function S(s,a){var n;f(this,"_invoke",{value:function(e,i){function t(){return new a(function(t,n){!function n(t,e,i,r){var o,t=h(s[t],s,e);if("throw"!==t.type)return(e=(o=t.arg).value)&&"object"==nO(e)&&c.call(e,"__await")?a.resolve(e.Ot).then(function(t){n("next",t,i,r)},function(t){n("throw",t,i,r)}):a.resolve(e).then(function(t){o.value=t,i(o)},function(t){return n("throw",t,i,r)});r(t.arg)}(e,i,t,n)})}return n=n?n.then(t,t):t()}})}function T(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function x(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function M(n){if(n||""===n){var e,t=n[i];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return e=-1,(t=function t(){for(;++e<n.length;)if(c.call(n,e))return t.value=n[e],t.done=!1,t;return t.value=u,t.done=!0,t}).next=t}throw new TypeError(nO(n)+" is not iterable")}return f(_,"constructor",{value:b.prototype=g,configurable:!0}),f(g,"constructor",{value:b,configurable:!0}),b.displayName=o(g,r,"GeneratorFunction"),s.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},s.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,o(t,r,"GeneratorFunction")),t.prototype=Object.create(_),t},s.awrap=function(t){return{Ot:t}},E(S.prototype),o(S.prototype,e,function(){return this}),s.AsyncIterator=S,s.async=function(t,n,e,i,r){void 0===r&&(r=Promise);var o=new S(a(t,n,e,i),r);return s.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},E(_),o(_,r,"Generator"),o(_,i,function(){return this}),o(_,"toString",function(){return"[object Generator]"}),s.keys=function(t){var n,e=Object(t),i=[];for(n in e)i.push(n);return i.reverse(),function t(){for(;i.length;){var n=i.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},s.values=M,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this.Mt=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(x),!t)for(var n in this)"t"===n.charAt(0)&&c.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=u)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function t(t,n){return o.type="throw",o.arg=e,i.next=t,n&&(i.method="next",i.arg=u),!!n}for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var s=c.call(r,"catchLoc"),a=c.call(r,"finallyLoc");if(s&&a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var o=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=n&&n<=r.finallyLoc?null:r)?r.completion:{};return o.type=t,o.arg=n,r?(this.method="next",this.next=r.finallyLoc,m):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),m},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),x(e),m}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e,i,r=this.tryEntries[n];if(r.tryLoc===t)return"throw"===(e=r.completion).type&&(i=e.arg,x(r)),i}throw new Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:M(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=u),m}},s}function iO(t,n,e,i,r,o,s){try{var a=t[o](s),u=a.value}catch(t){return void e(t)}a.done?n(u):Promise.resolve(u).then(i,r)}function rO(t){return function(t){if(Array.isArray(t))return oO(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){var e;if(t)return"string"==typeof t?oO(t,n):"Map"===(e="Object"===(e=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?oO(t,n):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oO(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function sO(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=nO(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=nO(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==nO(t)?t:String(t)}(i.key),i)}}var aO=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function");this.buildings=t.buildings,this.map=t.map,this.onlyInBuilding=t.onlyInBuilding,this.buildingOldParam=[],this.innerBuildingIDs=[],this.outterBuildingIDs=[],this.initBuildingIDs(),this.saveBuildingParam(),this.setBuildingsParamForExport()}var t,e,i,a,r;return t=n,(e=[{key:"restoreBuildingParam",value:function(){var o=this,s=this.map,a=[];return this.onlyInBuilding&&this.setBuildingVisible(null,!0),this.setBuildingOverviewMode(this.innerBuildingIDs,lm.INDOOR),this.buildingOldParam.forEach(function(t){var n=t.buildingID,e=t.level,i=t.visibleLevels,r=t.overviewMode,t=t.facadeNodeVisible,r=(o.setBuildingVisible(n,!0),void 0!==r&&o.setBuildingOverviewMode([n],r),a.push(o.setBuildingLevel(n,i,e)),s.getBuilding(n));r&&(r.Bf.visible=t,r.Qf())}),this.map.Wi=this.Wi,Promise.all(a)}},{key:"initBuildingIDs",value:function(){var t=this.buildings,n=this.map,e=[],i=t.map(function(t){return t.buildingID});n.getBuildings().forEach(function(t){!1===i.includes(t.je)&&e.push(t.je)}),this.innerBuildingIDs=i,this.outterBuildingIDs=e}},{key:"saveBuildingParam",value:function(){this.Wi=this.map.Wi,this.map.Wi=!1;for(var t=this.map,n=this.innerBuildingIDs,e=this.outterBuildingIDs,i=(this.buildingOldParam.push({buildingID:null,level:t.getLevel(),visibleLevels:t.getVisibleLevels()}),[].concat(rO(n),rO(e))),r=0;r<i.length;r++){var o=t.getBuilding(i[r]);this.buildingOldParam.push({buildingID:o.je,level:o.level,visibleLevels:o.visibleLevels,overviewMode:o.overviewMode,facadeNodeVisible:o.Bf.visible})}}},{key:"checkBuildingLoaded",value:function(){for(var t=this.buildings,n=this.map,e=0,i=0;i<t.length;i++)n.Ft.Xi(t[i].buildingID).loaded&&(e+=1);return e===t.length}},{key:"setBuildingOverviewMode",value:function(t,n){var e=this.map;e.changeOverviewMode({buildingIDs:t,overviewMode:n,duration:0}),t.forEach(function(t){e.getBuilding(t).Bf.visible=n!==lm.INDOOR})}},{key:"setBuildingsParamForExport",value:function(){var n=this;this.setBuildingOverviewMode(this.innerBuildingIDs,lm.INDOOR),this.setBuildingOverviewMode(this.outterBuildingIDs,lm.OUTDOOR),this.onlyInBuilding&&this.setBuildingVisible(null,!1),this.innerBuildingIDs.forEach(function(t){n.setBuildingVisible(t,!0)}),this.outterBuildingIDs.forEach(function(t){n.setBuildingVisible(t,!1)}),this.map.Dt.es()}},{key:"loadBuildings",value:function(){var r=this;return new Promise(function(n,t){var e,i;r.checkBuildingLoaded()?n():(e=r.buildings,(i=r.map).on("buildingLoaded",function t(){r.checkBuildingLoaded()&&(i.off("buildingLoaded",t),n())}),e.forEach(function(t){t=i.getBuilding(t.buildingID);i.fi.Nm(t)}),setTimeout(function(){t("...")},1e4))})}},{key:"setBuildingVisible",value:function(t,n){var e=this.map,e=null===t?e.kt:e.getBuilding(t);e&&(e.It.forEach(function(t){t.visible=n}),e.visible=n,e.traverse(function(t){t.sr({animate:!1})}))}},{key:"setBuildingLevel",value:function(i,r,o){var s=this.map;return new Promise(function(t,n){var e;i?(e=s.getBuilding(i))?e.setVisibleLevels(r,function(){e.traverse(function(t){t.sr({animate:!1})}),e.setLevel({level:o,animate:!1,finish:function(){e.traverse(function(t){t.sr({animate:!1})}),t()}})}):n("buildingId: ".concat(i," ")):s.setVisibleLevels(r,function(){s.setLevel({level:o,animate:!1,finish:t})})})}},{key:"loadLevel",value:(a=eO().mark(function t(){var n,e,i;return eO().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(n=this.buildings,e=[],i=0;i<n.length;i++)e.push(this.setBuildingLevel(n[i].buildingID,[n[i].level],n[i].level));return t.abrupt("return",Promise.all(e));case 4:case"end":return t.stop()}},t,this)}),r=function(){var t=this,s=arguments;return new Promise(function(n,e){var i=a.apply(t,s);function r(t){iO(i,n,e,r,o,"next",t)}function o(t){iO(i,n,e,r,o,"throw",t)}r(void 0)})},function(){return r.apply(this,arguments)})}])&&sO(t.prototype,e),i&&sO(t,i),Object.defineProperty(t,"prototype",{writable:!1}),n}();function uO(t){return(uO="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function cO(){cO=function(){return s};var u,s={},t=Object.prototype,c=t.hasOwnProperty,f=Object.defineProperty||function(t,n,e){t[n]=e.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",e=n.asyncIterator||"@@asyncIterator",r=n.toStringTag||"@@toStringTag";function o(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{o({},"")}catch(u){o=function(t,n,e){return t[n]=e}}function a(t,n,e,i){var r,o,s,a,n=n&&n.prototype instanceof y?n:y,n=Object.create(n.prototype),i=new A(i||[]);return f(n,"_invoke",{value:(r=t,o=e,s=i,a=l,function(t,n){if(a===v)throw new Error("Generator is already running");if(a===p){if("throw"===t)throw n;return{value:u,done:!0}}for(s.method=t,s.arg=n;;){var e=s.delegate;if(e){e=function t(n,e){var i=e.method,r=n.iterator[i];if(r===u)return e.delegate=null,"throw"===i&&n.iterator.return&&(e.method="return",e.arg=u,t(n,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),m;i=h(r,n.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,m;r=i.arg;return r?r.done?(e[n.resultName]=r.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=u),e.delegate=null,m):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}(e,s);if(e){if(e===m)continue;return e}}if("next"===s.method)s.sent=s.Mt=s.arg;else if("throw"===s.method){if(a===l)throw a=p,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);a=v;e=h(r,o,s);if("normal"===e.type){if(a=s.done?p:d,e.arg===m)continue;return{value:e.arg,done:s.done}}"throw"===e.type&&(a=p,s.method="throw",s.arg=e.arg)}})}),n}function h(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}s.wrap=a;var l="suspendedStart",d="suspendedYield",v="executing",p="completed",m={};function y(){}function b(){}function g(){}var n={},w=(o(n,i,function(){return this}),Object.getPrototypeOf),w=w&&w(w(M([]))),_=(w&&w!==t&&c.call(w,i)&&(n=w),g.prototype=y.prototype=Object.create(n));function E(t){["next","throw","return"].forEach(function(n){o(t,n,function(t){return this._invoke(n,t)})})}function S(s,a){var n;f(this,"_invoke",{value:function(e,i){function t(){return new a(function(t,n){!function n(t,e,i,r){var o,t=h(s[t],s,e);if("throw"!==t.type)return(e=(o=t.arg).value)&&"object"==uO(e)&&c.call(e,"__await")?a.resolve(e.Ot).then(function(t){n("next",t,i,r)},function(t){n("throw",t,i,r)}):a.resolve(e).then(function(t){o.value=t,i(o)},function(t){return n("throw",t,i,r)});r(t.arg)}(e,i,t,n)})}return n=n?n.then(t,t):t()}})}function T(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function x(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function M(n){if(n||""===n){var e,t=n[i];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return e=-1,(t=function t(){for(;++e<n.length;)if(c.call(n,e))return t.value=n[e],t.done=!1,t;return t.value=u,t.done=!0,t}).next=t}throw new TypeError(uO(n)+" is not iterable")}return f(_,"constructor",{value:b.prototype=g,configurable:!0}),f(g,"constructor",{value:b,configurable:!0}),b.displayName=o(g,r,"GeneratorFunction"),s.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},s.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,o(t,r,"GeneratorFunction")),t.prototype=Object.create(_),t},s.awrap=function(t){return{Ot:t}},E(S.prototype),o(S.prototype,e,function(){return this}),s.AsyncIterator=S,s.async=function(t,n,e,i,r){void 0===r&&(r=Promise);var o=new S(a(t,n,e,i),r);return s.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},E(_),o(_,r,"Generator"),o(_,i,function(){return this}),o(_,"toString",function(){return"[object Generator]"}),s.keys=function(t){var n,e=Object(t),i=[];for(n in e)i.push(n);return i.reverse(),function t(){for(;i.length;){var n=i.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},s.values=M,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this.Mt=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(x),!t)for(var n in this)"t"===n.charAt(0)&&c.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=u)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function t(t,n){return o.type="throw",o.arg=e,i.next=t,n&&(i.method="next",i.arg=u),!!n}for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var s=c.call(r,"catchLoc"),a=c.call(r,"finallyLoc");if(s&&a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var o=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=n&&n<=r.finallyLoc?null:r)?r.completion:{};return o.type=t,o.arg=n,r?(this.method="next",this.next=r.finallyLoc,m):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),m},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),x(e),m}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e,i,r=this.tryEntries[n];if(r.tryLoc===t)return"throw"===(e=r.completion).type&&(i=e.arg,x(r)),i}throw new Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:M(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=u),m}},s}function fO(t,n,e,i,r,o,s){try{var a=t[o](s),u=a.value}catch(t){return void e(t)}a.done?n(u):Promise.resolve(u).then(i,r)}function hO(a){return function(){var t=this,s=arguments;return new Promise(function(n,e){var i=a.apply(t,s);function r(t){fO(i,n,e,r,o,"next",t)}function o(t){fO(i,n,e,r,o,"throw",t)}r(void 0)})}}function lO(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=uO(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=uO(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==uO(t)?t:String(t)}(i.key),i)}}var dO=!1,vO=0,Dv=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")}var n,e,i,o;return n=t,e=null,i=[{key:"_drawImage",value:function(t,n,e,i,r,o){var s=Math.min(r/e,o/i),e=e*s,i=i*s;t.drawImage(n,(r-e)/2,(o-i)/2,e,i)}},{key:"screenshot",value:function(s,t,n,e,a,u,c,f){var h=this,l=n.x-t.x,d=n.y-t.y,i=(n.x+t.x)/2,r=(n.y+t.y)/2,o=s.Dt.renderer.domElement.style.width,v=s.Dt.renderer.domElement.style.height,p=o.split("p")[0],m=v.split("p")[0],y=null,y=(n.x-t.x)/(n.y-t.y)>p/m?p/(n.x-t.x):m/(n.y-t.y),o=i-p/2,v=r-m/2,n=document.getElementsByTagName("canvas")[0],b=document.createElement("canvas"),g=document.createElement("canvas"),w=document.createElement("canvas"),_=st.a.window.devicePixelRatio,E=new Image,S=(s.getViewMode(),s.ze.setViewOffset(p*y,m*y,p*(y-1)/2+o*y,m*(y-1)/2+v*y,p,m),s.Dt.render(),b.width=l*y*_,b.height=d*y*_,b.style.width=l*y*_+"px",b.style.height=d*y*_+"px",e?(g.width=1240*Math.pow(1.414,a-1),g.height=1754*Math.pow(1.414,a-1),g.style.width=1240*Math.pow(1.414,a-1)+"px",g.style.height=1754*Math.pow(1.414,a-1)+"px"):(g.height=1240*Math.pow(1.414,a-1),g.width=1754*Math.pow(1.414,a-1),g.style.height=1240*Math.pow(1.414,a-1)+"px",g.style.width=1754*Math.pow(1.414,a-1)+"px"),w.height=f||d*Math.pow(1.414,a-1),w.width=c||l*Math.pow(1.414,a-1),w.style.height=w.height+"px",w.style.width=w.width+"px",E.src=n.toDataURL("image/png"),(s.getViewMode()===Li.PERSPECTIVE?s.Ke:s.Je).clearViewOffset(),b.getContext("2d")),T=g.getContext("2d"),x=w.getContext("2d");E.onload=function(){s.getViewMode(),S.drawImage(E,-(p*_-l*y*_)/2,-(m*_-d*y*_)/2);var o=new Image;o.src=b.toDataURL("image/png"),o.onload=function(){s.camera.clearViewOffset(),s.enableUpdateRender();var t=Math.min(1240*Math.pow(1.414,a-1)/(l*y),1754*Math.pow(1.414,a-1)/(d*y)),n=(g.width-l*y*t)/2,e=(g.height-d*y*t)/2,i=(T.drawImage(o,n,e,l*y*t,d*y*t),c&&f?h._drawImage(x,o,l,d,w.width,w.height):x.drawImage(o,0,0,l*Math.pow(1.414,a-1),d*Math.pow(1.414,a-1)),g.toDataURL("image/png")),r=w.toDataURL("image/png");-1<navigator.userAgent.indexOf("Edge")||-1<navigator.userAgent.indexOf(".NET4.0C")?u(i,null,r,null):g.toBlob(function(n){return w.toBlob(function(t){return u(i,n,r,t)})})}}}},{key:"print",value:function(t,n){var e=this,i=(dO=!0,t.getZoom()),r=(t.setZoom({animate:!0,zoom:29}),t.Nt.Ut.target.x),o=t.Nt.Ut.target.z,s=(t.Nt.Ut.panAdd({x:-r,z:-o,y:0}),t.getTilt()),a=t.getRotation(),u=document.createElement("canvas");u.width=6*t.Dt.renderer.domElement.width,u.height=6*t.Dt.renderer.domElement.height,t.setTilt({tilt:90,finish:function(){t.setRotation({rotation:0})}}),t.getViewMode()===Li.MODE_3D?t.setViewMode({mode:Li.MODE_2D,callback:function(){return e.shot_(t,u,u.getContext("2d"),0,t.Je.zoom,r,o,i,Li.MODE_3D,s,a,n)}}):this.shot_(t,u,u.getContext("2d"),0,t.Je.zoom,r,o,i,Li.MODE_2D,s,a,n)}},{key:"export",value:function(t){var n;void 0!==t.imageWidth&&void 0!==t.imageHieght&&(n=t.map.getViewMode(),void 0===t.mode?t.cameraType=n===Li.MODE_2D?"2d":"3d":t.cameraType=t.mode===Li.MODE_2D?"2d":"3d",n!=Li.MODE_2D||t.mode!==Li.MODE_3D)&&YM.print(t)}},{key:"shot_",value:function(e,i,r,t,o,s,a,u,c,f,h,l){var n,d,v,p,m;return dO&&t<36?(d=n=null,t<6?(n=0,d=+t):t<12?(n=1,d=t-6):t<18?(n=2,d=t-12):t<24?(n=3,d=t-18):t<30?(n=4,d=t-24):t<36&&(n=5,d=t-30),v=e.Dt.renderer.domElement.width,p=e.Dt.renderer.domElement.height,(m=new Image).indexI=n,m.indexJ=d,e.Je.setViewOffset(v,p,2.5*-v+v*n,2.5*-p+p*d,v,p),e.Je.updateProjectionMatrix(),m.onload=function(t){vO++;var n=(n=t.target)||t.path[0];r.drawImage(n,v*n.indexI,p*n.indexJ),36===vO&&(i.toBlob(function(t){e.Je.zoom=6*o,e.Je.updateProjectionMatrix(),e.setViewMode({mode:c,callback:function(){e.setRotation({rotation:h,finish:function(){e.setTilt({tilt:f})}})}}),e.setZoom({zoom:u}),e.Je.clearViewOffset(),e.Dt.zi(),e.Nt.Ut.panAdd({x:s,z:a,y:0}),e.Dt.Ei(),e.Nt.Ut.update(),e.Dt.render(),dO=!1,l(t)}),vO=0)},e.Dt.Ei(),e.Nt.Ut.update(),e.Dt.render(),m.src=e.Dt.renderer.domElement.toDataURL(),this.shot_(e,i,r,++t,o,s,a,u,c,f,h,l)):void 0}},{key:"exportToImage",value:(o=hO(cO().mark(function t(s,a,u,c,f){return cO().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(u=u||{},tO.readOptions(s,a,u),tO.initOptions(u),u.renderSizeExport.width<=0||u.renderSizeExport.height<=0)return f&&f("0"),t.abrupt("return");t.next=6;break;case 6:if(1==u.onlyInBuilding&&0==u.map.getBuildings().length)return f&&f(""),t.abrupt("return");t.next=9;break;case 9:tO.addLastFrame(u.map,hO(cO().mark(function t(){var r,o,e,n;return cO().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(u.map.Dt.renderer.domElement.style.opacity="0",r=new aO(u),o=u.map.Ft.Jo,u.map.Ft.Jo=!1,e=function(){var t=hO(cO().mark(function t(){var n,e,i;return cO().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(n=[],u.map.fi.ko(!0,u.zoom);0<u.map.fi.Do.length;)u.map.fi.Uo();for(tO.findAllWattingLabelNode(u,n),u.map.Dt.es(),e=[],i=0;i<n.length;i++)0<n[i].text.length&&e.push(n[i].Lv());Promise.all(e).then(hO(cO().mark(function t(){var n;return cO().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,tO.befor(u);case 2:!0===u.isExpandbound&&(n=tO.findSpriteElement(u.map,u.level,u.bound),a=tO.expandBoundBySprite(n,u)),tO.updateCamera(u.map,u.imageRenderSize.width,u.imageRenderSize.height,a,u.camera),u.map.camera=u.camera,tO.start(u,function(){var n=hO(cO().mark(function t(n){return cO().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return tO.recoverParamCore(u),t.next=3,r.restoreBuildingParam();case 3:for(tO.after(u),u.map.fi.ko();0<u.map.fi.Do.length;)u.map.fi.Uo();tO.recoverParam(u),u.map.Dt.render(),u.map.toolBar&&(u.map.toolBar.enable=!0),u.map.Dt.Ei(),u.map.Dt.bo=!0,u.map.Dt.Zo(),u.map.Dt.es(),u.map.Dt.renderer.domElement.style.opacity="1",u.map.Ft.Jo=o,tO.removeLastFrame(s),null!==n?c&&c(n):f&&f();case 17:case"end":return t.stop()}},t)}));return function(t){return n.apply(this,arguments)}}());case 6:case"end":return t.stop()}},t)})));case 8:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}(),n=function(){var t,n=[!1,!1];Td.isLoaded()?(n[0]=!0,n.every(function(t){return t})&&e()):(t=Td.onLoad,Td.onLoad=function(){t(),n[0]=!0,Td.onLoad=t,n.every(function(t){return t})&&e()}),El.$a===El.Ja?(n[1]=!0,n.every(function(t){return t})&&e()):El.tu.set(u.map.wu,function(){El.tu.delete(u.map.wu),n[1]=!0,n.every(function(t){return t})&&e()})},0<u.buildings.length)return t.next=9,r.loadBuildings();t.next=15;break;case 9:return t.next=11,r.loadLevel();case 11:return n(),t.abrupt("return");case 15:u.map.setVisibleLevels([u.level],function(){u.map.setLevel({level:u.level,animate:!1,finish:n})});case 16:case"end":return t.stop()}},t)})));case 10:case"end":return t.stop()}},t)})),function(t,n,e,i,r){return o.apply(this,arguments)})}],e&&lO(n.prototype,e),i&&lO(n,i),Object.defineProperty(n,"prototype",{writable:!1}),t}();function pO(t){return(pO="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function mO(){mO=function(){return s};var u,s={},t=Object.prototype,c=t.hasOwnProperty,f=Object.defineProperty||function(t,n,e){t[n]=e.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",e=n.asyncIterator||"@@asyncIterator",r=n.toStringTag||"@@toStringTag";function o(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{o({},"")}catch(u){o=function(t,n,e){return t[n]=e}}function a(t,n,e,i){var r,o,s,a,n=n&&n.prototype instanceof y?n:y,n=Object.create(n.prototype),i=new A(i||[]);return f(n,"_invoke",{value:(r=t,o=e,s=i,a=l,function(t,n){if(a===v)throw new Error("Generator is already running");if(a===p){if("throw"===t)throw n;return{value:u,done:!0}}for(s.method=t,s.arg=n;;){var e=s.delegate;if(e){e=function t(n,e){var i=e.method,r=n.iterator[i];if(r===u)return e.delegate=null,"throw"===i&&n.iterator.return&&(e.method="return",e.arg=u,t(n,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),m;i=h(r,n.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,m;r=i.arg;return r?r.done?(e[n.resultName]=r.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=u),e.delegate=null,m):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}(e,s);if(e){if(e===m)continue;return e}}if("next"===s.method)s.sent=s.Mt=s.arg;else if("throw"===s.method){if(a===l)throw a=p,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);a=v;e=h(r,o,s);if("normal"===e.type){if(a=s.done?p:d,e.arg===m)continue;return{value:e.arg,done:s.done}}"throw"===e.type&&(a=p,s.method="throw",s.arg=e.arg)}})}),n}function h(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}s.wrap=a;var l="suspendedStart",d="suspendedYield",v="executing",p="completed",m={};function y(){}function b(){}function g(){}var n={},w=(o(n,i,function(){return this}),Object.getPrototypeOf),w=w&&w(w(M([]))),_=(w&&w!==t&&c.call(w,i)&&(n=w),g.prototype=y.prototype=Object.create(n));function E(t){["next","throw","return"].forEach(function(n){o(t,n,function(t){return this._invoke(n,t)})})}function S(s,a){var n;f(this,"_invoke",{value:function(e,i){function t(){return new a(function(t,n){!function n(t,e,i,r){var o,t=h(s[t],s,e);if("throw"!==t.type)return(e=(o=t.arg).value)&&"object"==pO(e)&&c.call(e,"__await")?a.resolve(e.Ot).then(function(t){n("next",t,i,r)},function(t){n("throw",t,i,r)}):a.resolve(e).then(function(t){o.value=t,i(o)},function(t){return n("throw",t,i,r)});r(t.arg)}(e,i,t,n)})}return n=n?n.then(t,t):t()}})}function T(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function x(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function M(n){if(n||""===n){var e,t=n[i];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return e=-1,(t=function t(){for(;++e<n.length;)if(c.call(n,e))return t.value=n[e],t.done=!1,t;return t.value=u,t.done=!0,t}).next=t}throw new TypeError(pO(n)+" is not iterable")}return f(_,"constructor",{value:b.prototype=g,configurable:!0}),f(g,"constructor",{value:b,configurable:!0}),b.displayName=o(g,r,"GeneratorFunction"),s.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},s.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,o(t,r,"GeneratorFunction")),t.prototype=Object.create(_),t},s.awrap=function(t){return{Ot:t}},E(S.prototype),o(S.prototype,e,function(){return this}),s.AsyncIterator=S,s.async=function(t,n,e,i,r){void 0===r&&(r=Promise);var o=new S(a(t,n,e,i),r);return s.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},E(_),o(_,r,"Generator"),o(_,i,function(){return this}),o(_,"toString",function(){return"[object Generator]"}),s.keys=function(t){var n,e=Object(t),i=[];for(n in e)i.push(n);return i.reverse(),function t(){for(;i.length;){var n=i.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},s.values=M,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this.Mt=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(x),!t)for(var n in this)"t"===n.charAt(0)&&c.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=u)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function t(t,n){return o.type="throw",o.arg=e,i.next=t,n&&(i.method="next",i.arg=u),!!n}for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var s=c.call(r,"catchLoc"),a=c.call(r,"finallyLoc");if(s&&a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}var o=(r=r&&("break"===t||"continue"===t)&&r.tryLoc<=n&&n<=r.finallyLoc?null:r)?r.completion:{};return o.type=t,o.arg=n,r?(this.method="next",this.next=r.finallyLoc,m):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),m},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),x(e),m}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var e,i,r=this.tryEntries[n];if(r.tryLoc===t)return"throw"===(e=r.completion).type&&(i=e.arg,x(r)),i}throw new Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:M(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=u),m}},s}function yO(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,n){if("object"!=pO(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===n?String:Number)(t);e=e.call(t,n||"default");if("object"!=pO(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==pO(t)?t:String(t)}(i.key),i)}}function bO(t,n,e){return n&&yO(t.prototype,n),e&&yO(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function gO(t,n,e,i,r,o,s){try{var a=t[o](s),u=a.value}catch(t){return void e(t)}a.done?n(u):Promise.resolve(u).then(i,r)}function wO(a){return function(){var t=this,s=arguments;return new Promise(function(n,e){var i=a.apply(t,s);function r(t){gO(i,n,e,r,o,"next",t)}function o(t){gO(i,n,e,r,o,"throw",t)}r(void 0)})}}var _O=function(i,r,o,s){return function t(n){var e,n=n.data;n.id===r&&(n.error?(e=n.error,(e=new Error(n.error.message)).stack=n.error.stack,s(e)):o(n),i.removeEventListener("message",t))}};function EO(){return(EO=wO(mO().mark(function t(e,n,i){var r,o;return mO().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=i||[],r=e.Qw++,o=new Promise(function(t,n){e.Zw.addEventListener("message",_O(e.Zw,r,t,n))}),e.Zw.postMessage({id:r,parameters:n,canTransferArrayBuffer:!0},i),t.abrupt("return",o);case 6:case"end":return t.stop()}},t)}))).apply(this,arguments)}function SO(){return(SO=wO(mO().mark(function t(n,e,i){var r;return mO().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return++n.qw,t.prev=1,t.next=4,function(){return EO.apply(this,arguments)}(n,e,i);case 4:return r=t.sent,--n.qw,t.abrupt("return",r);case 9:throw t.prev=9,t.t0=t.catch(1),--n.qw,t.t0;case 13:case"end":return t.stop()}},t,null,[[1,9]])}))).apply(this,arguments)}var TO,P1=bO(function t(n,e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.Kw=e.baseURL+n,this.Qw=0,this.qw=0,this.Jw=null!=(n=e.maximumActiveTasks)?n:512,this.$w=[]}),xO=(Object.assign(P1.prototype,{t_:function(t,n){var e;if(this.Zw||(this.Zw=(e=this.Kw,(e=new Worker(e,{type:"module"})).onerror=function(t){console.error(t)},e)),!(this.qw>=this.Jw))return function(){return SO.apply(this,arguments)}(this,t,n)},n_:function(){for(var t=this;this.qw<this.Jw&&0<this.$w.length;){var n=this.$w.shift(),e=n.taskParam,i=n.resolve,n=n.reject,r=e.parameters,e=e.transferableObjects;this.t_(r,e).then(i,n).finally(function(){t.n_()})}},Ho:function(e,i){var r=this;return new Promise(function(t,n){r.$w.push({taskParam:{parameters:e,transferableObjects:i},resolve:t,reject:n}),r.n_()})},ym:function(){this.Zw&&(this.Zw.terminate(),this.Zw=void 0,this.$w.length=0,this.qw=0)}}),st.a.DepthPeelingRenderer=Bv,st.a.LabelCollection=U2,st.a.heatmap=f2.a,st.a.TaskProcessor=P1,{FMMouseMode:vo,VERSION:b,BUILD:T,FMMap:g,FMType:S,FMViewMode:Li,FMShadingMode:No,FMInfoMode:Ri,FMTextAlign:Sl,FMLineType:Lw,FMLabelField:Hm,FMMarkerAnchor:Ni,FMEdgeMode:HS,FMDepthPeelingMode:hE,FMOverviewMode:lm,FMEnterTriggerMode:fE,FMUtil:Oi,FMCalculator:uy,FMCoordsTransformer:Uv,FMImageMarker:uS,FMMarker:xg,FMTextMarker:Q1,FMPolygonMarker:y2,FMLocationMarker:N2,FMHeatMap:i2,FMDynamicModel:n,FMLineMarker:Bw,FMDomMarker:jT,FMExtrudeMarker:Z_,FMSegment:Ow,FMMarkerLayer:ky,FMBound:Ur,FMOrientedBound:b1,FMRectangle:oy,FMMarkerFun:B2,FMMapMask:B1,FMLight:nb,FMLightMode:BT,FMDynamicTextureTool:D2,FMMarkerCluster:e,ExportCompatible:Dv}),T2=af.a.global(),AO=void 0!==T2?T2.fengmap:{};for(TO in null==AO&&(AO={}),xO)AO[TO]=xO[TO];void 0!==T2&&(T2.fengmap=AO),AO.FMUtil.screenshot=Dv.screenshot,AO.FMUtil.exportToImage=Dv.exportToImage;r.default=AO}]).default});