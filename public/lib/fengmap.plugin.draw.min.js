/**Released Version v3.1.7,BUILD 62,Time 1719469149598. Fengmap Javascript SDK , see: https://www.fengmap.com for details**/
!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.fengmap=i():t.fengmap=i()}(this,function(){return n=[function(F,D,t){"use strict";t.r(D);for(var e=[],V=0;V<256;V++)e[V]=(V<16?"0":"")+V.toString(16);var d={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&n|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[255&s]+e[s>>8&255]+e[s>>16&255]+e[s>>24&255]).toUpperCase()},clamp:function(t,i,n){return Math.max(i,Math.min(n,t))},euclideanModulo:function(t,i){return(t%i+i)%i},mapLinear:function(t,i,n,s,e){return s+(t-i)*(e-s)/(n-i)},lerp:function(t,i,n){return(1-n)*t+n*i},smoothstep:function(t,i,n){return t<=i?0:n<=t?1:(t=(t-i)/(n-i))*t*(3-2*t)},smootherstep:function(t,i,n){return t<=i?0:n<=t?1:(t=(t-i)/(n-i))*t*t*(t*(6*t-15)+10)},randInt:function(t,i){return t+Math.floor(Math.random()*(i-t+1))},randFloat:function(t,i){return t+Math.random()*(i-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*d.DEG2RAD},radToDeg:function(t){return t*d.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,i,n,s,e){var r=Math.cos,h=Math.sin,o=r(n/2),n=h(n/2),u=r((i+s)/2),a=h((i+s)/2),f=r((i-s)/2),c=h((i-s)/2),r=r((s-i)/2),h=h((s-i)/2);"XYX"===e?t.set(o*a,n*f,n*c,o*u):"YZY"===e?t.set(n*c,o*a,n*f,o*u):"ZXZ"===e?t.set(n*f,n*c,o*a,o*u):"XZX"===e?t.set(o*a,n*h,n*r,o*u):"YXY"===e?t.set(n*r,o*a,n*h,o*u):"ZYZ"===e?t.set(n*h,n*r,o*a,o*u):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function r(t,i,n,s){this.u=t||0,this.v=i||0,this.A=n||0,this.M=void 0!==s?s:1}Object.assign(r,{slerp:function(t,i,n,s){return n.copy(t).slerp(i,s)},slerpFlat:function(t,i,n,s,e,r,h){var o,u,a,f=n[s+0],c=n[s+1],l=n[s+2],n=n[s+3],s=e[r+0],v=e[r+1],d=e[r+2],e=e[r+3];n===e&&f===s&&c===v&&l===d||(r=1-h,o=0<=(u=f*s+c*v+l*d+n*e)?1:-1,(a=1-u*u)>Number.EPSILON&&(a=Math.sqrt(a),u=Math.atan2(a,u*o),r=Math.sin(r*u)/a,h=Math.sin(h*u)/a),f=f*r+s*(u=h*o),c=c*r+v*u,l=l*r+d*u,n=n*r+e*u,r===1-h&&(f*=a=1/Math.sqrt(f*f+c*c+l*l+n*n),c*=a,l*=a,n*=a)),t[i]=f,t[i+1]=c,t[i+2]=l,t[i+3]=n}}),Object.defineProperties(r.prototype,{x:{get:function(){return this.u},set:function(t){this.u=t,this.S()}},y:{get:function(){return this.v},set:function(t){this.v=t,this.S()}},z:{get:function(){return this.A},set:function(t){this.A=t,this.S()}},w:{get:function(){return this.M},set:function(t){this.M=t,this.S()}}}),Object.assign(r.prototype,{isQuaternion:!0,set:function(t,i,n,s){return this.u=t,this.v=i,this.A=n,this.M=s,this.S(),this},clone:function(){return new this.constructor(this.u,this.v,this.A,this.M)},copy:function(t){return this.u=t.x,this.v=t.y,this.A=t.z,this.M=t.w,this.S(),this},setFromEuler:function(t,i){var n,s,e,r,h,o,u;if(t&&t.isEuler)return h=t.u,o=t.v,n=t.A,t=t.order,r=Math.cos,u=Math.sin,s=r(h/2),e=r(o/2),r=r(n/2),h=u(h/2),o=u(o/2),u=u(n/2),"XYZ"===t?(this.u=h*e*r+s*o*u,this.v=s*o*r-h*e*u,this.A=s*e*u+h*o*r,this.M=s*e*r-h*o*u):"YXZ"===t?(this.u=h*e*r+s*o*u,this.v=s*o*r-h*e*u,this.A=s*e*u-h*o*r,this.M=s*e*r+h*o*u):"ZXY"===t?(this.u=h*e*r-s*o*u,this.v=s*o*r+h*e*u,this.A=s*e*u+h*o*r,this.M=s*e*r-h*o*u):"ZYX"===t?(this.u=h*e*r-s*o*u,this.v=s*o*r+h*e*u,this.A=s*e*u-h*o*r,this.M=s*e*r+h*o*u):"YZX"===t?(this.u=h*e*r+s*o*u,this.v=s*o*r+h*e*u,this.A=s*e*u-h*o*r,this.M=s*e*r-h*o*u):"XZY"===t&&(this.u=h*e*r-s*o*u,this.v=s*o*r-h*e*u,this.A=s*e*u+h*o*r,this.M=s*e*r+h*o*u),!1!==i&&this.S(),this;throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.")},setFromAxisAngle:function(t,i){var i=i/2,n=Math.sin(i);return this.u=t.x*n,this.v=t.y*n,this.A=t.z*n,this.M=Math.cos(i),this.S(),this},setFromRotationMatrix:function(t){var i,t=t.elements,n=t[0],s=t[4],e=t[8],r=t[1],h=t[5],o=t[9],u=t[2],a=t[6],t=t[10],f=n+h+t;return 0<f?(i=.5/Math.sqrt(f+1),this.M=.25/i,this.u=(a-o)*i,this.v=(e-u)*i,this.A=(r-s)*i):h<n&&t<n?(i=2*Math.sqrt(1+n-h-t),this.M=(a-o)/i,this.u=.25*i,this.v=(s+r)/i,this.A=(e+u)/i):t<h?(i=2*Math.sqrt(1+h-n-t),this.M=(e-u)/i,this.u=(s+r)/i,this.v=.25*i,this.A=(o+a)/i):(i=2*Math.sqrt(1+t-n-h),this.M=(r-s)/i,this.u=(e+u)/i,this.v=(o+a)/i,this.A=.25*i),this.S(),this},setFromUnitVectors:function(t,i){var n=t.dot(i)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this.u=-t.y,this.v=t.x,this.A=0):(this.u=0,this.v=-t.z,this.A=t.y)):(this.u=t.y*i.z-t.z*i.y,this.v=t.z*i.x-t.x*i.z,this.A=t.x*i.y-t.y*i.x),this.M=n,this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(d.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,i){var n=this.angleTo(t);return 0!==n&&(i=Math.min(1,i/n),this.slerp(t,i)),this},inverse:function(){return this.conjugate()},conjugate:function(){return this.u*=-1,this.v*=-1,this.A*=-1,this.S(),this},dot:function(t){return this.u*t.u+this.v*t.v+this.A*t.A+this.M*t.M},lengthSq:function(){return this.u*this.u+this.v*this.v+this.A*this.A+this.M*this.M},length:function(){return Math.sqrt(this.u*this.u+this.v*this.v+this.A*this.A+this.M*this.M)},normalize:function(){var t=this.length();return 0===t?(this.u=0,this.v=0,this.A=0,this.M=1):(this.u=this.u*(t=1/t),this.v=this.v*t,this.A=this.A*t,this.M=this.M*t),this.S(),this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,i)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,i){var n=t.u,s=t.v,e=t.A,t=t.M,r=i.u,h=i.v,o=i.A,i=i.M;return this.u=n*i+t*r+s*o-e*h,this.v=s*i+t*h+e*r-n*o,this.A=e*i+t*o+n*h-s*r,this.M=t*i-n*r-s*h-e*o,this.S(),this},slerp:function(t,i){if(0!==i){if(1===i)return this.copy(t);var n,s=this.u,e=this.v,r=this.A,h=this.M,o=h*t.M+s*t.u+e*t.v+r*t.A;o<0?(this.M=-t.M,this.u=-t.u,this.v=-t.v,this.A=-t.A,o=-o):this.copy(t),1<=o?(this.M=h,this.u=s,this.v=e,this.A=r):((t=1-o*o)<=Number.EPSILON?(this.M=(n=1-i)*h+i*this.M,this.u=n*s+i*this.u,this.v=n*e+i*this.v,this.A=n*r+i*this.A,this.normalize()):(n=Math.sqrt(t),t=Math.atan2(n,o),o=Math.sin((1-i)*t)/n,i=Math.sin(i*t)/n,this.M=h*o+this.M*i,this.u=s*o+this.u*i,this.v=e*o+this.v*i,this.A=r*o+this.A*i),this.S())}return this},equals:function(t){return t.u===this.u&&t.v===this.v&&t.A===this.A&&t.M===this.M},fromArray:function(t,i){return this.u=t[i=void 0===i?0:i],this.v=t[i+1],this.A=t[i+2],this.M=t[i+3],this.S(),this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.u,t[i+1]=this.v,t[i+2]=this.A,t[i+3]=this.M,t},fromBufferAttribute:function(t,i){return this.u=t.getX(i),this.v=t.getY(i),this.A=t.getZ(i),this.M=t.getW(i),this},onChange:function(t){return this.S=t,this},S:function(){}});var N=new b,U=new r;function b(t,i,n){this.x=t||0,this.y=i||0,this.z=n||0}Object.assign(b.prototype,{isVector3:!0,set:function(t,i,n){return this.x=t,this.y=i,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,i)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(U.setFromEuler(t))},applyAxisAngle:function(t,i){return this.applyQuaternion(U.setFromAxisAngle(t,i))},applyMatrix3:function(t){var i=this.x,n=this.y,s=this.z,t=t.elements;return this.x=t[0]*i+t[3]*n+t[6]*s,this.y=t[1]*i+t[4]*n+t[7]*s,this.z=t[2]*i+t[5]*n+t[8]*s,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var i=this.x,n=this.y,s=this.z,t=t.elements,e=1/(t[3]*i+t[7]*n+t[11]*s+t[15]);return this.x=(t[0]*i+t[4]*n+t[8]*s+t[12])*e,this.y=(t[1]*i+t[5]*n+t[9]*s+t[13])*e,this.z=(t[2]*i+t[6]*n+t[10]*s+t[14])*e,this},applyQuaternion:function(t){var i=this.x,n=this.y,s=this.z,e=t.x,r=t.y,h=t.z,t=t.w,o=t*i+r*s-h*n,u=t*n+h*i-e*s,a=t*s+e*n-r*i,i=-e*i-r*n-h*s;return this.x=o*t+i*-e+u*-h-a*-r,this.y=u*t+i*-r+a*-e-o*-h,this.z=a*t+i*-h+o*-r-u*-e,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var i=this.x,n=this.y,s=this.z,t=t.elements;return this.x=t[0]*i+t[4]*n+t[8]*s,this.y=t[1]*i+t[5]*n+t[9]*s,this.z=t[2]*i+t[6]*n+t[10]*s,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this},clampScalar:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this},clampLength:function(t,i){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(i,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this},lerpVectors:function(t,i,n){return this.subVectors(i,t).multiplyScalar(n).add(t)},cross:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,i)):this.crossVectors(this,t)},crossVectors:function(t,i){var n=t.x,s=t.y,t=t.z,e=i.x,r=i.y,i=i.z;return this.x=s*i-t*r,this.y=t*e-n*i,this.z=n*r-s*e,this},projectOnVector:function(t){var i=t.lengthSq();return 0===i?this.set(0,0,0):(i=t.dot(this)/i,this.copy(t).multiplyScalar(i))},projectOnPlane:function(t){return N.copy(this).projectOnVector(t),this.sub(N)},reflect:function(t){return this.sub(N.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var i=Math.sqrt(this.lengthSq()*t.lengthSq());return 0===i?Math.PI/2:(t=this.dot(t)/i,Math.acos(d.clamp(t,-1,1)))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,n=this.y-t.y,t=this.z-t.z;return i*i+n*n+t*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,i,n){var s=Math.sin(i)*t;return this.x=s*Math.sin(n),this.y=Math.cos(i)*t,this.z=s*Math.cos(n),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,i,n){return this.x=t*Math.sin(i),this.y=n,this.z=t*Math.cos(i),this},setFromMatrixPosition:function(t){t=t.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(t){var i=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),t=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=n,this.z=t,this},setFromMatrixColumn:function(t,i){return this.fromArray(t.elements,4*i)},setFromMatrix3Column:function(t,i){return this.fromArray(t.elements,3*i)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,i){return this.x=t[i=void 0===i?0:i],this.y=t[i+1],this.z=t[i+2],this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t},fromBufferAttribute:function(t,i,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}});var u=new b,a=new y,Y=new b(0,0,0),H=new b(1,1,1),h=new b,G=new b,o=new b;function y(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function Z(){this.type="Curve",this.arcLengthDivisions=200}function E(t,i){this.x=t||0,this.y=i||0}function s(t,i,n,s,e,r,h,o){Z.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=i||0,this.xRadius=n||1,this.yRadius=s||1,this.aStartAngle=e||0,this.aEndAngle=r||2*Math.PI,this.aClockwise=h||!1,this.aRotation=o||0}Object.assign(y.prototype,{isMatrix4:!0,set:function(t,i,n,s,e,r,h,o,u,a,f,c,l,v,d,y){var p=this.elements;return p[0]=t,p[4]=i,p[8]=n,p[12]=s,p[1]=e,p[5]=r,p[9]=h,p[13]=o,p[2]=u,p[6]=a,p[10]=f,p[14]=c,p[3]=l,p[7]=v,p[11]=d,p[15]=y,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new y).fromArray(this.elements)},copy:function(t){var i=this.elements,t=t.elements;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],this},copyPosition:function(t){var i=this.elements,t=t.elements;return i[12]=t[12],i[13]=t[13],i[14]=t[14],this},extractBasis:function(t,i,n){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,i,n){return this.set(t.x,i.x,n.x,0,t.y,i.y,n.y,0,t.z,i.z,n.z,0,0,0,0,1),this},extractRotation:function(t){var i=this.elements,n=t.elements,s=1/u.setFromMatrixColumn(t,0).length(),e=1/u.setFromMatrixColumn(t,1).length(),t=1/u.setFromMatrixColumn(t,2).length();return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[3]=0,i[4]=n[4]*e,i[5]=n[5]*e,i[6]=n[6]*e,i[7]=0,i[8]=n[8]*t,i[9]=n[9]*t,i[10]=n[10]*t,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var i,n,s,e,r,h,o,u,a,f,c,l,v=this.elements,d=t.x,y=t.y,p=t.z,m=Math.cos(d),d=Math.sin(d),A=Math.cos(y),y=Math.sin(y),g=Math.cos(p),p=Math.sin(p);return"XYZ"===t.order?(r=m*g,h=m*p,o=d*g,u=d*p,v[0]=A*g,v[4]=-A*p,v[8]=y,v[1]=h+o*y,v[5]=r-u*y,v[9]=-d*A,v[2]=u-r*y,v[6]=o+h*y,v[10]=m*A):"YXZ"===t.order?(n=A*p,s=y*g,v[0]=(i=A*g)+(e=y*p)*d,v[4]=s*d-n,v[8]=m*y,v[1]=m*p,v[5]=m*g,v[9]=-d,v[2]=n*d-s,v[6]=e+i*d,v[10]=m*A):"ZXY"===t.order?(n=A*p,s=y*g,v[0]=(i=A*g)-(e=y*p)*d,v[4]=-m*p,v[8]=s+n*d,v[1]=n+s*d,v[5]=m*g,v[9]=e-i*d,v[2]=-m*y,v[6]=d,v[10]=m*A):"ZYX"===t.order?(r=m*g,h=m*p,o=d*g,u=d*p,v[0]=A*g,v[4]=o*y-h,v[8]=r*y+u,v[1]=A*p,v[5]=u*y+r,v[9]=h*y-o,v[2]=-y,v[6]=d*A,v[10]=m*A):"YZX"===t.order?(a=m*A,f=m*y,c=d*A,l=d*y,v[0]=A*g,v[4]=l-a*p,v[8]=c*p+f,v[1]=p,v[5]=m*g,v[9]=-d*g,v[2]=-y*g,v[6]=f*p+c,v[10]=a-l*p):"XZY"===t.order&&(a=m*A,f=m*y,c=d*A,l=d*y,v[0]=A*g,v[4]=-p,v[8]=y*g,v[1]=a*p+l,v[5]=m*g,v[9]=f*p-c,v[2]=c*p-f,v[6]=d*g,v[10]=l*p+a),v[3]=0,v[7]=0,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(Y,t,H)},lookAt:function(t,i,n){var s=this.elements;return o.subVectors(t,i),0===o.lengthSq()&&(o.z=1),o.normalize(),h.crossVectors(n,o),0===h.lengthSq()&&(1===Math.abs(n.z)?o.x+=1e-4:o.z+=1e-4,o.normalize(),h.crossVectors(n,o)),h.normalize(),G.crossVectors(o,h),s[0]=h.x,s[4]=G.x,s[8]=o.x,s[1]=h.y,s[5]=G.y,s[9]=o.y,s[2]=h.z,s[6]=G.z,s[10]=o.z,this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,i)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,i){var t=t.elements,i=i.elements,n=this.elements,s=t[0],e=t[4],r=t[8],h=t[12],o=t[1],u=t[5],a=t[9],f=t[13],c=t[2],l=t[6],v=t[10],d=t[14],y=t[3],p=t[7],m=t[11],t=t[15],A=i[0],g=i[4],b=i[8],M=i[12],w=i[1],E=i[5],S=i[9],x=i[13],R=i[2],j=i[6],O=i[10],I=i[14],k=i[3],T=i[7],B=i[11],i=i[15];return n[0]=s*A+e*w+r*R+h*k,n[4]=s*g+e*E+r*j+h*T,n[8]=s*b+e*S+r*O+h*B,n[12]=s*M+e*x+r*I+h*i,n[1]=o*A+u*w+a*R+f*k,n[5]=o*g+u*E+a*j+f*T,n[9]=o*b+u*S+a*O+f*B,n[13]=o*M+u*x+a*I+f*i,n[2]=c*A+l*w+v*R+d*k,n[6]=c*g+l*E+v*j+d*T,n[10]=c*b+l*S+v*O+d*B,n[14]=c*M+l*x+v*I+d*i,n[3]=y*A+p*w+m*R+t*k,n[7]=y*g+p*E+m*j+t*T,n[11]=y*b+p*S+m*O+t*B,n[15]=y*M+p*x+m*I+t*i,this},multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this},determinant:function(){var t=this.elements,i=t[0],n=t[4],s=t[8],e=t[12],r=t[1],h=t[5],o=t[9],u=t[13],a=t[2],f=t[6],c=t[10],l=t[14];return t[3]*(+e*o*f-s*u*f-e*h*c+n*u*c+s*h*l-n*o*l)+t[7]*(+i*o*l-i*u*c+e*r*c-s*r*l+s*u*a-e*o*a)+t[11]*(+i*u*f-i*h*l-e*r*f+n*r*l+e*h*a-n*u*a)+t[15]*(-s*h*a-i*o*f+i*h*c+s*r*f-n*r*c+n*o*a)},transpose:function(){var t=this.elements,i=t[1];return t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this},setPosition:function(t,i,n){var s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=i,s[14]=n),this},getInverse:function(t,i){void 0!==i&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");var i=this.elements,t=t.elements,n=t[0],s=t[1],e=t[2],r=t[3],h=t[4],o=t[5],u=t[6],a=t[7],f=t[8],c=t[9],l=t[10],v=t[11],d=t[12],y=t[13],p=t[14],t=t[15],m=c*p*a-y*l*a+y*u*v-o*p*v-c*u*t+o*l*t,A=d*l*a-f*p*a-d*u*v+h*p*v+f*u*t-h*l*t,g=f*y*a-d*c*a+d*o*v-h*y*v-f*o*t+h*c*t,b=d*c*u-f*y*u-d*o*l+h*y*l+f*o*p-h*c*p,M=n*m+s*A+e*g+r*b;return 0==M?this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0):(i[0]=m*(m=1/M),i[1]=(y*l*r-c*p*r-y*e*v+s*p*v+c*e*t-s*l*t)*m,i[2]=(o*p*r-y*u*r+y*e*a-s*p*a-o*e*t+s*u*t)*m,i[3]=(c*u*r-o*l*r-c*e*a+s*l*a+o*e*v-s*u*v)*m,i[4]=A*m,i[5]=(f*p*r-d*l*r+d*e*v-n*p*v-f*e*t+n*l*t)*m,i[6]=(d*u*r-h*p*r-d*e*a+n*p*a+h*e*t-n*u*t)*m,i[7]=(h*l*r-f*u*r+f*e*a-n*l*a-h*e*v+n*u*v)*m,i[8]=g*m,i[9]=(d*c*r-f*y*r-d*s*v+n*y*v+f*s*t-n*c*t)*m,i[10]=(h*y*r-d*o*r+d*s*a-n*y*a-h*s*t+n*o*t)*m,i[11]=(f*o*r-h*c*r-f*s*a+n*c*a+h*s*v-n*o*v)*m,i[12]=b*m,i[13]=(f*y*e-d*c*e+d*s*l-n*y*l-f*s*p+n*c*p)*m,i[14]=(d*o*e-h*y*e-d*s*u+n*y*u+h*s*p-n*o*p)*m,i[15]=(h*c*e-f*o*e+f*s*u-n*c*u-h*s*l+n*o*l)*m,this)},invert:function(){var t=this.elements,i=t[0],n=t[1],s=t[2],e=t[3],r=t[4],h=t[5],o=t[6],u=t[7],a=t[8],f=t[9],c=t[10],l=t[11],v=t[12],d=t[13],y=t[14],p=t[15],m=f*y*u-d*c*u+d*o*l-h*y*l-f*o*p+h*c*p,A=v*c*u-a*y*u-v*o*l+r*y*l+a*o*p-r*c*p,g=a*d*u-v*f*u+v*h*l-r*d*l-a*h*p+r*f*p,b=v*f*o-a*d*o-v*h*c+r*d*c+a*h*y-r*f*y,M=i*m+n*A+s*g+e*b;return 0==M?this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0):(t[0]=m*(m=1/M),t[1]=(d*c*e-f*y*e-d*s*l+n*y*l+f*s*p-n*c*p)*m,t[2]=(h*y*e-d*o*e+d*s*u-n*y*u-h*s*p+n*o*p)*m,t[3]=(f*o*e-h*c*e-f*s*u+n*c*u+h*s*l-n*o*l)*m,t[4]=A*m,t[5]=(a*y*e-v*c*e+v*s*l-i*y*l-a*s*p+i*c*p)*m,t[6]=(v*o*e-r*y*e-v*s*u+i*y*u+r*s*p-i*o*p)*m,t[7]=(r*c*e-a*o*e+a*s*u-i*c*u-r*s*l+i*o*l)*m,t[8]=g*m,t[9]=(v*f*e-a*d*e-v*n*l+i*d*l+a*n*p-i*f*p)*m,t[10]=(r*d*e-v*h*e+v*n*u-i*d*u-r*n*p+i*h*p)*m,t[11]=(a*h*e-r*f*e-a*n*u+i*f*u+r*n*l-i*h*l)*m,t[12]=b*m,t[13]=(a*d*s-v*f*s+v*n*c-i*d*c-a*n*y+i*f*y)*m,t[14]=(v*h*s-r*d*s-v*n*o+i*d*o+r*n*y-i*h*y)*m,t[15]=(r*f*s-a*h*s+a*n*o-i*f*o-r*n*c+i*h*c)*m,this)},scale:function(t){var i=this.elements,n=t.x,s=t.y,t=t.z;return i[0]*=n,i[4]*=s,i[8]*=t,i[1]*=n,i[5]*=s,i[9]*=t,i[2]*=n,i[6]*=s,i[10]*=t,i[3]*=n,i[7]*=s,i[11]*=t,this},getMaxScaleOnAxis:function(){var t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,n,t))},makeTranslation:function(t,i,n){return this.set(1,0,0,t,0,1,0,i,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var i=Math.cos(t),t=Math.sin(t);return this.set(1,0,0,0,0,i,-t,0,0,t,i,0,0,0,0,1),this},makeRotationY:function(t){var i=Math.cos(t),t=Math.sin(t);return this.set(i,0,t,0,0,1,0,0,-t,0,i,0,0,0,0,1),this},makeRotationZ:function(t){var i=Math.cos(t),t=Math.sin(t);return this.set(i,-t,0,0,t,i,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,i){var n=Math.cos(i),i=Math.sin(i),s=1-n,e=t.x,r=t.y,t=t.z,h=s*e,o=s*r;return this.set(h*e+n,h*r-i*t,h*t+i*r,0,h*r+i*t,o*r+n,o*t-i*e,0,h*t-i*r,o*t+i*e,s*t*t+n,0,0,0,0,1),this},makeScale:function(t,i,n){return this.set(t,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,i,n){return this.set(1,i,n,0,t,1,n,0,t,i,1,0,0,0,0,1),this},compose:function(t,i,n){var s=this.elements,e=i.u,r=i.v,h=i.A,i=i.M,o=e+e,u=r+r,a=h+h,f=e*o,c=e*u,e=e*a,l=r*u,r=r*a,h=h*a,o=i*o,u=i*u,i=i*a,a=n.x,v=n.y,n=n.z;return s[0]=(1-(l+h))*a,s[1]=(c+i)*a,s[2]=(e-u)*a,s[3]=0,s[4]=(c-i)*v,s[5]=(1-(f+h))*v,s[6]=(r+o)*v,s[7]=0,s[8]=(e+u)*n,s[9]=(r-o)*n,s[10]=(1-(f+l))*n,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this},decompose:function(t,i,n){var s=this.elements,e=u.set(s[0],s[1],s[2]).length(),r=u.set(s[4],s[5],s[6]).length(),h=u.set(s[8],s[9],s[10]).length(),t=(this.determinant()<0&&(e=-e),t.x=s[12],t.y=s[13],t.z=s[14],a.copy(this),1/e),s=1/r,o=1/h;return a.elements[0]*=t,a.elements[1]*=t,a.elements[2]*=t,a.elements[4]*=s,a.elements[5]*=s,a.elements[6]*=s,a.elements[8]*=o,a.elements[9]*=o,a.elements[10]*=o,i.setFromRotationMatrix(a),n.x=e,n.y=r,n.z=h,this},makePerspective:function(t,i,n,s,e,r){void 0===r&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var h=this.elements,o=2*e/(n-s),u=(i+t)/(i-t),n=(n+s)/(n-s),s=-(r+e)/(r-e),r=-2*r*e/(r-e);return h[0]=2*e/(i-t),h[4]=0,h[8]=u,h[12]=0,h[1]=0,h[5]=o,h[9]=n,h[13]=0,h[2]=0,h[6]=0,h[10]=s,h[14]=r,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this},makeOrthographic:function(t,i,n,s,e,r){var h=this.elements,o=1/(i-t),u=1/(n-s),a=1/(r-e),i=(i+t)*o,t=(n+s)*u,n=(r+e)*a;return h[0]=2*o,h[4]=0,h[8]=0,h[12]=-i,h[1]=0,h[5]=2*u,h[9]=0,h[13]=-t,h[2]=0,h[6]=0,h[10]=-2*a,h[14]=-n,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this},equals:function(t){for(var i=this.elements,n=t.elements,s=0;s<16;s++)if(i[s]!==n[s])return!1;return!0},fromArray:function(t,i){void 0===i&&(i=0);for(var n=0;n<16;n++)this.elements[n]=t[n+i];return this},toArray:function(t,i){var n=this.elements;return(t=void 0===t?[]:t)[i=void 0===i?0:i]=n[0],t[i+1]=n[1],t[i+2]=n[2],t[i+3]=n[3],t[i+4]=n[4],t[i+5]=n[5],t[i+6]=n[6],t[i+7]=n[7],t[i+8]=n[8],t[i+9]=n[9],t[i+10]=n[10],t[i+11]=n[11],t[i+12]=n[12],t[i+13]=n[13],t[i+14]=n[14],t[i+15]=n[15],t}}),Object.assign(Z.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,i){t=this.getUtoTmapping(t);return this.getPoint(t,i)},getPoints:function(t){void 0===t&&(t=5);for(var i=[],n=0;n<=t;n++)i.push(this.getPoint(n/t));return i},getSpacedPoints:function(t){void 0===t&&(t=5);for(var i=[],n=0;n<=t;n++)i.push(this.getPointAt(n/t));return i},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var i,n,s=[],e=this.getPoint(0),r=0;for(s.push(0),n=1;n<=t;n++)r+=(i=this.getPoint(n/t)).distanceTo(e),s.push(r),e=i;return this.cacheArcLengths=s},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,i){for(var n,s=this.getLengths(),e=0,r=s.length,h=i||t*s[r-1],o=0,u=r-1;o<=u;)if((n=s[e=Math.floor(o+(u-o)/2)]-h)<0)o=e+1;else{if(!(0<n)){u=e;break}u=e-1}return s[e=u]===h?e/(r-1):(e+(h-(i=s[e]))/(s[e+1]-i))/(r-1)},getTangent:function(t){var i=t-1e-4,t=t+1e-4,i=(1<t&&(t=1),this.getPoint(i=i<0?0:i));return this.getPoint(t).clone().sub(i).normalize()},getTangentAt:function(t){t=this.getUtoTmapping(t);return this.getTangent(t)},computeFrenetFrames:function(t,i){for(var n,s=new b,e=[],r=[],h=[],o=new b,u=new y,a=0;a<=t;a++)e[a]=this.getTangentAt(a/t),e[a].normalize();r[0]=new b,h[0]=new b;var f=Number.MAX_VALUE,c=Math.abs(e[0].x),l=Math.abs(e[0].y),v=Math.abs(e[0].z);for(c<=f&&(f=c,s.set(1,0,0)),l<=f&&(f=l,s.set(0,1,0)),v<=f&&s.set(0,0,1),o.crossVectors(e[0],s).normalize(),r[0].crossVectors(e[0],o),h[0].crossVectors(e[0],r[0]),a=1;a<=t;a++)r[a]=r[a-1].clone(),h[a]=h[a-1].clone(),o.crossVectors(e[a-1],e[a]),o.length()>Number.EPSILON&&(o.normalize(),n=Math.acos(d.clamp(e[a-1].dot(e[a]),-1,1)),r[a].applyMatrix4(u.makeRotationAxis(o,n))),h[a].crossVectors(e[a],r[a]);if(!0===i)for(n=Math.acos(d.clamp(r[0].dot(r[t]),-1,1)),n/=t,0<e[0].dot(o.crossVectors(r[0],r[t]))&&(n=-n),a=1;a<=t;a++)r[a].applyMatrix4(u.makeRotationAxis(e[a],n*a)),h[a].crossVectors(e[a],r[a]);return{tangents:e,normals:r,binormals:h}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),Object.defineProperties(E.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(E.prototype,{isVector2:!0,set:function(t,i){return this.x=t,this.y=i,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var i=this.x,n=this.y,t=t.elements;return this.x=t[0]*i+t[3]*n+t[6],this.y=t[1]*i+t[4]*n+t[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this},clampScalar:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this},clampLength:function(t,i){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(i,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,t=this.y-t.y;return i*i+t*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this},lerpVectors:function(t,i,n){return this.subVectors(i,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,i){return this.x=t[i=void 0===i?0:i],this.y=t[i+1],this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.x,t[i+1]=this.y,t},fromBufferAttribute:function(t,i,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this},rotateAround:function(t,i){var n=Math.cos(i),i=Math.sin(i),s=this.x-t.x,e=this.y-t.y;return this.x=s*n-e*i+t.x,this.y=s*i+e*n+t.y,this}}),((s.prototype=Object.create(Z.prototype)).constructor=s).prototype.isEllipseCurve=!0,s.prototype.getPoint=function(t,i){for(var i=i||new E,n=2*Math.PI,s=this.aEndAngle-this.aStartAngle,e=Math.abs(s)<Number.EPSILON;s<0;)s+=n;for(;n<s;)s-=n;s<Number.EPSILON&&(s=e?0:n),!0!==this.aClockwise||e||(s===n?s=-n:s-=n);var r,h,o,u,e=this.aStartAngle+t*s,t=this.aX+this.xRadius*Math.cos(e),e=this.aY+this.yRadius*Math.sin(e);return 0!==this.aRotation&&(r=Math.cos(this.aRotation),h=Math.sin(this.aRotation),t=(o=t-this.aX)*r-(u=e-this.aY)*h+this.aX,e=o*h+u*r+this.aY),i.set(t,e)},s.prototype.copy=function(t){return Z.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this};var X={FULL:0,DOTTED:2,DOT_DASH:4,CENTER:8,DASH:16,DOUBLE_DOT_DASH:32,TRI_DOT_DASH:64,FMARROW:128,ARROW:256},f=new b,Q=new b,z=new b,c=new b,J=new b,K=new b,_=new b;function W(t,i){this.origin=void 0!==t?t:new b,this.direction=void 0!==i?i:new b(0,0,-1)}function q(){this.mask=1}function $(t,i,n,s){this.ray=new W(t,i),this.near=n||0,this.far=s||1/0,this.camera=null,this.layers=new q,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function tt(t,i){return t.distance-i.distance}function it(t,i,n,s){if(t.layers.test(i.layers)&&t.raycast(i,n),!0===s)for(var e=t.children,r=0,h=e.length;r<h;r++)it(e[r],i,n,!0)}Object.assign(W.prototype,{set:function(t,i){return this.origin.copy(t),this.direction.copy(i),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,i){return void 0===i&&(console.warn("THREE.Ray: .at() target is now required"),i=new b),i.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,f)),this},closestPointToPoint:function(t,i){void 0===i&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),i=new b),i.subVectors(t,this.origin);t=i.dot(this.direction);return t<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(t).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){var i=f.subVectors(t,this.origin).dot(this.direction);return(i<0?this.origin:(f.copy(this.direction).multiplyScalar(i).add(this.origin),f)).distanceToSquared(t)},distanceSqToSegment:function(t,i,n,s){Q.copy(t).add(i).multiplyScalar(.5),z.copy(i).sub(t).normalize(),c.copy(this.origin).sub(Q);var e,r,h,t=.5*t.distanceTo(i),i=-this.direction.dot(z),o=c.dot(this.direction),u=-c.dot(z),a=c.lengthSq(),f=Math.abs(1-i*i);return f=0<f?(r=i*o-u,h=t*f,0<=(e=i*u-o)?-h<=r?r<=h?(e*=f=1/f)*(e+i*(r*=f)+2*o)+r*(i*e+r+2*u)+a:(r=t,-(e=Math.max(0,-(i*r+o)))*e+r*(r+2*u)+a):(r=-t,-(e=Math.max(0,-(i*r+o)))*e+r*(r+2*u)+a):r<=-h?-(e=Math.max(0,-(-i*t+o)))*e+(r=0<e?-t:Math.min(Math.max(-t,-u),t))*(r+2*u)+a:r<=h?(e=0,(r=Math.min(Math.max(-t,-u),t))*(r+2*u)+a):-(e=Math.max(0,-(i*t+o)))*e+(r=0<e?t:Math.min(Math.max(-t,-u),t))*(r+2*u)+a):(r=0<i?-t:t,-(e=Math.max(0,-(i*r+o)))*e+r*(r+2*u)+a),n&&n.copy(this.direction).multiplyScalar(e).add(this.origin),s&&s.copy(z).multiplyScalar(r).add(Q),f},intersectSphere:function(t,i){f.subVectors(t.center,this.origin);var n=f.dot(this.direction),s=f.dot(f)-n*n,t=t.radius*t.radius;return t<s||(s=n+(t=Math.sqrt(t-s)),(n=n-t)<0&&s<0)?null:n<0?this.at(s,i):this.at(n,i)},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var i=t.normal.dot(this.direction);return 0===i?0===t.distanceToPoint(this.origin)?0:null:0<=(t=-(this.origin.dot(t.normal)+t.constant)/i)?t:null},intersectPlane:function(t,i){t=this.distanceToPlane(t);return null===t?null:this.at(t,i)},intersectsPlane:function(t){var i=t.distanceToPoint(this.origin);return 0===i||t.normal.dot(this.direction)*i<0},intersectBox:function(t,i){var n,s,e,r=1/this.direction.x,h=1/this.direction.y,o=1/this.direction.z,u=this.origin,r=0<=r?(n=(t.min.x-u.x)*r,(t.max.x-u.x)*r):(n=(t.max.x-u.x)*r,(t.min.x-u.x)*r),h=0<=h?(e=(t.min.y-u.y)*h,(t.max.y-u.y)*h):(e=(t.max.y-u.y)*h,(t.min.y-u.y)*h);return h<n||r<e||((n<e||n!=n)&&(n=e),(h<r||r!=r)&&(r=h),(e=0<=o?(s=(t.min.z-u.z)*o,(t.max.z-u.z)*o):(s=(t.max.z-u.z)*o,(t.min.z-u.z)*o))<n)||r<s||((n<s||n!=n)&&(n=s),(r=e<r||r!=r?e:r)<0)?null:this.at(0<=n?n:r,i)},intersectsBox:function(t){return null!==this.intersectBox(t,f)},intersectTriangle:function(t,i,n,s,e){J.subVectors(i,t),K.subVectors(n,t),_.crossVectors(J,K);var r,i=this.direction.dot(_);if(0<i){if(s)return null;r=1}else{if(!(i<0))return null;r=-1,i=-i}c.subVectors(this.origin,t);n=r*this.direction.dot(K.crossVectors(c,K));return n<0||(s=r*this.direction.dot(J.cross(c)))<0||i<n+s||(t=-r*c.dot(_))<0?null:this.at(t/i,e)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}),Object.assign(q.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}}),Object.assign($.prototype,{set:function(t,i){this.ray.set(t,i)},setFromCamera:function(t,i){i&&i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i&&i.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,i,n){n=n||[];return it(t,this,n,i),n.sort(tt),n},intersectObjects:function(t,i,n){var s=n||[];if(!1===Array.isArray(t))console.warn("THREE.Raycaster.intersectObjects: objects is not an Array.");else{for(var e=0,r=t.length;e<r;e++)it(t[e],this,s,i);s.sort(tt)}return s}});var nt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},l={h:0,s:0,l:0},st={h:0,s:0,l:0};function v(t,i,n){return void 0===i&&void 0===n?this.set(t):this.setRGB(t,i,n)}function et(t,i,n){return n<0&&(n+=1),1<n&&--n,n<1/6?t+6*(i-t)*n:n<.5?i:n<2/3?t+6*(i-t)*(2/3-n):t}function rt(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function ht(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}Object.assign(v.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,i,n){return this.r=t,this.g=i,this.b=n,this},setHSL:function(t,i,n){return t=d.euclideanModulo(t,1),i=d.clamp(i,0,1),n=d.clamp(n,0,1),0===i?this.r=this.g=this.b=n:(this.r=et(i=2*n-(n=n<=.5?n*(1+i):n+i-n*i),n,t+1/3),this.g=et(i,n,t),this.b=et(i,n,t-1/3)),this},setStyle:function(i){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+i+" will be ignored.")}if(u=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(i)){var n,s,e,r,h=u[1],o=u[2];switch(h){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return s=parseFloat(n[1])/360,e=parseInt(n[2],10)/100,r=parseInt(n[3],10)/100,t(n[5]),this.setHSL(s,e,r)}}else if(u=/^\#([A-Fa-f0-9]+)$/.exec(i)){var h=u[1],u=h.length;if(3===u)return this.r=parseInt(h.charAt(0)+h.charAt(0),16)/255,this.g=parseInt(h.charAt(1)+h.charAt(1),16)/255,this.b=parseInt(h.charAt(2)+h.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(h.charAt(0)+h.charAt(1),16)/255,this.g=parseInt(h.charAt(2)+h.charAt(3),16)/255,this.b=parseInt(h.charAt(4)+h.charAt(5),16)/255,this}return i&&0<i.length?this.setColorName(i):this},setColorName:function(t){var i=nt[t];return void 0!==i?this.setHex(i):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,i){return void 0===i&&(i=2),this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this},copyLinearToGamma:function(t,i){i=0<(i=void 0===i?2:i)?1/i:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=rt(t.r),this.g=rt(t.g),this.b=rt(t.b),this},copyLinearToSRGB:function(t){return this.r=ht(t.r),this.g=ht(t.g),this.b=ht(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var i,n=this.r,s=this.g,e=this.b,r=Math.max(n,s,e),h=Math.min(n,s,e),o=(h+r)/2;if(h===r)a=i=0;else{var u=r-h,a=o<=.5?u/(r+h):u/(2-r-h);switch(r){case n:i=(s-e)/u+(s<e?6:0);break;case s:i=(e-n)/u+2;break;case e:i=(n-s)/u+4}i/=6}return t.h=i,t.s=a,t.l=o,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,i,n){return this.getHSL(l),l.h+=t,l.s+=i,l.l+=n,this.setHSL(l.h,l.s,l.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this},lerpHSL:function(t,i){this.getHSL(l),t.getHSL(st);var t=d.lerp(l.h,st.h,i),n=d.lerp(l.s,st.s,i),i=d.lerp(l.l,st.l,i);return this.setHSL(t,n,i),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,i){return this.r=t[i=void 0===i?0:i],this.g=t[i+1],this.b=t[i+2],this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}}),v.NAMES=nt;var i=[new b,new b,new b,new b,new b,new b,new b,new b],ot=new b,ut=new g,at=new b,ft=new b,ct=new b,n=new b,p=new b,m=new b,lt=new b,vt=new b,dt=new b,A=new b;function g(t,i){this.min=void 0!==t?t:new b(1/0,1/0,1/0),this.max=void 0!==i?i:new b(-1/0,-1/0,-1/0)}function yt(t,i,n,s,e){for(var r=0,h=t.length-3;r<=h;r+=3){A.fromArray(t,r);var o=e.x*Math.abs(A.x)+e.y*Math.abs(A.y)+e.z*Math.abs(A.z),u=i.dot(A),a=n.dot(A),f=s.dot(A);if(Math.max(-Math.max(u,a,f),Math.min(u,a,f))>o)return!1}return!0}function pt(){}function mt(t,i,n,s){this.x=t||0,this.y=i||0,this.z=n||0,this.w=void 0!==s?s:1}Object.assign(g.prototype,{isBox3:!0,set:function(t,i){return this.min.copy(t),this.max.copy(i),this},setFromArray:function(t){for(var i=1/0,n=1/0,s=1/0,e=-1/0,r=-1/0,h=-1/0,o=0,u=t.length;o<u;o+=3){var a=t[o],f=t[o+1],c=t[o+2];a<i&&(i=a),f<n&&(n=f),c<s&&(s=c),e<a&&(e=a),r<f&&(r=f),h<c&&(h=c)}return this.min.set(i,n,s),this.max.set(e,r,h),this},setFromBufferAttribute:function(t){for(var i=1/0,n=1/0,s=1/0,e=-1/0,r=-1/0,h=-1/0,o=0,u=t.count;o<u;o++){var a=t.getX(o),f=t.getY(o),c=t.getZ(o);a<i&&(i=a),f<n&&(n=f),c<s&&(s=c),e<a&&(e=a),r<f&&(r=f),h<c&&(h=c)}return this.min.set(i,n,s),this.max.set(e,r,h),this},setFromPoints:function(t){this.makeEmpty();for(var i=0,n=t.length;i<n;i++)this.expandByPoint(t[i]);return this},setFromCenterAndSize:function(t,i){i=ot.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new b),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new b),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);for(var i=t.geometry,n=(void 0!==i&&(null===i.boundingBox&&i.computeBoundingBox(),ut.copy(i.boundingBox),ut.applyMatrix4(t.matrixWorld),this.union(ut)),t.children),s=0,e=n.length;s<e;s++)this.expandByObject(n[s]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,i){return void 0===i&&(console.warn("THREE.Box3: .getParameter() target is now required"),i=new b),i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,ot),ot.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){var i,n=0<t.normal.x?(i=t.normal.x*this.min.x,t.normal.x*this.max.x):(i=t.normal.x*this.max.x,t.normal.x*this.min.x);return 0<t.normal.y?(i+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),0<t.normal.z?(i+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),i<=-t.constant&&n>=-t.constant},intersectsTriangle:function(t){return!this.isEmpty()&&(this.getCenter(lt),vt.subVectors(this.max,lt),at.subVectors(t.a,lt),ft.subVectors(t.b,lt),ct.subVectors(t.c,lt),n.subVectors(ft,at),p.subVectors(ct,ft),m.subVectors(at,ct),!!yt([0,-n.z,n.y,0,-p.z,p.y,0,-m.z,m.y,n.z,0,-n.x,p.z,0,-p.x,m.z,0,-m.x,-n.y,n.x,0,-p.y,p.x,0,-m.y,m.x,0],at,ft,ct,vt))&&!!yt([1,0,0,0,1,0,0,0,1],at,ft,ct,vt)&&(dt.crossVectors(n,p),yt([dt.x,dt.y,dt.z],at,ft,ct,vt))},clampPoint:function(t,i){return void 0===i&&(console.warn("THREE.Box3: .clampPoint() target is now required"),i=new b),i.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return ot.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(ot).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()||(i[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),i[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),i[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),i[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),i[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),i[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),i[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),i[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(i)),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(pt.prototype,{addEventListener:function(t,i){void 0===this.R&&(this.R={});var n=this.R;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(i)&&n[t].push(i)},hasEventListener:function(t,i){var n;return void 0!==this.R&&void 0!==(n=this.R)[t]&&-1!==n[t].indexOf(i)},removeEventListener:function(t,i){var n;void 0!==this.R&&void 0!==(t=this.R[t])&&-1!==(n=t.indexOf(i))&&t.splice(n,1)},dispatchEvent:function(t){if(void 0!==this.R){var i=this.R[t.type];if(void 0!==i){t.target=this;for(var n=i.slice(0),s=0,e=n.length;s<e;s++)n[s].call(this,t)}}}}),Object.defineProperties(mt.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(mt.prototype,{isVector4:!0,set:function(t,i,n,s){return this.x=t,this.y=i,this.z=n,this.w=s,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var i=this.x,n=this.y,s=this.z,e=this.w,t=t.elements;return this.x=t[0]*i+t[4]*n+t[8]*s+t[12]*e,this.y=t[1]*i+t[5]*n+t[9]*s+t[13]*e,this.z=t[2]*i+t[6]*n+t[10]*s+t[14]*e,this.w=t[3]*i+t[7]*n+t[11]*s+t[15]*e,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this},setAxisAngleFromRotationMatrix:function(t){var i,n,s,e,r,h,o,u,a,f,t=t.elements,c=t[0],l=t[4],v=t[8],d=t[1],y=t[5],p=t[9],m=t[2],A=t[6],t=t[10];return Math.abs(l-d)<.01&&Math.abs(v-m)<.01&&Math.abs(p-A)<.01?Math.abs(l+d)<.1&&Math.abs(v+m)<.1&&Math.abs(p+A)<.1&&Math.abs(c+y+t-3)<.1?this.set(1,0,0,0):(e=Math.PI,h=(t+1)/2,o=(l+d)/4,u=(v+m)/4,a=(p+A)/4,(r=(y+1)/2)<(f=(c+1)/2)&&h<f?s=f<.01?(i=0,n=.707106781):(n=o/(i=Math.sqrt(f)),u/i):h<r?s=r<.01?(n=0,i=.707106781):(i=o/(n=Math.sqrt(r)),a/n):h<.01?(n=i=.707106781,s=0):(i=u/(s=Math.sqrt(h)),n=a/s),this.set(i,n,s,e)):(f=Math.sqrt((A-p)*(A-p)+(v-m)*(v-m)+(d-l)*(d-l)),Math.abs(f)<.001&&(f=1),this.x=(A-p)/f,this.y=(v-m)/f,this.z=(d-l)/f,this.w=Math.acos((c+y+t-1)/2)),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this},clampScalar:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this.w=Math.max(t,Math.min(i,this.w)),this},clampLength:function(t,i){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(i,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this},lerpVectors:function(t,i,n){return this.subVectors(i,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,i){return this.x=t[i=void 0===i?0:i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t},fromBufferAttribute:function(t,i,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}});var M=new b;function w(t,i,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=i,this.count=void 0!==t?t.length/i:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function At(t,i,n){w.call(this,new Int8Array(t),i,n)}function gt(t,i,n){w.call(this,new Uint8Array(t),i,n)}function bt(t,i,n){w.call(this,new Uint8ClampedArray(t),i,n)}function Mt(t,i,n){w.call(this,new Int16Array(t),i,n)}function wt(t,i,n){w.call(this,new Uint16Array(t),i,n)}function Et(t,i,n){w.call(this,new Int32Array(t),i,n)}function St(t,i,n){w.call(this,new Uint32Array(t),i,n)}function S(t,i,n){w.call(this,new Float32Array(t),i,n)}function xt(t,i,n){w.call(this,new Float64Array(t),i,n)}Object.defineProperty(w.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(w.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,i,n){t*=this.itemSize,n*=i.itemSize;for(var s=0,e=this.itemSize;s<e;s++)this.array[t+s]=i.array[n+s];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var i=this.array,n=0,s=0,e=t.length;s<e;s++){var r=t[s];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",s),r=new v),i[n++]=r.r,i[n++]=r.g,i[n++]=r.b}return this},copyVector2sArray:function(t){for(var i=this.array,n=0,s=0,e=t.length;s<e;s++){var r=t[s];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",s),r=new E),i[n++]=r.x,i[n++]=r.y}return this},copyVector3sArray:function(t){for(var i=this.array,n=0,s=0,e=t.length;s<e;s++){var r=t[s];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",s),r=new b),i[n++]=r.x,i[n++]=r.y,i[n++]=r.z}return this},copyVector4sArray:function(t){for(var i=this.array,n=0,s=0,e=t.length;s<e;s++){var r=t[s];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",s),r=new mt),i[n++]=r.x,i[n++]=r.y,i[n++]=r.z,i[n++]=r.w}return this},applyMatrix3:function(t){for(var i=0,n=this.count;i<n;i++)M.x=this.getX(i),M.y=this.getY(i),M.z=this.getZ(i),M.applyMatrix3(t),this.setXYZ(i,M.x,M.y,M.z);return this},applyMatrix4:function(t){for(var i=0,n=this.count;i<n;i++)M.x=this.getX(i),M.y=this.getY(i),M.z=this.getZ(i),M.applyMatrix4(t),this.setXYZ(i,M.x,M.y,M.z);return this},applyNormalMatrix:function(t){for(var i=0,n=this.count;i<n;i++)M.x=this.getX(i),M.y=this.getY(i),M.z=this.getZ(i),M.applyNormalMatrix(t),this.setXYZ(i,M.x,M.y,M.z);return this},transformDirection:function(t){for(var i=0,n=this.count;i<n;i++)M.x=this.getX(i),M.y=this.getY(i),M.z=this.getZ(i),M.transformDirection(t),this.setXYZ(i,M.x,M.y,M.z);return this},set:function(t,i){return this.array.set(t,i=void 0===i?0:i),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,i){return this.array[t*this.itemSize]=i,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,i){return this.array[t*this.itemSize+1]=i,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,i){return this.array[t*this.itemSize+2]=i,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,i){return this.array[t*this.itemSize+3]=i,this},setXY:function(t,i,n){return t*=this.itemSize,this.array[t+0]=i,this.array[t+1]=n,this},setXYZ:function(t,i,n,s){return t*=this.itemSize,this.array[t+0]=i,this.array[t+1]=n,this.array[t+2]=s,this},setXYZW:function(t,i,n,s,e){return t*=this.itemSize,this.array[t+0]=i,this.array[t+1]=n,this.array[t+2]=s,this.array[t+3]=e,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(At.prototype=Object.create(w.prototype)).constructor=At,(gt.prototype=Object.create(w.prototype)).constructor=gt,(bt.prototype=Object.create(w.prototype)).constructor=bt,(Mt.prototype=Object.create(w.prototype)).constructor=Mt,wt.prototype=Object.create(w.prototype),wt.prototype.constructor=wt,(Et.prototype=Object.create(w.prototype)).constructor=Et,St.prototype=Object.create(w.prototype),St.prototype.constructor=St,(S.prototype=Object.create(w.prototype)).constructor=S,(xt.prototype=Object.create(w.prototype)).constructor=xt;var Rt=new g;function jt(t,i){this.center=void 0!==t?t:new b,this.radius=void 0!==i?i:0}function Ot(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}Object.assign(jt.prototype,{set:function(t,i){return this.center.copy(t),this.radius=i,this},setFromPoints:function(t,i){for(var n=this.center,s=(void 0!==i?n.copy(i):Rt.setFromPoints(t).getCenter(n),0),e=0,r=t.length;e<r;e++)s=Math.max(s,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(s),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,i){var n=this.center.distanceToSquared(t);return void 0===i&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),i=new b),i.copy(t),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new g),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.assign(Ot.prototype,{computeGroups:function(t){for(var i,n=[],s=void 0,e=t.faces,r=0;r<e.length;r++){var h=e[r];h.materialIndex!==s&&(s=h.materialIndex,void 0!==i&&(i.count=3*r-i.start,n.push(i)),i={start:3*r,materialIndex:s})}void 0!==i&&(i.count=3*r-i.start,n.push(i)),this.groups=n},fromGeometry:function(t){var i=t.faces,n=t.vertices,s=t.faceVertexUvs,e=s[0]&&0<s[0].length,r=s[1]&&0<s[1].length,h=t.morphTargets,o=h.length;if(0<o){for(var u=[],a=0;a<o;a++)u[a]={name:h[a].name,data:[]};this.morphTargets.position=u}var f=t.morphNormals,c=f.length;if(0<c){for(var l=[],a=0;a<c;a++)l[a]={name:f[a].name,data:[]};this.morphTargets.normal=l}var v=t.skinIndices,d=t.skinWeights,y=v.length===n.length,p=d.length===n.length;0<n.length&&0===i.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(a=0;a<i.length;a++){var m,A=i[a],g=(this.vertices.push(n[A.a],n[A.b],n[A.c]),A.vertexNormals),g=(3===g.length?this.normals.push(g[0],g[1],g[2]):(g=A.normal,this.normals.push(g,g,g)),A.vertexColors);3===g.length?this.colors.push(g[0],g[1],g[2]):(g=A.color,this.colors.push(g,g,g)),!0===e&&(void 0!==(m=s[0][a])?this.uvs.push(m[0],m[1],m[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",a),this.uvs.push(new E,new E,new E))),!0===r&&(void 0!==(m=s[1][a])?this.uvs2.push(m[0],m[1],m[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",a),this.uvs2.push(new E,new E,new E)));for(var b=0;b<o;b++){var M=h[b].vertices;u[b].data.push(M[A.a],M[A.b],M[A.c])}for(b=0;b<c;b++){var w=f[b].vertexNormals[a];l[b].data.push(w.a,w.b,w.c)}y&&this.skinIndices.push(v[A.a],v[A.b],v[A.c]),p&&this.skinWeights.push(d[A.a],d[A.b],d[A.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});var It=new y,kt=new r;function Tt(t,i,n,s){this.u=t||0,this.v=i||0,this.A=n||0,this.j=s||Tt.DefaultOrder}function Bt(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Tt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Tt.DefaultOrder="XYZ",Object.defineProperties(Tt.prototype,{x:{get:function(){return this.u},set:function(t){this.u=t,this.S()}},y:{get:function(){return this.v},set:function(t){this.v=t,this.S()}},z:{get:function(){return this.A},set:function(t){this.A=t,this.S()}},order:{get:function(){return this.j},set:function(t){this.j=t,this.S()}}}),Object.assign(Tt.prototype,{isEuler:!0,set:function(t,i,n,s){return this.u=t,this.v=i,this.A=n,this.j=s||this.j,this.S(),this},clone:function(){return new this.constructor(this.u,this.v,this.A,this.j)},copy:function(t){return this.u=t.u,this.v=t.v,this.A=t.A,this.j=t.j,this.S(),this},setFromRotationMatrix:function(t,i,n){var s=d.clamp,t=t.elements,e=t[0],r=t[4],h=t[8],o=t[1],u=t[5],a=t[9],f=t[2],c=t[6],t=t[10];return"XYZ"===(i=i||this.j)?(this.v=Math.asin(s(h,-1,1)),Math.abs(h)<.9999999?(this.u=Math.atan2(-a,t),this.A=Math.atan2(-r,e)):(this.u=Math.atan2(c,u),this.A=0)):"YXZ"===i?(this.u=Math.asin(-s(a,-1,1)),Math.abs(a)<.9999999?(this.v=Math.atan2(h,t),this.A=Math.atan2(o,u)):(this.v=Math.atan2(-f,e),this.A=0)):"ZXY"===i?(this.u=Math.asin(s(c,-1,1)),Math.abs(c)<.9999999?(this.v=Math.atan2(-f,t),this.A=Math.atan2(-r,u)):(this.v=0,this.A=Math.atan2(o,e))):"ZYX"===i?(this.v=Math.asin(-s(f,-1,1)),Math.abs(f)<.9999999?(this.u=Math.atan2(c,t),this.A=Math.atan2(o,e)):(this.u=0,this.A=Math.atan2(-r,u))):"YZX"===i?(this.A=Math.asin(s(o,-1,1)),Math.abs(o)<.9999999?(this.u=Math.atan2(-a,u),this.v=Math.atan2(-f,e)):(this.u=0,this.v=Math.atan2(h,t))):"XZY"===i?(this.A=Math.asin(-s(r,-1,1)),Math.abs(r)<.9999999?(this.u=Math.atan2(c,u),this.v=Math.atan2(h,e)):(this.u=Math.atan2(-a,t),this.v=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+i),this.j=i,!1!==n&&this.S(),this},setFromQuaternion:function(t,i,n){return It.makeRotationFromQuaternion(t),this.setFromRotationMatrix(It,i,n)},setFromVector3:function(t,i){return this.set(t.x,t.y,t.z,i||this.j)},reorder:function(t){return kt.setFromEuler(this),this.setFromQuaternion(kt,t)},equals:function(t){return t.u===this.u&&t.v===this.v&&t.A===this.A&&t.j===this.j},fromArray:function(t){return this.u=t[0],this.v=t[1],this.A=t[2],void 0!==t[3]&&(this.j=t[3]),this.S(),this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.u,t[i+1]=this.v,t[i+2]=this.A,t[i+3]=this.j,t},toVector3:function(t){return t?t.set(this.u,this.v,this.A):new b(this.u,this.v,this.A)},onChange:function(t){return this.S=t,this},S:function(){}}),Object.assign(Bt.prototype,{isMatrix3:!0,set:function(t,i,n,s,e,r,h,o,u){var a=this.elements;return a[0]=t,a[1]=s,a[2]=h,a[3]=i,a[4]=e,a[5]=o,a[6]=n,a[7]=r,a[8]=u,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var i=this.elements,t=t.elements;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],this},extractBasis:function(t,i,n){return t.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){t=t.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,i){var t=t.elements,i=i.elements,n=this.elements,s=t[0],e=t[3],r=t[6],h=t[1],o=t[4],u=t[7],a=t[2],f=t[5],t=t[8],c=i[0],l=i[3],v=i[6],d=i[1],y=i[4],p=i[7],m=i[2],A=i[5],i=i[8];return n[0]=s*c+e*d+r*m,n[3]=s*l+e*y+r*A,n[6]=s*v+e*p+r*i,n[1]=h*c+o*d+u*m,n[4]=h*l+o*y+u*A,n[7]=h*v+o*p+u*i,n[2]=a*c+f*d+t*m,n[5]=a*l+f*y+t*A,n[8]=a*v+f*p+t*i,this},multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this},determinant:function(){var t=this.elements,i=t[0],n=t[1],s=t[2],e=t[3],r=t[4],h=t[5],o=t[6],u=t[7],t=t[8];return i*r*t-i*h*u-n*e*t+n*h*o+s*e*u-s*r*o},getInverse:function(t,i){void 0!==i&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var i=t.elements,t=this.elements,n=i[0],s=i[1],e=i[2],r=i[3],h=i[4],o=i[5],u=i[6],a=i[7],i=i[8],f=i*h-o*a,c=o*u-i*r,l=a*r-h*u,v=n*f+s*c+e*l;return 0==v?this.set(0,0,0,0,0,0,0,0,0):(t[0]=f*(f=1/v),t[1]=(e*a-i*s)*f,t[2]=(o*s-e*h)*f,t[3]=c*f,t[4]=(i*n-e*u)*f,t[5]=(e*r-o*n)*f,t[6]=l*f,t[7]=(s*u-a*n)*f,t[8]=(h*n-s*r)*f,this)},transpose:function(){var t=this.elements,i=t[1];return t[1]=t[3],t[3]=i,i=t[2],t[2]=t[6],t[6]=i,i=t[5],t[5]=t[7],t[7]=i,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this},setUvTransform:function(t,i,n,s,e,r,h){var o=Math.cos(e),e=Math.sin(e);this.set(n*o,n*e,-n*(o*r+e*h)+r+t,-s*e,s*o,-s*(-e*r+o*h)+h+i,0,0,1)},scale:function(t,i){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=i,n[4]*=i,n[7]*=i,this},rotate:function(t){var i=Math.cos(t),t=Math.sin(t),n=this.elements,s=n[0],e=n[3],r=n[6],h=n[1],o=n[4],u=n[7];return n[0]=i*s+t*h,n[3]=i*e+t*o,n[6]=i*r+t*u,n[1]=-t*s+i*h,n[4]=-t*e+i*o,n[7]=-t*r+i*u,this},translate:function(t,i){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=i*n[2],n[4]+=i*n[5],n[7]+=i*n[8],this},equals:function(t){for(var i=this.elements,n=t.elements,s=0;s<9;s++)if(i[s]!==n[s])return!1;return!0},fromArray:function(t,i){void 0===i&&(i=0);for(var n=0;n<9;n++)this.elements[n]=t[n+i];return this},toArray:function(t,i){var n=this.elements;return(t=void 0===t?[]:t)[i=void 0===i?0:i]=n[0],t[i+1]=n[1],t[i+2]=n[2],t[i+3]=n[3],t[i+4]=n[4],t[i+5]=n[5],t[i+6]=n[6],t[i+7]=n[7],t[i+8]=n[8],t}});var Ct=0,Pt=new b,Lt=new r,x=new y,Ft=new b,Dt=new b,Vt=new b,Nt=new r,Ut=new b(1,0,0),Yt=new b(0,1,0),Ht=new b(0,0,1),Gt={type:"added"},Zt={type:"removed"};function R(){Object.defineProperty(this,"id",{value:Ct++}),this.uuid=d.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=R.DefaultUp.clone();var t=new b,i=new Tt,n=new r,s=new b(1,1,1);i.onChange(function(){n.setFromEuler(i,!1)}),n.onChange(function(){i.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new y},normalMatrix:{value:new Bt}}),this.matrix=new y,this.matrixWorld=new y,this.matrixAutoUpdate=R.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new q,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}R.DefaultUp=new b(0,1,0),R.DefaultMatrixAutoUpdate=!0,R.prototype=Object.assign(Object.create(pt.prototype),{constructor:R,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,i){this.quaternion.setFromAxisAngle(t,i)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,i){return Lt.setFromAxisAngle(t,i),this.quaternion.multiply(Lt),this},rotateOnWorldAxis:function(t,i){return Lt.setFromAxisAngle(t,i),this.quaternion.premultiply(Lt),this},rotateX:function(t){return this.rotateOnAxis(Ut,t)},rotateY:function(t){return this.rotateOnAxis(Yt,t)},rotateZ:function(t){return this.rotateOnAxis(Ht,t)},translateOnAxis:function(t,i){return Pt.copy(t).applyQuaternion(this.quaternion),this.position.add(Pt.multiplyScalar(i)),this},translateX:function(t){return this.translateOnAxis(Ut,t)},translateY:function(t){return this.translateOnAxis(Yt,t)},translateZ:function(t){return this.translateOnAxis(Ht,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(x.getInverse(this.matrixWorld))},lookAt:function(t,i,n){t.isVector3?Ft.copy(t):Ft.set(t,i,n);t=this.parent;this.updateWorldMatrix(!0,!1),Dt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?x.lookAt(Dt,Ft,this.up):x.lookAt(Ft,Dt,this.up),this.quaternion.setFromRotationMatrix(x),t&&(x.extractRotation(t.matrixWorld),Lt.setFromRotationMatrix(x),this.quaternion.premultiply(Lt.inverse()))},add:function(t){if(1<arguments.length)for(var i=0;i<arguments.length;i++)this.add(arguments[i]);else t===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",t):t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),(t.parent=this).children.push(t),t.dispatchEvent(Gt)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t);return this},remove:function(t){if(1<arguments.length)for(var i=0;i<arguments.length;i++)this.remove(arguments[i]);else{var n=this.children.indexOf(t);-1!==n&&(t.parent=null,this.children.splice(n,1),t.dispatchEvent(Zt))}return this},attach:function(t){return this.updateWorldMatrix(!0,!1),x.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),x.multiply(t.parent.matrixWorld)),t.applyMatrix4(x),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,i){if(this[t]===i)return this;for(var n=0,s=this.children.length;n<s;n++){var e=this.children[n].getObjectByProperty(t,i);if(void 0!==e)return e}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new b),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new r),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Dt,t,Vt),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new b),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Dt,Nt,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new b),this.updateMatrixWorld(!0);var i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var i=this.children,n=0,s=i.length;n<s;n++)i[n].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var i=this.children,n=0,s=i.length;n<s;n++)i[n].traverseVisible(t)}},traverseAncestors:function(t){var i=this.parent;null!==i&&(t(i),i.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t=!(this.matrixWorldNeedsUpdate=!1));for(var i=this.children,n=0,s=i.length;n<s;n++)i[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,i){var n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===i)for(var s=this.children,e=0,r=s.length;e<r;e++)s[e].updateWorldMatrix(!1,!0)},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,i){if(void 0===i&&(i=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===i)for(var n=0;n<t.children.length;n++){var s=t.children[n];this.add(s.clone())}return this}});var Xt=1,j=new y,Qt=new R,zt=new b,O=new g,Jt=new g,I=new b;function Kt(){Object.defineProperty(this,"id",{value:Xt+=2}),this.uuid=d.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Kt.prototype=Object.assign(Object.create(pt.prototype),{constructor:Kt,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(65535<function(t){if(0===t.length)return-1/0;for(var i=t[0],n=1,s=t.length;n<s;++n)t[n]>i&&(i=t[n]);return i}(t)?St:wt)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,i){return this.attributes[t]=i,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,i,n){this.groups.push({start:t,count:i,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,i){this.drawRange.start=t,this.drawRange.count=i},applyMatrix4:function(t){var i=this.attributes.position,i=(void 0!==i&&(i.applyMatrix4(t),i.needsUpdate=!0),this.attributes.normal),n=(void 0!==i&&(n=(new Bt).getNormalMatrix(t),i.applyNormalMatrix(n),i.needsUpdate=!0),this.attributes.tangent);return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return j.makeRotationX(t),this.applyMatrix4(j),this},rotateY:function(t){return j.makeRotationY(t),this.applyMatrix4(j),this},rotateZ:function(t){return j.makeRotationZ(t),this.applyMatrix4(j),this},translate:function(t,i,n){return j.makeTranslation(t,i,n),this.applyMatrix4(j),this},scale:function(t,i,n){return j.makeScale(t,i,n),this.applyMatrix4(j),this},lookAt:function(t){return Qt.lookAt(t),Qt.updateMatrix(),this.applyMatrix4(Qt.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(zt).negate(),this.translate(zt.x,zt.y,zt.z),this},setFromObject:function(t){var i,n,s=t.geometry;return t.isPoints||t.isLine?(n=new S(3*s.vertices.length,3),i=new S(3*s.colors.length,3),this.setAttribute("position",n.copyVector3sArray(s.vertices)),this.setAttribute("color",i.copyColorsArray(s.colors)),s.lineDistances&&s.lineDistances.length===s.vertices.length&&(n=new S(s.lineDistances.length,1),this.setAttribute("lineDistance",n.copyArray(s.lineDistances))),null!==s.boundingSphere&&(this.boundingSphere=s.boundingSphere.clone()),null!==s.boundingBox&&(this.boundingBox=s.boundingBox.clone())):t.isMesh&&s&&s.isGeometry&&this.fromGeometry(s),this},setFromPoints:function(t){for(var i=[],n=0,s=t.length;n<s;n++){var e=t[n];i.push(e.x,e.y,e.z||0)}return this.setAttribute("position",new S(i,3)),this},updateFromObject:function(t){var i,n=t.geometry;if(t.isMesh){var s=n.O;if(!0===n.elementsNeedUpdate&&(s=void 0,n.elementsNeedUpdate=!1),void 0===s)return this.fromGeometry(n);s.verticesNeedUpdate=n.verticesNeedUpdate,s.normalsNeedUpdate=n.normalsNeedUpdate,s.colorsNeedUpdate=n.colorsNeedUpdate,s.uvsNeedUpdate=n.uvsNeedUpdate,s.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=s}return!0===n.verticesNeedUpdate&&(void 0!==(i=this.attributes.position)&&(i.copyVector3sArray(n.vertices),i.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(i=this.attributes.normal)&&(i.copyVector3sArray(n.normals),i.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(i=this.attributes.color)&&(i.copyColorsArray(n.colors),i.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(i=this.attributes.uv)&&(i.copyVector2sArray(n.uvs),i.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(i=this.attributes.lineDistance)&&(i.copyArray(n.lineDistances),i.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(t.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.O=(new Ot).fromGeometry(t),this.fromDirectGeometry(t.O)},fromDirectGeometry:function(t){var i,n=new Float32Array(3*t.vertices.length);for(i in this.setAttribute("position",new w(n,3).copyVector3sArray(t.vertices)),0<t.normals.length&&(n=new Float32Array(3*t.normals.length),this.setAttribute("normal",new w(n,3).copyVector3sArray(t.normals))),0<t.colors.length&&(n=new Float32Array(3*t.colors.length),this.setAttribute("color",new w(n,3).copyColorsArray(t.colors))),0<t.uvs.length&&(n=new Float32Array(2*t.uvs.length),this.setAttribute("uv",new w(n,2).copyVector2sArray(t.uvs))),0<t.uvs2.length&&(n=new Float32Array(2*t.uvs2.length),this.setAttribute("uv2",new w(n,2).copyVector2sArray(t.uvs2))),this.groups=t.groups,t.morphTargets){for(var s=[],e=t.morphTargets[i],r=0,h=e.length;r<h;r++){var o=e[r],u=new S(3*o.data.length,3);u.name=o.name,s.push(u.copyVector3sArray(o.data))}this.morphAttributes[i]=s}return 0<t.skinIndices.length&&(n=new S(4*t.skinIndices.length,4),this.setAttribute("skinIndex",n.copyVector4sArray(t.skinIndices))),0<t.skinWeights.length&&(n=new S(4*t.skinWeights.length,4),this.setAttribute("skinWeight",n.copyVector4sArray(t.skinWeights))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new g);var t=this.attributes.position,i=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),i)for(var n=0,s=i.length;n<s;n++){var e=i[n];O.setFromBufferAttribute(e),this.morphTargetsRelative?(I.addVectors(this.boundingBox.min,O.min),this.boundingBox.expandByPoint(I),I.addVectors(this.boundingBox.max,O.max),this.boundingBox.expandByPoint(I)):(this.boundingBox.expandByPoint(O.min),this.boundingBox.expandByPoint(O.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new jt);var t=this.attributes.position,i=this.morphAttributes.position;if(t){var n=this.boundingSphere.center;if(O.setFromBufferAttribute(t),i)for(var s=0,e=i.length;s<e;s++){var r=i[s];Jt.setFromBufferAttribute(r),this.morphTargetsRelative?(I.addVectors(O.min,Jt.min),O.expandByPoint(I),I.addVectors(O.max,Jt.max),O.expandByPoint(I)):(O.expandByPoint(Jt.min),O.expandByPoint(Jt.max))}O.getCenter(n);for(var h=0,s=0,e=t.count;s<e;s++)I.fromBufferAttribute(t,s),h=Math.max(h,n.distanceToSquared(I));if(i)for(s=0,e=i.length;s<e;s++)for(var r=i[s],o=this.morphTargetsRelative,u=0,a=r.count;u<a;u++)I.fromBufferAttribute(r,u),o&&(zt.fromBufferAttribute(t,u),I.add(zt)),h=Math.max(h,n.distanceToSquared(I));this.boundingSphere.radius=Math.sqrt(h),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,i=this.attributes;if(i.position){var n=i.position.array;if(void 0===i.normal)this.setAttribute("normal",new w(new Float32Array(n.length),3));else for(var s=i.normal.array,e=0,r=s.length;e<r;e++)s[e]=0;var h,o,u,a=i.normal.array,f=new b,c=new b,l=new b,v=new b,d=new b;if(t)for(var y=t.array,e=0,r=t.count;e<r;e+=3)h=3*y[e+0],o=3*y[e+1],u=3*y[e+2],f.fromArray(n,h),c.fromArray(n,o),l.fromArray(n,u),v.subVectors(l,c),d.subVectors(f,c),v.cross(d),a[h]+=v.x,a[1+h]+=v.y,a[2+h]+=v.z,a[o]+=v.x,a[1+o]+=v.y,a[2+o]+=v.z,a[u]+=v.x,a[1+u]+=v.y,a[2+u]+=v.z;else for(e=0,r=n.length;e<r;e+=9)f.fromArray(n,e),c.fromArray(n,e+3),l.fromArray(n,e+6),v.subVectors(l,c),d.subVectors(f,c),v.cross(d),a[e]=v.x,a[e+1]=v.y,a[e+2]=v.z,a[e+3]=v.x,a[e+4]=v.y,a[e+5]=v.z,a[e+6]=v.x,a[e+7]=v.y,a[e+8]=v.z;this.normalizeNormals(),i.normal.needsUpdate=!0}},normalizeNormals:function(){for(var t=this.attributes.normal,i=0,n=t.count;i<n;i++)I.x=t.getX(i),I.y=t.getY(i),I.z=t.getZ(i),I.normalize(),t.setXYZ(i,I.x,I.y,I.z)},dispose:function(){this.dispatchEvent({type:"dispose"})}});var _t=.001,Wt=0;function qt(){Object.defineProperty(this,"id",{value:Wt++}),this.uuid=d.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=_t,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function k(t){qt.call(this),this.type="LineBasicMaterial",this.color=new v(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}qt.prototype=Object.assign(Object.create(pt.prototype),{constructor:qt,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var i in t){var n,s=t[i];void 0===s?console.warn("THREE.Material: '"+i+"' parameter is undefined."):"shading"===i?(console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===s):void 0===(n=this[i])?console.warn("THREE."+this.type+": '"+i+"' is not a property of this material."):n&&n.isColor?n.set(s):n&&n.isVector3&&s&&s.isVector3?n.copy(s):this[i]=s}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var i=t.clippingPlanes,n=null;if(null!==i)for(var s=i.length,n=new Array(s),e=0;e!==s;++e)n[e]=i[e].clone();return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(qt.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),((k.prototype=Object.create(qt.prototype)).constructor=k).prototype.isLineBasicMaterial=!0,k.prototype.copy=function(t){return qt.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this};var $t=new b,ti=new b,ii=new y,ni=new W,si=new jt;function ei(t,i,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),R.call(this),this.type="Line",this.geometry=void 0!==t?t:new Kt,this.material=void 0!==i?i:new k}function ri(t){return(ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function hi(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,i){if("object"!=ri(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!=ri(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==ri(t)?t:String(t)}(s.key),s)}}function oi(t,i,n){return i&&hi(t.prototype,i),n&&hi(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}ei.prototype=Object.assign(Object.create(R.prototype),{constructor:ei,isLine:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var i=t.attributes.position,n=[0],s=1,e=i.count;s<e;s++)$t.fromBufferAttribute(i,s-1),ti.fromBufferAttribute(i,s),n[s]=n[s-1],n[s]+=$t.distanceTo(ti);t.setAttribute("lineDistance",new S(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var r=t.vertices;(n=t.lineDistances)[0]=0;for(s=1,e=r.length;s<e;s++)n[s]=n[s-1],n[s]+=r[s-1].distanceTo(r[s])}return this},raycast:function(t,i){var n=this.geometry,s=this.matrixWorld,e=t.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),si.copy(n.boundingSphere),si.applyMatrix4(s),si.radius+=e,!1!==t.ray.intersectsSphere(si)){ii.getInverse(s),ni.copy(t.ray).applyMatrix4(ii);var s=e/((this.scale.x+this.scale.y+this.scale.z)/3),r=s*s,h=new b,o=new b,u=new b,a=new b,f=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){var e=n.index,c=n.attributes.position.array;if(null!==e)for(var l=e.array,v=0,d=l.length-1;v<d;v+=f){var y=l[v],p=l[v+1];h.fromArray(c,3*y),o.fromArray(c,3*p),r<ni.distanceSqToSegment(h,o,a,u)||(a.applyMatrix4(this.matrixWorld),(m=t.ray.origin.distanceTo(a))<t.near)||m>t.far||i.push({distance:m,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}else for(v=0,d=c.length/3-1;v<d;v+=f)h.fromArray(c,3*v),o.fromArray(c,3*v+3),r<ni.distanceSqToSegment(h,o,a,u)||(a.applyMatrix4(this.matrixWorld),(m=t.ray.origin.distanceTo(a))<t.near)||m>t.far||i.push({distance:m,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}else if(n.isGeometry)for(var m,A=n.vertices,g=A.length,v=0;v<g-1;v+=f)r<ni.distanceSqToSegment(A[v],A[v+1],a,u)||(a.applyMatrix4(this.matrixWorld),(m=t.ray.origin.distanceTo(a))<t.near)||m>t.far||i.push({distance:m,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var t=oi(function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.R={}}),ui=(Object.assign(t.prototype,{I:function(t,i){this.k(t,i)||(void 0===this.R[t]&&(this.R[t]=[]),this.R[t].push(i))},k:function(t,i){return i?void 0!==this.R[t]&&-1!==this.R[t].indexOf(i):void 0!==this.R[t]&&0<this.R[t].length},T:function(t,i){void 0!==this.R[t]&&-1!==(i=this.R[t].indexOf(i))&&this.R[t].splice(i,1)},B:function(t){if(void 0!==this.R[t.type])for(var i=this.R[t.type].slice(0),n=0,s=i.length;n<s;n++)i[n].call(this,t)}}),t);function ai(t,i){return function(t){if(Array.isArray(t))return t}(t)||function(t,i){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var s,e,r,h,o=[],u=!0,a=!1;try{if(r=(n=n.call(t)).next,0===i){if(Object(n)!==n)return;u=!1}else for(;!(u=(s=r.call(n)).done)&&(o.push(s.value),o.length!==i);u=!0);}catch(t){a=!0,e=t}finally{try{if(!u&&null!=n.return&&(h=n.return(),Object(h)!==h))return}finally{if(a)throw e}}return o}}(t,i)||fi(t,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fi(t,i){var n;if(t)return"string"==typeof t?ci(t,i):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ci(t,i):void 0}function ci(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,s=new Array(i);n<i;n++)s[n]=t[n];return s}function li(i,t){var n,s=Object.keys(i);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(i),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})),s.push.apply(s,n)),s}function vi(s){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?li(Object(e),!0).forEach(function(t){var i,n;i=s,n=e[t=t],(t=pi(t))in i?Object.defineProperty(i,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):i[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(e)):li(Object(e)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(e,t))})}return s}function di(t){return(di="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yi(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,pi(s.key),s)}}function pi(t){t=function(t,i){if("object"!=di(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!=di(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==di(t)?t:String(t)}t=function(){function i(t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.C=t,this.P="none",this.currentobj=null,this.L={url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH5QoOAiAd1TTTFgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAABfElEQVRYw81XO26EMBB9poAIrBwh2hPgMt1WS7cSN+AonAXtIahSpfLWVNtFewXLkG7SeCVIbH5rBZ40jYGZ8fjxPMOwDAcARwAnAO8A3sz6HcAVwAeATwBf8IgIQAGgA0AzrTPfRM8GPy8I6rLz2l1fPAR/2GVJNV4B3DwGf9jN+J7cuTM4Y4yEEFSWJUkpSWtNWmuSUlJZliSEIMbYVBKjlXCWPcsyUkrRFJRSlGXZ1HHMJ1wYhlRVFS1FVVUUhuFsYkau4FJKWgsp5VgSg6MobC+t2bmtEo4Ein4Cne3MfcHBia4vr3/YPodwc6GUcv0dh8Bo+wBpmoJz7k3LOedI09T26BiYi2WAPM/hGw6fJ9iE5xnmj/0RNmFihgwv/bS01ojj2GsF2rZFkiS/l78DbIzANBMDNE3jPZDD5z0wncwAdV17T8Dh82pVQSGEdxIKIZxquKkQ7UKKd3EZbX4db96Q7KIl20VTunlbvovBZBej2b8Np2zr8fwHFGE/6k/Mu0oAAAAASUVORK5CYII=",size:32,height:1,collision:!1},this.F={width:5,type:X.FULL,color:"#FF0000",height:3},this.D={color:"#FF0000",borderWidth:3,borderColor:"#0000FF",opacity:.5,height:3},this.V="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH5QocCDgHXcqo9wAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAEQ0lEQVRYw71XTWhcVRg9584kVGzHZKYlTFpsJ/PeKBaKMjN05aYIKgguupASqaKCC1cFVxaSaQW7dSW4KRFBEETEje5qtWK1SdP409L0zZgpJrEtvqY/qebNe/e46KSZDMkkmSR9mwdz35zv3O8737nfJdbxuG7xdQp7EfCj8au//NkORqzd4Lls8S0SgzR8UTHbm0qlr/r+9ORDIZDLFt6B4SDJXQBAci/AbHeyd8L3p6qbSsB1C++SLJHc0fg7yQyFbFd37z83b05d3hQCrls8SrBEcutS6yR3k8wnU713fH9qbEMJuG7hPYIDAAyAGsl447qk6wDmACQIPJVMpWd8f/r3lXDjqwne07PvUQmXBfUbKQS5U8AAyZ568LNW0RGJAalOyRgTRbN1srYVNtsR4Z49hSc6O3iKZBoArPTjzMzsCzduXLy7VizTDgGSAqCGXdDaqK3NmI0S6PYVSrgmAq6bP+S6+cKyzGI2WlxbsRWDbds6D7hu/vCqCOScwquAGaSNpZcDrNXCCEDYWJQoeowtSpYizIDrFl9rScBxiv0gBwn2yWhZwI4OGy4ioNZilhAA2G2AweZMxBvs9RVQA6RxJNQAPJ3LFW8jVCeoTruo77mjqYUTgD3oOIXbS6dZ++9LlRnKDDhOMfS8c589aEPHKRw0xDHS7G0wlrsADSBTz5RpSmuzEYUrdE584Vt7EVZHx8sjXzGXzb8sY44bch8e4mOlc5I9akA+u1xwafG7YWXdBAxZNOBLcYvwpLEdvTQ8tCiE1Q8wGJMQSYoEhhRrov6jkAD1Jsnk/Dkg4AsCNUgEDAFRBAGQQo6GzzWV7DsLfFnXQD5rYAZoeHh+h7I6Mu4Nf7gU+76+/ONxY07RsK9O9ufQ2ucrlZFbS33vOMV+Q3xCMvYguFTyvOHTBgA8b6Q8VwsGZe3QfHrZIs9RZAIRwarTfb+rVK/9mcja4543fHqRD1SrYxNBGJUEDa0IaMyaRGCpCKBk7RgjfVAuj5xa0ogmJkarsVhUkrVDUYtTlPxXBKM1HF5WUhnCifHK8DctrfjSpdFqENpSLDTfLgcYBGEIaG61BKRoGrTHx8vDn69qIJmYGG05WG7ZsjUEtGoNeN75cwDOtj0RAUAms79nYUfBNjIeNQnzkXQ6XwMAa2sEgGvXfp2dX17XROQ4ToLsehvgGw1/dObtVcI9wf5kAAokYI3A74Hax1eujE2ueyj1fX8ukeiZjMXMk4Y8QHI7SbMgMnSQ6AOZIZERUJEw5Hmjv23YVDwz8/etVGJXBUZZktkmVwPJusfbr62N3i+Xz5/Z8HuBPzN5rTvZe5VAhuSehjabD/4pYEued2F0025Gvj9VTXalrwvMk9y+cHbYoaAWliqVC96m3w39m9NXUqn0HYDPkOiywslaGB2rVi9U14rV9u3Y96fHkqmd92T1x1ygE9Xq+b/awfkfmzntCAO/rwcAAAAASUVORK5CYII=",this.N="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH5QoOAiAd1TTTFgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAABfElEQVRYw81XO26EMBB9poAIrBwh2hPgMt1WS7cSN+AonAXtIahSpfLWVNtFewXLkG7SeCVIbH5rBZ40jYGZ8fjxPMOwDAcARwAnAO8A3sz6HcAVwAeATwBf8IgIQAGgA0AzrTPfRM8GPy8I6rLz2l1fPAR/2GVJNV4B3DwGf9jN+J7cuTM4Y4yEEFSWJUkpSWtNWmuSUlJZliSEIMbYVBKjlXCWPcsyUkrRFJRSlGXZ1HHMJ1wYhlRVFS1FVVUUhuFsYkau4FJKWgsp5VgSg6MobC+t2bmtEo4Ein4Cne3MfcHBia4vr3/YPodwc6GUcv0dh8Bo+wBpmoJz7k3LOedI09T26BiYi2WAPM/hGw6fJ9iE5xnmj/0RNmFihgwv/bS01ojj2GsF2rZFkiS/l78DbIzANBMDNE3jPZDD5z0wncwAdV17T8Dh82pVQSGEdxIKIZxquKkQ7UKKd3EZbX4db96Q7KIl20VTunlbvovBZBej2b8Np2zr8fwHFGE/6k/Mu0oAAAAASUVORK5CYII=",this.objectArray=[],this.U=[],this.Y=[],this.H=[],this.G=[],this.Z=null,this.X=null,this.J=null,this.K=null,this._=void 0,this.W="#FF0000",this.q=this.C.getRenderManager().renderer.domElement,this.$=this.$.bind(this),this.tt=this.tt.bind(this),this.it=this.it.bind(this),this.nt=new $,this.st=new ui,this.et=null,this.rt=null,this.ht={},this.ot()}var t,n,s;return t=i,(n=[{key:"editUrl",get:function(){return this.N},set:function(t){this.N=t}},{key:"centerUrl",get:function(){return this.V},set:function(t){this.V=t}},{key:"PointStyle",get:function(){return this.L},set:function(t){this.L=t}},{key:"operate",get:function(){return this._},set:function(t){this._=t;for(var i=0;i<this.H.length;i++)this.H[i].visible=!1,"move"===t?"center"===this.H[i]._opetype&&(this.H[i].visible=!0):"center"!==this.H[i]._opetype&&(this.H[i].visible=!0)}},{key:"LineStyle",get:function(){return this.F},set:function(t){this.F=t}},{key:"PolygonStyle",get:function(){return this.D},set:function(t){this.D=t}},{key:"DrawTool",get:function(){return this.P},set:function(t){if(this.P=t,"edit"!==this.P){for(var i=0;i<this.H.length;i++)this.H[i].remove();null!==this.rt&&(this.rt.parent.remove(this.rt),this.rt=null,this.C.enableUpdateRender()),this.U.length=0,this.Y.length=0,this.H.length=0,this.X=null,this.Z=null}}},{key:"edit",value:function(t,i){if("none"===this.DrawTool||"edit"===this.DrawTool)if(t&&t.shapetype){if(!(0<this.H.length||null!==this.rt)&&(i||null==this.X||this.X.id!==t.id)&&(!t.opetype||"no"===t.opetype.type)){for(var n=0;n<this.H.length;n++)this.H[n].remove();null!==this.rt&&(this.rt.parent.remove(this.rt),this.rt=null,this.C.enableUpdateRender()),this.H.length=0,this.Z=null,this.X=t,i||(this.K=t.id),t.type===fengmap.FMType.POLYGON_MARKER?(this.ut(t),this.DrawTool="edit"):t.type===fengmap.FMType.LINE_MARKER?(this.ft(t),this.DrawTool="edit"):t.type===fengmap.FMType.IMAGE_MARKER&&(this.DrawTool="edit",this.J=null,this.ct(t))}}else{for(var s=0;s<this.H.length;s++)this.H[s].remove();this.H.length=0,(this.X=null)!==this.rt&&(this.rt.parent.remove(this.rt),this.rt=null,this.C.enableUpdateRender())}}},{key:"on",value:function(t,i){this.st.I(t,i)}},{key:"dispose",value:function(){this.q.removeEventListener("mousedown",this.$,!1),this.q.removeEventListener("mousemove",this.tt,!1),this.q.removeEventListener("mouseup",this.it,!1)}},{key:"createMarkerByInfo",value:function(t){var i;if("circle"===t.shapetype||"ellipse"===t.shapetype||"rect"===t.shapetype||"polygon"===t.shapetype)return i=new fengmap.FMPolygonMarkerEdit(t),e=this.C.getFloor(t.level),i.addTo(e),i.mapEdit=this,t.id&&(i.id=t.id),i;if("line"!==t.shapetype)return e=this.C.getFloor(t.level),(i=new fengmap.FMImageMarkerEdit(t)).addTo(e),i.mapEdit=this,t.id&&(i.id=t.id),i;var n=new fengmap.FMSegment;n.points=[];for(var s=0;s<t.points.length;s++)n.points.push({x:t.points[s].x,y:t.points[s].y,z:t.points[s].z});n.level=t.level,t.segments=[n];var e=new fengmap.FMLineMarkerEdit(t);return e.addTo(this.C),e.mapEdit=this,t.id&&(e.id=t.id),e}}])&&yi(t.prototype,n),s&&yi(t,s),Object.defineProperty(t,"prototype",{writable:!1}),i}(),Object.assign(t.prototype,{ot:function(){this.q.addEventListener("mousedown",this.$,!1),this.q.addEventListener("mousemove",this.tt,!1),this.q.addEventListener("mouseup",this.it,!1)},lt:function(t,i){if(("none"===this.DrawTool||"edit"===this.DrawTool)&&(null!==this.rt&&(this.rt.parent.remove(this.rt),this.rt=null,this.C.enableUpdateRender()),t)&&(i||null==this.X||this.X.id!==t.id)&&(!t.opetype||"no"===t.opetype.type)){for(var n=0;n<this.H.length;n++)this.H[n].remove();this.H.length=0,this.Z=null,this.X=t,i||(this.K=t.id),t.type===fengmap.FMType.POLYGON_MARKER?(this.ut(t),this.DrawTool="edit"):t.type===fengmap.FMType.LINE_MARKER?(this.ft(t),this.DrawTool="edit"):t.type===fengmap.FMType.IMAGE_MARKER&&(this.DrawTool="edit",this.J=null,this.ct(t))}},vt:function(t){t=vi({},t);return t.buildingID===this.C.getMapOptions().mapID&&(t.buildingID=null),t},dt:function(t,i){var n=new E;if(n.x=t/this.q.getBoundingClientRect().width*2-1,n.y=2*-(i/this.q.getBoundingClientRect().height)+1,"point"===this.X.shapetype)return t=[this.X.getRenderNode()],this.nt.setFromCamera(n,this.C.camera),0<(i=this.nt.intersectObjects(t,!0)).length?i[0].object:null;for(var s=[],e=0;e<this.H.length;e++)this.H[e].opetype.node.visible&&s.push(this.H[e].opetype.node);this.nt.setFromCamera(n,this.C.camera);t=this.nt.intersectObjects(s,!0);return 0<t.length?t[0].object:null},yt:function(t,i){var n=t.offsetX,t=t.offsetY,s=new b;s.x=n/this.q.clientWidth*2-1,s.y=2*-(t/this.q.clientHeight)+1,s.z=.5,this.nt.setFromCamera(s,this.C.camera);var e,r=null,h=function(t,i){var n,s,e,r,h="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(h)return s=!(n=!0),{s:function(){h=h.call(t)},n:function(){var t=h.next();return n=t.done,t},e:function(t){s=!0,e=t},f:function(){try{n||null==h.return||h.return()}finally{if(s)throw e}}};if(Array.isArray(t)||(h=fi(t))||i&&t&&"number"==typeof t.length)return h&&(t=h),r=0,{s:i=function(){},n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this.C.getRenderManager().getRenderList());try{for(h.s();!(e=h.n()).done;)for(var o=ai(e.value,2),u=(o[0],o[1]),a=this.nt.intersectObject(u,!0),f=0;f<a.length;f++)a[f].object.mapNode&&(r=a[f].object)}catch(t){h.e(t)}finally{h.f()}null!==r&&r.mapNode?r.mapNode.type!==fengmap.FMType.LINE_MARKER?this.et={buildingID:r.mapNode.parent.parent.parent.buildingID,level:r.mapNode.level}:(n=r.mapNode.segments[0],this.et={buildingID:n.buildingID,level:n.level}):this.et={buildingID:this.C.getMapOptions().mapID,level:this.C.getLevel()},i&&i()},$:function(s){var e=this;this.yt(s,function(){if("none"!==e.DrawTool)if(2===s.button)"edit"!==e.DrawTool?e.At():(null!==e.Z||null!==e.X&&"point"===e.X.shapetype)&&e.gt(),e.Z=null;else{var t=s.clientX-e.q.getBoundingClientRect().left,i=s.clientY-e.q.getBoundingClientRect().top;if("edit"===e.DrawTool){if(null===e.Z){if(null===e.X)return;var n=e.dt(t,i);"point"!==e.X.shapetype?null!==n&&(e.Z=n.mapNode,e.bt(!1)):null!==n&&(e.J={x:e.X.x,y:e.X.y},e.bt(!1))}}else{n=fengmap.FMUtil.coordsScreenToMap(e.C,{x:t,y:i});n.buildingID=e.et.buildingID,n.level=e.et.level,"point"===e.DrawTool?(e.Mt(n),e.st.B({type:"drawend",info:e.vt(e.currentobj.info),object:e.currentobj}),e.currentobj=null,e.et=null):"line"===e.DrawTool?e.U.push(n):"circle"===e.DrawTool?0===e.Y.length?e.Y.push(n):(e.wt(n),e.st.B({type:"drawend",info:e.vt(e.currentobj.info),object:e.currentobj}),e.Y.length=0,e.currentobj=null,e.et=null):"rect"===e.DrawTool?0===e.Y.length?e.Y.push(n):(e.Et(n),e.st.B({type:"drawend",info:e.vt(e.currentobj.info),object:e.currentobj}),e.Y.length=0,e.currentobj=null,e.et=null):"polygon"===e.DrawTool?e.Y.push(n):"ellipse"===e.DrawTool&&(0===e.Y.length?e.Y.push(n):(e.St(n),e.st.B({type:"drawend",info:e.vt(e.currentobj.info),object:e.currentobj}),e.Y.length=0,e.currentobj=null,e.et=null))}}})},tt:function(t){if("none"!==this.DrawTool){var i=t.clientX-this.q.getBoundingClientRect().left,t=t.clientY-this.q.getBoundingClientRect().top,i=fengmap.FMUtil.coordsScreenToMap(this.C,{x:i,y:t});if("edit"===this.DrawTool)return null!==this.X&&"point"===this.X.shapetype&&null!==this.J?(this.X.moveTo({animate:!1,x:i.x,y:i.y}),void this.st.B({type:"drawing",info:this.vt(this.X.info),object:this.X})):void(null!==this.X&&null!==this.Z&&(this.xt(i),this.X.id=this.K,this.st.B({type:"drawing",info:this.vt(this.X.info),object:this.X})));"line"===this.DrawTool?this.Rt(i):"circle"===this.DrawTool?this.wt(i):"rect"===this.DrawTool?this.Et(i):"polygon"===this.DrawTool?this.jt(i):"ellipse"===this.DrawTool&&this.St(i),this.C.enableUpdateRender(),null!==this.currentobj&&this.st.B({type:"drawing",info:this.vt(this.currentobj.info),object:this.currentobj})}},it:function(t){if(2!==t.button&&"edit"===this.DrawTool&&null!==this.X&&("point"===this.X.shapetype||null!==this.Z)){if("point"===this.X.shapetype)this.lt(this.X,!0);else if("center"!==this.Z.opetype.type){if("ellipse"===this.X.shapetype||"circle"===this.X.shapetype)this.J=this.Ot(this.X.points);else if("rect"===this.X.shapetype){this.J=this.X.points;var t=this.It("center"),i=(t.visible=!0,void 0!==this._&&"edit"===this._&&(t.visible=!1),this.It("point",!0));t.position.x=(i[0].position.x+i[1].position.x)/2,t.position.z=(i[0].position.z+i[1].position.z)/2,this.G.length=0,this.G.push({x:Math.abs(i[0].position.x-i[1].position.x)/2,y:Math.abs(i[0].position.z-i[1].position.z)/2})}else if("polygon"===this.X.shapetype){this.J=this.X.points;for(var n=this.Ot(this.J).center,s=this.G.length=0;s<this.J.length;s++)this.G.push({x:this.J[s].x-n.x,y:this.J[s].y-n.y});t=this.It("center");t.position.x=n.x-this.C.x,t.position.z=this.C.y-n.y}else if("line"===this.X.shapetype){this.J=this.X.points;for(var e=this.Ot(this.J).center,r=this.G.length=0;r<this.J.length;r++)this.G.push({x:this.J[r].x-e.x,y:this.J[r].y-e.y});i=this.It("center");i.position.x=e.x-this.C.x,i.position.z=this.C.y-e.y}}else this.lt(this.X,!0);this.bt(!0),this.Z=null,this.X.id=this.K,this.st.B({type:"editend",info:this.vt(this.X.info),object:this.X})}},ct:function(t){t.getRenderNode().position;var i=[new b(-.5,0,.5),new b(-.5,0,-.5),new b(.5,0,-.5),new b(.5,0,.5),new b(-.5,0,.5)],i=(new Kt).setFromPoints(i),n=new k({color:new v(this.W)}),i=(n.depthTest=!1,n.depthWrite=!1,new ei(i,n));i.scale.set(1.1,1.1,1.1),t.getRenderNode().add(i),this.rt=i,this.C.enableUpdateRender()},xt:function(t){if(null!==this.Z){var s=this;if("ellipse"!==this.X.shapetype?(this.Z.opetype.node.position.x=t.x-this.C.x,this.Z.opetype.node.position.z=this.C.y-t.y):"xradius"===this.Z.opetype.type?this.Z.opetype.node.position.x=t.x-this.C.x:("yradius"!==this.Z.opetype.type&&(this.Z.opetype.node.position.x=t.x-this.C.x),this.Z.opetype.node.position.z=this.C.y-t.y),"circle"===this.X.shapetype)"yradius"===this.Z.opetype.type?(r=w("center"),this.Y.length=0,this.Y.push({x:this.C.x+r.position.x,y:this.C.y-r.position.z}),this.wt(t,!0)):(w("yradius").visible=!1,this.Y.length=0,this.Y.push({x:t.x,y:t.y}),this.wt({x:t.x,y:t.y+this.J.yradius},!0));else if("ellipse"===this.X.shapetype)this.Y.length=0,"yradius"===this.Z.opetype.type||"xradius"===this.Z.opetype.type?(r=w("center"),r={x:this.C.x+r.position.x,y:this.C.y-r.position.z},e=null,e="yradius"===this.Z.opetype.type?this.kt(r,this.J.xradius,Math.abs(r.y-t.y)):this.kt(r,Math.abs(r.x-t.x),this.J.yradius),this.St(e,!0)):(w("xradius").visible=!1,w("yradius").visible=!1,r=this.kt(t,this.J.xradius,this.J.yradius),this.St(r,!0));else if("rect"===this.X.shapetype)if("center"===this.Z.opetype.type){for(var i=w("point",!0),n=0;n<i.length;n++)i[n].visible=!1;this.Y.length=0,this.Y.push({x:t.x+this.G[0].x,y:t.y-this.G[0].y}),this.Et({x:t.x-this.G[0].x,y:t.y+this.G[0].y},!0)}else{var e=w("center"),r=w("point",e.visible=!1,this.Z.opetype.node.uuid);null!==r&&(this.Y.length=0,this.Y.push({x:this.C.x+r.position.x,y:this.C.y-r.position.z}),this.Et(t,!0))}else if("polygon"===this.X.shapetype)if("center"===this.Z.opetype.type){for(var h=this.It("point",!0),o=0;o<h.length;o++)h[o].visible=!1;for(var u=this.Z.opetype.node.position.x,a=this.Z.opetype.node.position.z,f=[],c=0;c<this.G.length;c++)f.push({x:u+this.G[c].x,y:a-this.G[c].y});this.jt(f,!0)}else{for(var l=this.It("point",!0),v=[],d=0;d<l.length;d++)v.push({x:l[d].position.x,y:l[d].position.z});this.jt(v,!0)}else if("line"===this.X.shapetype){var y=this.It("point",!0),p=[];if("center"===this.Z.opetype.type){for(var m=0;m<y.length;m++)y[m].visible=!1;for(var A=this.Z.opetype.node.position.x,g=this.Z.opetype.node.position.z,b=0;b<this.G.length;b++)p.push({x:A+this.G[b].x,y:g-this.G[b].y})}else for(var M=0;M<y.length;M++)p.push({x:y[M].position.x,y:y[M].position.z});this.Rt(p,!0)}}function w(t,i,n){return s.It(t,i,n)}},It:function(t,i,n){var s=this,e=null;i&&(e=[]);for(var r=0;r<s.H.length;r++)if(s.H[r].opetype.type===t)if(i)(!n||s.H[r].opetype.node.uuid!==n)&&e.push(s.H[r].opetype.node);else{if(!n){e=s.H[r].opetype.node;break}if(s.H[r].opetype.node.uuid!==n){e=s.H[r].opetype.node;break}}return e},At:function(){var t;"line"===this.DrawTool?this.Rt():"circle"===this.DrawTool?this.wt():"rect"===this.DrawTool?this.Et():"polygon"===this.DrawTool?this.jt():"ellipse"===this.DrawTool&&this.St(),"line"!==this.DrawTool&&"polygon"!==this.DrawTool||(t=!0,"line"===this.DrawTool?this.U.length<2&&(t=!1):"polygon"===this.DrawTool&&this.Y.length<3&&(t=!1),t&&(this.st.B({type:"drawend",info:this.vt(this.currentobj.info),object:this.currentobj}),this.et=null),"line"===this.DrawTool&&(this.U.length=0,this.currentobj=null),"polygon"===this.DrawTool&&(this.Y.length=0,this.currentobj=null))},gt:function(){if(this.J){if("circle"===this.X.shapetype)this.Y.length=0,this.Y.push({x:this.J.center.x,y:this.J.center.y}),this.wt({x:this.J.center.x,y:this.J.center.y+this.J.yradius},!0);else if("ellipse"===this.X.shapetype){this.Y.length=0;var t=this.kt({x:this.J.center.x,y:this.J.center.y},this.J.xradius,this.J.yradius);this.St(t,!0)}else if("rect"===this.X.shapetype)this.Et(),this.lt(this.X);else if("polygon"===this.X.shapetype){for(var i=[],n=0;n<this.J.length;n++)i.push({x:this.J[n].x-this.C.x,y:this.C.y-this.J[n].y});this.jt(i,!0)}else if("line"===this.X.shapetype){for(var s=[],e=0;e<this.J.length;e++)s.push({x:this.J[e].x-this.C.x,y:this.C.y-this.J[e].y});this.Rt(s,!0)}else if("point"===this.X.shapetype)return this.X.moveTo({animate:!1,x:this.J.x,y:this.J.y}),this.st.B({type:"editend",info:this.vt(this.X.info),object:this.X}),void(this.X=null);this.X.id=this.K,this.st.B({type:"editend",info:this.vt(this.X.info),object:this.X}),this.lt(this.X,!0)}},Mt:function(t){var i,n={},s=this.PointStyle;for(i in s)n[i]=s[i];n.x=t.x,n.y=t.y,n.buildingID=this.et.buildingID;var t=this.C.getBuilding(this.et.buildingID).getFloor(this.et.level),e=new fengmap.FMImageMarkerEdit(n);e.addTo(t),(e.mapEdit=this).currentobj=e},Rt:function(t,i){var n,s=new fengmap.FMSegment,e=(s.points=[],{}),r=this.LineStyle;for(n in r)e[n]=r[n];if(void 0===e.height&&(e.height=3),i){null!==this.X&&this.X.remove();for(var h=0;h<t.length;h++)s.points.push({x:this.C.x+t[h].x,y:this.C.y-t[h].y,z:e.height})}else{if(0===this.U.length)return;if(null!==this.currentobj&&(this.currentobj.remove(),!t)&&1===this.U.length)return;for(var o=0;o<this.U.length;o++)s.points.push({x:this.U[o].x,y:this.U[o].y,z:e.height});t&&s.points.push({x:t.x,y:t.y,z:e.height})}i?(s.level=this.et.level,s.buildingID=this.et.buildingID):(s.level=this.U[0].level,s.buildingID=this.U[0].buildingID),e.segments=[s];var u=new fengmap.FMLineMarkerEdit(e);u.addTo(this.C),u.mapEdit=this,i?this.X=u:this.currentobj=u},wt:function(t,i){if(0!==this.Y.length){if(i)null!==this.X&&this.X.remove();else if(null!==this.currentobj&&(this.currentobj.remove(),!t))return this.Y.length=0,void(this.currentobj=null);var n,s=this.Y[0],t=Math.sqrt((s.x-t.x)*(s.x-t.x)+(s.y-t.y)*(s.y-t.y)),e=this.PolygonStyle,r={};for(n in e)r[n]=e[n];r.points=fengmap.FMCalculator.circleBuilder(t,this.Y[0],32),r.shapetype="circle";var h,t=new fengmap.FMPolygonMarkerEdit(r);i?(h=this.C.getBuilding(this.et.buildingID).getFloor(this.et.level),t.addTo(h)):(h=this.C.getBuilding(s.buildingID).getFloor(s.level),t.addTo(h)),t.mapEdit=this,i?this.X=t:this.currentobj=t}},Et:function(t,i){var n=[];if(t||i){if(0===this.Y.length)return;if(i)null!==this.X&&this.X.remove();else if(null!==this.currentobj&&(this.currentobj.remove(),!t))return this.Y.length=0,void(this.currentobj=null);var s=this.Y[0],n=[s,{x:t.x,y:s.y},t,{x:s.x,y:t.y}]}else if("edit"===mapdraw.DrawTool)n=this.J,null!==this.X&&this.X.remove();else if(null!==this.currentobj)return this.currentobj.remove(),this.Y.length=0,void(this.currentobj=null);if(0!==n.length){var e,r=this.PolygonStyle,h={};for(e in r)h[e]=r[e];h.points=n,h.shapetype="rect";s=new fengmap.FMPolygonMarkerEdit(h);i?(n=this.C.getBuilding(this.et.buildingID).getFloor(this.et.level),s.addTo(n)):(n=this.C.getBuilding(this.Y[0].buildingID).getFloor(this.Y[0].level),s.addTo(n)),s.mapEdit=this,!t&&!i||i?this.X=s:this.currentobj=s}},jt:function(t,i){var n=[];if(i){null!==this.X&&this.X.remove();for(var s=0;s<t.length;s++)n.push({x:this.C.x+t[s].x,y:this.C.y-t[s].y})}else{if(0===this.Y.length)return;null!==this.currentobj&&this.currentobj.remove();for(var e=0;e<this.Y.length;e++)n.push({x:this.Y[e].x,y:this.Y[e].y});if(t)n.push({x:t.x,y:t.y});else if(2===n.length)return}var r,h=this.PolygonStyle,o={};for(r in h)o[r]=h[r];o.points=n;var u,a=new fengmap.FMPolygonMarkerEdit(o);i?(u=this.C.getBuilding(this.et.buildingID).getFloor(this.et.level),a.addTo(u)):(u=this.C.getBuilding(this.Y[0].buildingID).getFloor(this.Y[0].level),a.addTo(u)),a.mapEdit=this,i?this.X=a:this.currentobj=a},St:function(t,i){var n=null;if(i)null!==this.X&&this.X.remove(),n=t;else{if(0===this.Y.length)return;if(null!==this.currentobj&&this.currentobj.remove(),!t)return this.Y.length=0,void(this.currentobj=null);var s=this.Y[0],e=Math.abs(t.x-s.x),t=Math.abs(t.y-s.y),n=t<e?this.kt(s,e,e/2):this.kt(s,t/2,t)}for(var r=[],h=0;h<n.length;h++)r.push({x:n[h].x,y:n[h].y});var o,u=this.PolygonStyle,a={};for(o in u)a[o]=u[o];a.points=r,a.shapetype="ellipse";e=new fengmap.FMPolygonMarkerEdit(a);i?(s=this.C.getBuilding(this.et.buildingID).getFloor(this.et.level),e.addTo(s)):(t=this.C.getBuilding(this.Y[0].buildingID).getFloor(this.Y[0].level),e.addTo(t)),e.mapEdit=this,i?this.X=e:this.currentobj=e},kt:function(t,i,n){return new s(t.x,t.y,i,n,0,2*Math.PI,!1,0).getPoints(32)},ft:function(t){for(var i=[],n=(this.J=t.points,this.Ot(t.points).center),s=this.G.length=0;s<t.points.length;s++)i.push(t.points[s]),this.G.push({x:t.points[s].x-n.x,y:t.points[s].y-n.y});i.push({x:n.x,y:n.y,optype:"center"}),this.Tt(i,t)},ut:function(t){var i,n=this,s=[];if("polygon"===t.shapetype){this.J=t.points;for(var e=this.Ot(t.points).center,r=this.G.length=0;r<t.points.length;r++)s.push(t.points[r]),this.G.push({x:t.points[r].x-e.x,y:t.points[r].y-e.y});s.push({x:e.x,y:e.y,optype:"center"})}else"rect"===t.shapetype?(this.J=t.points,s.push(t.points[0]),s.push(t.points[2]),s.push({x:(t.points[0].x+t.points[2].x)/2,y:(t.points[0].y+t.points[2].y)/2,optype:"center"}),this.G.length=0,this.G.push({x:Math.abs(t.points[0].x-t.points[2].x)/2,y:Math.abs(t.points[0].y-t.points[2].y)/2})):"circle"!==t.shapetype&&"ellipse"!==t.shapetype||(i=this.Ot(t.points),this.J=i,s.push({x:i.center.x,y:i.center.y,optype:"center"}),s.push({x:i.center.x,y:i.center.y+i.yradius,optype:"yradius"}),"ellipse"===t.shapetype&&s.push({x:i.center.x+i.xradius,y:i.center.y,optype:"xradius"}));n.Tt(s,t)},Tt:function(t,i){for(var n=this,s=(n.C.getFloor(n.C.getLevel()),0);s<t.length;s++){var e=(e=t[s].optype)||"point",r=n.editUrl,r=("center"===e&&(r=n.centerUrl),new fengmap.FMImageMarkerEdit({url:r,size:16,height:i.height+1,x:t[s].x,y:t[s].y,collision:!1,opetype:e})),h=this.C.getBuilding(i.info.buildingID).getFloor(i.info.level);r.addTo(h),void 0!==this._&&("move"===this._?"center"!==e&&(r.visible=!1):"edit"===this._&&"center"===e&&(r.visible=!1)),n.H.push(r)}},Ot:function(t){for(var i=null,n=null,s=null,e=null,r=0;r<t.length;r++)0===r?(i=t[r].x,n=t[r].y,s=t[r].x,e=t[r].y):(i>t[r].x&&(i=t[r].x),n>t[r].y&&(n=t[r].y),s<t[r].x&&(s=t[r].x),e<t[r].y&&(e=t[r].y));return{center:{x:(i+s)/2,y:(n+e)/2},xradius:Math.abs(s-i)/2,yradius:Math.abs(e-n)/2}},Bt:function(t){var i=t.buildingID,t=t.level;null===i&&(i=this.C.getMapOptions().mapID,t=this.C.getLevel()),null===this.currentobj&&(this.et={buildingID:i,level:t})},bt:function(t){var i=this.C.getInteracations();t?(i.enableDrag=this.ht.enableDrag,i.enableRotate=this.ht.enableRotate,i.enableTilt=this.ht.enableTilt,i.enableZoom=this.ht.enableZoom):(this.ht.enableDrag=i.enableDrag,this.ht.enableRotate=i.enableRotate,this.ht.enableTilt=i.enableTilt,this.ht.enableZoom=i.enableZoom,i.enableDrag=t,i.enableRotate=t,i.enableTilt=t,i.enableZoom=t)},Ct:function(t){if(this.X&&this.X.id===t){for(var i=0;i<this.H.length;i++)this.H[i].remove();this.H.length=0}}});function mi(t){return(mi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ai(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,i){if("object"!=mi(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!=mi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==mi(t)?t:String(t)}(s.key),s)}}var gi=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")}var i,n,s;return i=t,s=[{key:"round",value:function(t){return 0<t.toFixed(2)?Math.ceil(t.toFixed(2)):Math.floor(t.toFixed(2))}},{key:"generateUUID",value:function(){for(var t=[],i=0;i<256;i++)t[i]=(i<16?"0":"")+i.toString(16);var n=4294967295*Math.random()|0,s=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]+"-"+t[255&s]+t[s>>8&255]+"-"+t[s>>16&15|64]+t[s>>24&255]+"-"+t[63&e|128]+t[e>>8&255]+"-"+t[e>>16&255]+t[e>>24&255]+t[255&r]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255];return t.length=0,n.toUpperCase()}},{key:"findNearNthPowerOfTwo",value:function(t){t-=1;return(t=(t=(t=(t=(t|=t>>1)|t>>2)|t>>4)|t>>8)|t>>16)<0?1:1+t}},{key:"rgbToArray",value:function(t){var i=new v;return i.setStyle(t),[i.r,i.g,i.b]}},{key:"toRgba",value:function(t){var i;return void 0===t?t:"number"!=typeof t?3<=(i=t.split(",")).length?"rgba("+parseInt(i[0])+","+parseInt(i[1])+","+parseInt(i[2])+",1)":t:"rgba("+parseInt(255*new v(t).r)+","+parseInt(255*new v(t).g)+","+parseInt(255*new v(t).b)+",1)"}},{key:"toColor",value:function(t){var i;return"number"==typeof t?t:3<=(i=t.split(",")).length?parseInt(i[0])<<16|parseInt(i[1])<<8|parseInt(i[2]):(console.error("color format error",t),0)}},{key:"cov",value:function(t){for(var i=[],n=[0,0],s=[],e=0;e<t.length;e++)n[0]+=t[e].x,n[1]+=t[e].y;n[0]=n[0]/t.length,n[1]=n[1]/t.length;for(var r=0;r<t.length;r++)s.push([t[r].x-n[0],t[r].y-n[1]]);for(var h=[],o=0;o<s[0].length;o++){for(var u=[],a=0;a<s.length;a++)u.push(s[a][o]);h.push(u)}for(var f=0;f<h.length;f++){for(var c=[],l=0;l<s[0].length;l++){for(var v=0,d=0;d<h[f].length;d++)v+=h[f][d]*s[d][l];v/=t.length-1,c.push(v)}i.push(c)}return i}},{key:"eig",value:function(t){var i=(t[0][0]+t[1][1])/2,n=t[0][0]*t[1][1]-t[1][0]*t[0][1],s=i+Math.sqrt(i*i-n),i=i-Math.sqrt(i*i-n);return 0==t[0][1]&&0==t[1][0]?{eigValue:[s,i],eigVect:[[1,0],[0,1]]}:(n=(s-t[0][0])/t[0][1],t=(i-t[0][0])/t[0][1],{eigValue:[s,i],eigVect:[[1/Math.sqrt(1+n*n),n/Math.sqrt(1+n*n)],[1/Math.sqrt(1+t*t),t/Math.sqrt(1+t*t)]]})}}],(n=null)&&Ai(i.prototype,n),s&&Ai(i,s),Object.defineProperty(i,"prototype",{writable:!1}),t}();function bi(t){return(bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Mi(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,i){if("object"!=bi(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!=bi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==bi(t)?t:String(t)}(s.key),s)}}function wi(t,i,n){i=xi(i);var s=t,i=Ei()?Reflect.construct(i,n||[],xi(t).constructor):i.apply(t,n);if(i&&("object"===bi(i)||"function"==typeof i))return i;if(void 0!==i)throw new TypeError("Derived constructors may only return object or undefined");t=s;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function Ei(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ei=function(){return!!t})()}function Si(){return(Si="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,i,n){var s=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=xi(t)););return t}(t,i);if(s)return(s=Object.getOwnPropertyDescriptor(s,i)).get?s.get.call(arguments.length<3?t:n):s.value}).apply(this,arguments)}function xi(t){return(xi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ri(t,i){return(Ri=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t})(t,i)}var ji=function(t){var i,n=s;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");function s(t){var i;if(this instanceof s)return(i=wi(this,s,[t])).info2=t,i.id=""+gi.generateUUID(),i.shapetype2="point",i.opetype2="no",t.opetype&&(i.opetype2=t.opetype,i.shapetype2="no"),i.mapEdit=null,i;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&Ri(n,t),n=s,(t=[{key:"info",get:function(){return this.info2.id=this.id,this.info2.x=this.x,this.info2.y=this.y,this.info2.height=this.height,this.info2.shapetype=this.shapetype,this.info2.level=this.level,this.info2}},{key:"opetype",get:function(){if(this.opetype2)return{node:this.getRenderNode(),type:this.opetype2}}},{key:"shapetype",get:function(){return this.shapetype2}},{key:"deleteMarker",value:function(){Si(xi(s.prototype),"remove",this).call(this)}}])&&Mi(n.prototype,t),i&&Mi(n,i),Object.defineProperty(n,"prototype",{writable:!1}),s}(fengmap.FMImageMarker);function Oi(t,i){return function(t){if(Array.isArray(t))return t}(t)||function(t,i){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var s,e,r,h,o=[],u=!0,a=!1;try{if(r=(n=n.call(t)).next,0===i){if(Object(n)!==n)return;u=!1}else for(;!(u=(s=r.call(n)).done)&&(o.push(s.value),o.length!==i);u=!0);}catch(t){a=!0,e=t}finally{try{if(!u&&null!=n.return&&(h=n.return(),Object(h)!==h))return}finally{if(a)throw e}}return o}}(t,i)||ki(t,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ii(t,i){var n,s,e,r,h="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(h)return s=!(n=!0),{s:function(){h=h.call(t)},n:function(){var t=h.next();return n=t.done,t},e:function(t){s=!0,e=t},f:function(){try{n||null==h.return||h.return()}finally{if(s)throw e}}};if(Array.isArray(t)||(h=ki(t))||i&&t&&"number"==typeof t.length)return h&&(t=h),r=0,{s:i=function(){},n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ki(t,i){var n;if(t)return"string"==typeof t?Ti(t,i):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ti(t,i):void 0}function Ti(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,s=new Array(i);n<i;n++)s[n]=t[n];return s}function Bi(t){return(Bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ci(i,t){var n,s=Object.keys(i);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(i),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})),s.push.apply(s,n)),s}function Pi(s){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?Ci(Object(e),!0).forEach(function(t){var i,n;i=s,n=e[t=t],(t=Fi(t))in i?Object.defineProperty(i,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):i[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(e)):Ci(Object(e)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(e,t))})}return s}function Li(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,Fi(s.key),s)}}function Fi(t){t=function(t,i){if("object"!=Bi(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!=Bi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Bi(t)?t:String(t)}var Di=function(){function i(t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.C=t,this.Pt=null,this.Lt=!1,this.q=this.C.getRenderManager().renderer.domElement,this.L={url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAACARJREFUeF7lW3twVNUZ/313N8kmQHbvIuCrM4itpUJ2A7ZQxrbwh62KxccgyNDWVpNdotiZvtTyGIHROJk+LFNHSnZX2yllrEYYrENtnU4h0wdCTdm7aBusBSwOsUr2xSubzb1f524aRsMm955z7y6d6f33fr/v+32/Pec73zn3LOH//KFq5P/Rr3PdxGJ2AQwsZMYsBj5OwDSAJwGoBXAaQA7AEQCHodABIuxJblWPVZpfBQVgCkfyX2DW7ybi2wFqEE6G8DpB2eZBcVtPbEqfMN4GoAICMIVW5VcQ62vBmG2Dg6UJAwWC8lPF4I6DT6tvWwIEDFwVINySmQOFtwD4tAAHEdOzRHh8MKN+/29dNCgCHMvWJQHM4Z55CKBHAa5xg9i4PogOEil3JTv9/3Aay7EA10VPNOiof5aZb3VKRghPyCvsWXEw7n9ZCDfK2JEATfdlVY9u7GbGAick5LFUhKLcq3X6fyHrQ1qA4V/e97uLl/z5lHWGclcqHtghI4KkAEzN0eyuqg/7MTJkYEDx4Ibk1uCfREWQEiAcST8MoEM0WIXt3ynUept7n2rsF4kjLMDwUof9Van2IpmUbGmHFlfvFIEJClBa7v5cwXVehHtZWwWexSIrg5AATdH0SoWx3THLCjpgoDd1hToLG8mwE0ZAAKZwNJNyo72tqwGarvJimqqgvg44mWP8s0/H8fdscbbMi0hZnowFuiwNzUljx8i0CUdyNwL6b+zal7ObfqmCti/6sDBci/q6C0Mf6dPxy98PYMcfBqE70+JVLR601ZvYFiDUmt5OhJUyAphBVi3xoXWxD16PdcgjJ3R8a+tpHHtXVgViYGimFp/yphVfazYAzP38hIF0WmZLawZob2nA4vl1Vlw+9P7UWQNtm0/jjWO6EO68MdEjWkx91ApsS4Dmtswi1nmPlbNy79uW+NC2pF4GivezBla25/F+joXxDHSn4sFFVkB7AkQzG5h5o5Wz0e/NOf/ChkZbw34s37tfLWDdM2dFQ5v2hTO+fv9bT36sMB7YlgDhSOZ5gJeJsuhobcBN88SG/ugYBjOWbsjjqFQ94NlafPIbjgUIRTIagUMiAphL3d4nAmWrvYgf03bLi+cQ2z0gCgOYlmoJdadjAcKRzLsATxNh8MlrvEh8xzzzdP68driI1h+a56ZiDzPuTyWCP3FBgPQZAEKHmrfMr0V7ywQxxmNYH39Px5L1eWFfRHg4GQt+z7EAoUhaJ0ARYXDn52qx/svuCHAyZ+CGB81Tc8HHxlJoqwiGIulzBPhEwi8K12Dz6okikDFte/81hBWPnRL3xVijJYLjbtttCSBTAz4yVcFLj/nFSZdB7N5fwLqnxZdCN2tA0twOiGazc1MjZlzmEYVdYP9Q7DReea0o7IeI7kjG1F2Oa0A4kn4OwHJRBssX1mLtl5zVgb60jtvW5zE4JBod8HDNtX9NTPq7YwGaW7MPMhnjVtNyQTwK0PVII2ZcLj8K1iTO4OUDUt9A8lpWDaKLxt1M2KoBoWh2LrHRI/4bAGY7vO27kzCpQWgRKYXq6h5A+/ZzMmHNff6vkvHgbVZgWwKYTpoj6bcYuNrKYbn3s6Z7sPn+iZgSsC+CmXzHs+fkzwUUfEXrDFp+L7AtQCiSXkPA4zICmJgpfsI3ltbj5vm1UGjssOac//HOAdlhP0Iv4yX1yp4YWS4dtgWYtzo/uVAovg0iR1XtqksVfP66WsybOXIkRjAbHfNIrFsrYm+yKFXwPvTDEDq0WHCNnR/LtgCms3AkbTYV5jeB/9mHgVM15J3RE2s8aYekkACzWnJBj8d4k5gn23F+MWyYaWMqoW6yG1tIgNIoiOYeAOtP2g1QVTvCcS8GZvbELrec+yO8hAXAMvaE1exfwDynqsnZCabQUq1z/P3/aDfiApSWxNynGPo+APIdjp2ERGwIL2mxoPAdBSkBhgti/xMAfVOEYwVtc8y+2alEwzuiMaQFMO8HDLFPM0/NRYO6bU9Qosl4IC7jV1oAM1ioNf1ZItoD8MWcCq9o8eCNMsmbGEcCDK8KmR+A+duyBBzisszclEpMFh768qvAKMbTv3bU56/xmxulax0mIwGnu7W4uk0CeB7ieASUpkJpt8j7ADavvVbpEb8MUY6YKwL8tx6sJUJ7lbLvKxS8Tb0/F7sOU1EBSg1SINsN8PUVFYHBBuGWQ/Ggo/uBrtWADybbdG92BnmMJAHufBEpoyQDW1Lx4Gq3RHZtCowQCq/K3AODn3GL4Cg/vQ0T1bn7fkRyx0RlSLkuQGlpjPTvBOgOl0UoGqwsOJQISB3NjcWlIgJcEz1xST37UgAuc0sEZqxLJYLSJ1JVFaC0Kqzqv4l0+jXIebMFoj9qmcAiqxNeGbErMgLO14NI2jw3eECG2AcweWalOZUIHHXopyy8ogJcuex4fTAwoYeAT8iSN0D3HIqrP5PFW+EqKkBpKjjqEt3p9sYToeICyHeJ3Fco1LjS7V10AYa7xEw3AHtdIoPZ41mc6vQ7uphpNfzN91UZAWYgoS6R6Cktpjotnnbyr54Aw1Mh20JkJMZlRjjsxcBckZNdW5mOYVS1ETASvzmSeZEx5h+shuAxrte2XnLASVIi2KoLEGo7NZX0oUMATx1NlIg2JWOq8IVMkYQviOkELIudE8ncajDvGtUl7levUD+zdyNJXIWQZVLFIjiaYnNL5qus8AaU/kRNv9V58L7XE9P+LZ+KHLLqU0COZuVQ/wGFa5RfEyvmcQAAAABJRU5ErkJggg==",size:32,height:1,collision:!1},this.W="#FF0000",this.F={width:5,type:X.FULL,color:"#FF0000",height:3},this.D={color:"#FF0000",borderWidth:3,borderColor:"#0000FF",opacity:.5,height:3},this.V="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAACPtJREFUeF7tmntwVPUVx79nn9lXEhEjIBjrhGklVHlMJW1x0BmBIoKtGqCQiLVUkBoLEalUARUY35gp5eFUKY8ECMQRsDXUYdpSGSC0DUpBOwEZpNRQKJBsdjfZ5697NnfbzWY3926y9y4GfzP71/7u757zub/HOef7I1zlja5y//EVgEzOACHErQCIiD7OlB0ZmQFCCD2AjQBmSI5vBVBKREGtQWQKwCsAnnrnsBcCwIO3m9nv14loQa8HIISYAmDbvk99NG+zO+LvyhIb7hpiYhY/JKJqLSFoOgOEEIUADp25GLJNX+0kVxv7DNjNQOXcbNx0nZ6JFBHRMa0gaAZACJED4C+tPhSUrGmmz86HOvh4c54Omx/Lhs1MJwF8i4iatICgCQAhBL9ndxjAxAVbXdj7d3/C995daMSr0218LPwOwCQiap8iKjatACwN+/Dcpv1e/8r3Pcau/HlifBYeGWPhLs8T0XMq+h4ZWnUAQoh7AeyqPx3wzvp1iyUk8011BKx+2I5vDzbyGrmPiH6rJgRVAQghBgM4fMktjPdXOE1N7lCXXz/qaI6VsPWnDgy4Rs/7wO1EdEItCKoBEELYeMcX4E3P6Tt+NpidihPfGKDHhtkOZBnpuHQyuFJ5XmlfNQHweT5lxW7PuR2HvP2UGhTbb9JwE5YVM0dsJ6Kp3RlD7hlVAAghvgegds9R39mnt7kHyhnR1f+LJlswtSiLu0wgoj09GSvRs2oBeArAKw+tc507esbfra8fNbZwoMFVNddhB7CQiF79sgDgLK/e2SqosSmoize6dE0LfHFpj1HP0aAj0lWvJ7/NRE6Lidz2LMo16MDrYKQaWaMqM4CdEELcA6AMwDUxAPIB9Bu15DK8gY5YzAag7oVI13MAPo/59zKAXxJRbbq/viZxQKzR4XD4DQDzZABUENF8NZzVbA9IZnyvAyDt9t8E8IGS9ZlOAEKI2wCMDZcTjvXkdOjWHiAFOev5nJe+Nm9pnLx0uU7TBUAIMSG8Kb7H+6X0/u0AfhwuqKQcLKUMQApv3wVQWH2oDbvr/a6Ncxwhgw4HiIgNS9rSCKDW2SrGzf2N60LpaLNv/K2mQQA4YvxBqmFzSgCEEJMAbPL6Re7ynR68d8QXcfZPz+aeybVSY3gqFmkE4GBDY6BoyqqWyOuKR5n//YvJ1hwitAF4iIh4dihqigBI+TyntIu/uBzUlVe58Y8v/n+Q1y7Mvdg/l05mCgB7WjjQ4Fw1067vYyPOpZdJ6bRsPUEWgBAiF0AlFzMOnvDj6Wo3mj0dx62Zl+0vyNPXZxIAQ8i1UuD1Ert/5E0GhsBFlRK5ylKXAIQQQwG8K4Qo2PDnNqz6oA2J8vnqMge+3t/AAcw2mXk3JlwbGC4TBxwBsE9mnGkNjYF+0SUQ25frCT+bYPXPHM2hFT6T9oWkNcakAIQQnH297fYK29IaN/Ye9ye1SQKgaM1xJxkAisZpaAwgEYDow3cPNYplD9phMYELrbOSVZs7AZBEi5cBlJ++EKTyKhdOxRUw4y3kOJ7JK23xYXD0ucg3U9h4JvplZBQutL5R4hD5fSPpyEoAP48XXxIB2ML1+T9+4sPiHW64vAotukK72c2E5cVW3DnExBZuJaLpsaZ2ACBFVx/VHPZixU5PRLXpDY2dfPb7VjzQrkANi41a4wFwGvsxS1Z8zvdSALcR0dHoh020BPjIm7HvUx+e2eFBVL35ss4EexZhRbEVY26JLIEt4UgxKshGXEq2Cb4IYMGZiyHM39zSScWJh2HSs8atHFE6NkEh0KmoEm9B+yZoR35fPU/m1wAskt0Eo4MIIYoBrG/1wbb4neRqDve/Eo/BsUONeP4BG6zmSILEiRInTJ2aXCDEYiYnPgWb9nsDFbUe4xUSCE1taAz0TxYIlY234OE7zCyxsZ7ACRInSgmb7MSVRM3NnO7Wnw60lle5DfEChzQD6rQMhU+dD424v6I5srCjLddKeGmaDUUFEf2FFSUOhZu7WpyyAPhhKRlaAmDJJbdoLdvYEowVOjIBoLFZDJ7wctO1UedYSFk5w8ZqEktqL/BPibiqCEDMvjCREyMBZL24y9O8vc57fcweoOkMaPJgwJ3LL9/I72cBhc95szEiqfNVG8V6YkoApNlQIO0LQ39/1He26oDP8KuZtrxsC3FZTLOCSDCE78xc59RNGmGyS8IJJzy83vl+geKWMgAJAtfp40tik4no/a7enMaKUKKS2CNE1H7nJoXWLQAxS4IlME6Z+ev/L7pK9v50AZA+Aket4zJSFE0BcIeu6QTQXRvin+vRDEjViKsKgKQZPBGWtfrEgOqONMYi2oHwabyUiFpThS7XX5UZIF2B/VswBI+zTTS1+oTN4xXZwZCIRChy4mis0VlGCuX31XNF420imiXnUKr/qwXgSU4+Sta2uI79M8DSdo/a7vKcszf21emI6IYeDZTgYbUAjA9fa9lTU+fF8l2eHtlcOMhwqXKOw0qEfUTEp05amyoApGOqCsD05TvdqDncLqCk2vrYqWXX/JygwxIxc1S4nNWQ6hhy/dUEwLX5/f6gGPHoWy048nlqF8H1egpVPuZw3jJAz7cmZIMsOUeT/a8aAGkWsGb314uuUN6M1U6ca1ZeZFsxxX5h4jDjdVIR46XuOij3nKoAJAh3ANj7yb8Cph+92dLpZkgiA4tHmb3P3GflCmY1EU2Tc6In/6sOQIIwB8Da2o+8WLS9601xWL4huP5Rh9AROLn5LhH1bBeVoaMJAAnCOgCzK2o92PBhYrHh+mzClsezxbV23X+kG+Oxd4V68qGTPqslAA6C/hAMidFlG104cKLjLSmTAdgwO1sMuUHPf4wlIjl9MC1ANAMgzYI83hSdraFBJWtawFXnaGP15t7hEeHicSJanRbvFAyiKQAJwkgAH546H7SUrnXC7QVKR5vx5D1W/vstIvqJArvT1kVzABIE1ucq60766eBJP8rGWaDXESc8dxFR96KmbiLJCAAJwkIALMBwolPPFzCIiO8YaNoyBkCC8DW+Ocr7AhElv4CgIpKMAlDRL8VDfwVAMape2vG/uo8SfcLtYVIAAAAASUVORK5CYII=",this.Ft=16,this.Dt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAM1JREFUeF7t27ENwjAQBdAfRUhUlDR0lGmyDyswAYOwQkaiTJeGgiJVJBSBoEKscM8b+Ots3z3JTX95vFJ4NZ8AtpvkuG9LxTDe1yzP5BtAd2gznHelAjhd59ymVQAqwBFwB7gEvQKeQX2ARkgnqBU2CxiGTIOVEjAO8wAgQoSQGBOEolSYClNhKkyFqTAVpsJUmApTYSpMhSuZaKAoFIWiUBSKQlEoCkWhKBSFolAUikJRKApFoSgUhaJQFIpWSoAK/6pw+c/TlUr/f69vr/sXn39sPMAAAAAASUVORK5CYII=",this.Vt=16,this.Nt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAMpJREFUeF7t27ENwjAQBdCzgpBSpKSiomUkVsg8rJCR0lJRUVIgIdChpEJZ4Z438NfZvnuSW2ZmFF5tCeD1zrg9vqViOB266Pct1gDm+ycu12epAKZxiPNxJwAV4Ai4A1yCXgHPoD5AI6QT1AqbBQxDpsFKCRiHeQAQIUJIjAlCUSpMhakwFabCVJgKU2EqTIWpMBWmwpVMNKAoFIWiUBSKQlEoCkWhKBSFolAUikJRKApFoSgUhaJQFIpWSoAK/6tw+c/TlUp/u9cfGchzX4wjIokAAAAASUVORK5CYII=",this.Ut=10,this.Yt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAIRJREFUeF7t1wERACAMAzGmCH2YxgII+SChx5rr7HPfCr8RgB/gBHRAuAOXEqQABShAAQqEE8AgBjGIQQyGETCGMIhBDGIQgxgMJ4BBDGIQgxgMI2ANYhCDGMQgBjEYTgCDGMQgBjEYRsAaxCAGMYhBDGIwnAAGMYhBDGIwjIA1iME6gx9FmaWBniGxBgAAAABJRU5ErkJggg==",this.Ht=16,this.et=null,this.Gt=null,this.X=null,this.Z=null,this.H=[],this.Zt=[],this.G=[],this.J=null,this.$=this.$.bind(this),this.tt=this.tt.bind(this),this.it=this.it.bind(this);t=this.C.getInteracations();this.ht={},this.ht.enableDrag=t.enableDrag,this.ht.enableRotate=t.enableRotate,this.ht.enableTilt=t.enableTilt,this.ht.enableZoom=t.enableZoom,this.nt=new $,this.st=new ui,this.ot()}var t,n,s;return t=i,(n=[{key:"operationType",get:function(){return this.Pt},set:function(t){if(this.X&&this.X.type===fengmap.FMType.IMAGE_MARKER&&this.X.oldUrl&&(this.X.url=this.X.oldUrl),this.Pt=t,this.Gt=null,this.et=null,"edit"!==this.Pt){for(var i=0;i<this.H.length;i++)this.H[i].remove();this.H.length=0,this.X=null}}},{key:"markers",get:function(){for(var t=[this.C.getBuilding(this.C.getMapOptions().mapID)],i=this.C.getBuildings(),n=0;n<i.length;n++)t.push(i[n]);for(var s=[],e=0;e<t.length;e++)for(var r=t[e].children,h=0;h<r.length;h++)for(var o=r[h].getLayers(fengmap.FMType.IMAGE_MARKER|fengmap.FMType.POLYGON_MARKER),u=0;u<o.length;u++)for(var a=o[u].children,f=0;f<a.length;f++)void 0!==a[f].operationType&&(a[f].buildingID=t[e].buildingID,a[f].markerType=a[f].type,s.push(a[f]));for(var c=this.C.getMarkerGroup().children,l=0;l<c.length;l++)c[l].type===fengmap.FMType.LINE_MARKER&&void 0!==c[l].operationType&&(c[l].markerType=c[l].type,s.push(c[l]));return s}},{key:"setStyle",value:function(t,i){"lineStyle"===t?this.F=i:"polygonStyle"===t?this.D=i:"pointStyle"===t?void 0!==(this.L=i).rectColor&&(this.W=i.rectColor):"centerStyle"===t?(this.V=i.url,void 0!==i.size&&(this.Ft=i.size)):"editStyle"===t?(this.Dt=i.url,void 0!==i.size&&(this.Vt=i.size)):"pointRectColor"===t?(this.W=i,this.L.rectColor=i):"selectedURL"===t?this.Yt=i.selectedURL:"newPointStyle"===t?(this.Nt=i.url,void 0!==i.size&&(this.Ut=i.size)):"nodeStyle"===t&&(void 0!==i.editStyle&&(this.Dt=i.editStyle.url,void 0!==i.editStyle.size)&&(this.Vt=i.editStyle.size),void 0!==i.selectedStyle&&(this.Yt=i.selectedStyle.url,void 0!==i.selectedStyle.size)&&(this.Ht=i.selectedStyle.size),void 0!==i.newStyle)&&(this.Nt=i.newStyle.url,void 0!==i.newStyle.size)&&(this.Ut=i.newStyle.size)}},{key:"getStyle",value:function(t){return"lineStyle"===t?this.F:"polygonStyle"===t?this.D:"pointStyle"===t?Pi(Pi({},this.L),{},{rectColor:this.W}):"centerStyle"===t?{url:this.V,size:this.Ft}:"editStyle"===t?{url:this.Dt,size:this.Vt}:"pointRectColor"===t?this.W:"nodeStyle"===t?{editStyle:{url:this.Dt,size:this.Vt},selectedStyle:{url:this.Yt,size:this.Ht},newPointStyle:{url:this.Nt,size:this.Ut}}:void 0}},{key:"enable",value:function(){this.Lt=!0}},{key:"disable",value:function(){this.Lt=!1,this.cancel()}},{key:"delete",value:function(t){if(!t){if(this.deleteNode())return;if(!(t=this.X))return}this.cancel(),t.remove(),this.st.B({type:"deleted",target:t})}},{key:"deleteNode",value:function(){for(var t=!1,i=[],n=0;n<this.H.length;n++)"point"!==this.H[n].opetype2||this.H[n].isNew||this.H[n].isSelected?this.H[n].isSelected&&(t=!0):i.push({x:this.H[n].x,y:this.H[n].y});if(0<i.length)if("addPolygon"===this.X.operationType)3<=i.length?(this.X.points=i,this.edit(this.X),this.Xt(),this.st.B({type:"edited",target:this.X})):(this.delete(this.X),this.X=null);else if("addLine"===this.X.operationType)if(i.length<2)this.delete(this.X),this.X=null;else{var s=new fengmap.FMSegment;s.points=[];for(var e=0;e<i.length;e++)s.points.push({x:i[e].x,y:i[e].y,z:this.X.height});s.level=this.X.segments[0].level,s.buildingID=this.X.segments[0].buildingID,this.X.segments=[s],this.edit(this.X),this.Xt(),this.st.B({type:"edited",target:this.X})}return t}},{key:"add",value:function(t){var i=null;if(t.markerType===fengmap.FMType.IMAGE_MARKER){void 0===t.operationType&&(t.operationType="addPoint");var n,s=t.level,e=t.buildingID,e=(void 0===e&&(e=this.C.getMapOptions().mapID),this.C.getBuilding(e));for(n in this.L)void 0===t[n]&&(t[n]=this.L[n]);(i=new fengmap.FMImageMarker(t)).operationType=t.operationType,i.addTo(e.getFloor(s))}else if(t.markerType===fengmap.FMType.LINE_MARKER){for(var r in void 0===t.operationType&&(t.operationType="addLine"),this.F)void 0===t[r]&&(t[r]=this.F[r]);(i=new fengmap.FMLineMarker(t)).operationType=t.operationType,i.addTo(this.C)}else if(t.markerType===fengmap.FMType.POLYGON_MARKER){void 0===t.operationType&&(t.operationType="addPolygon");var h,e=t.level,s=t.buildingID,s=(void 0===s&&(s=this.C.getMapOptions().mapID),this.C.getBuilding(s));for(h in this.D)void 0===t[h]&&(t[h]=this.D[h]);(i=new fengmap.FMPolygonMarker(t)).operationType=t.operationType,i.addTo(s.getFloor(e))}return i}},{key:"edit",value:function(t){this.operationType="edit",this.X&&this.X.type===fengmap.FMType.IMAGE_MARKER&&(this.X.url=this.X.oldUrl);for(var i,n=0;n<this.H.length;n++)this.H[n].remove();this.H.length=0,this.X=null,t&&((this.X=t).type===fengmap.FMType.LINE_MARKER?(t.operationType||(t.operationType="addLine"),i=(i=t.segments[0].buildingID)||this.C.getMapOptions().mapID,this.ft({points:t.segments[0].points,height:t.height,info:{buildingID:i,level:t.segments[0].level}})):t.type===fengmap.FMType.POLYGON_MARKER?(t.operationType||(t.operationType="addPolygon"),this.ut({points:t.points,height:t.height,operationType:t.operationType,info:{buildingID:t.parent.parent.parent.buildingID,level:t.level}})):t.type===fengmap.FMType.IMAGE_MARKER&&(t.operationType||(t.operationType="addPoint"),this.J=null,this.ct(t)))}},{key:"cancel",value:function(){if("edit"===this.Pt){this.X&&this.X.type===fengmap.FMType.IMAGE_MARKER&&this.edit(null);for(var t=0;t<this.H.length;t++)this.H[t].remove();this.H.length=0,this.X=null}else this.Qt()}},{key:"dispose",value:function(){this.q.removeEventListener("mousedown",this.$,!1),this.q.removeEventListener("mousemove",this.tt,!1),this.q.removeEventListener("mouseup",this.it,!1)}},{key:"on",value:function(t,i){this.st.I(t,i)}}])&&Li(t.prototype,n),s&&Li(t,s),Object.defineProperty(t,"prototype",{writable:!1}),i}(),T=(Object.assign(Di.prototype,{ot:function(){this.q.addEventListener("mousedown",this.$,!1),this.q.addEventListener("mousemove",this.tt,!1),this.q.addEventListener("mouseup",this.it,!1)},yt:function(t,i){var n=t.clientX-this.q.getBoundingClientRect().left,t=t.clientY-this.q.getBoundingClientRect().top,s=new b;s.x=n/this.q.getBoundingClientRect().width*2-1,s.y=2*-(t/this.q.getBoundingClientRect().height)+1,s.z=.5,this.nt.setFromCamera(s,this.C.camera);var e,r=null,h=Ii(this.C.getRenderManager().getRenderList());try{for(h.s();!(e=h.n()).done;)for(var o=Oi(e.value,2),u=(o[0],o[1]),a=this.nt.intersectObject(u,!0),f=0;f<a.length;f++)a[f].object.mapNode&&(r=a[f].object)}catch(t){h.e(t)}finally{h.f()}null!==r&&r.mapNode?r.mapNode.type!==fengmap.FMType.LINE_MARKER?this.et={buildingID:r.mapNode.parent.parent.parent.buildingID,level:r.mapNode.level}:(n=r.mapNode.segments[0],this.et={buildingID:n.buildingID,level:n.level}):this.et={buildingID:this.C.getMapOptions().mapID,level:this.C.getLevel()},i&&i()},Xt:function(){for(var t=0;t<this.H.length;t++)this.H[t].isNew||"point"===this.H[t].opetype2&&(this.H[t].url=this.Dt,this.H[t].size=this.Vt,this.H[t].isSelected=!1)},zt:function(){for(var t=[],i=null,n=0;n<this.H.length;n++)"center"===this.H[n].opetype2?i=this.H[n]:this.H[n].isNew?this.H[n].remove():(this.H[n].url=this.Dt,this.H[n].size=this.Vt,this.H[n].isSelected=!1,t.push(this.H[n]));for(var s=this.H.length=0;s<t.length;s++){this.H.push(t[s]);var e=0,r=0;if("addPolygon"===this.X.operationType)r=s===t.length-1?(e=(t[s].x+t[0].x)/2,(t[s].y+t[0].y)/2):(e=(t[s].x+t[s+1].x)/2,(t[s].y+t[s+1].y)/2);else if(s===t.length-1)continue;var h=0,o=null,u=(o="addPolygon"===this.X.operationType?(h=this.X.height,this.X.parent.parent):(h=this.X.height,u=(u=this.X.segments[0].buildingID)||this.C.getMapOptions().mapID,this.C.getBuilding(u).getFloor(this.X.segments[0].level)),new ji({url:this.Nt,size:this.Ut,height:h,x:e,y:r,collision:!1,opetype:"point"}));u.isNew=!0,u.addTo(o),this.H.push(u)}this.H.push(i)},$:function(s){var e=this;this.Lt&&(null===this.Pt||"delete"===this.Pt?this.Zt.length=0:this.yt(s,function(){var t,i,n;2===s.button?"edit"!==e.Pt&&e.Qt():(t=s.clientX-e.q.getBoundingClientRect().left,i=s.clientY-e.q.getBoundingClientRect().top,"edit"===e.Pt?(e.Zt.length=0,(n=e.Jt(t,i))&&n.mapNode.visible?(e.Z=n.mapNode,e.bt(!1),"addPolygon"!==e.X.operationType&&"addLine"!==e.X.operationType||(e.Z.isNew?(e.Z.isNew=!1,e.Z.size=e.Vt,e.zt(),e.Z.url=e.Yt,e.Z.size=e.Ht,e.Z.isSelected=!0,e.xt(0,0)):(e.Xt(),"center"!==e.Z.opetype2&&(e.Z.url=e.Yt,e.Z.size=e.Ht,e.Z.isSelected=!0)))):(n=e.Kt(t,i))&&n.mapNode&&n.mapNode.type===fengmap.FMType.IMAGE_MARKER&&(e.Z=n.mapNode,e.edit(n.mapNode),e.bt(!1))):((n=fengmap.FMUtil.coordsScreenToMap(e.C,{x:t,y:i})).buildingID=e.et.buildingID,n.level=e.et.level,"addPoint"===e.Pt?(e.Mt(n),e.st.B({type:"drawn",target:e.Gt}),e.Gt=null,e.et=null):"addLine"===e.Pt||"addPolygon"===e.Pt||0===e.Zt.length?e.Zt.push(n):(e._t(n),e.st.B({type:"drawn",target:e.Gt}),e.Zt.length=0,e.Gt=null,e.et=null)))}))},tt:function(t){var i,n;this.Lt&&(i=t.clientX-this.q.getBoundingClientRect().left,t=t.clientY-this.q.getBoundingClientRect().top,i=fengmap.FMUtil.coordsScreenToMap(this.C,{x:i,y:t}),"edit"===this.Pt?(n=t=0,this.Z&&(t=i.x-this.Z.x,n=i.y-this.Z.y,this.Z.moveTo({animate:!1,x:i.x,y:i.y})),this.Z&&this.Z.opetype2&&this.xt(t,n),null!==this.X&&null!==this.Z&&this.st.B({type:"drawing",target:this.X})):("addLine"===this.Pt?this.Rt(i):"addPolygon"===this.Pt?this.jt(i):this._t(i),null!==this.Gt&&(this.Gt.operationType=this.Pt,this.st.B({type:"drawing",target:this.Gt}))))},it:function(t){var i,n;this.Lt&&(i=t.clientX-this.q.getBoundingClientRect().left,t=t.clientY-this.q.getBoundingClientRect().top,"delete"===this.Pt?(n=this.Kt(i,t))&&n.mapNode&&this.delete(n.mapNode):"edit"===this.Pt&&(null===this.Z?(n=this.Kt(i,t))&&n.mapNode?this.edit(n.mapNode):n||this.edit(null):(this.bt(!0),this.Z=null,this.st.B({type:"edited",target:this.X}))))},xt:function(t,i){for(var n=[],s=null,e=[],r=0;r<this.H.length;r++)"center"===this.H[r].opetype2?s=this.H[r]:e.push(this.H[r]);for(var h,o,u=[],a=0;a<e.length;a++)u.push(e[a]),e[a].isNew?(o=h=0,o=a===e.length-1?(h=(e[a-1].x+e[0].x)/2,(e[a-1].y+e[0].y)/2):(h=(e[a-1].x+e[a+1].x)/2,(e[a-1].y+e[a+1].y)/2),e[a].moveTo({animate:!1,x:h,y:o})):n.push({x:e[a].x,y:e[a].y});var f=this.Ot(n).center;if("center"===this.Z.opetype2){for(var c=0;c<n.length;c++)n[c].x=n[c].x+t,n[c].y=n[c].y+i;for(var l=0;l<e.length;l++)e[l].moveTo({animate:!1,x:e[l].x+t,y:e[l].y+i})}if("addLine"===this.X.operationType||"addPolygon"===this.X.operationType){var v=this.F.height;if(void 0===v&&(v=3),"addLine"===this.X.operationType)for(var d=0;d<n.length;d++)n[d].z=v;"center"!==this.Z.opetype2&&s.moveTo({animate:!1,x:f.x,y:f.y}),"addLine"===this.X.operationType?((y=new fengmap.FMSegment).points=n,y.level=this.et.level,y.buildingID=this.et.buildingID,y=Pi(Pi({},this.F),{},{segments:[y]}),(y=new fengmap.FMLineMarker(y)).userID=this.X.userID,y.operationType=this.X.operationType,y.addTo(this.C),this.X.remove(),this.X=y):this.X.points=n}else if("addRectangle"===this.X.operationType){"center"!==this.Z.opetype2&&s.moveTo({animate:!1,x:f.x,y:f.y});var y=Math.abs(e[0].x-e[1].x),p=Math.abs(e[0].y-e[1].y);this.X.points=fengmap.FMCalculator.rectangleBuilder(y,p,f)}else if("addCircle"===this.X.operationType){y=this.H[0].x-this.H[1].x,p=this.H[0].y-this.H[1].y,f=Math.sqrt(y*y+p*p);this.X.points=fengmap.FMCalculator.circleBuilder(f,{x:s.x,y:s.y},32)}else if("addEllipse"===this.X.operationType)if("center"===this.Z.opetype2){y=this.Ot(this.X.points);this.X.points=this.kt({x:s.x,y:s.y},y.xradius,y.yradius)}else{for(var m=null,A=null,g=0;g<e.length;g++)"xradius"===e[g].opetype2?m=Math.abs(e[g].x-s.x):A=Math.abs(e[g].y-s.y);null!==m&&null!==A&&(this.X.points=this.kt({x:s.x,y:s.y},m,A))}},Jt:function(t,i){for(var n=new E,s=(n.x=t/this.q.getBoundingClientRect().width*2-1,n.y=2*-(i/this.q.getBoundingClientRect().height)+1,this.nt.setFromCamera(n,this.C.camera),[]),e=0;e<this.H.length;e++)s.push(this.H[e].getRenderNode());t=this.nt.intersectObjects(s,!0);return 0<t.length?t[0].object:null},Kt:function(o,u){var t,a=this,i=new E,n=(i.x=o/this.q.getBoundingClientRect().width*2-1,i.y=2*-(u/this.q.getBoundingClientRect().height)+1,this.nt.setFromCamera(i,this.C.camera),[]),s=Ii(this.C.getRenderManager().getRenderList());try{for(s.s();!(t=s.n()).done;){var e=Oi(t.value,2),r=e[0],h=e[1],f=r.split("%A%B%C%D")[2];if(f===""+fengmap.FMType.LINE_MARKER||f===""+fengmap.FMType.IMAGE_MARKER||f===""+fengmap.FMType.POLYGON_MARKER)for(var c=h.children,l=0;l<c.length;l++){var v=c[l].mapNode;v&&void 0!==v.operationType&&n.push(c[l])}}}catch(t){s.e(t)}finally{s.f()}i=this.nt.intersectObjects(n,!0);return 0<i.length&&d(i)?d(i).object:null;function d(t){var i=fengmap.FMUtil.coordsScreenToMap(a.C,{x:o,y:u});if(1===t.length)return t[0];for(var n,s,e=null,r=null,h=0;h<t.length;h++)t[h].object.mapNode&&(s=t[h].object.mapNode.bound.center.x-i.x,n=t[h].object.mapNode.bound.center.y-i.y,0===h?(e=t[h],r=Math.sqrt(s*s+n*n)):(s=Math.sqrt(s*s+n*n))<r&&(r=s,e=t[h]));return e}},_t:function(t){"addCircle"===this.Pt?this.wt(t):"addEllipse"===this.Pt?this.St(t):"addRectangle"===this.Pt&&this.Et(t)},jt:function(t,i){var n=[],s=null;if(i){null!==this.X&&this.X.remove();for(var e=0;e<t.length;e++)n.push({x:this.C.x+t[e].x,y:this.C.y-t[e].y})}else{if(0===this.Zt.length)return;null!==this.Gt&&(s=this.Gt.userID,this.Gt.remove());for(var r=0;r<this.Zt.length;r++)n.push({x:this.Zt[r].x,y:this.Zt[r].y});if(t)n.push({x:t.x,y:t.y});else if(2===n.length)return}var h,o=this.D,u={};for(h in o)u[h]=o[h];u.points=n;var a,f=new fengmap.FMPolygonMarker(u);i?(a=this.C.getBuilding(this.et.buildingID).getFloor(this.et.level),f.addTo(a)):(a=this.C.getBuilding(this.Zt[0].buildingID).getFloor(this.Zt[0].level),f.addTo(a)),f.operationType=this.Pt,i?this.X=f:(this.Gt=f,null!==s&&(this.Gt.userID=s))},Rt:function(t,i){var n,s=new fengmap.FMSegment,e=(s.points=[],null),r={},h=this.F;for(n in h)r[n]=h[n];if(void 0===r.height&&(r.height=3),i){null!==this.X&&this.X.remove();for(var o=0;o<t.length;o++)s.points.push({x:this.C.x+t[o].x,y:this.C.y-t[o].y,z:r.height})}else{if(0===this.Zt.length)return;if(null!==this.Gt&&(e=this.Gt.userID,this.Gt.remove(),!t)&&1===this.Zt.length)return;for(var u=0;u<this.Zt.length;u++)s.points.push({x:this.Zt[u].x,y:this.Zt[u].y,z:r.height});t&&s.points.push({x:t.x,y:t.y,z:r.height})}i?(s.level=this.et.level,s.buildingID=this.et.buildingID):(s.level=this.Zt[0].level,s.buildingID=this.Zt[0].buildingID),r.segments=[s];var a=new fengmap.FMLineMarker(r);a.operationType=this.Pt,a.addTo(this.C),i?this.X=a:(this.Gt=a,null!==e&&(this.Gt.userID=e))},Et:function(t,i){var n=[],s=null;if(t||i){if(0===this.Zt.length)return;if(i)null!==this.X&&this.X.remove();else if(null!==this.Gt&&(s=this.Gt.userID,this.Gt.remove(),!t))return this.Zt.length=0,void(this.Gt=null);var e=this.Zt[0],n=[e,{x:t.x,y:e.y},t,{x:e.x,y:t.y}]}else if("edit"===this.Pt)n=this.J,null!==this.X&&this.X.remove();else if(null!==this.Gt)return this.Gt.remove(),this.Zt.length=0,void(this.Gt=null);if(0!==n.length){var r,h=this.D,o={};for(r in h)o[r]=h[r];o.points=n;e=new fengmap.FMPolygonMarker(o);i?(n=this.C.getBuilding(this.et.buildingID).getFloor(this.et.level),e.addTo(n)):(n=this.C.getBuilding(this.Zt[0].buildingID).getFloor(this.Zt[0].level),e.addTo(n)),e.operationType=this.Pt,!t&&!i||i?this.X=e:(this.Gt=e,null!==s&&(this.Gt.userID=s))}},St:function(t,i){var n=null,s=null;if(i)null!==this.X&&this.X.remove(),n=t;else{if(0===this.Zt.length)return;if(null!==this.Gt&&(s=this.Gt.userID,this.Gt.remove()),!t)return this.Zt.length=0,void(this.Gt=null);var e=this.Zt[0],r=Math.abs(t.x-e.x),t=Math.abs(t.y-e.y),n=t<r?this.kt(e,r,r/2):this.kt(e,t/2,t)}for(var h=[],o=0;o<n.length;o++)h.push({x:n[o].x,y:n[o].y});var u,a=this.D,f={};for(u in a)f[u]=a[u];f.points=h;r=new fengmap.FMPolygonMarker(f);i?(e=this.C.getBuilding(this.et.buildingID).getFloor(this.et.level),r.addTo(e)):(t=this.C.getBuilding(this.Zt[0].buildingID).getFloor(this.Zt[0].level),r.addTo(t)),r.operationType=this.Pt,i?this.X=r:(this.Gt=r,null!==s&&(this.Gt.userID=s))},kt:function(t,i,n){return new s(t.x,t.y,i,n,0,2*Math.PI,!1,0).getPoints(32)},wt:function(t,i){if(0!==this.Zt.length){var n=null;if(i)null!==this.X&&this.X.remove();else if(null!==this.Gt&&(n=this.Gt.userID,this.Gt.remove(),!t))return this.Zt.length=0,void(this.Gt=null);var s,e=this.Zt[0],t=Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)),r=this.D,h={};for(s in r)h[s]=r[s];h.points=fengmap.FMCalculator.circleBuilder(t,this.Zt[0],32);var o,t=new fengmap.FMPolygonMarker(h);i?(o=this.C.getBuilding(this.et.buildingID).getFloor(this.et.level),t.addTo(o)):(o=this.C.getBuilding(e.buildingID).getFloor(e.level),t.addTo(o)),t.operationType=this.Pt,i?this.X=t:(this.Gt=t,null!==n&&(this.Gt.userID=n))}},Mt:function(t){var i,n={},s=this.L;for(i in s)n[i]=s[i];n.x=t.x,n.y=t.y,n.buildingID=this.et.buildingID;var t=this.C.getBuilding(this.et.buildingID).getFloor(this.et.level),e=new fengmap.FMImageMarker(n);e.addTo(t),e.operationType=this.Pt,this.Gt=e},Qt:function(){var t;"addLine"===this.Pt?this.Rt():"addCircle"===this.Pt?this.wt():"addRectangle"===this.Pt?this.Et():"addPolygon"===this.Pt?this.jt():"addEllipse"===this.Pt&&this.St(),"addLine"!==this.Pt&&"addPolygon"!==this.Pt||(t=!0,"addLine"===this.Pt?this.Zt.length<2&&(t=!1):"addPolygon"===this.Pt&&this.Zt.length<3&&(t=!1),null!==this.Gt&&(this.Gt.operationType=this.Pt,t&&(this.st.B({type:"drawn",target:this.Gt}),this.et=null),this.Zt.length=0,this.Gt=null))},Tt:function(t,i){for(var n=0;n<t.length;n++){var s=(s=t[n].optype)||"point",e=this.Dt,r=this.Vt,e=("center"===s&&(e=this.V,r=this.Ft),t[n].isNew&&(e=this.Nt,r=this.Ut),new ji({url:e,size:r,height:i.height,x:t[n].x,y:t[n].y,collision:!1,opetype:s})),r=this.C.getBuilding(i.info.buildingID).getFloor(i.info.level);e.isNew=t[n].isNew,e.addTo(r),void 0!==this._&&("move"===this._?"center"!==s&&(e.visible=!1):"edit"===this._&&"center"===s&&(e.visible=!1)),this.H.push(e)}},ft:function(t){for(var i=[],n=(this.J=t.points,this.Ot(t.points).center),s=this.G.length=0;s<t.points.length;s++){i.push(t.points[s]),this.G.push({x:t.points[s].x-n.x,y:t.points[s].y-n.y});var e,r;s<t.points.length-1&&(e=(t.points[s].x+t.points[s+1].x)/2,r=(t.points[s].y+t.points[s+1].y)/2,i.push({x:e,y:r,isNew:!0}),this.G.push({x:e-n.x,y:r-n.y}))}i.push({x:n.x,y:n.y,optype:"center"}),this.Tt(i,t)},Ot:function(t){for(var i,n,h=null,o=null,u=null,a=null,f=[],s=0;s<t.length;s++)"addPolygon"!==this.X.operationType&&"addLine"!==this.X.operationType||(f.push(t[s]),"addPolygon"===this.X.operationType?(n=i=0,n=s===t.length-1?(i=(t[s].x+t[0].x)/2,(t[s].y+t[0].y)/2):(i=(t[s].x+t[s+1].x)/2,(t[s].y+t[s+1].y)/2),f.push({x:i,y:n})):s<t.length-1&&f.push({x:(t[s].x+t[s+1].x)/2,y:(t[s].y+t[s+1].y)/2})),0===s?(h=t[s].x,o=t[s].y,u=t[s].x,a=t[s].y):(h>t[s].x&&(h=t[s].x),o>t[s].y&&(o=t[s].y),u<t[s].x&&(u=t[s].x),a<t[s].y&&(a=t[s].y));return"addPolygon"!==this.X.operationType&&"addLine"!==this.X.operationType||function t(){var i={x:(h+u)/2,y:(o+a)/2};var n=!0;for(var s=0;s<f.length;s++){var e=f[s].x-i.x,r=f[s].y-i.y,e=e*e+r*r;if(e<50){n=!1;break}}n||(o-=2,t())}(),{center:{x:(h+u)/2,y:(o+a)/2},xradius:Math.abs(u-h)/2,yradius:Math.abs(a-o)/2}},ut:function(t){var i,n=[];if(void 0===t.operationType&&(t.operationType="addPolygon"),"addPolygon"===t.operationType){this.J=t.points;for(var s=this.Ot(t.points).center,e=this.G.length=0;e<t.points.length;e++){n.push(t.points[e]),this.G.push({x:t.points[e].x-s.x,y:t.points[e].y-s.y});var r=0,h=0,h=e===t.points.length-1?(r=(t.points[e].x+t.points[0].x)/2,(t.points[e].y+t.points[0].y)/2):(r=(t.points[e].x+t.points[e+1].x)/2,(t.points[e].y+t.points[e+1].y)/2);n.push({x:r,y:h,isNew:!0}),this.G.push({x:r-s.x,y:h-s.y})}n.push({x:s.x,y:s.y,optype:"center"})}else"addRectangle"===t.operationType?(this.J=t.points,n.push(t.points[0]),n.push(t.points[2]),n.push({x:(t.points[0].x+t.points[2].x)/2,y:(t.points[0].y+t.points[2].y)/2,optype:"center"}),this.G.length=0,this.G.push({x:Math.abs(t.points[0].x-t.points[2].x)/2,y:Math.abs(t.points[0].y-t.points[2].y)/2})):"addCircle"!==t.operationType&&"addEllipse"!==t.operationType||(i=this.Ot(t.points),this.J=i,n.push({x:i.center.x,y:i.center.y,optype:"center"}),n.push({x:i.center.x,y:i.center.y+i.yradius,optype:"yradius"}),"addEllipse"===t.operationType&&n.push({x:i.center.x+i.xradius,y:i.center.y,optype:"xradius"}));this.Tt(n,t)},ct:function(i){var n,s=this;i.editUrl?(i.oldUrl=i.url,i.url=i.editUrl):((n=new Image).crossOrigin="Anonymous",n.onload=function(){var t=s.Wt(n).toDataURL();i.oldUrl=i.url,i.editUrl=t,i.url=t},n.src=i.url)},Wt:function(t){var i=document.createElement("canvas"),n=(i.width=64,i.height=64,i.getContext("2d"));return n.lineWidth="5",n.strokeStyle=this.W,n.drawImage(t,0,0,64,64),n.rect(0,0,i.width,i.height),n.stroke(),i},bt:function(t){var i=this.C.getInteracations();t?(i.enableDrag=this.ht.enableDrag,i.enableRotate=this.ht.enableRotate,i.enableTilt=this.ht.enableTilt,i.enableZoom=this.ht.enableZoom):(i.enableDrag=t,i.enableRotate=t,i.enableTilt=t,i.enableZoom=t)}}),{NONE:0,EXTRUDE_MARKER:2,FM3DTILE_LAYER:4,IMAGE_MARKER:8,LOCATION_MARKER:16,POLYGON_MARKER:32,TEXT_MARKER:64,LINE_MARKER:128,LINE3D_MARKER:256,HEAT_MAP_MARKER:512,EXTENT:1024,EXTERNAL_MODEL:2048,MODEL:4096,FACILITY:8192,LABEL:16384,DYNAMIC_MODEL_MARKER:32768,DOM_MARKER:65536,SPHERE_MARKER:1<<17,CAD_LAYER:1<<18,EXTENT_LAYER:1<<20,EXTERNAL_MODEL_LAYER:1<<21,MODEL_LAYER:1<<22,FACILITY_LAYER:1<<23,LABEL_LAYER:1<<24,MARKER_GROUP:1<<25,FLOW_LINE_LAYER:1<<27,FLOW_LINE_MARKER:1<<27,FIRE_MARKER:1<<28,WALL_MARKER:1<<29,TUBE_MARKER:1<<30}),Vi=(T.LAYER_NODE_TYPE=new Map,T.LAYER_NODE_TYPE.set(T.EXTENT_LAYER,T.EXTENT),T.LAYER_NODE_TYPE.set(T.EXTERNAL_MODEL_LAYER,T.EXTERNAL_MODEL),T.LAYER_NODE_TYPE.set(T.MODEL_LAYER,T.MODEL),T.LAYER_NODE_TYPE.set(T.FACILITY_LAYER,T.FACILITY),T.LAYER_NODE_TYPE.set(T.LABEL_LAYER,T.LABEL),T.LAYER_NODE_TYPE.set(T.DOM_MARKER,T.DOM_MARKER),T.LAYER_NODE_TYPE.set(T.DYNAMIC_MODEL_MARKER,T.DYNAMIC_MODEL_MARKER),T.LAYER_NODE_TYPE.set(T.EXTRUDE_MARKER,T.EXTRUDE_MARKER),T.LAYER_NODE_TYPE.set(T.HEAT_MAP_MARKER,T.HEAT_MAP_MARKER),T.LAYER_NODE_TYPE.set(T.LINE_MARKER,T.LINE_MARKER),T.LAYER_NODE_TYPE.set(T.LOCATION_MARKER,T.LOCATION_MARKER),T.LAYER_NODE_TYPE.set(T.POLYGON_MARKER,T.POLYGON_MARKER),T.LAYER_NODE_TYPE.set(T.TEXT_MARKER,T.TEXT_MARKER),T.LAYER_NODE_TYPE.set(T.IMAGE_MARKER,T.IMAGE_MARKER),T.LAYER_NODE_TYPE.set(T.FLOW_LINE_LAYER,T.FLOW_LINE_MARKER),T.LAYER_NODE_TYPE.set(T.FIRE_MARKER,T.FIRE_MARKER),T.LAYER_NODE_TYPE.set(T.WALL_MARKER,T.WALL_MARKER),T.LAYER_NODE_TYPE.set(T.TUBE_MARKER,T.TUBE_MARKER),T.LAYER_NODE_TYPE.set(T.LINE3D_MARKER,T.LINE3D_MARKER),T.LAYER_NODE_TYPE.set(T.SPHERE_MARKER,T.SPHERE_MARKER),T.LAYER_NODE_TYPE.set(T.CAD_LAYER,T.CAD_LAYER),T),Ni=function(t,i,n){n=n||2;var s,e,r,h,o,u=i&&i.length,a=u?i[0]*n:t.length,f=Ui(t,0,a,n,!0),c=[];if(f&&f.next!==f.prev){if(u&&(f=function(t,i,n,s){var e,r,h,o,u=[];for(e=0,r=i.length;e<r;e++)o=i[e]*s,h=e<r-1?i[e+1]*s:t.length,(o=Ui(t,o,h,s,!1))===o.next&&(o.steiner=!0),u.push(function(t){var i=t,n=t;for(;(i.x<n.x||i.x===n.x&&i.y<n.y)&&(n=i),i=i.next,i!==t;);return n}(o));for(u.sort(Hi),e=0;e<u.length;e++)!function(t,i){(i=function(t,i){var n,s=i,e=t.x,r=t.y,h=-1/0;do{if(r<=s.y&&r>=s.next.y&&s.next.y!==s.y){var o=s.x+(r-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(o<=e&&h<o){if((h=o)===e){if(r===s.y)return s;if(r===s.next.y)return s.next}n=s.x<s.next.x?s:s.next}}}while(s=s.next,s!==i);if(!n)return null;if(e!==h){var u,a=n,f=n.x,c=n.y,l=1/0;for(s=n;e>=s.x&&s.x>=f&&e!==s.x&&Zi(r<c?e:h,r,f,c,r<c?h:e,r,s.x,s.y)&&(u=Math.abs(r-s.y)/(e-s.x),Ki(s,t))&&(u<l||u===l&&(s.x>n.x||s.x===n.x&&function(t,i){return C(t.prev,t,i.prev)<0&&C(i.next,t,t.next)<0}(n,s)))&&(n=s,l=u),(s=s.next)!==a;);}return n}(t,i))&&(t=_i(i,t),B(i,i.next),B(t,t.next))}(u[e],n),n=B(n,n.next);return n}(t,i,f,n)),t.length>80*n){for(var l=s=t[0],v=e=t[1],d=n;d<a;d+=n)(r=t[d])<l&&(l=r),(h=t[d+1])<v&&(v=h),s<r&&(s=r),e<h&&(e=h);o=0!==(o=Math.max(s-l,e-v))?1/o:0}Yi(f,c,n,l,v,o)}return c};function Ui(t,i,n,s,e){var r,h;if(e===0<function(t,i,n,s){for(var e=0,r=i,h=n-s;r<n;r+=s)e+=(t[h]-t[r])*(t[r+1]+t[h+1]),h=r;return e}(t,i,n,s))for(r=i;r<n;r+=s)h=Wi(r,t[r],t[r+1],h);else for(r=n-s;i<=r;r-=s)h=Wi(r,t[r],t[r+1],h);return h&&Xi(h,h.next)&&(qi(h),h=h.next),h}function B(t,i){if(!t)return t;i=i||t;var n,s=t;do{if(n=!1,s.steiner||!Xi(s,s.next)&&0!==C(s.prev,s,s.next))s=s.next;else{if(qi(s),(s=i=s.prev)===s.next)break;n=!0}}while(n||s!==i);return i}function Yi(t,i,n,s,e,r,h){if(t){if(!h&&r){for(var o=t,u=s,a=e,f=r,c=o;null===c.z&&(c.z=Gi(c.x,c.y,u,a,f)),c.prevZ=c.prev,c.nextZ=c.next,(c=c.next)!==o;);c.prevZ.nextZ=null,c.prevZ=null;var l,v,d,y,p,m,A,g,b=c,M=1;do{for(v=b,p=b=null,m=0;v;){for(m++,d=v,l=A=0;l<M&&(A++,d=d.nextZ);l++);for(g=M;0<A||0<g&&d;)0!==A&&(0===g||!d||v.z<=d.z)?(v=(y=v).nextZ,A--):(d=(y=d).nextZ,g--),p?p.nextZ=y:b=y,y.prevZ=p,p=y;v=d}}while(p.nextZ=null,M*=2,1<m)}for(var w,E,S=t;t.prev!==t.next;)if(w=t.prev,E=t.next,r?function(t,i,n,s){var e=t.prev,r=t,h=t.next;if(0<=C(e,r,h))return;var o=(e.x<r.x?e.x<h.x?e:h:r.x<h.x?r:h).x,u=(e.y<r.y?e.y<h.y?e:h:r.y<h.y?r:h).y,a=(e.x>r.x?e.x>h.x?e:h:r.x>h.x?r:h).x,f=(e.y>r.y?e.y>h.y?e:h:r.y>h.y?r:h).y,c=Gi(o,u,i,n,s),l=Gi(a,f,i,n,s),v=t.prevZ,d=t.nextZ;for(;v&&v.z>=c&&d&&d.z<=l;){if(v!==t.prev&&v!==t.next&&Zi(e.x,e.y,r.x,r.y,h.x,h.y,v.x,v.y)&&0<=C(v.prev,v,v.next))return;if(v=v.prevZ,d!==t.prev&&d!==t.next&&Zi(e.x,e.y,r.x,r.y,h.x,h.y,d.x,d.y)&&0<=C(d.prev,d,d.next))return;d=d.nextZ}for(;v&&v.z>=c;){if(v!==t.prev&&v!==t.next&&Zi(e.x,e.y,r.x,r.y,h.x,h.y,v.x,v.y)&&0<=C(v.prev,v,v.next))return;v=v.prevZ}for(;d&&d.z<=l;){if(d!==t.prev&&d!==t.next&&Zi(e.x,e.y,r.x,r.y,h.x,h.y,d.x,d.y)&&0<=C(d.prev,d,d.next))return;d=d.nextZ}return 1}(t,s,e,r):function(t){var i=t.prev,n=t,s=t.next;if(0<=C(i,n,s))return;var e=t.next.next;for(;e!==t.prev;){if(Zi(i.x,i.y,n.x,n.y,s.x,s.y,e.x,e.y)&&0<=C(e.prev,e,e.next))return;e=e.next}return 1}(t))i.push(w.i/n),i.push(t.i/n),i.push(E.i/n),qi(t),t=E.next,S=E.next;else if((t=E)===S){h?1===h?Yi(t=function(t,i,n){var s=t;do{var e=s.prev,r=s.next.next}while(!Xi(e,r)&&Qi(e,s,s.next,r)&&Ki(e,r)&&Ki(r,e)&&(i.push(e.i/n),i.push(s.i/n),i.push(r.i/n),qi(s),qi(s.next),s=t=r),s=s.next,s!==t);return B(s)}(B(t),i,n),i,n,s,e,r,2):2===h&&function(t,i,n,s,e,r){var h=t;do{for(var o,u=h.next.next;u!==h.prev;){if(h.i!==u.i&&function(t,i){return t.next.i!==i.i&&t.prev.i!==i.i&&!function(t,i){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==i.i&&n.next.i!==i.i&&Qi(n,n.next,t,i))return 1}while(n=n.next,n!==t);return}(t,i)&&(Ki(t,i)&&Ki(i,t)&&function(t,i){var n=t,s=!1,e=(t.x+i.x)/2,r=(t.y+i.y)/2;for(;n.y>r!=n.next.y>r&&n.next.y!==n.y&&e<(n.next.x-n.x)*(r-n.y)/(n.next.y-n.y)+n.x&&(s=!s),n=n.next,n!==t;);return s}(t,i)&&(C(t.prev,t,i.prev)||C(t,i.prev,i))||Xi(t,i)&&0<C(t.prev,t,t.next)&&0<C(i.prev,i,i.next))}(h,u))return o=_i(h,u),h=B(h,h.next),o=B(o,o.next),Yi(h,i,n,s,e,r),Yi(o,i,n,s,e,r);u=u.next}}while(h=h.next,h!==t)}(t,i,n,s,e,r):Yi(B(t),i,n,s,e,r,1);break}}}function Hi(t,i){return t.x-i.x}function Gi(t,i,n,s,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*e)|t<<8))|t<<4))|t<<2))|t<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-s)*e)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function Zi(t,i,n,s,e,r,h,o){return 0<=(e-h)*(i-o)-(t-h)*(r-o)&&0<=(t-h)*(s-o)-(n-h)*(i-o)&&0<=(n-h)*(r-o)-(e-h)*(s-o)}function C(t,i,n){return(i.y-t.y)*(n.x-i.x)-(i.x-t.x)*(n.y-i.y)}function Xi(t,i){return t.x===i.x&&t.y===i.y}function Qi(t,i,n,s){var e=Ji(C(t,i,n)),r=Ji(C(t,i,s)),h=Ji(C(n,s,t)),o=Ji(C(n,s,i));return e!==r&&h!==o||0===e&&zi(t,n,i)||0===r&&zi(t,s,i)||0===h&&zi(n,t,s)||!(0!==o||!zi(n,i,s))}function zi(t,i,n){return i.x<=Math.max(t.x,n.x)&&i.x>=Math.min(t.x,n.x)&&i.y<=Math.max(t.y,n.y)&&i.y>=Math.min(t.y,n.y)}function Ji(t){return 0<t?1:t<0?-1:0}function Ki(t,i){return C(t.prev,t,t.next)<0?0<=C(t,i,t.next)&&0<=C(t,t.prev,i):C(t,i,t.prev)<0||C(t,t.next,i)<0}function _i(t,i){var n=new $i(t.i,t.x,t.y),s=new $i(i.i,i.x,i.y),e=t.next,r=i.prev;return(t.next=i).prev=t,(n.next=e).prev=n,(s.next=n).prev=s,(r.next=s).prev=r,s}function Wi(t,i,n,s){t=new $i(t,i,n);return s?(t.next=s.next,(t.prev=s).next.prev=t,s.next=t):(t.prev=t).next=t,t}function qi(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function $i(t,i,n){this.i=t,this.x=i,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function tn(t){return function(t){if(Array.isArray(t))return nn(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,i){var n;if(t)return"string"==typeof t?nn(t,i):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?nn(t,i):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nn(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,s=new Array(i);n<i;n++)s[n]=t[n];return s}var sn={area:function(t){for(var i=t.length,n=0,s=i-1,e=0;e<i;s=e++)n+=t[s].x*t[e].y-t[e].x*t[s].y;return.5*n},isClockWise:function(t){return sn.area(t)<0},triangulateShape:function(t,i){var n=[],s=[],e=[],r=(en(t),rn(n,t),t.length);i.forEach(en);for(var h=0;h<i.length;h++)s.push(r),r+=i[h].length,rn(n,i[h]);for(var o=Ni(n,s),u=0;u<o.length;u+=3)e.push(o.slice(u,u+3));return e},triangulate:function(t){(e=[]).push.apply(e,tn(t[0]));for(var i=[],n=1;n<t.length;n++){var s=[];s.push.apply(s,tn(t[n])),i.push(s)}if(!sn.isClockWise(e))for(var e=e.reverse(),r=0,h=i.length;r<h;r++){var o=i[r];sn.isClockWise(o)&&(i[r]=o.reverse())}return sn.triangulateShape(e,i)}};function en(t){var i,n=t.length;2<n&&(n=t[n-1],i=t[0],n.x===i.x)&&n.y===i.y&&t.pop()}function rn(t,i){for(var n=0;n<i.length;n++)t.push(i[n].x),t.push(i[n].y)}function hn(t){return(hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function on(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,i){if("object"!=hn(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!=hn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==hn(t)?t:String(t)}(s.key),s)}}function un(t,i,n){return i&&on(t.prototype,i),n&&on(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var P=1e-5,an=.001,fn=Math.PI/180,cn=180/Math.PI,T=un(function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function")});Object.assign(T.prototype,{qt:function(){return P},$t:function(){return fn},ti:function(){return cn},ii:function(t){return t<P&&-P<t},ni:function(t){return P<t},si:function(t){return t<-P},ei:function(t,i,n){i=(t.x-n.x)*(i.y-n.y)-(i.x-n.x)*(t.y-n.y);return Math.abs(i)<P?0:i},distanceOfTwoPoints:function(t,i){return t&&i?Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)):Number.NaN},distance:function(t,i){return Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2))},isPolygonContainPoint:function(t,i){for(var n=0,s=0;s<t.length;s++){var e=t[s].x,r=t[s].y,h=0,o=0,o=(s<t.length-1?(h=t[s+1].x,t[s+1]):(h=t[0].x,t[0])).y;if(e===i.x&&r===i.y||h===i.x&&o===i.y)return!0;if(o!==r){var u=e+(i.y-r)*(h-e)/(o-r);if(u===i.x)return!0;e!==h?u<=Math.max(e,h)&&u>=Math.min(e,h)&&u>i.x&&u!==e&&(u===h&&0<(r-i.y)*(o-i.y)?n+=2:n++):u<=Math.max(e,h)&&u>=Math.min(e,h)&&u>i.x&&(u===h&&0<(r-i.y)*(o-i.y)?n+=2:n++)}}return 0<n%2},isPolygonContainPoint2:function(t,i){var n=t.length;if(n<3)return!1;for(var s=n-1,e=0,r=0;r<n;r++){var h=t[r],o=t[s];h.y>i.y!=o.y>i.y&&i.x<(o.x-h.x)*(i.y-h.y)/(o.y-h.y)+h.x&&(h.y>o.y?e++:e--),s=r}return 0!=e},isPolygonInPolygon:function(t,i){var n=Object.assign([],t),s=Object.assign([],i);n.push(n[0]),s.push(s[0]);for(var e=0;e<n.length-1;e++){var r=n[e];if(!this.isPolygonContainPoint(s,r)&&!this.isPolygonContainPoint2(s,r))return!1}for(var h=0;h<n.length-1;h++)for(var o=0;o<s.length-1;o++)if(this.ri(n[h],n[h+1],s[o],s[o+1]).isintersect&&!this.hi(s[o],s[o+1],n[h])&&!this.hi(s[o],s[o+1],n[h+1]))return!1;return!0},oi:function(t,i,n,s){return!(Math.max(t.x,i.x)<Math.min(n.x,s.x)||Math.max(t.y,i.y)<Math.min(n.y,s.y)||Math.max(n.x,s.x)<Math.min(t.x,i.x)||Math.max(n.y,s.y)<Math.min(t.y,i.y))},ui:function(t,i,n,s){return!(Math.max(t.x,i.x)<Math.min(n.x,s.x)||Math.max(t.y,i.y)<Math.min(n.y,s.y)||Math.max(n.x,s.x)<Math.min(t.x,i.x)||Math.max(n.y,s.y)<Math.min(t.y,i.y)||0===this.ei(n,i,t)&&0===this.ei(i,s,t)||this.ei(n,i,t)*this.ei(i,s,t)<0||this.ei(t,s,n)*this.ei(s,i,n)<0)},ai:function(t,i,n){return!(t.x<i.x||t.y<i.y||t.x>n.x||t.y>n.y)},fi:function(t,i,n){var s=Math.min(i.x,n.x),e=Math.max(i.x,n.x),r=Math.min(i.y,n.y),i=Math.max(i.y,n.y);return!(t.x<s||t.x>e||t.y<r||t.y>i)},ci:function(t,i,n){var s=Math.min(n.x,i.x),e=Math.max(n.x,i.x),r=Math.min(n.y,i.y),n=Math.max(n.y,i.y);return!(t.x<s||t.x>e||t.y<r||t.y>n)},li:function(t,i,n){for(var s,e,r=!1,h=0;h<n;h++)s=i[h],e=i[(h+1)%n],(s.y<t.y&&e.y>=t.y||e.y<t.y&&s.y>=t.y)&&(s.x<=t.x||e.x<=t.x)&&s.x+(t.y-s.y)/(e.y-s.y)*(e.x-s.x)<t.x&&(r=!r);return r},vi:function(t,i,n){return(t.x-i.x)*(n.y-i.y)==(n.x-i.x)*(t.y-i.y)&&Math.min(i.x,n.x)<=t.x&&t.x<=Math.max(i.x,n.x)&&Math.min(i.y,n.y)<=t.y&&t.y<=Math.max(i.y,n.y)},di:function(t,i){return Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y))},yi:function(t,i){return(t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)},pi:function(t,i,n){var s=i.x,i=i.y,e=n.x,n=n.y,r=t.x,t=t.y,h=e-s,o=n-i,u=h*h+o*o,a=r-s,f=t-i,c=a*a+f*f;return this.ii(u)?this.ii(c)?0:c:(u=Math.sqrt(u),f=this.ni(o=(h=h/u)*a+(a=o/u)*f)?this.si(o-u)?(f=r-(s+o*h))*f+(u=t-(i+o*a))*u:(s=r-e)*s+(h=t-n)*h:c,this.ii(f)?0:f)},mi:function(t,i,n,s){var e,r=i.x,h=i.y,o=n.x,u=n.y,a=t.x,t=t.y,f=o-r,c=u-h,l=Math.sqrt(f*f+c*c),v=a-r,d=t-h,y=Math.sqrt(v*v+d*d);return this.ii(l)?(s.x=i.x,s.y=i.y,this.ii(e=y)?0:e):(e=this.ni(c=(f=f/l)*v+(v=c/l)*d)?this.si(c-l)?(l=a-(d=r+c*f),f=t-(r=h+c*v),h=Math.sqrt(l*l+f*f),s.x=d,s.y=r,h):(c=a-o,v=t-u,l=Math.sqrt(c*c+v*v),s.x=n.x,s.y=n.y,l):(s.x=i.x,s.y=i.y,y),this.ii(e)?0:e)},Ai:function(t,i){for(var n=0,s=0,e=0,r=0;r<i;r++){var h=t[r],o=t[(r+1)%i],u=(h.x*o.y-h.y*o.x)/2;n+=u,s+=u*(h.x+o.x)/3,e+=u*(h.y+o.y)/3}return{x:s/=n,y:e/=n}},gi:function(t){for(var i=sn.triangulate([t]),n=0,s=0,e=0,r=0;r<i.length;r++){var h=t[i[r][0]],o=t[i[r][1]],u=t[i[r][2]],a=o.x-h.x,f=o.y-h.y,c=u.x-h.x,a=(a*(u.y-h.y)-c*f)/2;n+=a,s+=(h.x+o.x+u.x)/3*a,e+=(h.y+o.y+u.y)/3*a}return{x:s/n,y:e/n}},bi:function(t,i){if(i<3)return 0;for(var n=0,s=0;s<i;++s){var e=t[s],r=t[(s+1)%i];n+=e.x*r.y-e.y*r.x}return Math.abs(n/2)},Mi:function(t,i,n,s,e){var r,h;return this.ui(t,i,n,s)?(r=(s.x-n.x)*(t.y-i.y)-(i.x-t.x)*(n.y-s.y),h=(t.y-n.y)*(i.x-t.x)*(s.x-n.x)+n.x*(s.y-n.y)*(i.x-t.x)-t.x*(i.y-t.y)*(s.x-n.x),e.x=h/r,r=(t.x-i.x)*(s.y-n.y)-(i.y-t.y)*(n.x-s.x),h=i.y*(t.x-i.x)*(s.y-n.y)+(s.x-i.x)*(s.y-n.y)*(t.y-i.y)-s.y*(n.x-s.x)*(i.y-t.y),e.y=h/r,1):0},wi:function(t,i,n,s,e){var r=Math.min(n.x,s.x),h=Math.max(n.x,s.x),o=Math.min(n.y,s.y),u=Math.max(n.y,s.y),a=t.x,f=t.y,c=n.x,l=n.y,v=s.x,d=s.y;if(90==i)return!(t.x<r||t.x>h||(h-r<an?t.y>=l&&t.y<=d||t.y>=d&&t.y<=l?(e.x=t.x,e.y=t.y,0):l<d&&t.x<l?(e.x=c,e.y=l,0):!(d<l&&t.x<d)||(e.x=v,e.y=d,0):(e.y=y=(d-l)/(v-c)*(a-c)+l,e.x=a,y<f||!this.ci(e,n,s))));if(270==i)return!(t.x<r||t.x>h||(Math.abs(h-r<an)?t.y>=l&&t.y<=d||t.y>=d&&t.y<=l?(e.x=t.x,e.y=t.y,0):l<d&&t.y>d?(e.x=v,e.y=d,0):!(d<l&&t.y>l)||(e.x=c,e.y=l,0):(e.y=y=(d-l)/(v-c)*(a-c)+l,e.x=a,f<y||!this.ci(e,n,s))));if(270!=i&&90!=i&&Math.abs(h-r<an)){var t=r,y=Math.tan(i/180*Math.PI)*(t-a)+f;if(e.y=y,e.x=t,this.ci(e,n,s))return h=y-f,0<(r=t-a)/Math.sqrt(r*r+h*h)*Math.cos(i/180*Math.PI)}return Math.abs(u-o<=an)?(y=o,t=1/Math.tan(i/180*Math.PI)*(y-f)+a,e.x=t,e.y=y,!!this.ci(e,n,s)&&(r=y-f,0<(h=t-a)/Math.sqrt(h*h+r*r)*Math.cos(i/180*Math.PI))):(t=f+(u=Math.tan(i/180*Math.PI))*((y=(l-f-((o=(d-l)/(v-c))*c-u*a))/(u-o))-a),e.x=y,e.y=t,!!this.ci(e,n,s)&&(h=y-a,r=t-f,Math.abs(h)<=an&&Math.abs(r)<=an||0<h/Math.sqrt(h*h+r*r)*Math.cos(i/180*Math.PI)))},Ei:function(t,i){return Math.abs(t.x-i.x)<P&&Math.abs(t.y-i.y)<P},Si:function(t,i,n,s){var e,r,h,o,u=t.x,a=t.y,f=i.x,c=i.y,l=n.x,v=n.y;return this.Ei(t,i)||this.Ei(t,n)?(s.x=u,s.y=a,!0):(h=Math.min(i.x,n.x),o=Math.max(i.x,n.x),e=Math.min(i.y,n.y),r=Math.max(i.y,n.y),Math.abs(f-l)<1e-5?(s.x=f,e<=(s.y=a)&&a<=r):Math.abs(c-v)<1e-5?(s.x=u,s.y=c,h<=u&&u<=o):(o=a+(e=-1/((v-c)/(l-f)))*((h=(c-a-((r=(v-c)/(l-f))*f-e*u))/(e-r))-u),s.x=h,s.y=o,!!this.ci(s,i,n)||!(!this.Ei(t,i)&&!this.Ei(t,n))))},xi:function(t,i){return{x:t.y*i.z-t.z*i.y,y:t.z*i.x-t.x*i.z,z:t.x*i.y-t.y*i.x}},Ri:function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},ji:function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},Oi:function(t,i){return t.x*i.x+t.y*i.y},Ii:function(t,i){return t.x*i.y-t.y*i.x},ki:function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},Ti:function(t,i){var n,s;return 0==t.x&&0==t.y||0==i.x&&0==i.y?0:(n={x:t.x,y:t.y,z:0},s={x:i.x,y:i.y,z:0},n=this.xi(n,s),s=this.Oi(t,i),s=Math.acos(s/(this.ki(t)*this.ki(i))),0<n.z?s/Math.PI*180:360-s/Math.PI*180)},Bi:function(t,i,n,s){for(var e=0;e<n.length;e++){var r=n[e],h=n[(e+1)%n.length];if(1==this.Mi(t,i,r,h,s))return!0}return!1},Ci:function(t,i,n,s,e){var r=Math.min(t.x,n.x,s.x),h=Math.max(t.x,n.x,s.x),o=Math.min(t.y,n.y,s.y),u=Math.max(t.y,n.y,s.y),h=Math.sqrt((h-r)*(h-r)+(u-o)*(u-o)),r=i/180*Math.PI,u=h*Math.cos(r)+t.x,o=h*Math.sin(r)+t.y;return 1==this.Mi(t,{x:u,y:o},n,s,e)},Pi:function(t){var i={x:null,y:null},n=0,s=0,e=t.length;1<t.length&&t[0].x===t[t.length-1].x&&t[0].y===t[t.length-1].y&&e--;for(var r=0;r<e;r++)n+=t[r].x,s+=t[r].y;return i.x=n/t.length,i.y=s/t.length,i},Li:function(t,i,n,s){var e=[],r=t.x-i,h=t.x+i,o=t.y-i,u=t.y+i,a=Math.min(n.x,s.x),f=Math.max(n.x,s.x),c=Math.min(n.y,s.y),l=Math.max(n.y,s.y);return f<r||h<a||l<o||u<c||(r=s.x-n.x,h=s.y-n.y,(o=(t=(r*(o=t.x-n.x)+h*(u=t.y-n.y))/(s=r*r+h*h))*t-(o*o+u*u-i*i)/s)<0)||(u=Math.sqrt(o),s={x:n.x-r*(i=-t+u),y:n.y-h*i},r={x:n.x-r*(o=-t-u),y:n.y-h*o},i!==o&&(a<=s.x&&s.x<=f&&c<=s.y&&s.y<=l&&e.push(s),a<=r.x)&&r.x<=f&&c<=r.y&&r.y<=l&&e.push(r)),e},Fi:function(t,i,n){var s,e={};if(t.x!=i.x)return s=i=(i.y-t.y)/(i.x-t.x),i=t.y-i*t.x,e.x=(+n.x- -1*s*n.y-s*i)/(s*s+1),e.y=(s*s*n.y- -1*s*n.x- -1*i)/(s*s+1),e;e.x=t.x,e.y=n.y},ri:function(t,i,n,s){var e,r,h,o,u={point:null,isintersect:!1};return this.distanceOfTwoPoints(t,n)<.001||this.distanceOfTwoPoints(t,s)<.001?(u.isintersect=!0,u.point=t):this.distanceOfTwoPoints(i,n)<.001||this.distanceOfTwoPoints(i,s)<.001?(u.isintersect=!0,u.point=i):(e={x:i.x-t.x,y:i.y-t.y},r={x:s.x-n.x,y:s.y-n.y},h={x:n.x-t.x,y:n.y-t.y},s={x:s.x-t.x,y:s.y-t.y},i={x:i.x-n.x,y:i.y-n.y},n={x:-h.x,y:-h.y},o=this.Ii(r,e),Math.abs(o)<=1e-5||this.Ii(h,e)*this.Ii(s,e)<=-5e-4&&this.Ii(n,r)*this.Ii(i,r)<-5e-4&&(s=this.Ii(r,h)/o,u.point={x:t.x+e.x*s,y:t.y+e.y*s},u.isintersect=!0)),u},Di:function(t,i,n){t.x===i.x&&(i.x=i.x+1),t.y===i.y&&(i.y=i.y+1),i.x===n.x&&(n.x=n.x+1),i.y===n.y&&(n.y=n.y+1);var s=i.x-t.x,t=i.y-t.y,e=n.x-i.x;return!(0<s*(n.y-i.y)-t*e)},getAngle:function(t){var i=t.p1,t=t.p2,n=t.x-i.x,t=t.y-i.y,i=Math.sqrt(n*n+t*t),i=Math.asin(Math.abs(t)/i);return 0<n&&0<t?i:n<0&&0<t?Math.PI-i:n<0&&t<0?Math.PI+i:0<n&&t<0?2*Math.PI-i:0==n&&0<t?i:0==n&&t<0?3*Math.PI/2:0<n&&0==t?i:n<0&&0==t?Math.PI:null},Vi:function(t){var i=this.distanceOfTwoPoints(t[0],t[1]),n=this.distanceOfTwoPoints(t[1],t[2]),t=this.distanceOfTwoPoints(t[0],t[2]),s=(i+n+t)/2;return Math.sqrt(s*(s-i)*(s-n)*(s-t))},Ni:function(t,i){var n,s,e,r,h;return this.mi(t,i[0],i[1],{})<1e-4||this.mi(t,i[0],i[2],{})<1e-4||this.mi(t,i[1],i[2],{})<1e-4||(r={x:i[1].x-i[0].x,y:i[1].y-i[0].y},n={x:i[0].x-i[2].x,y:i[0].y-i[2].y},s={x:i[2].x-i[1].x,y:i[2].y-i[1].y},h={x:t.x-i[0].x,y:t.y-i[0].y},e={x:t.x-i[1].x,y:t.y-i[1].y},t={x:t.x-i[2].x,y:t.y-i[2].y},i=this.Ii(r,h),r=this.Ii(s,e),h=this.Ii(n,t),P<i*r&&P<r*h)},Ui:function(t,i,n){var s=n.length,e={isintersect:!1,start:null,end:null,type:0,outer:null},r=[];if(this.Ni(t,n)&&(e.start=t),this.Ni(i,n)&&(e.end=i),null!=e.start&&null!=e.end)e.isintersect=!0,e.type=1;else{for(var h=(n[1].x+n[2].x)/2,o=(n[1].y+n[2].y)/2,u=1;u<s;u++){var a,f=this.ri(t,i,n[u-1],n[u]);if(f.isintersect){if(null!=e.start)return e.end=f.point,e.isintersect=!0,e.outer="end",a=this.Ti({x:h-n[0].x,y:o-n[0].y},{x:i.x-n[0].x,y:i.y-n[0].y}),e.type=0<(a=a<180?a:a-360)?2:3,e;if(null!=e.end)return e.start=f.point,e.isintersect=!0,e.outer="start",a=this.Ti({x:h-n[0].x,y:o-n[0].y},{x:t.x-n[0].x,y:t.y-n[0].y}),e.type=0<(a=a<180?a:a-360)?2:3,e;r.push(f)}}var c,l=this.ri(t,i,n[0],n[s-1]);if(l.isintersect){if(null!=e.start)return e.end=l.point,e.isintersect=!0,e.outer="end",c=this.Ti({x:h-n[0].x,y:o-n[0].y},{x:i.x-n[0].x,y:i.y-n[0].y}),e.type=0<(c=c<180?c:c-360)?2:3,e;if(null!=e.end)return e.start=l.point,e.isintersect=!0,e.outer="start",c=this.Ti({x:h-n[0].x,y:o-n[0].y},{x:t.x-n[0].x,y:t.y-n[0].y}),e.type=0<(c=c<180?c:c-360)?2:3,e;r.push(l)}2!=r.length||this.distanceOfTwoPoints(r[0].point,r[1].point)<.01||(this.distanceOfTwoPoints(r[0].point,t)<=this.distanceOfTwoPoints(r[0].point,i)?(e.start=r[0].point,e.end=r[1].point):(e.start=r[1].point,e.end=r[0].point),e.isintersect=!0,e.type=4)}return e},Yi:function(t,i,n){var s=n.length,e={isintersect:!1,start:null,end:null},r=[];if(this.Ni(t,n)&&(e.start=t),this.Ni(i,n)&&(e.end=i),null!=e.start&&null!=e.end)e.isintersect=!0;else{for(var h=1;h<s;h++){var o=this.ri(t,i,n[h-1],n[h]);if(o.isintersect){if(null!=e.start)return e.end=o.point,e.isintersect=!0,e;if(null!=e.end)return e.start=t,e.isintersect=!0,e;r.push(o)}}var u=this.ri(t,i,n[0],n[s-1]);if(u.isintersect){if(null!=e.start)return e.end=u.point,e.isintersect=!0,e;if(null!=e.end)return e.start=t,e.isintersect=!0,e;r.push(u)}2==r.length&&(e.start=(this.distanceOfTwoPoints(r[0].point,t)<=this.distanceOfTwoPoints(r[0].point,i)?r[0]:r[1]).point,e.end=(this.distanceOfTwoPoints(r[0].point,t)>this.distanceOfTwoPoints(r[0].point,i)?r[0]:r[1]).point,e.isintersect=!0)}return e},Hi:function(e,t){if(0==t.length)return[e];for(var i,n,s=this.Gi(t),r=[],h=(s.sort(function(t,i){var n=(t.Zi.x-e.Zi.x)*(t.Zi.x-e.Zi.x)+(t.Zi.y-e.Zi.y)*(t.Zi.y-e.Zi.y),s=(i.Zi.x-e.Zi.x)*(i.Zi.x-e.Zi.x)+(i.Zi.y-e.Zi.y)*(i.Zi.y-e.Zi.y),t=(t.Xi.x-e.Zi.x)*(t.Xi.x-e.Zi.x)+(t.Xi.y-e.Zi.y)*(t.Xi.y-e.Zi.y),i=(i.Xi.x-e.Zi.x)*(i.Xi.x-e.Zi.x)+(i.Xi.y-e.Zi.y)*(i.Xi.y-e.Zi.y);return(n<t?n:t)<(s<i?s:i)}),0),h=0;h<s.length;h++)this.distanceOfTwoPoints(s[h].Zi,s[h].Xi)<.01||(i=this.distanceOfTwoPoints(s[h].Zi,e.Zi),n=this.distanceOfTwoPoints(s[h].Xi,e.Zi),i<.01?e.Zi=s[h].Xi:n<.01?e.Zi=s[h].Zi:i<n?.1<this.distanceOfTwoPoints(e.Zi,s[h].Zi)&&(r.push({Qi:e.Qi,Zi:e.Zi,Xi:s[h].Zi,di:e.di,zi:e.zi}),e.Zi=s[h].Xi):.1<this.distanceOfTwoPoints(e.Zi,s[h].Xi)&&(r.push({Qi:e.Qi,Zi:e.Zi,Xi:s[h].Xi,di:e.di,zi:e.zi}),e.Zi=s[h].Zi),s.splice(h,1));return.1<this.distanceOfTwoPoints(e.Zi,e.Xi)&&r.push(e),r},Gi:function(t){var i=[];if(1==t.length)return t;for(var n=t[0],s=1;0<t.length;){if(s>=t.length){if(i.push(n),t.splice(0,1),t.length<1)break;n=t[0],s=1}if(1===t.length){i.push(n);break}this.hi(n.Zi,n.Xi,t[s].Zi)?(this.hi(n.Zi,n.Xi,t[s].Xi)||(n.Xi=t[s].Xi),t.splice(s,1)):this.hi(n.Zi,n.Xi,t[s].Xi)?(n.Zi=t[s].Zi,t.splice(s,1)):this.hi(t[s].Zi,t[s].Xi,n.Zi)?(n=(this.hi(t[s].Zi,t[s].Xi,n.Xi)||(t[s].Xi=n.Xi),t[s]),t.splice(s,1)):this.hi(t[s].Zi,t[s].Xi,n.Xi)?(t[s].Zi=n.Zi,n=t[s],t.splice(s,1)):s++}return i},hi:function(t,i,n){var s=t.x-n.x,e=t.y-n.y,r=i.x-n.x,h=i.y-n.y,o=this.distanceOfTwoPoints(t,n),n=this.distanceOfTwoPoints(i,n),t=this.distanceOfTwoPoints(t,i);return s*h-e*r<1e-5&&o+n-t<.001},Ji:function(t,i,n){var s=i.x-t.x,t=i.y-t.y,e=Math.sqrt(s*s+t*t);return{x:i.x+s/e*n,y:i.y+t/e*n}}});var ln=new T;function vn(t){return(vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dn(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,i){if("object"!=vn(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!=vn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==vn(t)?t:String(t)}(s.key),s)}}T=function(){function i(t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.C=t,this.q=this.C.getContainer(),this.Ki={border:"border:2px solid #0000FF",backgroundColor:null,opacity:null},this.ht={},this._i=[Vi.MODEL,Vi.FACILITY,Vi.LABEL,Vi.EXTERNAL_MODEL],this.Wi=0,this.qi=!1,this.$=this.$.bind(this),this.tt=this.tt.bind(this),this.it=this.it.bind(this),this.$i=null,this.tn=null,this.st=new ui,this.nn=new fengmap.FMSearchAnalyser({map:this.C}),this.ot()}var t,n,s;return t=i,(n=[{key:"dispose",value:function(){this.q.removeEventListener("mousedown",this.$,!1),document.removeEventListener("mousemove",this.tt,!1),document.removeEventListener("mouseup",this.it,!1),this.nn.dispose()}},{key:"boxStyle",get:function(){return this.Ki},set:function(t){this.Ki=t}},{key:"enable",get:function(){return this.qi},set:function(t){this.qi=t}},{key:"mouseKey",get:function(){return 0===this.Wi?"left":"right"},set:function(t){this.Wi="left"===t?0:2}},{key:"types",get:function(){return this._i},set:function(t){this._i=t}},{key:"on",value:function(t,i){this.st.I(t,i)}}])&&dn(t.prototype,n),s&&dn(t,s),Object.defineProperty(t,"prototype",{writable:!1}),i}(),Object.assign(T.prototype,{ot:function(){this.C.getRenderManager().renderer.domElement.style.left="0px",this.q.addEventListener("mousedown",this.$,!1),document.addEventListener("mousemove",this.tt,!1),document.addEventListener("mouseup",this.it,!1)},sn:function(t){return{x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().top}},$:function(t){var i,n;this.qi&&t.button===this.Wi&&(this.$i&&this.$i.parentNode&&(this.$i.parentNode.removeChild(this.$i),this.$i=null),i=this.sn(this.C.getRenderManager().renderer.domElement),n=t.clientX-i.x,t=t.clientY-i.y,this.tn={x:n,y:t},this.bt(!1),this.$i=document.createElement("div"),this.$i.style.cssText="position:absolute;top:"+t+"px;left:"+n+"px;width:0px;height:0px;"+this.Ki.border+";",this.q.appendChild(this.$i),this.Ki.backgroundColor&&(this.$i.style.backgroundColor=this.Ki.backgroundColor),void 0!==this.Ki.opacity)&&null!==this.Ki.opacity&&(this.$i.style.opacity=this.Ki.opacity)},tt:function(t){var i,n;this.qi&&null!==this.tn&&(i=this.sn(this.C.getRenderManager().renderer.domElement),n=t.clientX-i.x,t=t.clientY-i.y,n<this.tn.x&&(this.$i.style.left=n+"px"),t<this.tn.y&&(this.$i.style.top=t+"px"),this.$i.style.width=Math.abs(n-this.tn.x)+"px",this.$i.style.height=Math.abs(t-this.tn.y)+"px")},it:function(t){var A=this;if(this.qi&&null!==this.$i&&t.button===this.Wi){this.bt(!0);var g=this.en(),s=[],i=this.C.getMapOptions(),n=[],e=[];if(i.buildings&&0<i.buildings.length)for(var r=0;r<i.buildings.length;r++)!function(t){for(var t=A.C.getBuilding(t).bound,i=t.min,t=t.max,n=[{x:i.x,y:i.y},{x:i.x,y:t.y},{x:t.x,y:t.y},{x:t.x,y:i.y}],s=0;s<n.length;s++)if(ln.li(n[s],g,g.length))return 1;for(var e=0;e<g.length;e++)if(ln.li(g[e],n,n.length))return 1;for(var r=0;r<g.length-1;r++){for(var h=g[r],o=g[r+1],u=0;u<n.length-1;u++){var a=n[u],f=n[u+1];if(ln.ui(h,o,a,f))return 1}var c=n[n.length-1],l=n[0];if(ln.ui(h,o,l,c))return 1}for(var v=g[0],d=g[g.length-1],y=0;y<n.length-1;y++){var p=n[y],m=n[y+1];if(ln.ui(v,d,p,m))return 1}t=n[n.length-1],i=n[0];if(ln.ui(v,d,i,t))return 1}(i.buildings[r].bid)||(n.push(i.buildings[r].mid),e.push(i.buildings[r].bid));for(var h=[],o=0;o<this._i.length;o++){for(var u=new fengmap.FMSearchRequest,a=(u.levels=[this.C.getBuilding(i.buildingID).level],u.type=this._i[o],u.addCondition({polygon:g}),[]),f=0;f<e.length;f++)a.push({buildingID:e[f],levels:[this.C.getBuilding(e[f]).level]});0<a.length&&(u.buildings=a),h.push(u)}this.tn=null,this.$i.parentNode&&this.$i.parentNode.removeChild(this.$i),this.$i=null;var c,l=0;c=null,function i(){var n;l<h.length?(n=h[l],A.nn.query(n,function(t){s.push({type:n.type,children:t}),l++,c=setTimeout(i(),1)})):(null!==c&&clearTimeout(c),A.st.B({type:"boxselected",targets:s,coords:g}))}()}},bt:function(t){var i=this.C.getInteracations();t?(i.enableDrag=this.ht.enableDrag,i.enableRotate=this.ht.enableRotate,i.enableTilt=this.ht.enableTilt,i.enableZoom=this.ht.enableZoom):(this.ht.enableDrag=i.enableDrag,this.ht.enableRotate=i.enableRotate,this.ht.enableTilt=i.enableTilt,this.ht.enableZoom=i.enableZoom,i.enableDrag=t,i.enableRotate=t,i.enableTilt=t,i.enableZoom=t)},en:function(){for(var t=[],i=this.$i.getBoundingClientRect(),n=this.sn(this.C.getRenderManager().renderer.domElement),s=n.x,n=n.y,e=(t.push({x:i.left-s,y:i.top-n}),t.push({x:i.right-s,y:i.top-n}),t.push({x:i.right-s,y:i.bottom-n}),t.push({x:i.left-s,y:i.bottom-n}),[]),r=0;r<t.length;r++){var h=fengmap.FMUtil.coordsScreenToMap(this.C,t[r]);e.push(h)}return e}});function yn(t){return(yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pn(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,i){if("object"!=yn(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!=yn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==yn(t)?t:String(t)}(s.key),s)}}function mn(t,i,n){i=bn(i);var s=t,i=An()?Reflect.construct(i,n||[],bn(t).constructor):i.apply(t,n);if(i&&("object"===yn(i)||"function"==typeof i))return i;if(void 0!==i)throw new TypeError("Derived constructors may only return object or undefined");t=s;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function An(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(An=function(){return!!t})()}function gn(){return(gn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,i,n){var s=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=bn(t)););return t}(t,i);if(s)return(s=Object.getOwnPropertyDescriptor(s,i)).get?s.get.call(arguments.length<3?t:n):s.value}).apply(this,arguments)}function bn(t){return(bn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Mn(t,i){return(Mn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t})(t,i)}var wn=function(t){var i,n=s;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");function s(t){var i;if(this instanceof s)return(i=mn(this,s,[t])).info2=t,i.shapetype2="polygon",i.id=""+gi.generateUUID(),t.shapetype&&(i.shapetype2=t.shapetype),i.mapEdit=null,i;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&Mn(n,t),n=s,(t=[{key:"info",get:function(){return this.info2.id=this.id,this.info2.shapetype=this.shapetype2,this.info2.level=this.level,this.info2.buildingID=this.parent.parent.parent.buildingID,this.info2}},{key:"shapetype",get:function(){return this.shapetype2}},{key:"deleteMarker",value:function(){gn(bn(s.prototype),"remove",this).call(this),null!==this.mapEdit&&this.mapEdit.Ct(this.id)}}])&&pn(n.prototype,t),i&&pn(n,i),Object.defineProperty(n,"prototype",{writable:!1}),s}(fengmap.FMPolygonMarker);function En(t){return(En="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Sn(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,i){if("object"!=En(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!=En(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==En(t)?t:String(t)}(s.key),s)}}function xn(t,i,n){i=On(i);var s=t,i=Rn()?Reflect.construct(i,n||[],On(t).constructor):i.apply(t,n);if(i&&("object"===En(i)||"function"==typeof i))return i;if(void 0!==i)throw new TypeError("Derived constructors may only return object or undefined");t=s;if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function Rn(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Rn=function(){return!!t})()}function jn(){return(jn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,i,n){var s=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=On(t)););return t}(t,i);if(s)return(s=Object.getOwnPropertyDescriptor(s,i)).get?s.get.call(arguments.length<3?t:n):s.value}).apply(this,arguments)}function On(t){return(On=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function In(t,i){return(In=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t})(t,i)}var kn=function(t){var i,n=s;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");function s(t){var i;if(this instanceof s)return(i=xn(this,s,[t])).shapetype2="line",i.info2=t,i.id=""+gi.generateUUID(),i.mapEdit=null,i;throw new TypeError("Cannot call a class as a function")}return n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&In(n,t),n=s,(t=[{key:"info",get:function(){return this.info2.id=this.id,this.info2.points=this.points,this.info2.shapetype=this.shapetype,this.info2.level=this.segments[0].level,this.info2.buildingID=this.segments[0].buildingID,this.info2}},{key:"points",get:function(){return 0===this.segments.length?[]:this.segments[0].points}},{key:"shapetype",get:function(){return this.shapetype2}},{key:"deleteMarker",value:function(){jn(On(s.prototype),"remove",this).call(this),null!==this.mapEdit&&this.mapEdit.Ct(this.id)}}])&&Sn(n.prototype,t),i&&Sn(n,i),Object.defineProperty(n,"prototype",{writable:!1}),s}(fengmap.FMLineMarker);function Tn(t){return(Tn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Bn(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,i){if("object"!=Tn(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!=Tn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Tn(t)?t:String(t)}(s.key),s)}}var Cn=function(){function i(t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.C=t.map,this.q=this.C.getContainer(),this.rn=t.highlightColor,void 0===this.rn&&(this.rn="#FF0000"),this.hn=t.radius,void 0===this.hn&&(this.hn=1),this.tt=this.tt.bind(this),this.nt=new $,this.nt.params.Line.threshold=this.hn,this.st=new ui,this.on=[],this.un={},this.ot()}var t,n,s;return t=i,(n=[{key:"removeTargets",value:function(){for(var t=0;t<this.on.length;t++)this.on[t].parent.remove(this.on[t]);this.un={},this.on.length=0}},{key:"addTargets",value:function(t){this.removeTargets();for(var i=0;i<t.length;i++)if(t[i].type===fengmap.FMType.LINE_MARKER){for(var n=t[i].segments[0].points,s=[],e=0;e<n.length;e++)s.push(new b(n[e].x-this.C.x,n[e].z,-n[e].y+this.C.y));var r=new k({visible:!1}),r=new ei((new Kt).setFromPoints(s),r);r.myobject=t[i],r.mapNode=t[i],t[i].parent.scene.add(r),this.on.push(r)}else if(t[i].type===fengmap.FMType.POLYGON_MARKER&&t[i].getRenderNode()){this.un[""+t[i].id]={borderColor:t[i].borderColor,color:t[i].color};for(var h=t[i].points,o=[],u=0;u<h.length;u++)o.push(new b(h[u].x-this.C.x,t[i].height,-h[u].y+this.C.y));var r=new k({visible:!1}),a=new ei((new Kt).setFromPoints(o),r);a.myobject=t[i],a.mapNode=t[i],t[i].getRenderNode().parent.add(a),this.on.push(a)}}},{key:"dispose",value:function(){this.removeTargets(),this.on.length=0,this.q.removeEventListener("mousemove",this.tt,!1)}},{key:"radius",get:function(){return this.hn},set:function(t){this.hn=t,this.nt.params.Line.threshold=this.hn}},{key:"on",value:function(t,i){this.st.I(t,i)}}])&&Bn(t.prototype,n),s&&Bn(t,s),Object.defineProperty(t,"prototype",{writable:!1}),i}();Object.assign(Cn.prototype,{ot:function(){this.q.addEventListener("mousemove",this.tt,!1)},tt:function(t){if(0!==this.on.length){for(var n=this,i=new E,s=this.q.getBoundingClientRect(),i=(i.x=(t.clientX-s.left)/s.width*2-1,i.y=2*-((t.clientY-s.top)/s.height)+1,this.nt.setFromCamera(i,this.C.camera),t.clientX-s.left),t=t.clientY-s.top,s=fengmap.FMUtil.coordsScreenToMap(this.C,{x:i,y:t}),e=this.nt.intersectObjects(function(){for(var t=[],i=0;i<n.on.length;i++)n.on[i].mapNode&&n.on[i].mapNode.level&&n.on[i].mapNode.level===n.C.getLevel()&&t.push(n.on[i]);return t}(this.on),!0),r=[],h=[],o=0;o<e.length;o++)!function(t,i){for(var n=!0,s=0;s<t.length;s++)if(t[s].uuid===i.uuid){n=!1;break}return n}(r,e[o].object)||(r.push(e[o].object),h.push(e[o].point));var u=[],a=[];if(0<r.length){for(var f=0;f<r.length;f++){u.push(r[f].myobject);var c=h[f];a.push({x:c.x+this.C.x,y:this.C.y-c.z})}for(var l=s,v=u,d=a,y=0;y<v.length-1;y++)for(var p=0;p<v.length-1-y;p++){var m=Math.sqrt((v[p].x-l.x)*(v[p].x-l.x)+(v[p].y-l.y)*(v[p].y-l.y));Math.sqrt((v[p+1].x-l.x)*(v[p+1].x-l.x)+(v[p+1].y-l.y)*(v[p+1].y-l.y))<m&&(m=v[p],v[p]=v[p+1],v[p+1]=m,m=d[p],d[p]=d[p+1],d[p+1]=m)}}0===u.length&&(a=u=null);for(var A=0;A<this.on.length;A++){var g=this.un[""+this.on[A].myobject.id];g&&(this.on[A].myobject.color=g.color,this.on[A].myobject.borderColor=g.borderColor)}null!==u&&u[0].type===fengmap.FMType.POLYGON_MARKER&&(u[0].color=this.rn,u[0].borderColor=this.rn),this.st.B({type:"snap",coords:s,targets:u,targetsCoords:a,level:this.C.getLevel()})}}});function Pn(t){return(Pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ln(t,i){return function(t){if(Array.isArray(t))return t}(t)||function(t,i){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var s,e,r,h,o=[],u=!0,a=!1;try{if(r=(n=n.call(t)).next,0===i){if(Object(n)!==n)return;u=!1}else for(;!(u=(s=r.call(n)).done)&&(o.push(s.value),o.length!==i);u=!0);}catch(t){a=!0,e=t}finally{try{if(!u&&null!=n.return&&(h=n.return(),Object(h)!==h))return}finally{if(a)throw e}}return o}}(t,i)||Dn(t,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fn(t,i){var n,s,e,r,h="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(h)return s=!(n=!0),{s:function(){h=h.call(t)},n:function(){var t=h.next();return n=t.done,t},e:function(t){s=!0,e=t},f:function(){try{n||null==h.return||h.return()}finally{if(s)throw e}}};if(Array.isArray(t)||(h=Dn(t))||i&&t&&"number"==typeof t.length)return h&&(t=h),r=0,{s:i=function(){},n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Dn(t,i){var n;if(t)return"string"==typeof t?Vn(t,i):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Vn(t,i):void 0}function Vn(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,s=new Array(i);n<i;n++)s[n]=t[n];return s}function Nn(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,i){if("object"!=Pn(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===i?String:Number)(t);n=n.call(t,i||"default");if("object"!=Pn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==Pn(t)?t:String(t)}(s.key),s)}}var Un=function(){function i(t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.C=t.map,this.an=t.defaultStyle,this.fn=t.isdirect,this.cn=new Map,this.ln=new Map,this.vn=new Map,this.dn=this.dn.bind(this),this.C.on("beforeRender",this.dn)}var t,n,s;return t=i,(n=[{key:"add",value:function(t){var i=this;if(void 0===t.buildingID&&(t.buildingID=this.C.getMapOptions().mapID),void 0===t.type&&(t.type=1),void 0===t.levels){t.levels=[];for(var n=this.C.getBuilding(t.buildingID).getFloorInfos(),s=0;s<n.length;s++)t.levels.push(n[s].level)}for(var e=t.result,r=t.levels,h=t.roadRanks,o=0;o<r.length;o++)for(var u=0;u<h.length;u++)for(var a=function(t,i,n){for(var s=[],e=0;e<t.length;e++)if(""+t[e].level==""+i)for(var r=t[e].roadVector,h=0;h<r.length;h++)""+r[h].roadRank==""+n&&s.push(r[h]);return s}(e,r[o],h[u]),f=(m=p=y=d=v=l=c=f=void 0,t.type),c=r[o],l=t.height,v=h[u],d=a,y=t.zoomRange,p=i.yn(v),m=0;m<d.length;m++)d[m].buildingID||(d[m].buildingID=i.C.getMapOptions().mapID),""+f=="1"?(i.pn(p,c,l,v,d[m].startPoint,d[m].startId,y,d[m].buildingID),i.pn(p,c,l,v,d[m].endPoint,d[m].endId,y,d[m].buildingID),i.mn(p,c,l,v,d[m].startPoint,d[m].endPoint,y,d[m].buildingID,d[m].roadEntry)):""+f=="2"?i.mn(p,c,l,v,d[m].startPoint,d[m].endPoint,y,d[m].buildingID,d[m].roadEntry):""+f=="3"&&(i.pn(p,c,l,v,d[m].startPoint,d[m].startId,y,d[m].buildingID),i.pn(p,c,l,v,d[m].endPoint,d[m].endId,y,d[m].buildingID))}},{key:"getNaviLineByRanks",value:function(t){return this.An(t,this.ln)}},{key:"getNaviNodeByRanks",value:function(t){return this.An(t,this.cn)}},{key:"remove",value:function(r){for(var h=this,t=(void 0===r.buildingID&&(r.buildingID=this.C.getMapOptions().mapID),r.type),i=(void 0===t&&(t=1),r.levels),n=r.roadRanks,s=0;s<i.length;s++)for(var e=0;e<n.length;e++)""+t=="1"?(o(i[s],n[e]),u(i[s],n[e])):""+t=="2"?o(i[s],n[e]):""+t=="3"&&u(i[s],n[e]);function o(t,i){for(var n=h.ln.get(r.buildingID+""+t),s=a(n,i);-1!==s;)n[s].object.remove(),n.splice(s,1),s=a(n,i);var e=h.vn.get(r.buildingID+""+t);if(e)for(s=a(e,i);-1!==s;)e[s].object.remove(),e.splice(s,1),s=a(e,i)}function u(t,i){for(var n=h.cn.get(r.buildingID+""+t),s=a(n,i);-1!==s;)n[s].object.remove(),n.splice(s,1),s=a(n,i)}function a(t,i){for(var n=-1,s=0;s<t.length;s++)if(""+t[s].roadRank==""+i){n=s;break}return n}}},{key:"changeVisible",value:function(t){}},{key:"dispose",value:function(){var t,i=Fn(this.cn);try{for(i.s();!(t=i.n()).done;){for(var n=Ln(t.value,2),s=(n[0],n[1]),e=0;e<s.length;e++)s[e].object.remove();s.length=0}}catch(t){i.e(t)}finally{i.f()}var r,h=Fn(this.ln);try{for(h.s();!(r=h.n()).done;){for(var o=Ln(r.value,2),u=(o[0],o[1]),a=0;a<u.length;a++)u[a].object.remove();u.length=0}}catch(t){h.e(t)}finally{h.f()}var f,c=Fn(this.vn);try{for(c.s();!(f=c.n()).done;){for(var l=Ln(f.value,2),v=(l[0],l[1]),d=0;d<v.length;d++)v[d].object.remove();v.length=0}}catch(t){c.e(t)}finally{c.f()}this.vn.clear(),this.ln.clear(),this.cn.clear(),this.C.on("beforeRender",this.dn)}}])&&Nn(t.prototype,n),s&&Nn(t,s),Object.defineProperty(t,"prototype",{writable:!1}),i}(),Yn=(Object.assign(Un.prototype,{yn:function(t){for(var i=null,n=0;n<this.an.length;n++)if(""+this.an[n].roadRank==""+t){i=this.an[n];break}return i},mn:function(s,e,r,h,t,i,n,o,u){var a=this,f=new fengmap.FMSegment,f=(f.points=[{x:t.x,y:t.y,z:r},{x:i.x,y:i.y,z:r}],f.level=e,f.buildingID=o,new fengmap.FMLineMarker({segments:[f],width:s.lineWidth,color:s.lineColor,type:fengmap.FMLineType.FULL})),c=(f.addTo(this.C),this.ln.get(o+""+e));function l(t,i){var n=new fengmap.FMSegment,i=(n.points=[{x:t.p1.x,y:t.p1.y,z:r},{x:i.x,y:i.y,z:r},{x:t.p2.x,y:t.p2.y,z:r}],n.level=e,n.buildingID=o,new fengmap.FMLineMarker({segments:[n],width:s.lineWidth,color:s.lineColor,type:fengmap.FMLineType.FULL,smooth:!1})),t=(i.addTo(a.C),a.vn.get(o+""+e));t?t.push({roadRank:h,object:i}):a.vn.set(o+""+e,[{roadRank:h,object:i}])}function v(t,i){var n=(t.x+i.x)/2,t=(t.y+i.y)/2,s=Math.PI/4;return{p1:{x:(n-i.x)*Math.cos(s)-(t-i.y)*Math.sin(s)+i.x,y:(t-i.y)*Math.cos(s)+(n-i.x)*Math.sin(s)+i.y},p2:{x:(n-i.x)*Math.cos(2*Math.PI-s)-(t-i.y)*Math.sin(2*Math.PI-s)+i.x,y:(t-i.y)*Math.cos(2*Math.PI-s)+(n-i.x)*Math.sin(2*Math.PI-s)+i.y}}}c?c.push({roadRank:h,object:f,zoomRange:n}):this.ln.set(o+""+e,[{roadRank:h,object:f,zoomRange:n}]),this.fn&&(c={x:(t.x+i.x)/2,y:(t.y+i.y)/2},f={x:(t.x+c.x)/2,y:(t.y+c.y)/2},n={x:(i.x+c.x)/2,y:(i.y+c.y)/2},""+u=="1"?l(v(f,c),c):""+u=="2"?l(v(n,c),c):""+u=="3"&&(l(v(f,c),c),l(v(n,c),c)))},pn:function(t,i,n,s,e,r,h,o){var u;this.gn(o+""+i,r)&&(u={x:e.x,y:e.y},u={points:fengmap.FMCalculator.rectangleBuilder(t.pointSize,t.pointSize,u),x:e.x,y:e.y,height:n,color:t.pointColor,borderWidth:0,opacity:1},e=this.C.getBuilding(o).getFloor(i),(n=new fengmap.FMPolygonMarker(u)).addTo(e),n.id=r,(t=this.cn.get(o+""+i))?t.push({roadRank:s,object:n,zoomRange:h}):this.cn.set(o+""+i,[{roadRank:s,object:n,zoomRange:h}]))},gn:function(t,i){var n,s=!0,e=Fn(this.cn);try{for(e.s();!(n=e.n()).done;){var r=Ln(n.value,2),h=r[0],o=r[1];if(""+h==""+t)for(var u=0;u<o.length;u++)if(""+o[u].object.id==""+i){s=!1;break}if(!s)break}}catch(t){e.e(t)}finally{e.f()}return s},bn:function(t,i){for(var n=!1,s=0;s<i.length;s++)if(""+i[s]==""+t){n=!0;break}return n},dn:function(){for(var t=this.C.camera,i=this.C.getVisibleLevels(),n=this.C.getZoom(),s=0;s<i.length;s++){var e=this.C.getFloor(i[s]),r=this.ln.get(""+i[s]);if(r)for(var h,o,u=0;u<r.length;u++)n<r[u].zoomRange[0]||n>r[u].zoomRange[1]?r[u].object.parent&&r[u].object.remove():(h=new b((o=r[u].object.segments[0].points)[0].x-this.C.x,o[0].z+e.height,-o[0].y+this.C.y),o=new b(o[1].x-this.C.x,o[1].z+e.height,-o[1].y+this.C.y),h=h.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix),o=o.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix),!(1<Math.abs(h.x)||1<Math.abs(h.y)||1<Math.abs(h.z))||!(1<Math.abs(o.x)||1<Math.abs(o.y)||1<Math.abs(o.z))?r[u].object.parent||r[u].object.addTo(this.C):r[u].object.parent&&r[u].object.remove());var a=this.cn.get(""+i[s]);if(a)for(var f=0;f<a.length;f++){var c,l=a[f].object;n<a[f].zoomRange[0]||n>a[f].zoomRange[1]?l.parent&&l.remove():(c=new b(l.x-this.C.x,l.height+e.height,-l.y+this.C.y).applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix),1<Math.abs(c.x)||1<Math.abs(c.y)||1<Math.abs(c.z)?l.parent&&l.remove():l.parent||l.addTo(e))}}this.C.enableUpdateRender()},An:function(t,i){var n=t.roadRanks,s=t.levels;if(void 0===t.buildingID&&(t.buildingID=this.C.getMapOptions().mapID),void 0===s)for(var s=[],e=this.C.getBuilding(t.buildingID).getFloorInfos(),r=0;r<e.length;r++)s.push(e[r].level);for(var h=[],o=0;o<s.length;o++){var u=i.get(t.buildingID+""+s[o]);if(u)for(var a=0;a<u.length;a++)this.bn(u[a].roadRank,n)&&h.push(u[a].object)}return h}}),"v3.1.7"),Hn=62,L=window.fengmap||{};L.VERSION=Yn,L.BUILD=Hn,L.FMMapEditor=t,L.FMMarkerEditor=Di,L.FMBoxSelectTool=T,L.FMImageMarkerEdit=ji,L.FMPolygonMarkerEdit=wn,L.FMLineMarkerEdit=kn,L.FMSnapCtrl=Cn,L.FMNaviPathLineTool=Un,D.default=L}],s={},e.m=n,e.c=s,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"Mn",{value:!0})},e.t=function(i,t){if(1&t&&(i=e(i)),8&t)return i;if(4&t&&"object"==typeof i&&i&&i.Mn)return i;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:i}),2&t&&"string"!=typeof i)for(var s in i)e.d(n,s,function(t){return i[t]}.bind(null,s));return n},e.n=function(t){var i=t&&t.Mn?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=0).default;function e(t){var i;return(s[t]||(i=s[t]={i:t,l:!1,exports:{}},n[t].call(i.exports,i,i.exports,e),i.l=!0,i)).exports}var n,s});