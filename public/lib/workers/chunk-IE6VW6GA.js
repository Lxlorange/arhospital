import{FMType_default,Matrix3,Vector2}from"./chunk-46ABZHUX.js";import{DisplayP3ColorSpace,LinearDisplayP3ColorSpace,LinearSRGBColorSpace,LinearTransfer,NoColorSpace,P3Primaries,Rec709Primaries,SRGBColorSpace,SRGBTransfer}from"./chunk-2B2O43AG.js";import{Vector3,clamp,euclideanModulo,lerp}from"./chunk-AGIEQDNA.js";import{toVec2}from"./chunk-2DLEF24H.js";var Earcut={triangulate:function(o,l,h){h=h||2;var u=l&&l.length,c=u?l[0]*h:o.length;let x=linkedList(o,0,c,h,!0);var y=[];if(x&&x.next!==x.prev){let e,r,n,i,s,a,t;if(u&&(x=eliminateHoles(o,l,x,h)),o.length>80*h){e=n=o[0],r=i=o[1];for(let t=h;t<c;t+=h)s=o[t],a=o[t+1],s<e&&(e=s),a<r&&(r=a),s>n&&(n=s),a>i&&(i=a);t=0!==(t=Math.max(n-e,i-r))?1/t:0}earcutLinked(x,y,h,e,r,t)}return y}};function linkedList(t,e,r,n,i){let s,a;if(i===0<signedArea(t,e,r,n))for(s=e;s<r;s+=n)a=insertNode(s,t[s],t[s+1],a);else for(s=r-n;s>=e;s-=n)a=insertNode(s,t[s],t[s+1],a);return a&&equals(a,a.next)&&(removeNode(a),a=a.next),a}function filterPoints(t,e){if(!t)return t;e=e||t;let r=t,n;do{if(n=!1,r.steiner||!equals(r,r.next)&&0!==area(r.prev,r,r.next))r=r.next;else{if(removeNode(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function earcutLinked(n,i,s,a,o,l,h){if(n){!h&&l&&indexCurve(n,a,o,l);let t=n,e,r;for(;n.prev!==n.next;)if(e=n.prev,r=n.next,l?isEarHashed(n,a,o,l):isEar(n))i.push(e.i/s),i.push(n.i/s),i.push(r.i/s),removeNode(n),n=r.next,t=r.next;else if((n=r)===t){h?1===h?earcutLinked(n=cureLocalIntersections(filterPoints(n),i,s),i,s,a,o,l,2):2===h&&splitEarcut(n,i,s,a,o,l):earcutLinked(filterPoints(n),i,s,a,o,l,1);break}}}function isEar(t){var e=t.prev,r=t,n=t.next;if(0<=area(e,r,n))return!1;let i=t.next.next;for(;i!==t.prev;){if(pointInTriangle(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&0<=area(i.prev,i,i.next))return!1;i=i.next}return!0}function isEarHashed(t,e,r,n){var i=t.prev,s=t,a=t.next;if(0<=area(i,s,a))return!1;var o=(i.x<s.x?i.x<a.x?i:a:s.x<a.x?s:a).x,l=(i.y<s.y?i.y<a.y?i:a:s.y<a.y?s:a).y,h=(i.x>s.x?i.x>a.x?i:a:s.x>a.x?s:a).x,u=(i.y>s.y?i.y>a.y?i:a:s.y>a.y?s:a).y,c=zOrder(o,l,e,r,n),x=zOrder(h,u,e,r,n);let y=t.prevZ,p=t.nextZ;for(;y&&y.z>=c&&p&&p.z<=x;){if(y!==t.prev&&y!==t.next&&pointInTriangle(i.x,i.y,s.x,s.y,a.x,a.y,y.x,y.y)&&0<=area(y.prev,y,y.next))return!1;if(y=y.prevZ,p!==t.prev&&p!==t.next&&pointInTriangle(i.x,i.y,s.x,s.y,a.x,a.y,p.x,p.y)&&0<=area(p.prev,p,p.next))return!1;p=p.nextZ}for(;y&&y.z>=c;){if(y!==t.prev&&y!==t.next&&pointInTriangle(i.x,i.y,s.x,s.y,a.x,a.y,y.x,y.y)&&0<=area(y.prev,y,y.next))return!1;y=y.prevZ}for(;p&&p.z<=x;){if(p!==t.prev&&p!==t.next&&pointInTriangle(i.x,i.y,s.x,s.y,a.x,a.y,p.x,p.y)&&0<=area(p.prev,p,p.next))return!1;p=p.nextZ}return!0}function cureLocalIntersections(t,e,r){let n=t;do{var i=n.prev,s=n.next.next;!equals(i,s)&&intersects(i,n,n.next,s)&&locallyInside(i,s)&&locallyInside(s,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(s.i/r),removeNode(n),removeNode(n.next),n=t=s),n=n.next}while(n!==t);return filterPoints(n)}function splitEarcut(t,e,r,n,i,s){let a=t;do{let t=a.next.next;for(;t!==a.prev;){var o;if(a.i!==t.i&&isValidDiagonal(a,t))return o=splitPolygon(a,t),a=filterPoints(a,a.next),o=filterPoints(o,o.next),earcutLinked(a,e,r,n,i,s),void earcutLinked(o,e,r,n,i,s);t=t.next}}while((a=a.next)!==t)}function eliminateHoles(t,e,r,n){var i=[];let s,a,o,l,h;for(s=0,a=e.length;s<a;s++)o=e[s]*n,l=s<a-1?e[s+1]*n:t.length,(h=linkedList(t,o,l,n,!1))===h.next&&(h.steiner=!0),i.push(getLeftmost(h));for(i.sort(compareX),s=0;s<i.length;s++)eliminateHole(i[s],r),r=filterPoints(r,r.next);return r}function compareX(t,e){return t.x-e.x}function eliminateHole(t,e){(e=findHoleBridge(t,e))&&(t=splitPolygon(e,t),filterPoints(e,e.next),filterPoints(t,t.next))}function findHoleBridge(r,t){let n=t;var i=r.x,s=r.y;let a=-1/0,o;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var e=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=i&&e>a){if((a=e)===i){if(s===n.y)return n;if(s===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}}while((n=n.next)!==t);if(!o)return null;if(i!==a){var l=o,h=o.x,u=o.y;let t=1/0,e;for(n=o;i>=n.x&&n.x>=h&&i!==n.x&&pointInTriangle(s<u?i:a,s,h,u,s<u?a:i,s,n.x,n.y)&&(e=Math.abs(s-n.y)/(i-n.x),locallyInside(n,r))&&(e<t||e===t&&(n.x>o.x||n.x===o.x&&sectorContainsSector(o,n)))&&(o=n,t=e),(n=n.next)!==l;);}return o}function sectorContainsSector(t,e){return area(t.prev,t,e.prev)<0&&area(e.next,t,t.next)<0}function indexCurve(t,e,r,n){let i=t;for(;null===i.z&&(i.z=zOrder(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,(i=i.next)!==t;);i.prevZ.nextZ=null,i.prevZ=null,sortLinked(i)}function sortLinked(t){let e,r,n,i,s,a,o,l,h=1;do{for(r=t,t=null,s=null,a=0;r;){for(a++,n=r,o=0,e=0;e<h&&(o++,n=n.nextZ);e++);for(l=h;0<o||0<l&&n;)0!==o&&(0===l||!n||r.z<=n.z)?(r=(i=r).nextZ,o--):(n=(i=n).nextZ,l--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;r=n}}while(s.nextZ=null,h*=2,1<a);return t}function zOrder(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function getLeftmost(t){let e=t,r=t;for(;(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),(e=e.next)!==t;);return r}function pointInTriangle(t,e,r,n,i,s,a,o){return 0<=(i-a)*(e-o)-(t-a)*(s-o)&&0<=(t-a)*(n-o)-(r-a)*(e-o)&&0<=(r-a)*(s-o)-(i-a)*(n-o)}function isValidDiagonal(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!intersectsPolygon(t,e)&&(locallyInside(t,e)&&locallyInside(e,t)&&middleInside(t,e)&&(area(t.prev,t,e.prev)||area(t,e.prev,e))||equals(t,e)&&0<area(t.prev,t,t.next)&&0<area(e.prev,e,e.next))}function area(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function equals(t,e){return t.x===e.x&&t.y===e.y}function intersects(t,e,r,n){var i=sign(area(t,e,r)),s=sign(area(t,e,n)),a=sign(area(r,n,t)),o=sign(area(r,n,e));return i!==s&&a!==o||!!(0===i&&onSegment(t,r,e)||0===s&&onSegment(t,n,e)||0===a&&onSegment(r,t,n)||0===o&&onSegment(r,e,n))}function onSegment(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function sign(t){return 0<t?1:t<0?-1:0}function intersectsPolygon(t,e){let r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&intersects(r,r.next,t,e))return!0}while((r=r.next)!==t);return!1}function locallyInside(t,e){return area(t.prev,t,t.next)<0?0<=area(t,e,t.next)&&0<=area(t,t.prev,e):area(t,e,t.prev)<0||area(t,t.next,e)<0}function middleInside(t,e){let r=t,n=!1;for(var i=(t.x+e.x)/2,s=(t.y+e.y)/2;r.y>s!=r.next.y>s&&r.next.y!==r.y&&i<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),(r=r.next)!==t;);return n}function splitPolygon(t,e){var r=new Node(t.i,t.x,t.y),n=new Node(e.i,e.x,e.y),i=t.next,s=e.prev;return(t.next=e).prev=t,(r.next=i).prev=r,(n.next=r).prev=n,(s.next=n).prev=s,n}function insertNode(t,e,r,n){t=new Node(t,e,r);return n?(t.next=n.next,(t.prev=n).next.prev=t,n.next=t):(t.prev=t).next=t,t}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Node(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(r,n,i,s){let a=0;for(let t=n,e=i-s;t<i;t+=s)a+=(r[e]-r[t])*(r[t+1]+r[e+1]),e=t;return a}var Triangulate={area:function(r){var n=r.length;let i=0;for(let t=n-1,e=0;e<n;t=e++)i+=r[t].x*r[e].y-r[e].x*r[t].y;return.5*i},isClockWise:function(t){return Triangulate.area(t)<0},triangulateShape:function(t,e){var r=[],n=[],i=[];removeDupEndPts(t),addContour(r,t);let s=t.length;e.forEach(removeDupEndPts);for(let t=0;t<e.length;t++)n.push(s),s+=e[t].length,addContour(r,e[t]);var a=Earcut.triangulate(r,n);for(let t=0;t<a.length;t+=3)i.push(a.slice(t,t+3));return i},triangulate:function(e){let t=[];t.push(...e[0]);var r=[];for(let t=1;t<e.length;t++){var n=[];n.push(...e[t]),r.push(n)}if(!Triangulate.isClockWise(t)){t=t.reverse();for(let t=0,e=r.length;t<e;t++){var i=r[t];Triangulate.isClockWise(i)&&(r[t]=i.reverse())}}return Triangulate.triangulateShape(t,r)}};function isEquals(t,e){return t.x===e.x&&t.y===e.y}function removeDupEndPts(t){var e=t.length;2<e&&isEquals(t[e-1],t[0])&&t.pop()}function addContour(e,r){for(let t=0;t<r.length;t++)e.push(r[t].x),e.push(r[t].y)}var kRealEpsion=1e-5,kSameEpsilon=1e-5,kSameEpsilon1=.001,kDEG2RAD=Math.PI/180,kRAD2DEG=180/Math.PI,Graphics=class{constructor(){}},graphics=(Object.assign(Graphics.prototype,{_epsilon(){return kRealEpsion},_deg2Rad(){return kDEG2RAD},_rad2Deg(){return kRAD2DEG},_isZero(t){return t<kRealEpsion&&-kRealEpsion<t},_gtZero(t){return kRealEpsion<t},_ltZero(t){return t<-kRealEpsion},_cross(t,e,r){e=(t.x-r.x)*(e.y-r.y)-(e.x-r.x)*(t.y-r.y);return Math.abs(e)<kRealEpsion?0:e},distanceOfTwoPoints(t,e){return t&&e?Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)):Number.NaN},distance(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},isPolygonContainPoint(n,i){let s=0;for(let r=0;r<n.length;r++){var a=n[r].x,o=n[r].y;let t=0,e=0;if(e=(r<n.length-1?(t=n[r+1].x,n[r+1]):(t=n[0].x,n[0])).y,a===i.x&&o===i.y||t===i.x&&e===i.y)return!0;if(e!==o){var l=a+(i.y-o)*(t-a)/(e-o);if(l===i.x)return!0;a!==t?l<=Math.max(a,t)&&l>=Math.min(a,t)&&l>i.x&&l!==a&&(l===t&&0<(o-i.y)*(e-i.y)?s+=2:s++):l<=Math.max(a,t)&&l>=Math.min(a,t)&&l>i.x&&(l===t&&0<(o-i.y)*(e-i.y)?s+=2:s++)}}return 0<s%2},isPolygonContainPoint2(e,r){var n=e.length;if(n<3)return!1;let i=n-1,s=!1,a=0;for(let t=0;t<n;t++){var o=e[t],l=e[i];o.y>r.y!=l.y>r.y&&r.x<(l.x-o.x)*(r.y-o.y)/(l.y-o.y)+o.x&&(s=!s,o.y>l.y?a++:a--),i=t}return 0!=a},isPolygonInPolygon(t,e){var r=Object.assign([],t),n=Object.assign([],e);r.push(r[0]),n.push(n[0]);for(let t=0;t<r.length-1;t++){var i=r[t];if(!this.isPolygonContainPoint(n,i)&&!this.isPolygonContainPoint2(n,i))return!1}for(let e=0;e<r.length-1;e++)for(let t=0;t<n.length-1;t++)if(this._isLinesIntersect(r[e],r[e+1],n[t],n[t+1]).isintersect&&!this._isPointOnLine(n[t],n[t+1],r[e])&&!this._isPointOnLine(n[t],n[t+1],r[e+1]))return!1;return!0},_isRectCross(t,e,r,n){return!(Math.max(t.x,e.x)<Math.min(r.x,n.x)||Math.max(t.y,e.y)<Math.min(r.y,n.y)||Math.max(r.x,n.x)<Math.min(t.x,e.x)||Math.max(r.y,n.y)<Math.min(t.y,e.y))},_isLineSegmentCross(t,e,r,n){return!(Math.max(t.x,e.x)<Math.min(r.x,n.x)||Math.max(t.y,e.y)<Math.min(r.y,n.y)||Math.max(r.x,n.x)<Math.min(t.x,e.x)||Math.max(r.y,n.y)<Math.min(t.y,e.y)||0===this._cross(r,e,t)&&0===this._cross(e,n,t)||this._cross(r,e,t)*this._cross(e,n,t)<0||this._cross(t,n,r)*this._cross(n,e,r)<0)},_isPointInRect(t,e,r){return!(t.x<e.x||t.y<e.y||t.x>r.x||r.y<t.y)},_isPointInRect1(t,e,r){var n=Math.min(e.x,r.x),i=Math.max(e.x,r.x),s=Math.min(e.y,r.y),e=Math.max(e.y,r.y);return!(t.x<n||t.x>i||t.y<s||t.y>e)},_isPointInLineRect(t,e,r){var n=Math.min(r.x,e.x),i=Math.max(r.x,e.x),s=Math.min(r.y,e.y),r=Math.max(r.y,e.y);return!(t.x<n||t.x>i||t.y<s||t.y>r)},_isPointInPolygon(e,r,n){let i=!1;var s,a;for(let t=0;t<n;t++)s=r[t],a=r[(t+1)%n],(s.y<e.y&&a.y>=e.y||a.y<e.y&&s.y>=e.y)&&(s.x<=e.x||a.x<=e.x)&&s.x+(e.y-s.y)/(a.y-s.y)*(a.x-s.x)<e.x&&(i=!i);return i},_isPointOnSegment(t,e,r){return(t.x-e.x)*(r.y-e.y)==(r.x-e.x)*(t.y-e.y)&&Math.min(e.x,r.x)<=t.x&&t.x<=Math.max(e.x,r.x)&&Math.min(e.y,r.y)<=t.y&&t.y<=Math.max(e.y,r.y)},_distance(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},_distanceSquare(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)},_distanceSquarePointToLine(t,e,r){let n;var i=e.x,e=e.y,s=r.x,r=r.y,a=t.x,t=t.y,o=s-i,l=r-e,h=o*o+l*l,u=a-i,c=t-e,x=u*u+c*c;return this._isZero(h)?n=this._isZero(x)?0:x:(l=(h=o/(o=Math.sqrt(h)))*u+(u=l/o)*c,n=this._gtZero(l)?this._ltZero(l-o)?(c=a-(i+l*h))*c+(o=t-(e+l*u))*o:(i=a-s)*i+(h=t-r)*h:x,this._isZero(n)?0:n)},_distancePointToLine(t,e,r,n){let i;var s=e.x,a=e.y,o=r.x,l=r.y,h=t.x,t=t.y,u=o-s,c=l-a,x=Math.sqrt(u*u+c*c),y=h-s,p=t-a,f=Math.sqrt(y*y+p*p);return i=!this._isZero(x)&&(c=(u=u/x)*y+(y=c/x)*p,this._gtZero(c))?this._ltZero(c-x)?(x=h-(p=s+c*u),u=t-(s=a+c*y),a=Math.sqrt(x*x+u*u),n.x=p,n.y=s,a):(c=h-o,y=t-l,x=Math.sqrt(c*c+y*y),n.x=r.x,n.y=r.y,x):(n.x=e.x,n.y=e.y,f),this._isZero(i)?0:i},_calcGravityCenter(e,r){let n=0,i=0,s=0;for(let t=0;t<r;t++){var a=e[t],o=e[(t+1)%r],l=(a.x*o.y-a.y*o.x)/2;n+=l,i+=l*(a.x+o.x)/3,s+=l*(a.y+o.y)/3}return i/=n,s/=n,{x:i,y:s}},_calcCentroid(e){var r=Triangulate.triangulate([e]);let n=0,i=0,s=0;for(let t=0;t<r.length;t++){var a=e[r[t][0]],o=e[r[t][1]],l=e[r[t][2]],h={x:o.x-a.x,y:o.y-a.y},u={x:l.x-a.x,y:l.y-a.y},u=(h.x*u.y-u.x*h.y)/2,h=(n+=u,(a.x+o.x+l.x)/3);i+=h*u,s+=(a.y+o.y+l.y)/3*u}return{x:i/n,y:s/n}},_calcPolygonArea(e,r){if(r<3)return 0;let n=0;for(let t=0;t<r;++t){var i=e[t],s=e[(t+1)%r];n+=i.x*s.y-i.y*s.x}return Math.abs(n/2)},_calcCrossPoint(t,e,r,n,i){var s;return this._isLineSegmentCross(t,e,r,n)?(s=(n.x-r.x)*(t.y-e.y)-(e.x-t.x)*(r.y-n.y),i.x=((t.y-r.y)*(e.x-t.x)*(n.x-r.x)+r.x*(n.y-r.y)*(e.x-t.x)-t.x*(e.y-t.y)*(n.x-r.x))/s,i.y=(e.y*(t.x-e.x)*(n.y-r.y)+(n.x-e.x)*(n.y-r.y)*(t.y-e.y)-n.y*(r.x-n.x)*(e.y-t.y))/(s=(t.x-e.x)*(n.y-r.y)-(e.y-t.y)*(r.x-n.x)),1):0},_rayIntersect(t,e,r,n,i){var s=Math.min(r.x,n.x),a=Math.max(r.x,n.x),o=Math.min(r.y,n.y),l=Math.max(r.y,n.y),h=t.x,u=t.y,c=r.x,x=r.y,y=n.x,p=n.y;if(90==e)return!(t.x<s||t.x>a||(a-s<kSameEpsilon1?t.y>=x&&t.y<=p||t.y>=p&&t.y<=x?(i.x=t.x,i.y=t.y,0):x<p&&t.x<x?(i.x=c,i.y=x,0):!(p<x&&t.x<p)||(i.x=y,i.y=p,0):(i.y=f=(p-x)/(y-c)*(h-c)+x,i.x=h,f<u||!this._isPointInLineRect(i,r,n))));if(270==e)return!(t.x<s||t.x>a||(Math.abs(a-s<kSameEpsilon1)?t.y>=x&&t.y<=p||t.y>=p&&t.y<=x?(i.x=t.x,i.y=t.y,0):x<p&&t.y>p?(i.x=y,i.y=p,0):!(p<x&&t.y>x)||(i.x=c,i.y=x,0):(i.y=f=(p-x)/(y-c)*(h-c)+x,i.x=h,u<f||!this._isPointInLineRect(i,r,n))));if(270!=e&&90!=e&&Math.abs(a-s<kSameEpsilon1)){var t=s,f=Math.tan(e/180*Math.PI)*(t-h)+u;if(i.y=f,i.x=t,this._isPointInLineRect(i,r,n))return a=f-u,0<(s=t-h)/Math.sqrt(s*s+a*a)*Math.cos(e/180*Math.PI)}return Math.abs(l-o<=kSameEpsilon1)?(f=o,t=1/Math.tan(e/180*Math.PI)*(f-u)+h,i.x=t,i.y=f,!!this._isPointInLineRect(i,r,n)&&(s=f-u,0<(a=t-h)/Math.sqrt(a*a+s*s)*Math.cos(e/180*Math.PI))):(t=u+(l=Math.tan(e/180*Math.PI))*((f=(x-u-((o=(p-x)/(y-c))*c-l*h))/(l-o))-h),i.x=f,i.y=t,!!this._isPointInLineRect(i,r,n)&&(a=f-h,s=t-u,Math.abs(a)<=kSameEpsilon1&&Math.abs(s)<=kSameEpsilon1||0<a/Math.sqrt(a*a+s*s)*Math.cos(e/180*Math.PI)))},_isPointXYEqual(t,e){return Math.abs(t.x-e.x)<kRealEpsion&&Math.abs(t.y-e.y)<kRealEpsion},_calcFootOfUpright(t,e,r,n){var i,s,a,o,l=t.x,h=t.y,u=e.x,c=e.y,x=r.x,y=r.y;return this._isPointXYEqual(t,e)||this._isPointXYEqual(t,r)?(n.x=l,n.y=h,!0):(a=Math.min(e.x,r.x),o=Math.max(e.x,r.x),i=Math.min(e.y,r.y),s=Math.max(e.y,r.y),Math.abs(u-x)<kSameEpsilon?(n.x=u,i<=(n.y=h)&&h<=s):Math.abs(c-y)<kSameEpsilon?(n.x=l,n.y=c,a<=l&&l<=o):(o=h+(i=-1/((y-c)/(x-u)))*((a=(c-h-((s=(y-c)/(x-u))*u-i*l))/(i-s))-l),n.x=a,n.y=o,!!this._isPointInLineRect(n,e,r)||!(!this._isPointXYEqual(t,e)&&!this._isPointXYEqual(t,r))))},_vectorCross(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}},_vectorDot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},_vectorLength(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},_vector2DDot(t,e){return t.x*e.x+t.y*e.y},_vector2DCross(t,e){return t.x*e.y-t.y*e.x},_vector2DLength(t){return Math.sqrt(t.x*t.x+t.y*t.y)},_calcRotateAngle(t,e){var r,n;return 0==t.x&&0==t.y||0==e.x&&0==e.y?0:(r={x:e.x,y:e.y,z:0},r=this._vectorCross({x:t.x,y:t.y,z:0},r),n=this._vector2DDot(t,e),n=Math.acos(n/(this._vector2DLength(t)*this._vector2DLength(e))),0<r.z?n/Math.PI*180:360-n/Math.PI*180)},_segCrossPolygon(e,r,n,i){for(let t=0;t<n.length;t++){var s=n[t],a=n[(t+1)%n.length];if(1==this._calcCrossPoint(e,r,s,a,i))return!0}return!1},_rayCrossSegment(t,e,r,n,i){var s=Math.min(t.x,r.x,n.x),a=Math.max(t.x,r.x,n.x),o=Math.min(t.y,r.y,n.y),l=Math.max(t.y,r.y,n.y),a=Math.sqrt((a-s)*(a-s)+(l-o)*(l-o)),s=e/180*Math.PI,l=a*Math.cos(s)+t.x,o=a*Math.sin(s)+t.y;return 1==this._calcCrossPoint(t,{x:l,y:o},r,n,i)},_calcCenter(e){var t={x:null,y:null};let r=0,n=0,i=e.length;1<e.length&&e[0].x===e[e.length-1].x&&e[0].y===e[e.length-1].y&&i--;for(let t=0;t<i;t++)r+=e[t].x,n+=e[t].y;return t.x=r/e.length,t.y=n/e.length,t},_intersectionSegmentByCircle(t,e,r,n){var i=[],s=t.x-e,a=t.x+e,o=t.y-e,l=t.y+e,h=Math.min(r.x,n.x),u=Math.max(r.x,n.x),c=Math.min(r.y,n.y),x=Math.max(r.y,n.y);return u<s||a<h||x<o||l<c||(a=(t=((s=n.x-r.x)*(a=t.x-r.x)+(o=n.y-r.y)*(l=t.y-r.y))/(n=s*s+o*o))*t-(a*a+l*l-e*e)/n)<0||(l=Math.sqrt(a),n={x:r.x-s*(e=-t+l),y:r.y-o*e},s={x:r.x-s*(a=-t-l),y:r.y-o*a},e!==a&&(h<=n.x&&n.x<=u&&c<=n.y&&n.y<=x&&i.push(n),h<=s.x)&&s.x<=u&&c<=s.y&&s.y<=x&&i.push(s)),i},_compare(t,e){return Math.abs(t.x-e.x)<=kRealEpsion&&Math.abs(t.y-e.y)<=kRealEpsion},_calcFootPoint(t,e,r){var n,i={};if(t.x!=e.x)return n=e=(e.y-t.y)/(e.x-t.x),i.x=(+r.x- -1*n*r.y-n*(e=t.y-e*t.x))/(n*n+1),i.y=(n*n*r.y- -1*n*r.x- -1*e)/(n*n+1),i;i.x=t.x,i.y=r.y},_isLinesIntersect(t,e,r,n){var i,s,a,o,l={point:null,isintersect:!1};return this.distanceOfTwoPoints(t,r)<.001||this.distanceOfTwoPoints(t,n)<.001?(l.isintersect=!0,l.point=t):this.distanceOfTwoPoints(e,r)<.001||this.distanceOfTwoPoints(e,n)<.001?(l.isintersect=!0,l.point=e):(i={x:e.x-t.x,y:e.y-t.y},s={x:n.x-r.x,y:n.y-r.y},n={x:n.x-t.x,y:n.y-t.y},e={x:e.x-r.x,y:e.y-r.y},a={x:-(r={x:r.x-t.x,y:r.y-t.y}).x,y:-r.y},o=this._vector2DCross(s,i),Math.abs(o)<=1e-5||this._vector2DCross(r,i)*this._vector2DCross(n,i)<=-5e-4&&this._vector2DCross(a,s)*this._vector2DCross(e,s)<-5e-4&&(n=this._vector2DCross(s,r)/o,l.point={x:t.x+i.x*n,y:t.y+i.y*n},l.isintersect=!0)),l},_isClockwise(t,e,r){return t.x===e.x&&(e.x=e.x+1),t.y===e.y&&(e.y=e.y+1),e.x===r.x&&(r.x=r.x+1),e.y===r.y&&(r.y=r.y+1),!(0<(e.x-t.x)*(r.y-e.y)-(e.y-t.y)*(r.x-e.x))},getAngle(t){var e=t.p1,t=t.p2,r=t.x-e.x,t=t.y-e.y,e=Math.sqrt(r*r+t*t),e=Math.asin(Math.abs(t)/e);return 0<r&&0<t?e:r<0&&0<t?Math.PI-e:r<0&&t<0?Math.PI+e:0<r&&t<0?2*Math.PI-e:0==r&&0<t?e:0==r&&t<0?3*Math.PI/2:0<r&&0==t?e:r<0&&0==t?Math.PI:null},_calcTriangleArea(t){var e=this.distanceOfTwoPoints(t[0],t[1]),r=this.distanceOfTwoPoints(t[1],t[2]),t=this.distanceOfTwoPoints(t[0],t[2]),n=(e+r+t)/2;return Math.sqrt(n*(n-e)*(n-r)*(n-t))},_isPointInTriangle(t,e){var r,n,i,s,a;return this._distancePointToLine(t,e[0],e[1],{})<1e-4||this._distancePointToLine(t,e[0],e[2],{})<1e-4||this._distancePointToLine(t,e[1],e[2],{})<1e-4||(s={x:e[1].x-e[0].x,y:e[1].y-e[0].y},r={x:e[0].x-e[2].x,y:e[0].y-e[2].y},n={x:e[2].x-e[1].x,y:e[2].y-e[1].y},a={x:t.x-e[0].x,y:t.y-e[0].y},i={x:t.x-e[1].x,y:t.y-e[1].y},t={x:t.x-e[2].x,y:t.y-e[2].y},e=this._vector2DCross(s,a),s=this._vector2DCross(n,i),a=this._vector2DCross(r,t),kRealEpsion<e*s&&kRealEpsion<s*a)},_calcLinePolyIntersect(n,i,s){var a=s.length,o={isintersect:!1,start:null,end:null,type:0,outer:null},l=[];if(this._isPointInTriangle(n,s)&&(o.start=n),this._isPointInTriangle(i,s)&&(o.end=i),null!=o.start&&null!=o.end)o.isintersect=!0,o.type=1;else{let e=(s[1].x+s[2].x)/2,r=(s[1].y+s[2].y)/2;for(let t=1;t<a;t++){var h,u=this._isLinesIntersect(n,i,s[t-1],s[t]);if(u.isintersect){if(null!=o.start)return o.end=u.point,o.isintersect=!0,o.outer="end",h=this._calcRotateAngle({x:e-s[0].x,y:r-s[0].y},{x:i.x-s[0].x,y:i.y-s[0].y}),o.type=0<(h=h<180?h:h-360)?2:3,o;if(null!=o.end)return o.start=u.point,o.isintersect=!0,o.outer="start",h=this._calcRotateAngle({x:e-s[0].x,y:r-s[0].y},{x:n.x-s[0].x,y:n.y-s[0].y}),o.type=0<(h=h<180?h:h-360)?2:3,o;l.push(u)}}var t,c=this._isLinesIntersect(n,i,s[0],s[a-1]);if(c.isintersect){if(null!=o.start)return o.end=c.point,o.isintersect=!0,o.outer="end",t=this._calcRotateAngle({x:e-s[0].x,y:r-s[0].y},{x:i.x-s[0].x,y:i.y-s[0].y}),o.type=0<(t=t<180?t:t-360)?2:3,o;if(null!=o.end)return o.start=c.point,o.isintersect=!0,o.outer="start",t=this._calcRotateAngle({x:e-s[0].x,y:r-s[0].y},{x:n.x-s[0].x,y:n.y-s[0].y}),o.type=0<(t=t<180?t:t-360)?2:3,o;l.push(c)}2!=l.length||this.distanceOfTwoPoints(l[0].point,l[1].point)<.01||(this.distanceOfTwoPoints(l[0].point,n)<=this.distanceOfTwoPoints(l[0].point,i)?(o.start=l[0].point,o.end=l[1].point):(o.start=l[1].point,o.end=l[0].point),o.isintersect=!0,o.type=4)}return o},_calcLineScanIntersect(e,r,n){var i=n.length,s={isintersect:!1,start:null,end:null},a=[];if(this._isPointInTriangle(e,n)&&(s.start=e),this._isPointInTriangle(r,n)&&(s.end=r),null!=s.start&&null!=s.end)s.isintersect=!0;else{for(let t=1;t<i;t++){var o=this._isLinesIntersect(e,r,n[t-1],n[t]);if(o.isintersect){if(null!=s.start)return s.end=o.point,s.isintersect=!0,s;if(null!=s.end)return s.start=e,s.isintersect=!0,s;a.push(o)}}var t=this._isLinesIntersect(e,r,n[0],n[i-1]);if(t.isintersect){if(null!=s.start)return s.end=t.point,s.isintersect=!0,s;if(null!=s.end)return s.start=e,s.isintersect=!0,s;a.push(t)}2==a.length&&(s.start=(this.distanceOfTwoPoints(a[0].point,e)<=this.distanceOfTwoPoints(a[0].point,r)?a[0]:a[1]).point,s.end=(this.distanceOfTwoPoints(a[0].point,e)>this.distanceOfTwoPoints(a[0].point,r)?a[0]:a[1]).point,s.isintersect=!0)}return s},_lineSegmentSplit(i,t){if(0==t.length)return[i];var e,r,n=this._lineSegmentMerge(t),s=[];n.sort(function(t,e){var r=(t._startPoint.x-i._startPoint.x)*(t._startPoint.x-i._startPoint.x)+(t._startPoint.y-i._startPoint.y)*(t._startPoint.y-i._startPoint.y),n=(e._startPoint.x-i._startPoint.x)*(e._startPoint.x-i._startPoint.x)+(e._startPoint.y-i._startPoint.y)*(e._startPoint.y-i._startPoint.y),t=(t._endPoint.x-i._startPoint.x)*(t._endPoint.x-i._startPoint.x)+(t._endPoint.y-i._startPoint.y)*(t._endPoint.y-i._startPoint.y),e=(e._endPoint.x-i._startPoint.x)*(e._endPoint.x-i._startPoint.x)+(e._endPoint.y-i._startPoint.y)*(e._endPoint.y-i._startPoint.y);return(r<t?r:t)<(n<e?n:e)});let a=0;for(a=0;a<n.length;a++)this.distanceOfTwoPoints(n[a]._startPoint,n[a]._endPoint)<.01||(e=this.distanceOfTwoPoints(n[a]._startPoint,i._startPoint),r=this.distanceOfTwoPoints(n[a]._endPoint,i._startPoint),e<.01?i._startPoint=n[a]._endPoint:r<.01?i._startPoint=n[a]._startPoint:e<r?.1<this.distanceOfTwoPoints(i._startPoint,n[a]._startPoint)&&(s.push({_roadID:i._roadID,_startPoint:i._startPoint,_endPoint:n[a]._startPoint,_distance:i._distance,_road:i._road}),i._startPoint=n[a]._endPoint):.1<this.distanceOfTwoPoints(i._startPoint,n[a]._endPoint)&&(s.push({_roadID:i._roadID,_startPoint:i._startPoint,_endPoint:n[a]._endPoint,_distance:i._distance,_road:i._road}),i._startPoint=n[a]._startPoint),n.splice(a,1));return.1<this.distanceOfTwoPoints(i._startPoint,i._endPoint)&&s.push(i),s},_lineSegmentMerge(t){var e=[];if(1==t.length)return t;let r=t[0],n=1;for(;0<t.length;){if(n>=t.length){if(e.push(r),t.splice(0,1),t.length<1)break;r=t[0],n=1}if(1===t.length){e.push(r);break}this._isPointOnLine(r._startPoint,r._endPoint,t[n]._startPoint)?(this._isPointOnLine(r._startPoint,r._endPoint,t[n]._endPoint)||(r._endPoint=t[n]._endPoint),t.splice(n,1)):this._isPointOnLine(r._startPoint,r._endPoint,t[n]._endPoint)?(r._startPoint=t[n]._startPoint,t.splice(n,1)):this._isPointOnLine(t[n]._startPoint,t[n]._endPoint,r._startPoint)?(r=(this._isPointOnLine(t[n]._startPoint,t[n]._endPoint,r._endPoint)||(t[n]._endPoint=r._endPoint),t[n]),t.splice(n,1)):this._isPointOnLine(t[n]._startPoint,t[n]._endPoint,r._endPoint)?(t[n]._startPoint=r._startPoint,r=t[n],t.splice(n,1)):n++}return e},_isPointOnLine(t,e,r){let n=t.x-r.x,i=t.y-r.y,s=e.x-r.x,a=e.y-r.y;var o=this.distanceOfTwoPoints(t,r),r=this.distanceOfTwoPoints(e,r),t=this.distanceOfTwoPoints(t,e);return n*a-i*s<1e-5&&o+r-t<.001},_extendLine(t,e,r){let n=e.x-t.x,i=e.y-t.y;t=Math.sqrt(n*n+i*i);return{x:e.x+n/t*r,y:e.y+i/t*r}},_checkClockwise(e){let r=null,n=0,t=0,i=0;for(let t=0;t<e.length;t++)(null===r||e[t].x>r)&&(r=e[t].x,n=t);var s=new Vector3(e[n].x,e[n].y,0),a=(t=0===n?e.length-1:n-1,i=n===e.length-1?0:n+1,new Vector3(e[t].x,e[t].y,0)),o=new Vector3(e[i].x,e[i].y,0),a=(new Vector3).copy(s).sub(a),o=(new Vector3).copy(o).sub(s);return 0<a.cross(o).z}}),new Graphics),Graphics_default=graphics,LINEAR_SRGB_TO_LINEAR_DISPLAY_P3=(new Matrix3).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),LINEAR_DISPLAY_P3_TO_LINEAR_SRGB=(new Matrix3).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),COLOR_SPACES={[LinearSRGBColorSpace]:{transfer:LinearTransfer,primaries:Rec709Primaries,luminanceCoefficients:[.2126,.7152,.0722],toReference:t=>t,fromReference:t=>t},[SRGBColorSpace]:{transfer:SRGBTransfer,primaries:Rec709Primaries,luminanceCoefficients:[.2126,.7152,.0722],toReference:t=>t.convertSRGBToLinear(),fromReference:t=>t.convertLinearToSRGB()},[LinearDisplayP3ColorSpace]:{transfer:LinearTransfer,primaries:P3Primaries,luminanceCoefficients:[.2289,.6917,.0793],toReference:t=>t.applyMatrix3(LINEAR_DISPLAY_P3_TO_LINEAR_SRGB),fromReference:t=>t.applyMatrix3(LINEAR_SRGB_TO_LINEAR_DISPLAY_P3)},[DisplayP3ColorSpace]:{transfer:SRGBTransfer,primaries:P3Primaries,luminanceCoefficients:[.2289,.6917,.0793],toReference:t=>t.convertSRGBToLinear().applyMatrix3(LINEAR_DISPLAY_P3_TO_LINEAR_SRGB),fromReference:t=>t.applyMatrix3(LINEAR_SRGB_TO_LINEAR_DISPLAY_P3).convertLinearToSRGB()}},SUPPORTED_WORKING_COLOR_SPACES=new Set([LinearSRGBColorSpace,LinearDisplayP3ColorSpace]),ColorManagement={enabled:!0,_workingColorSpace:LinearSRGBColorSpace,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!SUPPORTED_WORKING_COLOR_SPACES.has(t))throw new Error(`Unsupported working color space, "${t}".`);this._workingColorSpace=t},convert:function(t,e,r){return!1!==this.enabled&&e!==r&&e&&r?(e=COLOR_SPACES[e].toReference,(0,COLOR_SPACES[r].fromReference)(e(t))):t},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return COLOR_SPACES[t].primaries},getTransfer:function(t){return t===NoColorSpace?LinearTransfer:COLOR_SPACES[t].transfer},getLuminanceCoefficients:function(t,e=this._workingColorSpace){return t.fromArray(COLOR_SPACES[e].luminanceCoefficients)}};function SRGBToLinear(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function LinearToSRGB(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}var defaultColorSpace=LinearSRGBColorSpace,_colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(t,e,r){return r<0&&(r+=1),1<r&&--r,r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}var Color=class{constructor(t,e,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,r)}set(t,e,r){var n;return void 0===e&&void 0===r?(n=t)&&n.isColor?this.copy(n):"number"==typeof n?this.setHex(n):"string"==typeof n&&this.setStyle(n):this.setRGB(t,e,r),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=defaultColorSpace){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,ColorManagement.toWorkingColorSpace(this,e),this}setRGB(t,e,r,n=ColorManagement.workingColorSpace){return this.r=t,this.g=e,this.b=r,ColorManagement.toWorkingColorSpace(this,n),this}setHSL(t,e,r,n=ColorManagement.workingColorSpace){return t=euclideanModulo(t,1),e=clamp(e,0,1),r=clamp(r,0,1),0===e?this.r=this.g=this.b=r:(this.r=hue2rgb(e=2*r-(r=r<=.5?r*(1+e):r+e-r*e),r,t+1/3),this.g=hue2rgb(e,r,t),this.b=hue2rgb(e,r,t-1/3)),ColorManagement.toWorkingColorSpace(this,n),this}setStyle(e,r=defaultColorSpace){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(a=/^(\w+)\(([^\)]*)\)/.exec(e)){let t;var i=a[1],s=a[2];switch(i){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(t[4]),this.setRGB(Math.min(255,parseInt(t[1],10))/255,Math.min(255,parseInt(t[2],10))/255,Math.min(255,parseInt(t[3],10))/255,r);if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(t[4]),this.setRGB(Math.min(100,parseInt(t[1],10))/100,Math.min(100,parseInt(t[2],10))/100,Math.min(100,parseInt(t[3],10))/100,r);break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(t[4]),this.setHSL(parseFloat(t[1])/360,parseFloat(t[2])/100,parseFloat(t[3])/100,r);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(a=/^\#([A-Fa-f\d]+)$/.exec(e)){var i=a[1],a=i.length;if(3===a)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,r);if(6===a)return this.setHex(parseInt(i,16),r);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&0<e.length)return this.setColorName(e,r);return this}setColorName(t,e=defaultColorSpace){var r=_colorKeywords[t.toLowerCase()];return void 0!==r?this.setHex(r,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=SRGBToLinear(t.r),this.g=SRGBToLinear(t.g),this.b=SRGBToLinear(t.b),this}copyLinearToSRGB(t){return this.r=LinearToSRGB(t.r),this.g=LinearToSRGB(t.g),this.b=LinearToSRGB(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=defaultColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),t),65536*Math.round(clamp(255*_color.r,0,255))+256*Math.round(clamp(255*_color.g,0,255))+Math.round(clamp(255*_color.b,0,255))}getHexString(t=defaultColorSpace){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=ColorManagement.workingColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),e);var r=_color.r,n=_color.g,i=_color.b,e=Math.max(r,n,i),s=Math.min(r,n,i);let a,o;var l=(s+e)/2;if(s===e)a=0,o=0;else{var h=e-s;switch(o=l<=.5?h/(e+s):h/(2-e-s),e){case r:a=(n-i)/h+(n<i?6:0);break;case n:a=(i-r)/h+2;break;case i:a=(r-n)/h+4}a/=6}return t.h=a,t.s=o,t.l=l,t}getRGB(t,e=ColorManagement.workingColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),e),t.r=_color.r,t.g=_color.g,t.b=_color.b,t}getStyle(t=defaultColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),t);var e=_color.r,r=_color.g,n=_color.b;return t!==defaultColorSpace?`color(${t} ${e.toFixed(3)} ${r.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*r)},${Math.round(255*n)})`}offsetHSL(t,e,r){return this.getHSL(_hslA),this.setHSL(_hslA.h+t,_hslA.s+e,_hslA.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,r){return this.r=t.r+(e.r-t.r)*r,this.g=t.g+(e.g-t.g)*r,this.b=t.b+(e.b-t.b)*r,this}lerpHSL(t,e){this.getHSL(_hslA),t.getHSL(_hslB);var t=lerp(_hslA.h,_hslB.h,e),r=lerp(_hslA.s,_hslB.s,e),e=lerp(_hslA.l,_hslB.l,e);return this.setHSL(t,r,e),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){var e=this.r,r=this.g,n=this.b,t=t.elements;return this.r=t[0]*e+t[3]*r+t[6]*n,this.g=t[1]*e+t[4]*r+t[7]*n,this.b=t[2]*e+t[5]*r+t[8]*n,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}},_color=new Color,FMMath=(Color.NAMES=_colorKeywords,class{constructor(){}static round(t){return 0<t.toFixed(2)?Math.ceil(t.toFixed(2)):Math.floor(t.toFixed(2))}static generateUUID(){var e=[];for(let t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);var t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,t=e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&r]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[63&n|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255];return e.length=0,t.toUpperCase()}static findNearNthPowerOfTwo(t){t-=1;return(t=(t=(t=(t=(t|=t>>1)|t>>2)|t>>4)|t>>8)|t>>16)<0?1:1+t}static rgbToArray(t){var e=new Color;return e.setStyle(t),[e.r,e.g,e.b]}static toRgba(t){var e;return void 0===t?t:"number"!=typeof t?3<=(e=t.split(",")).length?"rgba("+parseInt(e[0])+","+parseInt(e[1])+","+parseInt(e[2])+",1)":t:"rgba("+parseInt(255*new Color(t).r)+","+parseInt(255*new Color(t).g)+","+parseInt(255*new Color(t).b)+",1)"}static toColor(t){var e;return"number"==typeof t?t:3<=(e=t.split(",")).length?parseInt(e[0])<<16|parseInt(e[1])<<8|parseInt(e[2]):(console.error("color format error",t),0)}static cov(i){var t=[],e=[0,0],s=[];for(let t=0;t<i.length;t++)e[0]+=i[t].x,e[1]+=i[t].y;e[0]=e[0]/i.length,e[1]=e[1]/i.length;for(let t=0;t<i.length;t++)s.push([i[t].x-e[0],i[t].y-e[1]]);var a=[];for(let e=0;e<s[0].length;e++){var r=[];for(let t=0;t<s.length;t++)r.push(s[t][e]);a.push(r)}for(let n=0;n<a.length;n++){var o=[];for(let r=0;r<s[0].length;r++){let e=0;for(let t=0;t<a[n].length;t++)e+=a[n][t]*s[t][r];e/=i.length-1,o.push(e)}t.push(o)}return t}static eig(t){var e=(t[0][0]+t[1][1])/2,r=t[0][0]*t[1][1]-t[1][0]*t[0][1],n=e+Math.sqrt(e*e-r),e=e-Math.sqrt(e*e-r);return 0==t[0][1]&&0==t[1][0]?{eigValue:[n,e],eigVect:[[1,0],[0,1]]}:(r=(n-t[0][0])/t[0][1],t=(e-t[0][0])/t[0][1],{eigValue:[n,e],eigVect:[[1/Math.sqrt(1+r*r),r/Math.sqrt(1+r*r)],[1/Math.sqrt(1+t*t),t/Math.sqrt(1+t*t)]]})}}),FMMath_default=FMMath,Vector32=class{constructor(t=0,e=0,r=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=e,this.z=r}set(t,e,r){return void 0===r&&(r=this.z),this.x=t,this.y=e,this.z=r,this}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){var r=t.x,n=t.y,t=t.z,i=e.x,s=e.y,e=e.z;return this.x=n*e-t*s,this.y=t*i-r*e,this.z=r*s-n*i,this}angleTo(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());return 0===e?Math.PI/2:(t=this.dot(t)/e,e=Math.max(-1,Math.min(1,t)),Math.acos(e))}normalize(){return this.divideScalar(this.length()||1)}divideScalar(t){return this.multiplyScalar(1/t)}},FMRectangle=class{constructor(t){this._size=t.size,this._center=t.center,this._points=t.points}get size(){return this._size}get min(){return{x:this._center.x-this._size.x/2,y:this._center.y-this._size.y/2}}get max(){return{x:this._center.x+this._size.x/2,y:this._center.y+this._size.y/2}}get center(){return{x:this._center.x,y:this._center.y}}get points(){return this._points}},FMRectangle_default=FMRectangle,OffsetCurve=class{constructor(t){this._pts=[],this._size=null,this._offsetPts=[],this._distance=void 0!==t.distance?t.distance:0,this._circleSegment=void 0!==t.circleSegment?t.circleSegment:8,this._filletAngleQuantum=Math.PI/2/this._circleSegment,this._endCapStyle=void 0!==t.endCapStyle?t.endCapStyle:"circle",this._isSingleSide=void 0!==t.isSingleSide&&t.isSingleSide}computeOffsetCurve(e){this._offsetPts=[];let r=null;var t,n,i=this._distance,s="left";for(let t=2;t<e.length;t++){var a=e[t-2],o=e[t-1],l=e[t],h={p0:{x:null,y:null},p1:{x:null,y:null}},u=(this._computeOffsetSegment({p0:a,p1:o},s,i,h),{p0:o,p1:l}),c={p0:{x:null,y:null},p1:{x:null,y:null}},u=(this._computeOffsetSegment(u,s,i,c),this._computeOrientation(a,o,l));0==u?this._addCollinear(h,c):-1==u?this._addOutsideTurn(u,h,c,o):this._addInsideTurn(u,h,c,o),r=c}this._offsetPts.push(r.p1),this._addLineEndCap(e[e.length-2],e[e.length-1]);for(let t=e.length-1;2<=t;t--){var x=e[t],y=e[t-1],p=e[t-2],f={p0:{x:null,y:null},p1:{x:null,y:null}},d=(this._computeOffsetSegment({p0:x,p1:y},s,i,f),{p0:y,p1:p}),_={p0:{x:null,y:null},p1:{x:null,y:null}},d=(this._computeOffsetSegment(d,s,i,_),this._computeOrientation(x,y,p));0==d?this._addCollinear(f,_):-1==d?this._addOutsideTurn(d,f,_,y):this._addInsideTurn(d,f,_,y),r=_}return this._offsetPts.push(r.p1),this._addLineEndCap(e[1],e[0]),this._offsetPts=this._simplify(this._offsetPts),this._offsetPts.length<1||(t=this._offsetPts[0],n=this._offsetPts[this._offsetPts.length-1],t.x===n.x&&t.y===n.y||this._offsetPts.push(t),this._offsetPts=this._removeLoop(this._offsetPts,e),this._offsetPts.length<1)?[]:this._offsetPts}computeSingleSidedBufferCurve(r,n){this._offsetPts=[];let i=null,s=this._distance;if("left"==n){let e=!1;for(let t=2;t<r.length;t++){var a=r[t-2],o=r[t-1],l=r[t],h={p0:{x:null,y:null},p1:{x:null,y:null}},u=(this._computeOffsetSegment({p0:a,p1:o},n,s,h),{p0:o,p1:l}),c={p0:{x:null,y:null},p1:{x:null,y:null}},u=(this._computeOffsetSegment(u,n,s,c),this._computeOrientation(a,o,l));e||(this._offsetPts.push(h.p0),e=!0),0==u?this._addCollinear(h,c):-1==u&&"left"===n||1==u&&"right"===n?this._addOutsideTurn(u,h,c,o):this._addInsideTurn(u,h,c,o),i=c}this._offsetPts.push(i.p1),this._addHalfLineEndCap(r[r.length-2],r[r.length-1],"left");for(let t=r.length-1;0<=t;t--)this._offsetPts.push(r[t]);this._addHalfLineEndCap(r[1],r[0],"right")}else if("right"==n){n="left",s=-s,this._distance=s;let e=!1;for(let t=r.length-1;2<=t;t--){var x=r[t],y=r[t-1],p=r[t-2],f={p0:{x:null,y:null},p1:{x:null,y:null}},d=(this._computeOffsetSegment({p0:x,p1:y},n,s,f),{p0:y,p1:p}),_={p0:{x:null,y:null},p1:{x:null,y:null}},d=(this._computeOffsetSegment(d,n,s,_),this._computeOrientation(x,y,p));e||(this._offsetPts.push(f.p0),e=!0),0==d?this._addCollinear(f,_):-1==d&&"left"===n||1==d&&"right"===n?this._addOutsideTurn(d,f,_,y):this._addInsideTurn(d,f,_,y),i=_}this._offsetPts.push(i.p1),this._addHalfLineEndCap(r[1],r[0],"left");for(let t=0;t<r.length;t++)this._offsetPts.push(r[t]);this._addHalfLineEndCap(r[r.length-2],r[r.length-1],"right")}var t,e;return this._offsetPts=this._simplify(this._offsetPts),this._offsetPts=this._removeLoop(this._offsetPts),this._offsetPts.length<1?[]:(t=this._offsetPts[0],e=this._offsetPts[this._offsetPts.length-1],t.x===e.x&&t.y===e.y||this._offsetPts.push(t),this._offsetPts)}computeSingleSideRingBufferCurve(e,r,t){this._offsetPts=[];let n=null;!t&&this._isSingleSide&&(this._distance=-this._distance);var i,s=this._distance;if("left"===r){this._initOffsetSegment(e[e.length-2],e[0],e[1],r);for(let t=2;t<e.length;t++){var a=e[t-2],o=e[t-1],l=e[t],h={p0:{x:null,y:null},p1:{x:null,y:null}},u=(this._computeOffsetSegment({p0:a,p1:o},r,s,h),{p0:o,p1:l}),c={p0:{x:null,y:null},p1:{x:null,y:null}},u=(this._computeOffsetSegment(u,r,s,c),this._computeOrientation(a,o,l));0==u?this._addCollinear(h,c):-1==u&&"left"===r||1==u&&"right"===r?this._addOutsideTurn(u,h,c,o):this._addInsideTurn(u,h,c,o),n=c}}else if("right"===r){this._initOffsetSegment(e[1],e[0],e[e.length-2],r="left");for(let t=e.length-1;2<=t;t--){var x=e[t],y=e[t-1],p=e[t-2],f={p0:{x:null,y:null},p1:{x:null,y:null}},d=(this._computeOffsetSegment({p0:x,p1:y},r,s,f),{p0:y,p1:p}),_={p0:{x:null,y:null},p1:{x:null,y:null}},d=(this._computeOffsetSegment(d,r,s,_),this._computeOrientation(x,y,p));0==d?this._addCollinear(f,_):-1==d&&"left"===r||1==d&&"right"===r?this._addOutsideTurn(d,f,_,y):this._addInsideTurn(d,f,_,y),n=_}}return this._offsetPts=this._simplify(this._offsetPts),this._offsetPts=this._removeLoop(this._offsetPts),this._offsetPts.length<1?[]:(t=this._offsetPts[0],i=this._offsetPts[this._offsetPts.length-1],t.x===i.x&&t.y===i.y||this._offsetPts.push(t),this._offsetPts)}isCCW(e){let r=0;for(let t=0;t<e.length-1;t++)r+=e[t].x*e[t+1].y-e[t].y*e[t+1].x;return!(r<0)}_computeOffsetSegment(t,e,r,n){var e="left"===e?1:-1,i=t.p1.x-t.p0.x,s=t.p1.y-t.p0.y,a=Math.sqrt(i*i+s*s),i=e*r*i/a,e=e*r*s/a;n.p0.x=t.p0.x-e,n.p0.y=t.p0.y+i,n.p1.x=t.p1.x-e,n.p1.y=t.p1.y+i}_computeOrientation(t,e,r){var n=e.x-t.x,i=r.x-e.x,n=n*(r.y-e.y)-(e.y-t.y)*i;return 0<n?1:n<0?-1:0}_addCollinear(t,e){this._offsetPts.push(t.p1),this._offsetPts.push(e.p0)}_addOutsideTurn(t,e,r,n){Graphics_default._distance(e,r)<.001*this._distance?this._offsetPts.push(e.p1):(this._offsetPts.push(e.p1),this._addCornerFillet(n,e.p1,r.p0,t,this._distance),this._offsetPts.push(r.p0))}_addInsideTurn(t,e,r,n){var i={x:null,y:null};let s=e.p1.x-e.p0.x,a=e.p1.y-e.p0.y,o=r.p1.x-r.p0.x,l=r.p1.y-r.p0.y;if(Math.abs(s*l-o*a)<.001){if(Graphics_default._isPointOnLine(r.p0,r.p1,e.p1))return void this._offsetPts.push(e.p1);this._offsetPts.push(r.p0)}Graphics_default._calcCrossPoint(e.p0,e.p1,r.p0,r.p1,i)?this._offsetPts.push(i):(this._hasNarrowConcaveAngle=!0,Graphics_default._distance(e.p1,r.p0)<.001*this._distance?this._offsetPts.push(e.p1):(this._offsetPts.push(e.p1),this._offsetPts.push(r.p0)))}_addCornerFillet(t,e,r,n,i){var s=e.x-t.x;let a=Math.atan2(e.y-t.y,s);s=r.x-t.x,s=Math.atan2(r.y-t.y,s);-1===n?a<=s&&(a+=2*Math.PI):a>=s&&(a-=2*Math.PI),this._offsetPts.push(e),this._addDirectedFillet(t,a,s,n,i),this._offsetPts.push(r)}_addDirectedFillet(e,r,t,n,i){var s=-1===n?-1:1,n=Math.abs(r-t),a=Math.trunc(n/this._filletAngleQuantum+.5);if(a<1)return null;var o=n/a;for(let t=0;t<a;t++){var l=r+s*t*o,h={x:null,y:null};h.x=e.x+i*Math.cos(l),h.y=e.y+i*Math.sin(l),this._offsetPts.push(h)}}_addLineEndCap(t,e){var r={p0:t,p1:e},n={p0:{x:null,y:null},p1:{x:null,y:null}},i=(this._computeOffsetSegment(r,"left",this._distance,n),{p0:{x:null,y:null},p1:{x:null,y:null}}),r=(this._computeOffsetSegment(r,"right",this._distance,i),e.x-t.x),s=Math.atan2(e.y-t.y,r);switch(this._endCapStyle){case"circle":this._offsetPts.push(n.p1),this._addDirectedFillet(e,s+Math.PI/2,s-Math.PI/2,-1,this._distance),this._offsetPts.push(i.p1);break;case"flat":this._offsetPts.push(n.p1),this._offsetPts.push(i.p1);break;case"square":var a={x:null,y:null},o=(a.x=Math.abs(this._distance)*Math.cos(s),a.y=Math.abs(this._distance)*Math.sin(s),{x:n.p1.x+a.x,y:n.p1.y+a.y}),a={x:i.p1.x+a.x,y:i.p1.y+a.y};this._offsetPts.push(o),this._offsetPts.push(a)}}_addHalfLineEndCap(t,e,r){var n,i,s={p0:t,p1:e},a={p0:{x:null,y:null},p1:{x:null,y:null}},s=("left"==r?this._computeOffsetSegment(s,"left",this._distance,a):"right"==r&&this._computeOffsetSegment(s,"right",this._distance,a),e.x-t.x),o=Math.atan2(e.y-t.y,s),l={x:null,y:null};switch(l.x=Math.abs(this._distance)*Math.cos(o),l.y=Math.abs(this._distance)*Math.sin(o),this._endCapStyle){case"circle":"left"==r?(this._offsetPts.push(a.p1),this._addDirectedFillet(e,o+Math.PI/2,o,-1,this._distance),this._offsetPts.push({x:e.x+l.x,y:e.y+l.y})):"right"==r&&(this._offsetPts.push({x:e.x+l.x,y:e.y+l.y}),this._addDirectedFillet(e,o,o-Math.PI/2,-1,this._distance),this._offsetPts.push(a.p1));break;case"flat":break;case"square":"left"==r?(n={x:a.p1.x+l.x,y:a.p1.y+l.y},i={x:e.x+l.x,y:e.y+l.y},this._offsetPts.push(n),this._offsetPts.push(i)):"right"==r&&(n={x:a.p1.x+l.x,y:a.p1.y+l.y},i={x:e.x+l.x,y:e.y+l.y},this._offsetPts.push(i),this._offsetPts.push(n))}}_simplify(e){var r=[];for(let t=0;t<e.length-1;t++)Graphics_default.distance(e[t],e[t+1])<1e-4||r.push(e[t]);return 1e-4<Graphics_default.distance(e[e.length-1],e[e.length-2])&&r.push(e[e.length-1]),r}_removeLoop(n,i){if(n.length<=4)return n;for(;;){let r=null;for(let e=1;e<n.length;e++){var s=n[e-1],a=n[e];for(let t=e+2;t<n.length;t++){var o=n[t-1],l=n[t];if(1!==e||t!==n.length-1){var h={x:null,y:null};if(Graphics_default._calcCrossPoint(s,a,o,l,h)){r={start:e,length:t-e,cross:h};break}}}if(r)break}if(!r)return n;var{start:u,length:c,cross:x}=r;let t=!1;for(let e of[[...n.slice(0,u),x,...n.slice(u+c),n[0]],[x,...n.slice(u,u+c),x]])if(!i||"circle"!==this._endCapStyle&&"square"!==this._endCapStyle?i&&"flat"===this._endCapStyle?2<=i.length&&(t=i.slice(1,i.length-1).every(t=>Graphics_default._isPointInPolygon(t,e,e.length-1))):t=!0:t=i.every(t=>Graphics_default._isPointInPolygon(t,e,e.length-1)),t){n=e;break}}}_initOffsetSegment(t,e,r,n){var i={p0:{x:null,y:null},p1:{x:null,y:null}},s=(this._computeOffsetSegment({p0:t,p1:e},n,this._distance,i),{p0:e,p1:r}),a={p0:{x:null,y:null},p1:{x:null,y:null}},s=(this._computeOffsetSegment(s,n,this._distance,a),this._computeOrientation(t,e,r));0==s?this._addCollinear(i,a):-1==s&&"left"===n||1==s&&"right"===n?this._addOutsideTurn(s,i,a,e):this._addInsideTurn(s,i,a,e)}},OffsetCurve_default=OffsetCurve,FMCalculator=class{constructor(){}static distance(t,e){return Graphics_default.distance(t,e)}static isContain(t,e){return Graphics_default.isPolygonContainPoint(t,e)}static inExtents(t){let n=!1;var e=t.type,i=t.point,r=t.level,s=t.map;let a=t.buildingID;a=a||s.getMapOptions().mapID,void 0===e&&FMType_default.EXTENT_LAYER;var o=s.getBuilding(a).getFloor(r).getLayers(FMType_default.EXTENT_LAYER)[0].children;for(let r=0;r<o.length;r++){let e=!1;if((n=Graphics_default._isPointInPolygon(i,o[r].coordinates[0],o[r].coordinates[0].length-1))&&1<o[r].coordinates.length)for(let t=1;t<o[r].coordinates.length;t++)if(Graphics_default._isPointInPolygon(i,o[r].coordinates[t],o[r].coordinates[t].length-1)){e=!0;break}if(n){e&&(n=!1);break}}return n}static bound(e){let r=-Number.MAX_VALUE,n=-Number.MAX_VALUE,i=Number.MAX_VALUE,s=Number.MAX_VALUE;for(let t=0;t<e.length;t++)e[t].x>r&&(r=e[t].x),e[t].y>n&&(n=e[t].y),e[t].x<i&&(i=e[t].x),e[t].y<s&&(s=e[t].y);return{max:{x:r,y:n},min:{x:i,y:s},size:{x:r-i,y:n-s},center:{x:(r+i)/2,y:(n+s)/2}}}static orientedBound(s){var t={center:{x:0,y:0},size:{x:0,y:0},rotation:{x:0,y:0},corners:[]};if(s&&0!=s.length){var a=FMMath_default.cov(s),o=FMMath_default.eig(a).eigVect,l=[];let e=Number.MAX_VALUE,r=Number.MAX_VALUE,n=-Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let t=0;t<s.length;t++){var h=s[t].x*o[0][0]+s[t].y*o[0][1],u=s[t].x*o[1][0]+s[t].y*o[1][1];h<e&&(e=h),u<r&&(r=u),h>n&&(n=h),u>i&&(i=u),l.push([h,u])}var a=[(n+e)/2,(i+r)/2],c=o[0][0]*o[1][1]-o[1][0]*o[0][1],c=[[o[1][1]/c,-o[0][1]/c],[-o[1][0]/c,o[0][0]/c]],a=[c[0][0]*a[0]+c[0][1]*a[1],c[1][0]*a[0]+c[1][1]*a[1]],a=(t.center.x=a[0],t.center.y=a[1],t.size.x=n-e,t.size.y=i-r,[[e,r],[e,i],[n,i],[n,r]]),x=[[],[],[],[]],c=(x[0]=[c[0][0]*a[0][0]+c[0][1]*a[0][1],c[1][0]*a[0][0]+c[1][1]*a[0][1]],x[1]=[c[0][0]*a[1][0]+c[0][1]*a[1][1],c[1][0]*a[1][0]+c[1][1]*a[1][1]],x[2]=[c[0][0]*a[2][0]+c[0][1]*a[2][1],c[1][0]*a[2][0]+c[1][1]*a[2][1]],x[3]=[c[0][0]*a[3][0]+c[0][1]*a[3][1],c[1][0]*a[3][0]+c[1][1]*a[3][1]],new Vector32(1,0,0)),a=new Vector32(x[0][0],0,x[0][1]),a=new Vector32(x[3][0],0,x[3][1]).clone().sub(a).normalize(),y=a.angleTo(c)*Graphics_default._rad2Deg(),a=0<a.clone().cross(c).y?y:360-y,y=new Vector32(x[0][0],0,x[0][1]),y=new Vector32(x[1][0],0,x[1][1]).clone().sub(y).normalize(),p=y.angleTo(c)*Graphics_default._rad2Deg(),y=0<y.clone().cross(c).y;return t.rotation={x:a,y:y?p:360-p},t.corners=[{x:x[0][0],y:x[0][1]},{x:x[1][0],y:x[1][1]},{x:x[2][0],y:x[2][1]},{x:x[3][0],y:x[3][1]}],t}}static scaleBound(t,e){var{max:t,min:r}=t,t=new Vector2(t.x,t.y),r=new Vector2(r.x,r.y),n=t.clone().add(r).multiplyScalar(.5),t=t.clone().sub(r),r=t.clone().normalize(),t=t.clone().length()*e,e=n.clone().add(r.clone().multiplyScalar(t/2)),n=n.clone().add(r.clone().multiplyScalar(-t/2)),r=e.x,t=e.y,e=n.x,n=n.y;return{max:{x:r,y:t},min:{x:e,y:n},size:{x:Math.abs(r-e),y:Math.abs(t-n)},center:{x:(r+e)/2,y:(t+n)/2}}}static rectangleBuilder(t,e,r){var n=[];return n.push({x:r.x-t/2,y:r.y+e/2}),n.push({x:r.x+t/2,y:r.y+e/2}),n.push({x:r.x+t/2,y:r.y-e/2}),n.push({x:r.x-t/2,y:r.y-e/2}),n}static circleBuilder(e,r,n){var i=[];for(let t=0;t<=n;t++){var s=t/n*Math.PI*2;i.push({x:r.x+e*Math.cos(s),y:r.y+e*Math.sin(s)})}return i}static fanBuilder(e,r,n,t){var i=[],s=(i.push(r),[t[0]/180*Math.PI,t[1]/180*Math.PI]),a=(s[1]-s[0])/n;for(let t=0;t<=n;t++){var o=s[0]+t*a;i.push({x:r.x+e*Math.sin(o),y:r.y+e*Math.cos(o)})}return i}static area(t){return Graphics_default._calcPolygonArea(t,t.length)}static TriangleCentroid(t,e,r,n){var i=e.x-t.x,s=r.x-t.x;return n.area=(i*(r.y-t.y)-s*(e.y-t.y))/2,n.centroid={},n.centroid.x=(t.x+e.x+r.x)/3,n.centroid.y=(t.y+e.y+r.y)/3,!0}static calculatorInsideCentroid(e,t){var r=e.length;if(r<3)return!1;var i=[];for(let t=1;t<r-1;t++){var n={};this.TriangleCentroid(e[0],e[t],e[t+1],n),i.push(n)}let s=[],a=(i.forEach(function(t,e,r){s.push(t)}),!1);s.sort(function(t,e){return(0<t.area?t.area:-t.area)-(0<e.area?e.area:-e.area)});for(;0<s.length&&!(a=this.calculatorCentroid(e,s,t));)s.shift();if(!a){let n=[];i.forEach(function(t,e,r){n.push(t)});for(;0<n.length&&!(a=this.calculatorCentroid(e,n,t));)n.shift()}return a}static calculatorCentroid(t,e,r){let n=0;var i={x:0,y:0};for(let t=0;t<e.length;t++)i.x+=e[t].centroid.x*e[t].area,i.y+=e[t].centroid.y*e[t].area,n+=e[t].area;return r.x=i.x/n,r.y=i.y/n,this.isContain(t,r)}static latlngToMapCoordinate(t){return{x:20037508.34*parseFloat(t.x)/180,y:Math.log(Math.tan((90+parseFloat(t.y))*Math.PI/360))/(Math.PI/180)*20037508.34/180}}static mapCoordinateToLatlng(t){var e=parseFloat(t.y)/20037508.34*180;return{x:parseFloat(t.x)/20037508.34*180,y:180/Math.PI*(2*Math.atan(Math.exp(e*Math.PI/180))-Math.PI/2)}}static maxInnerRect(p,t){if(p&&0!=p.length){var f=new Vector32(0,0,1),d={center:{x:0,y:0},size:{x:0,y:0},rotation:{x:0,y:0},corners:[]};let r=Number.MAX_VALUE,n=Number.MAX_VALUE,e=-Number.MAX_VALUE,i=-Number.MAX_VALUE;var _=[];for(let t=0;t<p.length;t++){var g=p[t].x,m=p[t].y;g<r&&(r=g),m<n&&(n=m),g>e&&(e=g),m>i&&(i=m),_.push({x:g,y:m})}var P=(e-r<i-n?e-r:i-n)/100,v=Math.ceil((e-r)/P),M=Math.ceil((i-n)/P),S=[];for(let e=0;e<M-1;e++){var C=new Array(v-1).fill(0);for(let t=0;t<v-1;t++){var b=r+P*t,L=r+P*(t+1),I=n+P*e,w=n+P*(e+1);Graphics_default.isPolygonInPolygon([{x:b,y:I},{x:b,y:w},{x:L,y:w},{x:L,y:I}],_)&&(C[t]=1)}S.push(C)}var R=new Array(v).fill(0);let s=0,a=0,o=0,l=0,h=0;for(let e=0;e<M-1;e++){var k=[];for(let t=0;t<v;t++){for(R[v-1]=0,t<v-1&&(R[t]=1==S[e][t]?R[t]+1:0);0<k.length&&R[k[k.length-1]]>=R[t];){var T=k[k.length-1],O=(k.pop(),R[T]*(0==k.length?t:t-k[k.length-1]-1));O>s&&(s=O,a=0==k.length?0:k[k.length-1]+1,o=t,l=e,h=e-R[T]+1)}k.push(t)}}var E=r+a*P,A=n+(l+1)*P,z=r+(o+1)*P,G=n+h*P,B=[[E,G],[E,A],[z,A],[z,G]];let u=0,c=2,x=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let t=0;t<B.length;t++)B[t][0]*B[t][0]+B[t][1]*B[t][1]<x&&(u=t,x=B[t][0]*B[t][0]+B[t][1]*B[t][1]),B[t][0]*B[t][0]+B[t][1]*B[t][1]>y&&(c=t,y=B[t][0]*B[t][0]+B[t][1]*B[t][1]);d.corners=[{x:B[0][0],y:B[0][1]},{x:B[1][0],y:B[1][1]},{x:B[2][0],y:B[2][1]},{x:B[3][0],y:B[3][1]}],d.center.x=(B[c][0]+B[u][0])/2,d.center.y=(B[c][1]+B[u][1])/2;var E=new Vector32(B[u][0],0,B[u][1]),A=new Vector32(B[(u+c)/2][0],0,B[(u+c)/2][1]),z=A.clone().sub(E).normalize(),G=(z.angleTo(f),Graphics_default._rad2Deg(),z.clone().cross(f).y,new Vector32(B[(u+c)/2][0],0,B[(u+c)/2][1])),D=new Vector32(B[c][0],0,B[c][1]),q=D.clone().sub(G).normalize();q.angleTo(f),Graphics_default._rad2Deg();q.clone().cross(f).y;return z.clone().cross(q).y<0?(d.size.x=A.clone().sub(E).length(),d.size.y=D.clone().sub(G).length()):(d.size.x=D.clone().sub(G).length(),d.size.y=A.clone().sub(E).length()),new FMRectangle_default({center:d.center,size:d.size,points:d.corners})}}static angle(t){var e=new Vector32(0,0,1),r=new Vector32(t.start.x,0,t.start.y),t=new Vector32(t.end.x,0,t.end.y).clone().sub(r).normalize(),r=t.angleTo(e)*Graphics_default._rad2Deg();return t.clone().cross(e).y<0?r:360-r}static intersection(t,e){var r={x:null,y:null};return 2<=t.length&&2<=e.length&&Graphics_default._calcCrossPoint(t[0],t[1],e[0],e[1],r),r}static lineBufferBuilder(e,r){var n={points:[],holes:[]};if(void 0!==r.distance&&0!=r.distance){var i=r.distance,s=(r.endCapStyle=void 0!==r.endCapStyle?r.endCapStyle:"circle",r.circleSegment=void 0!==r.circleSegment?r.circleSegment:8,null!=r.isSingleSide&&r.isSingleSide),a=e[e.length-1].x==e[0].x&&e[e.length-1].y==e[0].y;if(!(a&&e.length<4)){let t=!1;r=new OffsetCurve_default(r);a&&(t=r.isCCW(e)),s?a?0<i?t?n.points=r.computeSingleSideRingBufferCurve(e,"right",!0):n.points=r.computeSingleSideRingBufferCurve(e,"left",!0):(t?n.points=r.computeSingleSideRingBufferCurve(e,"left",!1):n.points=r.computeSingleSideRingBufferCurve(e,"right",!1),r.isCCW(n.points)!=t&&(n.points=[])):n.points=0<i?r.computeSingleSidedBufferCurve(e,"left"):r.computeSingleSidedBufferCurve(e,"right"):a?(t?(n.points=r.computeSingleSideRingBufferCurve(e,"right",!0),n.holes=r.computeSingleSideRingBufferCurve(e,"left",!1)):(n.points=r.computeSingleSideRingBufferCurve(e,"left",!0),n.holes=r.computeSingleSideRingBufferCurve(e,"right",!1)),r.isCCW(n.holes)!=t&&(n.holes=[])):n.points=r.computeOffsetCurve(e)}}return n}},FMCalculator_default=FMCalculator;function maxInnerRect(t){t=t.coords,t=new Float64Array(t),t=toVec2(t),t=FMCalculator_default.maxInnerRect(t);return{rect:{center:{x:t.center.x,y:t.center.y},size:{x:t.size.x,y:t.size.y}}}}export{maxInnerRect};